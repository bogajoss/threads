const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/VoiceMessage-Ha8cKthJ.js","assets/framework-di2JoXyY.js","assets/database-CdmW3A7f.js","assets/animations-pEILWrFP.js","assets/rolldown-runtime-BaZ8gS7u.js","assets/framework-sg0yWRLc.css","assets/ui-libs-CeA_mvKJ.js","assets/media-libs-D2H42K39.js","assets/media-libs-CqCaMccn.css","assets/VoiceMessage-BAzhZlRE.js","assets/index-D6iWZPjq.js","assets/query-CXZjka15.js","assets/index-iQpmi4G0.css"])))=>i.map(i=>d[i]);
import{a as ze}from"./rolldown-runtime-BaZ8gS7u.js";import{a as ke,i as oe,n as pe,o as Se,r as _e,s as Ce}from"./animations-pEILWrFP.js";import{_ as Me,b as Te,c as re}from"./framework-di2JoXyY.js";import"./database-CdmW3A7f.js";import{Ft as he,Gt as Re,Kt as $e,Ot as Ge,Vt as ge,Wt as be,_n as Oe,cn as Ie,dn as Ae,en as ve,kt as je,lr as Ee,on as Ne,qn as Pe,rn as fe,ur as Ue,vr as Le,yn as De}from"./ui-libs-CeA_mvKJ.js";import"./media-libs-D2H42K39.js";import{B as Ve,G as Fe,K as qe,M as ie,Q as He,W as Be,at as We,bn as I,ct as Ke,dt as xe,ft as me,lt as Ye,n as Je,ot as Xe,r as Ze,st as de,t as Qe,ut as ue,v as et,wt as tt,x as st,yn as ye}from"./index-D6iWZPjq.js";import"./VoiceMessage-BAzhZlRE.js";import{t as it}from"./VideoPlayer-I9bfnFil.js";import"./useAdmin-CrIFp0Ht.js";import{t as lt}from"./text-processing-BHR8J29b.js";import{t as at}from"./linkify-BSR2B0d-.js";import{a as rt,d as nt,f as ct}from"./hooks-DJbG4eOi.js";var ot=re(),O=ze(Ce(),1),t=ze(Se(),1),dt=i=>{const e=(0,ot.c)(67),{conv:s,selectedId:l,onSelect:x,onlineUsers:n,isTyping:u}=i;let f;e[0]!==s.isGroup||e[1]!==s.user||e[2]!==n?(f=!s.isGroup&&s.user?n.has(s.user.id):!1,e[0]=s.isGroup,e[1]=s.user,e[2]=n,e[3]=f):f=e[3];const o=f,c=l===s.id,v=s.unread>0,r=s.isGroup?s.name:s.user?.name,N=s.isGroup?s.avatar:s.user?.avatar;let h;e[4]!==s||e[5]!==x?(h=()=>x(s),e[4]=s,e[5]=x,e[6]=h):h=e[6];const T=c?"bg-violet-600 dark:bg-violet-600":"hover:bg-zinc-100 dark:hover:bg-zinc-900/80";let k;e[7]!==T?(k=I("group relative flex cursor-pointer items-center gap-[10px] py-2 px-3 transition-all duration-150 rounded-xl",T),e[7]=T,e[8]=k):k=e[8];const a=c?"opacity-90":"opacity-100";let b;e[9]!==a?(b=I("size-[54px] border-0 transition-all",a),e[9]=a,e[10]=b):b=e[10];const _=r||"";let y;e[11]!==N||e[12]!==_?(y=(0,t.jsx)(me,{src:N,alt:_,className:"object-cover"}),e[11]=N,e[12]=_,e[13]=y):y=e[13];let S;e[14]!==r?.[0]?(S=r?.[0]?.toUpperCase(),e[14]=r?.[0],e[15]=S):S=e[15];let z;e[16]!==S?(z=(0,t.jsx)(xe,{className:"bg-gradient-to-br from-violet-100 to-violet-200 text-violet-700 font-bold text-xl dark:from-zinc-800 dark:to-zinc-700 dark:text-zinc-300",children:S}),e[16]=S,e[17]=z):z=e[17];let C;e[18]!==z||e[19]!==b||e[20]!==y?(C=(0,t.jsxs)(ue,{className:b,children:[y,z]}),e[18]=z,e[19]=b,e[20]=y,e[21]=C):C=e[21];let M;e[22]!==o||e[23]!==c?(M=o&&!c&&(0,t.jsx)("span",{className:"absolute bottom-0.5 right-0.5 size-3.5 rounded-full border-[2.5px] border-white bg-emerald-500 ring-0 dark:border-black"}),e[22]=o,e[23]=c,e[24]=M):M=e[24];let m;e[25]!==C||e[26]!==M?(m=(0,t.jsxs)("div",{className:"relative shrink-0",children:[C,M]}),e[25]=C,e[26]=M,e[27]=m):m=e[27];const d=c?"text-white":"text-zinc-900 dark:text-zinc-100";let g;e[28]!==d?(g=I("truncate text-[16px] font-bold tracking-tight leading-tight",d),e[28]=d,e[29]=g):g=e[29];let j;e[30]!==s.isMuted?(j=s.isMuted&&(0,t.jsx)("span",{className:"ml-1 text-zinc-400 dark:text-zinc-500",children:"î§º"}),e[30]=s.isMuted,e[31]=j):j=e[31];let w;e[32]!==r||e[33]!==g||e[34]!==j?(w=(0,t.jsxs)("span",{className:g,children:[r,j]}),e[32]=r,e[33]=g,e[34]=j,e[35]=w):w=e[35];const $=c?"text-white/80":"text-zinc-400 dark:text-zinc-500";let p;e[36]!==$?(p=I("shrink-0 text-[12px] font-medium ml-2",$),e[36]=$,e[37]=p):p=e[37];let G;e[38]!==s.time||e[39]!==p?(G=(0,t.jsx)("span",{className:p,children:s.time}),e[38]=s.time,e[39]=p,e[40]=G):G=e[40];let L;e[41]!==w||e[42]!==G?(L=(0,t.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[w,G]}),e[41]=w,e[42]=G,e[43]=L):L=e[43];let A;e[44]!==s.currentUserSent||e[45]!==s.isGroup||e[46]!==s.lastMessage||e[47]!==s.lastMessageSender||e[48]!==v||e[49]!==c||e[50]!==u?(A=u?(0,t.jsx)("p",{className:I("truncate text-[14px] leading-relaxed flex-1 italic animate-pulse",c?"text-white/90":"text-violet-500 dark:text-violet-400 font-medium"),children:"typing..."}):(0,t.jsxs)("p",{className:I("truncate text-[14px] leading-relaxed flex-1",c?"text-white/90":v?"text-zinc-900 font-medium dark:text-zinc-200":"text-zinc-500 dark:text-zinc-400"),children:[s.isGroup&&s.lastMessageSender&&(0,t.jsxs)("span",{className:I("font-semibold mr-1",c?"text-white":"text-violet-500 dark:text-violet-400"),children:[s.lastMessageSender,":"]}),s.currentUserSent&&!s.lastMessageSender&&"You: ",s.lastMessage]}),e[44]=s.currentUserSent,e[45]=s.isGroup,e[46]=s.lastMessage,e[47]=s.lastMessageSender,e[48]=v,e[49]=c,e[50]=u,e[51]=A):A=e[51];let D;e[52]!==s.unread||e[53]!==v||e[54]!==c?(D=v&&(0,t.jsx)("span",{className:I("flex min-w-[20px] h-[20px] px-1.5 items-center justify-center rounded-full text-[11px] font-bold shadow-sm",c?"bg-white text-violet-600":"bg-violet-600 text-white dark:bg-violet-500"),children:s.unread}),e[52]=s.unread,e[53]=v,e[54]=c,e[55]=D):D=e[55];let E;e[56]!==A||e[57]!==D?(E=(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2 mt-0.5",children:[A,D]}),e[56]=A,e[57]=D,e[58]=E):E=e[58];let P;e[59]!==L||e[60]!==E?(P=(0,t.jsxs)("div",{className:"min-w-0 flex-1 flex flex-col justify-center py-1",children:[L,E]}),e[59]=L,e[60]=E,e[61]=P):P=e[61];let V;return e[62]!==m||e[63]!==h||e[64]!==P||e[65]!==k?(V=(0,t.jsxs)("div",{onClick:h,className:k,children:[m,P]}),e[62]=m,e[63]=h,e[64]=P,e[65]=k,e[66]=V):V=e[66],V},xt=({conversations:i,userResults:e=[],onSelect:s,onStartNew:l,selectedId:x,searchQuery:n,onSearchChange:u,onlineUsers:f=new Set,typingStatus:o={}})=>{const[c,v]=(0,O.useState)(!1),[r,N]=(0,O.useState)("all"),h=i.filter(a=>f.has(a.user?.id)),T=i.filter(a=>r==="unread"?a.unread>0:r==="groups"?a.isGroup:!0),k=[{id:"all",label:"All"},{id:"unread",label:"Unread",count:i.filter(a=>a.unread>0).length},{id:"groups",label:"Groups"}];return(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col overflow-hidden bg-white dark:bg-[#0f0f0f] h-full shadow-inner",children:[(0,t.jsxs)("div",{className:"px-4 md:px-4 pt-4 pb-2 shrink-0 w-full overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsxs)("div",{className:"relative flex-1 group min-w-0",children:[(0,t.jsx)(ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-violet-500 transition-colors",size:18}),(0,t.jsx)("input",{type:"text",value:n,onChange:a=>u(a.target.value),placeholder:"Search",className:"w-full rounded-full border-none bg-zinc-100 py-2.5 pl-11 pr-4 text-sm font-medium text-zinc-900 placeholder:text-zinc-500 transition-all focus:bg-white focus:ring-2 focus:ring-violet-500/20 dark:bg-zinc-900 dark:text-white dark:focus:bg-black"})]}),(0,t.jsx)("button",{onClick:()=>v(!0),className:"shrink-0 rounded-full bg-zinc-100 p-2.5 text-zinc-600 transition-colors hover:bg-zinc-200 dark:bg-zinc-900 dark:text-zinc-400 dark:hover:bg-zinc-800",children:(0,t.jsx)(Re,{size:20})})]}),(0,t.jsx)("div",{className:"flex items-center gap-1 border-b border-zinc-100 dark:border-zinc-800 mb-1",children:k.map(a=>(0,t.jsxs)("button",{onClick:()=>N(a.id),className:I("relative flex items-center px-4 py-2.5 text-[13px] font-bold transition-all",r===a.id?"text-violet-600 dark:text-violet-400":"text-zinc-500 hover:text-zinc-700 dark:text-zinc-400 dark:hover:text-zinc-200"),children:[a.label,a.count?(0,t.jsx)("span",{className:"ml-1.5 flex size-4 items-center justify-center rounded-full bg-violet-600/10 text-[9px] dark:bg-violet-400/10",children:a.count}):null,r===a.id&&(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-[3px] bg-violet-600 dark:bg-violet-400 rounded-t-full"})]},a.id))})]}),(0,t.jsx)("div",{className:"flex-1 min-h-0 overflow-hidden",children:(0,t.jsx)(Ve,{className:"h-full min-w-0",children:(0,t.jsxs)("div",{className:"flex flex-col pb-4 min-w-0",children:[!n&&r==="all"&&h.length>0&&(0,t.jsx)("div",{className:"mb-4 mt-2 min-w-0 w-full overflow-hidden",children:(0,t.jsxs)("div",{className:"flex gap-4 overflow-x-auto px-4 md:px-5 pb-4 pt-2 no-scrollbar w-full",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2 min-w-[64px] cursor-pointer group",children:[(0,t.jsxs)("div",{className:"relative flex size-[60px] items-center justify-center rounded-full bg-zinc-50 border border-zinc-200 dark:bg-zinc-900 dark:border-zinc-800 group-hover:bg-zinc-100 dark:group-hover:bg-zinc-800 transition-colors",children:[(0,t.jsx)(he,{size:24,className:"text-zinc-400"}),(0,t.jsx)("div",{className:"absolute bottom-0 right-0 size-5 bg-white dark:bg-black rounded-full flex items-center justify-center",children:(0,t.jsx)("div",{className:"size-4 bg-zinc-200 dark:bg-zinc-700 rounded-full flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-[10px] text-zinc-500 font-bold",children:"+"})})})]}),(0,t.jsx)("span",{className:"text-[11px] font-medium text-zinc-500",children:"Your Story"})]}),h.map(a=>(0,t.jsxs)("div",{onClick:()=>s(a),className:"flex flex-col items-center gap-2 cursor-pointer group min-w-[64px] transition-transform active:scale-95",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute -inset-[3px] rounded-full bg-gradient-to-tr from-violet-500 via-fuchsia-500 to-orange-500 opacity-90 p-[2px]"}),(0,t.jsx)("div",{className:"relative rounded-full border-[3px] border-white dark:border-black p-[2px] bg-white dark:bg-black",children:(0,t.jsxs)(ue,{className:"size-[50px]",children:[(0,t.jsx)(me,{src:a.user?.avatar,className:"object-cover"}),(0,t.jsx)(xe,{children:a.user?.name?.[0]})]})}),(0,t.jsx)("span",{className:"absolute bottom-1 right-1 size-3.5 rounded-full border-[2.5px] border-white bg-emerald-500 dark:border-black"})]}),(0,t.jsx)("span",{className:"w-full truncate text-center text-[11px] font-medium text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white transition-colors",children:a.user?.name.split(" ")[0]})]},a.id))]})}),(0,t.jsx)("div",{className:"px-2 space-y-0.5 mt-2",children:T.length>0&&T.filter(a=>a.lastMessage!=="No messages yet"||a.id===x||n).map(a=>(0,t.jsx)(dt,{conv:a,selectedId:x,onSelect:s,onlineUsers:f,isTyping:o[a.id]},a.id))}),e.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"px-6 py-3 mt-2 text-xs font-bold uppercase tracking-wider text-zinc-400",children:"More People"}),(0,t.jsx)("div",{className:"px-2 space-y-1",children:e.map(a=>(0,t.jsxs)("div",{onClick:()=>l(a),className:"flex cursor-pointer items-center gap-4 px-3 py-2 rounded-2xl transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800/50",children:[(0,t.jsxs)(ue,{className:"size-10",children:[(0,t.jsx)(me,{src:a.avatar,className:"object-cover"}),(0,t.jsx)(xe,{children:a.name?.[0]?.toUpperCase()})]}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"truncate text-sm font-bold text-zinc-900 dark:text-white",children:a.name}),(0,t.jsxs)("div",{className:"truncate text-xs text-zinc-500",children:["@",a.handle]})]}),(0,t.jsx)("button",{className:"flex size-8 items-center justify-center rounded-full bg-violet-50 text-violet-600 dark:bg-violet-900/20 dark:text-violet-400",children:(0,t.jsx)(he,{size:16})})]},a.id))})]}),i.length===0&&e.length===0&&n&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center px-6",children:[(0,t.jsx)("div",{className:"mb-4 rounded-full bg-zinc-100 p-4 dark:bg-zinc-900",children:(0,t.jsx)(ve,{className:"text-zinc-400",size:24})}),(0,t.jsxs)("p",{className:"text-zinc-500",children:['No results found for "',n,'"']})]})]})})}),(0,t.jsx)(Ze,{isOpen:c,onClose:()=>v(!1),onCreated:a=>{s({id:a,isGroup:!0})}})]})},mt=xt,ut=re();function ft(){const i=(0,ut.c)(4);let e;i[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,t.jsx)(ie,{className:"h-8 w-8 rounded-full"}),i[0]=e):e=i[0];let s;i[1]===Symbol.for("react.memo_cache_sentinel")?(s=(0,t.jsxs)("div",{className:"flex items-end gap-2 self-start",children:[e,(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ie,{className:"h-10 w-48 rounded-2xl rounded-bl-sm"}),(0,t.jsx)(ie,{className:"h-10 w-32 rounded-2xl rounded-bl-sm"})]})]}),i[1]=s):s=i[1];let l;i[2]===Symbol.for("react.memo_cache_sentinel")?(l=(0,t.jsx)("div",{className:"flex items-end gap-2 self-end",children:(0,t.jsxs)("div",{className:"space-y-2 flex flex-col items-end",children:[(0,t.jsx)(ie,{className:"h-10 w-40 rounded-2xl rounded-br-sm"}),(0,t.jsx)(ie,{className:"h-24 w-64 rounded-2xl rounded-br-sm"})]})}),i[2]=l):l=i[2];let x;return i[3]===Symbol.for("react.memo_cache_sentinel")?(x=(0,t.jsxs)("div",{className:"flex w-full flex-col gap-4 p-4",children:[s,l,(0,t.jsxs)("div",{className:"flex items-end gap-2 self-start",children:[(0,t.jsx)(ie,{className:"h-8 w-8 rounded-full"}),(0,t.jsx)(ie,{className:"h-14 w-56 rounded-2xl rounded-bl-sm"})]})]}),i[3]=x):x=i[3],x}var pt=re(),ht=i=>{const e=(0,pt.c)(45),{conversation:s,isOnline:l,onBack:x,onOpenSettings:n}=i,u=Me(),f=ct(s.user?.lastSeen),o=s.isGroup?s.name:s.user?.name,c=s.isGroup?s.avatar:s.user?.avatar;let v;e[0]===Symbol.for("react.memo_cache_sentinel")?(v=(0,t.jsx)(Le,{size:24}),e[0]=v):v=e[0];let r;e[1]!==s.unread?(r=s.unread>0&&(0,t.jsx)("span",{className:"absolute -top-1 -right-1 flex h-5 min-w-[20px] items-center justify-center rounded-full bg-violet-500 px-1 text-[11px] font-bold text-white ring-2 ring-white dark:ring-[#212121]",children:s.unread}),e[1]=s.unread,e[2]=r):r=e[2];let N;e[3]!==x||e[4]!==r?(N=(0,t.jsxs)("button",{onClick:x,className:"relative flex items-center justify-center size-11 rounded-full text-zinc-500 transition-colors hover:bg-zinc-100 dark:text-zinc-400 dark:hover:bg-white/5 md:hidden",children:[v,r]}),e[3]=x,e[4]=r,e[5]=N):N=e[5];let h;e[6]!==s.isGroup||e[7]!==s.user||e[8]!==u?(h=()=>!s.isGroup&&s.user&&u(`/u/${s.user.handle}`),e[6]=s.isGroup,e[7]=s.user,e[8]=u,e[9]=h):h=e[9];const T=o||"";let k;e[10]!==c||e[11]!==T?(k=(0,t.jsx)(me,{src:c,alt:T,className:"object-cover"}),e[10]=c,e[11]=T,e[12]=k):k=e[12];let a;e[13]!==o?.[0]?(a=o?.[0]?.toUpperCase(),e[13]=o?.[0],e[14]=a):a=e[14];let b;e[15]!==a?(b=(0,t.jsx)(xe,{className:"bg-gradient-to-br from-violet-100 to-violet-200 text-violet-700 font-bold dark:from-zinc-800 dark:to-zinc-700 dark:text-zinc-300",children:a}),e[15]=a,e[16]=b):b=e[16];let _;e[17]!==k||e[18]!==b?(_=(0,t.jsxs)(ue,{className:"size-[42px] shrink-0",children:[k,b]}),e[17]=k,e[18]=b,e[19]=_):_=e[19];let y;e[20]!==o?(y=(0,t.jsx)("h3",{className:"text-[16px] font-bold text-zinc-900 dark:text-white truncate leading-tight",children:o}),e[20]=o,e[21]=y):y=e[21];let S;e[22]!==s.isGroup||e[23]!==s.user?.lastSeen||e[24]!==l||e[25]!==f?(S=s.isGroup?"Group Chat":l?(0,t.jsx)("span",{className:"text-violet-500 dark:text-[#8774e1]",children:"Active now"}):s.user?.lastSeen?`last seen ${f}`:"offline",e[22]=s.isGroup,e[23]=s.user?.lastSeen,e[24]=l,e[25]=f,e[26]=S):S=e[26];let z;e[27]!==S?(z=(0,t.jsx)("span",{className:"text-[13px] text-zinc-500 dark:text-[#aaaaaa] leading-tight",children:S}),e[27]=S,e[28]=z):z=e[28];let C;e[29]!==y||e[30]!==z?(C=(0,t.jsxs)("div",{className:"flex flex-col min-w-0",children:[y,z]}),e[29]=y,e[30]=z,e[31]=C):C=e[31];let M;e[32]!==C||e[33]!==h||e[34]!==_?(M=(0,t.jsxs)("div",{className:"flex items-center gap-3 px-2 flex-1 min-w-0 cursor-pointer",onClick:h,children:[_,C]}),e[32]=C,e[33]=h,e[34]=_,e[35]=M):M=e[35];let m;e[36]!==M||e[37]!==N?(m=(0,t.jsxs)("div",{className:"flex items-center gap-1 w-full max-w-full",children:[N,M]}),e[36]=M,e[37]=N,e[38]=m):m=e[38];let d;e[39]===Symbol.for("react.memo_cache_sentinel")?(d=(0,t.jsx)(Pe,{size:22}),e[39]=d):d=e[39];let g;e[40]!==n?(g=(0,t.jsx)("div",{className:"flex items-center gap-0.5 pr-1",children:(0,t.jsx)("button",{onClick:n,className:"flex size-10 items-center justify-center rounded-full text-zinc-500 hover:bg-zinc-100 dark:text-[#aaaaaa] dark:hover:bg-white/5 transition-colors",children:d})}),e[40]=n,e[41]=g):g=e[41];let j;return e[42]!==m||e[43]!==g?(j=(0,t.jsxs)("div",{className:"sticky top-0 z-40 flex shrink-0 items-center justify-between bg-white/95 px-2 py-1.5 backdrop-blur-md dark:bg-[#212121]/95 transition-all h-[56px]",children:[m,g]}),e[42]=m,e[43]=g,e[44]=j):j=e[44],j},gt=ht,bt=re();const vt=(i,e,s)=>{const l=(0,bt.c)(7),x=e===void 0?40:e,n=s===void 0?120:s,u=(0,O.useRef)(null);let f;l[0]!==n||l[1]!==x?(f=()=>{const c=u.current;if(c){c.style.height="auto";const v=c.scrollHeight;c.style.height=`${Math.min(Math.max(v,x),n)}px`}},l[0]=n,l[1]=x,l[2]=f):f=l[2];let o;return l[3]!==n||l[4]!==x||l[5]!==i?(o=[i,x,n],l[3]=n,l[4]=x,l[5]=i,l[6]=o):o=l[6],(0,O.useEffect)(f,o),u};var jt=re(),Nt=i=>{const e=(0,jt.c)(68),{onSendMessage:s,onTyping:l,replyingTo:x,setReplyingTo:n,editingMessage:u,setEditingMessage:f}=i,[o,c]=(0,O.useState)("");let v;e[0]===Symbol.for("react.memo_cache_sentinel")?(v=[],e[0]=v):v=e[0];const[r,N]=(0,O.useState)(v),[h,T]=(0,O.useState)(!1),k=(0,O.useRef)(null),a=(0,O.useRef)(null),b=vt(o);let _,y;e[1]!==u||e[2]!==n||e[3]!==b?(_=()=>{u&&(c(u.text),n(null),b.current&&b.current.focus())},y=[u,n,b],e[1]=u,e[2]=n,e[3]=b,e[4]=_,e[5]=y):(_=e[4],y=e[5]),O.useEffect(_,y);const{isRecording:S,recordingTime:z,startRecording:C,stopRecording:M,cancelRecording:m,audioBlob:d,audioUrl:g,clearAudio:j}=nt(),[w,$]=(0,O.useState)(!1),p=(0,O.useRef)(null),G=zt,L=(0,O.useRef)(0);let A;e[6]!==l?(A=R=>{const J=R.target.value;if(c(J),l){const U=Date.now();U-L.current>3e3&&(l(!0),L.current=U),a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{l(!1),L.current=0},2e3)}},e[6]=l,e[7]=A):A=e[7];const D=A;let E;e[8]!==r||e[9]!==d||e[10]!==j||e[11]!==s||e[12]!==l||e[13]!==z||e[14]!==n||e[15]!==o||e[16]!==b?(E=R=>{if(R&&R.preventDefault(),d){s("",[],d,z),j();return}!o.trim()&&r.length===0||(l&&(a.current&&clearTimeout(a.current),l(!1)),s(o,r),c(""),N([]),n(null),setTimeout(()=>{b.current?.focus()},10))},e[8]=r,e[9]=d,e[10]=j,e[11]=s,e[12]=l,e[13]=z,e[14]=n,e[15]=o,e[16]=b,e[17]=E):E=e[17];const P=E;let V;e[18]!==g||e[19]!==w?(V=()=>{g&&(p.current||(p.current=new Audio(g),p.current.onended=()=>$(!1)),w?p.current.pause():p.current.play(),$(!w))},e[18]=g,e[19]=w,e[20]=V):V=e[20];const le=V;let X,Z;e[21]!==d?(X=()=>{!d&&p.current&&(p.current.pause(),p.current=null,$(!1))},Z=[d],e[21]=d,e[22]=X,e[23]=Z):(X=e[22],Z=e[23]),O.useEffect(X,Z);let Q;e[24]===Symbol.for("react.memo_cache_sentinel")?(Q=R=>{if(!R.target.files)return;const J=Array.from(R.target.files);N(U=>[...U,...J])},e[24]=Q):Q=e[24];const ne=Q;let F;e[25]!==r?(F=r.length>0&&(0,t.jsx)(oe.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},className:"flex gap-2 overflow-x-auto mx-auto mb-2 px-2 py-2 bg-white dark:bg-[#212121] rounded-2xl shadow-lg border border-zinc-100 dark:border-zinc-800 max-w-3xl no-scrollbar",children:r.map((R,J)=>(0,t.jsxs)("div",{className:"relative size-20 shrink-0 rounded-xl overflow-hidden border border-zinc-200 dark:border-zinc-700 group",children:[R.type.startsWith("video/")?(0,t.jsx)("div",{className:"size-full bg-black flex items-center justify-center",children:(0,t.jsx)(Ne,{size:20,className:"text-white opacity-50"})}):(0,t.jsx)("img",{src:URL.createObjectURL(R),className:"size-full object-cover"}),(0,t.jsx)("button",{type:"button",onClick:()=>N(U=>U.filter((ce,we)=>we!==J)),className:"absolute top-1 right-1 size-6 flex items-center justify-center rounded-full bg-black/50 text-white hover:bg-black/70 transition-colors",children:(0,t.jsx)(je,{size:14})})]},J))}),e[25]=r,e[26]=F):F=e[26];let q;e[27]!==u||e[28]!==x||e[29]!==f||e[30]!==n?(q=(x||u)&&(0,t.jsxs)(oe.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},className:"flex items-center justify-between mx-auto mb-1.5 px-4 py-2 bg-white dark:bg-[#212121] rounded-2xl shadow-lg border border-zinc-100 dark:border-zinc-800 max-w-3xl",children:[(0,t.jsxs)("div",{className:"text-sm flex items-center gap-3 min-w-0",children:[(0,t.jsx)("div",{className:"size-8 flex items-center justify-center rounded-full bg-violet-500/10 text-violet-500",children:u?(0,t.jsx)(Ie,{size:16}):(0,t.jsx)(fe,{size:16})}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("span",{className:"text-[13px] font-bold text-violet-500 block leading-tight",children:u?"Edit Message":`Reply to ${x.sender==="me"?"yourself":x.senderName}`}),(0,t.jsx)("p",{className:"truncate text-xs text-zinc-500 dark:text-[#aaaaaa]",children:u?u.text:x.text})]})]}),(0,t.jsx)("button",{onClick:()=>{n(null),f(null),u&&c("")},className:"p-1 rounded-full hover:bg-zinc-100 dark:hover:bg-white/10",children:(0,t.jsx)(je,{size:18,className:"text-zinc-400"})})]}),e[27]=u,e[28]=x,e[29]=f,e[30]=n,e[31]=q):q=e[31];let H;e[32]!==F||e[33]!==q?(H=(0,t.jsxs)(ke,{children:[F,q]}),e[32]=F,e[33]=q,e[34]=H):H=e[34];const ae=(S||d)&&"bg-zinc-900 ring-red-500/50";let B;e[35]!==ae?(B=I("flex-1 flex items-center gap-1 rounded-[24px] px-1.5 py-1.5 transition-all bg-white dark:bg-[#212121] shadow-md border-0 ring-1 ring-zinc-200 dark:ring-zinc-800 focus-within:ring-violet-500/30",ae),e[35]=ae,e[36]=B):B=e[36];let ee;e[37]!==d||e[38]!==m||e[39]!==j||e[40]!==P||e[41]!==D||e[42]!==h||e[43]!==w||e[44]!==S||e[45]!==z||e[46]!==o||e[47]!==b||e[48]!==le?(ee=S?(0,t.jsxs)("div",{className:"flex-1 flex items-center gap-4 px-3 py-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(oe.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0},className:"size-2 rounded-full bg-red-500"}),(0,t.jsx)("span",{className:"text-[15px] font-medium tabular-nums text-red-500",children:G(z)})]}),(0,t.jsx)("div",{className:"flex-1 text-center text-sm text-zinc-500",children:"Recording..."}),(0,t.jsx)("button",{type:"button",onClick:m,className:"p-2 text-zinc-400 hover:text-red-500",children:(0,t.jsx)(ge,{size:20})})]}):d?(0,t.jsxs)("div",{className:"flex-1 flex items-center gap-3 px-3 py-1",children:[(0,t.jsx)("button",{type:"button",onClick:le,className:"size-10 flex items-center justify-center rounded-full bg-[#8774e1] text-white",children:w?(0,t.jsx)(be,{size:16,fill:"currentColor"}):(0,t.jsx)(Ne,{size:20,fill:"currentColor",className:"ml-0.5"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"h-1 bg-zinc-800 rounded-full overflow-hidden",children:(0,t.jsx)(oe.div,{initial:{width:0},animate:{width:w?"100%":"0%"},transition:{duration:z,ease:"linear"},className:"h-full bg-[#8774e1]"})}),(0,t.jsxs)("div",{className:"flex justify-between mt-1",children:[(0,t.jsx)("span",{className:"text-[10px] text-zinc-500",children:"Voice message"}),(0,t.jsx)("span",{className:"text-[10px] text-zinc-500 tabular-nums",children:G(z)})]})]}),(0,t.jsx)("button",{type:"button",onClick:j,className:"p-2 text-zinc-400 hover:text-red-500",children:(0,t.jsx)(ge,{size:20})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(Be,{open:h,onOpenChange:T,children:[(0,t.jsx)(qe,{asChild:!0,children:(0,t.jsx)("button",{type:"button",className:"p-2 text-zinc-400 hover:text-violet-500 dark:text-[#aaaaaa] dark:hover:text-[#8774e1] transition-colors",children:(0,t.jsx)($e,{size:24})})}),(0,t.jsx)(Fe,{className:"p-0 border-none bg-transparent",side:"top",align:"start",children:(0,t.jsx)(He,{onEmojiSelect:R=>c(J=>J+R.emoji)})})]}),(0,t.jsx)("textarea",{ref:b,value:o,onChange:D,onKeyDown:R=>{R.key==="Enter"&&!R.shiftKey&&(R.preventDefault(),P())},placeholder:"Message",className:"flex-1 bg-transparent border-none outline-none text-[16px] resize-none py-2 px-1 text-zinc-900 dark:text-white placeholder:text-zinc-500 dark:placeholder:text-[#aaaaaa] min-h-[40px] max-h-[200px]",rows:1}),(0,t.jsx)("button",{type:"button",onClick:()=>k.current?.click(),className:"p-2 text-zinc-400 hover:text-violet-500 dark:text-[#aaaaaa] dark:hover:text-[#8774e1] transition-colors",children:(0,t.jsx)(Ae,{size:24,className:"-rotate-45"})})]}),e[37]=d,e[38]=m,e[39]=j,e[40]=P,e[41]=D,e[42]=h,e[43]=w,e[44]=S,e[45]=z,e[46]=o,e[47]=b,e[48]=le,e[49]=ee):ee=e[49];let W;e[50]!==B||e[51]!==ee?(W=(0,t.jsx)("div",{className:B,children:ee}),e[50]=B,e[51]=ee,e[52]=W):W=e[52];let K;e[53]!==r.length||e[54]!==d||e[55]!==P||e[56]!==S||e[57]!==C||e[58]!==M||e[59]!==o?(K=o.trim()||r.length>0||d?(0,t.jsx)("button",{onClick:P,className:"size-[50px] shrink-0 flex items-center justify-center rounded-full bg-[#8774e1] text-white shadow-md hover:scale-105 transition-transform",children:(0,t.jsx)(et,{size:24})}):S?(0,t.jsx)("button",{onClick:M,className:"size-[50px] shrink-0 flex items-center justify-center rounded-full bg-red-500 text-white shadow-md hover:scale-105 transition-transform",children:(0,t.jsx)(be,{size:20,fill:"currentColor"})}):(0,t.jsx)("button",{onClick:C,className:"size-[50px] shrink-0 flex items-center justify-center rounded-full bg-zinc-200 dark:bg-[#212121] text-zinc-500 dark:text-[#aaaaaa] shadow-md hover:scale-105 transition-transform",children:(0,t.jsx)(Oe,{size:24})}),e[53]=r.length,e[54]=d,e[55]=P,e[56]=S,e[57]=C,e[58]=M,e[59]=o,e[60]=K):K=e[60];let Y;e[61]!==W||e[62]!==K?(Y=(0,t.jsxs)("div",{className:"flex items-end gap-2 max-w-3xl mx-auto",children:[W,K]}),e[61]=W,e[62]=K,e[63]=Y):Y=e[63];let te;e[64]===Symbol.for("react.memo_cache_sentinel")?(te=(0,t.jsx)("input",{type:"file",ref:k,onChange:ne,className:"hidden",multiple:!0,accept:"image/*,video/*"}),e[64]=te):te=e[64];let se;return e[65]!==H||e[66]!==Y?(se=(0,t.jsxs)("div",{className:"shrink-0 p-2 md:p-3 relative z-20",children:[H,Y,te]}),e[65]=H,e[66]=Y,e[67]=se):se=e[67],se},yt=Nt;function zt(i){return`${Math.floor(i/60)}:${(i%60).toString().padStart(2,"0")}`}var Jt=re(),wt=re(),kt=i=>{const e=(0,wt.c)(10),{reactions:s,currentUser:l,onToggle:x}=i;let n;e[0]!==s?(n=s===void 0?[]:s,e[0]=s,e[1]=n):n=e[1];const u=n;let f;e[2]!==l?.id||e[3]!==u?(f={},u.forEach(r=>{f[r.emoji]||(f[r.emoji]={count:0,me:!1}),f[r.emoji].count=f[r.emoji].count+1,r.user_id===l?.id&&(f[r.emoji].me=!0)}),e[2]=l?.id,e[3]=u,e[4]=f):f=e[4];const o=f;if(u.length===0)return null;let c;e[5]!==o?(c=Object.entries(o),e[5]=o,e[6]=c):c=e[6];let v;return e[7]!==x||e[8]!==c?(v=(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:c.map(r=>{const[N,h]=r;return(0,t.jsxs)("button",{onClick:T=>{T.stopPropagation(),x(N)},className:I("pointer-events-auto flex items-center gap-1 rounded-full border px-1.5 py-0.5 text-[11px] font-bold shadow-sm transition-all hover:scale-110 active:scale-90",h.me?"bg-violet-50 border-violet-200 text-violet-600 dark:bg-violet-900/30 dark:border-violet-800 dark:text-violet-400":"bg-white border-zinc-100 text-zinc-700 dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-300"),children:[(0,t.jsx)("span",{className:"leading-none",children:N}),h.count>1&&(0,t.jsx)("span",{className:"text-[10px] leading-none opacity-80",children:h.count})]},N)})}),e[7]=x,e[8]=c,e[9]=v):v=e[9],v},St=kt,_t=re(),Ct=O.lazy(()=>Te(()=>import("./VoiceMessage-Ha8cKthJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),Mt=i=>{const e=(0,_t.c)(98),{msg:s,isMe:l,isLastInGroup:x,setReplyingTo:n,handleImageClick:u,handleVoiceMessage:f,onDeleteMessage:o,setEditingMessage:c,onToggleReaction:v,currentUser:r}=i,N=_e(0);let h,T;e[0]===Symbol.for("react.memo_cache_sentinel")?(h=[0,-60],T=[0,1],e[0]=h,e[1]=T):(h=e[0],T=e[1]);const k=pe(N,h,T);let a,b;e[2]===Symbol.for("react.memo_cache_sentinel")?(a=[0,-60],b=[.5,1.1],e[2]=a,e[3]=b):(a=e[2],b=e[3]);const _=pe(N,a,b);let y;e[4]!==s||e[5]!==n?(y=(U,ce)=>{ce.offset.x<-60&&(n(s),window.navigator.vibrate&&window.navigator.vibrate(10))},e[4]=s,e[5]=n,e[6]=y):y=e[6];const S=y,z=`msg-${s.id}`;let C,M;e[7]===Symbol.for("react.memo_cache_sentinel")?(C={opacity:0,y:5},M={opacity:1,y:0},e[7]=C,e[8]=M):(C=e[7],M=e[8]);const m=l?"justify-end":"justify-start",d=x&&"mb-3";let g;e[9]!==d||e[10]!==m?(g=I("flex w-full group relative overflow-visible",m,d),e[9]=d,e[10]=m,e[11]=g):g=e[11];let j;e[12]!==k||e[13]!==_?(j={opacity:k,scale:_,right:10},e[12]=k,e[13]=_,e[14]=j):j=e[14];let w;e[15]===Symbol.for("react.memo_cache_sentinel")?(w=(0,t.jsx)(fe,{size:20}),e[15]=w):w=e[15];let $;e[16]!==j?($=(0,t.jsx)(oe.div,{style:j,className:"absolute top-1/2 -translate-y-1/2 flex items-center justify-center size-10 rounded-full bg-violet-500/10 text-violet-500 z-0 pointer-events-none",children:w}),e[16]=j,e[17]=$):$=e[17];let p;e[18]===Symbol.for("react.memo_cache_sentinel")?(p={left:-80,right:0},e[18]=p):p=e[18];let G;e[19]!==N?(G={x:N},e[19]=N,e[20]=G):G=e[20];const L=l?"flex-row-reverse":"flex-row";let A;e[21]!==L?(A=I("flex max-w-[85%] md:max-w-[70%] items-end gap-1.5 z-10 touch-pan-y",L),e[21]=L,e[22]=A):A=e[22];const D=l?"items-end":"items-start";let E;e[23]!==D?(E=I("relative flex flex-col min-w-[60px]",D),e[23]=D,e[24]=E):E=e[24];const P=l?"bg-[#8774e1] text-white border border-[#7059d0]":"bg-white text-zinc-900 dark:bg-[#212121] dark:text-white",V=s.isOptimistic&&"opacity-60 grayscale-[0.5]";let le;e[25]!==P||e[26]!==V?(le=I("relative px-3 py-1.5 shadow-sm text-[15px] leading-[1.4] transition-all",P,"rounded-[15px]",V),e[25]=P,e[26]=V,e[27]=le):le=e[27];let X;e[28]!==r?.name||e[29]!==l||e[30]!==s.replyTo?(X=s.replyTo&&(0,t.jsxs)("div",{className:I("mb-1.5 -mx-1 px-2.5 py-1.5 rounded-xl text-xs border-l-2 cursor-pointer transition-all hover:opacity-80",l?"bg-black/10 border-white/40 text-white/90":"bg-zinc-100 border-zinc-300 text-zinc-600 dark:bg-zinc-800 dark:border-zinc-600 dark:text-zinc-300"),onClick:U=>{U.stopPropagation();const ce=document.getElementById(`msg-${s.replyTo.id}`);ce&&ce.scrollIntoView({behavior:"smooth",block:"center"})},children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 mb-0.5 opacity-75",children:[(0,t.jsx)(fe,{size:12}),(0,t.jsx)("span",{className:"font-bold truncate",children:s.replyTo.senderName===r?.name?"You":s.replyTo.senderName})]}),(0,t.jsx)("div",{className:"truncate opacity-90 text-[11px]",children:s.replyTo.text})]}),e[28]=r?.name,e[29]=l,e[30]=s.replyTo,e[31]=X):X=e[31];let Z;e[32]!==u||e[33]!==s?(Z=s.media?.length>0&&s.type!=="voice"&&(0,t.jsx)("div",{className:I("relative -mx-3 overflow-hidden shadow-sm",!s.replyTo&&"-mt-1.5",!s.text&&"-mb-1.5",s.text&&"mb-1.5","rounded-[15px]"),children:s.media.map((U,ce)=>(0,t.jsx)("div",{className:"relative group/media min-w-[280px] md:min-w-[400px]",children:s.type==="video"?(0,t.jsx)("div",{className:"aspect-video w-full bg-black",children:(0,t.jsx)(it,{src:U.url,poster:U.poster})}):(0,t.jsx)("img",{src:U.url,className:"max-h-[400px] md:max-h-[500px] w-full object-cover cursor-pointer hover:brightness-95 transition-all",onClick:()=>u(s)})},ce))}),e[32]=u,e[33]=s,e[34]=Z):Z=e[34];let Q;e[35]!==f||e[36]!==l||e[37]!==s.media||e[38]!==s.type?(Q=s.type==="voice"&&s.media?.[0]&&(0,t.jsx)(O.Suspense,{fallback:(0,t.jsx)("div",{className:"h-12 w-48 animate-pulse bg-zinc-100 dark:bg-zinc-800 rounded-xl"}),children:f(s.media[0].url,s.media[0].duration,l)}),e[35]=f,e[36]=l,e[37]=s.media,e[38]=s.type,e[39]=Q):Q=e[39];let ne;e[40]!==s.text||e[41]!==s.type?(ne=s.text&&s.type!=="voice"&&(0,t.jsx)("div",{className:"whitespace-pre-wrap break-words pr-12",children:(0,t.jsx)(lt,{options:{...at,className:"underline"},children:s.text})}),e[40]=s.text,e[41]=s.type,e[42]=ne):ne=e[42];let F;e[43]!==l||e[44]!==s.isOptimistic||e[45]!==s.isRead||e[46]!==s.text||e[47]!==s.time||e[48]!==s.type?(F=(s.text||s.type==="voice")&&(0,t.jsxs)("div",{className:I("absolute bottom-1 right-1.5 flex items-center gap-0.5 select-none",l?"text-white/70":"text-[#aaaaaa]"),children:[(0,t.jsx)("span",{className:"text-[10px]",children:s.isOptimistic?"sending...":s.time}),l&&!s.isOptimistic&&(s.isRead?(0,t.jsx)(Ue,{size:13,className:"text-white"}):(0,t.jsx)(Ee,{size:13,className:"text-white/60"}))]}),e[43]=l,e[44]=s.isOptimistic,e[45]=s.isRead,e[46]=s.text,e[47]=s.time,e[48]=s.type,e[49]=F):F=e[49];let q;e[50]!==le||e[51]!==X||e[52]!==Z||e[53]!==Q||e[54]!==ne||e[55]!==F?(q=(0,t.jsx)(Ye,{children:(0,t.jsxs)("div",{className:le,children:[X,Z,Q,ne,F]})}),e[50]=le,e[51]=X,e[52]=Z,e[53]=Q,e[54]=ne,e[55]=F,e[56]=q):q=e[56];let H;e[57]!==s||e[58]!==n?(H=(0,t.jsx)(de,{onSelect:()=>n(s),children:"Reply"}),e[57]=s,e[58]=n,e[59]=H):H=e[59];let ae;e[60]!==s.text?(ae=(0,t.jsx)(de,{onSelect:()=>navigator.clipboard.writeText(s.text),children:"Copy"}),e[60]=s.text,e[61]=ae):ae=e[61];let B;e[62]!==l||e[63]!==s||e[64]!==c?(B=l&&(0,t.jsx)(de,{onSelect:()=>c(s),children:"Edit"}),e[62]=l,e[63]=s,e[64]=c,e[65]=B):B=e[65];let ee;e[66]===Symbol.for("react.memo_cache_sentinel")?(ee=(0,t.jsx)(Ke,{}),e[66]=ee):ee=e[66];let W;e[67]!==s.id||e[68]!==o?(W=(0,t.jsx)(de,{onSelect:()=>o?.(s.id),className:"text-red-500",children:"Delete"}),e[67]=s.id,e[68]=o,e[69]=W):W=e[69];let K;e[70]!==H||e[71]!==ae||e[72]!==B||e[73]!==W?(K=(0,t.jsxs)(Xe,{children:[H,ae,B,ee,W]}),e[70]=H,e[71]=ae,e[72]=B,e[73]=W,e[74]=K):K=e[74];let Y;e[75]!==q||e[76]!==K?(Y=(0,t.jsxs)(We,{children:[q,K]}),e[75]=q,e[76]=K,e[77]=Y):Y=e[77];let te;e[78]!==r||e[79]!==l||e[80]!==s.id||e[81]!==s.reactions||e[82]!==v?(te=s.reactions&&s.reactions.length>0&&(0,t.jsx)("div",{className:I("mt-1",l?"mr-1":"ml-1"),children:(0,t.jsx)(St,{reactions:s.reactions,currentUser:r,onToggle:U=>v?.(s.id,U)})}),e[78]=r,e[79]=l,e[80]=s.id,e[81]=s.reactions,e[82]=v,e[83]=te):te=e[83];let se;e[84]!==E||e[85]!==Y||e[86]!==te?(se=(0,t.jsxs)("div",{className:E,children:[Y,te]}),e[84]=E,e[85]=Y,e[86]=te,e[87]=se):se=e[87];let R;e[88]!==S||e[89]!==G||e[90]!==A||e[91]!==se?(R=(0,t.jsx)(oe.div,{drag:"x",dragConstraints:p,dragElastic:.4,onDragEnd:S,style:G,className:A,children:se}),e[88]=S,e[89]=G,e[90]=A,e[91]=se,e[92]=R):R=e[92];let J;return e[93]!==g||e[94]!==$||e[95]!==R||e[96]!==z?(J=(0,t.jsxs)(oe.div,{id:z,initial:C,animate:M,className:g,children:[$,R]}),e[93]=g,e[94]=$,e[95]=R,e[96]=z,e[97]=J):J=e[97],J},Tt=({conversation:i,messages:e,currentUser:s,onBack:l,onSendMessage:x,onEditMessage:n,onDeleteMessage:u,onToggleReaction:f,onTyping:o,isLoading:c,isTyping:v,isOnline:r})=>{const{openLightbox:N}=tt(),[h,T]=(0,O.useState)(null),[k,a]=(0,O.useState)(null),[b,_]=(0,O.useState)(!1),y=(0,O.useRef)(null);(0,O.useEffect)(()=>{y.current&&(y.current.scrollTop=y.current.scrollHeight)},[e,v,h,k]);const S=async(m,d,g,j)=>{if(k){n?.(k.id,m),a(null);return}if(g&&j){try{const p=await ye(new File([g],`voice-message-${Date.now()}.webm`,{type:g.type}));x(i.id,"Voice message","voice",[{url:p.url,duration:j}],h?.id)}catch(p){console.error("Failed to send voice message:",p)}return}let w=[];if(d.length>0)try{w=await Promise.all(d.map(p=>ye(p)))}catch(p){console.error("Upload failed:",p);return}const $=w.length>0?w[0].type==="video"?"video":"image":"text";x(i.id,m,$,w,h?.id),T(null)},z=m=>{!m.media||m.media.length===0||N(m.media.map(d=>d.url),0)},C=(m,d)=>m===e.length-1?!1:e[m+1].sender===d.sender,M=(m,d,g)=>(0,t.jsx)(Ct,{url:m,duration:d,isMe:g});return(0,t.jsxs)("div",{className:"relative flex h-full w-full flex-col overflow-hidden bg-[#8774e1]/10 dark:bg-[#0f0f0f] md:border-l md:border-zinc-200/50 dark:md:border-zinc-800/50",children:[(0,t.jsx)("div",{className:"absolute inset-0 z-0 opacity-[0.03] dark:opacity-[0.05] pointer-events-none",style:{backgroundImage:'url("https://web.telegram.org/a/chat-bg-pattern-light.63857502396e95c469b6.png")',backgroundSize:"400px"}}),(0,t.jsx)(gt,{conversation:i,isOnline:r,onBack:l,onOpenSettings:()=>_(!0)}),(0,t.jsx)("div",{className:"flex-1 min-h-0 overflow-hidden relative z-10",children:(0,t.jsx)("div",{className:"h-full overflow-y-auto px-2 md:px-12 py-4 no-scrollbar",ref:y,children:(0,t.jsxs)("div",{className:"flex flex-col min-h-full justify-end max-w-3xl mx-auto",children:[c&&e.length===0?(0,t.jsx)("div",{className:"flex justify-center p-8",children:(0,t.jsx)(ft,{})}):(0,t.jsx)("div",{className:"flex flex-col gap-[2px]",children:e.map((m,d)=>(0,t.jsx)(Mt,{msg:m,isMe:m.sender==="me",isLastInGroup:!C(d,m),setReplyingTo:T,handleImageClick:z,handleVoiceMessage:M,onDeleteMessage:u,setEditingMessage:a,onToggleReaction:f,currentUser:s},m.id))}),v&&(0,t.jsx)("div",{className:"flex items-center gap-2 mt-1 ml-1",children:(0,t.jsx)("div",{className:"bg-white dark:bg-[#212121] px-4 py-2 rounded-[15px] rounded-tl-[2px] shadow-sm",children:(0,t.jsx)(st,{})})})]})})}),(0,t.jsx)(yt,{onSendMessage:S,onTyping:o,replyingTo:h,setReplyingTo:T,editingMessage:k,setEditingMessage:a}),i.isGroup?(0,t.jsx)(Je,{isOpen:b,onClose:()=>_(!1),conversation:i,onUpdate:()=>{_(!1)}}):(0,t.jsx)(Qe,{isOpen:b,onClose:()=>_(!1),user:i.user,conversationId:i.id})]})},Rt=Tt,$t=re();function Gt(){const i=(0,$t.c)(1);let e;return i[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,t.jsx)("div",{className:"flex flex-col",children:[1,2,3,4,5,6].map(Ot)}),i[0]=e):e=i[0],e}function Ot(i){return(0,t.jsxs)("div",{className:"flex items-center gap-3 p-4 border-b border-zinc-50 dark:border-zinc-900",children:[(0,t.jsx)(ie,{className:"h-12 w-12 rounded-full"}),(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)(ie,{className:"h-4 w-24 rounded"}),(0,t.jsx)(ie,{className:"h-3 w-12 rounded"})]}),(0,t.jsx)(ie,{className:"h-3 w-32 rounded"})]})]},i)}var It=re(),At=()=>{const i=(0,It.c)(33),{id:e,currentUser:s,onlineUsers:l,msgSearchQuery:x,setMsgSearchQuery:n,userSearchResults:u,filteredConversations:f,selectedConversation:o,localMessages:c,isConvLoading:v,isMsgLoading:r,currentIsTyping:N,otherUserIsOnline:h,handleStartConversation:T,handleSelectConversation:k,sendMessage:a,editMessage:b,onDeleteMessage:_,onToggleReaction:y,sendTypingStatus:S,typingStatus:z,navigate:C}=rt();if(!s){let p;i[0]===Symbol.for("react.memo_cache_sentinel")?(p=(0,t.jsx)("div",{className:"rounded-3xl bg-zinc-50 p-6 dark:bg-zinc-900",children:(0,t.jsx)(Ge,{size:48,className:"text-zinc-300 dark:text-zinc-600"})}),i[0]=p):p=i[0];let G;return i[1]===Symbol.for("react.memo_cache_sentinel")?(G=(0,t.jsxs)("div",{className:"flex h-[100dvh] flex-col items-center justify-center gap-6 border-zinc-100 bg-white p-8 text-center dark:border-zinc-800 dark:bg-black md:h-[calc(100vh-1.5rem)] md:rounded-2xl md:border",children:[p,(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h3",{className:"text-2xl font-black tracking-tight dark:text-white",children:"Sign in to message"}),(0,t.jsx)("p",{className:"max-w-xs text-zinc-500 font-medium",children:"Join the conversation. Sign up or log in to start chatting."})]})]}),i[1]=G):G=i[1],G}if(v){let p;return i[2]===Symbol.for("react.memo_cache_sentinel")?(p=(0,t.jsx)("div",{className:"flex h-[100dvh] pt-4 md:h-[calc(100vh-1.5rem)] md:rounded-2xl border-zinc-100 bg-white dark:border-zinc-800 dark:bg-black md:border",children:(0,t.jsx)("div",{className:"w-full md:w-[420px]",children:(0,t.jsx)(Gt,{})})}),i[2]=p):p=i[2],p}const M=`flex ${e?"h-[100dvh]":"h-[calc(100dvh-4rem)]"} w-full max-w-full box-border overscroll-none overflow-x-hidden overflow-y-hidden bg-white shadow-2xl shadow-zinc-200/50 dark:border-zinc-800 dark:bg-[#0f0f0f] dark:shadow-none md:h-[calc(100vh-1.5rem)] md:rounded-3xl md:border md:border-zinc-200/50`,m=`flex-col md:flex md:w-[420px] ${o?"hidden":"flex"} h-full min-h-0 min-w-0 flex-1 md:flex-none bg-white dark:bg-[#0f0f0f] border-r border-zinc-100 dark:border-zinc-800 z-10`,d=e??null;let g;i[3]!==f||i[4]!==k||i[5]!==T||i[6]!==x||i[7]!==l||i[8]!==n||i[9]!==d||i[10]!==z||i[11]!==u?(g=(0,t.jsx)(mt,{conversations:f,userResults:u,onSelect:k,onStartNew:T,selectedId:d,searchQuery:x,onSearchChange:n,onlineUsers:l,typingStatus:z}),i[3]=f,i[4]=k,i[5]=T,i[6]=x,i[7]=l,i[8]=n,i[9]=d,i[10]=z,i[11]=u,i[12]=g):g=i[12];let j;i[13]!==m||i[14]!==g?(j=(0,t.jsx)("div",{className:m,children:g}),i[13]=m,i[14]=g,i[15]=j):j=i[15];let w;i[16]!==N||i[17]!==s||i[18]!==b||i[19]!==r||i[20]!==c||i[21]!==C||i[22]!==_||i[23]!==y||i[24]!==h||i[25]!==o||i[26]!==a||i[27]!==S?(w=o?(0,t.jsx)(Rt,{conversation:o,messages:c,currentUser:s,onBack:()=>C("/m"),onSendMessage:a,onEditMessage:b,onDeleteMessage:_,onToggleReaction:y,onTyping:p=>S(o.id,p),isLoading:r,isTyping:!!N,isOnline:!!h}):(0,t.jsxs)("div",{className:"hidden flex-1 flex-col items-center justify-center gap-6 text-zinc-500 md:flex bg-zinc-50/30 dark:bg-zinc-900/10",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute -inset-10 rounded-full bg-violet-500/5 blur-3xl dark:bg-violet-500/10"}),(0,t.jsx)("div",{className:"relative rounded-[2.5rem] bg-white p-10 shadow-xl shadow-zinc-200/50 dark:bg-zinc-900/50 dark:shadow-none ring-1 ring-zinc-100 dark:ring-zinc-800",children:(0,t.jsx)(De,{size:80,className:"text-violet-500 stroke-[1.5]"})})]}),(0,t.jsxs)("div",{className:"text-center max-w-sm px-4 space-y-3",children:[(0,t.jsx)("h3",{className:"text-3xl font-black tracking-tighter text-zinc-900 dark:text-white",children:"Your Messages"}),(0,t.jsx)("p",{className:"text-zinc-500 font-medium text-lg",children:"Send private photos and messages to a friend or group."})]})]}),i[16]=N,i[17]=s,i[18]=b,i[19]=r,i[20]=c,i[21]=C,i[22]=_,i[23]=y,i[24]=h,i[25]=o,i[26]=a,i[27]=S,i[28]=w):w=i[28];let $;return i[29]!==M||i[30]!==j||i[31]!==w?($=(0,t.jsxs)("div",{className:M,children:[j,w]}),i[29]=M,i[30]=j,i[31]=w,i[32]=$):$=i[32],$},Xt=At;export{Xt as default};
