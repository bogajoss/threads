import{a as ue}from"./rolldown-runtime-BaZ8gS7u.js";import{E as fe,S as ce,b as U,c as X,x as ie}from"./framework-CsA6nn9m.js";import{a as te,n as se,r as ee,t as Z}from"./query-QyXblnmD.js";import{Bt as de,Ct as me,Dt as ge,Et as he,Ft as ye,Gt as pe,Jt as Pe,Lt as ve,Nt as we,Ot as be,Pt as _e,Rt as Ce,St as Me,Tt as $e,Ut as Se,Vt as Re,Wt as ke,Xt as Le,Yt as Ne,Zt as Fe,_t as ne,an as oe,bt as I,gt as qe,in as Y,jt as xe,kt as De,nn as ae,s as Ee,vt as Te,wt as Qe,yt as Ke,zt as Ae}from"./index-d64rCz7a.js";var Oe=X();const Be=(e,i,n)=>{const s=(0,Oe.c)(16);let t,a;s[0]!==i||s[1]!==e?(t=["follows",i,e],a=v=>{const{pageParam:M}=v;return(i==="Followers"?Pe:Ne)(e,M,10)},s[0]=i,s[1]=e,s[2]=t,s[3]=a):(t=s[2],a=s[3]);const o=!!e&&n;let h;s[4]!==t||s[5]!==a||s[6]!==o?(h={queryKey:t,queryFn:a,initialPageParam:null,getNextPageParam:je,enabled:o},s[4]=t,s[5]=a,s[6]=o,s[7]=h):h=s[7];const{data:d,fetchNextPage:m,hasNextPage:u,isFetchingNextPage:l,isLoading:w}=Z(h);let P;s[8]!==d?.pages?(P=d?.pages.flatMap(Je)||[],s[8]=d?.pages,s[9]=P):P=s[9];const p=P;let f;return s[10]!==m||s[11]!==p||s[12]!==u||s[13]!==l||s[14]!==w?(f={followList:p,fetchNextPage:m,hasNextPage:u,isFetchingNextPage:l,isLoading:w},s[10]=m,s[11]=p,s[12]=u,s[13]=l,s[14]=w,s[15]=f):f=s[15],f};function je(e){if(!(!e||e.length<10))return e[e.length-1].followed_at}function Je(e){return e}var ze=X(),E=ue(fe(),1);const xt=(e,i,n,s)=>{const t=(0,ze.c)(92),a=te();let o;t[0]!==i?(o=i||{comments:0,likes:0,mirrors:0,reposts:0},t[0]=i,t[1]=o):o=t[1];const[h,d]=(0,E.useState)(o);let m,u;t[2]!==i?(m=()=>{i&&d(D=>({...D,...i}))},u=[i],t[2]=i,t[3]=m,t[4]=u):(m=t[3],u=t[4]),(0,E.useEffect)(m,u);const l=n?.id;let w;t[5]!==e||t[6]!==l?(w=["post",e,"liked",l],t[5]=e,t[6]=l,t[7]=w):w=t[7];let P;t[8]!==n?.id||t[9]!==e?(P=()=>_e(e,n?.id),t[8]=n?.id,t[9]=e,t[10]=P):P=t[10];let p;t[11]!==n||t[12]!==e?(p=!!n&&Y(e)&&Y(n.id),t[11]=n,t[12]=e,t[13]=p):p=t[13];let f;t[14]!==w||t[15]!==P||t[16]!==p?(f={queryKey:w,queryFn:P,enabled:p,staleTime:6e5},t[14]=w,t[15]=P,t[16]=p,t[17]=f):f=t[17];const{data:v}=ee(f),M=v===void 0?!1:v,C=n?.id;let _;t[18]!==e||t[19]!==C?(_=["post",e,"reposted",C],t[18]=e,t[19]=C,t[20]=_):_=t[20];let r;t[21]!==n?.id||t[22]!==e?(r=()=>ye(e,n?.id),t[21]=n?.id,t[22]=e,t[23]=r):r=t[23];let c;t[24]!==n||t[25]!==e?(c=!!n&&Y(e)&&Y(n.id),t[24]=n,t[25]=e,t[26]=c):c=t[26];let g;t[27]!==_||t[28]!==r||t[29]!==c?(g={queryKey:_,queryFn:r,enabled:c,staleTime:6e5},t[27]=_,t[28]=r,t[29]=c,t[30]=g):g=t[30];const{data:y}=ee(g),b=y===void 0?!1:y;let $;t[31]!==n?.id||t[32]!==e?($=()=>ke(e,n?.id),t[31]=n?.id,t[32]=e,t[33]=$):$=t[33];let T;t[34]!==n?.id||t[35]!==e||t[36]!==a?(T=async()=>{await a.cancelQueries({queryKey:["post",e,"liked",n?.id]});const D=a.getQueryData(["post",e,"liked",n?.id]);return a.setQueryData(["post",e,"liked",n?.id],!D),d(B=>({...B,likes:D?(B.likes||0)-1:(B.likes||0)+1})),{previousLiked:D}},t[34]=n?.id,t[35]=e,t[36]=a,t[37]=T):T=t[37];let q;t[38]!==n?.id||t[39]!==e||t[40]!==a||t[41]!==s?(q=(D,B,S)=>{S?.previousLiked!==void 0&&(a.setQueryData(["post",e,"liked",n?.id],S.previousLiked),d(k=>({...k,likes:S.previousLiked?(k.likes||0)+1:(k.likes||0)-1}))),s("Failed to update like","error")},t[38]=n?.id,t[39]=e,t[40]=a,t[41]=s,t[42]=q):q=t[42];let L;t[43]!==n?.id||t[44]!==e||t[45]!==a?(L=()=>{a.invalidateQueries({queryKey:["post",e,"liked",n?.id]})},t[43]=n?.id,t[44]=e,t[45]=a,t[46]=L):L=t[46];let A;t[47]!==$||t[48]!==T||t[49]!==q||t[50]!==L?(A={mutationFn:$,onMutate:T,onError:q,onSettled:L},t[47]=$,t[48]=T,t[49]=q,t[50]=L,t[51]=A):A=t[51];const K=se(A);let Q;t[52]!==n?.id||t[53]!==e?(Q=()=>pe(e,n?.id),t[52]=n?.id,t[53]=e,t[54]=Q):Q=t[54];let R;t[55]!==n?.id||t[56]!==e||t[57]!==a?(R=async()=>{await a.cancelQueries({queryKey:["post",e,"reposted",n?.id]});const D=a.getQueryData(["post",e,"reposted",n?.id]);return a.setQueryData(["post",e,"reposted",n?.id],!D),d(B=>({...B,reposts:D?(B.reposts||0)-1:(B.reposts||0)+1,mirrors:D?(B.mirrors||0)-1:(B.mirrors||0)+1})),{previousReposted:D}},t[55]=n?.id,t[56]=e,t[57]=a,t[58]=R):R=t[58];let x;t[59]!==n?.id||t[60]!==e||t[61]!==a||t[62]!==s?(x=(D,B,S)=>{S?.previousReposted!==void 0&&(a.setQueryData(["post",e,"reposted",n?.id],S.previousReposted),d(k=>({...k,reposts:S.previousReposted?(k.reposts||0)+1:(k.reposts||0)-1,mirrors:S.previousReposted?(k.mirrors||0)+1:(k.mirrors||0)-1}))),s("Failed to update repost","error")},t[59]=n?.id,t[60]=e,t[61]=a,t[62]=s,t[63]=x):x=t[63];let N;t[64]!==n?.id||t[65]!==e||t[66]!==a?(N=()=>{a.invalidateQueries({queryKey:["post",e,"reposted",n?.id]})},t[64]=n?.id,t[65]=e,t[66]=a,t[67]=N):N=t[67];let z;t[68]!==s?(z=D=>{s(D?"Reposted!":"Removed repost")},t[68]=s,t[69]=z):z=t[69];let j;t[70]!==Q||t[71]!==R||t[72]!==x||t[73]!==N||t[74]!==z?(j={mutationFn:Q,onMutate:R,onError:x,onSettled:N,onSuccess:z},t[70]=Q,t[71]=R,t[72]=x,t[73]=N,t[74]=z,t[75]=j):j=t[75];const V=se(j);let J;t[76]!==n||t[77]!==K||t[78]!==e||t[79]!==s?(J=async D=>{if(D&&D.stopPropagation(),!n)return s("Please login to like!","error");!Y(e)||!Y(n.id)||K.mutate()},t[76]=n,t[77]=K,t[78]=e,t[79]=s,t[80]=J):J=t[80];const O=J;let F;t[81]!==n||t[82]!==e||t[83]!==V||t[84]!==s?(F=async D=>{if(D&&D.stopPropagation(),!n)return s("Please login to repost!","error");!Y(e)||!Y(n.id)||V.mutate()},t[81]=n,t[82]=e,t[83]=V,t[84]=s,t[85]=F):F=t[85];const H=F;let G;return t[86]!==O||t[87]!==H||t[88]!==M||t[89]!==b||t[90]!==h?(G={liked:M,reposted:b,localStats:h,setLocalStats:d,handleLike:O,handleRepost:H},t[86]=O,t[87]=H,t[88]=M,t[89]=b,t[90]=h,t[91]=G):G=t[91],G};var Ve=X();const Dt=e=>{const i=(0,Ve.c)(5);let n;i[0]!==e?(n=()=>ae(e),i[0]=e,i[1]=n):n=i[1];const[s,t]=(0,E.useState)(n);let a,o;return i[2]!==e?(a=()=>{if(!e)return;const h=setTimeout(()=>{t(ae(e))},0),d=setInterval(()=>{t(ae(e))},6e4);return()=>{clearTimeout(h),clearInterval(d)}},o=[e],i[2]=e,i[3]=a,i[4]=o):(a=i[3],o=i[4]),(0,E.useEffect)(a,o),s};var He=X();const Et=()=>{const e=(0,He.c)(27),[i,n]=(0,E.useState)(!1),[s,t]=(0,E.useState)(!1),[a,o]=(0,E.useState)(0),[h,d]=(0,E.useState)(null),[m,u]=(0,E.useState)(null),l=(0,E.useRef)(null),w=(0,E.useRef)(null);let P;e[0]===Symbol.for("react.memo_cache_sentinel")?(P=[],e[0]=P):P=e[0];const p=(0,E.useRef)(P);let f;e[1]===Symbol.for("react.memo_cache_sentinel")?(f=()=>{w.current=window.setInterval(()=>{o(Ge)},1e3)},e[1]=f):f=e[1];const v=f;let M;e[2]===Symbol.for("react.memo_cache_sentinel")?(M=()=>{w.current&&(clearInterval(w.current),w.current=null)},e[2]=M):M=e[2];const C=M;let _;e[3]===Symbol.for("react.memo_cache_sentinel")?(_=async()=>{try{const R=await navigator.mediaDevices.getUserMedia({audio:!0}),x=new MediaRecorder(R);l.current=x,p.current=[],x.ondataavailable=N=>{N.data.size>0&&p.current.push(N.data)},x.onstop=()=>{const N=new Blob(p.current,{type:"audio/webm;codecs=opus"}),z=URL.createObjectURL(N);d(N),u(z),R.getTracks().forEach(Xe)},x.start(),n(!0),t(!1),o(0),v()}catch(R){const x=R;throw console.error("Error accessing microphone:",x),x}},e[3]=_):_=e[3];const r=_;let c;e[4]!==i?(c=()=>{l.current&&i&&(l.current.stop(),n(!1),t(!1),C())},e[4]=i,e[5]=c):c=e[5];const g=c;let y;e[6]!==s||e[7]!==i?(y=()=>{l.current&&i&&!s&&(l.current.pause(),t(!0),C())},e[6]=s,e[7]=i,e[8]=y):y=e[8];const b=y;let $;e[9]!==s||e[10]!==i?($=()=>{l.current&&i&&s&&(l.current.resume(),t(!1),v())},e[9]=s,e[10]=i,e[11]=$):$=e[11];const T=$;let q;e[12]!==i?(q=()=>{l.current&&i&&(l.current.stop(),l.current.onstop=null,n(!1),t(!1),C(),o(0),l.current.stream&&l.current.stream.getTracks().forEach(We))},e[12]=i,e[13]=q):q=e[13];const L=q;let A;e[14]!==m?(A=()=>{m&&URL.revokeObjectURL(m),d(null),u(null),o(0)},e[14]=m,e[15]=A):A=e[15];const K=A;let Q;return e[16]!==h||e[17]!==m||e[18]!==L||e[19]!==K||e[20]!==s||e[21]!==i||e[22]!==b||e[23]!==a||e[24]!==T||e[25]!==g?(Q={isRecording:i,isPaused:s,recordingTime:a,startRecording:r,stopRecording:g,pauseRecording:b,resumeRecording:T,cancelRecording:L,audioBlob:h,audioUrl:m,clearAudio:K},e[16]=h,e[17]=m,e[18]=L,e[19]=K,e[20]=s,e[21]=i,e[22]=b,e[23]=a,e[24]=T,e[25]=g,e[26]=Q):Q=e[26],Q};function Ge(e){return e+1}function Xe(e){return e.stop()}function We(e){return e.stop()}var Ye=X();const Tt=(e,i,n)=>{const s=(0,Ye.c)(31),t=te();let a,o;s[0]!==n||s[1]!==e?(a=["comments",e,n],o=y=>{const{pageParam:b}=y;return ve(e,b,10,n)},s[0]=n,s[1]=e,s[2]=a,s[3]=o):(a=s[2],o=s[3]);let h;s[4]!==i?(h=i?{pages:[i],pageParams:[null]}:void 0,s[4]=i,s[5]=h):h=s[5];const d=!!e;let m;s[6]!==a||s[7]!==o||s[8]!==h||s[9]!==d?(m={queryKey:a,queryFn:o,initialPageParam:null,getNextPageParam:Ze,initialData:h,enabled:d},s[6]=a,s[7]=o,s[8]=h,s[9]=d,s[10]=m):m=s[10];const{data:u,fetchNextPage:l,hasNextPage:w,isFetchingNextPage:P,isLoading:p,refetch:f}=Z(m);let v;s[11]!==u?.pages?(v=u?.pages.flatMap(Ue)||[],s[11]=u?.pages,s[12]=v):v=s[12];const M=v;let C;s[13]!==e?(C=y=>{const{userId:b,content:$,media:T,replyToId:q}=y;return we(e,b,$,T,q)},s[13]=e,s[14]=C):C=s[14];let _;s[15]!==n||s[16]!==e||s[17]!==t?(_=()=>{t.invalidateQueries({queryKey:["comments",e]}),n&&t.invalidateQueries({queryKey:["comments",e,n]})},s[15]=n,s[16]=e,s[17]=t,s[18]=_):_=s[18];let r;s[19]!==C||s[20]!==_?(r={mutationFn:C,onSuccess:_},s[19]=C,s[20]=_,s[21]=r):r=s[21];const c=se(r);let g;return s[22]!==c.isPending||s[23]!==c.mutateAsync||s[24]!==M||s[25]!==l||s[26]!==w||s[27]!==P||s[28]!==p||s[29]!==f?(g={comments:M,fetchNextPage:l,hasNextPage:w,isFetchingNextPage:P,isLoading:p,refetch:f,addComment:c.mutateAsync,isSubmitting:c.isPending},s[22]=c.isPending,s[23]=c.mutateAsync,s[24]=M,s[25]=l,s[26]=w,s[27]=P,s[28]=p,s[29]=f,s[30]=g):g=s[30],g};function Ze(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Ue(e){return e}var Ie=X();const Qt=()=>{const e=(0,Ie.c)(53),{handle:i}=ie(),n=U(),{currentUser:s}=I(),{addToast:t}=ne();let a,o;e[0]!==i?(a=["profile",i],o=()=>Le(i),e[0]=i,e[1]=a,e[2]=o):(a=e[1],o=e[2]);const h=!!i;let d;e[3]!==a||e[4]!==o||e[5]!==h?(d={queryKey:a,queryFn:o,enabled:h,staleTime:3e5},e[3]=a,e[4]=o,e[5]=h,e[6]=d):d=e[6];const{data:m,isLoading:u}=ee(d),[l,w]=(0,E.useState)("feed"),P=m?.id;let p;e[7]!==P?(p=["posts","user",P],e[7]=P,e[8]=p):p=e[8];let f;e[9]!==m?.id?(f=S=>{const{pageParam:k}=S;return de(m?.id,k,10)},e[9]=m?.id,e[10]=f):f=e[10];const v=!!m?.id;let M;e[11]!==p||e[12]!==f||e[13]!==v?(M={queryKey:p,queryFn:f,enabled:v,initialPageParam:null,getNextPageParam:et},e[11]=p,e[12]=f,e[13]=v,e[14]=M):M=e[14];const{data:C,fetchNextPage:_,hasNextPage:r,isFetchingNextPage:c,isLoading:g}=Z(M);let y;e[15]!==C?.pages?(y=C?.pages.flatMap(tt)||[],e[15]=C?.pages,e[16]=y):y=e[16];const b=y,[$,T]=(0,E.useState)(!1),[q,L]=(0,E.useState)("Followers"),{followList:A,fetchNextPage:K,hasNextPage:Q,isFetchingNextPage:R,isLoading:x}=Be(m?.id,q,$);let N;e[17]===Symbol.for("react.memo_cache_sentinel")?(N=S=>{L(S),T(!0)},e[17]=N):N=e[17];const z=N;let j;e:{if(l==="feed"){let S;e[18]!==b?(S=b.filter(st),e[18]=b,e[19]=S):S=e[19],j=S;break e}if(l==="media"){let S;e[20]!==b?(S=b.filter(it),e[20]=b,e[21]=S):S=e[21],j=S;break e}if(l==="collections"){let S;e[22]===Symbol.for("react.memo_cache_sentinel")?(S=[],e[22]=S):S=e[22],j=S;break e}j=b}const V=j;let J;e[23]!==n?(J=S=>{n(`/post/${S}`)},e[23]=n,e[24]=J):J=e[24];const O=J;let F;e[25]!==i||e[26]!==n?(F=S=>{S!==i&&n(`/u/${S}`)},e[25]=i,e[26]=n,e[27]=F):F=e[27];const H=F;let G;e[28]!==_?(G=S=>{_()},e[28]=_,e[29]=G):G=e[29];const D=G;let B;return e[30]!==l||e[31]!==t||e[32]!==s||e[33]!==K||e[34]!==V||e[35]!==A||e[36]!==q||e[37]!==i||e[38]!==O||e[39]!==H||e[40]!==Q||e[41]!==r||e[42]!==R||e[43]!==c||e[44]!==$||e[45]!==x||e[46]!==D||e[47]!==g||e[48]!==u||e[49]!==n||e[50]!==m||e[51]!==b?(B={handle:i,profile:m,loading:u,userPosts:b,setUserPosts:nt,activeProfileTab:l,setActiveProfileTab:w,loadingPosts:g,isFetchingMorePosts:c,hasMorePosts:r,filteredPosts:V,isFollowModalOpen:$,setIsFollowModalOpen:T,followModalType:q,followListData:A,isListLoading:x,isFetchingMoreFollows:R,hasMoreFollows:Q,openFollowModal:z,fetchNextFollows:K,handlePostClick:O,handleUserClick:H,loadUserPosts:D,currentUser:s,addToast:t,navigate:n},e[30]=l,e[31]=t,e[32]=s,e[33]=K,e[34]=V,e[35]=A,e[36]=q,e[37]=i,e[38]=O,e[39]=H,e[40]=Q,e[41]=r,e[42]=R,e[43]=c,e[44]=$,e[45]=x,e[46]=D,e[47]=g,e[48]=u,e[49]=n,e[50]=m,e[51]=b,e[52]=B):B=e[52],B};function et(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function tt(e){return e}function st(e){return e.community_id===null&&e.parent_id===null}function it(e){return e.community_id===null&&e.parent_id===null&&(e.type==="video"||e.type==="image"||e.media&&e.media.length>0)}function nt(){return console.warn("setUserPosts is deprecated")}var ot=X();const Kt=()=>{const e=(0,ot.c)(75),{handle:i}=ie(),n=U(),{currentUser:s}=I(),{addToast:t}=ne(),a=te();let o,h;e[0]!==i?(o=["community",i],h=()=>Qe(i),e[0]=i,e[1]=o,e[2]=h):(o=e[1],h=e[2]);const d=!!i;let m;e[3]!==o||e[4]!==h||e[5]!==d?(m={queryKey:o,queryFn:h,enabled:d,staleTime:6e5},e[3]=o,e[4]=h,e[5]=d,e[6]=m):m=e[6];const{data:u,isLoading:l,refetch:w}=ee(m),P=u?.id,p=s?.id;let f;e[7]!==P||e[8]!==p?(f=["community",P,"membership",p],e[7]=P,e[8]=p,e[9]=f):f=e[9];let v;e[10]!==u?.id||e[11]!==s?.id?(v=()=>Me(u?.id,s?.id),e[10]=u?.id,e[11]=s?.id,e[12]=v):v=e[12];const M=!!u?.id&&!!s?.id;let C;e[13]!==f||e[14]!==v||e[15]!==M?(C={queryKey:f,queryFn:v,enabled:M,staleTime:3e5},e[13]=f,e[14]=v,e[15]=M,e[16]=C):C=e[16];const{data:_}=ee(C),r=!!_,c=_?.role||null,g=u?.id;let y;e[17]!==g?(y=["posts","community",g],e[17]=g,e[18]=y):y=e[18];let b;e[19]!==u?.id?(b=B=>{const{pageParam:S}=B;return $e(u?.id,S,10)},e[19]=u?.id,e[20]=b):b=e[20];const $=!!u?.id;let T;e[21]!==y||e[22]!==b||e[23]!==$?(T={queryKey:y,queryFn:b,enabled:$,initialPageParam:null,getNextPageParam:at},e[21]=y,e[22]=b,e[23]=$,e[24]=T):T=e[24];const{data:q,fetchNextPage:L,hasNextPage:A,isFetchingNextPage:K,isLoading:Q}=Z(T);let R;e[25]!==q?.pages?(R=q?.pages.flatMap(rt)||[],e[25]=q?.pages,e[26]=R):R=e[26];const x=R;let N;e[27]!==u?.id||e[28]!==s?.id?(N=()=>he(u?.id,s?.id),e[27]=u?.id,e[28]=s?.id,e[29]=N):N=e[29];let z;e[30]!==u?.id||e[31]!==s?.id||e[32]!==i||e[33]!==a?(z=async()=>{await a.cancelQueries({queryKey:["community",u?.id,"membership",s?.id]}),await a.cancelQueries({queryKey:["community",i]});const B=a.getQueryData(["community",u?.id,"membership",s?.id]),S=a.getQueryData(["community",i]);return a.setQueryData(["community",u?.id,"membership",s?.id],B?null:{role:"member"}),a.setQueryData(["community",i],k=>k&&{...k,membersCount:B?k.membersCount-1:k.membersCount+1}),{previousMembership:B,previousCommunity:S}},e[30]=u?.id,e[31]=s?.id,e[32]=i,e[33]=a,e[34]=z):z=e[34];let j;e[35]!==t||e[36]!==u?.id||e[37]!==s?.id||e[38]!==i||e[39]!==a?(j=(B,S,k)=>{k?.previousMembership!==void 0&&a.setQueryData(["community",u?.id,"membership",s?.id],k.previousMembership),k?.previousCommunity&&a.setQueryData(["community",i],k.previousCommunity),t("Failed to update membership","error")},e[35]=t,e[36]=u?.id,e[37]=s?.id,e[38]=i,e[39]=a,e[40]=j):j=e[40];let V;e[41]!==u?.id||e[42]!==s?.id||e[43]!==i||e[44]!==a?(V=()=>{a.invalidateQueries({queryKey:["community",u?.id,"membership",s?.id]}),a.invalidateQueries({queryKey:["community",i]})},e[41]=u?.id,e[42]=s?.id,e[43]=i,e[44]=a,e[45]=V):V=e[45];let J;e[46]!==t||e[47]!==u?(J=B=>{u&&t(B?`Joined ${u.name}`:`Left ${u.name}`)},e[46]=t,e[47]=u,e[48]=J):J=e[48];let O;e[49]!==N||e[50]!==z||e[51]!==j||e[52]!==V||e[53]!==J?(O={mutationFn:N,onMutate:z,onError:j,onSettled:V,onSuccess:J},e[49]=N,e[50]=z,e[51]=j,e[52]=V,e[53]=J,e[54]=O):O=e[54];const F=se(O);let H;e[55]!==t||e[56]!==s||e[57]!==F?(H=async()=>{if(!s)return t("Please login to join communities","error");F.mutate()},e[55]=t,e[56]=s,e[57]=F,e[58]=H):H=e[58];const G=H;let D;return e[59]!==t||e[60]!==u||e[61]!==x||e[62]!==s||e[63]!==L||e[64]!==G||e[65]!==A||e[66]!==K||e[67]!==r||e[68]!==F.isPending||e[69]!==l||e[70]!==Q||e[71]!==n||e[72]!==w||e[73]!==c?(D={community:u,loading:l,isMember:r,userRole:c,isJoining:F.isPending,communityPosts:x,loadingPosts:Q,isFetchingMorePosts:K,hasMorePosts:A,handleJoinToggle:G,loadCommunityPosts:L,refetchCommunity:w,currentUser:s,addToast:t,navigate:n},e[59]=t,e[60]=u,e[61]=x,e[62]=s,e[63]=L,e[64]=G,e[65]=A,e[66]=K,e[67]=r,e[68]=F.isPending,e[69]=l,e[70]=Q,e[71]=n,e[72]=w,e[73]=c,e[74]=D):D=e[74],D};function at(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function rt(e){return e}var lt=X();const At=()=>{const e=(0,lt.c)(48),{currentUser:i}=I(),n=U(),[s,t]=ce();let a;e[0]!==s?(a=s.get("q")||"",e[0]=s,e[1]=a):a=e[1];const o=a;let h;e[2]!==s||e[3]!==o?(h=s.get("tab")||(o?"posts":"communities"),e[2]=s,e[3]=o,e[4]=h):h=e[4];const d=h,[m,u]=(0,E.useState)(!1);let l;e[5]===Symbol.for("react.memo_cache_sentinel")?(l=["explore","communities"],e[5]=l):l=e[5];let w;e[6]===Symbol.for("react.memo_cache_sentinel")?(w={queryKey:l,queryFn:ct,initialPageParam:null,getNextPageParam:ut},e[6]=w):w=e[6];const{data:P,fetchNextPage:p,hasNextPage:f,isFetchingNextPage:v,isLoading:M}=Z(w);let C;e[7]!==P?.pages?(C=P?.pages.flatMap(ft)||[],e[7]=P?.pages,e[8]=C):C=e[8];const _=C;let r,c;e[9]!==o?(r=["explore","posts",o],c=O=>{const{pageParam:F}=O;return o?Se(o,F,10,!0):Ce(F,10)},e[9]=o,e[10]=r,e[11]=c):(r=e[10],c=e[11]);let g;e[12]!==r||e[13]!==c?(g={queryKey:r,queryFn:c,initialPageParam:null,getNextPageParam:dt},e[12]=r,e[13]=c,e[14]=g):g=e[14];const{data:y,fetchNextPage:b,hasNextPage:$,isFetchingNextPage:T,isLoading:q}=Z(g);let L;e[15]!==y?.pages?(L=y?.pages.flatMap(mt)||[],e[15]=y?.pages,e[16]=L):L=e[16];const A=L;let K=_;if(o){let O;if(e[17]!==K||e[18]!==o){let F;e[20]!==o?(F=H=>H.name?.toLowerCase().includes(o.toLowerCase())||H.handle?.toLowerCase().includes(o.toLowerCase()),e[20]=o,e[21]=F):F=e[21],O=K.filter(F),e[17]=K,e[18]=o,e[19]=O}else O=e[19];K=O}const Q=K;let R;e[22]!==n?(R=O=>{n(`/c/${O}`)},e[22]=n,e[23]=R):R=e[23];const x=R;let N;e[24]!==t?(N=O=>{t(F=>(O?F.set("q",O):F.delete("q"),F),{replace:!0})},e[24]=t,e[25]=N):N=e[25];const z=N;let j;e[26]!==t?(j=O=>{t(F=>(F.set("tab",O),F),{replace:!0})},e[26]=t,e[27]=j):j=e[27];const V=j;let J;return e[28]!==d||e[29]!==_||e[30]!==i||e[31]!==p||e[32]!==b||e[33]!==Q||e[34]!==x||e[35]!==z||e[36]!==V||e[37]!==f||e[38]!==$||e[39]!==M||e[40]!==m||e[41]!==v||e[42]!==T||e[43]!==q||e[44]!==n||e[45]!==A||e[46]!==o?(J={currentUser:i,searchQuery:o,setSearchQuery:z,activeTab:d,setActiveTab:V,isCreateModalOpen:m,setIsCreateModalOpen:u,communitiesData:_,isCommunitiesLoading:M,isFetchingMoreCommunities:v,hasMoreCommunities:f,postsData:A,isPostsLoading:q,isFetchingMorePosts:T,hasMorePosts:$,filteredCommunities:Q,handleCommunityClick:x,loadCommunities:p,loadPosts:b,navigate:n},e[28]=d,e[29]=_,e[30]=i,e[31]=p,e[32]=b,e[33]=Q,e[34]=x,e[35]=z,e[36]=V,e[37]=f,e[38]=$,e[39]=M,e[40]=m,e[41]=v,e[42]=T,e[43]=q,e[44]=n,e[45]=A,e[46]=o,e[47]=J):J=e[47],J};function ct(e){const{pageParam:i}=e;return me(i,10)}function ut(e){if(!(!e||e.length<10))return e[e.length-1].createdAt}function ft(e){return e}function dt(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].sortTimestamp}function mt(e){return e}var gt=X();const Ot=()=>{const e=(0,gt.c)(21),{currentUser:i}=I(),{posts:n,loading:s,hasMore:t,isFetchingNextPage:a,fetchNextPage:o,refreshPosts:h}=qe(),{addToast:d}=ne(),m=U();let u;e[0]===Symbol.for("react.memo_cache_sentinel")?(u=["stories"],e[0]=u):u=e[0];let l;e[1]===Symbol.for("react.memo_cache_sentinel")?(l={queryKey:u,queryFn:ht,initialPageParam:null,getNextPageParam:yt,refetchInterval:6e4},e[1]=l):l=e[1];const{data:w,isLoading:P}=Z(l);let p;if(e[2]!==w?.pages){const c=w?.pages.flatMap(pt)||[],g=JSON.parse(localStorage.getItem("seenStories")||"[]");p=c.reduce(Pt,[]).map(y=>({...y,isSeen:g.includes(y.user.id)})),e[2]=w?.pages,e[3]=p}else p=e[3];const f=p;let v;e[4]!==m?(v=c=>{m(`/post/${c}`)},e[4]=m,e[5]=v):v=e[5];const M=v;let C;e[6]!==m?(C=c=>{m(`/u/${c}`)},e[6]=m,e[7]=C):C=e[7];const _=C;let r;return e[8]!==d||e[9]!==i||e[10]!==o||e[11]!==f||e[12]!==M||e[13]!==_||e[14]!==t||e[15]!==n||e[16]!==a||e[17]!==s||e[18]!==P||e[19]!==h?(r={currentUser:i,homePosts:n,groupedStories:f,isPostsLoading:s,isStoriesLoading:P,hasMore:t,isFetchingNextPage:a,fetchNextPage:o,refreshPosts:h,addToast:d,handlePostClick:M,handleUserClick:_},e[8]=d,e[9]=i,e[10]=o,e[11]=f,e[12]=M,e[13]=_,e[14]=t,e[15]=n,e[16]=a,e[17]=s,e[18]=P,e[19]=h,e[20]=r):r=e[20],r};function ht(e){const{pageParam:i}=e;return ge(i,10)}function yt(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function pt(e){return e}function Pt(e,i){const n=e.find(s=>s.user.id===i.user_id);return n?n.stories.push(i):e.push({user:i.user,stories:[i],isSeen:!1}),e}var vt=X();const Bt=()=>{const e=(0,vt.c)(59),{id:i}=ie(),n=U(),{currentUser:s}=I(),{onlineUsers:t}=Ke(),a=te(),[o,h]=(0,E.useState)("");let d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=[],e[0]=d):d=e[0];const[m,u]=(0,E.useState)(d),{conversations:l,isConvLoading:w,refetchConversations:P,refetchMessages:p,sendMessage:f,sendTypingStatus:v,typingStatus:M,markAsRead:C,formatMessages:_,onDeleteMessage:r,conversationReactions:c,messages:g,isMsgLoading:y,fetchNextMessages:b,hasMoreMessages:$,isFetchingMoreMessages:T}=Ee(s,i);let q;e:{if(!i||l.length===0){q=null;break e}let k;e[1]!==l||e[2]!==i?(k=l.find(W=>W.id===i)||null,e[1]=l,e[2]=i,e[3]=k):k=e[3],q=k}const L=q;let A,K;e[4]!==i||e[5]!==C?(A=()=>{i&&C(i)},K=[i,C],e[4]=i,e[5]=C,e[6]=A,e[7]=K):(A=e[6],K=e[7]),(0,E.useEffect)(A,K);let Q;e[8]!==l||e[9]!==s?.id||e[10]!==o?(Q=()=>{const k=setTimeout(async()=>{if(o.length>1){const W=await Fe(o),re=l.map(wt);u(W.filter(le=>le.id!==s?.id&&!re.includes(le.id)))}else u([])},300);return()=>clearTimeout(k)},e[8]=l,e[9]=s?.id,e[10]=o,e[11]=Q):Q=e[11];const R=s?.id;let x;e[12]!==l||e[13]!==o||e[14]!==R?(x=[o,l,R],e[12]=l,e[13]=o,e[14]=R,e[15]=x):x=e[15],(0,E.useEffect)(Q,x);let N;e[16]!==s||e[17]!==n||e[18]!==a?(N=async k=>{if(s)try{const W=await xe(s.id,k.id);a.invalidateQueries({queryKey:["conversations",s.id]}),h(""),n(`/messages/${W}`)}catch(W){console.error("Failed to start conversation:",W)}},e[16]=s,e[17]=n,e[18]=a,e[19]=N):N=e[19];const z=N;let j;e[20]!==n?(j=k=>{n(`/messages/${k.id}`)},e[20]=n,e[21]=j):j=e[21];const V=j;let J;e[22]!==c||e[23]!==_||e[24]!==g?(J=_(g,c),e[22]=c,e[23]=_,e[24]=g,e[25]=J):J=e[25];const O=J;let F;if(e[26]!==l||e[27]!==o){let k;e[29]!==o?(k=W=>W.user?.name?.toLowerCase().includes(o.toLowerCase())||W.user?.handle?.toLowerCase().includes(o.toLowerCase())||W.lastMessage?.toLowerCase().includes(o.toLowerCase()),e[29]=o,e[30]=k):k=e[30],F=l.filter(k),e[26]=l,e[27]=o,e[28]=F}else F=e[28];const H=F,G=L&&M[L.id];let D;e[31]!==t||e[32]!==L?(D=L&&L.user?.id&&t.has(L.user.id),e[31]=t,e[32]=L,e[33]=D):D=e[33];const B=D;let S;return e[34]!==l||e[35]!==G||e[36]!==s||e[37]!==b||e[38]!==H||e[39]!==V||e[40]!==z||e[41]!==$||e[42]!==i||e[43]!==w||e[44]!==T||e[45]!==y||e[46]!==O||e[47]!==o||e[48]!==n||e[49]!==r||e[50]!==t||e[51]!==B||e[52]!==P||e[53]!==p||e[54]!==L||e[55]!==f||e[56]!==v||e[57]!==m?(S={id:i,currentUser:s,onlineUsers:t,msgSearchQuery:o,setMsgSearchQuery:h,userSearchResults:m,conversations:l,filteredConversations:H,selectedConversation:L,localMessages:O,isConvLoading:w,isMsgLoading:y,currentIsTyping:G,otherUserIsOnline:B,handleStartConversation:z,handleSelectConversation:V,refetchConversations:P,refetchMessages:p,sendMessage:f,onDeleteMessage:r,sendTypingStatus:v,navigate:n,fetchNextMessages:b,hasMoreMessages:$,isFetchingMoreMessages:T},e[34]=l,e[35]=G,e[36]=s,e[37]=b,e[38]=H,e[39]=V,e[40]=z,e[41]=$,e[42]=i,e[43]=w,e[44]=T,e[45]=y,e[46]=O,e[47]=o,e[48]=n,e[49]=r,e[50]=t,e[51]=B,e[52]=P,e[53]=p,e[54]=L,e[55]=f,e[56]=v,e[57]=m,e[58]=S):S=e[58],S};function wt(e){return e.user?.id}var bt=X();const jt=()=>{const e=(0,bt.c)(48),{currentUser:i}=I(),n=U(),s=te(),t=i?.id;let a;e[0]!==t?(a=["notifications",t],e[0]=t,e[1]=a):a=e[1];let o;e[2]!==i?.id?(o=R=>{const{pageParam:x}=R;return be(i?.id,x,10)},e[2]=i?.id,e[3]=o):o=e[3];const h=!!i?.id;let d;e[4]!==a||e[5]!==o||e[6]!==h?(d={queryKey:a,queryFn:o,enabled:h,initialPageParam:null,getNextPageParam:_t},e[4]=a,e[5]=o,e[6]=h,e[7]=d):d=e[7];const{data:m,fetchNextPage:u,hasNextPage:l,isFetchingNextPage:w,isLoading:P,refetch:p}=Z(d);let f;e[8]!==m?.pages?(f=m?.pages.flatMap(Ct)||[],e[8]=m?.pages,e[9]=f):f=e[9];const v=f;let M;e[10]!==i||e[11]!==s?(M=()=>{if(!i?.id)return;const R=oe.channel(`user_notifications:${i.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${i.id}`},()=>{s.invalidateQueries({queryKey:["notifications",i.id]})}).subscribe();return()=>{oe.removeChannel(R)}},e[10]=i,e[11]=s,e[12]=M):M=e[12];const C=i?.id;let _;e[13]!==s||e[14]!==C?(_=[C,s],e[13]=s,e[14]=C,e[15]=_):_=e[15],(0,E.useEffect)(M,_);let r;e[16]!==i?(r=()=>i?De(i.id):Promise.resolve(),e[16]=i,e[17]=r):r=e[17];let c,g,y;e[18]!==i?.id||e[19]!==s?(c=async()=>{await s.cancelQueries({queryKey:["notifications",i?.id]});const R=s.getQueryData(["notifications",i?.id]);return s.setQueryData(["notifications",i?.id],St),{previousNotifications:R}},g=(R,x,N)=>{N?.previousNotifications&&s.setQueryData(["notifications",i?.id],N.previousNotifications)},y=()=>{s.invalidateQueries({queryKey:["notifications",i?.id]})},e[18]=i?.id,e[19]=s,e[20]=c,e[21]=g,e[22]=y):(c=e[20],g=e[21],y=e[22]);let b;e[23]!==c||e[24]!==g||e[25]!==y||e[26]!==r?(b={mutationFn:r,onMutate:c,onError:g,onSettled:y},e[23]=c,e[24]=g,e[25]=y,e[26]=r,e[27]=b):b=e[27];const $=se(b);let T;e[28]!==n?(T=R=>{R.type==="follow"?n(`/u/${R.user}`):R.post_id&&n(`/post/${R.post_id}`)},e[28]=n,e[29]=T):T=e[29];const q=T;let L;e[30]!==i?.id||e[31]!==$||e[32]!==v?(L=()=>{i?.id&&v.some(Rt)&&$.mutate()},e[30]=i?.id,e[31]=$,e[32]=v,e[33]=L):L=e[33];const A=i?.id;let K;e[34]!==$||e[35]!==v.length||e[36]!==A?(K=[A,v.length,$],e[34]=$,e[35]=v.length,e[36]=A,e[37]=K):K=e[37],(0,E.useEffect)(L,K);let Q;return e[38]!==i||e[39]!==u||e[40]!==q||e[41]!==l||e[42]!==w||e[43]!==P||e[44]!==n||e[45]!==v||e[46]!==p?(Q={currentUser:i,notifications:v,isLoading:P,isFetchingMore:w,hasMore:l,loadNotifications:u,refreshNotifications:p,handleNotificationClick:q,navigate:n},e[38]=i,e[39]=u,e[40]=q,e[41]=l,e[42]=w,e[43]=P,e[44]=n,e[45]=v,e[46]=p,e[47]=Q):Q=e[47],Q};function _t(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Ct(e){return e}function Mt(e){return{...e,is_read:!0}}function $t(e){return e.map(Mt)}function St(e){return e&&{...e,pages:e.pages.map($t)}}function Rt(e){return!e.is_read}var kt=X();const Jt=()=>{const e=(0,kt.c)(23),{id:i}=ie(),n=U(),{currentUser:s}=I(),{addToast:t}=ne(),a=te();let o,h;e[0]!==i?(o=["post",i],h=async()=>{if(!i||!Y(i))throw new Error("Invalid post ID");return Ae(i)},e[0]=i,e[1]=o,e[2]=h):(o=e[1],h=e[2]);const d=!!i;let m;e[3]!==o||e[4]!==h||e[5]!==d?(m={queryKey:o,queryFn:h,enabled:d,retry:!1},e[3]=o,e[4]=h,e[5]=d,e[6]=m):m=e[6];const{data:u,isLoading:l,isError:w}=ee(m);let P;e[7]!==n?(P=r=>{n(`/u/${r}`)},e[7]=n,e[8]=P):P=e[8];const p=P;let f;e[9]!==n?(f=()=>{n(-1)},e[9]=n,e[10]=f):f=e[10];const v=f;let M;e[11]!==a?(M=(r,c,g)=>{a.setQueryData(["post",r],y=>y&&{...y,content:c,media:g})},e[11]=a,e[12]=M):M=e[12];const C=M;let _;return e[13]!==t||e[14]!==s||e[15]!==v||e[16]!==C||e[17]!==p||e[18]!==w||e[19]!==l||e[20]!==n||e[21]!==u?(_={post:u,isLoading:l,isError:w,currentUser:s,addToast:t,navigate:n,handleUserClick:p,handleDelete:v,handleUpdate:C},e[13]=t,e[14]=s,e[15]=v,e[16]=C,e[17]=p,e[18]=w,e[19]=l,e[20]=n,e[21]=u,e[22]=_):_=e[22],_},zt=()=>{const e=U(),{id:i}=ie(),[n]=ce(),s=i||n.get("id"),t=(0,E.useRef)(null),a=(0,E.useRef)(new Map),[o,h]=(0,E.useState)(null),[d,m]=(0,E.useState)(!0),{data:u,fetchNextPage:l,hasNextPage:w,isFetchingNextPage:P,isLoading:p}=Z({queryKey:["reels"],queryFn:({pageParam:r})=>Re(r,10),initialPageParam:null,getNextPageParam:r=>{if(!(!r||r.length<10))return r[r.length-1].sort_timestamp||r[r.length-1].created_at}}),f=(0,E.useMemo)(()=>u?.pages.flatMap(r=>r)||[],[u]);(0,E.useEffect)(()=>{if(f.length>0)if(s)if(f.find(r=>r.id===s)){h(s);const r=a.current.get(s);r&&r.scrollIntoView({behavior:"instant"})}else o||h(f[0].id);else o||h(f[0].id)},[f,s,o]),(0,E.useEffect)(()=>{if(f.length===0)return;const r={root:t.current,threshold:.6},c=y=>{y.forEach(b=>{if(b.isIntersecting){const $=b.target.getAttribute("data-id");$&&h($)}})},g=new IntersectionObserver(c,r);return a.current.forEach(y=>g.observe(y)),()=>g.disconnect()},[f.length]);const v=()=>{m(!d)};(0,E.useEffect)(()=>{const r=c=>{const g=c.target;if(!(g.tagName==="INPUT"||g.tagName==="TEXTAREA"||g.isContentEditable)&&!(c.ctrlKey||c.altKey||c.metaKey))switch(c.key){case"ArrowUp":c.preventDefault(),C();break;case"ArrowDown":c.preventDefault(),M();break;case"m":case"M":v();break;case" ":c.preventDefault();const y=a.current.get(o||"");if(y){const b=y.querySelector(".reel-item");b&&b.click()}break}};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[o,f,d]);const M=()=>{if(f.length===0)return;const r=f.findIndex(c=>c.id===o);if(r<f.length-1){const c=f[r+1];a.current.get(c.id)?.scrollIntoView({behavior:"smooth"})}},C=()=>{if(f.length===0)return;const r=f.findIndex(c=>c.id===o);if(r>0){const c=f[r-1];a.current.get(c.id)?.scrollIntoView({behavior:"smooth"})}},_=(r,c)=>{c?a.current.set(r,c):a.current.delete(r)};return(0,E.useEffect)(()=>{const r=()=>{if(!t.current||P||!w)return;const{scrollTop:g,scrollHeight:y,clientHeight:b}=t.current;g+b>=y-800&&l()},c=t.current;if(c)return c.addEventListener("scroll",r),()=>c.removeEventListener("scroll",r)},[P,w,l]),{reels:f,loading:p,loadingMore:P,activeReelId:o,hasMore:w,isMuted:d,containerRef:t,setReelRef:_,navigate:e,toggleMute:v,scrollToNext:M,scrollToPrev:C,loadReels:l}},Vt=()=>{const{currentUser:e,logout:i}=I(),{darkMode:n,toggleDarkMode:s,fontSize:t,setFontSize:a,dataSaver:o,setDataSaver:h}=Te(),{addToast:d}=ne(),[m,u]=(0,E.useState)(!1),[l,w]=(0,E.useState)({newPassword:"",confirmPassword:""}),[P,p]=(0,E.useState)(!1),f=async()=>{try{await i(),d("Logged out successfully")}catch(g){console.error("Logout error:",g),d("Failed to logout")}};return{currentUser:e,darkMode:n,toggleDarkMode:s,fontSize:t,setFontSize:a,dataSaver:o,setDataSaver:h,isChangingPassword:m,setIsChangingPassword:u,passwordData:l,setPasswordData:w,loading:P,handleLogout:f,handlePasswordChange:async g=>{if(g.preventDefault(),l.newPassword!==l.confirmPassword){d("Passwords do not match","error");return}if(l.newPassword.length<6){d("Password must be at least 6 characters","error");return}p(!0);try{const{error:y}=await oe.auth.updateUser({password:l.newPassword});if(y)throw y;d("Password updated successfully!"),u(!1),w({newPassword:"",confirmPassword:""})}catch(y){console.error("Password update error:",y),d(y.message||"Failed to update password","error")}finally{p(!1)}},handlePasswordReset:async()=>{if(e?.email){p(!0);try{const{error:g}=await oe.auth.resetPasswordForEmail(e.email,{redirectTo:`${window.location.origin}/settings?type=recovery`});if(g)throw g;d("Password reset email sent!")}catch(g){console.error("Reset password error:",g),d(g.message||"Failed to send reset email","error")}finally{p(!1)}}},handleClearCache:()=>{["seenStories","font-size","data-saver","theme"].forEach(g=>localStorage.removeItem(g)),d("Cache cleared! Reloading..."),setTimeout(()=>window.location.reload(),1500)},handleDownloadData:async()=>{if(e){p(!0);try{const g={user:{id:e.id,handle:e.handle,name:e.name,email:e.email},exportDate:new Date().toISOString(),note:"This is a mock export of your Sysm data."},y=new Blob([JSON.stringify(g,null,2)],{type:"application/json"}),b=URL.createObjectURL(y),$=document.createElement("a");$.href=b,$.download=`sysm-data-${e.handle}.json`,$.click(),URL.revokeObjectURL(b),d("Data export started!")}catch{d("Failed to export data","error")}finally{p(!1)}}},handleDeleteAccount:()=>{window.confirm("Are you absolutely sure? This will permanently delete your account and all associated data. This action is irreversible.")&&(d("Account deletion request submitted. Logging out..."),setTimeout(f,2e3))},handleReportBug:()=>{window.prompt("Please describe the bug you found:")&&d("Bug reported! Thank you for your feedback.")}}};export{Bt as a,Kt as c,Et as d,Dt as f,jt as i,Qt as l,zt as n,Ot as o,xt as p,Jt as r,At as s,Vt as t,Tt as u};
