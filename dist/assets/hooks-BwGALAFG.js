import{a as Xe}from"./rolldown-runtime-BaZ8gS7u.js";import{s as Ze}from"./animations-DnIvWaa_.js";import{_ as he,c as te,v as Ae,y as Ke}from"./framework-qAfQIUpw.js";import{a as me,n as ce,r as ye,t as re}from"./query-gr-7CPJN.js";import{$t as Ie,Bt as Ue,Dn as et,En as tt,Fn as De,Gt as st,Jt as nt,Kt as it,Ln as le,Lt as rt,Qt as at,Rn as de,Rt as _e,Tn as ot,Vt as fe,Wt as ct,Xt as lt,Zt as ut,an as ft,bn as dt,c as ht,cn as mt,dn as gt,en as pt,fn as yt,gn as _t,hn as Mt,in as At,kn as Se,ln as Ft,mn as Pt,nn as wt,pn as Et,qt as Dt,rn as bt,sn as St,tn as vt,un as xt,vn as Ct,xn as Rt,yn as $t,zt as Lt}from"./index-BDHAGO-X.js";var Bt=te(),J=Xe(Ze(),1);const kt=(e,n,s)=>{const t=(0,Bt.c)(16);let i,r;t[0]!==n||t[1]!==e?(i=["follows",n,e],r=M=>{const{pageParam:_}=M;return(n==="Followers"?ot:tt)(e,_,10)},t[0]=n,t[1]=e,t[2]=i,t[3]=r):(i=t[2],r=t[3]);const a=!!e&&s;let o;t[4]!==i||t[5]!==r||t[6]!==a?(o={queryKey:i,queryFn:r,initialPageParam:null,getNextPageParam:Nt,enabled:a},t[4]=i,t[5]=r,t[6]=a,t[7]=o):o=t[7];const{data:c,fetchNextPage:l,hasNextPage:f,isFetchingNextPage:u,isLoading:d}=re(o);let g;t[8]!==c?.pages?(g=c?.pages.flatMap(Tt)||[],t[8]=c?.pages,t[9]=g):g=t[9];const m=g;let p;return t[10]!==l||t[11]!==m||t[12]!==f||t[13]!==u||t[14]!==d?(p={followList:m,fetchNextPage:l,hasNextPage:f,isFetchingNextPage:u,isLoading:d},t[10]=l,t[11]=m,t[12]=f,t[13]=u,t[14]=d,t[15]=p):p=t[15],p};function Nt(e){if(!(!e||e.length<10))return e[e.length-1].followed_at}function Tt(e){return e}var qt=te();const Qt=(e,n)=>{const s=(0,qt.c)(95),t=me(),{addToast:i}=_e();let r;s[0]!==e?.id?(r=(R,Y)=>{const z=R===void 0?[]:R,U=Y===void 0?[]:Y;return z.map(W=>{const ie=W.reply_to_id;let ae=null;if(ie){const se=z.find(Ee=>Ee.id===ie);se&&(ae={id:se.id,senderName:se.sender?.name||se.sender?.display_name||"Unknown",text:se.content||(se.type==="image"?"Photo":se.type==="video"?"Video":se.type==="voice"?"Voice message":"")})}return{id:W.id,sender:W.sender_id===e?.id?"me":"them",senderAvatar:W.sender?.avatar,senderName:W.sender?.name,text:W.content||"",type:W.type||"text",media:W.media?Array.isArray(W.media)?W.media:[W.media]:[],isRead:W.is_read||!1,replyToId:ie,replyTo:ae,reactions:U.filter(se=>se.message_id===W.id),time:W.created_at?new Date(W.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Just now",updatedAt:W.updated_at,isOptimistic:W.isOptimistic}})},s[0]=e?.id,s[1]=r):r=s[1],e?.id;const a=r;let o,c;s[2]!==n?(o=["messages",n],c=R=>{const{pageParam:Y}=R;return lt(n,Y,20)},s[2]=n,s[3]=o,s[4]=c):(o=s[3],c=s[4]);const l=!!n;let f;s[5]!==o||s[6]!==c||s[7]!==l?(f={queryKey:o,queryFn:c,initialPageParam:null,getNextPageParam:Kt,enabled:l,refetchOnWindowFocus:!1},s[5]=o,s[6]=c,s[7]=l,s[8]=f):f=s[8];const{data:u,fetchNextPage:d,hasNextPage:g,isFetchingNextPage:m,isLoading:p,refetch:M}=re(f);let _,w;s[9]!==n?(_=["reactions",n],w=()=>ut(n),s[9]=n,s[10]=_,s[11]=w):(_=s[10],w=s[11]);const P=!!n;let D;s[12]!==_||s[13]!==w||s[14]!==P?(D={queryKey:_,queryFn:w,enabled:P,staleTime:3e5},s[12]=_,s[13]=w,s[14]=P,s[15]=D):D=s[15];const{data:h}=ye(D);let A;s[16]!==h?(A=h===void 0?[]:h,s[16]=h,s[17]=A):A=s[17];const y=A;let F;s[18]!==e?(F=R=>{const{convId:Y,text:z,type:U,media:W,replyToId:ie}=R,ae=U===void 0?"text":U,se=W===void 0?[]:W,Ee=ie===void 0?null:ie;return pt(Y,e.id,z,ae,se,Ee)},s[18]=e,s[19]=F):F=s[19];let S;s[20]!==n||s[21]!==e||s[22]!==t?(S=async R=>{await t.cancelQueries({queryKey:["messages",n]});const Y=t.getQueryData(["messages",n]),z={id:`temp-${Date.now()}`,conversation_id:n,sender_id:e.id,content:R.text,type:R.type||"text",media:R.media||[],reply_to_id:R.replyToId,reply_to:null,is_read:!1,created_at:new Date().toISOString(),isOptimistic:!0,sender:{id:e.id,handle:e.handle,name:e.name,avatar:e.avatar,verified:e.verified}};return t.setQueryData(["messages",n],U=>{if(!U)return{pages:[[z]],pageParams:[null]};const W=[...U.pages];return W[0]=[z,...W[0]],{...U,pages:W}}),{previousMessages:Y}},s[20]=n,s[21]=e,s[22]=t,s[23]=S):S=s[23];let $;s[24]!==n||s[25]!==i||s[26]!==t?($=(R,Y,z)=>{t.setQueryData(["messages",n],z?.previousMessages),i("Failed to send message","error")},s[24]=n,s[25]=i,s[26]=t,s[27]=$):$=s[27];let k;s[28]!==n||s[29]!==e||s[30]!==t?(k=()=>{t.invalidateQueries({queryKey:["messages",n]}),t.invalidateQueries({queryKey:["conversations",e.id]})},s[28]=n,s[29]=e,s[30]=t,s[31]=k):k=s[31];let T;s[32]!==F||s[33]!==S||s[34]!==$||s[35]!==k?(T={mutationFn:F,onMutate:S,onError:$,onSettled:k},s[32]=F,s[33]=S,s[34]=$,s[35]=k,s[36]=T):T=s[36];const x=ce(T);let C;s[37]!==n||s[38]!==t?(C=async R=>{const{messageId:Y,content:z}=R;await t.cancelQueries({queryKey:["messages",n]});const U=t.getQueryData(["messages",n]);return t.setQueryData(["messages",n],W=>W&&{...W,pages:W.pages.map(ie=>ie.map(ae=>ae.id===Y?{...ae,content:z}:ae))}),{previousMessages:U}},s[37]=n,s[38]=t,s[39]=C):C=s[39];let v;s[40]!==n||s[41]!==e?.id||s[42]!==t?(v=R=>{R&&(t.invalidateQueries({queryKey:["messages",n]}),t.invalidateQueries({queryKey:["conversations",e?.id]}))},s[40]=n,s[41]=e?.id,s[42]=t,s[43]=v):v=s[43];let b;s[44]!==n||s[45]!==i||s[46]!==t?(b=(R,Y,z)=>{t.setQueryData(["messages",n],z?.previousMessages),i("Failed to edit message","error")},s[44]=n,s[45]=i,s[46]=t,s[47]=b):b=s[47];let L;s[48]!==C||s[49]!==v||s[50]!==b?(L={mutationFn:Ot,onMutate:C,onSuccess:v,onError:b},s[48]=C,s[49]=v,s[50]=b,s[51]=L):L=s[51];const B=ce(L);let Q;s[52]!==n||s[53]!==i||s[54]!==e||s[55]!==t?(Q=async(R,Y)=>{if(!e?.id||!n)return;await t.cancelQueries({queryKey:["reactions",n]});const z=t.getQueryData(["reactions",n]),U=z?.find(W=>W.message_id===R&&W.user_id===e.id&&W.emoji===Y);t.setQueryData(["reactions",n],W=>{const ie=W===void 0?[]:W;if(U)return ie.filter(se=>se.id!==U.id);const ae={id:`temp-${Date.now()}`,message_id:R,user_id:e.id,emoji:Y,created_at:new Date().toISOString()};return[...ie,ae]});try{await vt(R,e.id,Y),t.invalidateQueries({queryKey:["reactions",n]})}catch(W){console.error("Failed to toggle reaction:",W),t.setQueryData(["reactions",n],z),i("Failed to update reaction","error")}},s[52]=n,s[53]=i,s[54]=e,s[55]=t,s[56]=Q):Q=s[56];const V=Q;let Z;s[57]!==n||s[58]!==t?(Z=async R=>{await t.cancelQueries({queryKey:["messages",n]});const Y=t.getQueryData(["messages",n]);return t.setQueryData(["messages",n],z=>z&&{...z,pages:z.pages.map(U=>U.filter(W=>W.id!==R))}),{previousMessages:Y}},s[57]=n,s[58]=t,s[59]=Z):Z=s[59];let G;s[60]!==n||s[61]!==e?.id||s[62]!==t?(G=()=>{t.invalidateQueries({queryKey:["messages",n]}),t.invalidateQueries({queryKey:["conversations",e?.id]})},s[60]=n,s[61]=e?.id,s[62]=t,s[63]=G):G=s[63];let I;s[64]!==n||s[65]!==i||s[66]!==t?(I=(R,Y,z)=>{t.setQueryData(["messages",n],z?.previousMessages),i("Failed to delete message","error")},s[64]=n,s[65]=i,s[66]=t,s[67]=I):I=s[67];let X;s[68]!==Z||s[69]!==G||s[70]!==I?(X={mutationFn:jt,onMutate:Z,onSuccess:G,onError:I},s[68]=Z,s[69]=G,s[70]=I,s[71]=X):X=s[71];const j=ce(X);let N;s[72]!==u?.pages?(N=[...u?.pages.flatMap(zt)||[]].reverse(),s[72]=u?.pages,s[73]=N):N=s[73];const q=N;let K;s[74]!==x?(K=(R,Y,z,U,W)=>x.mutate({convId:R,text:Y,type:z,media:U,replyToId:W}),s[74]=x,s[75]=K):K=s[75];let E;s[76]!==B?(E=(R,Y)=>B.mutate({messageId:R,content:Y}),s[76]=B,s[77]=E):E=s[77];let H;s[78]!==j?(H=R=>j.mutate(R),s[78]=j,s[79]=H):H=s[79];let ee;return s[80]!==y||s[81]!==B.isPending||s[82]!==d||s[83]!==q||s[84]!==a||s[85]!==g||s[86]!==m||s[87]!==p||s[88]!==V||s[89]!==M||s[90]!==x.isPending||s[91]!==K||s[92]!==E||s[93]!==H?(ee={messages:q,isMsgLoading:p,refetchMessages:M,fetchNextMessages:d,hasMoreMessages:g,isFetchingMoreMessages:m,sendMessage:K,editMessage:E,isSending:x.isPending,isEditing:B.isPending,onToggleReaction:V,onDeleteMessage:H,conversationReactions:y,formatMessages:a},s[80]=y,s[81]=B.isPending,s[82]=d,s[83]=q,s[84]=a,s[85]=g,s[86]=m,s[87]=p,s[88]=V,s[89]=M,s[90]=x.isPending,s[91]=K,s[92]=E,s[93]=H,s[94]=ee):ee=s[94],ee};function Kt(e){if(!(!e||e.length<20))return e[e.length-1].created_at}function Ot(e){const{messageId:n,content:s}=e;return nt(n,s)}function jt(e){return Dt(e)}function zt(e){return e}var Wt=te();const Vt=(e,n)=>{const s=(0,Wt.c)(21),t=me();let i;s[0]===Symbol.for("react.memo_cache_sentinel")?(i={},s[0]=i):i=s[0];const[r,a]=(0,J.useState)(i),o=(0,J.useRef)(null);let c;s[1]===Symbol.for("react.memo_cache_sentinel")?(c={},s[1]=c):c=s[1];const l=(0,J.useRef)(c);let f;s[2]!==e||s[3]!==t?(f=async w=>{if(!(!e?.id||!w))try{await Ie(w),t.invalidateQueries({queryKey:["unread_messages_count",e.id]}),t.invalidateQueries({queryKey:["conversations",e.id]})}catch(P){console.error("Failed to mark as read:",P)}},s[2]=e,s[3]=t,s[4]=f):f=s[4];const u=f;let d;s[5]!==n||s[6]!==e||s[7]!==u||s[8]!==t?(d=()=>{if(!e?.id)return;const w=de.channel(`messages_realtime:${n||"global"}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},h=>{const A=h.new;n&&A.conversation_id===n&&(t.invalidateQueries({queryKey:["messages",n]}),A.sender_id!==e.id&&u(n)),t.invalidateQueries({queryKey:["conversations",e.id]}),A.sender_id!==e.id&&t.invalidateQueries({queryKey:["unread_messages_count",e.id]}),a(y=>({...y,[A.conversation_id]:!1}))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"messages"},()=>{t.invalidateQueries({queryKey:["messages"]}),t.invalidateQueries({queryKey:["conversations",e.id]})}).on("postgres_changes",{event:"*",schema:"public",table:"message_reactions"},()=>{n&&t.invalidateQueries({queryKey:["reactions",n]})}).subscribe(),P=de.channel("chat_typing_shared").on("broadcast",{event:"typing"},h=>{const{payload:A}=h,{conversationId:y,isTyping:F,userId:S}=A;S!==e.id&&(a($=>({...$,[y]:F})),l.current[y]&&window.clearTimeout(l.current[y]),F&&(l.current[y]=window.setTimeout(()=>{a($=>({...$,[y]:!1}))},5e3)))}).subscribe();o.current=P;const D=l.current;return()=>{de.removeChannel(w),de.removeChannel(P),Object.values(D).forEach(window.clearTimeout)}},s[5]=n,s[6]=e,s[7]=u,s[8]=t,s[9]=d):d=s[9];const g=e?.id;let m;s[10]!==n||s[11]!==u||s[12]!==t||s[13]!==g?(m=[g,t,n,u],s[10]=n,s[11]=u,s[12]=t,s[13]=g,s[14]=m):m=s[14],(0,J.useEffect)(d,m);let p;s[15]!==e?(p=(w,P)=>{o.current&&e&&o.current.send({type:"broadcast",event:"typing",payload:{conversationId:w,isTyping:P,userId:e.id}})},s[15]=e,s[16]=p):p=s[16];const M=p;let _;return s[17]!==u||s[18]!==M||s[19]!==r?(_={typingStatus:r,sendTypingStatus:M,markAsRead:u},s[17]=u,s[18]=M,s[19]=r,s[20]=_):_=s[20],_};var Jt=te();const Ht=(e,n)=>{const s=(0,Jt.c)(22),{conversations:t,unreadCount:i,isConvLoading:r,refetchConversations:a}=ht(e),{messages:o,isMsgLoading:c,refetchMessages:l,fetchNextMessages:f,hasMoreMessages:u,isFetchingMoreMessages:d,sendMessage:g,editMessage:m,isSending:p,isEditing:M,onToggleReaction:_,onDeleteMessage:w,conversationReactions:P,formatMessages:D}=Qt(e,n),{typingStatus:h,sendTypingStatus:A,markAsRead:y}=Vt(e,n);let F;return s[0]!==P||s[1]!==t||s[2]!==m||s[3]!==f||s[4]!==D||s[5]!==u||s[6]!==r||s[7]!==M||s[8]!==d||s[9]!==c||s[10]!==p||s[11]!==y||s[12]!==o||s[13]!==w||s[14]!==_||s[15]!==a||s[16]!==l||s[17]!==g||s[18]!==A||s[19]!==h||s[20]!==i?(F={conversations:t,unreadCount:i,isConvLoading:r,refetchConversations:a,refetchMessages:l,sendMessage:g,editMessage:m,sendTypingStatus:A,typingStatus:h,markAsRead:y,formatMessages:D,onToggleReaction:_,onDeleteMessage:w,conversationReactions:P,isSending:p,isEditing:M,messages:o,isMsgLoading:c,fetchNextMessages:f,hasMoreMessages:u,isFetchingMoreMessages:d},s[0]=P,s[1]=t,s[2]=m,s[3]=f,s[4]=D,s[5]=u,s[6]=r,s[7]=M,s[8]=d,s[9]=c,s[10]=p,s[11]=y,s[12]=o,s[13]=w,s[14]=_,s[15]=a,s[16]=l,s[17]=g,s[18]=A,s[19]=h,s[20]=i,s[21]=F):F=s[21],F};var Gt=te();const Tn=(e,n,s)=>{const t=(0,Gt.c)(85),i=me(),{addToast:r}=_e();let a;t[0]!==n?(a=n||{comments:0,likes:0,mirrors:0,reposts:0},t[0]=n,t[1]=a):a=t[1];const[o,c]=(0,J.useState)(a),[l,f]=(0,J.useState)(n);n!==l&&(f(n),c(q=>({...q,...n})));const u=s?.id;let d;t[2]!==e||t[3]!==u?(d=["post",e,"liked",u],t[2]=e,t[3]=u,t[4]=d):d=t[4];let g,m;t[5]!==s||t[6]!==e?(g=()=>Ft(e,s.id),m=!!s&&le(e)&&le(s.id),t[5]=s,t[6]=e,t[7]=g,t[8]=m):(g=t[7],m=t[8]);let p;t[9]!==d||t[10]!==g||t[11]!==m?(p={queryKey:d,queryFn:g,enabled:m,staleTime:6e5},t[9]=d,t[10]=g,t[11]=m,t[12]=p):p=t[12];const{data:M}=ye(p),_=M===void 0?!1:M,w=s?.id;let P;t[13]!==e||t[14]!==w?(P=["post",e,"reposted",w],t[13]=e,t[14]=w,t[15]=P):P=t[15];let D,h;t[16]!==s||t[17]!==e?(h=()=>xt(e,s.id),D=!!s&&le(e)&&le(s.id),t[16]=s,t[17]=e,t[18]=D,t[19]=h):(D=t[18],h=t[19]);let A;t[20]!==D||t[21]!==P||t[22]!==h?(A={queryKey:P,queryFn:h,enabled:D,staleTime:6e5},t[20]=D,t[21]=P,t[22]=h,t[23]=A):A=t[23];const{data:y}=ye(A),F=y===void 0?!1:y;let S;t[24]!==s||t[25]!==e?(S=()=>$t(e,s.id),t[24]=s,t[25]=e,t[26]=S):S=t[26];let $;t[27]!==s||t[28]!==e||t[29]!==i?($=async()=>{const q=s.id;await i.cancelQueries({queryKey:["post",e,"liked",q]});const K=i.getQueryData(["post",e,"liked",q]);return i.setQueryData(["post",e,"liked",q],!K),c(E=>({...E,likes:K?(E.likes||0)-1:(E.likes||0)+1})),{previousLiked:K}},t[27]=s,t[28]=e,t[29]=i,t[30]=$):$=t[30];let k;t[31]!==r||t[32]!==s||t[33]!==e||t[34]!==i?(k=(q,K,E)=>{E?.previousLiked!==void 0&&(i.setQueryData(["post",e,"liked",s.id],E.previousLiked),c(H=>({...H,likes:E.previousLiked?(H.likes||0)+1:(H.likes||0)-1}))),r("Failed to update like","error")},t[31]=r,t[32]=s,t[33]=e,t[34]=i,t[35]=k):k=t[35];let T;t[36]!==s?.id||t[37]!==e||t[38]!==i?(T=()=>{i.invalidateQueries({queryKey:["post",e,"liked",s?.id]})},t[36]=s?.id,t[37]=e,t[38]=i,t[39]=T):T=t[39];let x;t[40]!==S||t[41]!==$||t[42]!==k||t[43]!==T?(x={mutationFn:S,onMutate:$,onError:k,onSettled:T},t[40]=S,t[41]=$,t[42]=k,t[43]=T,t[44]=x):x=t[44];const C=ce(x);let v;t[45]!==s||t[46]!==e?(v=()=>dt(e,s.id),t[45]=s,t[46]=e,t[47]=v):v=t[47];let b;t[48]!==s||t[49]!==e||t[50]!==i?(b=async()=>{const q=s.id;await i.cancelQueries({queryKey:["post",e,"reposted",q]});const K=i.getQueryData(["post",e,"reposted",q]);return i.setQueryData(["post",e,"reposted",q],!K),c(E=>({...E,reposts:K?(E.reposts||0)-1:(E.reposts||0)+1,mirrors:K?(E.mirrors||0)-1:(E.mirrors||0)+1})),{previousReposted:K}},t[48]=s,t[49]=e,t[50]=i,t[51]=b):b=t[51];let L;t[52]!==r||t[53]!==s||t[54]!==e||t[55]!==i?(L=(q,K,E)=>{E?.previousReposted!==void 0&&(i.setQueryData(["post",e,"reposted",s.id],E.previousReposted),c(H=>({...H,reposts:E.previousReposted?(H.reposts||0)+1:(H.reposts||0)-1,mirrors:E.previousReposted?(H.mirrors||0)+1:(H.mirrors||0)-1}))),r("Failed to update repost","error")},t[52]=r,t[53]=s,t[54]=e,t[55]=i,t[56]=L):L=t[56];let B;t[57]!==s?.id||t[58]!==e||t[59]!==i?(B=()=>{i.invalidateQueries({queryKey:["post",e,"reposted",s?.id]})},t[57]=s?.id,t[58]=e,t[59]=i,t[60]=B):B=t[60];let Q;t[61]!==r?(Q=q=>{r(q?"Reposted!":"Removed repost")},t[61]=r,t[62]=Q):Q=t[62];let V;t[63]!==v||t[64]!==b||t[65]!==L||t[66]!==B||t[67]!==Q?(V={mutationFn:v,onMutate:b,onError:L,onSettled:B,onSuccess:Q},t[63]=v,t[64]=b,t[65]=L,t[66]=B,t[67]=Q,t[68]=V):V=t[68];const Z=ce(V);let G;t[69]!==r||t[70]!==s||t[71]!==C||t[72]!==e?(G=async q=>{if(q&&q.stopPropagation(),!s)return r("Please login to like!","error");!le(e)||!le(s.id)||C.mutate()},t[69]=r,t[70]=s,t[71]=C,t[72]=e,t[73]=G):G=t[73];const I=G;let X;t[74]!==r||t[75]!==s||t[76]!==e||t[77]!==Z?(X=async q=>{if(q&&q.stopPropagation(),!s)return r("Please login to repost!","error");!le(e)||!le(s.id)||Z.mutate()},t[74]=r,t[75]=s,t[76]=e,t[77]=Z,t[78]=X):X=t[78];const j=X;let N;return t[79]!==I||t[80]!==j||t[81]!==_||t[82]!==F||t[83]!==o?(N={liked:_,reposted:F,localStats:o,setLocalStats:c,handleLike:I,handleRepost:j},t[79]=I,t[80]=j,t[81]=_,t[82]=F,t[83]=o,t[84]=N):N=t[84],N};var Yt=te();const qn=e=>{const n=(0,Yt.c)(5);let s;n[0]!==e?(s=()=>De(e),n[0]=e,n[1]=s):s=n[1];const[t,i]=(0,J.useState)(s);let r,a;return n[2]!==e?(r=()=>{if(!e)return;const o=setTimeout(()=>{i(De(e))},0),c=setInterval(()=>{i(De(e))},6e4);return()=>{clearTimeout(o),clearInterval(c)}},a=[e],n[2]=e,n[3]=r,n[4]=a):(r=n[3],a=n[4]),(0,J.useEffect)(r,a),t};var Xt=te();const Qn=()=>{const e=(0,Xt.c)(30),[n,s]=(0,J.useState)(!1),[t,i]=(0,J.useState)(!1),[r,a]=(0,J.useState)(0),[o,c]=(0,J.useState)(null),[l,f]=(0,J.useState)(null),u=(0,J.useRef)(null),d=(0,J.useRef)(null);let g;e[0]===Symbol.for("react.memo_cache_sentinel")?(g=[],e[0]=g):g=e[0];const m=(0,J.useRef)(g);let p,M;e[1]!==l?(p=()=>()=>{d.current&&clearInterval(d.current),u.current&&u.current.state!=="inactive"&&(u.current.stop(),u.current.stream.getTracks().forEach(Zt)),l&&URL.revokeObjectURL(l)},M=[l],e[1]=l,e[2]=p,e[3]=M):(p=e[2],M=e[3]),(0,J.useEffect)(p,M);let _;e[4]===Symbol.for("react.memo_cache_sentinel")?(_=()=>{d.current=window.setInterval(()=>{a(It)},1e3)},e[4]=_):_=e[4];const w=_;let P;e[5]===Symbol.for("react.memo_cache_sentinel")?(P=()=>{d.current&&(clearInterval(d.current),d.current=null)},e[5]=P):P=e[5];const D=P;let h;e[6]===Symbol.for("react.memo_cache_sentinel")?(h=async()=>{try{const B=await navigator.mediaDevices.getUserMedia({audio:!0}),Q=new MediaRecorder(B);u.current=Q,m.current=[],Q.ondataavailable=V=>{V.data.size>0&&m.current.push(V.data)},Q.onstop=()=>{const V=new Blob(m.current,{type:"audio/webm;codecs=opus"}),Z=URL.createObjectURL(V);c(V),f(Z),B.getTracks().forEach(Ut)},Q.start(),s(!0),i(!1),a(0),w()}catch(B){const Q=B;throw console.error("Error accessing microphone:",Q),Q}},e[6]=h):h=e[6];const A=h;let y;e[7]!==n?(y=()=>{u.current&&n&&(u.current.stop(),s(!1),i(!1),D())},e[7]=n,e[8]=y):y=e[8];const F=y;let S;e[9]!==t||e[10]!==n?(S=()=>{u.current&&n&&!t&&(u.current.pause(),i(!0),D())},e[9]=t,e[10]=n,e[11]=S):S=e[11];const $=S;let k;e[12]!==t||e[13]!==n?(k=()=>{u.current&&n&&t&&(u.current.resume(),i(!1),w())},e[12]=t,e[13]=n,e[14]=k):k=e[14];const T=k;let x;e[15]!==n?(x=()=>{u.current&&n&&(u.current.stop(),u.current.onstop=null,s(!1),i(!1),D(),a(0),u.current.stream&&u.current.stream.getTracks().forEach(es))},e[15]=n,e[16]=x):x=e[16];const C=x;let v;e[17]!==l?(v=()=>{l&&URL.revokeObjectURL(l),c(null),f(null),a(0)},e[17]=l,e[18]=v):v=e[18];const b=v;let L;return e[19]!==o||e[20]!==l||e[21]!==C||e[22]!==b||e[23]!==t||e[24]!==n||e[25]!==$||e[26]!==r||e[27]!==T||e[28]!==F?(L={isRecording:n,isPaused:t,recordingTime:r,startRecording:A,stopRecording:F,pauseRecording:$,resumeRecording:T,cancelRecording:C,audioBlob:o,audioUrl:l,clearAudio:b},e[19]=o,e[20]=l,e[21]=C,e[22]=b,e[23]=t,e[24]=n,e[25]=$,e[26]=r,e[27]=T,e[28]=F,e[29]=L):L=e[29],L};function Zt(e){return e.stop()}function It(e){return e+1}function Ut(e){return e.stop()}function es(e){return e.stop()}var ts=te();const Kn=(e,n,s)=>{const t=(0,ts.c)(50),i=me(),{currentUser:r}=fe();let a,o;t[0]!==s||t[1]!==e?(a=["comments",e,s],o=v=>{const{pageParam:b}=v;return yt(e,b,10,s)},t[0]=s,t[1]=e,t[2]=a,t[3]=o):(a=t[2],o=t[3]);let c;t[4]!==n?(c=n?{pages:[n],pageParams:[null]}:void 0,t[4]=n,t[5]=c):c=t[5];const l=!!e;let f;t[6]!==a||t[7]!==o||t[8]!==c||t[9]!==l?(f={queryKey:a,queryFn:o,initialPageParam:null,getNextPageParam:ss,initialData:c,enabled:l},t[6]=a,t[7]=o,t[8]=c,t[9]=l,t[10]=f):f=t[10];const{data:u,fetchNextPage:d,hasNextPage:g,isFetchingNextPage:m,isLoading:p,refetch:M}=re(f);let _;t[11]!==u?.pages?(_=u?.pages.flatMap(ns)||[],t[11]=u?.pages,t[12]=_):_=t[12];const w=_;let P;t[13]!==r||t[14]!==e?(P=async v=>{const{userId:b,content:L,media:B,replyToId:Q}=v;if(!r)throw new Error("User not authenticated");return mt(e,b,L,B,Q)},t[13]=r,t[14]=e,t[15]=P):P=t[15];let D;t[16]!==r||t[17]!==s||t[18]!==e||t[19]!==i?(D=async v=>{if(!r)return;const b=["comments",e,s];await i.cancelQueries({queryKey:b});const L=i.getQueryData(b),B={id:`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,post_id:e,user_id:r.id,content:v.content,media:v.media||null,created_at:new Date().toISOString(),parent_id:v.replyToId||s||null,stats:{likes:0,comments:0,reposts:0},user:r,timeAgo:"Just now"};return i.setQueryData(b,Q=>Q?{...Q,pages:[[B,...Q.pages[0]],...Q.pages.slice(1)]}:{pages:[[B]],pageParams:[null]}),{previousComments:L}},t[16]=r,t[17]=s,t[18]=e,t[19]=i,t[20]=D):D=t[20];let h,A;t[21]!==s||t[22]!==e||t[23]!==i?(h=(v,b,L)=>{const B=["comments",e,s];L?.previousComments&&i.setQueryData(B,L.previousComments)},A=()=>{const v=["comments",e,s];i.invalidateQueries({queryKey:v}),i.invalidateQueries({queryKey:["post",e]})},t[21]=s,t[22]=e,t[23]=i,t[24]=h,t[25]=A):(h=t[24],A=t[25]);let y;t[26]!==P||t[27]!==D||t[28]!==h||t[29]!==A?(y={mutationFn:P,onMutate:D,onError:h,onSettled:A},t[26]=P,t[27]=D,t[28]=h,t[29]=A,t[30]=y):y=t[30];const F=ce(y);let S;t[31]!==e||t[32]!==i?(S={mutationFn:is,onSuccess:()=>{i.invalidateQueries({queryKey:["comments",e]}),i.invalidateQueries({queryKey:["post",e]})}},t[31]=e,t[32]=i,t[33]=S):S=t[33];const $=ce(S);let k;t[34]!==e||t[35]!==i?(k={mutationFn:rs,onSuccess:()=>{i.invalidateQueries({queryKey:["comments",e]})}},t[34]=e,t[35]=i,t[36]=k):k=t[36];const T=ce(k);let x;t[37]!==w?(x=w||[],t[37]=w,t[38]=x):x=t[38];let C;return t[39]!==F.isPending||t[40]!==F.mutateAsync||t[41]!==$.mutateAsync||t[42]!==d||t[43]!==g||t[44]!==m||t[45]!==p||t[46]!==M||t[47]!==x||t[48]!==T.mutateAsync?(C={comments:x,fetchNextPage:d,hasNextPage:g,isFetchingNextPage:m,isLoading:p,refetch:M,addComment:F.mutateAsync,deleteComment:$.mutateAsync,updateComment:T.mutateAsync,isSubmitting:F.isPending},t[39]=F.isPending,t[40]=F.mutateAsync,t[41]=$.mutateAsync,t[42]=d,t[43]=g,t[44]=m,t[45]=p,t[46]=M,t[47]=x,t[48]=T.mutateAsync,t[49]=C):C=t[49],C};function ss(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function ns(e){return e}async function is(e){return gt(e)}async function rs(e){const{commentId:n,content:s,media:t}=e;return Rt(n,{content:s,media:t})}var as=te();const On=()=>{const e=(0,as.c)(53),{handle:n}=Ae(),s=he(),{currentUser:t}=fe(),{addToast:i}=_e();let r,a;e[0]!==n?(r=["profile",n],a=()=>et(n),e[0]=n,e[1]=r,e[2]=a):(r=e[1],a=e[2]);const o=!!n;let c;e[3]!==r||e[4]!==a||e[5]!==o?(c={queryKey:r,queryFn:a,enabled:o,staleTime:3e5},e[3]=r,e[4]=a,e[5]=o,e[6]=c):c=e[6];const{data:l,isLoading:f}=ye(c),[u,d]=(0,J.useState)("feed"),g=l?.id;let m;e[7]!==g?(m=["posts","user",g],e[7]=g,e[8]=m):m=e[8];let p;e[9]!==l?(p=E=>{const{pageParam:H}=E;return Mt(l.id,H,20)},e[9]=l,e[10]=p):p=e[10];const M=!!l?.id;let _;e[11]!==m||e[12]!==p||e[13]!==M?(_={queryKey:m,queryFn:p,enabled:M,initialPageParam:null,getNextPageParam:os},e[11]=m,e[12]=p,e[13]=M,e[14]=_):_=e[14];const{data:w,fetchNextPage:P,hasNextPage:D,isFetchingNextPage:h,isLoading:A}=re(_);let y;e[15]!==w?.pages?(y=w?.pages.flatMap(cs)||[],e[15]=w?.pages,e[16]=y):y=e[16];const F=y,[S,$]=(0,J.useState)(!1),[k,T]=(0,J.useState)("Followers"),{followList:x,fetchNextPage:C,hasNextPage:v,isFetchingNextPage:b,isLoading:L}=kt(l?.id,k,S);let B;e[17]===Symbol.for("react.memo_cache_sentinel")?(B=E=>{T(E),$(!0)},e[17]=B):B=e[17];const Q=B;let V;e:{if(u==="feed"){let E;e[18]!==F?(E=F.filter(ls),e[18]=F,e[19]=E):E=e[19],V=E;break e}if(u==="media"){let E;e[20]!==F?(E=F.filter(us),e[20]=F,e[21]=E):E=e[21],V=E;break e}if(u==="collections"){let E;e[22]===Symbol.for("react.memo_cache_sentinel")?(E=[],e[22]=E):E=e[22],V=E;break e}V=F}const Z=V;let G;e[23]!==s?(G=E=>{s(`/p/${E}`)},e[23]=s,e[24]=G):G=e[24];const I=G;let X;e[25]!==n||e[26]!==s?(X=E=>{E!==n&&s(`/u/${E}`)},e[25]=n,e[26]=s,e[27]=X):X=e[27];const j=X;let N;e[28]!==P?(N=()=>{P()},e[28]=P,e[29]=N):N=e[29];const q=N;let K;return e[30]!==u||e[31]!==i||e[32]!==t||e[33]!==C||e[34]!==Z||e[35]!==x||e[36]!==k||e[37]!==n||e[38]!==I||e[39]!==j||e[40]!==v||e[41]!==D||e[42]!==b||e[43]!==h||e[44]!==S||e[45]!==L||e[46]!==q||e[47]!==A||e[48]!==f||e[49]!==s||e[50]!==l||e[51]!==F?(K={handle:n,profile:l,loading:f,userPosts:F,setUserPosts:fs,activeProfileTab:u,setActiveProfileTab:d,loadingPosts:A,isFetchingMorePosts:h,hasMorePosts:D,filteredPosts:Z,isFollowModalOpen:S,setIsFollowModalOpen:$,followModalType:k,followListData:x,isListLoading:L,isFetchingMoreFollows:b,hasMoreFollows:v,openFollowModal:Q,fetchNextFollows:C,handlePostClick:I,handleUserClick:j,loadUserPosts:q,currentUser:t,addToast:i,navigate:s},e[30]=u,e[31]=i,e[32]=t,e[33]=C,e[34]=Z,e[35]=x,e[36]=k,e[37]=n,e[38]=I,e[39]=j,e[40]=v,e[41]=D,e[42]=b,e[43]=h,e[44]=S,e[45]=L,e[46]=q,e[47]=A,e[48]=f,e[49]=s,e[50]=l,e[51]=F,e[52]=K):K=e[52],K};function os(e){if(!(!e||e.length<20))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function cs(e){return e}function ls(e){return e.community_id===null&&e.parent_id===null}function us(e){return e.community_id===null&&e.parent_id===null&&(e.type==="video"||e.type==="image"||e.media&&e.media.length>0)}function fs(){return console.warn("setUserPosts is deprecated")}var ds=te();const jn=()=>{const e=(0,ds.c)(75),{handle:n}=Ae(),s=he(),{currentUser:t}=fe(),{addToast:i}=_e(),r=me();let a,o;e[0]!==n?(a=["community",n],o=()=>At(n),e[0]=n,e[1]=a,e[2]=o):(a=e[1],o=e[2]);const c=!!n;let l;e[3]!==a||e[4]!==o||e[5]!==c?(l={queryKey:a,queryFn:o,enabled:c,staleTime:6e5},e[3]=a,e[4]=o,e[5]=c,e[6]=l):l=e[6];const{data:f,isLoading:u,refetch:d}=ye(l),g=f?.id,m=t?.id;let p;e[7]!==g||e[8]!==m?(p=["community",g,"membership",m],e[7]=g,e[8]=m,e[9]=p):p=e[9];let M;e[10]!==f||e[11]!==t?(M=()=>wt(f.id,t.id),e[10]=f,e[11]=t,e[12]=M):M=e[12];const _=!!f?.id&&!!t?.id;let w;e[13]!==p||e[14]!==M||e[15]!==_?(w={queryKey:p,queryFn:M,enabled:_,staleTime:3e5},e[13]=p,e[14]=M,e[15]=_,e[16]=w):w=e[16];const{data:P}=ye(w),D=!!P,h=P?.role||null,A=f?.id;let y;e[17]!==A?(y=["posts","community",A],e[17]=A,e[18]=y):y=e[18];let F;e[19]!==f?(F=K=>{const{pageParam:E}=K;return ft(f.id,E,10)},e[19]=f,e[20]=F):F=e[20];const S=!!f?.id;let $;e[21]!==y||e[22]!==F||e[23]!==S?($={queryKey:y,queryFn:F,enabled:S,initialPageParam:null,getNextPageParam:hs},e[21]=y,e[22]=F,e[23]=S,e[24]=$):$=e[24];const{data:k,fetchNextPage:T,hasNextPage:x,isFetchingNextPage:C,isLoading:v}=re($);let b;e[25]!==k?.pages?(b=k?.pages.flatMap(ms)||[],e[25]=k?.pages,e[26]=b):b=e[26];const L=b;let B;e[27]!==f||e[28]!==t?(B=()=>St(f.id,t.id),e[27]=f,e[28]=t,e[29]=B):B=e[29];let Q;e[30]!==f||e[31]!==t||e[32]!==n||e[33]!==r?(Q=async()=>{const K=f.id,E=t.id;await r.cancelQueries({queryKey:["community",K,"membership",E]}),await r.cancelQueries({queryKey:["community",n]});const H=r.getQueryData(["community",K,"membership",E]),ee=r.getQueryData(["community",n]);return r.setQueryData(["community",K,"membership",E],H?null:{role:"member"}),r.setQueryData(["community",n],R=>R&&{...R,membersCount:H?R.membersCount-1:R.membersCount+1}),{previousMembership:H,previousCommunity:ee}},e[30]=f,e[31]=t,e[32]=n,e[33]=r,e[34]=Q):Q=e[34];let V;e[35]!==i||e[36]!==f||e[37]!==t||e[38]!==n||e[39]!==r?(V=(K,E,H)=>{H?.previousMembership!==void 0&&r.setQueryData(["community",f.id,"membership",t.id],H.previousMembership),H?.previousCommunity&&r.setQueryData(["community",n],H.previousCommunity),i("Failed to update membership","error")},e[35]=i,e[36]=f,e[37]=t,e[38]=n,e[39]=r,e[40]=V):V=e[40];let Z;e[41]!==f?.id||e[42]!==t?.id||e[43]!==n||e[44]!==r?(Z=()=>{r.invalidateQueries({queryKey:["community",f?.id,"membership",t?.id]}),r.invalidateQueries({queryKey:["community",n]})},e[41]=f?.id,e[42]=t?.id,e[43]=n,e[44]=r,e[45]=Z):Z=e[45];let G;e[46]!==i||e[47]!==f?(G=K=>{f&&i(K?`Joined ${f.name}`:`Left ${f.name}`)},e[46]=i,e[47]=f,e[48]=G):G=e[48];let I;e[49]!==B||e[50]!==Q||e[51]!==V||e[52]!==Z||e[53]!==G?(I={mutationFn:B,onMutate:Q,onError:V,onSettled:Z,onSuccess:G},e[49]=B,e[50]=Q,e[51]=V,e[52]=Z,e[53]=G,e[54]=I):I=e[54];const X=ce(I);let j;e[55]!==i||e[56]!==t||e[57]!==X?(j=async()=>{if(!t)return i("Please login to join communities","error");X.mutate()},e[55]=i,e[56]=t,e[57]=X,e[58]=j):j=e[58];const N=j;let q;return e[59]!==i||e[60]!==f||e[61]!==L||e[62]!==t||e[63]!==T||e[64]!==N||e[65]!==x||e[66]!==C||e[67]!==D||e[68]!==X.isPending||e[69]!==u||e[70]!==v||e[71]!==s||e[72]!==d||e[73]!==h?(q={community:f,loading:u,isMember:D,userRole:h,isJoining:X.isPending,communityPosts:L,loadingPosts:v,isFetchingMorePosts:C,hasMorePosts:x,handleJoinToggle:N,loadCommunityPosts:T,refetchCommunity:d,currentUser:t,addToast:i,navigate:s},e[59]=i,e[60]=f,e[61]=L,e[62]=t,e[63]=T,e[64]=N,e[65]=x,e[66]=C,e[67]=D,e[68]=X.isPending,e[69]=u,e[70]=v,e[71]=s,e[72]=d,e[73]=h,e[74]=q):q=e[74],q};function hs(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function ms(e){return e}function ue(e){return Array.isArray?Array.isArray(e):ze(e)==="[object Array]"}var gs=1/0;function ps(e){if(typeof e=="string")return e;let n=e+"";return n=="0"&&1/e==-gs?"-0":n}function ys(e){return e==null?"":ps(e)}function oe(e){return typeof e=="string"}function Oe(e){return typeof e=="number"}function _s(e){return e===!0||e===!1||Ms(e)&&ze(e)=="[object Boolean]"}function je(e){return typeof e=="object"}function Ms(e){return je(e)&&e!==null}function ne(e){return e!=null}function be(e){return!e.trim().length}function ze(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}var As="Incorrect 'index' type",Fs=e=>`Invalid value for key ${e}`,Ps=e=>`Pattern length exceeds max of ${e}.`,ws=e=>`Missing ${e} property in key`,Es=e=>`Property 'weight' in key '${e}' must be a positive integer`,ke=Object.prototype.hasOwnProperty,Ds=class{constructor(e){this._keys=[],this._keyMap={};let n=0;e.forEach(s=>{let t=We(s);this._keys.push(t),this._keyMap[t.id]=t,n+=t.weight}),this._keys.forEach(s=>{s.weight/=n})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}};function We(e){let n=null,s=null,t=null,i=1,r=null;if(oe(e)||ue(e))t=e,n=Ne(e),s=ve(e);else{if(!ke.call(e,"name"))throw new Error(ws("name"));const a=e.name;if(t=a,ke.call(e,"weight")&&(i=e.weight,i<=0))throw new Error(Es(a));n=Ne(a),s=ve(a),r=e.getFn}return{path:n,id:s,weight:i,src:t,getFn:r}}function Ne(e){return ue(e)?e:e.split(".")}function ve(e){return ue(e)?e.join("."):e}function bs(e,n){let s=[],t=!1;const i=(r,a,o)=>{if(ne(r))if(!a[o])s.push(r);else{const c=r[a[o]];if(!ne(c))return;if(o===a.length-1&&(oe(c)||Oe(c)||_s(c)))s.push(ys(c));else if(ue(c)){t=!0;for(let l=0,f=c.length;l<f;l+=1)i(c[l],a,o+1)}else a.length&&i(c,a,o+1)}};return i(e,oe(n)?n.split("."):n,0),t?s:s[0]}var Ss={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},vs={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,n)=>e.score===n.score?e.idx<n.idx?-1:1:e.score<n.score?-1:1},xs={location:0,threshold:.6,distance:100},Cs={useExtendedSearch:!1,getFn:bs,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1},O={...vs,...Ss,...xs,...Cs},Rs=/[^ ]+/g;function $s(e=1,n=3){const s=new Map,t=Math.pow(10,n);return{get(i){const r=i.match(Rs).length;if(s.has(r))return s.get(r);const a=1/Math.pow(r,.5*e),o=parseFloat(Math.round(a*t)/t);return s.set(r,o),o},clear(){s.clear()}}}var Be=class{constructor({getFn:e=O.getFn,fieldNormWeight:n=O.fieldNormWeight}={}){this.norm=$s(n,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((n,s)=>{this._keysMap[n.id]=s})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,oe(this.docs[0])?this.docs.forEach((e,n)=>{this._addString(e,n)}):this.docs.forEach((e,n)=>{this._addObject(e,n)}),this.norm.clear())}add(e){const n=this.size();oe(e)?this._addString(e,n):this._addObject(e,n)}removeAt(e){this.records.splice(e,1);for(let n=e,s=this.size();n<s;n+=1)this.records[n].i-=1}getValueForItemAtKeyId(e,n){return e[this._keysMap[n]]}size(){return this.records.length}_addString(e,n){if(!ne(e)||be(e))return;let s={v:e,i:n,n:this.norm.get(e)};this.records.push(s)}_addObject(e,n){let s={i:n,$:{}};this.keys.forEach((t,i)=>{let r=t.getFn?t.getFn(e):this.getFn(e,t.path);if(ne(r)){if(ue(r)){let a=[];const o=[{nestedArrIndex:-1,value:r}];for(;o.length;){const{nestedArrIndex:c,value:l}=o.pop();if(ne(l))if(oe(l)&&!be(l)){let f={v:l,i:c,n:this.norm.get(l)};a.push(f)}else ue(l)&&l.forEach((f,u)=>{o.push({nestedArrIndex:u,value:f})})}s.$[i]=a}else if(oe(r)&&!be(r)){let a={v:r,n:this.norm.get(r)};s.$[i]=a}}}),this.records.push(s)}toJSON(){return{keys:this.keys,records:this.records}}};function Ve(e,n,{getFn:s=O.getFn,fieldNormWeight:t=O.fieldNormWeight}={}){const i=new Be({getFn:s,fieldNormWeight:t});return i.setKeys(e.map(We)),i.setSources(n),i.create(),i}function Ls(e,{getFn:n=O.getFn,fieldNormWeight:s=O.fieldNormWeight}={}){const{keys:t,records:i}=e,r=new Be({getFn:n,fieldNormWeight:s});return r.setKeys(t),r.setIndexRecords(i),r}function Fe(e,{errors:n=0,currentLocation:s=0,expectedLocation:t=0,distance:i=O.distance,ignoreLocation:r=O.ignoreLocation}={}){const a=n/e.length;if(r)return a;const o=Math.abs(t-s);return i?a+o/i:o?1:a}function Bs(e=[],n=O.minMatchCharLength){let s=[],t=-1,i=-1,r=0;for(let a=e.length;r<a;r+=1){let o=e[r];o&&t===-1?t=r:!o&&t!==-1&&(i=r-1,i-t+1>=n&&s.push([t,i]),t=-1)}return e[r-1]&&r-t>=n&&s.push([t,r-1]),s}var pe=32;function ks(e,n,s,{location:t=O.location,distance:i=O.distance,threshold:r=O.threshold,findAllMatches:a=O.findAllMatches,minMatchCharLength:o=O.minMatchCharLength,includeMatches:c=O.includeMatches,ignoreLocation:l=O.ignoreLocation}={}){if(n.length>pe)throw new Error(Ps(pe));const f=n.length,u=e.length,d=Math.max(0,Math.min(t,u));let g=r,m=d;const p=o>1||c,M=p?Array(u):[];let _;for(;(_=e.indexOf(n,m))>-1;){let y=Fe(n,{currentLocation:_,expectedLocation:d,distance:i,ignoreLocation:l});if(g=Math.min(y,g),m=_+f,p){let F=0;for(;F<f;)M[_+F]=1,F+=1}}m=-1;let w=[],P=1,D=f+u;const h=1<<f-1;for(let y=0;y<f;y+=1){let F=0,S=D;for(;F<S;)Fe(n,{errors:y,currentLocation:d+S,expectedLocation:d,distance:i,ignoreLocation:l})<=g?F=S:D=S,S=Math.floor((D-F)/2+F);D=S;let $=Math.max(1,d-S+1),k=a?u:Math.min(d+S,u)+f,T=Array(k+2);T[k+1]=(1<<y)-1;for(let x=k;x>=$;x-=1){let C=x-1,v=s[e.charAt(C)];if(p&&(M[C]=+!!v),T[x]=(T[x+1]<<1|1)&v,y&&(T[x]|=(w[x+1]|w[x])<<1|1|w[x+1]),T[x]&h&&(P=Fe(n,{errors:y,currentLocation:C,expectedLocation:d,distance:i,ignoreLocation:l}),P<=g)){if(g=P,m=C,m<=d)break;$=Math.max(1,2*d-m)}}if(Fe(n,{errors:y+1,currentLocation:d,expectedLocation:d,distance:i,ignoreLocation:l})>g)break;w=T}const A={isMatch:m>=0,score:Math.max(.001,P)};if(p){const y=Bs(M,o);y.length?c&&(A.indices=y):A.isMatch=!1}return A}function Ns(e){let n={};for(let s=0,t=e.length;s<t;s+=1){const i=e.charAt(s);n[i]=(n[i]||0)|1<<t-s-1}return n}var Pe=String.prototype.normalize?(e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,"")):(e=>e),Je=class{constructor(e,{location:n=O.location,threshold:s=O.threshold,distance:t=O.distance,includeMatches:i=O.includeMatches,findAllMatches:r=O.findAllMatches,minMatchCharLength:a=O.minMatchCharLength,isCaseSensitive:o=O.isCaseSensitive,ignoreDiacritics:c=O.ignoreDiacritics,ignoreLocation:l=O.ignoreLocation}={}){if(this.options={location:n,threshold:s,distance:t,includeMatches:i,findAllMatches:r,minMatchCharLength:a,isCaseSensitive:o,ignoreDiacritics:c,ignoreLocation:l},e=o?e:e.toLowerCase(),e=c?Pe(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const f=(d,g)=>{this.chunks.push({pattern:d,alphabet:Ns(d),startIndex:g})},u=this.pattern.length;if(u>pe){let d=0;const g=u%pe,m=u-g;for(;d<m;)f(this.pattern.substr(d,pe),d),d+=pe;if(g){const p=u-pe;f(this.pattern.substr(p),p)}}else f(this.pattern,0)}searchIn(e){const{isCaseSensitive:n,ignoreDiacritics:s,includeMatches:t}=this.options;if(e=n?e:e.toLowerCase(),e=s?Pe(e):e,this.pattern===e){let m={isMatch:!0,score:0};return t&&(m.indices=[[0,e.length-1]]),m}const{location:i,distance:r,threshold:a,findAllMatches:o,minMatchCharLength:c,ignoreLocation:l}=this.options;let f=[],u=0,d=!1;this.chunks.forEach(({pattern:m,alphabet:p,startIndex:M})=>{const{isMatch:_,score:w,indices:P}=ks(e,m,p,{location:i+M,distance:r,threshold:a,findAllMatches:o,minMatchCharLength:c,includeMatches:t,ignoreLocation:l});_&&(d=!0),u+=w,_&&P&&(f=[...f,...P])});let g={isMatch:d,score:d?u/this.chunks.length:1};return d&&t&&(g.indices=f),g}},ge=class{constructor(e){this.pattern=e}static isMultiMatch(e){return Te(e,this.multiRegex)}static isSingleMatch(e){return Te(e,this.singleRegex)}search(){}};function Te(e,n){const s=e.match(n);return s?s[1]:null}var Ts=class extends ge{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const n=e===this.pattern;return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}},qs=class extends ge{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const n=e.indexOf(this.pattern)===-1;return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}},Qs=class extends ge{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const n=e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}},Ks=class extends ge{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const n=!e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}},Os=class extends ge{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const n=e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[e.length-this.pattern.length,e.length-1]}}},js=class extends ge{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const n=!e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}},He=class extends ge{constructor(e,{location:n=O.location,threshold:s=O.threshold,distance:t=O.distance,includeMatches:i=O.includeMatches,findAllMatches:r=O.findAllMatches,minMatchCharLength:a=O.minMatchCharLength,isCaseSensitive:o=O.isCaseSensitive,ignoreDiacritics:c=O.ignoreDiacritics,ignoreLocation:l=O.ignoreLocation}={}){super(e),this._bitapSearch=new Je(e,{location:n,threshold:s,distance:t,includeMatches:i,findAllMatches:r,minMatchCharLength:a,isCaseSensitive:o,ignoreDiacritics:c,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}},Ge=class extends ge{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let n=0,s;const t=[],i=this.pattern.length;for(;(s=e.indexOf(this.pattern,n))>-1;)n=s+i,t.push([s,n-1]);const r=!!t.length;return{isMatch:r,score:r?0:1,indices:t}}},xe=[Ts,Ge,Qs,Ks,js,Os,qs,He],qe=xe.length,zs=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Ws="|";function Vs(e,n={}){return e.split(Ws).map(s=>{let t=s.trim().split(zs).filter(r=>r&&!!r.trim()),i=[];for(let r=0,a=t.length;r<a;r+=1){const o=t[r];let c=!1,l=-1;for(;!c&&++l<qe;){const f=xe[l];let u=f.isMultiMatch(o);u&&(i.push(new f(u,n)),c=!0)}if(!c)for(l=-1;++l<qe;){const f=xe[l];let u=f.isSingleMatch(o);if(u){i.push(new f(u,n));break}}}return i})}var Js=new Set([He.type,Ge.type]),Hs=class{constructor(e,{isCaseSensitive:n=O.isCaseSensitive,ignoreDiacritics:s=O.ignoreDiacritics,includeMatches:t=O.includeMatches,minMatchCharLength:i=O.minMatchCharLength,ignoreLocation:r=O.ignoreLocation,findAllMatches:a=O.findAllMatches,location:o=O.location,threshold:c=O.threshold,distance:l=O.distance}={}){this.query=null,this.options={isCaseSensitive:n,ignoreDiacritics:s,includeMatches:t,minMatchCharLength:i,findAllMatches:a,ignoreLocation:r,location:o,threshold:c,distance:l},e=n?e:e.toLowerCase(),e=s?Pe(e):e,this.pattern=e,this.query=Vs(this.pattern,this.options)}static condition(e,n){return n.useExtendedSearch}searchIn(e){const n=this.query;if(!n)return{isMatch:!1,score:1};const{includeMatches:s,isCaseSensitive:t,ignoreDiacritics:i}=this.options;e=t?e:e.toLowerCase(),e=i?Pe(e):e;let r=0,a=[],o=0;for(let c=0,l=n.length;c<l;c+=1){const f=n[c];a.length=0,r=0;for(let u=0,d=f.length;u<d;u+=1){const g=f[u],{isMatch:m,indices:p,score:M}=g.search(e);if(m){if(r+=1,o+=M,s){const _=g.constructor.type;Js.has(_)?a=[...a,...p]:a.push(p)}}else{o=0,r=0,a.length=0;break}}if(r){let u={isMatch:!0,score:o/r};return s&&(u.indices=a),u}}return{isMatch:!1,score:1}}},Ce=[];function Gs(...e){Ce.push(...e)}function Re(e,n){for(let s=0,t=Ce.length;s<t;s+=1){let i=Ce[s];if(i.condition(e,n))return new i(e,n)}return new Je(e,n)}var we={AND:"$and",OR:"$or"},$e={PATH:"$path",PATTERN:"$val"},Le=e=>!!(e[we.AND]||e[we.OR]),Ys=e=>!!e[$e.PATH],Xs=e=>!ue(e)&&je(e)&&!Le(e),Qe=e=>({[we.AND]:Object.keys(e).map(n=>({[n]:e[n]}))});function Ye(e,n,{auto:s=!0}={}){const t=i=>{let r=Object.keys(i);const a=Ys(i);if(!a&&r.length>1&&!Le(i))return t(Qe(i));if(Xs(i)){const c=a?i[$e.PATH]:r[0],l=a?i[$e.PATTERN]:i[c];if(!oe(l))throw new Error(Fs(c));const f={keyId:ve(c),pattern:l};return s&&(f.searcher=Re(l,n)),f}let o={children:[],operator:r[0]};return r.forEach(c=>{const l=i[c];ue(l)&&l.forEach(f=>{o.children.push(t(f))})}),o};return Le(e)||(e=Qe(e)),t(e)}function Zs(e,{ignoreFieldNorm:n=O.ignoreFieldNorm}){e.forEach(s=>{let t=1;s.matches.forEach(({key:i,norm:r,score:a})=>{const o=i?i.weight:null;t*=Math.pow(a===0&&o?Number.EPSILON:a,(o||1)*(n?1:r))}),s.score=t})}function Is(e,n){const s=e.matches;n.matches=[],ne(s)&&s.forEach(t=>{if(!ne(t.indices)||!t.indices.length)return;const{indices:i,value:r}=t;let a={indices:i,value:r};t.key&&(a.key=t.key.src),t.idx>-1&&(a.refIndex=t.idx),n.matches.push(a)})}function Us(e,n){n.score=e.score}function en(e,n,{includeMatches:s=O.includeMatches,includeScore:t=O.includeScore}={}){const i=[];return s&&i.push(Is),t&&i.push(Us),e.map(r=>{const{idx:a}=r,o={item:n[a],refIndex:a};return i.length&&i.forEach(c=>{c(r,o)}),o})}var Me=class{constructor(e,n={},s){this.options={...O,...n},this.options.useExtendedSearch,this._keyStore=new Ds(this.options.keys),this.setCollection(e,s)}setCollection(e,n){if(this._docs=e,n&&!(n instanceof Be))throw new Error(As);this._myIndex=n||Ve(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){ne(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const n=[];for(let s=0,t=this._docs.length;s<t;s+=1){const i=this._docs[s];e(i,s)&&(this.removeAt(s),s-=1,t-=1,n.push(i))}return n}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:n=-1}={}){const{includeMatches:s,includeScore:t,shouldSort:i,sortFn:r,ignoreFieldNorm:a}=this.options;let o=oe(e)?oe(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Zs(o,{ignoreFieldNorm:a}),i&&o.sort(r),Oe(n)&&n>-1&&(o=o.slice(0,n)),en(o,this._docs,{includeMatches:s,includeScore:t})}_searchStringList(e){const n=Re(e,this.options),{records:s}=this._myIndex,t=[];return s.forEach(({v:i,i:r,n:a})=>{if(!ne(i))return;const{isMatch:o,score:c,indices:l}=n.searchIn(i);o&&t.push({item:i,idx:r,matches:[{score:c,value:i,norm:a,indices:l}]})}),t}_searchLogical(e){const n=Ye(e,this.options),s=(a,o,c)=>{if(!a.children){const{keyId:f,searcher:u}=a,d=this._findMatches({key:this._keyStore.get(f),value:this._myIndex.getValueForItemAtKeyId(o,f),searcher:u});return d&&d.length?[{idx:c,item:o,matches:d}]:[]}const l=[];for(let f=0,u=a.children.length;f<u;f+=1){const d=a.children[f],g=s(d,o,c);if(g.length)l.push(...g);else if(a.operator===we.AND)return[]}return l},t=this._myIndex.records,i={},r=[];return t.forEach(({$:a,i:o})=>{if(ne(a)){let c=s(n,a,o);c.length&&(i[o]||(i[o]={idx:o,item:a,matches:[]},r.push(i[o])),c.forEach(({matches:l})=>{i[o].matches.push(...l)}))}}),r}_searchObjectList(e){const n=Re(e,this.options),{keys:s,records:t}=this._myIndex,i=[];return t.forEach(({$:r,i:a})=>{if(!ne(r))return;let o=[];s.forEach((c,l)=>{o.push(...this._findMatches({key:c,value:r[l],searcher:n}))}),o.length&&i.push({idx:a,item:r,matches:o})}),i}_findMatches({key:e,value:n,searcher:s}){if(!ne(n))return[];let t=[];if(ue(n))n.forEach(({v:i,i:r,n:a})=>{if(!ne(i))return;const{isMatch:o,score:c,indices:l}=s.searchIn(i);o&&t.push({score:c,key:e,value:i,idx:r,norm:a,indices:l})});else{const{v:i,n:r}=n,{isMatch:a,score:o,indices:c}=s.searchIn(i);a&&t.push({score:o,key:e,value:i,norm:r,indices:c})}return t}};Me.version="7.1.0";Me.createIndex=Ve;Me.parseIndex=Ls;Me.config=O;Me.parseQuery=Ye;Gs(Hs);var tn=te();const zn=()=>{const e=(0,tn.c)(60),{currentUser:n}=fe(),s=he(),[t,i]=Ke();let r;e[0]!==t?(r=t.get("q")||"",e[0]=t,e[1]=r):r=e[1];const a=r;let o;e[2]!==t||e[3]!==a?(o=t.get("tab")||(a?"posts":"communities"),e[2]=t,e[3]=a,e[4]=o):o=e[4];const c=o,[l,f]=(0,J.useState)(!1);let u,d;e[5]!==a?(u=["explore","users",a],d=()=>a?Se(a):Se(""),e[5]=a,e[6]=u,e[7]=d):(u=e[6],d=e[7]);const g=c==="users";let m;e[8]!==u||e[9]!==d||e[10]!==g?(m={queryKey:u,queryFn:d,enabled:g,initialPageParam:null,getNextPageParam:sn},e[8]=u,e[9]=d,e[10]=g,e[11]=m):m=e[11];const{data:p,fetchNextPage:M,hasNextPage:_,isFetchingNextPage:w,isLoading:P}=re(m);let D;e[12]!==p?.pages?(D=p?.pages.flatMap(nn)||[],e[12]=p?.pages,e[13]=D):D=e[13];const h=D;let A;e[14]===Symbol.for("react.memo_cache_sentinel")?(A=["explore","communities"],e[14]=A):A=e[14];let y;e[15]===Symbol.for("react.memo_cache_sentinel")?(y={queryKey:A,queryFn:rn,initialPageParam:null,getNextPageParam:an},e[15]=y):y=e[15];const{data:F,fetchNextPage:S,hasNextPage:$,isFetchingNextPage:k,isLoading:T}=re(y);let x;e[16]!==F?.pages?(x=F?.pages.flatMap(on)||[],e[16]=F?.pages,e[17]=x):x=e[17];const C=x;let v,b;e[18]!==a?(v=["explore","posts",a],b=z=>{const{pageParam:U}=z;return a?Ct(a,U,20,!1):Et(U,20)},e[18]=a,e[19]=v,e[20]=b):(v=e[19],b=e[20]);let L;e[21]!==v||e[22]!==b?(L={queryKey:v,queryFn:b,initialPageParam:null,getNextPageParam:cn},e[21]=v,e[22]=b,e[23]=L):L=e[23];const{data:B,fetchNextPage:Q,hasNextPage:V,isFetchingNextPage:Z,isLoading:G}=re(L);let I;e[24]!==B?.pages?(I=B?.pages.flatMap(ln)||[],e[24]=B?.pages,e[25]=I):I=e[25];const X=I;let j;e:{if(!a.trim()){j=C;break e}let z;e[26]!==C||e[27]!==a?(z=new Me(C,{keys:["name","handle","description"],threshold:.3,ignoreLocation:!0}).search(a).map(un),e[26]=C,e[27]=a,e[28]=z):z=e[28],j=z}const N=j;let q;e[29]!==s?(q=z=>{s(`/c/${z}`)},e[29]=s,e[30]=q):q=e[30];const K=q;let E;e[31]!==i?(E=z=>{i(U=>(z?U.set("q",z):U.delete("q"),U),{replace:!0})},e[31]=i,e[32]=E):E=e[32];const H=E;let ee;e[33]!==i?(ee=z=>{i(U=>(U.set("tab",z),U),{replace:!0})},e[33]=i,e[34]=ee):ee=e[34];const R=ee;let Y;return e[35]!==c||e[36]!==C||e[37]!==n||e[38]!==S||e[39]!==Q||e[40]!==M||e[41]!==N||e[42]!==K||e[43]!==H||e[44]!==R||e[45]!==$||e[46]!==V||e[47]!==_||e[48]!==T||e[49]!==l||e[50]!==k||e[51]!==Z||e[52]!==w||e[53]!==G||e[54]!==P||e[55]!==s||e[56]!==X||e[57]!==a||e[58]!==h?(Y={currentUser:n,searchQuery:a,setSearchQuery:H,activeTab:c,setActiveTab:R,isCreateModalOpen:l,setIsCreateModalOpen:f,communitiesData:C,isCommunitiesLoading:T,isFetchingMoreCommunities:k,hasMoreCommunities:$,postsData:X,isPostsLoading:G,isFetchingMorePosts:Z,hasMorePosts:V,filteredCommunities:N,usersData:h,isUsersLoading:P,hasMoreUsers:_,isFetchingMoreUsers:w,handleCommunityClick:K,loadCommunities:S,loadPosts:Q,loadUsers:M,navigate:s},e[35]=c,e[36]=C,e[37]=n,e[38]=S,e[39]=Q,e[40]=M,e[41]=N,e[42]=K,e[43]=H,e[44]=R,e[45]=$,e[46]=V,e[47]=_,e[48]=T,e[49]=l,e[50]=k,e[51]=Z,e[52]=w,e[53]=G,e[54]=P,e[55]=s,e[56]=X,e[57]=a,e[58]=h,e[59]=Y):Y=e[59],Y};function sn(){}function nn(e){return e}function rn(e){const{pageParam:n}=e;return bt(n,10)}function an(e){if(!(!e||e.length<10))return e[e.length-1].createdAt}function on(e){return e}function cn(e){if(!(!e||e.length<20))return e[e.length-1].sort_timestamp}function ln(e){return e}function un(e){return e.item}var fn=te();const Wn=()=>{const e=(0,fn.c)(21),{currentUser:n}=fe(),{posts:s,loading:t,hasMore:i,isFetchingNextPage:r,fetchNextPage:a,refreshPosts:o}=rt(),{addToast:c}=_e(),l=he();let f;e[0]===Symbol.for("react.memo_cache_sentinel")?(f=["stories"],e[0]=f):f=e[0];let u;e[1]===Symbol.for("react.memo_cache_sentinel")?(u={queryKey:f,queryFn:dn,initialPageParam:null,getNextPageParam:hn,refetchInterval:6e4},e[1]=u):u=e[1];const{data:d,isLoading:g}=re(u);let m;if(e[2]!==d?.pages){const h=d?.pages.flatMap(mn)||[],A=JSON.parse(localStorage.getItem("seenStories")||"[]");m=h.reduce(gn,[]).map(y=>({...y,isSeen:A.includes(y.user.id)})),e[2]=d?.pages,e[3]=m}else m=e[3];const p=m;let M;e[4]!==l?(M=h=>{l(`/p/${h}`)},e[4]=l,e[5]=M):M=e[5];const _=M;let w;e[6]!==l?(w=h=>{l(`/u/${h}`)},e[6]=l,e[7]=w):w=e[7];const P=w;let D;return e[8]!==c||e[9]!==n||e[10]!==a||e[11]!==p||e[12]!==_||e[13]!==P||e[14]!==i||e[15]!==s||e[16]!==r||e[17]!==t||e[18]!==g||e[19]!==o?(D={currentUser:n,homePosts:s,groupedStories:p,isPostsLoading:t,isStoriesLoading:g,hasMore:i,isFetchingNextPage:r,fetchNextPage:a,refreshPosts:o,addToast:c,handlePostClick:_,handleUserClick:P},e[8]=c,e[9]=n,e[10]=a,e[11]=p,e[12]=_,e[13]=P,e[14]=i,e[15]=s,e[16]=r,e[17]=t,e[18]=g,e[19]=o,e[20]=D):D=e[20],D};function dn(e){const{pageParam:n}=e;return ct(n,10)}function hn(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function mn(e){return e}function gn(e,n){const s=e.find(t=>t.user.id===n.user_id);return s?s.stories.push(n):e.push({user:n.user,stories:[n],isSeen:!1}),e}var pn=te();const Vn=()=>{const e=(0,pn.c)(60),{id:n}=Ae(),s=he(),{currentUser:t}=fe(),{onlineUsers:i}=Ue(),r=me(),[a,o]=(0,J.useState)("");let c;e[0]===Symbol.for("react.memo_cache_sentinel")?(c=[],e[0]=c):c=e[0];const[l,f]=(0,J.useState)(c),{conversations:u,isConvLoading:d,refetchConversations:g,refetchMessages:m,sendMessage:p,editMessage:M,sendTypingStatus:_,typingStatus:w,markAsRead:P,formatMessages:D,onDeleteMessage:h,onToggleReaction:A,conversationReactions:y,messages:F,isMsgLoading:S,fetchNextMessages:$,hasMoreMessages:k,isFetchingMoreMessages:T}=Ht(t,n);let x;e:{if(!n||u.length===0){x=null;break e}let R;e[1]!==u||e[2]!==n?(R=u.find(Y=>Y.id===n)||null,e[1]=u,e[2]=n,e[3]=R):R=e[3],x=R}const C=x;let v,b;e[4]!==n||e[5]!==P?(v=()=>{n&&P(n)},b=[n,P],e[4]=n,e[5]=P,e[6]=v,e[7]=b):(v=e[6],b=e[7]),(0,J.useEffect)(v,b);let L;e[8]!==u||e[9]!==t?.id||e[10]!==a?(L=()=>{const R=setTimeout(async()=>{if(a.length>1){const Y=await Se(a),z=u.map(yn);f(Y.filter(U=>U.id!==t?.id&&!z.includes(U.id)))}else f([])},300);return()=>clearTimeout(R)},e[8]=u,e[9]=t?.id,e[10]=a,e[11]=L):L=e[11];const B=t?.id;let Q;e[12]!==u||e[13]!==a||e[14]!==B?(Q=[a,u,B],e[12]=u,e[13]=a,e[14]=B,e[15]=Q):Q=e[15],(0,J.useEffect)(L,Q);let V;e[16]!==t||e[17]!==s||e[18]!==r?(V=async R=>{if(t)try{const Y=await at(t.id,R.id);r.invalidateQueries({queryKey:["conversations",t.id]}),o(""),s(`/m/${Y}`)}catch(Y){console.error("Failed to start conversation:",Y)}},e[16]=t,e[17]=s,e[18]=r,e[19]=V):V=e[19];const Z=V;let G;e[20]!==s?(G=R=>{s(`/m/${R.id}`)},e[20]=s,e[21]=G):G=e[21];const I=G;let X;e[22]!==y||e[23]!==D||e[24]!==F?(X=D(F,y),e[22]=y,e[23]=D,e[24]=F,e[25]=X):X=e[25];const j=X;let N;e:{if(!a.trim()){N=u;break e}let R;e[26]!==u||e[27]!==a?(R=new Me(u,{keys:["user.name","user.handle","lastMessage"],threshold:.3,ignoreLocation:!0}).search(a).map(_n),e[26]=u,e[27]=a,e[28]=R):R=e[28],N=R}const q=N,K=C&&w[C.id];let E;e[29]!==i||e[30]!==C?(E=C&&C.user?.id&&i.has(C.user.id),e[29]=i,e[30]=C,e[31]=E):E=e[31];const H=E;let ee;return e[32]!==u||e[33]!==K||e[34]!==t||e[35]!==M||e[36]!==$||e[37]!==q||e[38]!==I||e[39]!==Z||e[40]!==k||e[41]!==n||e[42]!==d||e[43]!==T||e[44]!==S||e[45]!==j||e[46]!==a||e[47]!==s||e[48]!==h||e[49]!==A||e[50]!==i||e[51]!==H||e[52]!==g||e[53]!==m||e[54]!==C||e[55]!==p||e[56]!==_||e[57]!==w||e[58]!==l?(ee={id:n,currentUser:t,onlineUsers:i,msgSearchQuery:a,setMsgSearchQuery:o,userSearchResults:l,conversations:u,filteredConversations:q,selectedConversation:C,localMessages:j,isConvLoading:d,isMsgLoading:S,currentIsTyping:K,otherUserIsOnline:H,handleStartConversation:Z,handleSelectConversation:I,refetchConversations:g,refetchMessages:m,sendMessage:p,editMessage:M,onDeleteMessage:h,sendTypingStatus:_,typingStatus:w,onToggleReaction:A,navigate:s,fetchNextMessages:$,hasMoreMessages:k,isFetchingMoreMessages:T},e[32]=u,e[33]=K,e[34]=t,e[35]=M,e[36]=$,e[37]=q,e[38]=I,e[39]=Z,e[40]=k,e[41]=n,e[42]=d,e[43]=T,e[44]=S,e[45]=j,e[46]=a,e[47]=s,e[48]=h,e[49]=A,e[50]=i,e[51]=H,e[52]=g,e[53]=m,e[54]=C,e[55]=p,e[56]=_,e[57]=w,e[58]=l,e[59]=ee):ee=e[59],ee};function yn(e){return e.user?.id}function _n(e){return e.item}var Mn=te();const Jn=()=>{const e=(0,Mn.c)(48),{currentUser:n}=fe(),s=he(),t=me(),i=n?.id;let r;e[0]!==i?(r=["notifications",i],e[0]=i,e[1]=r):r=e[1];let a;e[2]!==n?(a=b=>{const{pageParam:L}=b;return st(n.id,L,10)},e[2]=n,e[3]=a):a=e[3];const o=!!n?.id;let c;e[4]!==r||e[5]!==a||e[6]!==o?(c={queryKey:r,queryFn:a,enabled:o,initialPageParam:null,getNextPageParam:An},e[4]=r,e[5]=a,e[6]=o,e[7]=c):c=e[7];const{data:l,fetchNextPage:f,hasNextPage:u,isFetchingNextPage:d,isLoading:g,refetch:m}=re(c);let p;e[8]!==l?.pages?(p=l?.pages.flatMap(Fn)||[],e[8]=l?.pages,e[9]=p):p=e[9];const M=p;let _;e[10]!==n||e[11]!==t?(_=()=>{if(!n?.id)return;const b=n.id,L=de.channel(`user_notifications:${b}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${b}`},()=>{t.invalidateQueries({queryKey:["notifications",b]})}).subscribe();return()=>{de.removeChannel(L)}},e[10]=n,e[11]=t,e[12]=_):_=e[12];const w=n?.id;let P;e[13]!==t||e[14]!==w?(P=[w,t],e[13]=t,e[14]=w,e[15]=P):P=e[15],(0,J.useEffect)(_,P);let D;e[16]!==n?(D=()=>n?it(n.id):Promise.resolve(),e[16]=n,e[17]=D):D=e[17];let h,A,y;e[18]!==n?.id||e[19]!==t?(h=async()=>{const b=n?.id;await t.cancelQueries({queryKey:["notifications",b]});const L=t.getQueryData(["notifications",b]);return t.setQueryData(["notifications",b],En),{previousNotifications:L}},A=(b,L,B)=>{B?.previousNotifications&&t.setQueryData(["notifications",n?.id],B.previousNotifications)},y=()=>{t.invalidateQueries({queryKey:["notifications",n?.id]})},e[18]=n?.id,e[19]=t,e[20]=h,e[21]=A,e[22]=y):(h=e[20],A=e[21],y=e[22]);let F;e[23]!==h||e[24]!==A||e[25]!==y||e[26]!==D?(F={mutationFn:D,onMutate:h,onError:A,onSettled:y},e[23]=h,e[24]=A,e[25]=y,e[26]=D,e[27]=F):F=e[27];const S=ce(F);let $;e[28]!==s?($=b=>{b.type==="follow"?s(`/u/${b.user}`):b.post_id&&s(`/p/${b.post_id}`)},e[28]=s,e[29]=$):$=e[29];const k=$;let T;e[30]!==n?.id||e[31]!==S||e[32]!==M?(T=()=>{n?.id&&M.some(Dn)&&S.mutate()},e[30]=n?.id,e[31]=S,e[32]=M,e[33]=T):T=e[33];const x=n?.id;let C;e[34]!==S||e[35]!==M||e[36]!==x?(C=[x,M,S],e[34]=S,e[35]=M,e[36]=x,e[37]=C):C=e[37],(0,J.useEffect)(T,C);let v;return e[38]!==n||e[39]!==f||e[40]!==k||e[41]!==u||e[42]!==d||e[43]!==g||e[44]!==s||e[45]!==M||e[46]!==m?(v={currentUser:n,notifications:M,isLoading:g,isFetchingMore:d,hasMore:u,loadNotifications:f,refreshNotifications:m,handleNotificationClick:k,navigate:s},e[38]=n,e[39]=f,e[40]=k,e[41]=u,e[42]=d,e[43]=g,e[44]=s,e[45]=M,e[46]=m,e[47]=v):v=e[47],v};function An(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Fn(e){return e}function Pn(e){return{...e,is_read:!0}}function wn(e){return e.map(Pn)}function En(e){return e&&{...e,pages:e.pages.map(wn)}}function Dn(e){return!e.is_read}var bn=te();const Hn=()=>{const e=(0,bn.c)(23),{id:n}=Ae(),s=he(),{currentUser:t}=fe(),{addToast:i}=_e(),r=me();let a,o;e[0]!==n?(a=["post",n],o=async()=>{if(!n||!le(n))throw new Error("Invalid post ID");return Pt(n)},e[0]=n,e[1]=a,e[2]=o):(a=e[1],o=e[2]);const c=!!n;let l;e[3]!==a||e[4]!==o||e[5]!==c?(l={queryKey:a,queryFn:o,enabled:c,retry:!1},e[3]=a,e[4]=o,e[5]=c,e[6]=l):l=e[6];const{data:f,isLoading:u,isError:d}=ye(l);let g;e[7]!==s?(g=D=>{s(`/u/${D}`)},e[7]=s,e[8]=g):g=e[8];const m=g;let p;e[9]!==s?(p=()=>{s(-1)},e[9]=s,e[10]=p):p=e[10];const M=p;let _;e[11]!==r?(_=(D,h,A)=>{r.setQueryData(["post",D],y=>y&&{...y,content:h,media:A})},e[11]=r,e[12]=_):_=e[12];const w=_;let P;return e[13]!==i||e[14]!==t||e[15]!==M||e[16]!==w||e[17]!==m||e[18]!==d||e[19]!==u||e[20]!==s||e[21]!==f?(P={post:f,isLoading:u,isError:d,currentUser:t,addToast:i,navigate:s,handleUserClick:m,handleDelete:M,handleUpdate:w},e[13]=i,e[14]=t,e[15]=M,e[16]=w,e[17]=m,e[18]=d,e[19]=u,e[20]=s,e[21]=f,e[22]=P):P=e[22],P};var Sn=te();const Gn=()=>{const e=(0,Sn.c)(44),n=he(),{id:s}=Ae(),[t]=Ke();let i;e[0]!==s||e[1]!==t?(i=s||t.get("id"),e[0]=s,e[1]=t,e[2]=i):i=e[2];const r=i,a=(0,J.useRef)(null);let o;e[3]===Symbol.for("react.memo_cache_sentinel")?(o=new Map,e[3]=o):o=e[3];const c=(0,J.useRef)(o),[l,f]=(0,J.useState)(null),[u,d]=(0,J.useState)(!0);let g;e[4]===Symbol.for("react.memo_cache_sentinel")?(g=["reels"],e[4]=g):g=e[4];let m;e[5]===Symbol.for("react.memo_cache_sentinel")?(m={queryKey:g,queryFn:vn,initialPageParam:null,getNextPageParam:xn},e[5]=m):m=e[5];const{data:p,fetchNextPage:M,hasNextPage:_,isFetchingNextPage:w,isLoading:P}=re(m);let D;e[6]!==p?.pages?(D=p?.pages.flatMap(Cn)||[],e[6]=p?.pages,e[7]=D):D=e[7];const h=D,[A,y]=(0,J.useState)(0);h.length>0&&h.length!==A&&!l&&(y(h.length),r&&h.find(j=>j.id===r)?f(r):f(h[0].id));let F,S;e[8]!==h.length||e[9]!==r?(F=()=>{if(h.length>0&&r){const j=c.current.get(r);j&&j.scrollIntoView({behavior:"instant"})}},S=[h.length,r],e[8]=h.length,e[9]=r,e[10]=F,e[11]=S):(F=e[10],S=e[11]),(0,J.useEffect)(F,S);let $;e[12]===Symbol.for("react.memo_cache_sentinel")?($=()=>{d(Rn)},e[12]=$):$=e[12];const k=$;let T;e[13]!==l||e[14]!==h?(T=()=>{if(h.length===0)return;const j=h.findIndex(N=>N.id===l);if(j<h.length-1){const N=h[j+1];c.current.get(N.id)?.scrollIntoView({behavior:"smooth"})}},e[13]=l,e[14]=h,e[15]=T):T=e[15];const x=T;let C;e[16]!==l||e[17]!==h?(C=()=>{if(h.length===0)return;const j=h.findIndex(N=>N.id===l);if(j>0){const N=h[j-1];c.current.get(N.id)?.scrollIntoView({behavior:"smooth"})}},e[16]=l,e[17]=h,e[18]=C):C=e[18];const v=C;let b,L;e[19]!==h.length?(b=()=>{if(h.length===0)return;const j={root:a.current,threshold:.6},N=K=>{K.forEach(E=>{if(E.isIntersecting){const H=E.target.getAttribute("data-id");H&&f(H)}})},q=new IntersectionObserver(N,j);return c.current.forEach(K=>q.observe(K)),()=>q.disconnect()},L=[h.length],e[19]=h.length,e[20]=b,e[21]=L):(b=e[20],L=e[21]),(0,J.useEffect)(b,L);let B,Q;e[22]!==l||e[23]!==x||e[24]!==v?(B=()=>{const j=N=>{const q=N.target;if(!(q.tagName==="INPUT"||q.tagName==="TEXTAREA"||q.isContentEditable)&&!(N.ctrlKey||N.altKey||N.metaKey))e:switch(N.key){case"ArrowUp":N.preventDefault(),v();break e;case"ArrowDown":N.preventDefault(),x();break e;case"m":case"M":k();break e;case" ":{N.preventDefault();const K=c.current.get(l||"");if(K){const E=K.querySelector(".reel-item");E&&E.click()}}}};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},Q=[l,x,v,k],e[22]=l,e[23]=x,e[24]=v,e[25]=B,e[26]=Q):(B=e[25],Q=e[26]),(0,J.useEffect)(B,Q);let V;e[27]===Symbol.for("react.memo_cache_sentinel")?(V=(j,N)=>{N?c.current.set(j,N):c.current.delete(j)},e[27]=V):V=e[27];const Z=V;let G,I;e[28]!==M||e[29]!==_||e[30]!==w?(G=()=>{const j=()=>{if(!a.current||w||!_)return;const{scrollTop:q,scrollHeight:K,clientHeight:E}=a.current;q+E>=K-800&&M()},N=a.current;if(N)return N.addEventListener("scroll",j),()=>N.removeEventListener("scroll",j)},I=[w,_,M],e[28]=M,e[29]=_,e[30]=w,e[31]=G,e[32]=I):(G=e[31],I=e[32]),(0,J.useEffect)(G,I);let X;return e[33]!==l||e[34]!==M||e[35]!==_||e[36]!==w||e[37]!==P||e[38]!==u||e[39]!==n||e[40]!==h||e[41]!==x||e[42]!==v?(X={reels:h,loading:P,loadingMore:w,activeReelId:l,hasMore:_,isMuted:u,containerRef:a,setReelRef:Z,navigate:n,toggleMute:k,scrollToNext:x,scrollToPrev:v,loadReels:M},e[33]=l,e[34]=M,e[35]=_,e[36]=w,e[37]=P,e[38]=u,e[39]=n,e[40]=h,e[41]=x,e[42]=v,e[43]=X):X=e[43],X};function vn(e){const{pageParam:n}=e;return _t(n,10)}function xn(e){if(!e||e.length<10)return;const n=e[e.length-1];return n.score!==void 0?`${n.id}:${n.score}`:n.sort_timestamp||n.created_at}function Cn(e){return e}function Rn(e){return!e}const Yn=()=>{const{currentUser:e,logout:n}=fe(),{darkMode:s,toggleDarkMode:t,fontSize:i,setFontSize:r,dataSaver:a,setDataSaver:o}=Lt(),{addToast:c}=_e(),[l,f]=(0,J.useState)(!1),[u,d]=(0,J.useState)({newPassword:"",confirmPassword:""}),[g,m]=(0,J.useState)(!1),p=async()=>{try{await n(),c("Logged out successfully")}catch(A){console.error("Logout error:",A),c("Failed to logout")}};return{currentUser:e,darkMode:s,toggleDarkMode:t,fontSize:i,setFontSize:r,dataSaver:a,setDataSaver:o,isChangingPassword:l,setIsChangingPassword:f,passwordData:u,setPasswordData:d,loading:g,handleLogout:p,handlePasswordChange:async A=>{if(A.preventDefault(),u.newPassword!==u.confirmPassword){c("Passwords do not match","error");return}if(u.newPassword.length<6){c("Password must be at least 6 characters","error");return}m(!0);try{const{error:y}=await de.auth.updateUser({password:u.newPassword});if(y)throw y;c("Password updated successfully!"),f(!1),d({newPassword:"",confirmPassword:""})}catch(y){console.error("Password update error:",y),c(y.message||"Failed to update password","error")}finally{m(!1)}},handlePasswordReset:async()=>{if(e?.email){m(!0);try{const{error:A}=await de.auth.resetPasswordForEmail(e.email,{redirectTo:`${window.location.origin}/settings?type=recovery`});if(A)throw A;c("Password reset email sent!")}catch(A){console.error("Reset password error:",A),c(A.message||"Failed to send reset email","error")}finally{m(!1)}}},handleClearCache:()=>{["seenStories","font-size","data-saver","theme"].forEach(A=>localStorage.removeItem(A)),c("Cache cleared! Reloading..."),setTimeout(()=>window.location.reload(),1500)},handleDownloadData:async()=>{if(e){m(!0);try{const A={user:{id:e.id,handle:e.handle,name:e.name,email:e.email},exportDate:new Date().toISOString(),note:"This is a mock export of your Sysm data."},y=new Blob([JSON.stringify(A,null,2)],{type:"application/json"}),F=URL.createObjectURL(y),S=document.createElement("a");S.href=F,S.download=`sysm-data-${e.handle}.json`,S.click(),URL.revokeObjectURL(F),c("Data export started!")}catch{c("Failed to export data","error")}finally{m(!1)}}},handleDeleteAccount:()=>{window.confirm("Are you absolutely sure? This will permanently delete your account and all associated data. This action is irreversible.")&&(c("Account deletion request submitted. Logging out..."),setTimeout(p,2e3))},handleReportBug:()=>{window.prompt("Please describe the bug you found:")&&c("Bug reported! Thank you for your feedback.")}}};export{Vn as a,jn as c,Qn as d,qn as f,Jn as i,On as l,Gn as n,Wn as o,Tn as p,Hn as r,zn as s,Yn as t,Kn as u};
