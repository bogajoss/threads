import{a as ie}from"./rolldown-runtime-BaZ8gS7u.js";import{E as ne,b as ce,c as ae,d as de}from"./framework-CsA6nn9m.js";import"./database-BOtUlDBt.js";import{En as oe,Ft as Q,Gt as xe,Jn as me,Jt as he,Pt as ue,Rt as pe,Tn as fe,Vt as ee,X as be,Y as te,Yt as ge,en as je,er as ve,hn as ze,ln as Ne,pn as ke,qn as we,rn as se,tn as re,xn as le,zn as ye}from"./ui-libs-RMDc8kCU.js";import{$ as Ce,L as Se,N as Me,Q as W,Qt as A,R as Ge,U as Ie,X as Te,Z as Ae,Zt as Ue,et as Oe,mt as Pe,n as Re,nt as J,pt as $e,r as Le,rt as V,t as Ee,tt as X,v as qe,z as _e}from"./index-CZQn9Uzx.js";import{n as De,t as Ye}from"./linkify-CDs92yJ8.js";import{a as Fe,u as Be}from"./hooks-CXr-h_XM.js";var Je=ae(),I=ie(ne(),1),e=ie(de(),1),Ve=s=>{const t=(0,Je.c)(60),{conv:a,selectedId:U,onSelect:k,onlineUsers:d}=s;let M;t[0]!==a.isGroup||t[1]!==a.user||t[2]!==d?(M=!a.isGroup&&a.user?d.has(a.user.id):!1,t[0]=a.isGroup,t[1]=a.user,t[2]=d,t[3]=M):M=t[3];const w=M,g=U===a.id,m=a.unread>0,j=a.isGroup?a.name:a.user?.name,i=a.isGroup?a.avatar:a.user?.avatar;let v;t[4]!==a||t[5]!==k?(v=()=>k(a),t[4]=a,t[5]=k,t[6]=v):v=t[6];const R=g?"bg-violet-500/10 dark:bg-violet-500/20":"hover:bg-zinc-100 dark:hover:bg-zinc-800/50";let y;t[7]!==R?(y=A("group relative flex cursor-pointer items-center gap-4 p-3 mx-2 rounded-2xl transition-all duration-200",R),t[7]=R,t[8]=y):y=t[8];const u=g?"border-violet-500/30":"border-transparent group-hover:border-zinc-200 dark:group-hover:border-zinc-700";let z;t[9]!==u?(z=A("size-[52px] border-2 transition-all",u),t[9]=u,t[10]=z):z=t[10];const O=j||"";let G;t[11]!==i||t[12]!==O?(G=(0,e.jsx)(V,{src:i,alt:O,className:"object-cover"}),t[11]=i,t[12]=O,t[13]=G):G=t[13];let x;t[14]!==j?.[0]?(x=j?.[0]?.toUpperCase(),t[14]=j?.[0],t[15]=x):x=t[15];let N;t[16]!==x?(N=(0,e.jsx)(J,{className:"bg-zinc-100 text-zinc-500 font-bold text-lg dark:bg-zinc-800 dark:text-zinc-400",children:x}),t[16]=x,t[17]=N):N=t[17];let C;t[18]!==N||t[19]!==z||t[20]!==G?(C=(0,e.jsxs)(X,{className:z,children:[G,N]}),t[18]=N,t[19]=z,t[20]=G,t[21]=C):C=t[21];let p;t[22]!==w?(p=w&&(0,e.jsx)("span",{className:"absolute bottom-0.5 right-0.5 size-3.5 rounded-full border-[2.5px] border-white bg-emerald-500 ring-0 dark:border-black"}),t[22]=w,t[23]=p):p=t[23];let h;t[24]!==C||t[25]!==p?(h=(0,e.jsxs)("div",{className:"relative",children:[C,p]}),t[24]=C,t[25]=p,t[26]=h):h=t[26];const f=m?"text-zinc-900 dark:text-white":"text-zinc-700 dark:text-zinc-200";let o;t[27]!==f?(o=A("truncate text-[15px] font-semibold",f),t[27]=f,t[28]=o):o=t[28];let S;t[29]!==j||t[30]!==o?(S=(0,e.jsx)("span",{className:o,children:j}),t[29]=j,t[30]=o,t[31]=S):S=t[31];const n=m?"text-violet-600 dark:text-violet-400":"text-zinc-400";let b;t[32]!==n?(b=A("ml-2 whitespace-nowrap text-[11px] font-medium",n),t[32]=n,t[33]=b):b=t[33];let $;t[34]!==a.time||t[35]!==b?($=(0,e.jsx)("span",{className:b,children:a.time}),t[34]=a.time,t[35]=b,t[36]=$):$=t[36];let L;t[37]!==S||t[38]!==$?(L=(0,e.jsxs)("div",{className:"flex items-center justify-between mb-0.5",children:[S,$]}),t[37]=S,t[38]=$,t[39]=L):L=t[39];const F=m?"font-semibold text-zinc-900 dark:text-zinc-100":"text-zinc-500 dark:text-zinc-400 group-hover:text-zinc-600 dark:group-hover:text-zinc-300";let E;t[40]!==F?(E=A("truncate text-[13px] leading-relaxed",F),t[40]=F,t[41]=E):E=t[41];const Z=a.currentUserSent?"You: ":"";let q;t[42]!==a.lastMessage||t[43]!==E||t[44]!==Z?(q=(0,e.jsxs)("p",{className:E,children:[Z,a.lastMessage]}),t[42]=a.lastMessage,t[43]=E,t[44]=Z,t[45]=q):q=t[45];let _;t[46]!==a.unread||t[47]!==m?(_=m&&(0,e.jsx)("span",{className:"flex size-5 shrink-0 items-center justify-center rounded-full bg-violet-600 text-[10px] font-bold text-white shadow-sm shadow-violet-500/30",children:a.unread}),t[46]=a.unread,t[47]=m,t[48]=_):_=t[48];let D;t[49]!==q||t[50]!==_?(D=(0,e.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[q,_]}),t[49]=q,t[50]=_,t[51]=D):D=t[51];let Y;t[52]!==L||t[53]!==D?(Y=(0,e.jsxs)("div",{className:"min-w-0 flex-1 py-1",children:[L,D]}),t[52]=L,t[53]=D,t[54]=Y):Y=t[54];let B;return t[55]!==h||t[56]!==v||t[57]!==Y||t[58]!==y?(B=(0,e.jsxs)("div",{onClick:v,className:y,children:[h,Y]}),t[55]=h,t[56]=v,t[57]=Y,t[58]=y,t[59]=B):B=t[59],B},Xe=({conversations:s,userResults:t=[],onSelect:a,onStartNew:U,selectedId:k,searchQuery:d,onSearchChange:M,onlineUsers:w=new Set})=>{const[g,m]=(0,I.useState)(!1),j=s.filter(i=>w.has(i.user?.id));return(0,e.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col bg-white dark:bg-black h-full",children:[(0,e.jsxs)("div",{className:"px-5 pt-5 pb-2",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between mb-5",children:[(0,e.jsx)("h2",{className:"text-2xl font-black tracking-tight text-zinc-900 dark:text-white",children:"Chats"}),(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)("button",{onClick:()=>m(!0),className:"rounded-full bg-zinc-100 p-2.5 text-zinc-600 transition-colors hover:bg-zinc-200 dark:bg-zinc-900 dark:text-zinc-400 dark:hover:bg-zinc-800",title:"New Group",children:(0,e.jsx)(pe,{size:20})}),(0,e.jsx)("button",{className:"rounded-full bg-zinc-100 p-2.5 text-zinc-600 transition-colors hover:bg-zinc-200 dark:bg-zinc-900 dark:text-zinc-400 dark:hover:bg-zinc-800",children:(0,e.jsx)(he,{size:20})})]})]}),(0,e.jsxs)("div",{className:"relative group",children:[(0,e.jsx)(re,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-violet-500 transition-colors",size:18}),(0,e.jsx)("input",{type:"text",value:d,onChange:i=>M(i.target.value),placeholder:"Search Messenger",className:"w-full rounded-2xl border-none bg-zinc-100 py-3 pl-12 pr-4 text-[15px] font-medium text-zinc-900 placeholder:text-zinc-500 transition-all focus:bg-white focus:ring-2 focus:ring-violet-500/20 focus:shadow-md dark:bg-zinc-900 dark:text-white dark:focus:bg-black"})]})]}),(0,e.jsx)(Me,{className:"flex-1",children:(0,e.jsxs)("div",{className:"flex flex-col pb-4",children:[!d&&j.length>0&&(0,e.jsx)("div",{className:"mb-4 mt-2",children:(0,e.jsxs)("div",{className:"flex gap-4 overflow-x-auto px-5 pb-4 pt-2 no-scrollbar",children:[(0,e.jsxs)("div",{className:"flex flex-col items-center gap-2 min-w-[64px] cursor-pointer group",children:[(0,e.jsxs)("div",{className:"relative flex size-[60px] items-center justify-center rounded-full bg-zinc-50 border border-zinc-200 dark:bg-zinc-900 dark:border-zinc-800 group-hover:bg-zinc-100 dark:group-hover:bg-zinc-800 transition-colors",children:[(0,e.jsx)(ee,{size:24,className:"text-zinc-400"}),(0,e.jsx)("div",{className:"absolute bottom-0 right-0 size-5 bg-white dark:bg-black rounded-full flex items-center justify-center",children:(0,e.jsx)("div",{className:"size-4 bg-zinc-200 dark:bg-zinc-700 rounded-full flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-[10px] text-zinc-500 font-bold",children:"+"})})})]}),(0,e.jsx)("span",{className:"text-[11px] font-medium text-zinc-500",children:"Your Story"})]}),j.map(i=>(0,e.jsxs)("div",{onClick:()=>a(i),className:"flex flex-col items-center gap-2 cursor-pointer group min-w-[64px] transition-transform active:scale-95",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute -inset-[3px] rounded-full bg-gradient-to-tr from-violet-500 via-fuchsia-500 to-orange-500 opacity-90 p-[2px]"}),(0,e.jsx)("div",{className:"relative rounded-full border-[3px] border-white dark:border-black p-[2px] bg-white dark:bg-black",children:(0,e.jsxs)(X,{className:"size-[50px]",children:[(0,e.jsx)(V,{src:i.user?.avatar,className:"object-cover"}),(0,e.jsx)(J,{children:i.user?.name?.[0]})]})}),(0,e.jsx)("span",{className:"absolute bottom-1 right-1 size-3.5 rounded-full border-[2.5px] border-white bg-emerald-500 dark:border-black"})]}),(0,e.jsx)("span",{className:"w-full truncate text-center text-[11px] font-medium text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white transition-colors",children:i.user?.name.split(" ")[0]})]},i.id))]})}),(0,e.jsx)("div",{className:"px-2 space-y-1",children:s.length>0&&s.filter(i=>i.lastMessage!=="No messages yet"||i.id===k||d).map(i=>(0,e.jsx)(Ve,{conv:i,selectedId:k,onSelect:a,onlineUsers:w},i.id))}),t.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"px-6 py-3 mt-2 text-xs font-bold uppercase tracking-wider text-zinc-400",children:"More People"}),(0,e.jsx)("div",{className:"px-2 space-y-1",children:t.map(i=>(0,e.jsxs)("div",{onClick:()=>U(i),className:"flex cursor-pointer items-center gap-4 px-3 py-2 rounded-2xl transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800/50",children:[(0,e.jsxs)(X,{className:"size-10",children:[(0,e.jsx)(V,{src:i.avatar,className:"object-cover"}),(0,e.jsx)(J,{children:i.name?.[0]?.toUpperCase()})]}),(0,e.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,e.jsx)("div",{className:"truncate text-sm font-bold text-zinc-900 dark:text-white",children:i.name}),(0,e.jsxs)("div",{className:"truncate text-xs text-zinc-500",children:["@",i.handle]})]}),(0,e.jsx)("button",{className:"flex size-8 items-center justify-center rounded-full bg-violet-50 text-violet-600 dark:bg-violet-900/20 dark:text-violet-400",children:(0,e.jsx)(ee,{size:16})})]},i.id))})]}),s.length===0&&t.length===0&&d&&(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center px-6",children:[(0,e.jsx)("div",{className:"mb-4 rounded-full bg-zinc-100 p-4 dark:bg-zinc-900",children:(0,e.jsx)(re,{className:"text-zinc-400",size:24})}),(0,e.jsxs)("p",{className:"text-zinc-500",children:['No results found for "',d,'"']})]})]})}),(0,e.jsx)(Le,{isOpen:g,onClose:()=>m(!1),onCreated:i=>{a({id:i,isGroup:!0})}})]})},Ze=Xe,He=({conversation:s,messages:t,onBack:a,onSendMessage:U,onDeleteMessage:k,onTyping:d,isLoading:M,isTyping:w,isOnline:g})=>{const m=ce(),{openLightbox:j}=Pe(),[i,v]=(0,I.useState)(""),[R,y]=(0,I.useState)(!1),[u,z]=(0,I.useState)([]),[O,G]=(0,I.useState)(!1),[x,N]=(0,I.useState)(null),[C,p]=(0,I.useState)(!1),h=(0,I.useRef)(null),f=(0,I.useRef)(null),o=(0,I.useRef)(null),S=Be(s.user?.lastSeen),n=s.isGroup?s.name:s.user?.name,b=s.isGroup?s.avatar:s.user?.avatar;(0,I.useEffect)(()=>{f.current&&(f.current.scrollTop=f.current.scrollHeight)},[t,w,u,x]);const $=r=>{const l=r.target.value;v(l),r.target.style.height="auto",r.target.style.height=`${Math.min(r.target.scrollHeight,120)}px`,d&&(d(!0),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{d(!1)},2e3))},L=r=>{v(l=>l+r.emoji)},F=r=>{if(r&&r.preventDefault(),!i.trim()&&u.length===0)return;d&&(o.current&&clearTimeout(o.current),d(!1)),U(s.id,i,u.length>0?"image":"text",u,x?.id),v(""),z([]),N(null);const l=document.querySelector('textarea[name="chat-input"]');l&&(l.style.height="auto")},E=async r=>{if(!r.target.files)return;const l=Array.from(r.target.files);if(l.length!==0){y(!0);try{const c=await Promise.all(l.map(T=>Ue(T)));z(T=>[...T,...c])}catch(c){console.error("Upload failed:",c)}finally{y(!1)}}},Z=r=>{z(l=>l.filter(c=>c.url!==r))},q=r=>{!r.media||r.media.length===0||j(r.media.map(l=>l.url),0)},_=(0,I.useMemo)(()=>{const r=t.filter(l=>l.sender==="me");return r.length>0?r[r.length-1].id:null},[t]),D=r=>t.find(l=>l.id===r),Y=(r,l)=>r===0?!1:t[r-1].sender===l.sender,B=(r,l)=>r===t.length-1?!1:t[r+1].sender===l.sender;return(0,e.jsxs)("div",{className:"relative flex h-full w-full flex-col overflow-hidden bg-white/50 dark:bg-black/50 md:border-l md:border-zinc-200/50 dark:md:border-zinc-800/50",children:[(0,e.jsxs)("div",{className:"sticky top-0 z-30 flex shrink-0 items-center justify-between border-b border-zinc-100 bg-white/75 px-4 py-3 backdrop-blur-xl dark:border-zinc-800 dark:bg-black/75",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)("button",{onClick:a,className:"mr-1 -ml-2 rounded-full p-2 text-zinc-600 transition-colors hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-zinc-800 md:hidden",children:(0,e.jsx)(ve,{size:24})}),(0,e.jsxs)("div",{className:"relative cursor-pointer",onClick:()=>!s.isGroup&&s.user&&m(`/u/${s.user.handle}`),children:[(0,e.jsxs)(X,{className:"size-10 border-2 border-white shadow-sm dark:border-zinc-800",children:[(0,e.jsx)(V,{src:b,alt:n||"",className:"object-cover"}),(0,e.jsx)(J,{children:n?.[0]?.toUpperCase()})]}),g&&!s.isGroup&&(0,e.jsx)("span",{className:"absolute bottom-0 right-0 size-3 rounded-full border-2 border-white bg-emerald-500 dark:border-black"})]}),(0,e.jsxs)("div",{className:"flex flex-col cursor-pointer",onClick:()=>!s.isGroup&&s.user&&m(`/u/${s.user.handle}`),children:[(0,e.jsx)("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:n}),(0,e.jsx)("span",{className:"text-[11px] font-medium text-zinc-500",children:s.isGroup?"Group Chat":g?(0,e.jsx)("span",{className:"text-emerald-500",children:"Active now"}):s.user?.lastSeen?`Last seen ${S}`:"Offline"})]})]}),(0,e.jsx)("div",{className:"flex items-center gap-1",children:(0,e.jsx)("button",{onClick:()=>p(!0),className:"rounded-full p-2.5 text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:(0,e.jsx)(fe,{size:20})})})]}),(0,e.jsx)("div",{className:"flex-1 min-h-0 overflow-y-auto px-4 py-4",ref:f,children:(0,e.jsxs)("div",{className:"flex flex-col min-h-full justify-end",children:[t.length<5&&(0,e.jsxs)("div",{className:"py-12 flex flex-col items-center justify-center opacity-80 mb-auto",children:[(0,e.jsxs)(X,{className:"size-24 border-4 border-zinc-100 dark:border-zinc-800 mb-4 bg-zinc-50 dark:bg-zinc-900",children:[(0,e.jsx)(V,{src:b,className:"object-cover"}),(0,e.jsx)(J,{className:"text-4xl",children:n?.[0]})]}),(0,e.jsx)("h2",{className:"text-xl font-bold dark:text-white",children:n}),(0,e.jsx)("p",{className:"text-zinc-500 text-sm mb-4",children:s.isGroup?"Group chat on AntiGravity":"You're friends on AntiGravity"}),!s.isGroup&&(0,e.jsx)($e,{variant:"outline",className:"rounded-full h-8 text-xs",children:"View Profile"})]}),M&&t.length===0?(0,e.jsx)("div",{className:"flex justify-center p-8",children:(0,e.jsx)(le,{className:"animate-spin text-violet-500",size:32})}):(0,e.jsx)("div",{className:"space-y-[2px]",children:t.map((r,l)=>{const c=r.sender==="me",T=Y(l,r),P=B(l,r);return(0,e.jsx)(te.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},className:A("flex w-full",c?"justify-end":"justify-start",!P&&"mb-4"),children:(0,e.jsxs)("div",{className:A("flex max-w-[75%] md:max-w-[65%] items-end gap-2 group",c?"flex-row-reverse":"flex-row"),children:[!c&&(0,e.jsx)("div",{className:"w-7 shrink-0",children:P?null:(0,e.jsxs)(X,{className:"size-7 border border-zinc-100 shadow-sm dark:border-zinc-800",children:[(0,e.jsx)(V,{src:r.senderAvatar||b}),(0,e.jsx)(J,{children:(r.senderName||n)?.[0]})]})}),(0,e.jsxs)(Te,{children:[(0,e.jsx)(Oe,{children:(0,e.jsxs)("div",{className:A("relative px-4 py-2.5 shadow-sm text-[15px] leading-[1.4]",c?"bg-gradient-to-br from-violet-600 to-indigo-600 text-white":"bg-white text-zinc-900 dark:bg-zinc-800 dark:text-white border border-zinc-200/50 dark:border-zinc-700/50",!P&&!T&&"rounded-[22px]",c&&!P&&T&&"rounded-[22px] rounded-tr-md",c&&P&&!T&&"rounded-[22px] rounded-br-md",c&&P&&T&&"rounded-[22px] rounded-r-md",!c&&!P&&T&&"rounded-[22px] rounded-tl-md",!c&&P&&!T&&"rounded-[22px] rounded-bl-md",!c&&P&&T&&"rounded-[22px] rounded-l-md"),children:[r.replyToId&&(0,e.jsxs)("div",{className:A("mb-1.5 -mx-1 px-3 py-1.5 rounded-xl text-xs border-l-2 cursor-pointer",c?"bg-black/10 border-white/40 text-white/90":"bg-zinc-100 border-zinc-300 text-zinc-600 dark:bg-zinc-700 dark:border-zinc-500 dark:text-zinc-300"),onClick:K=>{K.stopPropagation();const H=document.getElementById(`msg-${r.replyToId}`);H&&H.scrollIntoView({behavior:"smooth",block:"center"})},children:[(0,e.jsxs)("div",{className:"flex items-center gap-1.5 mb-0.5 opacity-75",children:[(0,e.jsx)(se,{size:10}),(0,e.jsx)("span",{className:"font-bold",children:"Reply"})]}),(0,e.jsx)("div",{className:"truncate opacity-90",children:D(r.replyToId)?.text||"Attachment"})]}),r.media?.length>0&&(0,e.jsx)("div",{className:"grid gap-1 mb-1 overflow-hidden rounded-lg",children:r.media.map((K,H)=>(0,e.jsx)("img",{src:K.url,className:"max-h-64 object-cover w-full rounded-md cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>q(r)},H))}),(0,e.jsx)("div",{className:"whitespace-pre-wrap break-words",children:(0,e.jsx)(De,{options:{...Ye,className:c?"text-white underline":"text-violet-600 dark:text-violet-400 underline"},children:r.text})}),(0,e.jsxs)("div",{className:A("flex justify-end items-center gap-1 mt-0.5 select-none",c?"text-white/70":"text-zinc-400"),children:[(0,e.jsx)("span",{className:"text-[9px] font-medium",children:r.time}),c&&r.id===_&&(r.isRead?(0,e.jsx)(me,{size:12,className:"text-white"}):(0,e.jsx)(we,{size:12,className:"text-white/60"}))]})]})}),(0,e.jsxs)(Ae,{className:"w-48",children:[(0,e.jsxs)(W,{onClick:()=>{navigator.clipboard.writeText(r.text)},children:[(0,e.jsx)(ye,{size:14,className:"mr-2"})," Copy"]}),(0,e.jsxs)(W,{onClick:()=>N(r),children:[(0,e.jsx)(se,{size:14,className:"mr-2"})," Reply"]}),(0,e.jsx)(Ce,{}),(0,e.jsxs)(W,{className:"text-red-500",onClick:()=>k&&k(r.id),children:[(0,e.jsx)(xe,{size:14,className:"mr-2"})," Delete"]})]})]})]})},r.id)})}),w&&(0,e.jsx)("div",{className:"flex items-center gap-2 mt-2 ml-9",children:(0,e.jsx)("div",{className:"bg-zinc-100 dark:bg-zinc-800 px-4 py-2.5 rounded-[22px] rounded-tl-md",children:(0,e.jsx)(qe,{})})})]})}),(0,e.jsxs)("div",{className:"shrink-0 p-3 md:p-4 bg-white dark:bg-black border-t border-zinc-100 dark:border-zinc-800",children:[(0,e.jsx)(be,{children:x&&(0,e.jsxs)(te.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"flex items-center justify-between mb-2 px-4 py-2 bg-zinc-50 dark:bg-zinc-900 rounded-xl border border-zinc-100 dark:border-zinc-800",children:[(0,e.jsxs)("div",{className:"text-sm",children:[(0,e.jsxs)("span",{className:"text-xs font-bold text-violet-500 block mb-0.5",children:["Replying to ",x.sender==="me"?"yourself":x.senderName||n]}),(0,e.jsx)("p",{className:"line-clamp-1 text-zinc-500",children:x.text})]}),(0,e.jsx)("button",{onClick:()=>N(null),children:(0,e.jsx)(Q,{size:16,className:"text-zinc-400"})})]})}),u.length>0&&(0,e.jsx)("div",{className:"flex gap-2 mb-2 px-1",children:u.map(r=>(0,e.jsxs)("div",{className:"relative size-16 rounded-lg overflow-hidden border border-zinc-200",children:[(0,e.jsx)("img",{src:r.url,className:"size-full object-cover"}),(0,e.jsx)("button",{onClick:()=>Z(r.url),className:"absolute top-0 right-0 bg-black/50 text-white p-0.5",children:(0,e.jsx)(Q,{size:12})})]},r.url))}),(0,e.jsxs)("div",{className:"flex items-end gap-2",children:[(0,e.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,e.jsx)("button",{className:"p-2 text-zinc-400 hover:text-violet-600 transition-colors rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-800",onClick:()=>h.current?.click(),children:(0,e.jsx)(oe,{size:24})}),(0,e.jsx)("button",{className:"hidden sm:block p-2 text-zinc-400 hover:text-violet-600 transition-colors rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,e.jsx)(Ne,{size:22})})]}),(0,e.jsxs)("form",{className:"flex-1 flex items-center gap-2 bg-zinc-100 dark:bg-zinc-900 rounded-[24px] px-2 py-1.5 transition-all focus-within:ring-2 focus-within:ring-violet-500/20 focus-within:bg-white dark:focus-within:bg-zinc-900 overflow-hidden border border-transparent focus-within:border-violet-200 dark:focus-within:border-violet-900",onSubmit:F,children:[(0,e.jsxs)(Se,{open:O,onOpenChange:G,children:[(0,e.jsx)(_e,{asChild:!0,children:(0,e.jsx)("button",{type:"button",className:"p-2 text-zinc-400 hover:text-yellow-500 transition-colors",children:(0,e.jsx)(ge,{size:24})})}),(0,e.jsx)(Ge,{className:"w-full p-0 border-none bg-transparent shadow-none",side:"top",align:"start",children:(0,e.jsx)(Ie,{onEmojiSelect:L})})]}),(0,e.jsx)("textarea",{name:"chat-input",value:i,onChange:$,onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),F())},placeholder:"Message...",className:"flex-1 bg-transparent border-none outline-none text-[15px] resize-none max-h-32 py-2.5 min-h-[40px] text-zinc-900 dark:text-white placeholder:text-zinc-500",rows:1}),i.trim()||u.length>0?(0,e.jsx)("button",{type:"submit",className:"p-2 mr-1 rounded-full bg-violet-600 text-white hover:bg-violet-700 hover:scale-105 transition-all shadow-sm",children:(0,e.jsx)(je,{size:18,className:"translate-x-0.5 translate-y-0.5"})}):(0,e.jsx)("button",{type:"button",className:"p-2 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,e.jsx)(ke,{size:22})})]}),(0,e.jsx)("input",{type:"file",ref:h,onChange:E,className:"hidden",multiple:!0,accept:"image/*"})]})]}),s.isGroup?(0,e.jsx)(Re,{isOpen:C,onClose:()=>p(!1),conversation:s,onUpdate:r=>{p(!1)}}):(0,e.jsx)(Ee,{isOpen:C,onClose:()=>p(!1),user:s.user,conversationId:s.id})]})},Ke=He,We=ae(),Qe=()=>{const s=(0,We.c)(29),{id:t,currentUser:a,onlineUsers:U,msgSearchQuery:k,setMsgSearchQuery:d,userSearchResults:M,filteredConversations:w,selectedConversation:g,localMessages:m,isConvLoading:j,isMsgLoading:i,currentIsTyping:v,otherUserIsOnline:R,handleStartConversation:y,handleSelectConversation:u,sendMessage:z,onDeleteMessage:O,sendTypingStatus:G,navigate:x}=Fe();if(!a){let n;s[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,e.jsx)("div",{className:"rounded-3xl bg-zinc-50 p-6 dark:bg-zinc-900",children:(0,e.jsx)(ue,{size:48,className:"text-zinc-300 dark:text-zinc-600"})}),s[0]=n):n=s[0];let b;return s[1]===Symbol.for("react.memo_cache_sentinel")?(b=(0,e.jsxs)("div",{className:"flex h-screen flex-col items-center justify-center gap-6 border-zinc-100 bg-white p-8 text-center dark:border-zinc-800 dark:bg-black md:rounded-2xl md:border",children:[n,(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)("h3",{className:"text-2xl font-black tracking-tight dark:text-white",children:"Sign in to message"}),(0,e.jsx)("p",{className:"max-w-xs text-zinc-500 font-medium",children:"Join the conversation. Sign up or log in to start chatting."})]})]}),s[1]=b):b=s[1],b}if(j){let n;return s[2]===Symbol.for("react.memo_cache_sentinel")?(n=(0,e.jsx)("div",{className:"flex h-screen items-center justify-center border-zinc-100 bg-white dark:border-zinc-800 dark:bg-black md:rounded-2xl md:border",children:(0,e.jsx)(le,{className:"animate-spin text-violet-500",size:32})}),s[2]=n):n=s[2],n}const N=`flex ${t?"h-[100dvh]":"h-[calc(100dvh-4rem)]"} overflow-hidden bg-white shadow-2xl shadow-zinc-200/50 dark:border-zinc-800 dark:bg-black dark:shadow-none md:h-[calc(100vh-1.5rem)] md:rounded-3xl md:border md:border-zinc-200/50`,C=`flex-col md:flex md:w-[400px] ${g?"hidden":"flex"} h-full min-h-0 shrink-0 w-full bg-white dark:bg-black border-r border-zinc-100 dark:border-zinc-800 z-10`,p=t??null;let h;s[3]!==w||s[4]!==u||s[5]!==y||s[6]!==k||s[7]!==U||s[8]!==d||s[9]!==p||s[10]!==M?(h=(0,e.jsx)("div",{className:"flex-1 min-h-0 flex flex-col overflow-y-auto",children:(0,e.jsx)(Ze,{conversations:w,userResults:M,onSelect:u,onStartNew:y,selectedId:p,searchQuery:k,onSearchChange:d,onlineUsers:U})}),s[3]=w,s[4]=u,s[5]=y,s[6]=k,s[7]=U,s[8]=d,s[9]=p,s[10]=M,s[11]=h):h=s[11];let f;s[12]!==C||s[13]!==h?(f=(0,e.jsx)("div",{className:C,children:h}),s[12]=C,s[13]=h,s[14]=f):f=s[14];let o;s[15]!==v||s[16]!==i||s[17]!==m||s[18]!==x||s[19]!==O||s[20]!==R||s[21]!==g||s[22]!==z||s[23]!==G?(o=g?(0,e.jsx)(Ke,{conversation:g,messages:m,onBack:()=>x("/messages"),onSendMessage:z,onDeleteMessage:O,onTyping:n=>G(g.id,n),isLoading:i,isTyping:!!v,isOnline:!!R}):(0,e.jsxs)("div",{className:"hidden flex-1 flex-col items-center justify-center gap-6 text-zinc-500 md:flex bg-zinc-50/30 dark:bg-zinc-900/10",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute -inset-10 rounded-full bg-violet-500/5 blur-3xl dark:bg-violet-500/10"}),(0,e.jsx)("div",{className:"relative rounded-[2.5rem] bg-white p-10 shadow-xl shadow-zinc-200/50 dark:bg-zinc-900/50 dark:shadow-none ring-1 ring-zinc-100 dark:ring-zinc-800",children:(0,e.jsx)(ze,{size:80,className:"text-violet-500 stroke-[1.5]"})})]}),(0,e.jsxs)("div",{className:"text-center max-w-sm px-4 space-y-3",children:[(0,e.jsx)("h3",{className:"text-3xl font-black tracking-tighter text-zinc-900 dark:text-white",children:"Your Messages"}),(0,e.jsx)("p",{className:"text-zinc-500 font-medium text-lg",children:"Send private photos and messages to a friend or group."})]})]}),s[15]=v,s[16]=i,s[17]=m,s[18]=x,s[19]=O,s[20]=R,s[21]=g,s[22]=z,s[23]=G,s[24]=o):o=s[24];let S;return s[25]!==N||s[26]!==f||s[27]!==o?(S=(0,e.jsxs)("div",{className:N,children:[f,o]}),s[25]=N,s[26]=f,s[27]=o,s[28]=S):S=s[28],S},nt=Qe;export{nt as default};
