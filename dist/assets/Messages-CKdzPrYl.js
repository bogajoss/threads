import{n as X}from"./rolldown-runtime-2JzG8er9.js";import{s as F,u as ie,w as ne,y as Y}from"./framework-pMVb9Z5_.js";import"./database-ApDMvJcm.js";import{Et as le,Ft as ce,Gt as K,Ht as oe,Sn as de,cn as xe,ct as me,gn as he,hn as ue,ht as pe,kt as be,lt as J,on as fe,vt as je,xt as ee}from"./ui-libs-Dldhg1Ot.js";import{$ as W,A as ge,B as Z,E as se,H as ve,I as ze,L as Ne,Q as _,R as H,T as te,V as ke,Z as B,ct as we,i as ye,nt as Ce,v as Se,w as re,z as Me}from"./index-CDoqeRNb.js";import{n as $e,t as Ie}from"./linkify-fXGRsD3N.js";import{i as Te,l as ae}from"./hooks-gDAxiSvt.js";var Pe=F(),R=X(ne(),1),s=X(ie(),1),Re=t=>{const e=(0,Pe.c)(55),{conv:a,selectedId:b,onSelect:o,onlineUsers:c}=t,d=Y(),n=ae(a.user?.lastSeen);let i;e[0]!==a.user?.id||e[1]!==c?(i=c.has(a.user?.id),e[0]=a.user?.id,e[1]=c,e[2]=i):i=e[2];const m=i;let z;e[3]!==a.user||e[4]!==d?(z=Q=>{Q.stopPropagation(),a.user?.handle&&d(`/u/${a.user.handle}`)},e[3]=a.user,e[4]=d,e[5]=z):z=e[5];const x=z;let j;e[6]!==a||e[7]!==o?(j=()=>o(a),e[6]=a,e[7]=o,e[8]=j):j=e[8];const g=`flex items-center gap-3 p-4 cursor-pointer transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900 ${b===a.id?"bg-zinc-50 dark:bg-zinc-900 border-r-2 border-violet-500":""}`,w=a.user?.avatar,P=a.user?.name;let y;e[9]!==w||e[10]!==P?(y=(0,s.jsx)(W,{src:w,alt:P,className:"object-cover"}),e[9]=w,e[10]=P,e[11]=y):y=e[11];let f;e[12]!==a.user?.name?.[0]?(f=a.user?.name?.[0]?.toUpperCase(),e[12]=a.user?.name?.[0],e[13]=f):f=e[13];let k;e[14]!==f?(k=(0,s.jsx)(_,{children:f}),e[14]=f,e[15]=k):k=e[15];let M;e[16]!==y||e[17]!==k?(M=(0,s.jsxs)(B,{className:"size-12 group-hover:brightness-90 transition-all",children:[y,k]}),e[16]=y,e[17]=k,e[18]=M):M=e[18];let $;e[19]!==m?($=m&&(0,s.jsx)("span",{className:"absolute bottom-0 right-0 size-3 bg-emerald-500 border-2 border-white dark:border-black rounded-full"}),e[19]=m,e[20]=$):$=e[20];let N;e[21]!==x||e[22]!==M||e[23]!==$?(N=(0,s.jsxs)("div",{className:"relative group",onClick:x,children:[M,$]}),e[21]=x,e[22]=M,e[23]=$,e[24]=N):N=e[24];const I=a.user?.name;let v;e[25]!==x||e[26]!==I?(v=(0,s.jsx)("span",{onClick:x,className:"font-bold dark:text-white truncate cursor-pointer",children:I}),e[25]=x,e[26]=I,e[27]=v):v=e[27];let u;e[28]!==a.user?.lastSeen||e[29]!==m||e[30]!==n?(u=m?(0,s.jsx)("span",{className:"text-[10px] text-emerald-500 font-medium leading-none mb-1",children:"Online"}):a.user?.lastSeen&&(0,s.jsx)("span",{className:"text-[10px] text-zinc-500 font-medium leading-none mb-1",children:n}),e[28]=a.user?.lastSeen,e[29]=m,e[30]=n,e[31]=u):u=e[31];let p;e[32]!==v||e[33]!==u?(p=(0,s.jsxs)("div",{className:"flex flex-col min-w-0",children:[v,u]}),e[32]=v,e[33]=u,e[34]=p):p=e[34];let C;e[35]!==a.time?(C=(0,s.jsx)("span",{className:"text-xs text-zinc-500 whitespace-nowrap ml-2",children:a.time}),e[35]=a.time,e[36]=C):C=e[36];let h;e[37]!==p||e[38]!==C?(h=(0,s.jsxs)("div",{className:"flex justify-between items-center mb-0.5",children:[p,C]}),e[37]=p,e[38]=C,e[39]=h):h=e[39];let E;e[40]!==a.lastMessage?(E=(0,s.jsx)("p",{className:"text-zinc-500 text-sm truncate pr-2",children:a.lastMessage}),e[40]=a.lastMessage,e[41]=E):E=e[41];let U;e[42]!==a.unread?(U=a.unread>0&&(0,s.jsx)("span",{className:"bg-violet-600 text-white text-[10px] font-bold size-5 rounded-full flex items-center justify-center shrink-0",children:a.unread}),e[42]=a.unread,e[43]=U):U=e[43];let L;e[44]!==E||e[45]!==U?(L=(0,s.jsxs)("div",{className:"flex-1 flex justify-between items-center",children:[E,U]}),e[44]=E,e[45]=U,e[46]=L):L=e[46];let O;e[47]!==h||e[48]!==L?(O=(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[h,L]}),e[47]=h,e[48]=L,e[49]=O):O=e[49];let A;return e[50]!==N||e[51]!==O||e[52]!==j||e[53]!==g?(A=(0,s.jsxs)("div",{onClick:j,className:g,children:[N,O]}),e[50]=N,e[51]=O,e[52]=j,e[53]=g,e[54]=A):A=e[54],A},Ee=({conversations:t,userResults:e=[],onSelect:a,onStartNew:b,selectedId:o,searchQuery:c,onSearchChange:d,onlineUsers:n=new Set})=>(0,s.jsxs)("div",{className:"flex-1 flex flex-col min-w-0 bg-white dark:bg-black",children:[(0,s.jsx)("div",{className:"p-4 border-b border-zinc-100 dark:border-zinc-800",children:(0,s.jsx)(Se,{value:c,onChange:d,onClear:()=>d(""),placeholder:"Search people or messages..."})}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[t.length>0&&(0,s.jsx)("div",{className:"py-2",children:t.filter(i=>i.lastMessage!=="No messages yet"||i.id===o).map(i=>(0,s.jsx)(Re,{conv:i,selectedId:o,onSelect:a,onlineUsers:n},i.id))}),e.length>0&&(0,s.jsxs)("div",{className:"border-t border-zinc-100 dark:border-zinc-800",children:[(0,s.jsx)("div",{className:"px-4 py-3 text-xs font-bold text-zinc-500 uppercase tracking-wider",children:"People"}),e.map(i=>(0,s.jsxs)("div",{onClick:()=>b(i),className:"flex items-center gap-3 p-4 cursor-pointer transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[(0,s.jsxs)(B,{className:"size-12",children:[(0,s.jsx)(W,{src:i.avatar,alt:i.name,className:"object-cover"}),(0,s.jsx)(_,{children:i.name?.[0]?.toUpperCase()})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"font-bold dark:text-white truncate",children:i.name}),(0,s.jsxs)("div",{className:"text-zinc-500 text-sm truncate",children:["@",i.handle]})]}),(0,s.jsx)(pe,{size:18,className:"text-violet-500"})]},i.id))]}),t.length===0&&e.length===0&&c&&(0,s.jsx)("div",{className:"p-8 text-center",children:(0,s.jsxs)("p",{className:"text-zinc-500 text-sm",children:['No conversations or people found for "',c,'"']})}),t.length===0&&!c&&(0,s.jsx)("div",{className:"p-8 text-center",children:(0,s.jsx)("p",{className:"text-zinc-500 text-sm",children:"No messages yet. Search for people to start a chat!"})})]})]}),Ue=Ee,Le=F(),Oe=["â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ‘"],Ae=t=>{const e=(0,Le.c)(6),{onSelect:a,currentReaction:b}=t;let o;e[0]===Symbol.for("react.memo_cache_sentinel")?(o=(0,s.jsx)(se,{asChild:!0,children:(0,s.jsx)("button",{className:"p-1.5 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-all active:scale-90",onClick:_e,children:(0,s.jsx)(ee,{size:16})})}),e[0]=o):o=e[0];let c;e[1]!==b||e[2]!==a?(c=Oe.map(n=>(0,s.jsx)("button",{onClick:()=>a(n),className:`text-xl p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-all active:scale-125 ${b===n?"bg-zinc-100 dark:bg-zinc-800":""}`,children:n},n)),e[1]=b,e[2]=a,e[3]=c):c=e[3];let d;return e[4]!==c?(d=(0,s.jsxs)(re,{children:[o,(0,s.jsx)(te,{side:"top",align:"center",className:"w-fit p-1 rounded-full bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 shadow-xl",onClick:Be,children:(0,s.jsx)("div",{className:"flex items-center gap-1",children:c})})]}),e[4]=c,e[5]=d):d=e[5],d},We=Ae;function _e(t){return t.stopPropagation()}function Be(t){return t.stopPropagation()}var Fe=F(),Qe=t=>{const e=(0,Fe.c)(10),{reactions:a,currentUser:b,onToggle:o}=t;let c;e[0]!==a?(c=a===void 0?[]:a,e[0]=a,e[1]=c):c=e[1];const d=c;let n;e[2]!==b?.id||e[3]!==d?(n={},d.forEach(x=>{n[x.emoji]||(n[x.emoji]={count:0,me:!1}),n[x.emoji].count=n[x.emoji].count+1,x.user_id===b?.id&&(n[x.emoji].me=!0)}),e[2]=b?.id,e[3]=d,e[4]=n):n=e[4];const i=n;if(d.length===0)return null;let m;e[5]!==i?(m=Object.entries(i),e[5]=i,e[6]=m):m=e[6];let z;return e[7]!==o||e[8]!==m?(z=(0,s.jsx)("div",{className:"flex flex-wrap gap-1 mt-1 px-2",children:m.map(x=>{const[j,g]=x;return(0,s.jsxs)("button",{onClick:w=>{w.stopPropagation(),o(j)},className:`flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium border transition-all active:scale-90 ${g.me?"bg-violet-50 border-violet-200 text-violet-600 dark:bg-violet-900/30 dark:border-violet-800 dark:text-violet-400":"bg-white border-zinc-100 text-zinc-600 dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-400"}`,children:[(0,s.jsx)("span",{children:j}),g.count>1&&(0,s.jsx)("span",{children:g.count})]},j)})}),e[7]=o,e[8]=m,e[9]=z):z=e[9],z},qe=Qe,He=["â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ‘"],Ke=({conversation:t,messages:e,onBack:a,onSendMessage:b,onToggleReaction:o,onDeleteMessage:c,currentUser:d,onTyping:n,isLoading:i,isTyping:m,isOnline:z})=>{const x=Y(),{openLightbox:j}=Ce(),[g,w]=(0,R.useState)(""),[P,y]=(0,R.useState)(!1),[f,k]=(0,R.useState)([]),[M,$]=(0,R.useState)(!1),[N,I]=(0,R.useState)(null),v=(0,R.useRef)(null),u=(0,R.useRef)(null),p=(0,R.useRef)(null),C=ae(t.user?.lastSeen);(0,R.useEffect)(()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},[e,m]);const h=r=>{const l=r.target.value;w(l),n&&(n(!0),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{n(!1)},2e3))},E=r=>{w(l=>l+r.emoji)},U=r=>{r.preventDefault(),!(!g.trim()&&f.length===0)&&(n&&(clearTimeout(p.current),n(!1)),b(t.id,g,f.length>0?"image":"text",f,N?.id),w(""),k([]),I(null))},L=async r=>{const l=Array.from(r.target.files);if(l.length!==0){y(!0);try{const T=await Promise.all(l.map(S=>we(S)));k(S=>[...S,...T])}catch(T){console.error("Upload failed:",T)}finally{y(!1)}}},O=r=>{k(l=>l.filter(T=>T.url!==r))},A=r=>{!r.media||r.media.length===0||j(r.media.map(l=>l.url),0)},Q=(0,R.useMemo)(()=>{const r=e.filter(l=>l.sender==="me");return r.length>0?r[r.length-1].id:null},[e]),V=r=>e.find(l=>l.id===r);return(0,s.jsxs)("div",{className:"flex-1 flex flex-col h-full min-w-0 bg-white dark:bg-black md:border-l md:border-zinc-100 dark:md:border-zinc-800",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-between shrink-0 bg-white/80 dark:bg-black/80 backdrop-blur-md sticky top-0 z-10",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{onClick:a,className:"md:hidden p-1 rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-800 dark:text-white transition-colors",children:(0,s.jsx)(de,{size:20})}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)(B,{className:"size-10 border border-zinc-200 dark:border-zinc-700",children:[(0,s.jsx)(W,{src:t.user.avatar,alt:t.user.name,className:"object-cover"}),(0,s.jsx)(_,{children:t.user.name?.[0]?.toUpperCase()})]}),z&&(0,s.jsx)("span",{className:"absolute bottom-0 right-0 size-3 bg-emerald-500 border-2 border-white dark:border-black rounded-full"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-bold dark:text-white",children:t.user.name}),z?(0,s.jsxs)("div",{className:"text-xs text-emerald-500 font-medium flex items-center gap-1",children:[(0,s.jsx)("span",{className:"size-1.5 bg-emerald-500 rounded-full animate-pulse"}),"Online"]}):(0,s.jsx)("div",{className:"text-xs text-zinc-500 font-medium",children:t.user.lastSeen?`Last seen ${C}`:"Offline"})]})]}),(0,s.jsx)("button",{className:"p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full dark:text-zinc-400",children:(0,s.jsx)(fe,{size:20})})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",ref:u,children:[(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsxs)("div",{className:"relative w-fit mx-auto",children:[(0,s.jsxs)(B,{className:"size-20 mx-auto mb-3 border-4 border-zinc-50 dark:border-zinc-900 shadow-sm",children:[(0,s.jsx)(W,{src:t.user.avatar,alt:t.user.name,className:"object-cover"}),(0,s.jsx)(_,{className:"text-2xl font-bold",children:t.user.name?.[0]?.toUpperCase()})]}),z&&(0,s.jsx)("span",{className:"absolute bottom-4 right-1 size-5 bg-emerald-500 border-4 border-white dark:border-black rounded-full animate-in zoom-in duration-300"})]}),(0,s.jsx)("h4",{className:"font-bold dark:text-white text-lg",children:t.user.name}),(0,s.jsxs)("p",{className:"text-sm text-zinc-500",children:["@",t.user.handle]}),(0,s.jsxs)("p",{className:"text-xs text-zinc-400 mt-4 max-w-xs mx-auto",children:["This is the beginning of your direct message history with"," ",(0,s.jsxs)("span",{className:"font-bold",children:["@",t.user.handle]})]})]}),i&&e.length===0?(0,s.jsx)("div",{className:"flex justify-center p-8",children:(0,s.jsx)(K,{className:"animate-spin text-violet-500",size:32})}):e.map(r=>(0,s.jsxs)(ze,{children:[(0,s.jsx)(ke,{asChild:!0,children:(0,s.jsxs)("div",{id:`msg-${r.id}`,className:`flex items-end gap-2 group ${r.sender==="me"?"flex-row-reverse":"flex-row"}`,children:[(0,s.jsxs)("div",{className:`max-w-[75%] p-1 rounded-2xl text-[15px] shadow-sm relative ${r.sender==="me"?"bg-violet-600 text-white rounded-tr-none":"bg-zinc-100 dark:bg-zinc-800 dark:text-white rounded-tl-none"}`,children:[r.replyToId&&(0,s.jsxs)("div",{className:`mb-2 p-2 rounded-lg border-l-4 text-xs truncate cursor-pointer ${r.sender==="me"?"bg-violet-500/50 border-violet-300 text-violet-100":"bg-zinc-200/50 dark:bg-zinc-700/50 border-zinc-400 dark:border-zinc-500 text-zinc-600 dark:text-zinc-300"}`,onClick:l=>{l.stopPropagation(),document.getElementById(`msg-${r.replyToId}`)?.scrollIntoView({behavior:"smooth",block:"center"})},children:[(0,s.jsx)("span",{className:"font-bold block mb-0.5",children:V(r.replyToId)?.sender==="me"?"You":t.user.name}),V(r.replyToId)?.text||"Media"]}),r.media?.length>0&&(0,s.jsx)("div",{className:"mb-2 grid gap-1 grid-cols-1 overflow-hidden rounded-lg cursor-pointer",onClick:()=>A(r),children:r.media.map((l,T)=>(0,s.jsx)("img",{src:l.url,alt:"",className:"max-h-60 w-full object-cover rounded-md hover:brightness-90 transition-all"},T))}),r.text&&(0,s.jsx)("div",{className:"m-0 leading-tight px-3 py-1 whitespace-pre-line break-words",children:(0,s.jsx)($e,{options:{...Ie,render:({attributes:l,content:T})=>{const{href:S,...D}=l,G=!S.startsWith("/")&&(S.startsWith("http")||S.startsWith("www"));return S.startsWith("/u/")||S.startsWith("/tags/")||S.startsWith("/c/")||S.startsWith("/explore")?(0,s.jsx)("span",{...D,className:`underline decoration-2 underline-offset-2 cursor-pointer transition-opacity break-all ${r.sender==="me"?"text-white":"text-rose-500 dark:text-rose-400"}`,onClick:q=>{q.stopPropagation(),x(S)},children:T},T):(0,s.jsx)("a",{href:S,...D,className:`underline decoration-2 underline-offset-2 hover:opacity-80 transition-opacity break-all ${r.sender==="me"?"text-white":""}`,target:G?"_blank":void 0,rel:G?"noopener noreferrer":void 0,onClick:q=>q.stopPropagation(),children:T},T)}},children:r.text})}),r.reactions?.length>0&&(0,s.jsx)(qe,{reactions:r.reactions,currentUser:d,onToggle:l=>o(r.id,l)}),(0,s.jsxs)("div",{className:`text-[10px] flex items-center justify-end gap-1 px-3 pb-1 ${r.sender==="me"?"text-violet-200":"text-zinc-400"}`,children:[r.time,r.sender==="me"&&r.id===Q&&(0,s.jsx)("span",{className:"ml-0.5",children:r.isRead?(0,s.jsx)(he,{size:14,className:"text-white"}):(0,s.jsx)(ue,{size:14,className:"text-violet-200"})})]})]}),(0,s.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)(We,{onSelect:l=>o(r.id,l),currentReaction:r.reactions?.find(l=>l.user_id===d?.id)?.emoji})})]})}),(0,s.jsxs)(Ne,{className:"w-64 rounded-xl bg-white dark:bg-zinc-950 border-zinc-100 dark:border-zinc-800 shadow-xl",children:[(0,s.jsx)(Me,{className:"text-xs text-zinc-500 font-bold px-3 py-2",children:"QUICK REACTION"}),(0,s.jsx)("div",{className:"flex items-center justify-between px-2 pb-2",children:He.map(l=>(0,s.jsx)("button",{onClick:()=>o(r.id,l),className:"text-xl p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-all active:scale-125",children:l},l))}),(0,s.jsx)(Z,{className:"bg-zinc-100 dark:bg-zinc-800"}),(0,s.jsxs)(H,{className:"gap-3 px-3 py-2.5 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-900",onClick:()=>{navigator.clipboard.writeText(r.text)},children:[(0,s.jsx)(xe,{size:16,className:"text-zinc-500"}),(0,s.jsx)("span",{className:"font-medium",children:"Copy Text"})]}),(0,s.jsxs)(H,{className:"gap-3 px-3 py-2.5 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-900",onClick:()=>I(r),children:[(0,s.jsx)(be,{size:16,className:"text-zinc-500"}),(0,s.jsx)("span",{className:"font-medium",children:"Reply"})]}),(0,s.jsx)(Z,{className:"bg-zinc-100 dark:bg-zinc-800"}),(0,s.jsxs)(H,{className:"gap-3 px-3 py-2.5 cursor-pointer text-rose-500 focus:text-rose-500 focus:bg-rose-50 dark:focus:bg-rose-900/20",onClick:()=>c(r.id),children:[(0,s.jsx)(je,{size:16}),(0,s.jsx)("span",{className:"font-medium",children:"Delete message"})]})]})]},r.id)),m&&(0,s.jsx)("div",{className:"flex justify-start animate-in fade-in slide-in-from-bottom-2 duration-300",children:(0,s.jsx)("div",{className:"bg-zinc-100 dark:bg-zinc-800/50 px-3 py-2 rounded-2xl rounded-tl-none border border-zinc-200/50 dark:border-zinc-700/30 shadow-sm",children:(0,s.jsx)(ye,{})})})]}),(0,s.jsxs)("div",{className:"p-4 border-t border-zinc-100 dark:border-zinc-800 bg-white dark:bg-black shrink-0",children:[N&&(0,s.jsxs)("div",{className:"mb-3 p-3 bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-xl flex items-center justify-between animate-in slide-in-from-bottom-2 duration-200",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("span",{className:"text-xs font-bold text-violet-600 dark:text-violet-400 block mb-1",children:["Replying to"," ",N.sender==="me"?"yourself":t.user.name]}),(0,s.jsx)("p",{className:"text-sm text-zinc-500 truncate",children:N.text||"Media"})]}),(0,s.jsx)("button",{onClick:()=>I(null),className:"p-1 hover:bg-zinc-200 dark:hover:bg-zinc-800 rounded-full text-zinc-400 transition-colors",children:(0,s.jsx)(J,{size:18})})]}),f.length>0&&(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 mb-3",children:[f.map(r=>(0,s.jsxs)("div",{className:"relative size-16 rounded-xl overflow-hidden border border-zinc-200 dark:border-zinc-800",children:[(0,s.jsx)("img",{src:r.url,className:"size-full object-cover",alt:""}),(0,s.jsx)("button",{type:"button",onClick:()=>O(r.url),className:"absolute top-1 right-1 bg-black/50 text-white rounded-full p-0.5 hover:bg-black transition-colors",children:(0,s.jsx)(J,{size:12})})]},r.url)),P&&(0,s.jsx)("div",{className:"size-16 rounded-xl bg-zinc-100 dark:bg-zinc-900 flex items-center justify-center",children:(0,s.jsx)(K,{className:"animate-spin text-violet-500",size:20})})]}),(0,s.jsxs)("form",{onSubmit:U,className:"flex items-center gap-2 bg-zinc-100 dark:bg-zinc-900 p-2 rounded-2xl border border-transparent focus-within:border-violet-500 transition-all",children:[(0,s.jsxs)(re,{open:M,onOpenChange:$,children:[(0,s.jsx)(se,{asChild:!0,children:(0,s.jsx)("button",{type:"button",className:"p-2 text-zinc-500 hover:text-violet-600 transition-colors",children:(0,s.jsx)(ee,{size:20})})}),(0,s.jsx)(te,{className:"w-fit p-0 border-none bg-transparent shadow-none",side:"top",align:"start",sideOffset:10,children:(0,s.jsx)(ge,{onEmojiSelect:r=>{E(r)}})})]}),(0,s.jsx)("input",{type:"text",className:"flex-1 min-w-0 bg-transparent border-none outline-none dark:text-white py-1 px-1",placeholder:"Start a new message",value:g,onChange:h}),(0,s.jsx)("input",{type:"file",ref:v,onChange:L,className:"hidden",multiple:!0,accept:"image/*"}),(0,s.jsx)("button",{type:"button",onClick:()=>v.current?.click(),className:"p-2 text-zinc-500 hover:text-violet-600 transition-colors",disabled:P,children:(0,s.jsx)(ce,{size:20})}),(0,s.jsx)(ve,{type:"submit",className:"size-10 !p-0 rounded-xl",disabled:!g.trim()&&f.length===0||P,children:(0,s.jsx)(le,{size:18})})]})]})]})},Ve=Ke,De=F(),Ge=()=>{const t=(0,De.c)(30),{id:e,currentUser:a,onlineUsers:b,msgSearchQuery:o,setMsgSearchQuery:c,userSearchResults:d,filteredConversations:n,selectedConversation:i,localMessages:m,isConvLoading:z,isMsgLoading:x,currentIsTyping:j,otherUserIsOnline:g,handleStartConversation:w,handleSelectConversation:P,sendMessage:y,sendTypingStatus:f,onToggleReaction:k,navigate:M}=Te();if(!a){let h;return t[0]===Symbol.for("react.memo_cache_sentinel")?(h=(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-screen gap-4 p-8 text-center bg-white dark:bg-black md:rounded-xl md:border border-zinc-100 dark:border-zinc-800",children:[(0,s.jsx)("div",{className:"bg-zinc-100 dark:bg-zinc-900 p-4 rounded-full",children:(0,s.jsx)(me,{size:40,className:"text-zinc-400"})}),(0,s.jsx)("h3",{className:"text-xl font-bold dark:text-white",children:"Sign in to message others"}),(0,s.jsx)("p",{className:"text-zinc-500 max-w-xs",children:"Start decentralized conversations with anyone on the network."})]}),t[0]=h):h=t[0],h}if(z){let h;return t[1]===Symbol.for("react.memo_cache_sentinel")?(h=(0,s.jsx)("div",{className:"flex h-screen items-center justify-center bg-white dark:bg-black md:rounded-xl md:border border-zinc-100 dark:border-zinc-800",children:(0,s.jsx)(K,{className:"animate-spin text-violet-500",size:32})}),t[1]=h):h=t[1],h}const $=`flex ${e?"h-[100dvh]":"h-[calc(100dvh-4rem)]"} md:h-[calc(100vh-2rem)] bg-white dark:bg-black overflow-hidden md:rounded-xl md:border border-zinc-100 dark:border-zinc-800`,N=`w-full md:w-80 flex flex-col border-r border-zinc-100 dark:border-zinc-800 ${i?"hidden md:flex":"flex"}`;let I;t[2]===Symbol.for("react.memo_cache_sentinel")?(I=(0,s.jsx)("div",{className:"p-4 border-b border-zinc-100 dark:border-zinc-800",children:(0,s.jsx)("h2",{className:"text-xl font-bold dark:text-white",children:"Messages"})}),t[2]=I):I=t[2];let v;t[3]!==n||t[4]!==P||t[5]!==w||t[6]!==e||t[7]!==o||t[8]!==b||t[9]!==c||t[10]!==d?(v=(0,s.jsx)(Ue,{conversations:n,userResults:d,onSelect:P,onStartNew:w,selectedId:e,searchQuery:o,onSearchChange:c,onlineUsers:b}),t[3]=n,t[4]=P,t[5]=w,t[6]=e,t[7]=o,t[8]=b,t[9]=c,t[10]=d,t[11]=v):v=t[11];let u;t[12]!==N||t[13]!==v?(u=(0,s.jsxs)("div",{className:N,children:[I,v]}),t[12]=N,t[13]=v,t[14]=u):u=t[14];let p;t[15]!==j||t[16]!==a||t[17]!==x||t[18]!==m||t[19]!==M||t[20]!==k||t[21]!==g||t[22]!==i||t[23]!==y||t[24]!==f?(p=i?(0,s.jsx)(Ve,{conversation:i,messages:m,onBack:()=>M("/messages"),onSendMessage:y,onToggleReaction:k,currentUser:a,onTyping:h=>f(i.id,h),isLoading:x,isTyping:j,isOnline:g}):(0,s.jsxs)("div",{className:"hidden md:flex flex-1 items-center justify-center text-zinc-500 flex-col gap-4",children:[(0,s.jsx)("div",{className:"bg-zinc-50 dark:bg-zinc-900 p-6 rounded-full",children:(0,s.jsx)(oe,{size:48,className:"text-zinc-300"})}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:"Select a message"}),(0,s.jsx)("p",{children:"Choose from your existing conversations or start a new one."})]})]}),t[15]=j,t[16]=a,t[17]=x,t[18]=m,t[19]=M,t[20]=k,t[21]=g,t[22]=i,t[23]=y,t[24]=f,t[25]=p):p=t[25];let C;return t[26]!==$||t[27]!==u||t[28]!==p?(C=(0,s.jsxs)("div",{className:$,children:[u,p]}),t[26]=$,t[27]=u,t[28]=p,t[29]=C):C=t[29],C},rs=Ge;export{rs as default};
