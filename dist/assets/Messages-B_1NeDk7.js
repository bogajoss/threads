import{a as ie}from"./rolldown-runtime-BaZ8gS7u.js";import{E as ne,b as ce,c as ae,d as de}from"./framework-CsA6nn9m.js";import"./database-BOtUlDBt.js";import{$n as oe,Ft as Q,Ht as ee,Kn as xe,Kt as me,Pt as he,Rn as ue,Rt as pe,Tn as fe,X as be,Xt as ge,Y as te,Yt as je,en as ve,gn as ze,mn as Ne,qn as ke,rn as se,sn as we,tn as re,un as ye,wn as Ce,xn as le,zt as Se}from"./ui-libs-BTPHttU6.js";import{$ as Me,H as Ge,I as Ie,L as Te,M as Ae,Q as Pe,R as Re,X as Ue,Xt as $e,Y as Oe,Z as J,Zt as A,_ as Le,et as H,ft as Ee,n as qe,nt as K,pt as Ye,t as _e,tt as B}from"./index-ChrI94EA.js";import{n as De,t as Fe}from"./linkify-CDs92yJ8.js";import{a as Xe,u as He}from"./hooks-CtTsWAW1.js";var Ke=ae(),I=ie(ne(),1),e=ie(de(),1),Be=s=>{const t=(0,Ke.c)(60),{conv:a,selectedId:P,onSelect:k,onlineUsers:d}=s;let S;t[0]!==a.isGroup||t[1]!==a.user||t[2]!==d?(S=!a.isGroup&&a.user?d.has(a.user.id):!1,t[0]=a.isGroup,t[1]=a.user,t[2]=d,t[3]=S):S=t[3];const w=S,b=P===a.id,m=a.unread>0,g=a.isGroup?a.name:a.user?.name,i=a.isGroup?a.avatar:a.user?.avatar;let j;t[4]!==a||t[5]!==k?(j=()=>k(a),t[4]=a,t[5]=k,t[6]=j):j=t[6];const $=b?"bg-violet-500/10 dark:bg-violet-500/20":"hover:bg-zinc-100 dark:hover:bg-zinc-800/50";let y;t[7]!==$?(y=A("group relative flex cursor-pointer items-center gap-4 p-3 mx-2 rounded-2xl transition-all duration-200",$),t[7]=$,t[8]=y):y=t[8];const u=b?"border-violet-500/30":"border-transparent group-hover:border-zinc-200 dark:group-hover:border-zinc-700";let v;t[9]!==u?(v=A("size-[52px] border-2 transition-all",u),t[9]=u,t[10]=v):v=t[10];const R=g||"";let M;t[11]!==i||t[12]!==R?(M=(0,e.jsx)(K,{src:i,alt:R,className:"object-cover"}),t[11]=i,t[12]=R,t[13]=M):M=t[13];let x;t[14]!==g?.[0]?(x=g?.[0]?.toUpperCase(),t[14]=g?.[0],t[15]=x):x=t[15];let z;t[16]!==x?(z=(0,e.jsx)(B,{className:"bg-zinc-100 text-zinc-500 font-bold text-lg dark:bg-zinc-800 dark:text-zinc-400",children:x}),t[16]=x,t[17]=z):z=t[17];let G;t[18]!==z||t[19]!==v||t[20]!==M?(G=(0,e.jsxs)(H,{className:v,children:[M,z]}),t[18]=z,t[19]=v,t[20]=M,t[21]=G):G=t[21];let N;t[22]!==w?(N=w&&(0,e.jsx)("span",{className:"absolute bottom-0.5 right-0.5 size-3.5 rounded-full border-[2.5px] border-white bg-emerald-500 ring-0 dark:border-black"}),t[22]=w,t[23]=N):N=t[23];let h;t[24]!==G||t[25]!==N?(h=(0,e.jsxs)("div",{className:"relative",children:[G,N]}),t[24]=G,t[25]=N,t[26]=h):h=t[26];const p=m?"text-zinc-900 dark:text-white":"text-zinc-700 dark:text-zinc-200";let o;t[27]!==p?(o=A("truncate text-[15px] font-semibold",p),t[27]=p,t[28]=o):o=t[28];let C;t[29]!==g||t[30]!==o?(C=(0,e.jsx)("span",{className:o,children:g}),t[29]=g,t[30]=o,t[31]=C):C=t[31];const n=m?"text-violet-600 dark:text-violet-400":"text-zinc-400";let f;t[32]!==n?(f=A("ml-2 whitespace-nowrap text-[11px] font-medium",n),t[32]=n,t[33]=f):f=t[33];let O;t[34]!==a.time||t[35]!==f?(O=(0,e.jsx)("span",{className:f,children:a.time}),t[34]=a.time,t[35]=f,t[36]=O):O=t[36];let L;t[37]!==C||t[38]!==O?(L=(0,e.jsxs)("div",{className:"flex items-center justify-between mb-0.5",children:[C,O]}),t[37]=C,t[38]=O,t[39]=L):L=t[39];const F=m?"font-semibold text-zinc-900 dark:text-zinc-100":"text-zinc-500 dark:text-zinc-400 group-hover:text-zinc-600 dark:group-hover:text-zinc-300";let E;t[40]!==F?(E=A("truncate text-[13px] leading-relaxed",F),t[40]=F,t[41]=E):E=t[41];const V=a.currentUserSent?"You: ":"";let q;t[42]!==a.lastMessage||t[43]!==E||t[44]!==V?(q=(0,e.jsxs)("p",{className:E,children:[V,a.lastMessage]}),t[42]=a.lastMessage,t[43]=E,t[44]=V,t[45]=q):q=t[45];let Y;t[46]!==a.unread||t[47]!==m?(Y=m&&(0,e.jsx)("span",{className:"flex size-5 shrink-0 items-center justify-center rounded-full bg-violet-600 text-[10px] font-bold text-white shadow-sm shadow-violet-500/30",children:a.unread}),t[46]=a.unread,t[47]=m,t[48]=Y):Y=t[48];let _;t[49]!==q||t[50]!==Y?(_=(0,e.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[q,Y]}),t[49]=q,t[50]=Y,t[51]=_):_=t[51];let D;t[52]!==L||t[53]!==_?(D=(0,e.jsxs)("div",{className:"min-w-0 flex-1 py-1",children:[L,_]}),t[52]=L,t[53]=_,t[54]=D):D=t[54];let X;return t[55]!==h||t[56]!==j||t[57]!==D||t[58]!==y?(X=(0,e.jsxs)("div",{onClick:j,className:y,children:[h,D]}),t[55]=h,t[56]=j,t[57]=D,t[58]=y,t[59]=X):X=t[59],X},Ve=({conversations:s,userResults:t=[],onSelect:a,onStartNew:P,selectedId:k,searchQuery:d,onSearchChange:S,onlineUsers:w=new Set})=>{const[b,m]=(0,I.useState)(!1),g=s.filter(i=>w.has(i.user?.id));return(0,e.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col bg-white dark:bg-black h-full",children:[(0,e.jsxs)("div",{className:"px-5 pt-5 pb-2",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between mb-5",children:[(0,e.jsx)("h2",{className:"text-2xl font-black tracking-tight text-zinc-900 dark:text-white",children:"Chats"}),(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)("button",{onClick:()=>m(!0),className:"rounded-full bg-zinc-100 p-2.5 text-zinc-600 transition-colors hover:bg-zinc-200 dark:bg-zinc-900 dark:text-zinc-400 dark:hover:bg-zinc-800",title:"New Group",children:(0,e.jsx)(Se,{size:20})}),(0,e.jsx)("button",{className:"rounded-full bg-zinc-100 p-2.5 text-zinc-600 transition-colors hover:bg-zinc-200 dark:bg-zinc-900 dark:text-zinc-400 dark:hover:bg-zinc-800",children:(0,e.jsx)(je,{size:20})})]})]}),(0,e.jsxs)("div",{className:"relative group",children:[(0,e.jsx)(re,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-violet-500 transition-colors",size:18}),(0,e.jsx)("input",{type:"text",value:d,onChange:i=>S(i.target.value),placeholder:"Search Messenger",className:"w-full rounded-2xl border-none bg-zinc-100 py-3 pl-12 pr-4 text-[15px] font-medium text-zinc-900 placeholder:text-zinc-500 transition-all focus:bg-white focus:ring-2 focus:ring-violet-500/20 focus:shadow-md dark:bg-zinc-900 dark:text-white dark:focus:bg-black"})]})]}),(0,e.jsx)(Ae,{className:"flex-1",children:(0,e.jsxs)("div",{className:"flex flex-col pb-4",children:[!d&&g.length>0&&(0,e.jsx)("div",{className:"mb-4 mt-2",children:(0,e.jsxs)("div",{className:"flex gap-4 overflow-x-auto px-5 pb-4 pt-2 no-scrollbar",children:[(0,e.jsxs)("div",{className:"flex flex-col items-center gap-2 min-w-[64px] cursor-pointer group",children:[(0,e.jsxs)("div",{className:"relative flex size-[60px] items-center justify-center rounded-full bg-zinc-50 border border-zinc-200 dark:bg-zinc-900 dark:border-zinc-800 group-hover:bg-zinc-100 dark:group-hover:bg-zinc-800 transition-colors",children:[(0,e.jsx)(ee,{size:24,className:"text-zinc-400"}),(0,e.jsx)("div",{className:"absolute bottom-0 right-0 size-5 bg-white dark:bg-black rounded-full flex items-center justify-center",children:(0,e.jsx)("div",{className:"size-4 bg-zinc-200 dark:bg-zinc-700 rounded-full flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-[10px] text-zinc-500 font-bold",children:"+"})})})]}),(0,e.jsx)("span",{className:"text-[11px] font-medium text-zinc-500",children:"Your Story"})]}),g.map(i=>(0,e.jsxs)("div",{onClick:()=>a(i),className:"flex flex-col items-center gap-2 cursor-pointer group min-w-[64px] transition-transform active:scale-95",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute -inset-[3px] rounded-full bg-gradient-to-tr from-violet-500 via-fuchsia-500 to-orange-500 opacity-90 p-[2px]"}),(0,e.jsx)("div",{className:"relative rounded-full border-[3px] border-white dark:border-black p-[2px] bg-white dark:bg-black",children:(0,e.jsxs)(H,{className:"size-[50px]",children:[(0,e.jsx)(K,{src:i.user?.avatar,className:"object-cover"}),(0,e.jsx)(B,{children:i.user?.name?.[0]})]})}),(0,e.jsx)("span",{className:"absolute bottom-1 right-1 size-3.5 rounded-full border-[2.5px] border-white bg-emerald-500 dark:border-black"})]}),(0,e.jsx)("span",{className:"w-full truncate text-center text-[11px] font-medium text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white transition-colors",children:i.user?.name.split(" ")[0]})]},i.id))]})}),(0,e.jsx)("div",{className:"px-2 space-y-1",children:s.length>0&&s.filter(i=>i.lastMessage!=="No messages yet"||i.id===k||d).map(i=>(0,e.jsx)(Be,{conv:i,selectedId:k,onSelect:a,onlineUsers:w},i.id))}),t.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"px-6 py-3 mt-2 text-xs font-bold uppercase tracking-wider text-zinc-400",children:"More People"}),(0,e.jsx)("div",{className:"px-2 space-y-1",children:t.map(i=>(0,e.jsxs)("div",{onClick:()=>P(i),className:"flex cursor-pointer items-center gap-4 px-3 py-2 rounded-2xl transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800/50",children:[(0,e.jsxs)(H,{className:"size-10",children:[(0,e.jsx)(K,{src:i.avatar,className:"object-cover"}),(0,e.jsx)(B,{children:i.name?.[0]?.toUpperCase()})]}),(0,e.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,e.jsx)("div",{className:"truncate text-sm font-bold text-zinc-900 dark:text-white",children:i.name}),(0,e.jsxs)("div",{className:"truncate text-xs text-zinc-500",children:["@",i.handle]})]}),(0,e.jsx)("button",{className:"flex size-8 items-center justify-center rounded-full bg-violet-50 text-violet-600 dark:bg-violet-900/20 dark:text-violet-400",children:(0,e.jsx)(ee,{size:16})})]},i.id))})]}),s.length===0&&t.length===0&&d&&(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center px-6",children:[(0,e.jsx)("div",{className:"mb-4 rounded-full bg-zinc-100 p-4 dark:bg-zinc-900",children:(0,e.jsx)(re,{className:"text-zinc-400",size:24})}),(0,e.jsxs)("p",{className:"text-zinc-500",children:['No results found for "',d,'"']})]})]})}),(0,e.jsx)(qe,{isOpen:b,onClose:()=>m(!1),onCreated:i=>{a({id:i,isGroup:!0})}})]})},Ze=Ve,We=({conversation:s,messages:t,onBack:a,onSendMessage:P,onDeleteMessage:k,onTyping:d,isLoading:S,isTyping:w,isOnline:b})=>{const m=ce(),{openLightbox:g}=Ye(),[i,j]=(0,I.useState)(""),[$,y]=(0,I.useState)(!1),[u,v]=(0,I.useState)([]),[R,M]=(0,I.useState)(!1),[x,z]=(0,I.useState)(null),[G,N]=(0,I.useState)(!1),h=(0,I.useRef)(null),p=(0,I.useRef)(null),o=(0,I.useRef)(null),C=He(s.user?.lastSeen),n=s.isGroup?s.name:s.user?.name,f=s.isGroup?s.avatar:s.user?.avatar;(0,I.useEffect)(()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)},[t,w,u,x]);const O=r=>{const l=r.target.value;j(l),r.target.style.height="auto",r.target.style.height=`${Math.min(r.target.scrollHeight,120)}px`,d&&(d(!0),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{d(!1)},2e3))},L=r=>{j(l=>l+r.emoji)},F=r=>{if(r&&r.preventDefault(),!i.trim()&&u.length===0)return;d&&(o.current&&clearTimeout(o.current),d(!1)),P(s.id,i,u.length>0?"image":"text",u,x?.id),j(""),v([]),z(null);const l=document.querySelector('textarea[name="chat-input"]');l&&(l.style.height="auto")},E=async r=>{if(!r.target.files)return;const l=Array.from(r.target.files);if(l.length!==0){y(!0);try{const c=await Promise.all(l.map(T=>$e(T)));v(T=>[...T,...c])}catch(c){console.error("Upload failed:",c)}finally{y(!1)}}},V=r=>{v(l=>l.filter(c=>c.url!==r))},q=r=>{!r.media||r.media.length===0||g(r.media.map(l=>l.url),0)},Y=(0,I.useMemo)(()=>{const r=t.filter(l=>l.sender==="me");return r.length>0?r[r.length-1].id:null},[t]),_=r=>t.find(l=>l.id===r),D=(r,l)=>r===0?!1:t[r-1].sender===l.sender,X=(r,l)=>r===t.length-1?!1:t[r+1].sender===l.sender;return(0,e.jsxs)("div",{className:"relative flex h-full w-full flex-col overflow-hidden bg-white/50 dark:bg-black/50 md:border-l md:border-zinc-200/50 dark:md:border-zinc-800/50",children:[(0,e.jsxs)("div",{className:"sticky top-0 z-30 flex shrink-0 items-center justify-between border-b border-zinc-100 bg-white/75 px-4 py-3 backdrop-blur-xl dark:border-zinc-800 dark:bg-black/75",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)("button",{onClick:a,className:"mr-1 -ml-2 rounded-full p-2 text-zinc-600 transition-colors hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-zinc-800 md:hidden",children:(0,e.jsx)(oe,{size:24})}),(0,e.jsxs)("div",{className:"relative cursor-pointer",onClick:()=>!s.isGroup&&s.user&&m(`/u/${s.user.handle}`),children:[(0,e.jsxs)(H,{className:"size-10 border-2 border-white shadow-sm dark:border-zinc-800",children:[(0,e.jsx)(K,{src:f,alt:n||"",className:"object-cover"}),(0,e.jsx)(B,{children:n?.[0]?.toUpperCase()})]}),b&&!s.isGroup&&(0,e.jsx)("span",{className:"absolute bottom-0 right-0 size-3 rounded-full border-2 border-white bg-emerald-500 dark:border-black"})]}),(0,e.jsxs)("div",{className:"flex flex-col cursor-pointer",onClick:()=>!s.isGroup&&s.user&&m(`/u/${s.user.handle}`),children:[(0,e.jsx)("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:n}),(0,e.jsx)("span",{className:"text-[11px] font-medium text-zinc-500",children:s.isGroup?"Group Chat":b?(0,e.jsx)("span",{className:"text-emerald-500",children:"Active now"}):s.user?.lastSeen?`Last seen ${C}`:"Offline"})]})]}),(0,e.jsxs)("div",{className:"flex items-center gap-1",children:[(0,e.jsx)("button",{className:"hidden sm:flex rounded-full p-2.5 text-violet-500 hover:bg-violet-50 dark:hover:bg-violet-900/20 transition-colors",children:(0,e.jsx)(we,{size:20})}),(0,e.jsx)("button",{className:"hidden sm:flex rounded-full p-2.5 text-violet-500 hover:bg-violet-50 dark:hover:bg-violet-900/20 transition-colors",children:(0,e.jsx)(pe,{size:20})}),(0,e.jsx)("button",{onClick:()=>N(!0),className:"rounded-full p-2.5 text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:(0,e.jsx)(Ce,{size:20})})]})]}),(0,e.jsx)("div",{className:"flex-1 min-h-0 overflow-y-auto px-4 py-4",ref:p,children:(0,e.jsxs)("div",{className:"flex flex-col min-h-full justify-end",children:[t.length<5&&(0,e.jsxs)("div",{className:"py-12 flex flex-col items-center justify-center opacity-80 mb-auto",children:[(0,e.jsxs)(H,{className:"size-24 border-4 border-zinc-100 dark:border-zinc-800 mb-4 bg-zinc-50 dark:bg-zinc-900",children:[(0,e.jsx)(K,{src:f,className:"object-cover"}),(0,e.jsx)(B,{className:"text-4xl",children:n?.[0]})]}),(0,e.jsx)("h2",{className:"text-xl font-bold dark:text-white",children:n}),(0,e.jsx)("p",{className:"text-zinc-500 text-sm mb-4",children:s.isGroup?"Group chat on AntiGravity":"You're friends on AntiGravity"}),!s.isGroup&&(0,e.jsx)(Ee,{variant:"outline",className:"rounded-full h-8 text-xs",children:"View Profile"})]}),S&&t.length===0?(0,e.jsx)("div",{className:"flex justify-center p-8",children:(0,e.jsx)(le,{className:"animate-spin text-violet-500",size:32})}):(0,e.jsx)("div",{className:"space-y-[2px]",children:t.map((r,l)=>{const c=r.sender==="me",T=D(l,r),U=X(l,r);return(0,e.jsx)(te.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},className:A("flex w-full",c?"justify-end":"justify-start",!U&&"mb-4"),children:(0,e.jsxs)("div",{className:A("flex max-w-[75%] md:max-w-[65%] items-end gap-2 group",c?"flex-row-reverse":"flex-row"),children:[!c&&(0,e.jsx)("div",{className:"w-7 shrink-0",children:U?null:(0,e.jsxs)(H,{className:"size-7 border border-zinc-100 shadow-sm dark:border-zinc-800",children:[(0,e.jsx)(K,{src:r.senderAvatar||f}),(0,e.jsx)(B,{children:(r.senderName||n)?.[0]})]})}),(0,e.jsxs)(Oe,{children:[(0,e.jsx)(Me,{children:(0,e.jsxs)("div",{className:A("relative px-4 py-2.5 shadow-sm text-[15px] leading-[1.4]",c?"bg-gradient-to-br from-violet-600 to-indigo-600 text-white":"bg-white text-zinc-900 dark:bg-zinc-800 dark:text-white border border-zinc-200/50 dark:border-zinc-700/50",!U&&!T&&"rounded-[22px]",c&&!U&&T&&"rounded-[22px] rounded-tr-md",c&&U&&!T&&"rounded-[22px] rounded-br-md",c&&U&&T&&"rounded-[22px] rounded-r-md",!c&&!U&&T&&"rounded-[22px] rounded-tl-md",!c&&U&&!T&&"rounded-[22px] rounded-bl-md",!c&&U&&T&&"rounded-[22px] rounded-l-md"),children:[r.replyToId&&(0,e.jsxs)("div",{className:A("mb-1.5 -mx-1 px-3 py-1.5 rounded-xl text-xs border-l-2 cursor-pointer",c?"bg-black/10 border-white/40 text-white/90":"bg-zinc-100 border-zinc-300 text-zinc-600 dark:bg-zinc-700 dark:border-zinc-500 dark:text-zinc-300"),onClick:W=>{W.stopPropagation();const Z=document.getElementById(`msg-${r.replyToId}`);Z&&Z.scrollIntoView({behavior:"smooth",block:"center"})},children:[(0,e.jsxs)("div",{className:"flex items-center gap-1.5 mb-0.5 opacity-75",children:[(0,e.jsx)(se,{size:10}),(0,e.jsx)("span",{className:"font-bold",children:"Reply"})]}),(0,e.jsx)("div",{className:"truncate opacity-90",children:_(r.replyToId)?.text||"Attachment"})]}),r.media?.length>0&&(0,e.jsx)("div",{className:"grid gap-1 mb-1 overflow-hidden rounded-lg",children:r.media.map((W,Z)=>(0,e.jsx)("img",{src:W.url,className:"max-h-64 object-cover w-full rounded-md cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>q(r)},Z))}),(0,e.jsx)("div",{className:"whitespace-pre-wrap break-words",children:(0,e.jsx)(De,{options:{...Fe,className:c?"text-white underline":"text-violet-600 dark:text-violet-400 underline"},children:r.text})}),(0,e.jsxs)("div",{className:A("flex justify-end items-center gap-1 mt-0.5 select-none",c?"text-white/70":"text-zinc-400"),children:[(0,e.jsx)("span",{className:"text-[9px] font-medium",children:r.time}),c&&r.id===Y&&(r.isRead?(0,e.jsx)(ke,{size:12,className:"text-white"}):(0,e.jsx)(xe,{size:12,className:"text-white/60"}))]})]})}),(0,e.jsxs)(Ue,{className:"w-48",children:[(0,e.jsxs)(J,{onClick:()=>{navigator.clipboard.writeText(r.text)},children:[(0,e.jsx)(ue,{size:14,className:"mr-2"})," Copy"]}),(0,e.jsxs)(J,{onClick:()=>z(r),children:[(0,e.jsx)(se,{size:14,className:"mr-2"})," Reply"]}),(0,e.jsx)(Pe,{}),(0,e.jsxs)(J,{className:"text-red-500",onClick:()=>k&&k(r.id),children:[(0,e.jsx)(me,{size:14,className:"mr-2"})," Delete"]})]})]})]})},r.id)})}),w&&(0,e.jsx)("div",{className:"flex items-center gap-2 mt-2 ml-9",children:(0,e.jsx)("div",{className:"bg-zinc-100 dark:bg-zinc-800 px-4 py-2.5 rounded-[22px] rounded-tl-md",children:(0,e.jsx)(Le,{})})})]})}),(0,e.jsxs)("div",{className:"shrink-0 p-3 md:p-4 bg-white dark:bg-black border-t border-zinc-100 dark:border-zinc-800",children:[(0,e.jsx)(be,{children:x&&(0,e.jsxs)(te.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"flex items-center justify-between mb-2 px-4 py-2 bg-zinc-50 dark:bg-zinc-900 rounded-xl border border-zinc-100 dark:border-zinc-800",children:[(0,e.jsxs)("div",{className:"text-sm",children:[(0,e.jsxs)("span",{className:"text-xs font-bold text-violet-500 block mb-0.5",children:["Replying to ",x.sender==="me"?"yourself":x.senderName||n]}),(0,e.jsx)("p",{className:"line-clamp-1 text-zinc-500",children:x.text})]}),(0,e.jsx)("button",{onClick:()=>z(null),children:(0,e.jsx)(Q,{size:16,className:"text-zinc-400"})})]})}),u.length>0&&(0,e.jsx)("div",{className:"flex gap-2 mb-2 px-1",children:u.map(r=>(0,e.jsxs)("div",{className:"relative size-16 rounded-lg overflow-hidden border border-zinc-200",children:[(0,e.jsx)("img",{src:r.url,className:"size-full object-cover"}),(0,e.jsx)("button",{onClick:()=>V(r.url),className:"absolute top-0 right-0 bg-black/50 text-white p-0.5",children:(0,e.jsx)(Q,{size:12})})]},r.url))}),(0,e.jsxs)("div",{className:"flex items-end gap-2",children:[(0,e.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,e.jsx)("button",{className:"p-2 text-zinc-400 hover:text-violet-600 transition-colors rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-800",onClick:()=>h.current?.click(),children:(0,e.jsx)(fe,{size:24})}),(0,e.jsx)("button",{className:"hidden sm:block p-2 text-zinc-400 hover:text-violet-600 transition-colors rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,e.jsx)(ye,{size:22})})]}),(0,e.jsxs)("form",{className:"flex-1 flex items-center gap-2 bg-zinc-100 dark:bg-zinc-900 rounded-[24px] px-2 py-1.5 transition-all focus-within:ring-2 focus-within:ring-violet-500/20 focus-within:bg-white dark:focus-within:bg-zinc-900 overflow-hidden border border-transparent focus-within:border-violet-200 dark:focus-within:border-violet-900",onSubmit:F,children:[(0,e.jsxs)(Ie,{open:R,onOpenChange:M,children:[(0,e.jsx)(Re,{asChild:!0,children:(0,e.jsx)("button",{type:"button",className:"p-2 text-zinc-400 hover:text-yellow-500 transition-colors",children:(0,e.jsx)(ge,{size:24})})}),(0,e.jsx)(Te,{className:"w-full p-0 border-none bg-transparent shadow-none",side:"top",align:"start",children:(0,e.jsx)(Ge,{onEmojiSelect:L})})]}),(0,e.jsx)("textarea",{name:"chat-input",value:i,onChange:O,onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),F())},placeholder:"Message...",className:"flex-1 bg-transparent border-none outline-none text-[15px] resize-none max-h-32 py-2.5 min-h-[40px] text-zinc-900 dark:text-white placeholder:text-zinc-500",rows:1}),i.trim()||u.length>0?(0,e.jsx)("button",{type:"submit",className:"p-2 mr-1 rounded-full bg-violet-600 text-white hover:bg-violet-700 hover:scale-105 transition-all shadow-sm",children:(0,e.jsx)(ve,{size:18,className:"translate-x-0.5 translate-y-0.5"})}):(0,e.jsx)("button",{type:"button",className:"p-2 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,e.jsx)(Ne,{size:22})})]}),(0,e.jsx)("input",{type:"file",ref:h,onChange:E,className:"hidden",multiple:!0,accept:"image/*"})]})]}),s.isGroup&&(0,e.jsx)(_e,{isOpen:G,onClose:()=>N(!1),conversation:s,onUpdate:r=>{N(!1)}})]})},Je=We,Qe=ae(),et=()=>{const s=(0,Qe.c)(29),{id:t,currentUser:a,onlineUsers:P,msgSearchQuery:k,setMsgSearchQuery:d,userSearchResults:S,filteredConversations:w,selectedConversation:b,localMessages:m,isConvLoading:g,isMsgLoading:i,currentIsTyping:j,otherUserIsOnline:$,handleStartConversation:y,handleSelectConversation:u,sendMessage:v,onDeleteMessage:R,sendTypingStatus:M,navigate:x}=Xe();if(!a){let n;s[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,e.jsx)("div",{className:"rounded-3xl bg-zinc-50 p-6 dark:bg-zinc-900",children:(0,e.jsx)(he,{size:48,className:"text-zinc-300 dark:text-zinc-600"})}),s[0]=n):n=s[0];let f;return s[1]===Symbol.for("react.memo_cache_sentinel")?(f=(0,e.jsxs)("div",{className:"flex h-screen flex-col items-center justify-center gap-6 border-zinc-100 bg-white p-8 text-center dark:border-zinc-800 dark:bg-black md:rounded-2xl md:border",children:[n,(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)("h3",{className:"text-2xl font-black tracking-tight dark:text-white",children:"Sign in to message"}),(0,e.jsx)("p",{className:"max-w-xs text-zinc-500 font-medium",children:"Join the conversation. Sign up or log in to start chatting."})]})]}),s[1]=f):f=s[1],f}if(g){let n;return s[2]===Symbol.for("react.memo_cache_sentinel")?(n=(0,e.jsx)("div",{className:"flex h-screen items-center justify-center border-zinc-100 bg-white dark:border-zinc-800 dark:bg-black md:rounded-2xl md:border",children:(0,e.jsx)(le,{className:"animate-spin text-violet-500",size:32})}),s[2]=n):n=s[2],n}const z=`flex ${t?"h-[100dvh]":"h-[calc(100dvh-4rem)]"} overflow-hidden bg-white shadow-2xl shadow-zinc-200/50 dark:border-zinc-800 dark:bg-black dark:shadow-none md:h-[calc(100vh-1.5rem)] md:rounded-3xl md:border md:border-zinc-200/50`,G=`flex-col md:flex md:w-[400px] ${b?"hidden":"flex"} h-full min-h-0 shrink-0 w-full bg-white dark:bg-black border-r border-zinc-100 dark:border-zinc-800 z-10`,N=t??null;let h;s[3]!==w||s[4]!==u||s[5]!==y||s[6]!==k||s[7]!==P||s[8]!==d||s[9]!==N||s[10]!==S?(h=(0,e.jsx)("div",{className:"flex-1 min-h-0 flex flex-col overflow-y-auto",children:(0,e.jsx)(Ze,{conversations:w,userResults:S,onSelect:u,onStartNew:y,selectedId:N,searchQuery:k,onSearchChange:d,onlineUsers:P})}),s[3]=w,s[4]=u,s[5]=y,s[6]=k,s[7]=P,s[8]=d,s[9]=N,s[10]=S,s[11]=h):h=s[11];let p;s[12]!==G||s[13]!==h?(p=(0,e.jsx)("div",{className:G,children:h}),s[12]=G,s[13]=h,s[14]=p):p=s[14];let o;s[15]!==j||s[16]!==i||s[17]!==m||s[18]!==x||s[19]!==R||s[20]!==$||s[21]!==b||s[22]!==v||s[23]!==M?(o=b?(0,e.jsx)(Je,{conversation:b,messages:m,onBack:()=>x("/messages"),onSendMessage:v,onDeleteMessage:R,onTyping:n=>M(b.id,n),isLoading:i,isTyping:!!j,isOnline:!!$}):(0,e.jsxs)("div",{className:"hidden flex-1 flex-col items-center justify-center gap-6 text-zinc-500 md:flex bg-zinc-50/30 dark:bg-zinc-900/10",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute -inset-10 rounded-full bg-violet-500/5 blur-3xl dark:bg-violet-500/10"}),(0,e.jsx)("div",{className:"relative rounded-[2.5rem] bg-white p-10 shadow-xl shadow-zinc-200/50 dark:bg-zinc-900/50 dark:shadow-none ring-1 ring-zinc-100 dark:ring-zinc-800",children:(0,e.jsx)(ze,{size:80,className:"text-violet-500 stroke-[1.5]"})})]}),(0,e.jsxs)("div",{className:"text-center max-w-sm px-4 space-y-3",children:[(0,e.jsx)("h3",{className:"text-3xl font-black tracking-tighter text-zinc-900 dark:text-white",children:"Your Messages"}),(0,e.jsx)("p",{className:"text-zinc-500 font-medium text-lg",children:"Send private photos and messages to a friend or group."})]})]}),s[15]=j,s[16]=i,s[17]=m,s[18]=x,s[19]=R,s[20]=$,s[21]=b,s[22]=v,s[23]=M,s[24]=o):o=s[24];let C;return s[25]!==z||s[26]!==p||s[27]!==o?(C=(0,e.jsxs)("div",{className:z,children:[p,o]}),s[25]=z,s[26]=p,s[27]=o,s[28]=C):C=s[28],C},ct=et;export{ct as default};
