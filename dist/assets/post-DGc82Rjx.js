const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/VideoPlayer-PgAMkdC1.js","assets/framework-YRQI4BOE.js","assets/database-Bh-Nv8Zy.js","assets/animations-DZuN0xpW.js","assets/rolldown-runtime-BaZ8gS7u.js","assets/framework-sg0yWRLc.css","assets/media-libs-CqtNZWFg.js","assets/media-libs-CqCaMccn.css","assets/VideoPlayer-5P8qUACc.js","assets/index-DTwjN5Ct.js","assets/ui-libs-Cxlst_z9.js","assets/query-O_8RQZTX.js","assets/index-D3eKC388.css","assets/dist-DrKSVhVq.js"])))=>i.map(i=>d[i]);
import{a as pt}from"./rolldown-runtime-BaZ8gS7u.js";import{a as ye,c as Dt,i as B,s as Et}from"./animations-DZuN0xpW.js";import{_ as gt,b as vt,c as W,n as At,u as Lt}from"./framework-YRQI4BOE.js";import{r as Ot}from"./query-O_8RQZTX.js";import{$n as Ut,At as ne,Bn as Vt,Dn as Bt,En as Wt,Fn as Be,Jn as qt,Kn as Ht,Ln as ke,Lt as We,Nn as he,Qt as qe,Rn as Gt,Sn as Qt,Un as Jt,Vn as Xt,Vt as He,Wn as Ne,an as Kt,cn as Ge,dn as Yt,en as Zt,gn as es,in as we,on as ts,or as ss,pn as is,un as ls,yn as bt,zt as as}from"./ui-libs-Cxlst_z9.js";import{$t as jt,A as ns,Bt as Qe,Cn as ae,D as zt,Dn as Je,Ft as Xe,G as rs,Gt as Y,Ht as Ke,I as ue,It as Ye,Jt as yt,L as os,Lt as Ze,O as cs,On as et,P as ds,Rt as tt,Sn as Ce,Tn as fe,Ut as Z,Vt as st,W as ms,Wt as ee,Xt as xs,Yt as fs,Zt as Se,_t as hs,an as us,bn as ps,bt as gs,dn as vs,dt as kt,en as bs,fn as js,g as zs,gn as ys,gt as ks,hn as Ns,in as ws,j as Cs,kt as _s,ln as $s,m as it,mn as lt,qt as Nt,rn as at,un as Ss,wn as _e,xt as Fs,yt as ie,z as Ps,zt as nt}from"./index-DTwjN5Ct.js";import{t as Fe}from"./rich-text-BpwJD-Nt.js";import{n as le,t as Ts}from"./actionsheet-DYIHKWNn.js";var Rs=W(),_=pt(Dt(),1),t=pt(Et(),1),Is=i=>{const e=(0,Rs.c)(37),{isComment:s,liked:n,reposted:l,handleLike:a,handleRepost:r,handleCommentClick:o,handleShareClick:c,isDetail:g}=i;if(g!==void 0&&g){let C;e[0]!==a||e[1]!==n?(C=(0,t.jsx)(Q,{icon:he,label:"Like",type:"like",onClick:a,active:n}),e[0]=a,e[1]=n,e[2]=C):C=e[2];let k;e[3]!==r||e[4]!==s||e[5]!==l?(k=!s&&(0,t.jsx)(Q,{icon:we,label:"Repost",type:"repost",onClick:r,active:l}),e[3]=r,e[4]=s,e[5]=l,e[6]=k):k=e[6];let N;e[7]!==o?(N=(0,t.jsx)(Q,{icon:zt,label:"Comment",type:"comment",onClick:o}),e[7]=o,e[8]=N):N=e[8];let d;e[9]!==c||e[10]!==s?(d=!s&&(0,t.jsx)(Q,{icon:ue,label:"Share",type:"share",onClick:c}),e[9]=c,e[10]=s,e[11]=d):d=e[11];let S;return e[12]!==C||e[13]!==k||e[14]!==N||e[15]!==d?(S=(0,t.jsxs)("div",{className:"mt-5 flex w-full items-center justify-around py-2",children:[C,k,N,d]}),e[12]=C,e[13]=k,e[14]=N,e[15]=d,e[16]=S):S=e[16],S}const u=`flex items-center gap-x-1.5 ${s?"mt-2":"mt-3.5"}`,x=s?16:18;let f;e[17]!==a||e[18]!==n||e[19]!==x?(f=(0,t.jsx)(Q,{icon:he,size:x,type:"like",onClick:a,active:n}),e[17]=a,e[18]=n,e[19]=x,e[20]=f):f=e[20];const v=s?16:18;let m;e[21]!==o||e[22]!==v?(m=(0,t.jsx)(Q,{icon:bt,size:v,type:"comment",onClick:o}),e[21]=o,e[22]=v,e[23]=m):m=e[23];const p=s?16:18;let b;e[24]!==r||e[25]!==l||e[26]!==p?(b=(0,t.jsx)(Q,{icon:we,size:p,type:"repost",onClick:r,active:l}),e[24]=r,e[25]=l,e[26]=p,e[27]=b):b=e[27];let h;e[28]!==c||e[29]!==s?(h=!s&&c&&(0,t.jsx)(Q,{icon:ue,type:"share",onClick:c}),e[28]=c,e[29]=s,e[30]=h):h=e[30];let w;return e[31]!==u||e[32]!==f||e[33]!==m||e[34]!==b||e[35]!==h?(w=(0,t.jsxs)("div",{className:u,children:[f,m,b,h]}),e[31]=u,e[32]=f,e[33]=m,e[34]=b,e[35]=h,e[36]=w):w=e[36],w},rt=Is,Ms=W(),Ds=i=>{const e=(0,Ms.c)(38),{views:s,likes:n,comments:l,isDetail:a,isComment:r,onRepliesClick:o}=i,c=a===void 0?!1:a,g=r===void 0?!1:r;if(c){const b=s||0;let h;e[0]!==b?(h=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:b}),e[0]=b,e[1]=h):h=e[1];let w;e[2]===Symbol.for("react.memo_cache_sentinel")?(w=(0,t.jsx)("span",{className:"opacity-70",children:"Views"}),e[2]=w):w=e[2];let C;e[3]!==h?(C=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[h," ",w]}),e[3]=h,e[4]=C):C=e[4];const k=n||0;let N;e[5]!==k?(N=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:k}),e[5]=k,e[6]=N):N=e[6];let d;e[7]===Symbol.for("react.memo_cache_sentinel")?(d=(0,t.jsx)("span",{className:"opacity-70",children:"Likes"}),e[7]=d):d=e[7];let S;e[8]!==N?(S=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[N," ",d]}),e[8]=N,e[9]=S):S=e[9];const F=l||0;let R;e[10]!==F?(R=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:F}),e[10]=F,e[11]=R):R=e[11];let j;e[12]===Symbol.for("react.memo_cache_sentinel")?(j=(0,t.jsx)("span",{className:"opacity-70",children:"Comments"}),e[12]=j):j=e[12];let z;e[13]!==R?(z=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[R," ",j]}),e[13]=R,e[14]=z):z=e[14];let P;return e[15]!==S||e[16]!==z||e[17]!==C?(P=(0,t.jsxs)("div",{className:"mt-5 flex items-center gap-x-6 border-b border-zinc-100 pb-4 text-sm text-zinc-500 dark:border-zinc-800 dark:text-zinc-400",children:[C,S,z]}),e[15]=S,e[16]=z,e[17]=C,e[18]=P):P=e[18],P}if(l===0&&n===0&&(s===0||g))return null;const u=`mt-2 flex items-center gap-x-2 px-0.5 ${g?"text-[12px]":"text-[14px]"} font-medium text-zinc-500 dark:text-zinc-400`;let x;e[19]!==l||e[20]!==g||e[21]!==n||e[22]!==s?(x=s>0&&!g&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{className:"hover:underline",children:[s," ",s===1?"view":"views"]}),(l>0||n>0)&&(0,t.jsx)("span",{className:"opacity-50",children:"·"})]}),e[19]=l,e[20]=g,e[21]=n,e[22]=s,e[23]=x):x=e[23];let f;e[24]!==l||e[25]!==o?(f=l>0&&(0,t.jsxs)("button",{className:"hover:underline",onClick:b=>{b.stopPropagation(),o&&o(b)},children:[l," ",l===1?"reply":"replies"]}),e[24]=l,e[25]=o,e[26]=f):f=e[26];let v;e[27]!==l||e[28]!==n?(v=l>0&&n>0&&(0,t.jsx)("span",{className:"opacity-50",children:"·"}),e[27]=l,e[28]=n,e[29]=v):v=e[29];let m;e[30]!==n?(m=n>0&&(0,t.jsxs)("button",{className:"hover:underline",children:[n," ",n===1?"like":"likes"]}),e[30]=n,e[31]=m):m=e[31];let p;return e[32]!==u||e[33]!==x||e[34]!==f||e[35]!==v||e[36]!==m?(p=(0,t.jsxs)("div",{className:u,children:[x,f,v,m]}),e[32]=u,e[33]=x,e[34]=f,e[35]=v,e[36]=m,e[37]=p):p=e[37],p},ot=Ds,Es=W(),As=i=>{const e=(0,Es.c)(43),{user:s,timeAgo:n,community:l,onUserClick:a,actionsMenu:r,isComment:o,isDetail:c,showAvatar:g}=i,u=g===void 0?!1:g,x=gt();let f;e[0]!==a||e[1]!==s.handle?(f=I=>{I.stopPropagation(),a&&a(s.handle)},e[0]=a,e[1]=s.handle,e[2]=f):f=e[2];const v=f;let m;e[3]!==l||e[4]!==x?(m=I=>{I.stopPropagation(),l&&x(`/c/${l.handle}`)},e[3]=l,e[4]=x,e[5]=m):m=e[5];const p=m,b=`flex items-center justify-between ${c?"pb-5":"min-h-[40px] mb-2"}`;let h;e[6]!==v||e[7]!==o||e[8]!==c||e[9]!==u||e[10]!==s.avatar||e[11]!==s.handle?(h=u&&(0,t.jsx)("button",{className:"shrink-0",onClick:v,children:(0,t.jsxs)(Z,{className:`${c?"size-12":o?"size-8":"size-10"} border-0 shadow-sm`,children:[(0,t.jsx)(Y,{src:s.avatar,alt:s.handle,className:"object-cover"}),(0,t.jsx)(ee,{className:"text-xs",children:s.handle[0]?.toUpperCase()})]})}),e[6]=v,e[7]=o,e[8]=c,e[9]=u,e[10]=s.avatar,e[11]=s.handle,e[12]=h):h=e[12];const w=`flex shrink-0 items-center gap-1 font-bold text-zinc-900 hover:underline dark:text-white ${c?"text-base sm:text-lg":o?"text-[14px]":"text-[15px]"}`;let C;e[13]!==s.handle?(C=(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:s.handle}),e[13]=s.handle,e[14]=C):C=e[14];let k;e[15]!==o||e[16]!==c||e[17]!==s.verified?(k=s.verified&&(0,t.jsx)(os,{size:c?16:o?12:14,className:"text-blue-500"}),e[15]=o,e[16]=c,e[17]=s.verified,e[18]=k):k=e[18];let N;e[19]!==v||e[20]!==w||e[21]!==C||e[22]!==k?(N=(0,t.jsxs)("button",{className:w,onClick:v,children:[C,k]}),e[19]=v,e[20]=w,e[21]=C,e[22]=k,e[23]=N):N=e[23];let d;e[24]!==l||e[25]!==p||e[26]!==c?(d=l&&(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-1 text-zinc-500",children:[(0,t.jsx)(cs,{size:c?14:12,className:"shrink-0 text-zinc-400"}),(0,t.jsxs)("button",{className:`flex items-center gap-1 font-bold text-zinc-900 hover:underline dark:text-zinc-100 ${c?"text-[14px] sm:text-[15px]":"text-[13px]"}`,onClick:p,children:[(0,t.jsxs)(Z,{className:"size-3.5 shrink-0 border border-zinc-200 bg-zinc-100 dark:border-zinc-700 dark:bg-zinc-800",children:[(0,t.jsx)(Y,{src:l.avatar,alt:l.name,className:"object-cover"}),(0,t.jsx)(ee,{className:"text-[6px] font-bold text-zinc-500",children:l.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:l.name})]})]}),e[24]=l,e[25]=p,e[26]=c,e[27]=d):d=e[27];let S;e[28]!==d||e[29]!==N?(S=(0,t.jsx)("div",{className:"flex min-w-0 flex-1 flex-col",children:(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex min-w-0 max-w-full items-center gap-1.5",children:[N,d]})})}),e[28]=d,e[29]=N,e[30]=S):S=e[30];let F;e[31]!==S||e[32]!==h?(F=(0,t.jsxs)("div",{className:"flex items-center gap-x-3.5 flex-1 min-w-0",children:[h,S]}),e[31]=S,e[32]=h,e[33]=F):F=e[33];const R=n||"Recent";let j;e[34]!==R?(j=(0,t.jsx)("span",{className:"whitespace-nowrap text-[12px] text-zinc-500 dark:text-zinc-400",children:R}),e[34]=R,e[35]=j):j=e[35];let z;e[36]!==r||e[37]!==j?(z=(0,t.jsxs)("div",{className:"-mt-1 flex items-center gap-2.5",children:[j,r]}),e[36]=r,e[37]=j,e[38]=z):z=e[38];let P;return e[39]!==F||e[40]!==z||e[41]!==b?(P=(0,t.jsxs)("div",{className:b,children:[F,z]}),e[39]=F,e[40]=z,e[41]=b,e[42]=P):P=e[42],P},ct=As,Ls=W(),Os=i=>{const e=(0,Ls.c)(40),{content:s,isDetail:n,isEditing:l,editedContent:a,setEditedContent:r,onCancelEdit:o,onSaveEdit:c,isUpdating:g,contentClass:u}=i,[x,f]=(0,_.useState)(!1),v=typeof s=="string"&&et(s);if(l&&r){let F;e[0]!==r?(F=L=>r(L.target.value),e[0]=r,e[1]=F):F=e[1];const R=`min-h-[100px] w-full rounded-xl border-zinc-200 bg-zinc-50 focus:ring-violet-500 dark:border-zinc-800 dark:bg-zinc-900 ${et(a||"")?"font-bangla text-lg":"font-english"}`;let j;e[2]!==a||e[3]!==F||e[4]!==R?(j=(0,t.jsx)(Ps,{value:a,onChange:F,className:R,autoFocus:!0}),e[2]=a,e[3]=F,e[4]=R,e[5]=j):j=e[5];let z;e[6]!==o?(z=(0,t.jsx)("button",{onClick:o,className:"px-4 py-1.5 text-sm font-bold text-zinc-500 transition-colors hover:text-zinc-700 dark:hover:text-zinc-300",children:"Cancel"}),e[6]=o,e[7]=z):z=e[7];let P;e[8]!==s||e[9]!==a||e[10]!==g?(P=g||!a?.trim()||a===s,e[8]=s,e[9]=a,e[10]=g,e[11]=P):P=e[11];const I=g?"Saving...":"Save";let M;e[12]!==c||e[13]!==P||e[14]!==I?(M=(0,t.jsx)("button",{onClick:c,disabled:P,className:"rounded-full bg-violet-600 px-4 py-1.5 text-sm font-bold text-white transition-all hover:bg-violet-700 disabled:opacity-50 active:scale-95",children:I}),e[12]=c,e[13]=P,e[14]=I,e[15]=M):M=e[15];let D;e[16]!==z||e[17]!==M?(D=(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[z,M]}),e[16]=z,e[17]=M,e[18]=D):D=e[18];let A;return e[19]!==j||e[20]!==D?(A=(0,t.jsxs)("div",{className:"mt-2 flex flex-col gap-2",onClick:Us,children:[j,D]}),e[19]=j,e[20]=D,e[21]=A):A=e[21],A}const m=!n&&s.length>280;let p;e[22]!==s||e[23]!==x||e[24]!==m?(p=m&&!x?s.substring(0,280):s,e[22]=s,e[23]=x,e[24]=m,e[25]=p):p=e[25];const b=p,h=n?"text-lg leading-relaxed sm:text-xl sm:leading-8 mt-1":"text-[15px] leading-snug mt-0.5",w=v?"font-bangla text-[1.15em]":"font-english";let C;e[26]!==u||e[27]!==h||e[28]!==w?(C=ae("whitespace-pre-line break-words",h,w,u),e[26]=u,e[27]=h,e[28]=w,e[29]=C):C=e[29];let k;e[30]!==b?(k=(0,t.jsx)(Fe,{content:b}),e[30]=b,e[31]=k):k=e[31];const N=m&&!x&&"...";let d;e[32]!==x||e[33]!==m?(d=m&&(0,t.jsx)("button",{onClick:F=>{F.stopPropagation(),f(!x)},className:"ml-1 cursor-pointer font-bold text-rose-600 hover:underline dark:text-rose-400",children:x?"Show less":"See more"}),e[32]=x,e[33]=m,e[34]=d):d=e[34];let S;return e[35]!==C||e[36]!==k||e[37]!==N||e[38]!==d?(S=(0,t.jsxs)("div",{className:C,children:[k,N,d]}),e[35]=C,e[36]=k,e[37]=N,e[38]=d,e[39]=S):S=e[39],S},dt=Os;function Us(i){return i.stopPropagation()}var Vs=W(),Bs=i=>{const e=(0,Vs.c)(28),{media:s,isEditing:n,editedMedia:l,setEditedMedia:a,newFiles:r,setNewFiles:o}=i;let c;e[0]!==l?(c=l===void 0?[]:l,e[0]=l,e[1]=c):c=e[1];const g=c;let u;e[2]!==r?(u=r===void 0?[]:r,e[2]=r,e[3]=u):u=e[3];const x=u,f=(0,_.useRef)(null);if(n&&a&&o){let m;if(e[4]!==g||e[5]!==a){let k;e[7]!==a?(k=(N,d)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[N.type==="video"?(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(Gt,{size:24,className:"text-zinc-400"})}):(0,t.jsx)("img",{src:N.url||N.src,className:"size-full object-cover",alt:""}),(0,t.jsx)("button",{onClick:S=>{S.stopPropagation(),a(F=>F.filter((R,j)=>j!==d))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(ne,{size:16})})]},`old-${d}`),e[7]=a,e[8]=k):k=e[8],m=g.map(k),e[4]=g,e[5]=a,e[6]=m}else m=e[6];let p;if(e[9]!==x||e[10]!==o){let k;e[12]!==o?(k=(N,d)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border-2 border-dashed border-violet-500 bg-violet-50/10",children:[N.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(N),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center",children:(0,t.jsx)(Wt,{size:24,className:"animate-spin text-violet-500"})}),(0,t.jsx)("button",{onClick:S=>{S.stopPropagation(),o(F=>F.filter((R,j)=>j!==d))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(ne,{size:16})}),(0,t.jsx)("div",{className:"absolute bottom-1 left-1 rounded bg-violet-600 px-1 text-[8px] font-bold text-white",children:"NEW"})]},`new-${d}`),e[12]=o,e[13]=k):k=e[13],p=x.map(k),e[9]=x,e[10]=o,e[11]=p}else p=e[11];let b;e[14]!==g.length||e[15]!==x.length?(b=g.length+x.length<4&&(0,t.jsxs)("button",{onClick:k=>{k.stopPropagation(),f.current?.click()},className:"relative flex aspect-square flex-col items-center justify-center gap-1 rounded-xl border-2 border-dashed border-zinc-200 text-zinc-400 transition-all hover:border-violet-500 hover:bg-violet-50/5 hover:text-violet-500 dark:border-zinc-800",children:[(0,t.jsx)(Kt,{size:20}),(0,t.jsx)("span",{className:"text-[10px] font-bold",children:"Add Media"})]}),e[14]=g.length,e[15]=x.length,e[16]=b):b=e[16];let h;e[17]!==m||e[18]!==p||e[19]!==b?(h=(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:[m,p,b]}),e[17]=m,e[18]=p,e[19]=b,e[20]=h):h=e[20];let w;e[21]!==o?(w=(0,t.jsx)("input",{type:"file",ref:f,onChange:k=>{if(k.target.files){const N=Array.from(k.target.files);o(d=>[...d,...N])}},multiple:!0,className:"hidden",accept:"image/*,video/*"}),e[21]=o,e[22]=w):w=e[22];let C;return e[23]!==h||e[24]!==w?(C=(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[h,w]}),e[23]=h,e[24]=w,e[25]=C):C=e[25],C}if(!s||s.length===0)return null;let v;return e[26]!==s?(v=(0,t.jsx)(mi,{items:s}),e[26]=s,e[27]=v):v=e[27],v},mt=Bs,Ws=W(),qs=i=>{const e=(0,Ws.c)(48),{icon:s,count:n,label:l,onClick:a,active:r,activeColorClass:o,size:c,type:g}=i,u=c===void 0?18:c,x=g===void 0?"default":g;let f,v,m,p,b,h,w;if(e[0]!==r||e[1]!==o||e[2]!==n||e[3]!==l||e[4]!==a||e[5]!==x){const D={like:{hoverBg:"group-hover:bg-rose-500/10",hoverText:"group-hover:text-rose-500",activeText:"text-rose-500",activeFill:"fill-rose-500"},repost:{hoverBg:"group-hover:bg-emerald-500/10",hoverText:"group-hover:text-emerald-500",activeText:"text-emerald-500",activeFill:"fill-emerald-500"},comment:{hoverBg:"group-hover:bg-sky-500/10",hoverText:"group-hover:text-sky-500",activeText:"text-sky-500",activeFill:"fill-sky-500"},share:{hoverBg:"group-hover:bg-violet-500/10",hoverText:"group-hover:text-violet-500",activeText:"text-violet-500",activeFill:"fill-violet-500"},default:{hoverBg:"group-hover:bg-zinc-500/10",hoverText:"group-hover:text-zinc-500",activeText:"text-zinc-900 dark:text-white",activeFill:"fill-current"}};v=D[x]||D.default;const A=o||v.activeText;f=B.button,e[13]===Symbol.for("react.memo_cache_sentinel")?(p={scale:.85},e[13]=p):p=e[13],e[14]!==a?(b=L=>{L.stopPropagation(),a&&a(L)},e[14]=a,e[15]=b):b=e[15],h=`${l} ${n!==void 0?`(${n})`:""}`,w=ae("group -ml-2 flex items-center gap-x-0.5 rounded-xl px-2 py-1.5 text-[12px] font-bold transition-all sm:gap-x-1 sm:text-[13px]",r?A:"text-zinc-500",!r&&v.hoverText),m=ae("rounded-full p-2 transition-all duration-200",!r&&v.hoverBg),e[0]=r,e[1]=o,e[2]=n,e[3]=l,e[4]=a,e[5]=x,e[6]=f,e[7]=v,e[8]=m,e[9]=p,e[10]=b,e[11]=h,e[12]=w}else f=e[6],v=e[7],m=e[8],p=e[9],b=e[10],h=e[11],w=e[12];let C;e[16]!==r?(C=r?{scale:[1,1.4,1],rotate:[0,15,0]}:{scale:1},e[16]=r,e[17]=C):C=e[17];let k;e[18]===Symbol.for("react.memo_cache_sentinel")?(k={duration:.45,type:"spring",stiffness:300,damping:15},e[18]=k):k=e[18];const N=r?2.5:2,d=r&&v.activeFill;let S;e[19]!==d?(S=ae("transition-colors duration-200",d),e[19]=d,e[20]=S):S=e[20];let F;e[21]!==s||e[22]!==u||e[23]!==N||e[24]!==S?(F=(0,t.jsx)(s,{size:u,strokeWidth:N,className:S}),e[21]=s,e[22]=u,e[23]=N,e[24]=S,e[25]=F):F=e[25];let R;e[26]!==F||e[27]!==C?(R=(0,t.jsx)(B.div,{animate:C,transition:k,children:F}),e[26]=F,e[27]=C,e[28]=R):R=e[28];let j;e[29]!==R||e[30]!==m?(j=(0,t.jsx)("div",{className:m,children:R}),e[29]=R,e[30]=m,e[31]=j):j=e[31];let z;e[32]!==l?(z=l&&(0,t.jsx)("span",{className:"hidden xs:inline",children:l}),e[32]=l,e[33]=z):z=e[33];let P;e[34]!==r||e[35]!==n?(P=n!=null&&(0,t.jsx)(B.span,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:ae("transition-all",r?"font-black":"font-bold"),children:n||0},n),e[34]=r,e[35]=n,e[36]=P):P=e[36];let I;e[37]!==P?(I=(0,t.jsx)(ye,{mode:"wait",children:P}),e[37]=P,e[38]=I):I=e[38];let M;return e[39]!==f||e[40]!==j||e[41]!==z||e[42]!==I||e[43]!==p||e[44]!==b||e[45]!==h||e[46]!==w?(M=(0,t.jsxs)(f,{whileTap:p,onClick:b,"aria-label":h,className:w,children:[j,z,I]}),e[39]=f,e[40]=j,e[41]=z,e[42]=I,e[43]=p,e[44]=b,e[45]=h,e[46]=w,e[47]=M):M=e[47],M},Q=qs,Hs=W(),Gs=i=>{const e=(0,Hs.c)(18),{poll:s,onVote:n}=i,l=s.options.reduce(Qs,0),[a,r]=(0,_.useState)(null);let o;e[0]!==n||e[1]!==a?(o=m=>{a||(r(m),n&&n(m))},e[0]=n,e[1]=a,e[2]=o):o=e[2];const c=o;let g;if(e[3]!==c||e[4]!==s.options||e[5]!==l||e[6]!==a){let m;e[8]!==c||e[9]!==l||e[10]!==a?(m=(p,b)=>{const h=l>0?Math.round((p.votes+(a===p.id?1:0))/(l+(a?1:0))*100):0,w=a===p.id;return(0,t.jsxs)("div",{onClick:()=>c(p.id),className:`relative h-10 w-full overflow-hidden rounded-xl border cursor-pointer ${w?"border-violet-500 dark:border-violet-500":"border-zinc-200 dark:border-zinc-700"}`,children:[a&&(0,t.jsx)("div",{className:"absolute left-0 top-0 h-full bg-zinc-200 transition-all duration-500 dark:bg-zinc-800",style:{width:`${h}%`}}),(0,t.jsxs)("div",{className:"absolute inset-0 z-10 flex items-center justify-between px-4",children:[(0,t.jsxs)("span",{className:`text-sm font-medium ${w?"font-bold text-violet-600":"text-zinc-700 dark:text-zinc-200"}`,children:[p.text," ",w&&(0,t.jsx)(Ut,{size:14,className:"mb-0.5 inline ml-1"})]}),a&&(0,t.jsxs)("span",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:[h,"%"]})]})]},p.id||b)},e[8]=c,e[9]=l,e[10]=a,e[11]=m):m=e[11],g=s.options.map(m),e[3]=c,e[4]=s.options,e[5]=l,e[6]=a,e[7]=g}else g=e[7];const u=l+(a?1:0),x=a?"6 days left":"Click to vote";let f;e[12]!==u||e[13]!==x?(f=(0,t.jsxs)("div",{className:"pl-1 text-xs text-zinc-500 dark:text-zinc-400",children:[u," votes •"," ",x]}),e[12]=u,e[13]=x,e[14]=f):f=e[14];let v;return e[15]!==g||e[16]!==f?(v=(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[g,f]}),e[15]=g,e[16]=f,e[17]=v):v=e[17],v},xt=Gs;function Qs(i,e){return i+e.votes}var Js=W(),Xs=i=>{const e=(0,Js.c)(25),{user:s,time:n,content:l}=i;let a;e[0]!==s.avatar||e[1]!==s.handle?(a=(0,t.jsx)(Y,{src:s.avatar,alt:s.handle}),e[0]=s.avatar,e[1]=s.handle,e[2]=a):a=e[2];let r;e[3]!==s.handle[0]?(r=s.handle[0]?.toUpperCase(),e[3]=s.handle[0],e[4]=r):r=e[4];let o;e[5]!==r?(o=(0,t.jsx)(ee,{children:r}),e[5]=r,e[6]=o):o=e[6];let c;e[7]!==a||e[8]!==o?(c=(0,t.jsxs)(Z,{className:"size-6",children:[a,o]}),e[7]=a,e[8]=o,e[9]=c):c=e[9];let g;e[10]!==s.handle?(g=(0,t.jsx)("span",{className:"text-sm font-semibold",children:s.handle}),e[10]=s.handle,e[11]=g):g=e[11];let u;e[12]!==c||e[13]!==g?(u=(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[c,g]}),e[12]=c,e[13]=g,e[14]=u):u=e[14];let x;e[15]!==n?(x=(0,t.jsx)("span",{className:"text-xs text-zinc-500 sm:text-sm",children:n}),e[15]=n,e[16]=x):x=e[16];let f;e[17]!==u||e[18]!==x?(f=(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between gap-x-2",children:[u,x]}),e[17]=u,e[18]=x,e[19]=f):f=e[19];let v;e[20]!==l?(v=(0,t.jsx)(Fe,{content:l,className:"text-sm text-zinc-800 dark:text-zinc-300"}),e[20]=l,e[21]=v):v=e[21];let m;return e[22]!==f||e[23]!==v?(m=(0,t.jsxs)("div",{className:"p-4",children:[f,v]}),e[22]=f,e[23]=v,e[24]=m):m=e[24],m},ft=Xs,Ks=W(),Ys=i=>{const e=(0,Ks.c)(54),{currentUser:s,newComment:n,setNewComment:l,handleSubmitComment:a,loading:r,selectedFiles:o,setSelectedFiles:c,isUploading:g}=i;let u;e[0]!==o?(u=o===void 0?[]:o,e[0]=o,e[1]=u):u=e[1];const x=u,f=(0,_.useRef)(null);let v;e[2]!==c?(v=y=>{if(y.target.files){const E=Array.from(y.target.files);c&&c(q=>[...q,...E])}},e[2]=c,e[3]=v):v=e[3];const m=v;let p;e[4]!==c?(p=y=>{c&&c(E=>E.filter((q,G)=>G!==y))},e[4]=c,e[5]=p):p=e[5];const b=p;let h;e[6]!==c?(h=y=>{const E=y.clipboardData.files;if(E&&E.length>0){const q=Array.from(E).filter(Zs);q.length>0&&(y.preventDefault(),c&&c(G=>[...G,...q]))}},e[6]=c,e[7]=h):h=e[7];const w=h;if(!s){let y;return e[8]===Symbol.for("react.memo_cache_sentinel")?(y=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-6 text-center dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"Please login to join the conversation."})}),e[8]=y):y=e[8],y}let C;e[9]!==s.avatar||e[10]!==s.handle?(C=(0,t.jsx)(Y,{src:s.avatar,alt:s.handle,className:"object-cover"}),e[9]=s.avatar,e[10]=s.handle,e[11]=C):C=e[11];let k;e[12]!==s.handle?.[0]?(k=s.handle?.[0]?.toUpperCase(),e[12]=s.handle?.[0],e[13]=k):k=e[13];let N;e[14]!==k?(N=(0,t.jsx)(ee,{children:k}),e[14]=k,e[15]=N):N=e[15];let d;e[16]!==C||e[17]!==N?(d=(0,t.jsxs)(Z,{className:"size-9 border border-zinc-200 dark:border-zinc-700",children:[C,N]}),e[16]=C,e[17]=N,e[18]=d):d=e[18];let S;e[19]!==l?(S=y=>l(y.target.value),e[19]=l,e[20]=S):S=e[20];let F;e[21]!==w||e[22]!==n||e[23]!==S?(F=(0,t.jsx)("textarea",{id:"comment-input",className:"min-h-[60px] w-full resize-none bg-transparent text-base outline-none placeholder:text-zinc-500 dark:text-white",placeholder:"Post your reply...",value:n,onChange:S,onPaste:w}),e[21]=w,e[22]=n,e[23]=S,e[24]=F):F=e[24];let R;e[25]!==b||e[26]!==x?(R=x.length>0&&(0,t.jsx)("div",{className:"mt-2 mb-2 flex flex-wrap gap-2",children:x.map((y,E)=>(0,t.jsxs)("div",{className:"relative size-20 overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[y.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(y),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)(Yt,{size:20,className:"text-zinc-500"})}),(0,t.jsx)("button",{onClick:()=>b(E),className:"absolute right-1 top-1 rounded-full bg-black/60 p-1 text-white transition-colors hover:bg-black",children:(0,t.jsx)(ne,{size:12})})]},E))}),e[25]=b,e[26]=x,e[27]=R):R=e[27];let j;e[28]===Symbol.for("react.memo_cache_sentinel")?(j=()=>f.current?.click(),e[28]=j):j=e[28];let z;e[29]===Symbol.for("react.memo_cache_sentinel")?(z=(0,t.jsx)("button",{type:"button",onClick:j,className:"rounded-full p-2 text-violet-600 transition-colors hover:bg-violet-50 dark:hover:bg-zinc-800",title:"Attach media",children:(0,t.jsx)(ds,{size:20})}),e[29]=z):z=e[29];let P;e[30]!==m?(P=(0,t.jsxs)("div",{className:"flex gap-1 text-violet-600",children:[z,(0,t.jsx)("input",{type:"file",ref:f,onChange:m,multiple:!0,className:"hidden",accept:"image/*,video/*,application/pdf"})]}),e[30]=m,e[31]=P):P=e[31];const I=r||g?"primary":"animated";let M;e[32]!==g||e[33]!==r?(M=!(r||g)&&(0,t.jsx)(ue,{size:20}),e[32]=g,e[33]=r,e[34]=M):M=e[34];const D=r||g;let A;e[35]!==n||e[36]!==x.length?(A=!n.trim()&&x.length===0,e[35]=n,e[36]=x.length,e[37]=A):A=e[37];let L;e[38]!==a||e[39]!==I||e[40]!==M||e[41]!==D||e[42]!==A?(L=(0,t.jsx)(Nt,{variant:I,icon:M,className:"min-w-[70px] !w-auto",onClick:a,loading:D,disabled:A,children:"Reply"}),e[38]=a,e[39]=I,e[40]=M,e[41]=D,e[42]=A,e[43]=L):L=e[43];let O;e[44]!==P||e[45]!==L?(O=(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between border-t border-zinc-100 pt-3 dark:border-zinc-800",children:[P,L]}),e[44]=P,e[45]=L,e[46]=O):O=e[46];let U;e[47]!==F||e[48]!==R||e[49]!==O?(U=(0,t.jsxs)("div",{className:"flex-1",children:[F,R,O]}),e[47]=F,e[48]=R,e[49]=O,e[50]=U):U=e[50];let $;return e[51]!==U||e[52]!==d?($=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-4 dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[d,U]})}),e[51]=U,e[52]=d,e[53]=$):$=e[53],$},wt=_.memo(Ys);function Zs(i){return i.type.startsWith("image/")}var ei=W(),ti=i=>{const e=(0,ei.c)(30),{url:s}=i;let n,l;e[0]!==s?(n=["link-preview",s],l=()=>bs(s),e[0]=s,e[1]=n,e[2]=l):(n=e[1],l=e[2]);const a=!!s;let r;e[3]!==n||e[4]!==l||e[5]!==a?(r={queryKey:n,queryFn:l,staleTime:864e5,enabled:a},e[3]=n,e[4]=l,e[5]=a,e[6]=r):r=e[6];const{data:o,isLoading:c,isError:g}=Ot(r);if(c){let C;return e[7]===Symbol.for("react.memo_cache_sentinel")?(C=(0,t.jsx)("div",{className:"mt-3 flex h-24 animate-pulse items-center justify-center overflow-hidden rounded-2xl border border-zinc-100 bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-900/50",children:(0,t.jsx)(Be,{className:"animate-spin text-zinc-300 dark:text-zinc-700",size:24})}),e[7]=C):C=e[7],C}if(g||!o||!o.title&&!o.image)return null;let u;e[8]!==o.image||e[9]!==o.title?(u=o.image&&(0,t.jsx)("div",{className:"aspect-[1.91/1] w-full overflow-hidden border-b border-zinc-100 bg-zinc-100 dark:border-zinc-800 dark:bg-zinc-900",children:(0,t.jsx)("img",{src:o.image,alt:o.title??void 0,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-[1.02]",onError:ii})}),e[8]=o.image,e[9]=o.title,e[10]=u):u=e[10];let x;e[11]===Symbol.for("react.memo_cache_sentinel")?(x=(0,t.jsx)(Be,{size:12}),e[11]=x):x=e[11];let f;e[12]!==o.siteName?(f=(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs font-bold uppercase tracking-wider text-zinc-600",children:[x,(0,t.jsx)("span",{children:o.siteName})]}),e[12]=o.siteName,e[13]=f):f=e[13];let v;e[14]!==o.title?(v=(0,t.jsx)("div",{className:"line-clamp-2 text-[15px] font-bold leading-snug transition-colors group-hover:text-violet-700 dark:text-white",children:o.title}),e[14]=o.title,e[15]=v):v=e[15];let m;e[16]!==o.description?(m=o.description&&(0,t.jsx)("p",{className:"line-clamp-2 text-xs leading-relaxed text-zinc-600 dark:text-zinc-400",children:o.description}),e[16]=o.description,e[17]=m):m=e[17];let p;e[18]===Symbol.for("react.memo_cache_sentinel")?(p=(0,t.jsx)(Jt,{size:10}),e[18]=p):p=e[18];let b;e[19]!==s?(b=(0,t.jsxs)("div",{className:"flex items-center gap-1 pt-1 text-[11px] font-medium text-zinc-500",children:[p,(0,t.jsx)("span",{className:"truncate",children:s})]}),e[19]=s,e[20]=b):b=e[20];let h;e[21]!==b||e[22]!==f||e[23]!==v||e[24]!==m?(h=(0,t.jsxs)("div",{className:"space-y-1 p-3.5",children:[f,v,m,b]}),e[21]=b,e[22]=f,e[23]=v,e[24]=m,e[25]=h):h=e[25];let w;return e[26]!==h||e[27]!==u||e[28]!==s?(w=(0,t.jsxs)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"group mt-3 flex flex-col overflow-hidden rounded-2xl border border-zinc-100 bg-white shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-900",onClick:si,children:[u,h]}),e[26]=h,e[27]=u,e[28]=s,e[29]=w):w=e[29],w},ht=ti;function si(i){return i.stopPropagation()}function ii(i){return i.target.style.display="none"}var li=W(),ai=i=>{const e=(0,li.c)(15),{file:s}=i;let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,t.jsx)("div",{className:"flex size-10 items-center justify-center rounded-xl bg-violet-100 text-violet-600 dark:bg-violet-900/30",children:(0,t.jsx)(Vt,{size:20})}),e[0]=n):n=e[0];let l;e[1]!==s.name?(l=(0,t.jsx)("div",{className:"truncate text-sm font-bold dark:text-white",children:s.name}),e[1]=s.name,e[2]=l):l=e[2];let a;e[3]!==s.size?(a=s.size!==void 0&&(0,t.jsxs)("div",{className:"text-xs uppercase text-zinc-500",children:[(s.size/1024/1024).toFixed(2)," MB"]}),e[3]=s.size,e[4]=a):a=e[4];let r;e[5]!==l||e[6]!==a?(r=(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[l,a]}),e[5]=l,e[6]=a,e[7]=r):r=e[7];let o;e[8]===Symbol.for("react.memo_cache_sentinel")?(o=(0,t.jsx)(Ht,{size:18}),e[8]=o):o=e[8];let c;e[9]!==s.name||e[10]!==s.url?(c=(0,t.jsx)("a",{href:s.url,download:s.name,className:"p-2 text-zinc-400 transition-colors hover:text-violet-600",onClick:ri,children:o}),e[9]=s.name,e[10]=s.url,e[11]=c):c=e[11];let g;return e[12]!==r||e[13]!==c?(g=(0,t.jsxs)("div",{className:"group mt-3 flex items-center gap-3 rounded-2xl border border-zinc-100 bg-zinc-50/50 p-3 transition-colors hover:border-violet-500/30 dark:border-zinc-800 dark:bg-zinc-900/10",children:[n,r,c]}),e[12]=r,e[13]=c,e[14]=g):g=e[14],g},ni=ai;function ri(i){return i.stopPropagation()}var Ct=W(),oi=_.lazy(()=>vt(()=>import("./VideoPlayer-PgAMkdC1.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),ci=i=>{const e=(0,Ct.c)(16),{item:s,onClick:n}=i,[l,a]=(0,_.useState)(!1);let r,o;e[0]===Symbol.for("react.memo_cache_sentinel")?(r={scale:.98},o={type:"spring",stiffness:400,damping:25},e[0]=r,e[1]=o):(r=e[0],o=e[1]);let c;e[2]!==l?(c=!l&&(0,t.jsx)("div",{className:"absolute inset-0 animate-pulse bg-zinc-200 dark:bg-zinc-800"}),e[2]=l,e[3]=c):c=e[3];const g=s.url||s.src;let u;e[4]===Symbol.for("react.memo_cache_sentinel")?(u={opacity:0,scale:1.05,filter:"blur(10px)"},e[4]=u):u=e[4];let x;e[5]!==l?(x=l?{opacity:1,scale:1,filter:"blur(0px)"}:{},e[5]=l,e[6]=x):x=e[6];let f;e[7]===Symbol.for("react.memo_cache_sentinel")?(f={duration:.4,ease:"easeOut"},e[7]=f):f=e[7];let v;e[8]===Symbol.for("react.memo_cache_sentinel")?(v=()=>a(!0),e[8]=v):v=e[8];let m;e[9]!==g||e[10]!==x?(m=(0,t.jsx)(B.img,{src:g,initial:u,animate:x,transition:f,className:"size-full object-cover",alt:"",loading:"lazy",onLoad:v}),e[9]=g,e[10]=x,e[11]=m):m=e[11];let p;return e[12]!==n||e[13]!==c||e[14]!==m?(p=(0,t.jsxs)(B.div,{whileTap:r,transition:o,className:"relative size-full overflow-hidden",onClick:n,children:[c,m]}),e[12]=n,e[13]=c,e[14]=m,e[15]=p):p=e[15],p},di=i=>{const e=(0,Ct.c)(3),{items:s}=i,n=s===void 0?[]:s,{openLightbox:l}=fs();if(!n||Array.isArray(n)&&n.length===0)return null;const a=Array.isArray(n)?n:[n],r=a.filter(xi),o=a.filter(fi),c=r.some(hi),g=m=>{const p=r.filter(ui).map(pi),b=r[m];l(p,p.indexOf(b.url||b.src))},u="mt-2 space-y-2",x=r.length>0&&(0,t.jsx)("div",{className:`grid gap-2 overflow-hidden rounded-2xl border border-zinc-100 dark:border-zinc-800 ${r.length===1?"grid-cols-1":r.length===2?c?"aspect-[8/9] grid-cols-1 grid-rows-2":"aspect-[16/9] grid-cols-2":(r.length===3,"aspect-[16/9] grid-cols-2 grid-rows-2")}`,children:r.map((m,p)=>(0,t.jsx)("div",{className:`relative cursor-pointer overflow-hidden bg-zinc-100 dark:bg-zinc-900 ${r.length===3&&p===0?"row-span-2":""}`,children:m.type==="video"?(0,t.jsx)(_.Suspense,{fallback:(0,t.jsx)("div",{className:"flex aspect-video w-full items-center justify-center bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)("div",{className:"size-8 animate-spin rounded-full border-2 border-violet-500 border-t-transparent"})}),children:(0,t.jsx)(oi,{src:m.url,poster:m.poster||void 0})}):(0,t.jsx)(ci,{item:m,onClick:b=>{b.stopPropagation(),g(p)}})},p))}),f=o.map(gi);let v;return e[0]!==x||e[1]!==f?(v=(0,t.jsxs)("div",{className:u,children:[x,f]}),e[0]=x,e[1]=f,e[2]=v):v=e[2],v},mi=di;function xi(i){return i.type==="image"||i.type==="video"}function fi(i){return i.type==="file"}function hi(i){return i.type==="video"}function ui(i){return i.type==="image"}function pi(i){return i.url||i.src}function gi(i,e){return(0,t.jsx)(ni,{file:i},e)}var vi=({isOpen:i,onClose:e,url:s,title:n="Share"})=>{const[l,a]=(0,_.useState)(!1),[r,o]=(0,_.useState)(""),[c,g]=(0,_.useState)([]),[u,x]=(0,_.useState)(!1),[f,v]=(0,_.useState)(null),{addToast:m}=Se(),{currentUser:p}=jt(),b=(0,_.useCallback)(async()=>{if(p){x(!0);try{g((await at(p.id)).map(d=>d.user).filter(d=>d!==null).slice(0,5))}catch(d){console.error("Failed to fetch conversations:",d)}finally{x(!1)}}},[p]);(0,_.useEffect)(()=>{i&&p?b():(o(""),g([]))},[i,p,b]);const h=(0,_.useCallback)(async()=>{if(p){x(!0);try{g((await at(p.id)).map(d=>d.user).filter(d=>d!==null&&(d.name?.toLowerCase().includes(r.toLowerCase())||d.handle.toLowerCase().includes(r.toLowerCase()))))}catch(d){console.error("Search failed:",d)}finally{x(!1)}}},[r,p]);(0,_.useEffect)(()=>{const d=setTimeout(()=>{r.trim()&&i?h():!r.trim()&&i&&b()},300);return()=>clearTimeout(d)},[r,i,h,b]);const w=async d=>{d&&d.stopPropagation();try{await _e(s),a(!0),m("Link copied to clipboard!","success"),setTimeout(()=>a(!1),2e3)}catch(S){console.error("Failed to copy:",S),m("Failed to copy link","error")}},C=async d=>{if(p){v(d.id);try{await us(await ws(p.id,d.id),p.id,s,"text"),m(`Sent to ${d.name||d.handle}!`,"success")}catch(S){console.error("Failed to send message:",S),m("Failed to send message","error")}finally{v(null)}}},k=[{name:"X",icon:as,color:"bg-black text-white",href:`https://twitter.com/intent/tweet?url=${encodeURIComponent(s)}`},{name:"Facebook",icon:Xt,color:"bg-[#1877F2] text-white",href:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(s)}`},{name:"LinkedIn",icon:Bt,color:"bg-[#0A66C2] text-white",href:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(s)}`},{name:"WhatsApp",icon:es,color:"bg-[#25D366] text-white",href:`https://wa.me/?text=${encodeURIComponent(s)}`},{name:"Email",icon:Qt,color:"bg-zinc-600 text-white",href:`mailto:?body=${encodeURIComponent(s)}`}],N=async()=>{if(navigator.share)try{await navigator.share({title:n,url:s})}catch(d){d.name!=="AbortError"&&console.error("Native share failed:",d)}else w()};return(0,t.jsx)(kt,{isOpen:i,onClose:e,title:n,className:"max-w-[420px] !p-0 overflow-hidden",children:(0,t.jsxs)("div",{className:"flex h-full flex-col bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"px-5 pb-2 pt-4",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)(Zt,{className:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-zinc-400 transition-colors group-focus-within:text-violet-500"}),(0,t.jsx)("input",{type:"text",placeholder:"Search people...",value:r,onChange:d=>o(d.target.value),className:"w-full rounded-xl border-none bg-zinc-100 py-2.5 pl-10 pr-4 text-sm transition-all focus:ring-2 focus:ring-violet-500/20 outline-none dark:bg-zinc-800/50"})]})}),(0,t.jsx)("div",{className:"no-scrollbar flex min-h-[100px] items-center gap-4 overflow-x-auto px-5 py-4",children:u?(0,t.jsx)("div",{className:"flex flex-1 justify-center",children:(0,t.jsx)("span",{className:"animate-pulse font-bold text-zinc-400",children:"Loading..."})}):c.length>0?c.map(d=>(0,t.jsxs)("button",{onClick:()=>C(d),disabled:f!==null,className:"group flex shrink-0 flex-col items-center gap-1.5 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"size-14 overflow-hidden rounded-full border-2 border-white shadow-sm transition-transform group-hover:scale-105 bg-zinc-100 dark:bg-zinc-800 dark:border-zinc-900",children:(0,t.jsx)("img",{src:d.avatar||`https://i.pravatar.cc/150?u=${d.id}`,alt:d.handle,className:"size-full object-cover"})}),f===d.id&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-full bg-black/40",children:(0,t.jsx)("span",{className:"animate-pulse text-white font-bold",children:"..."})})]}),(0,t.jsx)("span",{className:"max-w-[60px] truncate text-[10px] font-medium text-zinc-500 dark:text-zinc-400",children:d.name?.split(" ")[0]||d.handle})]},d.id)):(0,t.jsx)("div",{className:"flex-1 py-2 text-center",children:(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"No people found"})})}),(0,t.jsx)("div",{className:"mx-5 h-px bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsxs)("div",{className:"grid grid-cols-5 gap-2 px-5 py-6",children:[k.map(d=>(0,t.jsxs)("a",{href:d.href,target:"_blank",rel:"noopener noreferrer",className:"group flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:`size-12 ${d.color} flex items-center justify-center rounded-2xl shadow-md transition-all group-hover:-translate-y-1 group-hover:scale-110 group-hover:shadow-lg`,children:(0,t.jsx)(d.icon,{size:20,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-tighter text-zinc-500 dark:text-zinc-400",children:d.name})]},d.name)),(0,t.jsxs)("button",{onClick:N,className:"group flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:"flex size-12 items-center justify-center rounded-2xl border border-zinc-200 bg-zinc-100 text-zinc-600 shadow-sm transition-all group-hover:-translate-y-1 group-hover:scale-110 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-300",children:(0,t.jsx)(Ne,{size:20,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-tighter text-zinc-500 dark:text-zinc-400",children:"More"})]})]}),(0,t.jsx)("div",{className:"px-5 pb-6",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)("input",{type:"text",readOnly:!0,value:s,className:"w-full rounded-2xl border border-zinc-200 bg-zinc-50 py-3.5 pl-4 pr-14 text-sm font-medium transition-colors focus:outline-none group-hover:border-zinc-300 dark:border-zinc-800 dark:bg-zinc-950 dark:group-hover:border-zinc-700"}),(0,t.jsx)("button",{onClick:w,className:`absolute right-1.5 top-1/2 flex -translate-y-1/2 items-center gap-2 rounded-xl h-10 px-4 text-xs font-bold shadow-sm transition-all active:scale-95 ${l?"bg-emerald-500 text-white":"bg-zinc-900 text-white hover:opacity-90 dark:bg-white dark:text-zinc-900"}`,children:l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ss,{size:14,strokeWidth:3}),(0,t.jsx)("span",{children:"Copied"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(qt,{size:14,strokeWidth:3}),(0,t.jsx)("span",{children:"Copy"})]})})]})}),(0,t.jsx)("div",{className:"px-5 pb-5",children:(0,t.jsxs)("button",{onClick:e,className:"group relative flex w-full items-center justify-center overflow-hidden rounded-2xl bg-zinc-900 py-4 font-bold text-white transition-all hover:shadow-xl hover:shadow-zinc-900/10 active:scale-[0.98] dark:bg-white dark:text-zinc-900 dark:hover:shadow-white/10",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-zinc-500 to-zinc-600 opacity-0 transition-opacity duration-300 group-hover:opacity-100"}),(0,t.jsx)("div",{className:"relative flex items-center gap-2",children:(0,t.jsx)("span",{children:"Close"})})]})})]})})},_t=vi,$t=W(),bi=i=>{const e=(0,$t.c)(6),{avatars:s}=i;if(!s||s.length===0)return null;let n,l;if(e[0]!==s){const r=s.slice(0,3);n="relative mt-2 h-7 w-7",l=r.map((o,c)=>{let g,u;return r.length===1?(g="top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",u="size-5"):r.length===2?(u="size-4",g=c===0?"top-0 right-0":"bottom-0 left-0"):(u=c===0?"size-3.5":"size-3",c===0?g="top-0 right-0":c===1?g="bottom-0 right-0":g="top-1/2 left-0 -translate-y-1/2"),(0,t.jsx)("div",{className:`absolute rounded-full border border-white bg-zinc-100 dark:border-black dark:bg-zinc-800 overflow-hidden shadow-sm ${g} ${u}`,style:{zIndex:10-c},children:(0,t.jsx)("img",{src:o,alt:"",className:"h-full w-full object-cover"})},c)}),e[0]=s,e[1]=n,e[2]=l}else n=e[1],l=e[2];let a;return e[3]!==n||e[4]!==l?(a=(0,t.jsx)("div",{className:n,children:l}),e[3]=n,e[4]=l,e[5]=a):a=e[5],a},ut=i=>{const e=(0,$t.c)(70),{id:s,user:n,isCurrentUser:l,isComment:a,onEdit:r,onDelete:o,addToast:c,trigger:g}=i,{openReport:u}=yt(),[x,f]=(0,_.useState)(!1);if(_s("(min-width: 1024px)")){let j;e[0]!==g?(j=(0,t.jsx)(Fs,{asChild:!0,onClick:ki,children:(0,t.jsx)("div",{className:"cursor-pointer outline-none",children:g})}),e[0]=g,e[1]=j):j=e[1];let z;e[2]!==c||e[3]!==s||e[4]!==a?(z=!a&&(0,t.jsxs)(ie,{onClick:y=>{y.stopPropagation(),_e(`${Je()}/p/${s}`).then(()=>{c("Link copied"),f(!1)}).catch(()=>{c("Failed to copy link","error")})},children:[(0,t.jsx)(qe,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Copy link"})]}),e[2]=c,e[3]=s,e[4]=a,e[5]=z):z=e[5];let P;e[6]!==s||e[7]!==u?(P=y=>{y.stopPropagation(),u("post",s),f(!1)},e[6]=s,e[7]=u,e[8]=P):P=e[8];let I;e[9]===Symbol.for("react.memo_cache_sentinel")?(I=(0,t.jsx)(ke,{className:"mr-2 h-4 w-4"}),e[9]=I):I=e[9];const M=a?"comment":"post";let D;e[10]!==M?(D=(0,t.jsxs)("span",{children:["Report ",M]}),e[10]=M,e[11]=D):D=e[11];let A;e[12]!==P||e[13]!==D?(A=(0,t.jsxs)(ie,{onClick:P,children:[I,D]}),e[12]=P,e[13]=D,e[14]=A):A=e[14];let L;e[15]!==l||e[16]!==u||e[17]!==n?(L=!l&&(0,t.jsxs)(ie,{onClick:y=>{y.stopPropagation(),u("user",n.id),f(!1)},children:[(0,t.jsx)(We,{className:"mr-2 h-4 w-4"}),(0,t.jsxs)("span",{children:["Report @",n.handle]})]}),e[15]=l,e[16]=u,e[17]=n,e[18]=L):L=e[18];let O;e[19]!==a||e[20]!==l||e[21]!==o||e[22]!==r?(O=l&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(gs,{}),(0,t.jsxs)(ie,{onClick:y=>{y.stopPropagation(),r(),f(!1)},children:[(0,t.jsx)(Ge,{className:"mr-2 h-4 w-4"}),(0,t.jsxs)("span",{children:["Edit ",a?"Comment":"Post"]})]}),(0,t.jsxs)(ie,{className:"text-red-500 focus:text-red-500",onClick:y=>{y.stopPropagation(),o(),f(!1)},children:[(0,t.jsx)(He,{className:"mr-2 h-4 w-4"}),(0,t.jsxs)("span",{children:["Delete ",a?"comment":"post"]})]})]}),e[19]=a,e[20]=l,e[21]=o,e[22]=r,e[23]=O):O=e[23];let U;e[24]!==z||e[25]!==A||e[26]!==L||e[27]!==O?(U=(0,t.jsxs)(hs,{align:"end",className:"w-56",onClick:Ni,children:[z,A,L,O]}),e[24]=z,e[25]=A,e[26]=L,e[27]=O,e[28]=U):U=e[28];let $;return e[29]!==x||e[30]!==j||e[31]!==U?($=(0,t.jsx)("div",{onClick:yi,children:(0,t.jsxs)(ks,{open:x,onOpenChange:f,modal:!0,children:[j,U]})}),e[29]=x,e[30]=j,e[31]=U,e[32]=$):$=e[32],$}let v;e[33]===Symbol.for("react.memo_cache_sentinel")?(v=j=>{j.stopPropagation(),f(!0)},e[33]=v):v=e[33];let m;e[34]!==g?(m=(0,t.jsx)("div",{onClick:v,className:"cursor-pointer",children:g}),e[34]=g,e[35]=m):m=e[35];let p;e[36]===Symbol.for("react.memo_cache_sentinel")?(p=()=>f(!1),e[36]=p):p=e[36];let b;e[37]!==c||e[38]!==s||e[39]!==a?(b=!a&&(0,t.jsx)(le,{icon:(0,t.jsx)(qe,{size:18}),onClick:j=>{j.stopPropagation(),_e(`${Je()}/p/${s}`).then(()=>{c("Link copied"),f(!1)}).catch(()=>{c("Failed to copy link","error")})},children:"Copy link"}),e[37]=c,e[38]=s,e[39]=a,e[40]=b):b=e[40];let h;e[41]===Symbol.for("react.memo_cache_sentinel")?(h=(0,t.jsx)(ke,{size:18}),e[41]=h):h=e[41];let w;e[42]!==s||e[43]!==u?(w=j=>{j.stopPropagation(),u("post",s),f(!1)},e[42]=s,e[43]=u,e[44]=w):w=e[44];const C=a?"comment":"post";let k;e[45]!==w||e[46]!==C?(k=(0,t.jsxs)(le,{icon:h,onClick:w,children:["Report ",C]}),e[45]=w,e[46]=C,e[47]=k):k=e[47];let N;e[48]!==l||e[49]!==u||e[50]!==n?(N=!l&&(0,t.jsxs)(le,{icon:(0,t.jsx)(We,{size:18}),onClick:j=>{j.stopPropagation(),u("user",n.id),f(!1)},children:["Report @",n.handle]}),e[48]=l,e[49]=u,e[50]=n,e[51]=N):N=e[51];let d;e[52]!==a||e[53]!==l||e[54]!==r?(d=l&&(0,t.jsxs)(le,{icon:(0,t.jsx)(Ge,{size:18}),onClick:j=>{j.stopPropagation(),r(),f(!1)},children:["Edit ",a?"Comment":"Post"]}),e[52]=a,e[53]=l,e[54]=r,e[55]=d):d=e[55];let S;e[56]!==a||e[57]!==l||e[58]!==o?(S=l&&(0,t.jsxs)(le,{variant:"destructive",icon:(0,t.jsx)(He,{size:18}),onClick:j=>{j.stopPropagation(),o(),f(!1)},children:["Delete ",a?"comment":"post"]}),e[56]=a,e[57]=l,e[58]=o,e[59]=S):S=e[59];let F;e[60]!==x||e[61]!==d||e[62]!==S||e[63]!==b||e[64]!==k||e[65]!==N?(F=(0,t.jsx)("div",{onClick:wi,children:(0,t.jsxs)(Ts,{isOpen:x,onClose:p,children:[b,k,N,d,S]})}),e[60]=x,e[61]=d,e[62]=S,e[63]=b,e[64]=k,e[65]=N,e[66]=F):F=e[66];let R;return e[67]!==F||e[68]!==m?(R=(0,t.jsxs)(t.Fragment,{children:[m,F]}),e[67]=F,e[68]=m,e[69]=R):R=e[69],R},$e=({id:i,user:e,timeAgo:s,content:n,contentClass:l,media:a,quotedPost:r,stats:o,onClick:c,repostedBy:g,onUserClick:u,currentUser:x,poll:f,isDetail:v,initialComments:m,onDelete:p,onUpdate:b,isComment:h,onReply:w,community:C,parent_id:k,post_id:N,commenterAvatars:d=[]})=>{const S=gt(),{addToast:F}=Se(),{liked:R,reposted:j,localStats:z,setLocalStats:P,handleLike:I,handleRepost:M}=zs(N||i,o,x),{deletePost:D,updatePost:A}=xs(),{comments:L,fetchNextPage:O,hasNextPage:U,isFetchingNextPage:$,addComment:y,deleteComment:E,updateComment:q,isSubmitting:G}=it(N||i,m),[pe,ge]=(0,_.useState)(""),[ve,Pe]=(0,_.useState)([]),[St,Te]=(0,_.useState)(!1),[Re,te]=(0,_.useState)(!1),[re,X]=(0,_.useState)(!1),[J,oe]=(0,_.useState)(n),[ce,de]=(0,_.useState)(a||[]),[me,se]=(0,_.useState)([]),[Ie,Me]=(0,_.useState)(!1),[Ft,be]=(0,_.useState)(!1),[je,xe]=(0,_.useState)(null),[ze,De]=(0,_.useState)(!1),{comments:Pt,refetch:Ee}=it(N||i,void 0,ze?i:void 0),{ref:Ae,inView:Le}=At({threshold:.5,triggerOnce:!0});(0,_.useEffect)(()=>{if(Le&&!h){const T=setTimeout(()=>{js(i).catch(console.error)},1500);return()=>clearTimeout(T)}},[Le,i,h]);const Tt=(0,_.useCallback)(async()=>{!i||!N&&!i||z.comments===0||(De(!0),Ee())},[i,N,z.comments,Ee]),Oe=async()=>{const T=JSON.stringify(ce)!==JSON.stringify(a||[])||me.length>0;if(!J.trim()||J===n&&!T){X(!1);return}Me(!0);try{const V=[];for(const K of me){const Mt=await Ce(K);V.push(Mt)}const H=[...ce,...V];h?await q({commentId:i,content:J,media:H}):await A(i,{content:J,media:H}),se([]),X(!1),F(`${h?"Comment":"Post"} updated`),b&&b(i,J,H)}catch(V){console.error(`Failed to update ${h?"comment":"post"}:`,V),F(`Failed to update ${h?"comment":"post"}`)}finally{Me(!1)}},Ue=async T=>{T&&T.stopPropagation();try{h?await E(i):await D(i),F(`${h?"Comment":"Post"} deleted successfully`),p&&p(i)}catch(V){console.error(`Failed to delete ${h?"comment":"post"}:`,V),F(`Failed to delete ${h?"comment":"post"}`)}finally{te(!1)}},Rt=async T=>{if(T.preventDefault(),!(!pe.trim()&&ve.length===0||!x)){Te(!0);try{const V=[];for(const H of ve){const K=await Ce(H);V.push(K)}await y({userId:x.id,content:pe,media:V,replyToId:je?.id}),ge(""),Pe([]),xe(null),P(H=>({...H,comments:(H.comments||0)+1})),F("Reply posted!")}catch(V){console.error("Failed to post comment:",V),F("Failed to post reply.")}finally{Te(!1)}}},Ve=x?.handle===e.handle,It=(T,V)=>{xe(V?{handle:T,id:h?k||i:V}:null),ge(H=>{const K=`@${T} `;return H.includes(K)?H:K+H}),document.getElementById("comment-input")?.focus()};return v?(0,t.jsxs)(B.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col",ref:Ae,children:[(0,t.jsxs)("article",{className:"p-6 dark:bg-black",children:[(0,t.jsx)(ct,{user:e,timeAgo:s,community:C,onUserClick:u,isDetail:!0,showAvatar:!0,actionsMenu:(0,t.jsx)(ut,{id:i,user:e,isCurrentUser:Ve,isComment:h,onEdit:()=>X(!0),onDelete:()=>te(!0),addToast:F,trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,t.jsx)(Ne,{size:20})})})}),(0,t.jsx)(dt,{content:n,isDetail:!0,isEditing:re,editedContent:J,setEditedContent:oe,onCancelEdit:()=>{X(!1),oe(n),de(a||[]),se([])},onSaveEdit:Oe,isUpdating:Ie,contentClass:l}),fe(n)&&(0,t.jsx)(ht,{url:fe(n)}),(0,t.jsx)(mt,{media:a,isEditing:re,editedMedia:ce,setEditedMedia:de,newFiles:me,setNewFiles:se}),f&&(0,t.jsx)(xt,{poll:f,onVote:T=>Ns(i,T,x.id)}),r&&(0,t.jsx)("div",{className:"mt-5 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm dark:border-zinc-700",children:(0,t.jsx)(ft,{...r})}),(0,t.jsx)(ot,{views:z.views||0,likes:z.likes||0,comments:z.comments||0,isDetail:!0}),(0,t.jsx)("div",{className:"my-4"}),(0,t.jsx)(rt,{liked:R,reposted:j,handleLike:I,handleRepost:M,handleCommentClick:()=>document.getElementById("comment-input")?.focus(),handleShareClick:()=>be(!0),isDetail:!0,isComment:h})]}),je&&(0,t.jsxs)("div",{className:"flex items-center justify-between bg-zinc-50 px-5 py-2 dark:bg-zinc-900/50",children:[(0,t.jsxs)("span",{className:"text-sm text-zinc-500",children:["Replying to"," ",(0,t.jsxs)("span",{className:"font-bold text-violet-600",children:["@",je.handle]})]}),(0,t.jsx)("button",{onClick:()=>xe(null),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,t.jsx)(ne,{size:16})})]}),(0,t.jsx)(wt,{currentUser:x,newComment:pe,setNewComment:ge,handleSubmitComment:Rt,loading:G,selectedFiles:ve,setSelectedFiles:Pe,isUploading:St}),(0,t.jsxs)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:[(0,t.jsx)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:(0,t.jsxs)(t.Fragment,{children:[U&&L.length>0&&(0,t.jsxs)("button",{onClick:()=>O(),disabled:$,className:"flex w-full items-center justify-center gap-2 py-3 text-sm font-bold text-violet-600 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[$&&(0,t.jsx)("span",{className:"animate-spin",children:"⌛"}),"View more replies"]}),L.map(T=>(0,t.jsx)($e,{...T,isComment:!0,post_id:i,onReply:It,onUserClick:u,currentUser:x,stats:{likes:T.stats?.likes||0,comments:T.stats?.comments||0,reposts:T.stats?.reposts||0},timeAgo:T.timeAgo||T.created_at},T.id))]})}),(0,t.jsx)(Xe,{open:Re,onOpenChange:te,children:(0,t.jsxs)(tt,{onClick:T=>T.stopPropagation(),children:[(0,t.jsxs)(st,{children:[(0,t.jsx)(Ke,{children:"Are you absolutely sure?"}),(0,t.jsx)(nt,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(Qe,{children:[(0,t.jsx)(Ze,{onClick:T=>T.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Ye,{onClick:Ue,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})]}):(0,t.jsxs)(B.article,{initial:{opacity:0,y:10},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-50px"},transition:{duration:.4,ease:"easeOut"},ref:Ae,onClick:c,className:`px-5 transition-all ${h?"py-3 bg-transparent hover:bg-zinc-50/30 dark:hover:bg-zinc-800/20":"py-5 bg-white hover:bg-zinc-50/30 dark:bg-black dark:hover:bg-white/[0.02]"} ${c?"cursor-pointer":""}`,children:[g&&(0,t.jsxs)("div",{className:"mb-2.5 ml-1 flex items-center space-x-1.5 text-[13px] font-semibold text-zinc-600",children:[(0,t.jsx)(we,{size:14,className:"text-zinc-500"}),(0,t.jsxs)("span",{className:"flex cursor-pointer items-center text-zinc-700 hover:underline dark:text-zinc-300",onClick:T=>{T.stopPropagation(),u&&u(g.handle)},children:[g.handle," Reposted"]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-x-3.5",children:[(0,t.jsxs)("div",{className:"flex shrink-0 flex-col items-center self-stretch pt-0.5",children:[(0,t.jsx)("div",{className:"cursor-pointer",onClick:T=>{T.stopPropagation(),u&&u(e.handle)},children:(0,t.jsxs)(Z,{className:`${h?"size-8":"size-10"} border-0 shadow-sm`,children:[(0,t.jsx)(Y,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(ee,{className:"text-xs",children:e.handle[0]?.toUpperCase()})]})}),(!h&&z.comments>0||h&&!k&&z.comments>0)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mt-2 w-0.5 flex-1 rounded-full bg-zinc-100 dark:bg-zinc-800"}),!h&&(0,t.jsx)(bi,{avatars:d.length>0?d:(L||[]).slice(0,3).map(T=>T.user.avatar)})]})]}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,t.jsx)(ct,{user:e,timeAgo:s,community:C,onUserClick:u,isComment:h,actionsMenu:(0,t.jsx)(ut,{id:i,user:e,isCurrentUser:Ve,isComment:h,onEdit:()=>X(!0),onDelete:()=>te(!0),addToast:F,trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 group-hover:bg-zinc-100 dark:hover:bg-zinc-800 dark:group-hover:bg-zinc-800/50",children:(0,t.jsx)(Ne,{size:18})})})}),(0,t.jsx)(dt,{content:n,isEditing:re,editedContent:J,setEditedContent:oe,onCancelEdit:()=>{X(!1),oe(n),de(a||[]),se([])},onSaveEdit:Oe,isUpdating:Ie,contentClass:l}),fe(n)&&(0,t.jsx)(ht,{url:fe(n)}),(0,t.jsx)(mt,{media:a,isEditing:re,editedMedia:ce,setEditedMedia:de,newFiles:me,setNewFiles:se}),f&&(0,t.jsx)(xt,{poll:f}),r&&(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-900",onClick:T=>{T.stopPropagation(),S(`/p/${r.id}`)},children:(0,t.jsx)(ft,{...r})}),(0,t.jsx)(rt,{liked:R,reposted:j,handleLike:I,handleRepost:M,handleCommentClick:T=>{if(T?.stopPropagation(),w){const V=h&&k||i;w(e.handle,V)}else c&&c()},handleShareClick:T=>{T?.stopPropagation(),be(!0)},isComment:h}),(0,t.jsx)(ot,{views:z.views||0,likes:z.likes||0,comments:z.comments||0,isComment:h,onRepliesClick:()=>{ze?De(!1):Tt()}}),ze&&(0,t.jsxs)("div",{className:"relative mt-2 space-y-0",children:[(0,t.jsx)("div",{className:"absolute left-[19px] top-0 bottom-4 w-0.5 bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsx)("div",{className:"flex flex-col",children:Pt.map(T=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute left-[19px] top-5 h-0.5 w-4 bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsx)("div",{className:"pl-6",children:(0,t.jsx)($e,{...T,isComment:!0,post_id:N||i,onReply:w,onUserClick:u,currentUser:x,stats:{likes:T.stats?.likes||0,comments:T.stats?.comments||0,reposts:T.stats?.reposts||0},timeAgo:T.timeAgo||T.created_at})})]},T.id))})]}),(0,t.jsx)(_t,{isOpen:Ft,onClose:()=>be(!1),url:`${window.location.origin}/p/${i}`,title:"Share Post"}),(0,t.jsx)(Xe,{open:Re,onOpenChange:te,children:(0,t.jsxs)(tt,{onClick:T=>T.stopPropagation(),children:[(0,t.jsxs)(st,{children:[(0,t.jsx)(Ke,{children:"Are you absolutely sure?"}),(0,t.jsx)(nt,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(Qe,{children:[(0,t.jsx)(Ze,{onClick:T=>T.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Ye,{onClick:Ue,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})]})]})};function ji(i,e){const s=!i.media&&!e.media||i.media?.length===e.media?.length&&i.media?.every((l,a)=>l.url===e.media?.[a].url),n=i.repostedBy?.handle===e.repostedBy?.handle;return i.id===e.id&&i.content===e.content&&i.timeAgo===e.timeAgo&&i.user.id===e.user.id&&i.user.avatar===e.user.avatar&&i.stats.likes===e.stats.likes&&i.stats.comments===e.stats.comments&&i.stats.reposts===e.stats.reposts&&i.currentUser?.id===e.currentUser?.id&&!!s&&!!n}var zi=_.memo($e,ji);function yi(i){return i.stopPropagation()}function ki(i){return i.stopPropagation()}function Ni(i){return i.stopPropagation()}function wi(i){return i.stopPropagation()}var Ci=_.lazy(()=>vt(()=>import("./dist-DrKSVhVq.js"),__vite__mapDeps([13,1,2,3,4,5,6,7])).then(i=>({default:i.Plyr}))),_i=_.memo(({reel:i,isActive:e,isMuted:s,shouldLoad:n=!0})=>{const{currentUser:l}=jt(),{addToast:a}=Se(),{openReport:r}=yt(),o=(0,_.useRef)(null),[c,g]=(0,_.useState)(!1),[u,x]=(0,_.useState)(!1),[f,v]=(0,_.useState)(!1),[m,p]=(0,_.useState)(!1),[b,h]=(0,_.useState)(null),[w,C]=(0,_.useState)(!1),[k,N]=(0,_.useState)(i.stats?.likes||0),[d,S]=(0,_.useState)(!1),[F,R]=(0,_.useState)(0),j=(0,_.useRef)(null),z=(0,_.useMemo)(()=>Array.isArray(i.media)?i.media[0]?.src||i.media[0]?.url:i.media?.src||i.media?.url||i.url,[i.media,i.url]);(0,_.useEffect)(()=>{p(!1);const $=o.current?.plyr;if($&&typeof $.on=="function"){const y=()=>p(!0);return $.on("ready",y),$.on("canplay",y),$.on("loadeddata",y),()=>{typeof $.off=="function"&&($.off("ready",y),$.off("canplay",y),$.off("loadeddata",y))}}else{const y=setTimeout(()=>p(!0),1e3);return()=>clearTimeout(y)}},[z]),(0,_.useEffect)(()=>{let $;const y=o.current?.plyr;return y&&m&&(e?$=setTimeout(()=>{if(typeof y.play=="function"){const E=y.play();E!==void 0&&E.catch(()=>{y&&(y.muted=!0,y.play().catch(()=>{}))})}},100):typeof y.pause=="function"&&y.pause()),()=>{$&&clearTimeout($),y&&typeof y.pause=="function"&&y.pause()}},[e,m]),(0,_.useEffect)(()=>{if(!l?.id||!e)return;(async()=>{try{const[y,E]=await Promise.all([Ss(i.id,l.id),ys(l.id,i.user?.id)]);C(y),S(E)}catch(y){console.error("Failed to check interaction status:",y)}})()},[i.id,l?.id,e,i.user?.id]),(0,_.useEffect)(()=>{o.current?.plyr&&(o.current.plyr.muted=s)},[s]),(0,_.useEffect)(()=>{const $=o.current?.plyr;if(!$||!e)return;const y=()=>{const E=$.currentTime,q=$.duration;q>0&&R(E/q*100)};if(typeof $.on=="function")return $.on("timeupdate",y),()=>{typeof $.off=="function"&&$.off("timeupdate",y)}},[e]);const P=$=>{$.stopPropagation();const y=$.currentTarget.getBoundingClientRect(),E=$.clientX-y.left,q=Math.min(Math.max(0,E/y.width),1),G=o.current?.plyr;G&&G.duration&&(G.currentTime=q*G.duration,R(q*100))};(0,_.useEffect)(()=>()=>{j.current&&clearTimeout(j.current)},[]);const I=$=>{const y=$.target;y.closest("button")||y.closest("a")||y.closest(".plyr__controls")||(j.current?(clearTimeout(j.current),j.current=null,D()):j.current=setTimeout(()=>{j.current=null,M()},250))},M=()=>{const $=o.current?.plyr;$&&($.paused?($.play().catch(()=>{}),h("play")):($.pause(),h("pause")),setTimeout(()=>h(null),800))},D=async()=>{if(l&&(g(!0),setTimeout(()=>g(!1),800),!w)){C(!0),N($=>$+1);try{await lt(i.id,l.id)}catch{C(!1),N($=>$-1)}}},A=async $=>{if($.stopPropagation(),!l)return;const y=!w;C(y),N(E=>y?E+1:E-1);try{await lt(i.id,l.id)}catch{C(!y),N(E=>y?E-1:E+1)}},L=async $=>{if($.stopPropagation(),!l)return;const y=!d;S(y);try{await ps(l.id,i.user?.id)}catch{S(!y)}},O=$=>{$.stopPropagation(),v(!0)},U=(0,_.useMemo)(()=>({source:{type:"video",sources:[{src:z,type:"video/mp4"}]},options:{controls:[],loop:{active:!0},clickToPlay:!1,ratio:"9:16",autoplay:!0,muted:!0,playsinline:!0}}),[z]);return(0,t.jsxs)("div",{"data-id":i.id,className:"reel-item relative flex h-[100dvh] w-full snap-start items-center justify-center overflow-hidden bg-black cursor-pointer select-none",onClick:I,children:[(0,t.jsxs)("div",{className:"relative flex h-full w-full max-w-[450px] items-center justify-center",children:[(0,t.jsx)("div",{className:"w-full",children:n?(0,t.jsx)(_.Suspense,{fallback:(0,t.jsx)("div",{className:"aspect-[9/16] w-full bg-zinc-900 animate-pulse"}),children:(0,t.jsx)(Ci,{ref:o,...U})}):(0,t.jsx)("div",{className:"aspect-[9/16] w-full bg-zinc-900",children:(0,t.jsx)("img",{src:i.media?.[0]?.preview||i.media?.[0]?.thumbnail||z,className:"h-full w-full object-cover opacity-50 blur-xl",alt:"Reel preview"})})}),!m&&(0,t.jsx)("div",{className:"absolute inset-0 z-[60] flex items-center justify-center bg-zinc-900",children:(0,t.jsx)(rs,{})}),(0,t.jsx)(ye,{children:c&&(0,t.jsx)(B.div,{initial:{scale:0,opacity:0},animate:{scale:[0,1.2,1],opacity:1},exit:{scale:1.5,opacity:0},transition:{duration:.5,type:"spring",stiffness:400,damping:20},className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)(he,{size:120,fill:"white",className:"text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.4)]"})})}),(0,t.jsx)(ye,{children:b&&(0,t.jsx)(B.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},transition:{duration:.4},className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"rounded-full border border-white/20 bg-white/10 p-8 shadow-2xl backdrop-blur-md",children:b==="play"?(0,t.jsx)(ts,{size:50,fill:"white",className:"ml-1.5 text-white"}):(0,t.jsx)(ls,{size:50,fill:"white",className:"text-white"})})})}),(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/60"}),(0,t.jsxs)("div",{className:"pointer-events-none absolute bottom-6 left-4 right-16 text-white",children:[(0,t.jsxs)("div",{className:"pointer-events-auto mb-3 flex items-center gap-2",children:[(0,t.jsxs)(Lt,{to:`/u/${i.user?.handle}`,className:"flex items-center gap-2 transition-opacity hover:opacity-80 active:scale-95",onClick:$=>$.stopPropagation(),children:[(0,t.jsxs)(Z,{className:"size-10 border-2 border-white",children:[(0,t.jsx)(Y,{src:i.user?.avatar,alt:i.user?.handle,className:"object-cover"}),(0,t.jsx)(ee,{children:i.user?.handle?.[0]?.toUpperCase()})]}),(0,t.jsxs)("span",{className:"font-bold",children:["@",i.user?.handle]})]}),l?.id!==i.user?.id&&(0,t.jsx)("button",{className:`ml-2 flex items-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-bold transition-all active:scale-95 ${d?"border border-white/50 bg-transparent text-white":"bg-white text-black hover:bg-zinc-200"}`,onClick:L,children:d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Cs,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Following"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ns,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Follow"})]})})]}),(0,t.jsx)(Fe,{content:i.content,className:"mb-3 line-clamp-2 text-sm text-white"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[(0,t.jsx)(is,{size:14,className:"animate-spin-slow"}),(0,t.jsxs)("span",{children:["Original Audio - ",i.user?.handle]})]})]}),(0,t.jsxs)("div",{className:"absolute bottom-6 right-2 z-10 flex flex-col items-center gap-6",children:[(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)(B.button,{whileTap:{scale:.8},className:`rounded-full p-3 backdrop-blur-md transition-all ${w?"bg-rose-500/20 text-rose-500":"bg-zinc-800/50 text-white hover:bg-zinc-700"}`,onClick:A,children:(0,t.jsx)(B.div,{animate:w?{scale:[1,1.3,1]}:{scale:1},transition:{duration:.3},children:(0,t.jsx)(he,{size:28,fill:w?"currentColor":"none"})})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:k})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)(B.button,{whileTap:{scale:.8},className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700",onClick:$=>{$.stopPropagation(),x(!0)},children:(0,t.jsx)(zt,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:i.stats?.comments||0})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)(B.button,{whileTap:{scale:.8},className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700",onClick:O,children:(0,t.jsx)(ue,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:i.stats?.shares||0})]}),(0,t.jsx)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:(0,t.jsx)(B.button,{whileTap:{scale:.8},className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-rose-500/20 hover:text-rose-500",onClick:$=>{$.stopPropagation(),r("reel",i.id)},children:(0,t.jsx)(ke,{size:28})})})]}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 z-50 h-[3px] w-full bg-white/20 hover:h-[8px] transition-all cursor-pointer group",onClick:P,children:(0,t.jsx)("div",{className:"h-full bg-white shadow-[0_0_8px_rgba(255,255,255,0.8)] transition-all duration-100 ease-linear relative",style:{width:`${F}%`},children:(0,t.jsx)("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 size-3 bg-white rounded-full shadow-lg scale-0 group-hover:scale-100 transition-transform"})})})]}),(0,t.jsx)(Si,{isOpen:u,onClose:()=>x(!1),reelId:i.id,currentUser:l,showToast:a}),(0,t.jsx)(_t,{isOpen:f,onClose:()=>v(!1),url:`${window.location.origin}/r/${i.id}`,title:"Share Reel"})]})},(i,e)=>i.isActive===e.isActive&&i.reel.id===e.reel.id&&i.isMuted===e.isMuted),Ai=_i,$i=({isOpen:i,onClose:e,reelId:s,currentUser:n,showToast:l})=>{const[a,r]=(0,_.useState)([]),[o,c]=(0,_.useState)(!1),[g,u]=(0,_.useState)(!1),[x,f]=(0,_.useState)(""),[v,m]=(0,_.useState)([]),[p,b]=(0,_.useState)(!1),[h,w]=(0,_.useState)(!0),[C,k]=(0,_.useState)(!1),[N,d]=(0,_.useState)(null),S=(0,_.useRef)(a);(0,_.useEffect)(()=>{S.current=a},[a]);const F=(0,_.useCallback)(async(j=!1)=>{if(s){j?k(!0):c(!0);try{const z=S.current,P=await vs(s,j&&z.length>0?z[z.length-1].created_at:null,10);P.length<10?w(!1):w(!0),r(j?I=>[...I,...P]:P)}catch(z){console.error("Failed to load comments:",z),l&&l("Failed to load comments","error")}finally{c(!1),k(!1)}}},[s,l]);(0,_.useEffect)(()=>{i&&s?F():(r([]),w(!0))},[i,s,F]);const R=async j=>{if(j.preventDefault(),!(!x.trim()&&v.length===0||!n)){u(!0),b(!0);try{const z=[];for(const P of v){const I=await Ce(P);z.push(I)}await $s(s,n.id,x,z,N?.id),f(""),m([]),d(null),l&&l("Reply posted!"),F()}catch(z){console.error("Failed to post comment:",z),l&&l("Failed to post reply.","error")}finally{u(!1),b(!1)}}};return(0,t.jsx)(kt,{isOpen:i,onClose:e,title:"Comments",className:"max-sm:h-[95dvh] h-[85vh] overflow-hidden !p-0 sm:max-w-xl",children:(0,t.jsxs)("div",{className:"flex h-full flex-col overflow-hidden bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"mx-auto my-3 h-1.5 w-12 shrink-0 rounded-full bg-zinc-200 dark:bg-zinc-800 sm:hidden"}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto scroll-smooth scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800",children:o?(0,t.jsx)("div",{className:"flex flex-col",children:[1,2,3].map(j=>(0,t.jsx)(ms,{},j))}):a.length>0?(0,t.jsxs)("div",{className:"flex flex-col",children:[a.map(j=>(0,t.jsx)(zi,{...j,isComment:!0,post_id:s,currentUser:n,showToast:l,onReply:(z,P)=>{d(P?{handle:z,id:P}:null),f(I=>I.includes(`@${z}`)?I:I+`@${z} `)},onDelete:z=>r(P=>P.filter(I=>I.id!==z)),onUpdate:(z,P,I)=>r(M=>M.map(D=>D.id===z?{...D,content:P,media:I}:D))},j.id)),h&&(0,t.jsx)("div",{className:"flex justify-center border-t border-zinc-100 py-4 dark:border-zinc-800",children:(0,t.jsx)(Nt,{variant:"ghost",onClick:()=>F(!0),loading:C,className:"text-violet-600 font-bold",children:"View more replies"})})]}):(0,t.jsxs)("div",{className:"flex h-full min-h-[300px] flex-col items-center justify-center p-8 text-center text-zinc-500",children:[(0,t.jsx)("div",{className:"mb-4 flex size-16 items-center justify-center rounded-full bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(bt,{size:32,className:"text-zinc-400"})}),(0,t.jsx)("p",{className:"text-lg font-bold dark:text-zinc-300",children:"No comments yet"}),(0,t.jsx)("p",{className:"text-sm dark:text-zinc-500",children:"Be the first to share what you think!"})]})}),(0,t.jsxs)("div",{className:"shrink-0 border-t border-zinc-100 bg-white pb-safe dark:border-zinc-800 dark:bg-zinc-900",children:[N&&(0,t.jsxs)("div",{className:"flex items-center justify-between border-b border-zinc-50 bg-zinc-50/50 px-4 py-2 dark:border-zinc-800/50 dark:bg-zinc-900/50",children:[(0,t.jsxs)("span",{className:"text-xs text-zinc-500",children:["Replying to"," ",(0,t.jsxs)("span",{className:"font-bold text-violet-600",children:["@",N.handle]})]}),(0,t.jsx)("button",{onClick:()=>d(null),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,t.jsx)(ne,{size:14})})]}),(0,t.jsx)(wt,{currentUser:n,newComment:x,setNewComment:f,handleSubmitComment:R,loading:g,selectedFiles:v,setSelectedFiles:m,isUploading:p})]})]})})},Si=$i,Li=W();export{zi as n,Ai as t};
