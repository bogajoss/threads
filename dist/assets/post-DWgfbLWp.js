import{n as et}from"./rolldown-runtime-2JzG8er9.js";import{f as pt,s as U,u as ft,w as ht,y as he}from"./framework-pMVb9Z5_.js";import{n as bt}from"./query-CYcBlx0y.js";import{$t as gt,At as jt,Ft as vt,Gt as zt,Ht as ee,Mt as Nt,Nt as kt,Rt as ce,Xt as yt,Yt as De,Zt as We,an as wt,en as Ct,gt as _t,jt as Pt,kt as ue,lt as pe,qt as de,rn as St,t as tt,tn as Oe,wt as $t,yt as Ft}from"./ui-libs-DQt2aSCK.js";import{$ as Ve,B as It,Bt as Mt,Et as Rt,I as Et,It as Lt,J as Ue,L as At,N as Dt,Ot as st,Pt as Be,Q as qe,R as K,Tt as it,Ut as Wt,Vt as oe,X as He,Y as Te,Z as Ge,ct as Ot,et as Qe,ft as Vt,i as Ut,it as T,lt as Bt,mt as qt,nt as G,ot as Ht,pt as fe,q as Tt,rt as Q,s as Gt,st as Qt,tt as Je,u as Xe,ut as Jt,z as Xt}from"./index-DSb82vdu.js";import{n as be,t as ge}from"./linkify-fXGRsD3N.js";import{d as Yt}from"./hooks-4XEyeo5_.js";var Zt=U(),p=et(ht(),1),t=et(ft(),1),Kt=s=>{const e=(0,Zt.c)(21),{icon:i,count:r,label:a,onClick:d,active:l,activeColorClass:c}=s,h=c===void 0?"text-violet-600":c,g=i;let o;e[0]!==d?(o=C=>{C.stopPropagation(),d&&d(C)},e[0]=d,e[1]=o):o=e[1];const u=`${a} ${r!==void 0?`(${r})`:""}`,n=`group flex items-center gap-x-1 sm:gap-x-1.5 text-[12px] sm:text-[13px] font-bold transition-all py-1.5 px-2 -ml-2 rounded-xl active:scale-95 ${l?h:"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"}`,m=`rounded-full p-2 transition-colors ${l?"":"group-hover:bg-zinc-100 dark:group-hover:bg-zinc-800"}`,x=l?2.5:2,z=l?"fill-current":"";let N;e[2]!==g||e[3]!==x||e[4]!==z?(N=(0,t.jsx)(g,{size:18,strokeWidth:x,className:z}),e[2]=g,e[3]=x,e[4]=z,e[5]=N):N=e[5];let v;e[6]!==m||e[7]!==N?(v=(0,t.jsx)("div",{className:m,children:N}),e[6]=m,e[7]=N,e[8]=v):v=e[8];let w;e[9]!==a?(w=a&&(0,t.jsx)("span",{className:"hidden xs:inline",children:a}),e[9]=a,e[10]=w):w=e[10];let j;e[11]!==l||e[12]!==r?(j=r!=null&&(0,t.jsx)("span",{className:l?"font-bold":"",children:r||0}),e[11]=l,e[12]=r,e[13]=j):j=e[13];let _;return e[14]!==w||e[15]!==j||e[16]!==o||e[17]!==u||e[18]!==n||e[19]!==v?(_=(0,t.jsxs)("button",{onClick:o,"aria-label":u,className:n,children:[v,w,j]}),e[14]=w,e[15]=j,e[16]=o,e[17]=u,e[18]=n,e[19]=v,e[20]=_):_=e[20],_},Y=Kt,es=U(),ts=s=>{const e=(0,es.c)(51),{currentUser:i,newComment:r,setNewComment:a,handleSubmitComment:d,loading:l,selectedFiles:c,setSelectedFiles:h,isUploading:g}=s;let o;e[0]!==c?(o=c===void 0?[]:c,e[0]=c,e[1]=o):o=e[1];const u=o,n=(0,p.useRef)(null);let m;e[2]!==h?(m=M=>{const O=Array.from(M.target.files);h&&h(B=>[...B,...O])},e[2]=h,e[3]=m):m=e[3];const x=m;let z;e[4]!==h?(z=M=>{h&&h(O=>O.filter((B,te)=>te!==M))},e[4]=h,e[5]=z):z=e[5];const N=z;if(!i){let M;return e[6]===Symbol.for("react.memo_cache_sentinel")?(M=(0,t.jsx)("div",{className:"p-6 text-center border-y border-zinc-100 dark:border-zinc-800 bg-zinc-50/30 dark:bg-zinc-900/10",children:(0,t.jsx)("p",{className:"text-zinc-500 text-sm",children:"Please login to join the conversation."})}),e[6]=M):M=e[6],M}let v;e[7]!==i.avatar||e[8]!==i.handle?(v=(0,t.jsx)(T,{src:i.avatar,alt:i.handle,className:"object-cover"}),e[7]=i.avatar,e[8]=i.handle,e[9]=v):v=e[9];let w;e[10]!==i.handle?.[0]?(w=i.handle?.[0]?.toUpperCase(),e[10]=i.handle?.[0],e[11]=w):w=e[11];let j;e[12]!==w?(j=(0,t.jsx)(Q,{children:w}),e[12]=w,e[13]=j):j=e[13];let _;e[14]!==v||e[15]!==j?(_=(0,t.jsxs)(G,{className:"size-9 border border-zinc-200 dark:border-zinc-700",children:[v,j]}),e[14]=v,e[15]=j,e[16]=_):_=e[16];let C;e[17]!==a?(C=M=>a(M.target.value),e[17]=a,e[18]=C):C=e[18];let F;e[19]!==r||e[20]!==C?(F=(0,t.jsx)("textarea",{id:"comment-input",className:"w-full bg-transparent outline-none text-base min-h-[60px] resize-none dark:text-white placeholder:text-zinc-500",placeholder:"Post your reply...",value:r,onChange:C}),e[19]=r,e[20]=C,e[21]=F):F=e[21];let R;e[22]!==N||e[23]!==u?(R=u.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-2 mb-2",children:u.map((M,O)=>(0,t.jsxs)("div",{className:"relative size-20 rounded-xl overflow-hidden border border-zinc-200 dark:border-zinc-800",children:[M.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(M),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"size-full flex items-center justify-center bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)(kt,{size:20,className:"text-zinc-500"})}),(0,t.jsx)("button",{onClick:()=>N(O),className:"absolute top-1 right-1 bg-black/60 text-white rounded-full p-1 hover:bg-black transition-colors",children:(0,t.jsx)(pe,{size:12})})]},O))}),e[22]=N,e[23]=u,e[24]=R):R=e[24];let E;e[25]===Symbol.for("react.memo_cache_sentinel")?(E=()=>n.current?.click(),e[25]=E):E=e[25];let I;e[26]===Symbol.for("react.memo_cache_sentinel")?(I=(0,t.jsx)("button",{type:"button",onClick:E,className:"text-violet-600 hover:bg-violet-50 dark:hover:bg-zinc-800 rounded-full p-2 transition-colors",title:"Attach media",children:(0,t.jsx)(zt,{size:20})}),e[26]=I):I=e[26];let L;e[27]!==x?(L=(0,t.jsxs)("div",{className:"flex text-violet-600 gap-1",children:[I,(0,t.jsx)("input",{type:"file",ref:n,onChange:x,multiple:!0,className:"hidden",accept:"image/*,video/*,application/pdf"})]}),e[27]=x,e[28]=L):L=e[28];let A;e[29]!==g||e[30]!==l||e[31]!==r||e[32]!==u.length?(A=!r.trim()&&u.length===0||l||g,e[29]=g,e[30]=l,e[31]=r,e[32]=u.length,e[33]=A):A=e[33];let V;e[34]!==g||e[35]!==l?(V=l||g?(0,t.jsx)(ee,{size:16,className:"animate-spin text-white mx-auto"}):"Reply",e[34]=g,e[35]=l,e[36]=V):V=e[36];let D;e[37]!==d||e[38]!==A||e[39]!==V?(D=(0,t.jsx)(Tt,{className:"!w-auto px-5 py-1.5 text-sm font-bold min-w-[70px]",onClick:d,disabled:A,children:V}),e[37]=d,e[38]=A,e[39]=V,e[40]=D):D=e[40];let b;e[41]!==L||e[42]!==D?(b=(0,t.jsxs)("div",{className:"flex justify-between items-center mt-2 pt-3 border-t border-zinc-100 dark:border-zinc-800",children:[L,D]}),e[41]=L,e[42]=D,e[43]=b):b=e[43];let y;e[44]!==F||e[45]!==R||e[46]!==b?(y=(0,t.jsxs)("div",{className:"flex-1",children:[F,R,b]}),e[44]=F,e[45]=R,e[46]=b,e[47]=y):y=e[47];let S;return e[48]!==y||e[49]!==_?(S=(0,t.jsx)("div",{className:"p-4 border-y border-zinc-100 dark:border-zinc-800 bg-zinc-50/30 dark:bg-zinc-900/10",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[_,y]})}),e[48]=y,e[49]=_,e[50]=S):S=e[50],S},at=ts,ss=U(),is=s=>{const e=(0,ss.c)(17),{file:i}=s;let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=(0,t.jsx)("div",{className:"size-10 rounded-xl bg-violet-100 dark:bg-violet-900/30 flex items-center justify-center text-violet-600",children:(0,t.jsx)(gt,{size:20})}),e[0]=r):r=e[0];let a;e[1]!==i.name?(a=(0,t.jsx)("div",{className:"text-sm font-bold truncate dark:text-white",children:i.name}),e[1]=i.name,e[2]=a):a=e[2];const d=i.size/1024/1024;let l;e[3]!==d?(l=d.toFixed(2),e[3]=d,e[4]=l):l=e[4];let c;e[5]!==l?(c=(0,t.jsxs)("div",{className:"text-xs text-zinc-500 uppercase",children:[l," MB"]}),e[5]=l,e[6]=c):c=e[6];let h;e[7]!==a||e[8]!==c?(h=(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[a,c]}),e[7]=a,e[8]=c,e[9]=h):h=e[9];let g;e[10]===Symbol.for("react.memo_cache_sentinel")?(g=(0,t.jsx)(St,{size:18}),e[10]=g):g=e[10];let o;e[11]!==i.name||e[12]!==i.url?(o=(0,t.jsx)("a",{href:i.url,download:i.name,className:"p-2 text-zinc-400 hover:text-violet-600 transition-colors",onClick:ns,children:g}),e[11]=i.name,e[12]=i.url,e[13]=o):o=e[13];let u;return e[14]!==h||e[15]!==o?(u=(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-3 p-3 rounded-2xl border border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/10 group hover:border-violet-500/30 transition-colors",children:[r,h,o]}),e[14]=h,e[15]=o,e[16]=u):u=e[16],u},as=is;function ns(s){return s.stopPropagation()}var Os=U(),ls=U(),rs=s=>{const e=(0,ls.c)(30),{url:i}=s;let r,a;e[0]!==i?(r=["link-preview",i],a=()=>qt(i),e[0]=i,e[1]=r,e[2]=a):(r=e[1],a=e[2]);const d=!!i;let l;e[3]!==r||e[4]!==a||e[5]!==d?(l={queryKey:r,queryFn:a,staleTime:864e5,enabled:d},e[3]=r,e[4]=a,e[5]=d,e[6]=l):l=e[6];const{data:c,isLoading:h,isError:g}=bt(l);if(h){let j;return e[7]===Symbol.for("react.memo_cache_sentinel")?(j=(0,t.jsx)("div",{className:"mt-3 rounded-2xl border border-zinc-100 dark:border-zinc-800 overflow-hidden animate-pulse bg-zinc-50 dark:bg-zinc-900/50 h-24 flex items-center justify-center",children:(0,t.jsx)(De,{className:"text-zinc-300 dark:text-zinc-700 animate-spin",size:24})}),e[7]=j):j=e[7],j}if(g||!c||!c.title&&!c.image)return null;let o;e[8]!==c.image||e[9]!==c.title?(o=c.image&&(0,t.jsx)("div",{className:"w-full aspect-[1.91/1] overflow-hidden bg-zinc-100 dark:bg-zinc-900 border-b border-zinc-100 dark:border-zinc-800",children:(0,t.jsx)("img",{src:c.image,alt:c.title,className:"w-full h-full object-cover group-hover:scale-[1.02] transition-transform duration-500",onError:cs})}),e[8]=c.image,e[9]=c.title,e[10]=o):o=e[10];let u;e[11]===Symbol.for("react.memo_cache_sentinel")?(u=(0,t.jsx)(De,{size:12}),e[11]=u):u=e[11];let n;e[12]!==c.siteName?(n=(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-zinc-600 font-bold uppercase tracking-wider",children:[u,(0,t.jsx)("span",{children:c.siteName})]}),e[12]=c.siteName,e[13]=n):n=e[13];let m;e[14]!==c.title?(m=(0,t.jsx)("div",{className:"font-bold text-[15px] line-clamp-2 dark:text-white leading-snug group-hover:text-violet-700 transition-colors",children:c.title}),e[14]=c.title,e[15]=m):m=e[15];let x;e[16]!==c.description?(x=c.description&&(0,t.jsx)("p",{className:"text-xs text-zinc-600 dark:text-zinc-400 line-clamp-2 leading-relaxed",children:c.description}),e[16]=c.description,e[17]=x):x=e[17];let z;e[18]===Symbol.for("react.memo_cache_sentinel")?(z=(0,t.jsx)(Ct,{size:10}),e[18]=z):z=e[18];let N;e[19]!==i?(N=(0,t.jsxs)("div",{className:"pt-1 flex items-center gap-1 text-[11px] text-zinc-500 font-medium",children:[z,(0,t.jsx)("span",{className:"truncate",children:i})]}),e[19]=i,e[20]=N):N=e[20];let v;e[21]!==N||e[22]!==n||e[23]!==m||e[24]!==x?(v=(0,t.jsxs)("div",{className:"p-3.5 space-y-1",children:[n,m,x,N]}),e[21]=N,e[22]=n,e[23]=m,e[24]=x,e[25]=v):v=e[25];let w;return e[26]!==v||e[27]!==o||e[28]!==i?(w=(0,t.jsxs)("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"mt-3 flex flex-col rounded-2xl border border-zinc-100 dark:border-zinc-800 overflow-hidden bg-white dark:bg-zinc-950 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-all group shadow-sm",onClick:os,children:[o,v]}),e[26]=v,e[27]=o,e[28]=i,e[29]=w):w=e[29],w},Ye=rs;function os(s){return s.stopPropagation()}function cs(s){return s.target.style.display="none"}var ds=U(),ms=s=>{const e=(0,ds.c)(17),{src:i,poster:r}=s,a=(0,p.useRef)(null),{reportVisibility:d,unregister:l}=Ht(),{dataSaver:c}=Jt(),h=(0,p.useId)();let g;e[0]===Symbol.for("react.memo_cache_sentinel")?(g={play:()=>{const j=a.current?.plyr;j&&(j.muted=!0,j.play().catch(us))},pause:()=>{a.current?.plyr?.pause()}},e[0]=g):g=e[0];const o=g;let u,n;e[1]!==c||e[2]!==h||e[3]!==d||e[4]!==l?(u=()=>{const j=new IntersectionObserver(C=>{const[F]=C;d(h,c?0:F.intersectionRatio,o)},{threshold:[0,.6]}),_=a.current?.elements?.container;return _&&j.observe(_),()=>{l(h),_&&j.unobserve(_)}},n=[h,d,l,o,c],e[1]=c,e[2]=h,e[3]=d,e[4]=l,e[5]=u,e[6]=n):(u=e[5],n=e[6]),(0,p.useEffect)(u,n);let m;e[7]!==i?(m=[{src:i,type:"video/mp4"}],e[7]=i,e[8]=m):m=e[8];let x;e[9]!==r||e[10]!==m?(x={type:"video",sources:m,poster:r},e[9]=r,e[10]=m,e[11]=x):x=e[11];let z;e[12]===Symbol.for("react.memo_cache_sentinel")?(z={controls:["play-large","play","progress","current-time","mute","volume","fullscreen"],settings:["quality","speed"],ratio:"16:9",clickToPlay:!0,hideControls:!0,resetOnEnd:!0},e[12]=z):z=e[12];let N;e[13]!==x?(N={source:x,options:z},e[13]=x,e[14]=N):N=e[14];const v=N;let w;return e[15]!==v?(w=(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl shadow-sm border border-zinc-100 dark:border-zinc-800 bg-black",onClick:ps,children:(0,t.jsx)(tt,{ref:a,...v})}),e[15]=v,e[16]=w):w=e[16],w},xs=ms;function us(){}function ps(s){return s.stopPropagation()}var fs=U(),hs=s=>{const e=(0,fs.c)(3),{items:i}=s,r=i===void 0?[]:i,{openLightbox:a}=Qt();if(!r||r.length===0)return null;const d=Array.isArray(r)?r:[r],l=d.filter(gs),c=d.filter(js),h=m=>{const x=l.filter(vs).map(zs),z=l[m];a(x,x.indexOf(z.url||z.src))},g="mt-3 space-y-2",o=l.length>0&&(0,t.jsx)("div",{className:`grid gap-2 rounded-2xl overflow-hidden border border-zinc-100 dark:border-zinc-800 ${l.length===1?"grid-cols-1":l.length===2?"grid-cols-2 aspect-[16/9]":(l.length===3,"grid-cols-2 grid-rows-2 aspect-[16/9]")}`,children:l.map((m,x)=>(0,t.jsx)("div",{className:`relative overflow-hidden bg-zinc-100 dark:bg-zinc-900 cursor-pointer ${l.length===3&&x===0?"row-span-2":""}`,onClick:z=>{m.type==="image"&&(z.stopPropagation(),h(x))},children:m.type==="video"?(0,t.jsx)(xs,{src:m.url,poster:m.poster}):(0,t.jsx)("img",{src:m.url||m.src,className:"size-full object-cover hover:scale-[1.02] transition-transform duration-500",alt:"",loading:"lazy"})},x))}),u=c.map(Ns);let n;return e[0]!==o||e[1]!==u?(n=(0,t.jsxs)("div",{className:g,children:[o,u]}),e[0]=o,e[1]=u,e[2]=n):n=e[2],n},bs=hs;function gs(s){return s.type==="image"||s.type==="video"}function js(s){return s.type==="file"}function vs(s){return s.type==="image"}function zs(s){return s.url||s.src}function Ns(s,e){return(0,t.jsx)(as,{file:s},e)}var ks=U(),ys=s=>{const e=(0,ks.c)(18),{poll:i,onVote:r}=s,a=i.options.reduce(ws,0),[d,l]=(0,p.useState)(null);let c;e[0]!==r||e[1]!==d?(c=x=>{d||(l(x),r&&r(x))},e[0]=r,e[1]=d,e[2]=c):c=e[2];const h=c;let g;if(e[3]!==h||e[4]!==i.options||e[5]!==a||e[6]!==d){let x;e[8]!==h||e[9]!==a||e[10]!==d?(x=(z,N)=>{const v=a>0?Math.round((z.votes+(d===z.id?1:0))/(a+(d?1:0))*100):0,w=d===z.id;return(0,t.jsxs)("div",{onClick:j=>{j.stopPropagation(),h(z.id)},className:`relative h-10 w-full rounded-xl overflow-hidden cursor-pointer border ${w?"border-violet-500 dark:border-violet-500":"border-zinc-200 dark:border-zinc-700"}`,children:[d&&(0,t.jsx)("div",{className:"absolute top-0 left-0 h-full bg-zinc-200 dark:bg-zinc-800 transition-all duration-500",style:{width:`${v}%`}}),(0,t.jsxs)("div",{className:"absolute inset-0 flex items-center justify-between px-4 z-10",children:[(0,t.jsxs)("span",{className:`font-medium text-sm ${w?"text-violet-600 font-bold":"text-zinc-700 dark:text-zinc-200"}`,children:[z.text," ",w&&(0,t.jsx)(wt,{size:14,className:"inline ml-1 mb-0.5"})]}),d&&(0,t.jsxs)("span",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:[v,"%"]})]})]},z.id||N)},e[8]=h,e[9]=a,e[10]=d,e[11]=x):x=e[11],g=i.options.map(x),e[3]=h,e[4]=i.options,e[5]=a,e[6]=d,e[7]=g}else g=e[7];const o=a+(d?1:0),u=d?"6 days left":"Click to vote";let n;e[12]!==o||e[13]!==u?(n=(0,t.jsxs)("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 pl-1",children:[o," votes â€¢"," ",u]}),e[12]=o,e[13]=u,e[14]=n):n=e[14];let m;return e[15]!==g||e[16]!==n?(m=(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[g,n]}),e[15]=g,e[16]=n,e[17]=m):m=e[17],m},Ze=ys;function ws(s,e){return s+e.votes}var nt=({id:s,user:e,timeAgo:i,content:r,contentClass:a,media:d,quotedPost:l,stats:c,onClick:h,repostedBy:g,onUserClick:o,currentUser:u,showToast:n,poll:m,isDetail:x,initialComments:z,onDelete:N,isComment:v,onReply:w,community:j})=>{const _=he(),{liked:C,reposted:F,localStats:R,setLocalStats:E,handleLike:I,handleRepost:L}=Yt(s,c,u,n),{deletePost:A,updatePost:V}=Ot(),[D,b]=(0,p.useState)(z||[]),[y,S]=(0,p.useState)(""),[M,O]=(0,p.useState)(!1),[B,te]=(0,p.useState)(!1),[je,ve]=(0,p.useState)(!1),[lt,ze]=(0,p.useState)(!0),[me,Ne]=(0,p.useState)([]),[rt,ke]=(0,p.useState)(!1),[ye,se]=(0,p.useState)(!1),[xe,ie]=(0,p.useState)(!1),[J,we]=(0,p.useState)(r),[Z,Ce]=(0,p.useState)(d||[]),[ae,ne]=(0,p.useState)([]),[_e,Pe]=(0,p.useState)(!1),[le,ot]=(0,p.useState)(!1),Se=(0,p.useRef)(null),$e=(0,p.useRef)(D);(0,p.useEffect)(()=>{$e.current=D},[D]);const ct=async()=>{const f=JSON.stringify(Z)!==JSON.stringify(d||[])||ae.length>0;if(!J.trim()||J===r&&!f){ie(!1);return}Pe(!0);try{const k=[];for(const P of ae){const $=await fe(P);k.push($)}await V(s,{content:J,media:[...Z,...k]}),ne([]),ie(!1),n&&n("Post updated")}catch(k){console.error("Failed to update post:",k),n&&n("Failed to update post")}finally{Pe(!1)}},Fe=async f=>{f&&f.stopPropagation();try{await A(s),n&&n("Post deleted successfully"),N&&N(s)}catch(k){console.error("Failed to delete post:",k),n&&n("Failed to delete post")}finally{se(!1)}},re=(0,p.useCallback)(async(f=!1)=>{if(s){f?ve(!0):O(!0);try{const k=$e.current,P=await st(s,f&&k.length>0?k[k.length-1].created_at:null,10);P.length<10?ze(!1):ze(!0),b(f?$=>[...$,...P]:P)}catch(k){console.error("Failed to load comments:",k)}finally{O(!1),ve(!1)}}},[s]);(0,p.useEffect)(()=>{x&&s&&re()},[x,s,re]);const dt=async f=>{if(f.preventDefault(),!(!y.trim()&&me.length===0||!u)){te(!0),ke(!0);try{const k=[];for(const P of me){const $=await fe(P);k.push($)}await it(s,u.id,y,k),S(""),Ne([]),E(P=>({...P,comments:(P.comments||0)+1})),n&&n("Reply posted!"),re()}catch(k){console.error("Failed to post comment:",k),n&&n("Failed to post reply.")}finally{te(!1),ke(!1)}}},mt=f=>{f.stopPropagation();const k=`${window.location.origin}/post/${s}`;navigator.clipboard.writeText(k),n&&n("Link copied to clipboard!")},Ie=({trigger:f})=>(0,t.jsxs)(Et,{children:[(0,t.jsx)(It,{asChild:!0,onClick:k=>k.stopPropagation(),children:f}),(0,t.jsxs)(At,{align:"end",className:"w-48 rounded-xl bg-white dark:bg-zinc-900 border-zinc-100 dark:border-zinc-800",children:[(0,t.jsxs)(K,{className:"gap-2 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-800 py-2.5",onClick:mt,children:[(0,t.jsx)(Gt,{size:16}),(0,t.jsx)("span",{children:"Copy link to post"})]}),!v&&(0,t.jsxs)(K,{className:"gap-2 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-800 py-2.5",onClick:k=>{k.stopPropagation(),n&&n("Post reported")},children:[(0,t.jsx)(yt,{size:16}),(0,t.jsx)("span",{children:"Report post"})]}),!Me&&(0,t.jsxs)(K,{className:"gap-2 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-800 py-2.5 text-rose-500 focus:text-rose-500",onClick:k=>{k.stopPropagation(),n&&n("User blocked")},children:[(0,t.jsx)(_t,{size:16}),(0,t.jsxs)("span",{children:["Block @",e.handle]})]}),Me&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Xt,{className:"bg-zinc-100 dark:border-zinc-800"}),(0,t.jsxs)(K,{onClick:()=>ie(!0),className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)(Ut,{size:16}),"Edit Post"]}),(0,t.jsxs)(K,{className:"gap-2 cursor-pointer focus:bg-rose-50 dark:focus:bg-rose-900/20 py-2.5 text-rose-500 focus:text-rose-500",onClick:k=>{k.stopPropagation(),se(!0)},children:[(0,t.jsx)(Ft,{size:16}),(0,t.jsx)("span",{children:"Delete post"})]})]})]})]}),Me=u?.handle===e.handle,Re=f=>{if(!f)return null;const k=xe?Z:f;return!k||Array.isArray(k)&&k.length===0?null:xe?(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,t.jsxs)("div",{className:"grid gap-2 grid-cols-2 sm:grid-cols-3",children:[Z.map((P,$)=>(0,t.jsxs)("div",{className:"relative aspect-square rounded-xl overflow-hidden border border-zinc-200 dark:border-zinc-800 group",children:[P.type==="video"?(0,t.jsx)("div",{className:"size-full bg-zinc-100 dark:bg-zinc-900 flex items-center justify-center",children:(0,t.jsx)(We,{size:24,className:"text-zinc-400"})}):(0,t.jsx)("img",{src:P.url||P.src,className:"size-full object-cover",alt:""}),(0,t.jsx)("button",{onClick:q=>{q.stopPropagation(),Ce(H=>H.filter((X,W)=>W!==$))},className:"absolute top-1.5 right-1.5 size-7 rounded-full bg-black/60 text-white flex items-center justify-center hover:bg-black transition-colors",children:(0,t.jsx)(pe,{size:16})})]},`old-${$}`)),ae.map((P,$)=>(0,t.jsxs)("div",{className:"relative aspect-square rounded-xl overflow-hidden border-2 border-dashed border-violet-500 bg-violet-50/10 group",children:[P.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(P),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"size-full flex items-center justify-center",children:(0,t.jsx)(We,{size:24,className:"text-violet-500 animate-pulse"})}),(0,t.jsx)("button",{onClick:q=>{q.stopPropagation(),ne(H=>H.filter((X,W)=>W!==$))},className:"absolute top-1.5 right-1.5 size-7 rounded-full bg-black/60 text-white flex items-center justify-center hover:bg-black transition-colors",children:(0,t.jsx)(pe,{size:16})}),(0,t.jsx)("div",{className:"absolute bottom-1 left-1 bg-violet-600 text-white text-[8px] font-bold px-1 rounded",children:"NEW"})]},`new-${$}`)),Z.length+ae.length<4&&(0,t.jsxs)("button",{onClick:P=>{P.stopPropagation(),Se.current?.click()},className:"relative aspect-square rounded-xl border-2 border-dashed border-zinc-200 dark:border-zinc-800 flex flex-col items-center justify-center gap-1 text-zinc-400 hover:text-violet-500 hover:border-violet-500 hover:bg-violet-50/5 transition-all",children:[(0,t.jsx)(jt,{size:20}),(0,t.jsx)("span",{className:"text-[10px] font-bold",children:"Add Media"})]})]}),(0,t.jsx)("input",{type:"file",ref:Se,onChange:P=>{const $=Array.from(P.target.files);ne(q=>[...q,...$])},multiple:!0,className:"hidden",accept:"image/*,video/*"})]}):p.isValidElement(k)?k:(0,t.jsx)(bs,{items:k})},Ee=(f,k)=>{const P=typeof f=="string"&&Wt(f);if(xe)return(0,t.jsxs)("div",{className:"flex flex-col gap-2 mt-2",onClick:$=>$.stopPropagation(),children:[(0,t.jsx)(Textarea,{value:J,onChange:$=>we($.target.value),className:`min-h-[100px] w-full bg-zinc-50 dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800 rounded-xl focus:ring-violet-500 ${P?"font-bangla text-lg":"font-english"}`,autoFocus:!0}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)("button",{onClick:()=>{ie(!1),we(r),Ce(d||[]),ne([])},className:"px-4 py-1.5 text-sm font-bold text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300 transition-colors",children:"Cancel"}),(0,t.jsx)("button",{onClick:ct,disabled:_e||!J.trim()||J===r,className:"px-4 py-1.5 text-sm font-bold bg-violet-600 text-white rounded-full hover:bg-violet-700 disabled:opacity-50 transition-all active:scale-95",children:_e?"Saving...":"Save"})]})]});if(typeof f=="string"){const $=!x&&f.length>280,q=$&&!le?f.substring(0,280):f;return(0,t.jsxs)("div",{className:`whitespace-pre-line ${k||""} ${P?"font-bangla text-[1.15em] leading-relaxed":"font-english text-[1.05em]"}`,children:[(0,t.jsx)(be,{options:{...ge,render:({attributes:H,content:X})=>{const{href:W,...Le}=H,Ae=!W.startsWith("/")&&(W.startsWith("http")||W.startsWith("www"));return W.startsWith("/u/")||W.startsWith("/tags/")||W.startsWith("/c/")||W.startsWith("/explore")?(0,t.jsx)("span",{...Le,onClick:ut=>{ut.stopPropagation(),_(W)},children:X},X):(0,t.jsx)("a",{href:W,...Le,target:Ae?"_blank":void 0,rel:Ae?"noopener noreferrer":void 0,children:X},X)}},children:q}),$&&!le&&"...",$&&(0,t.jsx)("button",{onClick:H=>{H.stopPropagation(),ot(!le)},className:"ml-1 text-rose-600 dark:text-rose-400 font-bold hover:underline cursor-pointer",children:le?"Show less":"See more"})]})}return f},xt=f=>{S(k=>{const P=`@${f} `;return k.includes(P)?k:k+P}),document.getElementById("comment-input")?.focus()};return x?(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("article",{className:"p-5 dark:bg-black",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsx)("button",{className:"shrink-0",onClick:()=>o&&o(e.handle),children:(0,t.jsxs)(G,{className:"size-12 border border-zinc-200 dark:border-zinc-700",children:[(0,t.jsx)(T,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(Q,{children:e.handle[0]?.toUpperCase()})]})}),(0,t.jsxs)("div",{className:"flex flex-col min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 min-w-0 max-w-full",children:[(0,t.jsxs)("button",{className:"font-bold text-base sm:text-lg hover:underline text-zinc-900 dark:text-white flex items-center gap-1 shrink-0",onClick:()=>o&&o(e.handle),children:[(0,t.jsx)("span",{className:"max-w-[200px] sm:max-w-none truncate",children:e.handle}),e.verified&&(0,t.jsx)(Xe,{size:16,className:"text-blue-500"})]}),j&&(0,t.jsxs)("div",{className:"flex items-center gap-1 min-w-0 text-zinc-500",children:[(0,t.jsx)("span",{className:"text-zinc-400 font-medium shrink-0 text-xs sm:text-sm",children:">"}),(0,t.jsxs)("button",{className:"flex items-center gap-1 font-bold text-zinc-900 dark:text-zinc-100 hover:underline text-[14px] sm:text-[15px]",onClick:f=>{f.stopPropagation(),_(`/c/${j.handle}`)},children:[(0,t.jsxs)(G,{className:"size-4 bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shrink-0",children:[(0,t.jsx)(T,{src:j.avatar,alt:j.name,className:"object-cover"}),(0,t.jsx)(Q,{className:"text-[8px] font-bold text-zinc-500",children:j.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"truncate max-w-[200px] sm:max-w-none",children:j.name})]})]})]})}),(0,t.jsxs)("span",{className:"text-xs sm:text-sm text-zinc-500 dark:text-zinc-400 font-medium",children:["@",e.handle]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 -mt-1",children:[(0,t.jsx)("span",{className:"text-zinc-500 dark:text-zinc-400 text-[13px] sm:text-sm whitespace-nowrap",children:i||"Recent"}),(0,t.jsx)(Ie,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"text-zinc-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full p-2 transition-colors",children:(0,t.jsx)(Oe,{size:20})})})]})]}),(0,t.jsx)("div",{className:"break-words text-zinc-900 dark:text-zinc-100 mt-4 text-lg sm:text-xl leading-relaxed sm:leading-8 whitespace-pre-line",children:Ee(r,a)}),oe(r)&&(0,t.jsx)(Ye,{url:oe(r)}),Re(d),m&&(0,t.jsx)(Ze,{poll:m}),l&&(0,t.jsx)("div",{className:"mt-4 border border-zinc-200 dark:border-zinc-700 rounded-2xl overflow-hidden shadow-sm",children:(0,t.jsx)(Ke,{...l})}),(0,t.jsxs)("div",{className:"border-b border-zinc-100 dark:border-zinc-800 pb-4 mt-4 flex items-center gap-x-6 text-zinc-500 dark:text-zinc-400 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:R.likes||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Likes"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:R.comments||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Comments"})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex w-full items-center justify-around py-1",children:[(0,t.jsx)(Y,{icon:de,label:"Like",onClick:I,active:C,activeColorClass:"text-rose-500"}),!v&&(0,t.jsx)(Y,{icon:ue,label:"Repost",onClick:L,active:F,activeColorClass:"text-emerald-500"}),(0,t.jsx)(Y,{icon:ce,label:"Comment",onClick:()=>document.getElementById("comment-input")?.focus()})]})]}),(0,t.jsx)(at,{currentUser:u,newComment:y,setNewComment:S,handleSubmitComment:dt,loading:B,selectedFiles:me,setSelectedFiles:Ne,isUploading:rt}),(0,t.jsx)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:M?(0,t.jsx)("div",{className:"p-8 flex justify-center",children:(0,t.jsx)(ee,{className:"animate-spin text-violet-500"})}):(0,t.jsxs)(t.Fragment,{children:[lt&&D.length>0&&(0,t.jsxs)("button",{onClick:()=>re(!0),disabled:je,className:"w-full py-3 text-sm font-bold text-violet-600 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-colors flex items-center justify-center gap-2",children:[je&&(0,t.jsx)(ee,{size:14,className:"animate-spin"}),"View more replies"]}),D.map(f=>(0,t.jsx)(nt,{...f,isComment:!0,onReply:xt,onUserClick:o,currentUser:u,showToast:n,onDelete:k=>b(P=>P.filter($=>$.id!==k))},f.id))]})}),(0,t.jsx)(Ue,{open:ye,onOpenChange:se,children:(0,t.jsxs)(Ge,{onClick:f=>f.stopPropagation(),children:[(0,t.jsxs)(Qe,{children:[(0,t.jsx)(Je,{children:"Are you absolutely sure?"}),(0,t.jsx)(qe,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(Ve,{children:[(0,t.jsx)(He,{onClick:f=>f.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Te,{onClick:Fe,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]}):(0,t.jsxs)("article",{onClick:h,className:`p-4 transition-all ${v?"bg-transparent border-b border-zinc-100/50 dark:border-zinc-800/50 hover:bg-zinc-50/50 dark:hover:bg-zinc-800/30 last:border-0":"mb-4 bg-white dark:bg-black rounded-xl hover:shadow-md"} ${h?"cursor-pointer":""}`,children:[g&&(0,t.jsxs)("div",{className:"mb-2 flex items-center space-x-1.5 text-[13px] text-zinc-600 font-semibold ml-1",children:[(0,t.jsx)(ue,{size:14,className:"text-zinc-500"}),(0,t.jsx)("span",{className:"hover:underline cursor-pointer flex items-center text-zinc-700 dark:text-zinc-300",onClick:f=>{f.stopPropagation(),o&&o(g.handle)},children:(0,t.jsx)("span",{className:"truncate max-w-[150px]",children:typeof g=="object"?g.name:g})}),(0,t.jsx)("span",{className:"text-zinc-500",children:"reposted"})]}),(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsx)("button",{className:"shrink-0 group",onClick:f=>{f.stopPropagation(),o&&o(e.handle)},children:(0,t.jsxs)(G,{className:"size-11 border border-zinc-200 dark:border-zinc-700 group-hover:brightness-95 transition-all",children:[(0,t.jsx)(T,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(Q,{children:e.handle[0]?.toUpperCase()})]})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex w-full items-start justify-between",children:[(0,t.jsx)("div",{className:"flex flex-col min-w-0 flex-1",children:(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 min-w-0 max-w-full",children:[(0,t.jsxs)("button",{className:"font-bold text-[15px] hover:underline text-zinc-900 dark:text-white flex items-center gap-1 shrink-0",onClick:f=>{f.stopPropagation(),o&&o(e.handle)},children:[(0,t.jsx)("span",{className:"truncate max-w-[160px] sm:max-w-none",children:e.handle}),e.verified&&(0,t.jsx)(Xe,{size:16,className:"text-blue-500"})]}),j&&(0,t.jsxs)("div",{className:"flex items-center gap-1 min-w-0 text-zinc-500",children:[(0,t.jsx)("span",{className:"text-zinc-400 font-medium shrink-0 text-xs sm:text-sm",children:">"}),(0,t.jsxs)("button",{className:"flex items-center gap-1 font-bold text-zinc-900 dark:text-zinc-100 hover:underline text-[14px] sm:text-[15px] min-w-0",onClick:f=>{f.stopPropagation(),_(`/c/${j.handle}`)},children:[(0,t.jsxs)(G,{className:"size-4 bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shrink-0",children:[(0,t.jsx)(T,{src:j.avatar,alt:j.name,className:"object-cover"}),(0,t.jsx)(Q,{className:"text-[8px] font-bold text-zinc-500",children:j.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"truncate max-w-[160px] md:max-w-none",children:j.name})]})]})]})})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 -mt-1",children:[(0,t.jsx)("span",{className:"text-zinc-500 dark:text-zinc-400 text-[13px] sm:text-sm whitespace-nowrap",children:i||"Recent"}),(0,t.jsx)(Ie,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"text-zinc-500 hover:bg-zinc-100 hover:text-zinc-700 dark:hover:bg-zinc-800 dark:hover:text-zinc-200 rounded-full p-2 -mr-2 transition-colors",children:(0,t.jsx)(Oe,{size:18})})})]})]}),(0,t.jsxs)("div",{className:"break-words text-zinc-900 dark:text-zinc-100 mt-1 whitespace-pre-line text-sm sm:text-[15px] leading-relaxed",children:[Ee(r,a),oe(r)&&(0,t.jsx)(Ye,{url:oe(r)}),Re(d),m&&(0,t.jsx)(Ze,{poll:m,onVote:()=>n&&n("Voted!")}),l&&(0,t.jsx)("div",{className:"mt-3 border border-zinc-200 dark:border-zinc-700 rounded-2xl overflow-hidden bg-white dark:bg-zinc-900 hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors cursor-pointer",onClick:f=>f.stopPropagation(),children:(0,t.jsx)(Ke,{...l})})]}),(0,t.jsx)("div",{className:"mt-3 flex w-full flex-wrap items-center justify-between gap-3 pr-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-x-6 sm:gap-x-8",children:[(0,t.jsx)(Y,{icon:de,label:"Like",count:R.likes,active:C,onClick:I,activeColorClass:"text-rose-500"}),!v&&(0,t.jsx)(Y,{icon:ue,label:"Repost",count:R.mirrors,active:F,onClick:L,activeColorClass:"text-emerald-500"}),(0,t.jsx)(Y,{icon:ce,label:"Comment",count:R.comments,onClick:f=>{v&&w?(f.stopPropagation(),w(e.handle)):h&&h(f)}})]})})]})]}),(0,t.jsx)(Ue,{open:ye,onOpenChange:se,children:(0,t.jsxs)(Ge,{onClick:f=>f.stopPropagation(),children:[(0,t.jsxs)(Qe,{children:[(0,t.jsx)(Je,{children:"Are you absolutely sure?"}),(0,t.jsx)(qe,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(Ve,{children:[(0,t.jsx)(He,{onClick:f=>f.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Te,{onClick:Fe,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})},Cs=nt,_s=U(),Ps=s=>{const e=(0,_s.c)(30),{user:i,time:r,content:a}=s,d=he();let l;e[0]!==i.avatar||e[1]!==i.handle?(l=(0,t.jsx)(T,{src:i.avatar,alt:i.handle}),e[0]=i.avatar,e[1]=i.handle,e[2]=l):l=e[2];let c;e[3]!==i.handle[0]?(c=i.handle[0]?.toUpperCase(),e[3]=i.handle[0],e[4]=c):c=e[4];let h;e[5]!==c?(h=(0,t.jsx)(Q,{children:c}),e[5]=c,e[6]=h):h=e[6];let g;e[7]!==l||e[8]!==h?(g=(0,t.jsxs)(G,{className:"size-6",children:[l,h]}),e[7]=l,e[8]=h,e[9]=g):g=e[9];let o;e[10]!==i.handle?(o=(0,t.jsx)("span",{className:"font-semibold text-sm",children:i.handle}),e[10]=i.handle,e[11]=o):o=e[11];let u;e[12]!==g||e[13]!==o?(u=(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[g,o]}),e[12]=g,e[13]=o,e[14]=u):u=e[14];let n;e[15]!==r?(n=(0,t.jsx)("span",{className:"text-zinc-500 text-xs sm:text-sm",children:r}),e[15]=r,e[16]=n):n=e[16];let m;e[17]!==u||e[18]!==n?(m=(0,t.jsxs)("div",{className:"flex items-center justify-between gap-x-2 mb-2",children:[u,n]}),e[17]=u,e[18]=n,e[19]=m):m=e[19];let x;e[20]!==d?(x={...ge,render:w=>{const{attributes:j,content:_}=w,{href:C,...F}=j,R=!C.startsWith("/")&&(C.startsWith("http")||C.startsWith("www"));return C.startsWith("/u/")||C.startsWith("/tags/")||C.startsWith("/c/")||C.startsWith("/explore")?(0,t.jsx)("span",{...F,onClick:E=>{E.stopPropagation(),d(C)},children:_},_):(0,t.jsx)("a",{href:C,...F,target:R?"_blank":void 0,rel:R?"noopener noreferrer":void 0,onClick:Ss,children:_},_)}},e[20]=d,e[21]=x):x=e[21];let z;e[22]!==a?(z=(0,t.jsx)("p",{className:"text-sm text-zinc-800 dark:text-zinc-300 whitespace-pre-line",children:a}),e[22]=a,e[23]=z):z=e[23];let N;e[24]!==z||e[25]!==x?(N=(0,t.jsx)(be,{options:x,children:z}),e[24]=z,e[25]=x,e[26]=N):N=e[26];let v;return e[27]!==N||e[28]!==m?(v=(0,t.jsxs)("div",{className:"p-4",children:[m,N]}),e[27]=N,e[28]=m,e[29]=v):v=e[29],v},Ke=Ps;function Ss(s){return s.stopPropagation()}var $s=p.memo(({reel:s,isActive:e,isMuted:i})=>{const r=he(),{currentUser:a}=Vt(),{addToast:d}=Bt(),l=(0,p.useRef)(null),[c,h]=(0,p.useState)(!1),[g,o]=(0,p.useState)(!1),[u,n]=(0,p.useState)(null),[m,x]=(0,p.useState)(!1),[z,N]=(0,p.useState)(s.stats?.likes||0),[v,w]=(0,p.useState)(!1),[j,_]=(0,p.useState)(0),C=(0,p.useRef)(null),F=(0,p.useMemo)(()=>Array.isArray(s.media)?s.media[0]?.src||s.media[0]?.url:s.media?.src||s.media?.url||s.url,[s.media,s.url]);(0,p.useEffect)(()=>{let b;const y=l.current?.plyr;return y&&(e?b=setTimeout(()=>{typeof y.play=="function"&&y.play().catch(()=>{y&&(y.muted=!0,y.play().catch(()=>{}))})},100):typeof y.pause=="function"&&y.pause()),()=>{b&&clearTimeout(b)}},[e]),(0,p.useEffect)(()=>{if(!a?.id||!e)return;(async()=>{try{const[y,S]=await Promise.all([Rt(s.id,a.id),Lt(a.id,s.user?.id)]);x(y),w(S)}catch(y){console.error("Failed to check interaction status:",y)}})()},[s.id,a?.id,e,s.user?.id]),(0,p.useEffect)(()=>{const b=l.current?.plyr;b&&(b.muted=i)},[i]),(0,p.useEffect)(()=>{const b=l.current?.plyr;if(!b||!e)return;const y=()=>{const S=b.currentTime,M=b.duration;M>0&&_(S/M*100)};if(typeof b.on=="function")return b.on("timeupdate",y),()=>{typeof b.off=="function"&&b.off("timeupdate",y)}},[e]);const R=b=>{b.target.closest("button")||b.target.closest("a")||(C.current?(clearTimeout(C.current),C.current=null,I()):C.current=setTimeout(()=>{C.current=null,E()},200))},E=()=>{const b=l.current?.plyr;b&&(b.paused?(b.play().catch(()=>{}),n("play")):(b.pause(),n("pause")),setTimeout(()=>n(null),500))},I=async()=>{if(a&&(h(!0),setTimeout(()=>h(!1),800),!m)){x(!0),N(b=>b+1);try{await Be(s.id,a.id)}catch{x(!1),N(b=>b-1)}}},L=async b=>{if(b.stopPropagation(),!a)return;const y=!m;x(y),N(S=>y?S+1:S-1);try{await Be(s.id,a.id)}catch{x(!y),N(S=>y?S-1:S+1)}},A=async b=>{if(b.stopPropagation(),!a)return;const y=!v;w(y);try{await Mt(a.id,s.user?.id)}catch{w(!y)}},V=b=>{b.stopPropagation();const y=`${window.location.origin}/reels?id=${s.id}`;navigator.clipboard.writeText(y),d("Link copied to clipboard!")},D=(0,p.useMemo)(()=>({source:{type:"video",sources:[{src:F,type:"video/mp4"}]},options:{controls:[],loop:{active:!0},clickToPlay:!0,ratio:"9:16"}}),[F]);return(0,t.jsxs)("div",{"data-id":s.id,className:"reel-item relative h-screen w-full bg-black snap-start flex items-center justify-center overflow-hidden cursor-pointer",onClick:R,children:[(0,t.jsx)("div",{className:"w-full h-full max-w-[450px]",children:(0,t.jsx)(tt,{ref:l,...D})}),c&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-50",children:(0,t.jsx)("div",{className:"animate-in zoom-in-50 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)(de,{size:120,fill:"white",className:"text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.4)] scale-125"})})}),u&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-50",children:(0,t.jsx)("div",{className:"animate-in fade-in zoom-in-90 scale-100 animate-out zoom-out-110 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)("div",{className:"p-8 bg-white/10 backdrop-blur-md rounded-full border border-white/20 shadow-2xl",children:u==="play"?(0,t.jsx)(Pt,{size:50,fill:"white",className:"text-white ml-1.5"}):(0,t.jsx)(Nt,{size:50,fill:"white",className:"text-white"})})})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/60 pointer-events-none"}),(0,t.jsxs)("div",{className:"absolute bottom-20 left-4 right-16 text-white pointer-events-none",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3 pointer-events-auto",children:[(0,t.jsxs)(pt,{to:`/u/${s.user?.handle}`,className:"flex items-center gap-2 hover:opacity-80 transition-opacity",onClick:b=>b.stopPropagation(),children:[(0,t.jsxs)(G,{className:"size-10 border-2 border-white",children:[(0,t.jsx)(T,{src:s.user?.avatar,alt:s.user?.handle,className:"object-cover"}),(0,t.jsx)(Q,{children:s.user?.handle?.[0]?.toUpperCase()})]}),(0,t.jsxs)("span",{className:"font-bold",children:["@",s.user?.handle]})]}),a?.id!==s.user?.id&&(0,t.jsx)("button",{className:`text-xs font-bold px-4 py-1.5 rounded-full ml-2 transition-all active:scale-95 ${v?"bg-transparent border border-white/50 text-white":"bg-white text-black hover:bg-zinc-200"}`,onClick:A,children:v?"Following":"Follow"})]}),(0,t.jsx)(be,{options:{...ge,render:({attributes:b,content:y})=>{const{href:S,...M}=b,O=!S.startsWith("/")&&(S.startsWith("http")||S.startsWith("www"));return S.startsWith("/u/")||S.startsWith("/tags/")||S.startsWith("/c/")||S.startsWith("/explore")?(0,t.jsx)("span",{...M,className:"text-white font-bold hover:underline cursor-pointer",onClick:B=>{B.stopPropagation(),r(S)},children:y},y):(0,t.jsx)("a",{href:S,...M,className:"text-white hover:underline",target:O?"_blank":void 0,rel:O?"noopener noreferrer":void 0,onClick:B=>B.stopPropagation(),children:y},y)}},children:(0,t.jsx)("p",{className:"text-sm mb-3 line-clamp-2",children:s.content})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[(0,t.jsx)(vt,{size:14,className:"animate-spin-slow"}),(0,t.jsxs)("span",{children:["Original Audio - ",s.user?.handle]})]})]}),(0,t.jsxs)("div",{className:"absolute bottom-20 right-2 flex flex-col items-center gap-6 z-10",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1 pointer-events-auto",children:[(0,t.jsx)("button",{className:`p-3 rounded-full backdrop-blur-md transition-all active:scale-90 ${m?"bg-rose-500/20 text-rose-500":"bg-zinc-800/50 text-white hover:bg-zinc-700"}`,onClick:L,children:(0,t.jsx)(de,{size:28,fill:m?"currentColor":"none"})}),(0,t.jsx)("span",{className:"text-white text-xs font-bold",children:z})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1 pointer-events-auto",children:[(0,t.jsx)("button",{className:"p-3 bg-zinc-800/50 rounded-full text-white backdrop-blur-md hover:bg-zinc-700 transition-colors active:scale-90",onClick:b=>{b.stopPropagation(),o(!0)},children:(0,t.jsx)(ce,{size:28})}),(0,t.jsx)("span",{className:"text-white text-xs font-bold",children:s.stats?.comments||0})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1 pointer-events-auto",children:[(0,t.jsx)("button",{className:"p-3 bg-zinc-800/50 rounded-full text-white backdrop-blur-md hover:bg-zinc-700 transition-colors active:scale-90",onClick:V,children:(0,t.jsx)($t,{size:28})}),(0,t.jsx)("span",{className:"text-white text-xs font-bold",children:s.stats?.shares||0})]})]}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-[3px] bg-white/20 z-50",children:(0,t.jsx)("div",{className:"h-full bg-white transition-all duration-100 ease-linear shadow-[0_0_8px_rgba(255,255,255,0.8)]",style:{width:`${j}%`}})}),(0,t.jsx)(Is,{isOpen:g,onClose:()=>o(!1),reelId:s.id,currentUser:a,showToast:d})]})},(s,e)=>s.isActive===e.isActive&&s.reel.id===e.reel.id&&s.isMuted===e.isMuted),Vs=$s,Fs=({isOpen:s,onClose:e,reelId:i,currentUser:r,showToast:a})=>{const[d,l]=(0,p.useState)([]),[c,h]=(0,p.useState)(!1),[g,o]=(0,p.useState)(!1),[u,n]=(0,p.useState)(""),[m,x]=(0,p.useState)([]),[z,N]=(0,p.useState)(!1),[v,w]=(0,p.useState)(!0),[j,_]=(0,p.useState)(!1),C=(0,p.useRef)(d);(0,p.useEffect)(()=>{C.current=d},[d]);const F=(0,p.useCallback)(async(E=!1)=>{if(i){E?_(!0):h(!0);try{const I=C.current,L=await st(i,E&&I.length>0?I[I.length-1].created_at:null,10);L.length<10?w(!1):w(!0),l(E?A=>[...A,...L]:L)}catch(I){console.error("Failed to load comments:",I),a&&a("Failed to load comments","error")}finally{h(!1),_(!1)}}},[i,a]);(0,p.useEffect)(()=>{s&&i?F():(l([]),w(!0))},[s,i,F]);const R=async E=>{if(E.preventDefault(),!(!u.trim()&&m.length===0||!r)){o(!0),N(!0);try{const I=[];for(const L of m){const A=await fe(L);I.push(A)}await it(i,r.id,u,I),n(""),x([]),a&&a("Reply posted!"),F()}catch(I){console.error("Failed to post comment:",I),a&&a("Failed to post reply.","error")}finally{o(!1),N(!1)}}};return(0,t.jsx)(Dt,{isOpen:s,onClose:e,className:"max-sm:h-[95dvh] sm:max-w-xl h-[85vh] flex flex-col !p-0",children:(0,t.jsxs)("div",{className:"flex flex-col h-full overflow-hidden bg-white dark:bg-zinc-900",children:[(0,t.jsxs)("div",{className:"px-5 py-4 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-center shrink-0 relative bg-white dark:bg-zinc-900",children:[(0,t.jsx)("h2",{className:"text-base font-bold dark:text-white",children:"Comments"}),(0,t.jsx)("div",{className:"absolute right-5 w-8 h-1 bg-zinc-200 dark:bg-zinc-800 rounded-full sm:hidden top-2 transform -translate-y-1/2 left-1/2 -translate-x-1/2"})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800",children:c?(0,t.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,t.jsx)(ee,{className:"animate-spin text-violet-500",size:32})}):d.length>0?(0,t.jsxs)("div",{className:"flex flex-col",children:[d.map(E=>(0,t.jsx)(Cs,{...E,isComment:!0,currentUser:r,showToast:a,onDelete:I=>l(L=>L.filter(A=>A.id!==I))},E.id)),v&&(0,t.jsxs)("button",{onClick:()=>F(!0),disabled:j,className:"w-full py-6 text-sm font-bold text-violet-600 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-colors flex items-center justify-center gap-2",children:[j&&(0,t.jsx)(ee,{size:16,className:"animate-spin"}),"View more replies"]})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] text-center text-zinc-500 p-8",children:[(0,t.jsx)("div",{className:"size-16 rounded-full bg-zinc-100 dark:bg-zinc-900 flex items-center justify-center mb-4",children:(0,t.jsx)(ce,{size:32,className:"text-zinc-400"})}),(0,t.jsx)("p",{className:"font-bold text-lg dark:text-zinc-300",children:"No comments yet"}),(0,t.jsx)("p",{className:"text-sm dark:text-zinc-500",children:"Be the first to share what you think!"})]})}),(0,t.jsx)("div",{className:"bg-white dark:bg-zinc-900 shrink-0",children:(0,t.jsx)(at,{currentUser:r,newComment:u,setNewComment:n,handleSubmitComment:R,loading:g,selectedFiles:m,setSelectedFiles:x,isUploading:z})})]})})},Is=Fs;export{Cs as n,Vs as t};
