import{n as it}from"./rolldown-runtime-2JzG8er9.js";import{f as zt,s as V,u as kt,w as Nt,y as ke}from"./framework-pMVb9Z5_.js";import{n as wt}from"./query-CYcBlx0y.js";import{$t as yt,At as ve,Cn as Ct,Dn as St,En as Pt,Fn as _t,Lt as Ft,Qt as $t,Rt as It,Sn as Mt,Vt as Rt,Xt as be,Zt as At,_n as Te,an as nt,en as Et,hn as pe,in as Lt,kn as Dt,ln as K,nn as Wt,on as Ut,pn as Ot,qt as Tt,t as rt,un as Vt,vn as Bt,wn as je,xn as qt,yn as Ve}from"./ui-libs-CVo_NHeJ.js";import{$ as Q,At as lt,G as Ht,Gt,H as Qt,Kt as ue,Nt as ot,Ot as Xt,Q as Jt,R as ct,U as se,Ut as Kt,V as Yt,Vt as Zt,W as es,Wt as ts,Yt as ss,_t as ze,a as dt,at as Be,c as as,ct as qe,dt as is,et as X,ft as ns,g as rs,gt as mt,it as He,jt as ls,kt as os,l as cs,lt as Ge,m as Qe,mt as ds,nt as Xe,o as Je,ot as Ke,p as xe,pt as xt,qt as me,rt as Ye,s as ms,st as Ze,tt as J,ut as xs,vt as ps,zt as et}from"./index-Dj_euOpA.js";import{n as Ne,t as we}from"./linkify-bYOTkjrL.js";import{d as us}from"./hooks-CsE4EoXJ.js";var hs=V(),o=it(Nt(),1),t=it(kt(),1),fs=s=>{const e=(0,hs.c)(21),{icon:a,count:l,label:r,onClick:c,active:i,activeColorClass:d}=s,f=d===void 0?"text-violet-600":d;let b;e[0]!==c?(b=S=>{S.stopPropagation(),c&&c(S)},e[0]=c,e[1]=b):b=e[1];const v=`${r} ${l!==void 0?`(${l})`:""}`,g=`group -ml-2 flex items-center gap-x-1 rounded-xl px-2 py-1.5 text-[12px] font-bold transition-all active:scale-95 sm:gap-x-1.5 sm:text-[13px] ${i?f:"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"}`,n=`rounded-full p-2 transition-colors ${i?"":"group-hover:bg-zinc-100 dark:group-hover:bg-zinc-800"}`,u=i?2.5:2,x=i?"fill-current":"";let m;e[2]!==a||e[3]!==u||e[4]!==x?(m=(0,t.jsx)(a,{size:18,strokeWidth:u,className:x}),e[2]=a,e[3]=u,e[4]=x,e[5]=m):m=e[5];let z;e[6]!==n||e[7]!==m?(z=(0,t.jsx)("div",{className:n,children:m}),e[6]=n,e[7]=m,e[8]=z):z=e[8];let N;e[9]!==r?(N=r&&(0,t.jsx)("span",{className:"hidden xs:inline",children:r}),e[9]=r,e[10]=N):N=e[10];let y;e[11]!==i||e[12]!==l?(y=l!=null&&(0,t.jsx)("span",{className:i?"font-bold":"",children:l||0}),e[11]=i,e[12]=l,e[13]=y):y=e[13];let j;return e[14]!==N||e[15]!==y||e[16]!==b||e[17]!==v||e[18]!==g||e[19]!==z?(j=(0,t.jsxs)("button",{onClick:b,"aria-label":v,className:g,children:[z,N,y]}),e[14]=N,e[15]=y,e[16]=b,e[17]=v,e[18]=g,e[19]=z,e[20]=j):j=e[20],j},B=fs,gs=V(),bs=s=>{const e=(0,gs.c)(51),{currentUser:a,newComment:l,setNewComment:r,handleSubmitComment:c,loading:i,selectedFiles:d,setSelectedFiles:f,isUploading:b}=s;let v;e[0]!==d?(v=d===void 0?[]:d,e[0]=d,e[1]=v):v=e[1];const g=v,n=(0,o.useRef)(null);let u;e[2]!==f?(u=w=>{if(w.target.files){const _=Array.from(w.target.files);f&&f(O=>[...O,..._])}},e[2]=f,e[3]=u):u=e[3];const x=u;let m;e[4]!==f?(m=w=>{f&&f(_=>_.filter((O,q)=>q!==w))},e[4]=f,e[5]=m):m=e[5];const z=m;if(!a){let w;return e[6]===Symbol.for("react.memo_cache_sentinel")?(w=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-6 text-center dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"Please login to join the conversation."})}),e[6]=w):w=e[6],w}let N;e[7]!==a.avatar||e[8]!==a.handle?(N=(0,t.jsx)(J,{src:a.avatar,alt:a.handle,className:"object-cover"}),e[7]=a.avatar,e[8]=a.handle,e[9]=N):N=e[9];let y;e[10]!==a.handle?.[0]?(y=a.handle?.[0]?.toUpperCase(),e[10]=a.handle?.[0],e[11]=y):y=e[11];let j;e[12]!==y?(j=(0,t.jsx)(X,{children:y}),e[12]=y,e[13]=j):j=e[13];let S;e[14]!==N||e[15]!==j?(S=(0,t.jsxs)(Q,{className:"size-9 border border-zinc-200 dark:border-zinc-700",children:[N,j]}),e[14]=N,e[15]=j,e[16]=S):S=e[16];let $;e[17]!==r?($=w=>r(w.target.value),e[17]=r,e[18]=$):$=e[18];let p;e[19]!==l||e[20]!==$?(p=(0,t.jsx)("textarea",{id:"comment-input",className:"min-h-[60px] w-full resize-none bg-transparent text-base outline-none placeholder:text-zinc-500 dark:text-white",placeholder:"Post your reply...",value:l,onChange:$}),e[19]=l,e[20]=$,e[21]=p):p=e[21];let F;e[22]!==z||e[23]!==g?(F=g.length>0&&(0,t.jsx)("div",{className:"mt-2 mb-2 flex flex-wrap gap-2",children:g.map((w,_)=>(0,t.jsxs)("div",{className:"relative size-20 overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[w.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(w),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)(Et,{size:20,className:"text-zinc-500"})}),(0,t.jsx)("button",{onClick:()=>z(_),className:"absolute right-1 top-1 rounded-full bg-black/60 p-1 text-white transition-colors hover:bg-black",children:(0,t.jsx)(ve,{size:12})})]},_))}),e[22]=z,e[23]=g,e[24]=F):F=e[24];let M;e[25]===Symbol.for("react.memo_cache_sentinel")?(M=()=>n.current?.click(),e[25]=M):M=e[25];let I;e[26]===Symbol.for("react.memo_cache_sentinel")?(I=(0,t.jsx)("button",{type:"button",onClick:M,className:"rounded-full p-2 text-violet-600 transition-colors hover:bg-violet-50 dark:hover:bg-zinc-800",title:"Attach media",children:(0,t.jsx)(Ot,{size:20})}),e[26]=I):I=e[26];let A;e[27]!==x?(A=(0,t.jsxs)("div",{className:"flex gap-1 text-violet-600",children:[I,(0,t.jsx)("input",{type:"file",ref:n,onChange:x,multiple:!0,className:"hidden",accept:"image/*,video/*,application/pdf"})]}),e[27]=x,e[28]=A):A=e[28];let E;e[29]!==b||e[30]!==i||e[31]!==l||e[32]!==g.length?(E=!l.trim()&&g.length===0||i||b,e[29]=b,e[30]=i,e[31]=l,e[32]=g.length,e[33]=E):E=e[33];let U;e[34]!==b||e[35]!==i?(U=i||b?(0,t.jsx)(K,{size:16,className:"mx-auto animate-spin text-white"}):"Reply",e[34]=b,e[35]=i,e[36]=U):U=e[36];let L;e[37]!==c||e[38]!==E||e[39]!==U?(L=(0,t.jsx)(Jt,{className:"min-w-[70px] !w-auto px-5 py-1.5 text-sm font-bold",onClick:c,disabled:E,children:U}),e[37]=c,e[38]=E,e[39]=U,e[40]=L):L=e[40];let D;e[41]!==A||e[42]!==L?(D=(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between border-t border-zinc-100 pt-3 dark:border-zinc-800",children:[A,L]}),e[41]=A,e[42]=L,e[43]=D):D=e[43];let W;e[44]!==p||e[45]!==F||e[46]!==D?(W=(0,t.jsxs)("div",{className:"flex-1",children:[p,F,D]}),e[44]=p,e[45]=F,e[46]=D,e[47]=W):W=e[47];let k;return e[48]!==W||e[49]!==S?(k=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-4 dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[S,W]})}),e[48]=W,e[49]=S,e[50]=k):k=e[50],k},pt=bs,vs=V(),js=s=>{const e=(0,vs.c)(15),{file:a}=s;let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=(0,t.jsx)("div",{className:"flex size-10 items-center justify-center rounded-xl bg-violet-100 text-violet-600 dark:bg-violet-900/30",children:(0,t.jsx)(qt,{size:20})}),e[0]=l):l=e[0];let r;e[1]!==a.name?(r=(0,t.jsx)("div",{className:"truncate text-sm font-bold dark:text-white",children:a.name}),e[1]=a.name,e[2]=r):r=e[2];let c;e[3]!==a.size?(c=a.size!==void 0&&(0,t.jsxs)("div",{className:"text-xs uppercase text-zinc-500",children:[(a.size/1024/1024).toFixed(2)," MB"]}),e[3]=a.size,e[4]=c):c=e[4];let i;e[5]!==r||e[6]!==c?(i=(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[r,c]}),e[5]=r,e[6]=c,e[7]=i):i=e[7];let d;e[8]===Symbol.for("react.memo_cache_sentinel")?(d=(0,t.jsx)(Pt,{size:18}),e[8]=d):d=e[8];let f;e[9]!==a.name||e[10]!==a.url?(f=(0,t.jsx)("a",{href:a.url,download:a.name,className:"p-2 text-zinc-400 transition-colors hover:text-violet-600",onClick:ks,children:d}),e[9]=a.name,e[10]=a.url,e[11]=f):f=e[11];let b;return e[12]!==i||e[13]!==f?(b=(0,t.jsxs)("div",{className:"group mt-3 flex items-center gap-3 rounded-2xl border border-zinc-100 bg-zinc-50/50 p-3 transition-colors hover:border-violet-500/30 dark:border-zinc-800 dark:bg-zinc-900/10",children:[l,i,f]}),e[12]=i,e[13]=f,e[14]=b):b=e[14],b},zs=js;function ks(s){return s.stopPropagation()}var na=V(),Ns=V(),ws=s=>{const e=(0,Ns.c)(30),{url:a}=s;let l,r;e[0]!==a?(l=["link-preview",a],r=()=>ps(a),e[0]=a,e[1]=l,e[2]=r):(l=e[1],r=e[2]);const c=!!a;let i;e[3]!==l||e[4]!==r||e[5]!==c?(i={queryKey:l,queryFn:r,staleTime:864e5,enabled:c},e[3]=l,e[4]=r,e[5]=c,e[6]=i):i=e[6];const{data:d,isLoading:f,isError:b}=wt(i);if(f){let j;return e[7]===Symbol.for("react.memo_cache_sentinel")?(j=(0,t.jsx)("div",{className:"mt-3 flex h-24 animate-pulse items-center justify-center overflow-hidden rounded-2xl border border-zinc-100 bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-900/50",children:(0,t.jsx)(Te,{className:"animate-spin text-zinc-300 dark:text-zinc-700",size:24})}),e[7]=j):j=e[7],j}if(b||!d||!d.title&&!d.image)return null;let v;e[8]!==d.image||e[9]!==d.title?(v=d.image&&(0,t.jsx)("div",{className:"aspect-[1.91/1] w-full overflow-hidden border-b border-zinc-100 bg-zinc-100 dark:border-zinc-800 dark:bg-zinc-900",children:(0,t.jsx)("img",{src:d.image,alt:d.title??void 0,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-[1.02]",onError:Cs})}),e[8]=d.image,e[9]=d.title,e[10]=v):v=e[10];let g;e[11]===Symbol.for("react.memo_cache_sentinel")?(g=(0,t.jsx)(Te,{size:12}),e[11]=g):g=e[11];let n;e[12]!==d.siteName?(n=(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs font-bold uppercase tracking-wider text-zinc-600",children:[g,(0,t.jsx)("span",{children:d.siteName})]}),e[12]=d.siteName,e[13]=n):n=e[13];let u;e[14]!==d.title?(u=(0,t.jsx)("div",{className:"line-clamp-2 text-[15px] font-bold leading-snug transition-colors group-hover:text-violet-700 dark:text-white",children:d.title}),e[14]=d.title,e[15]=u):u=e[15];let x;e[16]!==d.description?(x=d.description&&(0,t.jsx)("p",{className:"line-clamp-2 text-xs leading-relaxed text-zinc-600 dark:text-zinc-400",children:d.description}),e[16]=d.description,e[17]=x):x=e[17];let m;e[18]===Symbol.for("react.memo_cache_sentinel")?(m=(0,t.jsx)(Ct,{size:10}),e[18]=m):m=e[18];let z;e[19]!==a?(z=(0,t.jsxs)("div",{className:"flex items-center gap-1 pt-1 text-[11px] font-medium text-zinc-500",children:[m,(0,t.jsx)("span",{className:"truncate",children:a})]}),e[19]=a,e[20]=z):z=e[20];let N;e[21]!==z||e[22]!==n||e[23]!==u||e[24]!==x?(N=(0,t.jsxs)("div",{className:"space-y-1 p-3.5",children:[n,u,x,z]}),e[21]=z,e[22]=n,e[23]=u,e[24]=x,e[25]=N):N=e[25];let y;return e[26]!==N||e[27]!==v||e[28]!==a?(y=(0,t.jsxs)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"group mt-3 flex flex-col overflow-hidden rounded-2xl border border-zinc-100 bg-white shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-900",onClick:ys,children:[v,N]}),e[26]=N,e[27]=v,e[28]=a,e[29]=y):y=e[29],y},tt=ws;function ys(s){return s.stopPropagation()}function Cs(s){return s.target.style.display="none"}var Ss=V(),Ps=s=>{const e=(0,Ss.c)(17),{src:a,poster:l}=s,r=(0,o.useRef)(null),{reportVisibility:c,unregister:i}=xs(),{dataSaver:d}=ds(),f=(0,o.useId)();let b;e[0]===Symbol.for("react.memo_cache_sentinel")?(b={play:()=>{const j=r.current?.plyr;j&&(j.muted=!0,j.play().catch(Fs))},pause:()=>{r.current?.plyr?.pause()}},e[0]=b):b=e[0];const v=b;let g,n;e[1]!==d||e[2]!==f||e[3]!==c||e[4]!==i?(g=()=>{const j=new IntersectionObserver($=>{const[p]=$;c(f,d?0:p.intersectionRatio,v)},{threshold:[0,.6]}),S=r.current?.elements?.container;return S&&j.observe(S),()=>{i(f),S&&j.unobserve(S)}},n=[f,c,i,v,d],e[1]=d,e[2]=f,e[3]=c,e[4]=i,e[5]=g,e[6]=n):(g=e[5],n=e[6]),(0,o.useEffect)(g,n);let u;e[7]!==a?(u=[{src:a,type:"video/mp4"}],e[7]=a,e[8]=u):u=e[8];let x;e[9]!==l||e[10]!==u?(x={type:"video",sources:u,poster:l},e[9]=l,e[10]=u,e[11]=x):x=e[11];let m;e[12]===Symbol.for("react.memo_cache_sentinel")?(m={controls:["play-large","play","progress","current-time","mute","volume","fullscreen"],settings:["quality","speed"],ratio:"16:9",clickToPlay:!0,hideControls:!0,resetOnEnd:!0},e[12]=m):m=e[12];let z;e[13]!==x?(z={source:x,options:m},e[13]=x,e[14]=z):z=e[14];const N=z;let y;return e[15]!==N?(y=(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl border border-zinc-100 bg-black shadow-sm dark:border-zinc-800",onClick:$s,children:(0,t.jsx)(rt,{ref:r,...N})}),e[15]=N,e[16]=y):y=e[16],y},_s=Ps;function Fs(){}function $s(s){return s.stopPropagation()}var Is=V(),Ms=s=>{const e=(0,Is.c)(3),{items:a}=s,l=a===void 0?[]:a,{openLightbox:r}=is();if(!l||Array.isArray(l)&&l.length===0)return null;const c=Array.isArray(l)?l:[l],i=c.filter(As),d=c.filter(Es),f=u=>{const x=i.filter(Ls).map(Ds),m=i[u];r(x,x.indexOf(m.url||m.src))},b="mt-3 space-y-2",v=i.length>0&&(0,t.jsx)("div",{className:`grid gap-2 overflow-hidden rounded-2xl border border-zinc-100 dark:border-zinc-800 ${i.length===1?"grid-cols-1":i.length===2?"aspect-[16/9] grid-cols-2":(i.length===3,"aspect-[16/9] grid-cols-2 grid-rows-2")}`,children:i.map((u,x)=>(0,t.jsx)("div",{className:`relative cursor-pointer overflow-hidden bg-zinc-100 dark:bg-zinc-900 ${i.length===3&&x===0?"row-span-2":""}
                                `,onClick:m=>{u.type==="image"&&(m.stopPropagation(),f(x))},children:u.type==="video"?(0,t.jsx)(_s,{src:u.url,poster:u.poster||void 0}):(0,t.jsx)("img",{src:u.url||u.src,className:"size-full object-cover transition-transform duration-500 hover:scale-[1.02]",alt:"",loading:"lazy"})},x))}),g=d.map(Ws);let n;return e[0]!==v||e[1]!==g?(n=(0,t.jsxs)("div",{className:b,children:[v,g]}),e[0]=v,e[1]=g,e[2]=n):n=e[2],n},Rs=Ms;function As(s){return s.type==="image"||s.type==="video"}function Es(s){return s.type==="file"}function Ls(s){return s.type==="image"}function Ds(s){return s.url||s.src}function Ws(s,e){return(0,t.jsx)(zs,{file:s},e)}var Us=V(),Os=s=>{const e=(0,Us.c)(18),{poll:a,onVote:l}=s,r=a.options.reduce(Ts,0),[c,i]=(0,o.useState)(null);let d;e[0]!==l||e[1]!==c?(d=x=>{c||(i(x),l&&l(x))},e[0]=l,e[1]=c,e[2]=d):d=e[2];const f=d;let b;if(e[3]!==f||e[4]!==a.options||e[5]!==r||e[6]!==c){let x;e[8]!==f||e[9]!==r||e[10]!==c?(x=(m,z)=>{const N=r>0?Math.round((m.votes+(c===m.id?1:0))/(r+(c?1:0))*100):0,y=c===m.id;return(0,t.jsxs)("div",{onClick:j=>{j.stopPropagation(),f(m.id)},className:`relative h-10 w-full overflow-hidden rounded-xl border cursor-pointer ${y?"border-violet-500 dark:border-violet-500":"border-zinc-200 dark:border-zinc-700"}`,children:[c&&(0,t.jsx)("div",{className:"absolute left-0 top-0 h-full bg-zinc-200 transition-all duration-500 dark:bg-zinc-800",style:{width:`${N}%`}}),(0,t.jsxs)("div",{className:"absolute inset-0 z-10 flex items-center justify-between px-4",children:[(0,t.jsxs)("span",{className:`text-sm font-medium ${y?"font-bold text-violet-600":"text-zinc-700 dark:text-zinc-200"}`,children:[m.text," ",y&&(0,t.jsx)(Dt,{size:14,className:"mb-0.5 inline ml-1"})]}),c&&(0,t.jsxs)("span",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:[N,"%"]})]})]},m.id||z)},e[8]=f,e[9]=r,e[10]=c,e[11]=x):x=e[11],b=a.options.map(x),e[3]=f,e[4]=a.options,e[5]=r,e[6]=c,e[7]=b}else b=e[7];const v=r+(c?1:0),g=c?"6 days left":"Click to vote";let n;e[12]!==v||e[13]!==g?(n=(0,t.jsxs)("div",{className:"pl-1 text-xs text-zinc-500 dark:text-zinc-400",children:[v," votes •"," ",g]}),e[12]=v,e[13]=g,e[14]=n):n=e[14];let u;return e[15]!==b||e[16]!==n?(u=(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[b,n]}),e[15]=b,e[16]=n,e[17]=u):u=e[17],u},st=Os;function Ts(s,e){return s+e.votes}var ut=({id:s,user:e,timeAgo:a,content:l,contentClass:r,media:c,quotedPost:i,stats:d,onClick:f,repostedBy:b,onUserClick:v,currentUser:g,showToast:n,poll:u,isDetail:x,initialComments:m,onDelete:z,isComment:N,onReply:y,community:j})=>{const S=ke(),{liked:$,reposted:p,localStats:F,setLocalStats:M,handleLike:I,handleRepost:A}=us(s,d,g,n||(()=>{})),{deletePost:E,updatePost:U}=ns(),[L,D]=(0,o.useState)(m||[]),[W,k]=(0,o.useState)(""),[w,_]=(0,o.useState)(!1),[O,q]=(0,o.useState)(!1),[Y,ye]=(0,o.useState)(!1),[ht,Ce]=(0,o.useState)(!0),[he,Se]=(0,o.useState)([]),[ft,Pe]=(0,o.useState)(!1),[_e,ae]=(0,o.useState)(!1),[fe,ie]=(0,o.useState)(!1),[Z,Fe]=(0,o.useState)(l),[te,$e]=(0,o.useState)(c||[]),[ne,re]=(0,o.useState)([]),[Ie,Me]=(0,o.useState)(!1),[le,gt]=(0,o.useState)(!1),Re=(0,o.useRef)(null),Ae=(0,o.useRef)(L);(0,o.useEffect)(()=>{Ae.current=L},[L]);const bt=async()=>{const h=JSON.stringify(te)!==JSON.stringify(c||[])||ne.length>0;if(!Z.trim()||Z===l&&!h){ie(!1);return}Me(!0);try{const C=[];for(const P of ne){const R=await ze(P);C.push(R)}await U(s,{content:Z,media:[...te,...C]}),re([]),ie(!1),n&&n("Post updated")}catch(C){console.error("Failed to update post:",C),n&&n("Failed to update post")}finally{Me(!1)}},Ee=async h=>{h&&h.stopPropagation();try{await E(s),n&&n("Post deleted successfully"),z&&z(s)}catch(C){console.error("Failed to delete post:",C),n&&n("Failed to delete post")}finally{ae(!1)}},oe=(0,o.useCallback)(async(h=!1)=>{if(s){h?ye(!0):_(!0);try{const C=Ae.current,P=await ot(s,h&&C.length>0?C[C.length-1].created_at:null,10);P.length<10?Ce(!1):Ce(!0),D(h?R=>[...R,...P]:P)}catch(C){console.error("Failed to load comments:",C)}finally{_(!1),ye(!1)}}},[s]);(0,o.useEffect)(()=>{x&&s&&oe()},[x,s,oe]);const vt=async h=>{if(h.preventDefault(),!(!W.trim()&&he.length===0||!g)){q(!0),Pe(!0);try{const C=[];for(const P of he){const R=await ze(P);C.push(R)}await lt(s,g.id,W,C),k(""),Se([]),M(P=>({...P,comments:(P.comments||0)+1})),n&&n("Reply posted!"),oe()}catch(C){console.error("Failed to post comment:",C),n&&n("Failed to post reply.")}finally{q(!1),Pe(!1)}}},Le=({trigger:h})=>(0,t.jsxs)(Yt,{children:[(0,t.jsx)(Ht,{asChild:!0,onClick:C=>C.stopPropagation(),children:h}),(0,t.jsxs)(Qt,{align:"end",className:"w-48 rounded-xl border-zinc-100 bg-white dark:border-zinc-800 dark:bg-zinc-900",children:[!N&&(0,t.jsxs)(se,{className:"cursor-pointer gap-2 py-2.5 focus:bg-zinc-50 dark:focus:bg-zinc-800",onClick:C=>{C.stopPropagation(),navigator.clipboard.writeText(`${window.location.origin}/post/${s}`),n&&n("Link copied")},children:[(0,t.jsx)(xe,{size:16}),(0,t.jsx)("span",{children:"Copy link to post"})]}),!N&&(0,t.jsxs)(se,{className:"cursor-pointer gap-2 py-2.5 focus:bg-zinc-50 dark:focus:bg-zinc-800",onClick:C=>{C.stopPropagation(),n&&n("Post reported")},children:[(0,t.jsx)(Bt,{size:16}),(0,t.jsx)("span",{children:"Report post"})]}),!De&&(0,t.jsxs)(se,{className:"cursor-pointer gap-2 py-2.5 text-rose-500 focus:bg-zinc-50 focus:text-rose-500 dark:focus:bg-zinc-800",onClick:C=>{C.stopPropagation(),n&&n("User blocked")},children:[(0,t.jsx)(Ft,{size:16}),(0,t.jsxs)("span",{children:["Block @",e.handle]})]}),De&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(es,{className:"bg-zinc-100 dark:border-zinc-800"}),(0,t.jsxs)(se,{onClick:C=>{C.stopPropagation(),ie(!0)},className:"flex cursor-pointer items-center gap-2",children:[(0,t.jsx)(ms,{size:16}),"Edit Post"]}),(0,t.jsxs)(se,{className:"cursor-pointer gap-2 py-2.5 text-rose-500 focus:bg-rose-50 focus:text-rose-500 dark:focus:bg-rose-900/20",onClick:C=>{C.stopPropagation(),ae(!0)},children:[(0,t.jsx)(Rt,{size:16}),(0,t.jsx)("span",{children:"Delete post"})]})]})]})]}),De=g?.handle===e.handle,We=h=>{if(!h)return null;const C=fe?te:h;return!C||Array.isArray(C)&&C.length===0?null:fe?(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:[te.map((P,R)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[P.type==="video"?(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(Ve,{size:24,className:"text-zinc-400"})}):(0,t.jsx)("img",{src:P.url||P.src,className:"size-full object-cover",alt:""}),(0,t.jsx)("button",{onClick:H=>{H.stopPropagation(),$e(G=>G.filter((ee,T)=>T!==R))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(ve,{size:16})})]},`old-${R}`)),ne.map((P,R)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border-2 border-dashed border-violet-500 bg-violet-50/10",children:[P.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(P),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center",children:(0,t.jsx)(Ve,{size:24,className:"animate-pulse text-violet-500"})}),(0,t.jsx)("button",{onClick:H=>{H.stopPropagation(),re(G=>G.filter((ee,T)=>T!==R))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(ve,{size:16})}),(0,t.jsx)("div",{className:"absolute bottom-1 left-1 rounded bg-violet-600 px-1 text-[8px] font-bold text-white",children:"NEW"})]},`new-${R}`)),te.length+ne.length<4&&(0,t.jsxs)("button",{onClick:P=>{P.stopPropagation(),Re.current?.click()},className:"relative flex aspect-square flex-col items-center justify-center gap-1 rounded-xl border-2 border-dashed border-zinc-200 text-zinc-400 transition-all hover:border-violet-500 hover:bg-violet-50/5 hover:text-violet-500 dark:border-zinc-800",children:[(0,t.jsx)(At,{size:20}),(0,t.jsx)("span",{className:"text-[10px] font-bold",children:"Add Media"})]})]}),(0,t.jsx)("input",{type:"file",ref:Re,onChange:P=>{if(P.target.files){const R=Array.from(P.target.files);re(H=>[...H,...R])}},multiple:!0,className:"hidden",accept:"image/*,video/*"})]}):o.isValidElement(C)?C:(0,t.jsx)(Rs,{items:C})},Ue=(h,C)=>{const P=typeof h=="string"&&ss(h);if(fe)return(0,t.jsxs)("div",{className:"mt-2 flex flex-col gap-2",onClick:R=>R.stopPropagation(),children:[(0,t.jsx)(rs,{value:Z,onChange:R=>Fe(R.target.value),className:`min-h-[100px] w-full rounded-xl border-zinc-200 bg-zinc-50 focus:ring-violet-500 dark:border-zinc-800 dark:bg-zinc-900 ${P?"font-bangla text-lg":"font-english"}`,autoFocus:!0}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)("button",{onClick:()=>{ie(!1),Fe(l),$e(c||[]),re([])},className:"px-4 py-1.5 text-sm font-bold text-zinc-500 transition-colors hover:text-zinc-700 dark:hover:text-zinc-300",children:"Cancel"}),(0,t.jsx)("button",{onClick:bt,disabled:Ie||!Z.trim()||Z===l,className:"rounded-full bg-violet-600 px-4 py-1.5 text-sm font-bold text-white transition-all hover:bg-violet-700 disabled:opacity-50 active:scale-95",children:Ie?"Saving...":"Save"})]})]});if(typeof h=="string"){const R=!x&&h.length>280,H=R&&!le?h.substring(0,280):h;return(0,t.jsxs)("div",{className:`whitespace-pre-line ${C||""} ${P?"font-bangla text-[1.15em] leading-relaxed":"font-english text-[1.05em]"}`,children:[(0,t.jsx)(Ne,{options:{...we,render:({attributes:G,content:ee})=>{const{href:T,...ce}=G,Oe=window.location.origin;let de=null;return T.startsWith("/")?de=T:T.startsWith(Oe)&&(de=T.replace(Oe,"")),de?(0,t.jsx)("span",{...ce,className:ue("cursor-pointer font-medium text-violet-600 hover:underline dark:text-violet-400",ce.className),onClick:ge=>{ge.stopPropagation(),S(de)},children:ee},ee):(0,t.jsx)("a",{href:T,...ce,target:"_blank",rel:"noopener noreferrer",className:ue("text-violet-600 hover:underline dark:text-violet-400",ce.className),onClick:ge=>ge.stopPropagation(),children:ee},ee)}},children:H}),R&&!le&&"...",R&&(0,t.jsx)("button",{onClick:G=>{G.stopPropagation(),gt(!le)},className:"ml-1 cursor-pointer font-bold text-rose-600 hover:underline dark:text-rose-400",children:le?"Show less":"See more"})]})}return h},jt=h=>{k(C=>{const P=`@${h} `;return C.includes(P)?C:C+P}),document.getElementById("comment-input")?.focus()};return x?(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("article",{className:"p-5 dark:bg-black",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsx)("button",{className:"shrink-0",onClick:()=>v&&v(e.handle),children:(0,t.jsxs)(Q,{className:"size-12 border border-zinc-200 dark:border-zinc-700",children:[(0,t.jsx)(J,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(X,{children:e.handle[0]?.toUpperCase()})]})}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex min-w-0 max-w-full items-center gap-1.5",children:[(0,t.jsxs)("button",{className:"flex shrink-0 items-center gap-1 text-base font-bold text-zinc-900 hover:underline sm:text-lg dark:text-white",onClick:()=>v&&v(e.handle),children:[(0,t.jsx)("span",{className:"max-w-[200px] truncate sm:max-w-none",children:e.handle}),e.verified&&(0,t.jsx)(Qe,{size:16,className:"text-blue-500"})]}),j&&(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-1 text-zinc-500",children:[(0,t.jsx)(Je,{size:14,className:"shrink-0 text-zinc-400"}),(0,t.jsxs)("button",{className:"flex items-center gap-1 text-[14px] font-bold text-zinc-900 hover:underline sm:text-[15px] dark:text-zinc-100",onClick:h=>{h.stopPropagation(),S(`/c/${j.handle}`)},children:[(0,t.jsxs)(Q,{className:"size-4 shrink-0 border border-zinc-200 bg-zinc-100 dark:border-zinc-700 dark:bg-zinc-800",children:[(0,t.jsx)(J,{src:j.avatar,alt:j.name,className:"object-cover"}),(0,t.jsx)(X,{className:"text-[8px] font-bold text-zinc-500",children:j.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"max-w-[200px] truncate sm:max-w-none",children:j.name})]})]})]})}),(0,t.jsxs)("span",{className:"text-xs font-medium text-zinc-500 sm:text-sm dark:text-zinc-400",children:["@",e.handle]})]})]}),(0,t.jsxs)("div",{className:"-mt-1 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"whitespace-nowrap text-[13px] text-zinc-500 sm:text-sm dark:text-zinc-400",children:a||"Recent"}),(0,t.jsx)(Le,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,t.jsx)(je,{size:20})})})]})]}),(0,t.jsx)("div",{className:"mt-4 whitespace-pre-line break-words text-lg leading-relaxed text-zinc-900 sm:text-xl sm:leading-8 dark:text-zinc-100",children:Ue(l,r)}),me(l)&&(0,t.jsx)(tt,{url:me(l)}),We(c),u&&(0,t.jsx)(st,{poll:u}),i&&(0,t.jsx)("div",{className:"mt-4 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm dark:border-zinc-700",children:(0,t.jsx)(at,{...i})}),(0,t.jsxs)("div",{className:"mt-4 flex items-center gap-x-6 border-b border-zinc-100 pb-4 text-sm text-zinc-500 dark:border-zinc-800 dark:text-zinc-400",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:F.likes||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Likes"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:F.comments||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Comments"})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex w-full items-center justify-around py-1",children:[(0,t.jsx)(B,{icon:pe,label:"Like",onClick:I,active:$,activeColorClass:"text-rose-500"}),!N&&(0,t.jsx)(B,{icon:be,label:"Repost",onClick:A,active:p,activeColorClass:"text-emerald-500"}),(0,t.jsx)(B,{icon:dt,label:"Comment",onClick:()=>document.getElementById("comment-input")?.focus()}),!N&&(0,t.jsx)(B,{icon:xe,label:"Share",onClick:()=>{navigator.clipboard.writeText(`${window.location.origin}/post/${s}`),n&&n("Link copied!")}})]})]}),(0,t.jsx)(pt,{currentUser:g,newComment:W,setNewComment:k,handleSubmitComment:vt,loading:O,selectedFiles:he,setSelectedFiles:Se,isUploading:ft}),(0,t.jsx)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:w?(0,t.jsx)("div",{className:"flex justify-center p-8",children:(0,t.jsx)(K,{className:"animate-spin text-violet-500"})}):(0,t.jsxs)(t.Fragment,{children:[ht&&L.length>0&&(0,t.jsxs)("button",{onClick:()=>oe(!0),disabled:Y,className:"flex w-full items-center justify-center gap-2 py-3 text-sm font-bold text-violet-600 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[Y&&(0,t.jsx)(K,{size:14,className:"animate-spin"}),"View more replies"]}),L.map(h=>(0,t.jsx)(ut,{...h,isComment:!0,onReply:jt,onUserClick:v,currentUser:g,showToast:n,onDelete:C=>D(P=>P.filter(R=>R.id!==C)),stats:{likes:h.stats?.likes||0,comments:h.stats?.comments||0,reposts:h.stats?.reposts||0},timeAgo:h.timeAgo||h.created_at},h.id))]})}),(0,t.jsx)(Xe,{open:_e,onOpenChange:ae,children:(0,t.jsxs)(Be,{onClick:h=>h.stopPropagation(),children:[(0,t.jsxs)(qe,{children:[(0,t.jsx)(Ge,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ke,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(Ze,{children:[(0,t.jsx)(He,{onClick:h=>h.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Ye,{onClick:Ee,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]}):(0,t.jsxs)("article",{onClick:f,className:`p-4 transition-all ${N?"border-b border-zinc-100/50 bg-transparent last:border-0 hover:bg-zinc-50/50 dark:border-zinc-800/50 dark:hover:bg-zinc-800/30":"mb-4 rounded-xl bg-white hover:shadow-md dark:bg-black"} ${f?"cursor-pointer":""}`,children:[b&&(0,t.jsxs)("div",{className:"mb-2 ml-1 flex items-center space-x-1.5 text-[13px] font-semibold text-zinc-600",children:[(0,t.jsx)(be,{size:14,className:"text-zinc-500"}),(0,t.jsxs)("span",{className:"flex cursor-pointer items-center text-zinc-700 hover:underline dark:text-zinc-300",onClick:h=>{h.stopPropagation(),v&&v(b.handle)},children:[b.handle," Reposted"]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsx)("div",{className:"shrink-0 cursor-pointer",onClick:h=>{h.stopPropagation(),v&&v(e.handle)},children:(0,t.jsxs)(Q,{className:"size-10 border border-zinc-200 dark:border-zinc-700",children:[(0,t.jsx)(J,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(X,{children:e.handle[0]?.toUpperCase()})]})}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex min-w-0 max-w-full items-center gap-1.5",children:[(0,t.jsxs)("button",{className:"flex shrink-0 items-center gap-1 text-[15px] font-bold text-zinc-900 hover:underline dark:text-white",onClick:h=>{h.stopPropagation(),v&&v(e.handle)},children:[(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:e.handle}),e.verified&&(0,t.jsx)(Qe,{size:14,className:"text-blue-500"})]}),j&&(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-1 text-zinc-500",children:[(0,t.jsx)(Je,{size:12,className:"shrink-0 text-zinc-400"}),(0,t.jsxs)("button",{className:"flex items-center gap-1 text-[13px] font-bold text-zinc-900 hover:underline dark:text-zinc-100",onClick:h=>{h.stopPropagation(),S(`/c/${j.handle}`)},children:[(0,t.jsxs)(Q,{className:"size-3.5 shrink-0 border border-zinc-200 bg-zinc-100 dark:border-zinc-700 dark:bg-zinc-800",children:[(0,t.jsx)(J,{src:j.avatar,alt:j.name,className:"object-cover"}),(0,t.jsx)(X,{className:"text-[6px] font-bold text-zinc-500",children:j.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:j.name})]})]}),(0,t.jsxs)("span",{className:"text-[13px] text-zinc-500 dark:text-zinc-400",children:["· ",a||"Recent"]})]})}),(0,t.jsx)("div",{className:"-mt-1 flex items-center",children:(0,t.jsx)(Le,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 group-hover:bg-zinc-100 dark:hover:bg-zinc-800 dark:group-hover:bg-zinc-800/50",children:(0,t.jsx)(je,{size:18})})})})]}),(0,t.jsx)("div",{className:"mt-0.5 whitespace-pre-line break-words text-[15px] leading-relaxed text-zinc-900 dark:text-zinc-100",children:Ue(l,r)}),me(l)&&(0,t.jsx)(tt,{url:me(l)}),We(c),u&&(0,t.jsx)(st,{poll:u}),i&&(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-900",onClick:h=>{h.stopPropagation(),S(`/post/${i.id}`)},children:(0,t.jsx)(at,{...i})}),(0,t.jsxs)("div",{className:"mt-3 flex items-center justify-between pr-4",children:[(0,t.jsx)(B,{icon:nt,count:F.comments,onClick:h=>{h?.stopPropagation(),y?y(e.handle):f&&f()},label:""}),(0,t.jsx)(B,{icon:be,count:F.reposts,onClick:A,active:p,activeColorClass:"text-emerald-500",label:""}),(0,t.jsx)(B,{icon:pe,count:F.likes,onClick:I,active:$,activeColorClass:"text-rose-500",label:""}),!N&&(0,t.jsx)(B,{icon:xe,onClick:h=>{h?.stopPropagation(),navigator.clipboard.writeText(`${window.location.origin}/post/${s}`),n&&n("Link copied!")},label:""})]})]})]}),(0,t.jsx)(Xe,{open:_e,onOpenChange:ae,children:(0,t.jsxs)(Be,{onClick:h=>h.stopPropagation(),children:[(0,t.jsxs)(qe,{children:[(0,t.jsx)(Ge,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ke,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(Ze,{children:[(0,t.jsx)(He,{onClick:h=>h.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Ye,{onClick:Ee,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})},Vs=ut,Bs=V(),qs=s=>{const e=(0,Bs.c)(30),{user:a,time:l,content:r}=s,c=ke();let i;e[0]!==a.avatar||e[1]!==a.handle?(i=(0,t.jsx)(J,{src:a.avatar,alt:a.handle}),e[0]=a.avatar,e[1]=a.handle,e[2]=i):i=e[2];let d;e[3]!==a.handle[0]?(d=a.handle[0]?.toUpperCase(),e[3]=a.handle[0],e[4]=d):d=e[4];let f;e[5]!==d?(f=(0,t.jsx)(X,{children:d}),e[5]=d,e[6]=f):f=e[6];let b;e[7]!==i||e[8]!==f?(b=(0,t.jsxs)(Q,{className:"size-6",children:[i,f]}),e[7]=i,e[8]=f,e[9]=b):b=e[9];let v;e[10]!==a.handle?(v=(0,t.jsx)("span",{className:"text-sm font-semibold",children:a.handle}),e[10]=a.handle,e[11]=v):v=e[11];let g;e[12]!==b||e[13]!==v?(g=(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[b,v]}),e[12]=b,e[13]=v,e[14]=g):g=e[14];let n;e[15]!==l?(n=(0,t.jsx)("span",{className:"text-xs text-zinc-500 sm:text-sm",children:l}),e[15]=l,e[16]=n):n=e[16];let u;e[17]!==g||e[18]!==n?(u=(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between gap-x-2",children:[g,n]}),e[17]=g,e[18]=n,e[19]=u):u=e[19];let x;e[20]!==c?(x={...we,render:y=>{const{attributes:j,content:S}=y,{href:$,...p}=j,F=window.location.origin;let M=null;return $.startsWith("/")?M=$:$.startsWith(F)&&(M=$.replace(F,"")),M?(0,t.jsx)("span",{...p,className:ue("cursor-pointer font-medium text-violet-600 hover:underline dark:text-violet-400",p.className),onClick:I=>{I.stopPropagation(),c(M)},children:S},S):(0,t.jsx)("a",{href:$,...p,target:"_blank",rel:"noopener noreferrer",className:ue("text-violet-600 hover:underline dark:text-violet-400",p.className),onClick:Hs,children:S},S)}},e[20]=c,e[21]=x):x=e[21];let m;e[22]!==r?(m=(0,t.jsx)("p",{className:"whitespace-pre-line text-sm text-zinc-800 dark:text-zinc-300",children:r}),e[22]=r,e[23]=m):m=e[23];let z;e[24]!==m||e[25]!==x?(z=(0,t.jsx)(Ne,{options:x,children:m}),e[24]=m,e[25]=x,e[26]=z):z=e[26];let N;return e[27]!==z||e[28]!==u?(N=(0,t.jsxs)("div",{className:"p-4",children:[u,z]}),e[27]=z,e[28]=u,e[29]=N):N=e[29],N},at=qs;function Hs(s){return s.stopPropagation()}var Gs=o.memo(({reel:s,isActive:e,isMuted:a})=>{const l=ke(),{currentUser:r}=mt(),{addToast:c}=xt(),i=(0,o.useRef)(null),[d,f]=(0,o.useState)(!1),[b,v]=(0,o.useState)(!1),[g,n]=(0,o.useState)(!1),[u,x]=(0,o.useState)(null),[m,z]=(0,o.useState)(!1),[N,y]=(0,o.useState)(s.stats?.likes||0),[j,S]=(0,o.useState)(!1),[$,p]=(0,o.useState)(0),F=(0,o.useRef)(null),M=(0,o.useMemo)(()=>Array.isArray(s.media)?s.media[0]?.src||s.media[0]?.url:s.media?.src||s.media?.url||s.url,[s.media,s.url]);(0,o.useEffect)(()=>{let k;const w=i.current?.plyr;return w&&(e?k=setTimeout(()=>{typeof w.play=="function"&&w.play().catch(()=>{w&&(w.muted=!0,w.play().catch(()=>{}))})},100):typeof w.pause=="function"&&w.pause()),()=>{k&&clearTimeout(k)}},[e]),(0,o.useEffect)(()=>{if(!r?.id||!e)return;(async()=>{try{const[w,_]=await Promise.all([ls(s.id,r.id),Zt(r.id,s.user?.id)]);z(w),S(_)}catch(w){console.error("Failed to check interaction status:",w)}})()},[s.id,r?.id,e,s.user?.id]),(0,o.useEffect)(()=>{const k=i.current?.plyr;k&&(k.muted=a)},[a]),(0,o.useEffect)(()=>{const k=i.current?.plyr;if(!k||!e)return;const w=()=>{const _=k.currentTime,O=k.duration;O>0&&p(_/O*100)};if(typeof k.on=="function")return k.on("timeupdate",w),()=>{typeof k.off=="function"&&k.off("timeupdate",w)}},[e]);const I=k=>{k.target.closest("button")||k.target.closest("a")||(F.current?(clearTimeout(F.current),F.current=null,E()):F.current=setTimeout(()=>{F.current=null,A()},200))},A=()=>{const k=i.current?.plyr;k&&(k.paused?(k.play().catch(()=>{}),x("play")):(k.pause(),x("pause")),setTimeout(()=>x(null),500))},E=async()=>{if(r&&(f(!0),setTimeout(()=>f(!1),800),!m)){z(!0),y(k=>k+1);try{await et(s.id,r.id)}catch{z(!1),y(k=>k-1)}}},U=async k=>{if(k.stopPropagation(),!r)return;const w=!m;z(w),y(_=>w?_+1:_-1);try{await et(s.id,r.id)}catch{z(!w),y(_=>w?_-1:_+1)}},L=async k=>{if(k.stopPropagation(),!r)return;const w=!j;S(w);try{await Gt(r.id,s.user?.id)}catch{S(!w)}},D=k=>{k.stopPropagation(),n(!0)},W=(0,o.useMemo)(()=>({source:{type:"video",sources:[{src:M,type:"video/mp4"}]},options:{controls:[],loop:{active:!0},clickToPlay:!0,ratio:"9:16"}}),[M]);return(0,t.jsxs)("div",{"data-id":s.id,className:"reel-item relative flex h-screen w-full snap-start items-center justify-center overflow-hidden bg-black cursor-pointer",onClick:I,children:[(0,t.jsx)("div",{className:"h-full w-full max-w-[450px]",children:(0,t.jsx)(rt,{ref:i,...W})}),d&&(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-in zoom-in-50 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)(pe,{size:120,fill:"white",className:"scale-125 text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.4)]"})})}),u&&(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-in fade-in zoom-in-90 scale-100 animate-out zoom-out-110 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)("div",{className:"rounded-full border border-white/20 bg-white/10 p-8 shadow-2xl backdrop-blur-md",children:u==="play"?(0,t.jsx)($t,{size:50,fill:"white",className:"ml-1.5 text-white"}):(0,t.jsx)(yt,{size:50,fill:"white",className:"text-white"})})})}),(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/60"}),(0,t.jsxs)("div",{className:"pointer-events-none absolute bottom-6 left-4 right-16 text-white",children:[(0,t.jsxs)("div",{className:"pointer-events-auto mb-3 flex items-center gap-2",children:[(0,t.jsxs)(zt,{to:`/u/${s.user?.handle}`,className:"flex items-center gap-2 transition-opacity hover:opacity-80",onClick:k=>k.stopPropagation(),children:[(0,t.jsxs)(Q,{className:"size-10 border-2 border-white",children:[(0,t.jsx)(J,{src:s.user?.avatar,alt:s.user?.handle,className:"object-cover"}),(0,t.jsx)(X,{children:s.user?.handle?.[0]?.toUpperCase()})]}),(0,t.jsxs)("span",{className:"font-bold",children:["@",s.user?.handle]})]}),r?.id!==s.user?.id&&(0,t.jsx)("button",{className:`ml-2 flex items-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-bold transition-all active:scale-95 ${j?"border border-white/50 bg-transparent text-white":"bg-white text-black hover:bg-zinc-200"}`,onClick:L,children:j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(cs,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Following"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(as,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Follow"})]})})]}),(0,t.jsx)(Ne,{options:{...we,render:({attributes:k,content:w})=>{const{href:_,...O}=k,q=!_.startsWith("/")&&(_.startsWith("http")||_.startsWith("www"));return _.startsWith("/u/")||_.startsWith("/tags/")||_.startsWith("/c/")||_.startsWith("/explore")?(0,t.jsx)("span",{...O,className:"cursor-pointer font-bold text-white hover:underline",onClick:Y=>{Y.stopPropagation(),l(_)},children:w},w):(0,t.jsx)("a",{href:_,...O,className:"text-white hover:underline",target:q?"_blank":void 0,rel:q?"noopener noreferrer":void 0,onClick:Y=>Y.stopPropagation(),children:w},w)}},children:(0,t.jsx)("p",{className:"mb-3 line-clamp-2 text-sm",children:s.content})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[(0,t.jsx)(Wt,{size:14,className:"animate-spin-slow"}),(0,t.jsxs)("span",{children:["Original Audio - ",s.user?.handle]})]})]}),(0,t.jsxs)("div",{className:"absolute bottom-6 right-2 z-10 flex flex-col items-center gap-6",children:[(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:`rounded-full p-3 backdrop-blur-md transition-all active:scale-90 ${m?"bg-rose-500/20 text-rose-500":"bg-zinc-800/50 text-white hover:bg-zinc-700"}`,onClick:U,children:(0,t.jsx)(pe,{size:28,fill:m?"currentColor":"none"})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:N})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700 active:scale-90",onClick:k=>{k.stopPropagation(),v(!0)},children:(0,t.jsx)(dt,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:s.stats?.comments||0})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700 active:scale-90",onClick:D,children:(0,t.jsx)(xe,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:s.stats?.shares||0})]})]}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 z-50 h-[3px] w-full bg-white/20",children:(0,t.jsx)("div",{className:"h-full bg-white shadow-[0_0_8px_rgba(255,255,255,0.8)] transition-all duration-100 ease-linear",style:{width:`${$}%`}})}),(0,t.jsx)(Xs,{isOpen:b,onClose:()=>v(!1),reelId:s.id,currentUser:r,showToast:c}),(0,t.jsx)(Ks,{isOpen:g,onClose:()=>n(!1),url:`${window.location.origin}/reels?id=${s.id}`,title:"Share Reel"})]})},(s,e)=>s.isActive===e.isActive&&s.reel.id===e.reel.id&&s.isMuted===e.isMuted),ra=Gs,Qs=({isOpen:s,onClose:e,reelId:a,currentUser:l,showToast:r})=>{const[c,i]=(0,o.useState)([]),[d,f]=(0,o.useState)(!1),[b,v]=(0,o.useState)(!1),[g,n]=(0,o.useState)(""),[u,x]=(0,o.useState)([]),[m,z]=(0,o.useState)(!1),[N,y]=(0,o.useState)(!0),[j,S]=(0,o.useState)(!1),$=(0,o.useRef)(c);(0,o.useEffect)(()=>{$.current=c},[c]);const p=(0,o.useCallback)(async(M=!1)=>{if(a){M?S(!0):f(!0);try{const I=$.current,A=await ot(a,M&&I.length>0?I[I.length-1].created_at:null,10);A.length<10?y(!1):y(!0),i(M?E=>[...E,...A]:A)}catch(I){console.error("Failed to load comments:",I),r&&r("Failed to load comments","error")}finally{f(!1),S(!1)}}},[a,r]);(0,o.useEffect)(()=>{s&&a?p():(i([]),y(!0))},[s,a,p]);const F=async M=>{if(M.preventDefault(),!(!g.trim()&&u.length===0||!l)){v(!0),z(!0);try{const I=[];for(const A of u){const E=await ze(A);I.push(E)}await lt(a,l.id,g,I),n(""),x([]),r&&r("Reply posted!"),p()}catch(I){console.error("Failed to post comment:",I),r&&r("Failed to post reply.","error")}finally{v(!1),z(!1)}}};return(0,t.jsx)(ct,{isOpen:s,onClose:e,title:"Comments",className:"max-sm:h-[95dvh] h-[85vh] overflow-hidden !p-0 sm:max-w-xl",children:(0,t.jsxs)("div",{className:"flex h-full flex-col overflow-hidden bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"mx-auto my-3 h-1.5 w-12 shrink-0 rounded-full bg-zinc-200 dark:bg-zinc-800 sm:hidden"}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto scroll-smooth scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800",children:d?(0,t.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,t.jsx)(K,{className:"animate-spin text-violet-500",size:32})}):c.length>0?(0,t.jsxs)("div",{className:"flex flex-col",children:[c.map(M=>(0,t.jsx)(Vs,{...M,isComment:!0,currentUser:l,showToast:r,onDelete:I=>i(A=>A.filter(E=>E.id!==I))},M.id)),N&&(0,t.jsxs)("button",{onClick:()=>p(!0),disabled:j,className:"flex w-full items-center justify-center gap-2 py-6 text-sm font-bold text-violet-600 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[j&&(0,t.jsx)(K,{size:16,className:"animate-spin"}),"View more replies"]})]}):(0,t.jsxs)("div",{className:"flex h-full min-h-[300px] flex-col items-center justify-center p-8 text-center text-zinc-500",children:[(0,t.jsx)("div",{className:"mb-4 flex size-16 items-center justify-center rounded-full bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(nt,{size:32,className:"text-zinc-400"})}),(0,t.jsx)("p",{className:"text-lg font-bold dark:text-zinc-300",children:"No comments yet"}),(0,t.jsx)("p",{className:"text-sm dark:text-zinc-500",children:"Be the first to share what you think!"})]})}),(0,t.jsx)("div",{className:"shrink-0 border-t border-zinc-100 bg-white pb-safe dark:border-zinc-800 dark:bg-zinc-900",children:(0,t.jsx)(pt,{currentUser:l,newComment:g,setNewComment:n,handleSubmitComment:F,loading:b,selectedFiles:u,setSelectedFiles:x,isUploading:m})})]})})},Xs=Qs,Js=({isOpen:s,onClose:e,url:a,title:l="Share"})=>{const[r,c]=(0,o.useState)(!1),[i,d]=(0,o.useState)(""),[f,b]=(0,o.useState)([]),[v,g]=(0,o.useState)(!1),[n,u]=(0,o.useState)(null),{addToast:x}=xt(),{currentUser:m}=mt(),z=(0,o.useCallback)(async()=>{if(m){g(!0);try{b(await Kt(m.id,null,10))}catch(p){console.error("Failed to fetch following:",p)}finally{g(!1)}}},[m?.id]);(0,o.useEffect)(()=>{s&&m?z():(d(""),b([]))},[s,m,z]);const N=(0,o.useCallback)(async()=>{if(m){g(!0);try{b((await ts(i)).filter(p=>p.id!==m.id))}catch(p){console.error("Search failed:",p)}finally{g(!1)}}},[i,m?.id]);(0,o.useEffect)(()=>{const p=setTimeout(()=>{i.trim()&&s?N():!i.trim()&&s&&z()},300);return()=>clearTimeout(p)},[i,s,N,z]);const y=async p=>{p&&p.stopPropagation();try{await navigator.clipboard.writeText(a),c(!0),x("Link copied to clipboard!","success"),setTimeout(()=>c(!1),2e3)}catch(F){console.error("Failed to copy:",F),x("Failed to copy link","error")}},j=async p=>{if(m){u(p.id);try{await os(await Xt(m.id,p.id),m.id,a,"text"),x(`Sent to ${p.name||p.handle}!`,"success")}catch(F){console.error("Failed to send message:",F),x("Failed to send message","error")}finally{u(null)}}},S=[{name:"X",icon:It,color:"bg-black text-white",href:`https://twitter.com/intent/tweet?url=${encodeURIComponent(a)}`},{name:"Facebook",icon:Mt,color:"bg-[#1877F2] text-white",href:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(a)}`},{name:"LinkedIn",icon:Vt,color:"bg-[#0A66C2] text-white",href:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(a)}`},{name:"WhatsApp",icon:Lt,color:"bg-[#25D366] text-white",href:`https://wa.me/?text=${encodeURIComponent(a)}`},{name:"Email",icon:Ut,color:"bg-zinc-600 text-white",href:`mailto:?body=${encodeURIComponent(a)}`}],$=async()=>{if(navigator.share)try{await navigator.share({title:l,url:a})}catch(p){p.name!=="AbortError"&&console.error("Native share failed:",p)}else y()};return(0,t.jsx)(ct,{isOpen:s,onClose:e,title:l,className:"max-w-[420px] !p-0 overflow-hidden",children:(0,t.jsxs)("div",{className:"flex h-full flex-col bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"px-5 pb-2 pt-4",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)(Tt,{className:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-zinc-400 transition-colors group-focus-within:text-violet-500"}),(0,t.jsx)("input",{type:"text",placeholder:"Search people...",value:i,onChange:p=>d(p.target.value),className:"w-full rounded-xl border-none bg-zinc-100 py-2.5 pl-10 pr-4 text-sm transition-all focus:ring-2 focus:ring-violet-500/20 outline-none dark:bg-zinc-800/50"})]})}),(0,t.jsx)("div",{className:"no-scrollbar flex min-h-[100px] items-center gap-4 overflow-x-auto px-5 py-4",children:v?(0,t.jsx)("div",{className:"flex flex-1 justify-center",children:(0,t.jsx)(K,{size:24,className:"animate-spin text-zinc-400"})}):f.length>0?f.map(p=>(0,t.jsxs)("button",{onClick:()=>j(p),disabled:n!==null,className:"group flex shrink-0 flex-col items-center gap-1.5 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"size-14 overflow-hidden rounded-full border-2 border-white shadow-sm transition-transform group-hover:scale-105 bg-zinc-100 dark:bg-zinc-800 dark:border-zinc-900",children:(0,t.jsx)("img",{src:p.avatar||`https://i.pravatar.cc/150?u=${p.id}`,alt:p.handle,className:"size-full object-cover"})}),n===p.id?(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-full bg-black/40",children:(0,t.jsx)(K,{size:16,className:"animate-spin text-white"})}):(0,t.jsx)("div",{className:"absolute bottom-0 right-0 size-3.5 rounded-full border-2 border-white bg-emerald-500 dark:border-zinc-900"})]}),(0,t.jsx)("span",{className:"max-w-[60px] truncate text-[10px] font-medium text-zinc-500 dark:text-zinc-400",children:p.name?.split(" ")[0]||p.handle})]},p.id)):(0,t.jsx)("div",{className:"flex-1 py-2 text-center",children:(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"No people found"})})}),(0,t.jsx)("div",{className:"mx-5 h-px bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsxs)("div",{className:"grid grid-cols-5 gap-2 px-5 py-6",children:[S.map(p=>(0,t.jsxs)("a",{href:p.href,target:"_blank",rel:"noopener noreferrer",className:"group flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:`size-12 ${p.color} flex items-center justify-center rounded-2xl shadow-md transition-all group-hover:-translate-y-1 group-hover:scale-110 group-hover:shadow-lg`,children:(0,t.jsx)(p.icon,{size:20,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-tighter text-zinc-500 dark:text-zinc-400",children:p.name})]},p.name)),(0,t.jsxs)("button",{onClick:$,className:"group flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:"flex size-12 items-center justify-center rounded-2xl border border-zinc-200 bg-zinc-100 text-zinc-600 shadow-sm transition-all group-hover:-translate-y-1 group-hover:scale-110 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-300",children:(0,t.jsx)(je,{size:20,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-tighter text-zinc-500 dark:text-zinc-400",children:"More"})]})]}),(0,t.jsx)("div",{className:"px-5 pb-6",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)("input",{type:"text",readOnly:!0,value:a,className:"w-full rounded-2xl border border-zinc-200 bg-zinc-50 py-3.5 pl-4 pr-14 text-sm font-medium transition-colors focus:outline-none group-hover:border-zinc-300 dark:border-zinc-800 dark:bg-zinc-950 dark:group-hover:border-zinc-700"}),(0,t.jsx)("button",{onClick:y,className:`absolute right-1.5 top-1/2 flex -translate-y-1/2 items-center gap-2 rounded-xl h-10 px-4 text-xs font-bold shadow-sm transition-all active:scale-95 ${r?"bg-emerald-500 text-white":"bg-zinc-900 text-white hover:opacity-90 dark:bg-white dark:text-zinc-900"}`,children:r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(_t,{size:14,strokeWidth:3}),(0,t.jsx)("span",{children:"Copied"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(St,{size:14,strokeWidth:3}),(0,t.jsx)("span",{children:"Copy"})]})})]})}),(0,t.jsx)("div",{className:"px-5 pb-5",children:(0,t.jsxs)("button",{onClick:e,className:"group relative flex w-full items-center justify-center overflow-hidden rounded-2xl bg-zinc-900 py-4 font-bold text-white transition-all hover:shadow-xl hover:shadow-zinc-900/10 active:scale-[0.98] dark:bg-white dark:text-zinc-900 dark:hover:shadow-white/10",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-zinc-500 to-zinc-600 opacity-0 transition-opacity duration-300 group-hover:opacity-100"}),(0,t.jsx)("div",{className:"relative flex items-center gap-2",children:(0,t.jsx)("span",{children:"Close"})})]})})]})})},Ks=Js;export{Vs as n,ra as t};
