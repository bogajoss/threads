import{a as ne}from"./rolldown-runtime-BaZ8gS7u.js";import{E as re,S as le,b as W,c as X,x as oe,y as ce}from"./framework-CsA6nn9m.js";import{a as ee,n as se,r as I,t as U}from"./query-QyXblnmD.js";import{$t as Z,Bt as ue,Ct as de,Et as fe,Ft as me,Gt as ge,Ht as he,It as ye,Kt as pe,Lt as Pe,Mt as ve,Ot as we,Rt as Ce,St as Me,Tt as be,Vt as Se,Zt as ae,bt as Fe,en as ie,ft as Le,gt as Y,ht as qe,i as _e,jt as ke,mt as $e,pt as te,qt as De,wt as Ne,xt as Re,yt as Qe}from"./index-Crzns8oK.js";var xe=X(),_=ne(re(),1);const at=(e,s,i,o)=>{const t=(0,xe.c)(92),a=ee();let n;t[0]!==s?(n=s||{comments:0,likes:0,mirrors:0,reposts:0},t[0]=s,t[1]=n):n=t[1];const[h,l]=(0,_.useState)(n);let L,r;t[2]!==s?(L=()=>{s&&l(y=>({...y,...s}))},r=[s],t[2]=s,t[3]=L,t[4]=r):(L=t[3],r=t[4]),(0,_.useEffect)(L,r);const m=i?.id;let M;t[5]!==e||t[6]!==m?(M=["post",e,"liked",m],t[5]=e,t[6]=m,t[7]=M):M=t[7];let w;t[8]!==i?.id||t[9]!==e?(w=()=>ke(e,i?.id),t[8]=i?.id,t[9]=e,t[10]=w):w=t[10];let d;t[11]!==i||t[12]!==e?(d=!!i&&Z(e)&&Z(i.id),t[11]=i,t[12]=e,t[13]=d):d=t[13];let g;t[14]!==M||t[15]!==w||t[16]!==d?(g={queryKey:M,queryFn:w,enabled:d,staleTime:6e5},t[14]=M,t[15]=w,t[16]=d,t[17]=g):g=t[17];const{data:k}=I(g),S=k===void 0?!1:k,p=i?.id;let P;t[18]!==e||t[19]!==p?(P=["post",e,"reposted",p],t[18]=e,t[19]=p,t[20]=P):P=t[20];let C;t[21]!==i?.id||t[22]!==e?(C=()=>ve(e,i?.id),t[21]=i?.id,t[22]=e,t[23]=C):C=t[23];let F;t[24]!==i||t[25]!==e?(F=!!i&&Z(e)&&Z(i.id),t[24]=i,t[25]=e,t[26]=F):F=t[26];let c;t[27]!==P||t[28]!==C||t[29]!==F?(c={queryKey:P,queryFn:C,enabled:F,staleTime:6e5},t[27]=P,t[28]=C,t[29]=F,t[30]=c):c=t[30];const{data:v}=I(c),$=v===void 0?!1:v;let b;t[31]!==i?.id||t[32]!==e?(b=()=>Se(e,i?.id),t[31]=i?.id,t[32]=e,t[33]=b):b=t[33];let N;t[34]!==i?.id||t[35]!==e||t[36]!==a?(N=async()=>{await a.cancelQueries({queryKey:["post",e,"liked",i?.id]});const y=a.getQueryData(["post",e,"liked",i?.id]);return a.setQueryData(["post",e,"liked",i?.id],!y),l(R=>({...R,likes:y?(R.likes||0)-1:(R.likes||0)+1})),{previousLiked:y}},t[34]=i?.id,t[35]=e,t[36]=a,t[37]=N):N=t[37];let u;t[38]!==i?.id||t[39]!==e||t[40]!==a||t[41]!==o?(u=(y,R,K)=>{K?.previousLiked!==void 0&&(a.setQueryData(["post",e,"liked",i?.id],K.previousLiked),l(V=>({...V,likes:K.previousLiked?(V.likes||0)+1:(V.likes||0)-1}))),o("Failed to update like","error")},t[38]=i?.id,t[39]=e,t[40]=a,t[41]=o,t[42]=u):u=t[42];let D;t[43]!==i?.id||t[44]!==e||t[45]!==a?(D=()=>{a.invalidateQueries({queryKey:["post",e,"liked",i?.id]})},t[43]=i?.id,t[44]=e,t[45]=a,t[46]=D):D=t[46];let x;t[47]!==b||t[48]!==N||t[49]!==u||t[50]!==D?(x={mutationFn:b,onMutate:N,onError:u,onSettled:D},t[47]=b,t[48]=N,t[49]=u,t[50]=D,t[51]=x):x=t[51];const E=se(x);let q;t[52]!==i?.id||t[53]!==e?(q=()=>he(e,i?.id),t[52]=i?.id,t[53]=e,t[54]=q):q=t[54];let f;t[55]!==i?.id||t[56]!==e||t[57]!==a?(f=async()=>{await a.cancelQueries({queryKey:["post",e,"reposted",i?.id]});const y=a.getQueryData(["post",e,"reposted",i?.id]);return a.setQueryData(["post",e,"reposted",i?.id],!y),l(R=>({...R,reposts:y?(R.reposts||0)-1:(R.reposts||0)+1,mirrors:y?(R.mirrors||0)-1:(R.mirrors||0)+1})),{previousReposted:y}},t[55]=i?.id,t[56]=e,t[57]=a,t[58]=f):f=t[58];let Q;t[59]!==i?.id||t[60]!==e||t[61]!==a||t[62]!==o?(Q=(y,R,K)=>{K?.previousReposted!==void 0&&(a.setQueryData(["post",e,"reposted",i?.id],K.previousReposted),l(V=>({...V,reposts:K.previousReposted?(V.reposts||0)+1:(V.reposts||0)-1,mirrors:K.previousReposted?(V.mirrors||0)+1:(V.mirrors||0)-1}))),o("Failed to update repost","error")},t[59]=i?.id,t[60]=e,t[61]=a,t[62]=o,t[63]=Q):Q=t[63];let A;t[64]!==i?.id||t[65]!==e||t[66]!==a?(A=()=>{a.invalidateQueries({queryKey:["post",e,"reposted",i?.id]})},t[64]=i?.id,t[65]=e,t[66]=a,t[67]=A):A=t[67];let T;t[68]!==o?(T=y=>{o(y?"Reposted!":"Removed repost")},t[68]=o,t[69]=T):T=t[69];let O;t[70]!==q||t[71]!==f||t[72]!==Q||t[73]!==A||t[74]!==T?(O={mutationFn:q,onMutate:f,onError:Q,onSettled:A,onSuccess:T},t[70]=q,t[71]=f,t[72]=Q,t[73]=A,t[74]=T,t[75]=O):O=t[75];const B=se(O);let z;t[76]!==i||t[77]!==E||t[78]!==e||t[79]!==o?(z=async y=>{if(y&&y.stopPropagation(),!i)return o("Please login to like!","error");!Z(e)||!Z(i.id)||E.mutate()},t[76]=i,t[77]=E,t[78]=e,t[79]=o,t[80]=z):z=t[80];const j=z;let H;t[81]!==i||t[82]!==e||t[83]!==B||t[84]!==o?(H=async y=>{if(y&&y.stopPropagation(),!i)return o("Please login to repost!","error");!Z(e)||!Z(i.id)||B.mutate()},t[81]=i,t[82]=e,t[83]=B,t[84]=o,t[85]=H):H=t[85];const G=H;let J;return t[86]!==j||t[87]!==G||t[88]!==S||t[89]!==$||t[90]!==h?(J={liked:S,reposted:$,localStats:h,setLocalStats:l,handleLike:j,handleRepost:G},t[86]=j,t[87]=G,t[88]=S,t[89]=$,t[90]=h,t[91]=J):J=t[91],J};var Ee=X();const nt=e=>{const s=(0,Ee.c)(5);let i;s[0]!==e?(i=()=>ae(e),s[0]=e,s[1]=i):i=s[1];const[o,t]=(0,_.useState)(i);let a,n;return s[2]!==e?(a=()=>{if(!e)return;const h=setTimeout(()=>{t(ae(e))},0),l=setInterval(()=>{t(ae(e))},6e4);return()=>{clearTimeout(h),clearInterval(l)}},n=[e],s[2]=e,s[3]=a,s[4]=n):(a=s[3],n=s[4]),(0,_.useEffect)(a,n),o},rt=()=>{const{handle:e}=oe(),s=W(),{currentUser:i,getProfileByHandle:o}=Y(),{addToast:t}=te(),{data:a,isLoading:n}=I({queryKey:["profile",e],queryFn:()=>o(e),enabled:!!e,staleTime:1e3*60*5}),[h,l]=(0,_.useState)("feed"),{data:L,fetchNextPage:r,hasNextPage:m,isFetchingNextPage:M,isLoading:w}=U({queryKey:["posts","user",a?.id],queryFn:({pageParam:f})=>Pe(a?.id,f,10),enabled:!!a?.id,initialPageParam:null,getNextPageParam:f=>{if(!(!f||f.length<10))return f[f.length-1].sort_timestamp||f[f.length-1].created_at}}),d=(0,_.useMemo)(()=>L?.pages.flatMap(f=>f)||[],[L]),[g,k]=(0,_.useState)(!1),[S,p]=(0,_.useState)("Followers"),[P,C]=(0,_.useState)([]),[F,c]=(0,_.useState)(!1),[v,$]=(0,_.useState)(!1),[b,N]=(0,_.useState)(!0),u=async(f,Q=!1)=>{const A=a?.id;if(A){Q?$(!0):(p(f),k(!0),c(!0),C([]));try{const T=Q&&P.length>0?P[P.length-1].followed_at:null,O=f==="Followers"?await ge(A,T,10):await pe(A,T,10);O.length<10?N(!1):N(!0),C(Q?B=>[...B,...O]:O)}catch(T){console.error(`Failed to fetch ${f}:`,T),t(`Failed to load ${f}`)}finally{c(!1),$(!1)}}},D=(0,_.useMemo)(()=>h==="feed"?d.filter(f=>f.community_id===null&&f.parent_id===null):h==="media"?d.filter(f=>f.community_id===null&&f.parent_id===null&&(f.type==="video"||f.type==="image"||f.media&&f.media.length>0)):h==="collections"?[]:d,[d,h]);return{handle:e,profile:a,loading:n,userPosts:d,setUserPosts:()=>console.warn("setUserPosts is deprecated"),activeProfileTab:h,setActiveProfileTab:l,loadingPosts:w,isFetchingMorePosts:M,hasMorePosts:m,filteredPosts:D,isFollowModalOpen:g,setIsFollowModalOpen:k,followModalType:S,followListData:P,isListLoading:F,isFetchingMoreFollows:v,hasMoreFollows:b,openFollowModal:u,handlePostClick:f=>{s(`/post/${f}`)},handleUserClick:f=>{f!==e&&s(`/u/${f}`)},loadUserPosts:(f=!1)=>{r()},currentUser:i,addToast:t,navigate:s}};var Te=X();const lt=()=>{const e=(0,Te.c)(74),{handle:s}=oe(),i=W(),{currentUser:o}=Y(),{addToast:t}=te(),a=ee();let n,h;e[0]!==s?(n=["community",s],h=()=>Re(s),e[0]=s,e[1]=n,e[2]=h):(n=e[1],h=e[2]);const l=!!s;let L;e[3]!==n||e[4]!==h||e[5]!==l?(L={queryKey:n,queryFn:h,enabled:l,staleTime:6e5},e[3]=n,e[4]=h,e[5]=l,e[6]=L):L=e[6];const{data:r,isLoading:m}=I(L),M=r?.id,w=o?.id;let d;e[7]!==M||e[8]!==w?(d=["community",M,"membership",w],e[7]=M,e[8]=w,e[9]=d):d=e[9];let g;e[10]!==r?.id||e[11]!==o?.id?(g=()=>Qe(r?.id,o?.id),e[10]=r?.id,e[11]=o?.id,e[12]=g):g=e[12];const k=!!r?.id&&!!o?.id;let S;e[13]!==d||e[14]!==g||e[15]!==k?(S={queryKey:d,queryFn:g,enabled:k,staleTime:3e5},e[13]=d,e[14]=g,e[15]=k,e[16]=S):S=e[16];const{data:p}=I(S),P=!!p,C=p?.role||null,F=r?.id;let c;e[17]!==F?(c=["posts","community",F],e[17]=F,e[18]=c):c=e[18];let v;e[19]!==r?.id?(v=y=>{const{pageParam:R}=y;return Me(r?.id,R,10)},e[19]=r?.id,e[20]=v):v=e[20];const $=!!r?.id;let b;e[21]!==c||e[22]!==v||e[23]!==$?(b={queryKey:c,queryFn:v,enabled:$,initialPageParam:null,getNextPageParam:Ke},e[21]=c,e[22]=v,e[23]=$,e[24]=b):b=e[24];const{data:N,fetchNextPage:u,hasNextPage:D,isFetchingNextPage:x,isLoading:E}=U(b);let q;e[25]!==N?.pages?(q=N?.pages.flatMap(Ae)||[],e[25]=N?.pages,e[26]=q):q=e[26];const f=q;let Q;e[27]!==r?.id||e[28]!==o?.id?(Q=()=>de(r?.id,o?.id),e[27]=r?.id,e[28]=o?.id,e[29]=Q):Q=e[29];let A;e[30]!==r?.id||e[31]!==o?.id||e[32]!==s||e[33]!==a?(A=async()=>{await a.cancelQueries({queryKey:["community",r?.id,"membership",o?.id]}),await a.cancelQueries({queryKey:["community",s]});const y=a.getQueryData(["community",r?.id,"membership",o?.id]),R=a.getQueryData(["community",s]);return a.setQueryData(["community",r?.id,"membership",o?.id],y?null:{role:"member"}),a.setQueryData(["community",s],K=>K&&{...K,membersCount:y?K.membersCount-1:K.membersCount+1}),{previousMembership:y,previousCommunity:R}},e[30]=r?.id,e[31]=o?.id,e[32]=s,e[33]=a,e[34]=A):A=e[34];let T;e[35]!==t||e[36]!==r?.id||e[37]!==o?.id||e[38]!==s||e[39]!==a?(T=(y,R,K)=>{K?.previousMembership!==void 0&&a.setQueryData(["community",r?.id,"membership",o?.id],K.previousMembership),K?.previousCommunity&&a.setQueryData(["community",s],K.previousCommunity),t("Failed to update membership","error")},e[35]=t,e[36]=r?.id,e[37]=o?.id,e[38]=s,e[39]=a,e[40]=T):T=e[40];let O;e[41]!==r?.id||e[42]!==o?.id||e[43]!==s||e[44]!==a?(O=()=>{a.invalidateQueries({queryKey:["community",r?.id,"membership",o?.id]}),a.invalidateQueries({queryKey:["community",s]})},e[41]=r?.id,e[42]=o?.id,e[43]=s,e[44]=a,e[45]=O):O=e[45];let B;e[46]!==t||e[47]!==r?(B=y=>{r&&t(y?`Joined ${r.name}`:`Left ${r.name}`)},e[46]=t,e[47]=r,e[48]=B):B=e[48];let z;e[49]!==Q||e[50]!==A||e[51]!==T||e[52]!==O||e[53]!==B?(z={mutationFn:Q,onMutate:A,onError:T,onSettled:O,onSuccess:B},e[49]=Q,e[50]=A,e[51]=T,e[52]=O,e[53]=B,e[54]=z):z=e[54];const j=se(z);let H;e[55]!==t||e[56]!==o||e[57]!==j?(H=async()=>{if(!o)return t("Please login to join communities","error");j.mutate()},e[55]=t,e[56]=o,e[57]=j,e[58]=H):H=e[58];const G=H;let J;return e[59]!==t||e[60]!==r||e[61]!==f||e[62]!==o||e[63]!==u||e[64]!==G||e[65]!==D||e[66]!==x||e[67]!==P||e[68]!==j.isPending||e[69]!==m||e[70]!==E||e[71]!==i||e[72]!==C?(J={community:r,loading:m,isMember:P,userRole:C,isJoining:j.isPending,communityPosts:f,loadingPosts:E,isFetchingMorePosts:x,hasMorePosts:D,handleJoinToggle:G,loadCommunityPosts:u,currentUser:o,addToast:t,navigate:i},e[59]=t,e[60]=r,e[61]=f,e[62]=o,e[63]=u,e[64]=G,e[65]=D,e[66]=x,e[67]=P,e[68]=j.isPending,e[69]=m,e[70]=E,e[71]=i,e[72]=C,e[73]=J):J=e[73],J};function Ke(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function Ae(e){return e}const ct=()=>{const{currentUser:e}=Y(),s=W(),i=ce(),o=new URLSearchParams(i.search),t=o.get("q")||"",a=o.get("tab")||(t?"posts":"communities"),[n,h]=(0,_.useState)(t),[l,L]=(0,_.useState)(a),[r,m]=(0,_.useState)(!1);(0,_.useEffect)(()=>{t!==n&&(h(t),t&&L("posts"))},[t]);const{data:M,fetchNextPage:w,hasNextPage:d,isFetchingNextPage:g,isLoading:k}=U({queryKey:["explore","communities"],queryFn:({pageParam:u})=>Fe(u,10),initialPageParam:null,getNextPageParam:u=>{if(!(!u||u.length<10))return u[u.length-1].createdAt}}),S=(0,_.useMemo)(()=>M?.pages.flatMap(u=>u)||[],[M]),{data:p,fetchNextPage:P,hasNextPage:C,isFetchingNextPage:F,isLoading:c}=U({queryKey:["explore","posts",n],queryFn:({pageParam:u})=>n?ue(n,u,10,!0):me(u,10),initialPageParam:null,getNextPageParam:u=>{if(!(!u||u.length<10))return u[u.length-1].sort_timestamp||u[u.length-1].sortTimestamp}}),v=(0,_.useMemo)(()=>p?.pages.flatMap(u=>u)||[],[p]),$=(0,_.useMemo)(()=>{let u=S;return n&&(u=u.filter(D=>D.name?.toLowerCase().includes(n.toLowerCase())||D.handle?.toLowerCase().includes(n.toLowerCase()))),u},[S,n]);return{currentUser:e,searchQuery:n,setSearchQuery:u=>{h(u)},activeTab:l,setActiveTab:L,isCreateModalOpen:r,setIsCreateModalOpen:m,communitiesData:S,isCommunitiesLoading:k,isFetchingMoreCommunities:g,hasMoreCommunities:d,postsData:v,isPostsLoading:c,isFetchingMorePosts:F,hasMorePosts:C,filteredCommunities:$,handleCommunityClick:u=>{s(`/c/${u}`)},loadCommunities:w,loadPosts:P,navigate:s}};var Oe=X();const ut=()=>{const e=(0,Oe.c)(21),{currentUser:s}=Y(),{posts:i,loading:o,hasMore:t,isFetchingNextPage:a,fetchNextPage:n}=Le(),{addToast:h}=te(),l=W();let L;e[0]===Symbol.for("react.memo_cache_sentinel")?(L={queryKey:["stories"],queryFn:Ne},e[0]=L):L=e[0];const{data:r,isLoading:m}=I(L);let M;e[1]!==r?(M=r===void 0?[]:r,e[1]=r,e[2]=M):M=e[2];const w=M;let d;if(e[3]!==w){const c={};w.forEach(v=>{if(!v.user)return;const $=v.user.id;c[$]||(c[$]={user:v.user,stories:[]}),c[$].stories.push(v)}),d=Object.values(c),e[3]=w,e[4]=d}else d=e[4];const g=d,k=i;let S;e[5]!==l?(S=c=>{l(`/post/${c}`)},e[5]=l,e[6]=S):S=e[6];const p=S;let P;e[7]!==l?(P=c=>{l(`/u/${c}`)},e[7]=l,e[8]=P):P=e[8];const C=P;let F;return e[9]!==h||e[10]!==s||e[11]!==n||e[12]!==g||e[13]!==p||e[14]!==C||e[15]!==t||e[16]!==k||e[17]!==a||e[18]!==o||e[19]!==m?(F={currentUser:s,homePosts:k,groupedStories:g,isPostsLoading:o,isStoriesLoading:m,hasMore:t,isFetchingNextPage:a,fetchNextPage:n,addToast:h,handlePostClick:p,handleUserClick:C},e[9]=h,e[10]=s,e[11]=n,e[12]=g,e[13]=p,e[14]=C,e[15]=t,e[16]=k,e[17]=a,e[18]=o,e[19]=m,e[20]=F):F=e[20],F};var Be=X();const dt=()=>{const e=(0,Be.c)(56),{id:s}=oe(),i=W(),{currentUser:o}=Y(),{onlineUsers:t}=qe(),a=ee(),[n,h]=(0,_.useState)("");let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=[],e[0]=l):l=e[0];const[L,r]=(0,_.useState)(l),{conversations:m,isConvLoading:M,sendMessage:w,sendTypingStatus:d,typingStatus:g,markAsRead:k,formatMessages:S,conversationReactions:p,messages:P,isMsgLoading:C,fetchNextMessages:F,hasMoreMessages:c,isFetchingMoreMessages:v}=_e(o,s);let $;e:{if(!s||m.length===0){$=null;break e}let y;e[1]!==m||e[2]!==s?(y=m.find(R=>R.id===s)||null,e[1]=m,e[2]=s,e[3]=y):y=e[3],$=y}const b=$;let N,u;e[4]!==s||e[5]!==k?(N=()=>{s&&k(s)},u=[s,k],e[4]=s,e[5]=k,e[6]=N,e[7]=u):(N=e[6],u=e[7]),(0,_.useEffect)(N,u);let D;e[8]!==m||e[9]!==o?.id||e[10]!==n?(D=()=>{const y=setTimeout(async()=>{if(n.length>1){const R=await De(n),K=m.map(je);r(R.filter(V=>V.id!==o?.id&&!K.includes(V.id)))}else r([])},300);return()=>clearTimeout(y)},e[8]=m,e[9]=o?.id,e[10]=n,e[11]=D):D=e[11];const x=o?.id;let E;e[12]!==m||e[13]!==n||e[14]!==x?(E=[n,m,x],e[12]=m,e[13]=n,e[14]=x,e[15]=E):E=e[15],(0,_.useEffect)(D,E);let q;e[16]!==o||e[17]!==i||e[18]!==a?(q=async y=>{if(o)try{const R=await we(o.id,y.id);a.invalidateQueries({queryKey:["conversations",o.id]}),h(""),i(`/messages/${R}`)}catch(R){console.error("Failed to start conversation:",R)}},e[16]=o,e[17]=i,e[18]=a,e[19]=q):q=e[19];const f=q;let Q;e[20]!==i?(Q=y=>{i(`/messages/${y.id}`)},e[20]=i,e[21]=Q):Q=e[21];const A=Q;let T;e[22]!==p||e[23]!==S||e[24]!==P?(T=S(P,p),e[22]=p,e[23]=S,e[24]=P,e[25]=T):T=e[25];const O=T;let B;if(e[26]!==m||e[27]!==n){let y;e[29]!==n?(y=R=>R.user?.name?.toLowerCase().includes(n.toLowerCase())||R.user?.handle?.toLowerCase().includes(n.toLowerCase())||R.lastMessage?.toLowerCase().includes(n.toLowerCase()),e[29]=n,e[30]=y):y=e[30],B=m.filter(y),e[26]=m,e[27]=n,e[28]=B}else B=e[28];const z=B,j=b&&g[b.id];let H;e[31]!==t||e[32]!==b?(H=b&&b.user?.id&&t.has(b.user.id),e[31]=t,e[32]=b,e[33]=H):H=e[33];const G=H;let J;return e[34]!==m||e[35]!==j||e[36]!==o||e[37]!==F||e[38]!==z||e[39]!==A||e[40]!==f||e[41]!==c||e[42]!==s||e[43]!==M||e[44]!==v||e[45]!==C||e[46]!==O||e[47]!==n||e[48]!==i||e[49]!==t||e[50]!==G||e[51]!==b||e[52]!==w||e[53]!==d||e[54]!==L?(J={id:s,currentUser:o,onlineUsers:t,msgSearchQuery:n,setMsgSearchQuery:h,userSearchResults:L,conversations:m,filteredConversations:z,selectedConversation:b,localMessages:O,isConvLoading:M,isMsgLoading:C,currentIsTyping:j,otherUserIsOnline:G,handleStartConversation:f,handleSelectConversation:A,sendMessage:w,sendTypingStatus:d,navigate:i,fetchNextMessages:F,hasMoreMessages:c,isFetchingMoreMessages:v},e[34]=m,e[35]=j,e[36]=o,e[37]=F,e[38]=z,e[39]=A,e[40]=f,e[41]=c,e[42]=s,e[43]=M,e[44]=v,e[45]=C,e[46]=O,e[47]=n,e[48]=i,e[49]=t,e[50]=G,e[51]=b,e[52]=w,e[53]=d,e[54]=L,e[55]=J):J=e[55],J};function je(e){return e.user?.id}var He=X();const ft=()=>{const e=(0,He.c)(47),{currentUser:s}=Y(),i=W(),o=ee(),t=s?.id;let a;e[0]!==t?(a=["notifications",t],e[0]=t,e[1]=a):a=e[1];let n;e[2]!==s?.id?(n=q=>{const{pageParam:f}=q;return be(s?.id,f,10)},e[2]=s?.id,e[3]=n):n=e[3];const h=!!s?.id;let l;e[4]!==a||e[5]!==n||e[6]!==h?(l={queryKey:a,queryFn:n,enabled:h,initialPageParam:null,getNextPageParam:Je},e[4]=a,e[5]=n,e[6]=h,e[7]=l):l=e[7];const{data:L,fetchNextPage:r,hasNextPage:m,isFetchingNextPage:M,isLoading:w}=U(l);let d;e[8]!==L?.pages?(d=L?.pages.flatMap(ze)||[],e[8]=L?.pages,e[9]=d):d=e[9];const g=d;let k;e[10]!==s||e[11]!==o?(k=()=>{if(!s?.id)return;const q=ie.channel(`user_notifications:${s.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${s.id}`},()=>{o.invalidateQueries({queryKey:["notifications",s.id]})}).subscribe();return()=>{ie.removeChannel(q)}},e[10]=s,e[11]=o,e[12]=k):k=e[12];const S=s?.id;let p;e[13]!==o||e[14]!==S?(p=[S,o],e[13]=o,e[14]=S,e[15]=p):p=e[15],(0,_.useEffect)(k,p);let P;e[16]!==s?(P=()=>s?fe(s.id):Promise.resolve(),e[16]=s,e[17]=P):P=e[17];let C,F,c;e[18]!==s?.id||e[19]!==o?(C=async()=>{await o.cancelQueries({queryKey:["notifications",s?.id]});const q=o.getQueryData(["notifications",s?.id]);return o.setQueryData(["notifications",s?.id],Ze),{previousNotifications:q}},F=(q,f,Q)=>{Q?.previousNotifications&&o.setQueryData(["notifications",s?.id],Q.previousNotifications)},c=()=>{o.invalidateQueries({queryKey:["notifications",s?.id]})},e[18]=s?.id,e[19]=o,e[20]=C,e[21]=F,e[22]=c):(C=e[20],F=e[21],c=e[22]);let v;e[23]!==C||e[24]!==F||e[25]!==c||e[26]!==P?(v={mutationFn:P,onMutate:C,onError:F,onSettled:c},e[23]=C,e[24]=F,e[25]=c,e[26]=P,e[27]=v):v=e[27];const $=se(v);let b;e[28]!==i?(b=q=>{q.type==="follow"?i(`/u/${q.user}`):q.post_id&&i(`/post/${q.post_id}`)},e[28]=i,e[29]=b):b=e[29];const N=b;let u;e[30]!==s?.id||e[31]!==$||e[32]!==g?(u=()=>{s?.id&&g.some(We)&&$.mutate()},e[30]=s?.id,e[31]=$,e[32]=g,e[33]=u):u=e[33];const D=s?.id;let x;e[34]!==$||e[35]!==g.length||e[36]!==D?(x=[D,g.length,$],e[34]=$,e[35]=g.length,e[36]=D,e[37]=x):x=e[37],(0,_.useEffect)(u,x);let E;return e[38]!==s||e[39]!==r||e[40]!==N||e[41]!==m||e[42]!==M||e[43]!==w||e[44]!==i||e[45]!==g?(E={currentUser:s,notifications:g,isLoading:w,isFetchingMore:M,hasMore:m,loadNotifications:r,handleNotificationClick:N,navigate:i},e[38]=s,e[39]=r,e[40]=N,e[41]=m,e[42]=M,e[43]=w,e[44]=i,e[45]=g,e[46]=E):E=e[46],E};function Je(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function ze(e){return e}function Ve(e){return{...e,is_read:!0}}function Ge(e){return e.map(Ve)}function Ze(e){return e&&{...e,pages:e.pages.map(Ge)}}function We(e){return!e.is_read}var Xe=X();const mt=()=>{const e=(0,Xe.c)(23),{id:s}=oe(),i=W(),{currentUser:o}=Y(),{addToast:t}=te(),a=ee();let n,h;e[0]!==s?(n=["post",s],h=async()=>{if(!s||!Z(s))throw new Error("Invalid post ID");return ye(s)},e[0]=s,e[1]=n,e[2]=h):(n=e[1],h=e[2]);const l=!!s;let L;e[3]!==n||e[4]!==h||e[5]!==l?(L={queryKey:n,queryFn:h,enabled:l,retry:!1},e[3]=n,e[4]=h,e[5]=l,e[6]=L):L=e[6];const{data:r,isLoading:m,isError:M}=I(L);let w;e[7]!==i?(w=C=>{i(`/u/${C}`)},e[7]=i,e[8]=w):w=e[8];const d=w;let g;e[9]!==i?(g=()=>{i(-1)},e[9]=i,e[10]=g):g=e[10];const k=g;let S;e[11]!==a?(S=(C,F,c)=>{a.setQueryData(["post",C],v=>v&&{...v,content:F,media:c})},e[11]=a,e[12]=S):S=e[12];const p=S;let P;return e[13]!==t||e[14]!==o||e[15]!==k||e[16]!==p||e[17]!==d||e[18]!==M||e[19]!==m||e[20]!==i||e[21]!==r?(P={post:r,isLoading:m,isError:M,currentUser:o,addToast:t,navigate:i,handleUserClick:d,handleDelete:k,handleUpdate:p},e[13]=t,e[14]=o,e[15]=k,e[16]=p,e[17]=d,e[18]=M,e[19]=m,e[20]=i,e[21]=r,e[22]=P):P=e[22],P};var Ye=X();const gt=()=>{const e=(0,Ye.c)(31),s=W(),[i]=le();let o;e[0]!==i?(o=i.get("id"),e[0]=i,e[1]=o):o=e[1];const t=o,a=(0,_.useRef)(null),[n,h]=(0,_.useState)(null),[l,L]=(0,_.useState)(!0);let r;e[2]===Symbol.for("react.memo_cache_sentinel")?(r=["reels"],e[2]=r):r=e[2];let m;e[3]===Symbol.for("react.memo_cache_sentinel")?(m={queryKey:r,queryFn:Ie,initialPageParam:null,getNextPageParam:Ue},e[3]=m):m=e[3];const{data:M,fetchNextPage:w,hasNextPage:d,isFetchingNextPage:g,isLoading:k}=U(m);let S;e[4]!==M?.pages?(S=M?.pages.flatMap(et)||[],e[4]=M?.pages,e[5]=S):S=e[5];const p=S;let P,C;e[6]!==n||e[7]!==p||e[8]!==t?(P=()=>{p.length>0&&(t&&p.find(D=>D.id===t)?(h(t),setTimeout(()=>{document.querySelector(`[data-id="${t}"]`)?.scrollIntoView({behavior:"instant"})},100)):n||h(p[0].id))},C=[p,t,n],e[6]=n,e[7]=p,e[8]=t,e[9]=P,e[10]=C):(P=e[9],C=e[10]),(0,_.useEffect)(P,C);let F,c;e[11]!==p.length?(F=()=>{if(p.length===0)return;const D={root:a.current,threshold:.6},x=q=>{q.forEach(f=>{f.isIntersecting&&h(f.target.dataset.id)})},E=new IntersectionObserver(x,D);return setTimeout(()=>{document.querySelectorAll(".reel-item").forEach(q=>E.observe(q))},100),()=>E.disconnect()},c=[p.length],e[11]=p.length,e[12]=F,e[13]=c):(F=e[12],c=e[13]),(0,_.useEffect)(F,c);let v;e[14]!==l?(v=()=>{L(!l)},e[14]=l,e[15]=v):v=e[15];const $=v;let b,N;e[16]!==w||e[17]!==d||e[18]!==g?(N=()=>{const D=()=>{if(!a.current||g||!d)return;const{scrollTop:E,scrollHeight:q,clientHeight:f}=a.current;E+f>=q-800&&w()},x=a.current;if(x)return x.addEventListener("scroll",D),()=>x.removeEventListener("scroll",D)},b=[g,d,w],e[16]=w,e[17]=d,e[18]=g,e[19]=b,e[20]=N):(b=e[19],N=e[20]),(0,_.useEffect)(N,b);let u;return e[21]!==n||e[22]!==w||e[23]!==d||e[24]!==g||e[25]!==k||e[26]!==l||e[27]!==s||e[28]!==p||e[29]!==$?(u={reels:p,loading:k,loadingMore:g,activeReelId:n,hasMore:d,isMuted:l,containerRef:a,navigate:s,toggleMute:$,loadReels:w},e[21]=n,e[22]=w,e[23]=d,e[24]=g,e[25]=k,e[26]=l,e[27]=s,e[28]=p,e[29]=$,e[30]=u):u=e[30],u};function Ie(e){const{pageParam:s}=e;return Ce(s,10)}function Ue(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function et(e){return e}const ht=()=>{const{currentUser:e,logout:s}=Y(),{darkMode:i,toggleDarkMode:o,fontSize:t,setFontSize:a,dataSaver:n,setDataSaver:h}=$e(),{addToast:l}=te(),[L,r]=(0,_.useState)(!1),[m,M]=(0,_.useState)({newPassword:"",confirmPassword:""}),[w,d]=(0,_.useState)(!1),g=async()=>{try{await s(),l("Logged out successfully")}catch(c){console.error("Logout error:",c),l("Failed to logout")}};return{currentUser:e,darkMode:i,toggleDarkMode:o,fontSize:t,setFontSize:a,dataSaver:n,setDataSaver:h,isChangingPassword:L,setIsChangingPassword:r,passwordData:m,setPasswordData:M,loading:w,handleLogout:g,handlePasswordChange:async c=>{if(c.preventDefault(),m.newPassword!==m.confirmPassword){l("Passwords do not match","error");return}if(m.newPassword.length<6){l("Password must be at least 6 characters","error");return}d(!0);try{const{error:v}=await ie.auth.updateUser({password:m.newPassword});if(v)throw v;l("Password updated successfully!"),r(!1),M({newPassword:"",confirmPassword:""})}catch(v){console.error("Password update error:",v),l(v.message||"Failed to update password","error")}finally{d(!1)}},handlePasswordReset:async()=>{if(e?.email){d(!0);try{const{error:c}=await ie.auth.resetPasswordForEmail(e.email,{redirectTo:`${window.location.origin}/settings?type=recovery`});if(c)throw c;l("Password reset email sent!")}catch(c){console.error("Reset password error:",c),l(c.message||"Failed to send reset email","error")}finally{d(!1)}}},handleClearCache:()=>{["seenStories","font-size","data-saver","theme"].forEach(c=>localStorage.removeItem(c)),l("Cache cleared! Reloading..."),setTimeout(()=>window.location.reload(),1500)},handleDownloadData:async()=>{if(e){d(!0);try{const c={user:{id:e.id,handle:e.handle,name:e.name,email:e.email},exportDate:new Date().toISOString(),note:"This is a mock export of your Sysm data."},v=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),$=URL.createObjectURL(v),b=document.createElement("a");b.href=$,b.download=`sysm-data-${e.handle}.json`,b.click(),URL.revokeObjectURL($),l("Data export started!")}catch{l("Failed to export data","error")}finally{d(!1)}}},handleDeleteAccount:()=>{window.confirm("Are you absolutely sure? This will permanently delete your account and all associated data. This action is irreversible.")&&(l("Account deletion request submitted. Logging out..."),setTimeout(g,2e3))},handleReportBug:()=>{window.prompt("Please describe the bug you found:")&&l("Bug reported! Thank you for your feedback.")}}};export{dt as a,lt as c,at as d,ft as i,rt as l,gt as n,ut as o,mt as r,ct as s,ht as t,nt as u};
