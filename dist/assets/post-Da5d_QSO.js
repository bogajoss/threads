import{n as rt}from"./rolldown-runtime-2JzG8er9.js";import{f as yt,s as V,u as Ct,w as St,y as ke}from"./framework-pMVb9Z5_.js";import{n as _t}from"./query-CYcBlx0y.js";import{$t as Be,At as ve,Bt as Pt,Dt as Ft,It as $t,Mt as It,Nt as Mt,Pt as Rt,Qt as Et,Rt as Lt,Ut as X,Wt as At,Yt as pe,Zt as qe,_t as Dt,cn as Wt,in as je,jt as Ot,mn as Ut,nn as Tt,on as Vt,qt as Bt,rn as qt,sn as Ht,t as lt,tn as Qt,ut as ze,vt as Gt,xt as Jt,zt as ot}from"./ui-libs-C0jnt0Gl.js";import{$ as G,At as Kt,B as Xt,Bt as Zt,Dt as Yt,Gt as he,H as se,Ht as es,Jt as ts,Kt as me,L as ct,Mt as dt,Ot as ss,Q as J,Rt as He,U as as,Ut as ns,V as is,W as rs,Wt as ls,Z as os,_t as cs,a as mt,at as Qe,c as ds,ct as Ge,dt as ms,et as K,ft as xt,gt as Ne,ht as pt,it as Je,kt as ht,l as xs,lt as ps,m as Ke,nt as Xe,o as Ze,ot as Ye,p as xe,pt as hs,rt as et,s as us,st as tt,tt as st,ut as fs}from"./index-BjxKXbPZ.js";import{n as we,t as ye}from"./linkify-fXGRsD3N.js";import{d as gs}from"./hooks-BgL0g9tL.js";var bs=V(),d=rt(St(),1),t=rt(Ct(),1),vs=s=>{const e=(0,bs.c)(21),{icon:a,count:l,label:i,onClick:m,active:n,activeColorClass:o}=s,f=o===void 0?"text-violet-600":o,v=a;let c;e[0]!==m?(c=F=>{F.stopPropagation(),m&&m(F)},e[0]=m,e[1]=c):c=e[1];const p=`${i} ${l!==void 0?`(${l})`:""}`,r=`group flex items-center gap-x-1 sm:gap-x-1.5 text-[12px] sm:text-[13px] font-bold transition-all py-1.5 px-2 -ml-2 rounded-xl active:scale-95 ${n?f:"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"}`,u=`rounded-full p-2 transition-colors ${n?"":"group-hover:bg-zinc-100 dark:group-hover:bg-zinc-800"}`,x=n?2.5:2,g=n?"fill-current":"";let k;e[2]!==v||e[3]!==x||e[4]!==g?(k=(0,t.jsx)(v,{size:18,strokeWidth:x,className:g}),e[2]=v,e[3]=x,e[4]=g,e[5]=k):k=e[5];let N;e[6]!==u||e[7]!==k?(N=(0,t.jsx)("div",{className:u,children:k}),e[6]=u,e[7]=k,e[8]=N):N=e[8];let w;e[9]!==i?(w=i&&(0,t.jsx)("span",{className:"hidden xs:inline",children:i}),e[9]=i,e[10]=w):w=e[10];let j;e[11]!==n||e[12]!==l?(j=l!=null&&(0,t.jsx)("span",{className:n?"font-bold":"",children:l||0}),e[11]=n,e[12]=l,e[13]=j):j=e[13];let S;return e[14]!==w||e[15]!==j||e[16]!==c||e[17]!==p||e[18]!==r||e[19]!==N?(S=(0,t.jsxs)("button",{onClick:c,"aria-label":p,className:r,children:[N,w,j]}),e[14]=w,e[15]=j,e[16]=c,e[17]=p,e[18]=r,e[19]=N,e[20]=S):S=e[20],S},B=vs,js=V(),zs=s=>{const e=(0,js.c)(51),{currentUser:a,newComment:l,setNewComment:i,handleSubmitComment:m,loading:n,selectedFiles:o,setSelectedFiles:f,isUploading:v}=s;let c;e[0]!==o?(c=o===void 0?[]:o,e[0]=o,e[1]=c):c=e[1];const p=c,r=(0,d.useRef)(null);let u;e[2]!==f?(u=y=>{const _=Array.from(y.target.files);f&&f(U=>[...U,..._])},e[2]=f,e[3]=u):u=e[3];const x=u;let g;e[4]!==f?(g=y=>{f&&f(_=>_.filter((U,q)=>q!==y))},e[4]=f,e[5]=g):g=e[5];const k=g;if(!a){let y;return e[6]===Symbol.for("react.memo_cache_sentinel")?(y=(0,t.jsx)("div",{className:"p-6 text-center border-y border-zinc-100 dark:border-zinc-800 bg-zinc-50/30 dark:bg-zinc-900/10",children:(0,t.jsx)("p",{className:"text-zinc-500 text-sm",children:"Please login to join the conversation."})}),e[6]=y):y=e[6],y}let N;e[7]!==a.avatar||e[8]!==a.handle?(N=(0,t.jsx)(K,{src:a.avatar,alt:a.handle,className:"object-cover"}),e[7]=a.avatar,e[8]=a.handle,e[9]=N):N=e[9];let w;e[10]!==a.handle?.[0]?(w=a.handle?.[0]?.toUpperCase(),e[10]=a.handle?.[0],e[11]=w):w=e[11];let j;e[12]!==w?(j=(0,t.jsx)(G,{children:w}),e[12]=w,e[13]=j):j=e[13];let S;e[14]!==N||e[15]!==j?(S=(0,t.jsxs)(J,{className:"size-9 border border-zinc-200 dark:border-zinc-700",children:[N,j]}),e[14]=N,e[15]=j,e[16]=S):S=e[16];let F;e[17]!==i?(F=y=>i(y.target.value),e[17]=i,e[18]=F):F=e[18];let h;e[19]!==l||e[20]!==F?(h=(0,t.jsx)("textarea",{id:"comment-input",className:"w-full bg-transparent outline-none text-base min-h-[60px] resize-none dark:text-white placeholder:text-zinc-500",placeholder:"Post your reply...",value:l,onChange:F}),e[19]=l,e[20]=F,e[21]=h):h=e[21];let $;e[22]!==k||e[23]!==p?($=p.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-2 mb-2",children:p.map((y,_)=>(0,t.jsxs)("div",{className:"relative size-20 rounded-xl overflow-hidden border border-zinc-200 dark:border-zinc-800",children:[y.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(y),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"size-full flex items-center justify-center bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)(Rt,{size:20,className:"text-zinc-500"})}),(0,t.jsx)("button",{onClick:()=>k(_),className:"absolute top-1 right-1 bg-black/60 text-white rounded-full p-1 hover:bg-black transition-colors",children:(0,t.jsx)(ze,{size:12})})]},_))}),e[22]=k,e[23]=p,e[24]=$):$=e[24];let M;e[25]===Symbol.for("react.memo_cache_sentinel")?(M=()=>r.current?.click(),e[25]=M):M=e[25];let I;e[26]===Symbol.for("react.memo_cache_sentinel")?(I=(0,t.jsx)("button",{type:"button",onClick:M,className:"text-violet-600 hover:bg-violet-50 dark:hover:bg-zinc-800 rounded-full p-2 transition-colors",title:"Attach media",children:(0,t.jsx)(Bt,{size:20})}),e[26]=I):I=e[26];let E;e[27]!==x?(E=(0,t.jsxs)("div",{className:"flex text-violet-600 gap-1",children:[I,(0,t.jsx)("input",{type:"file",ref:r,onChange:x,multiple:!0,className:"hidden",accept:"image/*,video/*,application/pdf"})]}),e[27]=x,e[28]=E):E=e[28];let L;e[29]!==v||e[30]!==n||e[31]!==l||e[32]!==p.length?(L=!l.trim()&&p.length===0||n||v,e[29]=v,e[30]=n,e[31]=l,e[32]=p.length,e[33]=L):L=e[33];let O;e[34]!==v||e[35]!==n?(O=n||v?(0,t.jsx)(X,{size:16,className:"animate-spin text-white mx-auto"}):"Reply",e[34]=v,e[35]=n,e[36]=O):O=e[36];let A;e[37]!==m||e[38]!==L||e[39]!==O?(A=(0,t.jsx)(os,{className:"!w-auto px-5 py-1.5 text-sm font-bold min-w-[70px]",onClick:m,disabled:L,children:O}),e[37]=m,e[38]=L,e[39]=O,e[40]=A):A=e[40];let D;e[41]!==E||e[42]!==A?(D=(0,t.jsxs)("div",{className:"flex justify-between items-center mt-2 pt-3 border-t border-zinc-100 dark:border-zinc-800",children:[E,A]}),e[41]=E,e[42]=A,e[43]=D):D=e[43];let W;e[44]!==h||e[45]!==$||e[46]!==D?(W=(0,t.jsxs)("div",{className:"flex-1",children:[h,$,D]}),e[44]=h,e[45]=$,e[46]=D,e[47]=W):W=e[47];let z;return e[48]!==W||e[49]!==S?(z=(0,t.jsx)("div",{className:"p-4 border-y border-zinc-100 dark:border-zinc-800 bg-zinc-50/30 dark:bg-zinc-900/10",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[S,W]})}),e[48]=W,e[49]=S,e[50]=z):z=e[50],z},ut=zs,Ns=V(),ks=s=>{const e=(0,Ns.c)(17),{file:a}=s;let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=(0,t.jsx)("div",{className:"size-10 rounded-xl bg-violet-100 dark:bg-violet-900/30 flex items-center justify-center text-violet-600",children:(0,t.jsx)(Qt,{size:20})}),e[0]=l):l=e[0];let i;e[1]!==a.name?(i=(0,t.jsx)("div",{className:"text-sm font-bold truncate dark:text-white",children:a.name}),e[1]=a.name,e[2]=i):i=e[2];const m=a.size/1024/1024;let n;e[3]!==m?(n=m.toFixed(2),e[3]=m,e[4]=n):n=e[4];let o;e[5]!==n?(o=(0,t.jsxs)("div",{className:"text-xs text-zinc-500 uppercase",children:[n," MB"]}),e[5]=n,e[6]=o):o=e[6];let f;e[7]!==i||e[8]!==o?(f=(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[i,o]}),e[7]=i,e[8]=o,e[9]=f):f=e[9];let v;e[10]===Symbol.for("react.memo_cache_sentinel")?(v=(0,t.jsx)(Vt,{size:18}),e[10]=v):v=e[10];let c;e[11]!==a.name||e[12]!==a.url?(c=(0,t.jsx)("a",{href:a.url,download:a.name,className:"p-2 text-zinc-400 hover:text-violet-600 transition-colors",onClick:ys,children:v}),e[11]=a.name,e[12]=a.url,e[13]=c):c=e[13];let p;return e[14]!==f||e[15]!==c?(p=(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-3 p-3 rounded-2xl border border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/10 group hover:border-violet-500/30 transition-colors",children:[l,f,c]}),e[14]=f,e[15]=c,e[16]=p):p=e[16],p},ws=ks;function ys(s){return s.stopPropagation()}var la=V(),Cs=V(),Ss=s=>{const e=(0,Cs.c)(30),{url:a}=s;let l,i;e[0]!==a?(l=["link-preview",a],i=()=>cs(a),e[0]=a,e[1]=l,e[2]=i):(l=e[1],i=e[2]);const m=!!a;let n;e[3]!==l||e[4]!==i||e[5]!==m?(n={queryKey:l,queryFn:i,staleTime:864e5,enabled:m},e[3]=l,e[4]=i,e[5]=m,e[6]=n):n=e[6];const{data:o,isLoading:f,isError:v}=_t(n);if(f){let j;return e[7]===Symbol.for("react.memo_cache_sentinel")?(j=(0,t.jsx)("div",{className:"mt-3 rounded-2xl border border-zinc-100 dark:border-zinc-800 overflow-hidden animate-pulse bg-zinc-50 dark:bg-zinc-900/50 h-24 flex items-center justify-center",children:(0,t.jsx)(qe,{className:"text-zinc-300 dark:text-zinc-700 animate-spin",size:24})}),e[7]=j):j=e[7],j}if(v||!o||!o.title&&!o.image)return null;let c;e[8]!==o.image||e[9]!==o.title?(c=o.image&&(0,t.jsx)("div",{className:"w-full aspect-[1.91/1] overflow-hidden bg-zinc-100 dark:bg-zinc-900 border-b border-zinc-100 dark:border-zinc-800",children:(0,t.jsx)("img",{src:o.image,alt:o.title,className:"w-full h-full object-cover group-hover:scale-[1.02] transition-transform duration-500",onError:Ps})}),e[8]=o.image,e[9]=o.title,e[10]=c):c=e[10];let p;e[11]===Symbol.for("react.memo_cache_sentinel")?(p=(0,t.jsx)(qe,{size:12}),e[11]=p):p=e[11];let r;e[12]!==o.siteName?(r=(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-zinc-600 font-bold uppercase tracking-wider",children:[p,(0,t.jsx)("span",{children:o.siteName})]}),e[12]=o.siteName,e[13]=r):r=e[13];let u;e[14]!==o.title?(u=(0,t.jsx)("div",{className:"font-bold text-[15px] line-clamp-2 dark:text-white leading-snug group-hover:text-violet-700 transition-colors",children:o.title}),e[14]=o.title,e[15]=u):u=e[15];let x;e[16]!==o.description?(x=o.description&&(0,t.jsx)("p",{className:"text-xs text-zinc-600 dark:text-zinc-400 line-clamp-2 leading-relaxed",children:o.description}),e[16]=o.description,e[17]=x):x=e[17];let g;e[18]===Symbol.for("react.memo_cache_sentinel")?(g=(0,t.jsx)(qt,{size:10}),e[18]=g):g=e[18];let k;e[19]!==a?(k=(0,t.jsxs)("div",{className:"pt-1 flex items-center gap-1 text-[11px] text-zinc-500 font-medium",children:[g,(0,t.jsx)("span",{className:"truncate",children:a})]}),e[19]=a,e[20]=k):k=e[20];let N;e[21]!==k||e[22]!==r||e[23]!==u||e[24]!==x?(N=(0,t.jsxs)("div",{className:"p-3.5 space-y-1",children:[r,u,x,k]}),e[21]=k,e[22]=r,e[23]=u,e[24]=x,e[25]=N):N=e[25];let w;return e[26]!==N||e[27]!==c||e[28]!==a?(w=(0,t.jsxs)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"mt-3 flex flex-col rounded-2xl border border-zinc-100 dark:border-zinc-800 overflow-hidden bg-white dark:bg-zinc-950 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-all group shadow-sm",onClick:_s,children:[c,N]}),e[26]=N,e[27]=c,e[28]=a,e[29]=w):w=e[29],w},at=Ss;function _s(s){return s.stopPropagation()}function Ps(s){return s.target.style.display="none"}var Fs=V(),$s=s=>{const e=(0,Fs.c)(17),{src:a,poster:l}=s,i=(0,d.useRef)(null),{reportVisibility:m,unregister:n}=ps(),{dataSaver:o}=hs(),f=(0,d.useId)();let v;e[0]===Symbol.for("react.memo_cache_sentinel")?(v={play:()=>{const j=i.current?.plyr;j&&(j.muted=!0,j.play().catch(Ms))},pause:()=>{i.current?.plyr?.pause()}},e[0]=v):v=e[0];const c=v;let p,r;e[1]!==o||e[2]!==f||e[3]!==m||e[4]!==n?(p=()=>{const j=new IntersectionObserver(F=>{const[h]=F;m(f,o?0:h.intersectionRatio,c)},{threshold:[0,.6]}),S=i.current?.elements?.container;return S&&j.observe(S),()=>{n(f),S&&j.unobserve(S)}},r=[f,m,n,c,o],e[1]=o,e[2]=f,e[3]=m,e[4]=n,e[5]=p,e[6]=r):(p=e[5],r=e[6]),(0,d.useEffect)(p,r);let u;e[7]!==a?(u=[{src:a,type:"video/mp4"}],e[7]=a,e[8]=u):u=e[8];let x;e[9]!==l||e[10]!==u?(x={type:"video",sources:u,poster:l},e[9]=l,e[10]=u,e[11]=x):x=e[11];let g;e[12]===Symbol.for("react.memo_cache_sentinel")?(g={controls:["play-large","play","progress","current-time","mute","volume","fullscreen"],settings:["quality","speed"],ratio:"16:9",clickToPlay:!0,hideControls:!0,resetOnEnd:!0},e[12]=g):g=e[12];let k;e[13]!==x?(k={source:x,options:g},e[13]=x,e[14]=k):k=e[14];const N=k;let w;return e[15]!==N?(w=(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl shadow-sm border border-zinc-100 dark:border-zinc-800 bg-black",onClick:Rs,children:(0,t.jsx)(lt,{ref:i,...N})}),e[15]=N,e[16]=w):w=e[16],w},Is=$s;function Ms(){}function Rs(s){return s.stopPropagation()}var Es=V(),Ls=s=>{const e=(0,Es.c)(3),{items:a}=s,l=a===void 0?[]:a,{openLightbox:i}=fs();if(!l||l.length===0)return null;const m=Array.isArray(l)?l:[l],n=m.filter(Ds),o=m.filter(Ws),f=u=>{const x=n.filter(Os).map(Us),g=n[u];i(x,x.indexOf(g.url||g.src))},v="mt-3 space-y-2",c=n.length>0&&(0,t.jsx)("div",{className:`grid gap-2 rounded-2xl overflow-hidden border border-zinc-100 dark:border-zinc-800 ${n.length===1?"grid-cols-1":n.length===2?"grid-cols-2 aspect-[16/9]":(n.length===3,"grid-cols-2 grid-rows-2 aspect-[16/9]")}`,children:n.map((u,x)=>(0,t.jsx)("div",{className:`relative overflow-hidden bg-zinc-100 dark:bg-zinc-900 cursor-pointer ${n.length===3&&x===0?"row-span-2":""}`,onClick:g=>{u.type==="image"&&(g.stopPropagation(),f(x))},children:u.type==="video"?(0,t.jsx)(Is,{src:u.url,poster:u.poster}):(0,t.jsx)("img",{src:u.url||u.src,className:"size-full object-cover hover:scale-[1.02] transition-transform duration-500",alt:"",loading:"lazy"})},x))}),p=o.map(Ts);let r;return e[0]!==c||e[1]!==p?(r=(0,t.jsxs)("div",{className:v,children:[c,p]}),e[0]=c,e[1]=p,e[2]=r):r=e[2],r},As=Ls;function Ds(s){return s.type==="image"||s.type==="video"}function Ws(s){return s.type==="file"}function Os(s){return s.type==="image"}function Us(s){return s.url||s.src}function Ts(s,e){return(0,t.jsx)(ws,{file:s},e)}var Vs=V(),Bs=s=>{const e=(0,Vs.c)(18),{poll:a,onVote:l}=s,i=a.options.reduce(qs,0),[m,n]=(0,d.useState)(null);let o;e[0]!==l||e[1]!==m?(o=x=>{m||(n(x),l&&l(x))},e[0]=l,e[1]=m,e[2]=o):o=e[2];const f=o;let v;if(e[3]!==f||e[4]!==a.options||e[5]!==i||e[6]!==m){let x;e[8]!==f||e[9]!==i||e[10]!==m?(x=(g,k)=>{const N=i>0?Math.round((g.votes+(m===g.id?1:0))/(i+(m?1:0))*100):0,w=m===g.id;return(0,t.jsxs)("div",{onClick:j=>{j.stopPropagation(),f(g.id)},className:`relative h-10 w-full rounded-xl overflow-hidden cursor-pointer border ${w?"border-violet-500 dark:border-violet-500":"border-zinc-200 dark:border-zinc-700"}`,children:[m&&(0,t.jsx)("div",{className:"absolute top-0 left-0 h-full bg-zinc-200 dark:bg-zinc-800 transition-all duration-500",style:{width:`${N}%`}}),(0,t.jsxs)("div",{className:"absolute inset-0 flex items-center justify-between px-4 z-10",children:[(0,t.jsxs)("span",{className:`font-medium text-sm ${w?"text-violet-600 font-bold":"text-zinc-700 dark:text-zinc-200"}`,children:[g.text," ",w&&(0,t.jsx)(Wt,{size:14,className:"inline ml-1 mb-0.5"})]}),m&&(0,t.jsxs)("span",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:[N,"%"]})]})]},g.id||k)},e[8]=f,e[9]=i,e[10]=m,e[11]=x):x=e[11],v=a.options.map(x),e[3]=f,e[4]=a.options,e[5]=i,e[6]=m,e[7]=v}else v=e[7];const c=i+(m?1:0),p=m?"6 days left":"Click to vote";let r;e[12]!==c||e[13]!==p?(r=(0,t.jsxs)("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 pl-1",children:[c," votes â€¢"," ",p]}),e[12]=c,e[13]=p,e[14]=r):r=e[14];let u;return e[15]!==v||e[16]!==r?(u=(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[v,r]}),e[15]=v,e[16]=r,e[17]=u):u=e[17],u},nt=Bs;function qs(s,e){return s+e.votes}var ft=({id:s,user:e,timeAgo:a,content:l,contentClass:i,media:m,quotedPost:n,stats:o,onClick:f,repostedBy:v,onUserClick:c,currentUser:p,showToast:r,poll:u,isDetail:x,initialComments:g,onDelete:k,isComment:N,onReply:w,community:j})=>{const S=ke(),{liked:F,reposted:h,localStats:$,setLocalStats:M,handleLike:I,handleRepost:E}=gs(s,o,p,r),{deletePost:L,updatePost:O}=ms(),[A,D]=(0,d.useState)(g||[]),[W,z]=(0,d.useState)(""),[y,_]=(0,d.useState)(!1),[U,q]=(0,d.useState)(!1),[Z,Ce]=(0,d.useState)(!1),[bt,Se]=(0,d.useState)(!0),[ue,_e]=(0,d.useState)([]),[vt,Pe]=(0,d.useState)(!1),[Fe,ae]=(0,d.useState)(!1),[fe,ne]=(0,d.useState)(!1),[Y,$e]=(0,d.useState)(l),[te,Ie]=(0,d.useState)(m||[]),[ie,re]=(0,d.useState)([]),[Me,Re]=(0,d.useState)(!1),[le,jt]=(0,d.useState)(!1),[zt,Ee]=(0,d.useState)(!1),Le=(0,d.useRef)(null),Ae=(0,d.useRef)(A);(0,d.useEffect)(()=>{Ae.current=A},[A]);const Nt=async()=>{const b=JSON.stringify(te)!==JSON.stringify(m||[])||ie.length>0;if(!Y.trim()||Y===l&&!b){ne(!1);return}Re(!0);try{const C=[];for(const P of ie){const R=await Ne(P);C.push(R)}await O(s,{content:Y,media:[...te,...C]}),re([]),ne(!1),r&&r("Post updated")}catch(C){console.error("Failed to update post:",C),r&&r("Failed to update post")}finally{Re(!1)}},De=async b=>{b&&b.stopPropagation();try{await L(s),r&&r("Post deleted successfully"),k&&k(s)}catch(C){console.error("Failed to delete post:",C),r&&r("Failed to delete post")}finally{ae(!1)}},oe=(0,d.useCallback)(async(b=!1)=>{if(s){b?Ce(!0):_(!0);try{const C=Ae.current,P=await dt(s,b&&C.length>0?C[C.length-1].created_at:null,10);P.length<10?Se(!1):Se(!0),D(b?R=>[...R,...P]:P)}catch(C){console.error("Failed to load comments:",C)}finally{_(!1),Ce(!1)}}},[s]);(0,d.useEffect)(()=>{x&&s&&oe()},[x,s,oe]);const kt=async b=>{if(b.preventDefault(),!(!W.trim()&&ue.length===0||!p)){q(!0),Pe(!0);try{const C=[];for(const P of ue){const R=await Ne(P);C.push(R)}await ht(s,p.id,W,C),z(""),_e([]),M(P=>({...P,comments:(P.comments||0)+1})),r&&r("Reply posted!"),oe()}catch(C){console.error("Failed to post comment:",C),r&&r("Failed to post reply.")}finally{q(!1),Pe(!1)}}},ge=b=>{b&&b.stopPropagation(),Ee(!0)},We=({trigger:b})=>(0,t.jsxs)(Xt,{children:[(0,t.jsx)(rs,{asChild:!0,onClick:C=>C.stopPropagation(),children:b}),(0,t.jsxs)(is,{align:"end",className:"w-48 rounded-xl bg-white dark:bg-zinc-900 border-zinc-100 dark:border-zinc-800",children:[!N&&(0,t.jsxs)(se,{className:"gap-2 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-800 py-2.5",onClick:ge,children:[(0,t.jsx)(xe,{size:16}),(0,t.jsx)("span",{children:"Copy link to post"})]}),!N&&(0,t.jsxs)(se,{className:"gap-2 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-800 py-2.5",onClick:C=>{C.stopPropagation(),r&&r("Post reported")},children:[(0,t.jsx)(Et,{size:16}),(0,t.jsx)("span",{children:"Report post"})]}),!Oe&&(0,t.jsxs)(se,{className:"gap-2 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-800 py-2.5 text-rose-500 focus:text-rose-500",onClick:C=>{C.stopPropagation(),r&&r("User blocked")},children:[(0,t.jsx)(Dt,{size:16}),(0,t.jsxs)("span",{children:["Block @",e.handle]})]}),Oe&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(as,{className:"bg-zinc-100 dark:border-zinc-800"}),(0,t.jsxs)(se,{onClick:()=>ne(!0),className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)(us,{size:16}),"Edit Post"]}),(0,t.jsxs)(se,{className:"gap-2 cursor-pointer focus:bg-rose-50 dark:focus:bg-rose-900/20 py-2.5 text-rose-500 focus:text-rose-500",onClick:C=>{C.stopPropagation(),ae(!0)},children:[(0,t.jsx)(Jt,{size:16}),(0,t.jsx)("span",{children:"Delete post"})]})]})]})]}),Oe=p?.handle===e.handle,Ue=b=>{if(!b)return null;const C=fe?te:b;return!C||Array.isArray(C)&&C.length===0?null:fe?(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,t.jsxs)("div",{className:"grid gap-2 grid-cols-2 sm:grid-cols-3",children:[te.map((P,R)=>(0,t.jsxs)("div",{className:"relative aspect-square rounded-xl overflow-hidden border border-zinc-200 dark:border-zinc-800 group",children:[P.type==="video"?(0,t.jsx)("div",{className:"size-full bg-zinc-100 dark:bg-zinc-900 flex items-center justify-center",children:(0,t.jsx)(Be,{size:24,className:"text-zinc-400"})}):(0,t.jsx)("img",{src:P.url||P.src,className:"size-full object-cover",alt:""}),(0,t.jsx)("button",{onClick:H=>{H.stopPropagation(),Ie(Q=>Q.filter((ee,T)=>T!==R))},className:"absolute top-1.5 right-1.5 size-7 rounded-full bg-black/60 text-white flex items-center justify-center hover:bg-black transition-colors",children:(0,t.jsx)(ze,{size:16})})]},`old-${R}`)),ie.map((P,R)=>(0,t.jsxs)("div",{className:"relative aspect-square rounded-xl overflow-hidden border-2 border-dashed border-violet-500 bg-violet-50/10 group",children:[P.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(P),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"size-full flex items-center justify-center",children:(0,t.jsx)(Be,{size:24,className:"text-violet-500 animate-pulse"})}),(0,t.jsx)("button",{onClick:H=>{H.stopPropagation(),re(Q=>Q.filter((ee,T)=>T!==R))},className:"absolute top-1.5 right-1.5 size-7 rounded-full bg-black/60 text-white flex items-center justify-center hover:bg-black transition-colors",children:(0,t.jsx)(ze,{size:16})}),(0,t.jsx)("div",{className:"absolute bottom-1 left-1 bg-violet-600 text-white text-[8px] font-bold px-1 rounded",children:"NEW"})]},`new-${R}`)),te.length+ie.length<4&&(0,t.jsxs)("button",{onClick:P=>{P.stopPropagation(),Le.current?.click()},className:"relative aspect-square rounded-xl border-2 border-dashed border-zinc-200 dark:border-zinc-800 flex flex-col items-center justify-center gap-1 text-zinc-400 hover:text-violet-500 hover:border-violet-500 hover:bg-violet-50/5 transition-all",children:[(0,t.jsx)(Ot,{size:20}),(0,t.jsx)("span",{className:"text-[10px] font-bold",children:"Add Media"})]})]}),(0,t.jsx)("input",{type:"file",ref:Le,onChange:P=>{const R=Array.from(P.target.files);re(H=>[...H,...R])},multiple:!0,className:"hidden",accept:"image/*,video/*"})]}):d.isValidElement(C)?C:(0,t.jsx)(As,{items:C})},Te=(b,C)=>{const P=typeof b=="string"&&ts(b);if(fe)return(0,t.jsxs)("div",{className:"flex flex-col gap-2 mt-2",onClick:R=>R.stopPropagation(),children:[(0,t.jsx)(Textarea,{value:Y,onChange:R=>$e(R.target.value),className:`min-h-[100px] w-full bg-zinc-50 dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800 rounded-xl focus:ring-violet-500 ${P?"font-bangla text-lg":"font-english"}`,autoFocus:!0}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)("button",{onClick:()=>{ne(!1),$e(l),Ie(m||[]),re([])},className:"px-4 py-1.5 text-sm font-bold text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300 transition-colors",children:"Cancel"}),(0,t.jsx)("button",{onClick:Nt,disabled:Me||!Y.trim()||Y===l,className:"px-4 py-1.5 text-sm font-bold bg-violet-600 text-white rounded-full hover:bg-violet-700 disabled:opacity-50 transition-all active:scale-95",children:Me?"Saving...":"Save"})]})]});if(typeof b=="string"){const R=!x&&b.length>280,H=R&&!le?b.substring(0,280):b;return(0,t.jsxs)("div",{className:`whitespace-pre-line ${C||""} ${P?"font-bangla text-[1.15em] leading-relaxed":"font-english text-[1.05em]"}`,children:[(0,t.jsx)(we,{options:{...ye,render:({attributes:Q,content:ee})=>{const{href:T,...ce}=Q,Ve=window.location.origin;let de=null;return T.startsWith("/")?de=T:T.startsWith(Ve)&&(de=T.replace(Ve,"")),de?(0,t.jsx)("span",{...ce,className:he("text-violet-600 dark:text-violet-400 font-medium hover:underline cursor-pointer",ce.className),onClick:be=>{be.stopPropagation(),S(de)},children:ee},ee):(0,t.jsx)("a",{href:T,...ce,target:"_blank",rel:"noopener noreferrer",className:he("text-violet-600 dark:text-violet-400 hover:underline",ce.className),onClick:be=>be.stopPropagation(),children:ee},ee)}},children:H}),R&&!le&&"...",R&&(0,t.jsx)("button",{onClick:Q=>{Q.stopPropagation(),jt(!le)},className:"ml-1 text-rose-600 dark:text-rose-400 font-bold hover:underline cursor-pointer",children:le?"Show less":"See more"})]})}return b},wt=b=>{z(C=>{const P=`@${b} `;return C.includes(P)?C:C+P}),document.getElementById("comment-input")?.focus()};return x?(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("article",{className:"p-5 dark:bg-black",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsx)("button",{className:"shrink-0",onClick:()=>c&&c(e.handle),children:(0,t.jsxs)(J,{className:"size-12 border border-zinc-200 dark:border-zinc-700",children:[(0,t.jsx)(K,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(G,{children:e.handle[0]?.toUpperCase()})]})}),(0,t.jsxs)("div",{className:"flex flex-col min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 min-w-0 max-w-full",children:[(0,t.jsxs)("button",{className:"font-bold text-base sm:text-lg hover:underline text-zinc-900 dark:text-white flex items-center gap-1 shrink-0",onClick:()=>c&&c(e.handle),children:[(0,t.jsx)("span",{className:"max-w-[200px] sm:max-w-none truncate",children:e.handle}),e.verified&&(0,t.jsx)(Ke,{size:16,className:"text-blue-500"})]}),j&&(0,t.jsxs)("div",{className:"flex items-center gap-1 min-w-0 text-zinc-500",children:[(0,t.jsx)(Ze,{size:14,className:"text-zinc-400 shrink-0"}),(0,t.jsxs)("button",{className:"flex items-center gap-1 font-bold text-zinc-900 dark:text-zinc-100 hover:underline text-[14px] sm:text-[15px]",onClick:b=>{b.stopPropagation(),S(`/c/${j.handle}`)},children:[(0,t.jsxs)(J,{className:"size-4 bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shrink-0",children:[(0,t.jsx)(K,{src:j.avatar,alt:j.name,className:"object-cover"}),(0,t.jsx)(G,{className:"text-[8px] font-bold text-zinc-500",children:j.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"truncate max-w-[200px] sm:max-w-none",children:j.name})]})]})]})}),(0,t.jsxs)("span",{className:"text-xs sm:text-sm text-zinc-500 dark:text-zinc-400 font-medium",children:["@",e.handle]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 -mt-1",children:[(0,t.jsx)("span",{className:"text-zinc-500 dark:text-zinc-400 text-[13px] sm:text-sm whitespace-nowrap",children:a||"Recent"}),(0,t.jsx)(We,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"text-zinc-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full p-2 transition-colors",children:(0,t.jsx)(je,{size:20})})})]})]}),(0,t.jsx)("div",{className:"break-words text-zinc-900 dark:text-zinc-100 mt-4 text-lg sm:text-xl leading-relaxed sm:leading-8 whitespace-pre-line",children:Te(l,i)}),me(l)&&(0,t.jsx)(at,{url:me(l)}),Ue(m),u&&(0,t.jsx)(nt,{poll:u}),n&&(0,t.jsx)("div",{className:"mt-4 border border-zinc-200 dark:border-zinc-700 rounded-2xl overflow-hidden shadow-sm",children:(0,t.jsx)(it,{...n})}),(0,t.jsxs)("div",{className:"border-b border-zinc-100 dark:border-zinc-800 pb-4 mt-4 flex items-center gap-x-6 text-zinc-500 dark:text-zinc-400 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:$.likes||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Likes"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:$.comments||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Comments"})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex w-full items-center justify-around py-1",children:[(0,t.jsx)(B,{icon:pe,label:"Like",onClick:I,active:F,activeColorClass:"text-rose-500"}),!N&&(0,t.jsx)(B,{icon:ve,label:"Repost",onClick:E,active:h,activeColorClass:"text-emerald-500"}),(0,t.jsx)(B,{icon:mt,label:"Comment",onClick:()=>document.getElementById("comment-input")?.focus()}),!N&&(0,t.jsx)(B,{icon:xe,label:"Share",onClick:ge})]})]}),(0,t.jsx)(ut,{currentUser:p,newComment:W,setNewComment:z,handleSubmitComment:kt,loading:U,selectedFiles:ue,setSelectedFiles:_e,isUploading:vt}),(0,t.jsx)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:y?(0,t.jsx)("div",{className:"p-8 flex justify-center",children:(0,t.jsx)(X,{className:"animate-spin text-violet-500"})}):(0,t.jsxs)(t.Fragment,{children:[bt&&A.length>0&&(0,t.jsxs)("button",{onClick:()=>oe(!0),disabled:Z,className:"w-full py-3 text-sm font-bold text-violet-600 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-colors flex items-center justify-center gap-2",children:[Z&&(0,t.jsx)(X,{size:14,className:"animate-spin"}),"View more replies"]}),A.map(b=>(0,t.jsx)(ft,{...b,isComment:!0,onReply:wt,onUserClick:c,currentUser:p,showToast:r,onDelete:C=>D(P=>P.filter(R=>R.id!==C))},b.id))]})}),(0,t.jsx)(st,{open:Fe,onOpenChange:ae,children:(0,t.jsxs)(Je,{onClick:b=>b.stopPropagation(),children:[(0,t.jsxs)(tt,{children:[(0,t.jsx)(Ge,{children:"Are you absolutely sure?"}),(0,t.jsx)(Qe,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(Ye,{children:[(0,t.jsx)(et,{onClick:b=>b.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Xe,{onClick:De,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]}):(0,t.jsxs)("article",{onClick:f,className:`p-4 transition-all ${N?"bg-transparent border-b border-zinc-100/50 dark:border-zinc-800/50 hover:bg-zinc-50/50 dark:hover:bg-zinc-800/30 last:border-0":"mb-4 bg-white dark:bg-black rounded-xl hover:shadow-md"} ${f?"cursor-pointer":""}`,children:[v&&(0,t.jsxs)("div",{className:"mb-2 flex items-center space-x-1.5 text-[13px] text-zinc-600 font-semibold ml-1",children:[(0,t.jsx)(ve,{size:14,className:"text-zinc-500"}),(0,t.jsx)("span",{className:"hover:underline cursor-pointer flex items-center text-zinc-700 dark:text-zinc-300",onClick:b=>{b.stopPropagation(),c&&c(v.handle)},children:(0,t.jsx)("span",{className:"truncate max-w-[150px]",children:typeof v=="object"?v.name:v})}),(0,t.jsx)("span",{className:"text-zinc-500",children:"reposted"})]}),(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsx)("button",{className:"shrink-0 group",onClick:b=>{b.stopPropagation(),c&&c(e.handle)},children:(0,t.jsxs)(J,{className:"size-11 border border-zinc-200 dark:border-zinc-700 group-hover:brightness-95 transition-all",children:[(0,t.jsx)(K,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(G,{children:e.handle[0]?.toUpperCase()})]})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex w-full items-start justify-between",children:[(0,t.jsx)("div",{className:"flex flex-col min-w-0 flex-1",children:(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 min-w-0 max-w-full",children:[(0,t.jsxs)("button",{className:"font-bold text-[15px] hover:underline text-zinc-900 dark:text-white flex items-center gap-1 shrink-0",onClick:b=>{b.stopPropagation(),c&&c(e.handle)},children:[(0,t.jsx)("span",{className:"truncate max-w-[160px] sm:max-w-none",children:e.handle}),e.verified&&(0,t.jsx)(Ke,{size:16,className:"text-blue-500"})]}),j&&(0,t.jsxs)("div",{className:"flex items-center gap-1 min-w-0 text-zinc-500",children:[(0,t.jsx)(Ze,{size:14,className:"text-zinc-400 shrink-0"}),(0,t.jsxs)("button",{className:"flex items-center gap-1 font-bold text-zinc-900 dark:text-zinc-100 hover:underline text-[14px] sm:text-[15px] min-w-0",onClick:b=>{b.stopPropagation(),S(`/c/${j.handle}`)},children:[(0,t.jsxs)(J,{className:"size-4 bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shrink-0",children:[(0,t.jsx)(K,{src:j.avatar,alt:j.name,className:"object-cover"}),(0,t.jsx)(G,{className:"text-[8px] font-bold text-zinc-500",children:j.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"truncate max-w-[160px] md:max-w-none",children:j.name})]})]})]})})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 -mt-1",children:[(0,t.jsx)("span",{className:"text-zinc-500 dark:text-zinc-400 text-[13px] sm:text-sm whitespace-nowrap",children:a||"Recent"}),(0,t.jsx)(We,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"text-zinc-500 hover:bg-zinc-100 hover:text-zinc-700 dark:hover:bg-zinc-800 dark:hover:text-zinc-200 rounded-full p-2 -mr-2 transition-colors",children:(0,t.jsx)(je,{size:18})})})]})]}),(0,t.jsxs)("div",{className:"break-words text-zinc-900 dark:text-zinc-100 mt-1 whitespace-pre-line text-sm sm:text-[15px] leading-relaxed",children:[Te(l,i),me(l)&&(0,t.jsx)(at,{url:me(l)}),Ue(m),u&&(0,t.jsx)(nt,{poll:u,onVote:()=>r&&r("Voted!")}),n&&(0,t.jsx)("div",{className:"mt-3 border border-zinc-200 dark:border-zinc-700 rounded-2xl overflow-hidden bg-white dark:bg-zinc-900 hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors cursor-pointer",onClick:b=>b.stopPropagation(),children:(0,t.jsx)(it,{...n})})]}),(0,t.jsx)("div",{className:"mt-3 flex w-full flex-wrap items-center justify-between gap-3 pr-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-x-6 sm:gap-x-8",children:[(0,t.jsx)(B,{icon:pe,label:"Like",count:$.likes,active:F,onClick:I,activeColorClass:"text-rose-500"}),!N&&(0,t.jsx)(B,{icon:ve,label:"Repost",count:$.mirrors,active:h,onClick:E,activeColorClass:"text-emerald-500"}),(0,t.jsx)(B,{icon:ot,label:"Comment",count:$.comments,onClick:b=>{N&&w?(b.stopPropagation(),w(e.handle)):f&&f(b)}}),!N&&(0,t.jsx)(B,{icon:xe,label:"Share",onClick:ge})]})})]})]}),(0,t.jsx)(st,{open:Fe,onOpenChange:ae,children:(0,t.jsxs)(Je,{onClick:b=>b.stopPropagation(),children:[(0,t.jsxs)(tt,{children:[(0,t.jsx)(Ge,{children:"Are you absolutely sure?"}),(0,t.jsx)(Qe,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(Ye,{children:[(0,t.jsx)(et,{onClick:b=>b.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Xe,{onClick:De,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})}),(0,t.jsx)(gt,{isOpen:zt,onClose:()=>Ee(!1),url:`${window.location.origin}/post/${s}`,title:"Share Post"})]})},Hs=ft,Qs=V(),Gs=s=>{const e=(0,Qs.c)(30),{user:a,time:l,content:i}=s,m=ke();let n;e[0]!==a.avatar||e[1]!==a.handle?(n=(0,t.jsx)(K,{src:a.avatar,alt:a.handle}),e[0]=a.avatar,e[1]=a.handle,e[2]=n):n=e[2];let o;e[3]!==a.handle[0]?(o=a.handle[0]?.toUpperCase(),e[3]=a.handle[0],e[4]=o):o=e[4];let f;e[5]!==o?(f=(0,t.jsx)(G,{children:o}),e[5]=o,e[6]=f):f=e[6];let v;e[7]!==n||e[8]!==f?(v=(0,t.jsxs)(J,{className:"size-6",children:[n,f]}),e[7]=n,e[8]=f,e[9]=v):v=e[9];let c;e[10]!==a.handle?(c=(0,t.jsx)("span",{className:"font-semibold text-sm",children:a.handle}),e[10]=a.handle,e[11]=c):c=e[11];let p;e[12]!==v||e[13]!==c?(p=(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[v,c]}),e[12]=v,e[13]=c,e[14]=p):p=e[14];let r;e[15]!==l?(r=(0,t.jsx)("span",{className:"text-zinc-500 text-xs sm:text-sm",children:l}),e[15]=l,e[16]=r):r=e[16];let u;e[17]!==p||e[18]!==r?(u=(0,t.jsxs)("div",{className:"flex items-center justify-between gap-x-2 mb-2",children:[p,r]}),e[17]=p,e[18]=r,e[19]=u):u=e[19];let x;e[20]!==m?(x={...ye,render:w=>{const{attributes:j,content:S}=w,{href:F,...h}=j,$=window.location.origin;let M=null;return F.startsWith("/")?M=F:F.startsWith($)&&(M=F.replace($,"")),M?(0,t.jsx)("span",{...h,className:he("text-violet-600 dark:text-violet-400 font-medium hover:underline cursor-pointer",h.className),onClick:I=>{I.stopPropagation(),m(M)},children:S},S):(0,t.jsx)("a",{href:F,...h,target:"_blank",rel:"noopener noreferrer",className:he("text-violet-600 dark:text-violet-400 hover:underline",h.className),onClick:Js,children:S},S)}},e[20]=m,e[21]=x):x=e[21];let g;e[22]!==i?(g=(0,t.jsx)("p",{className:"text-sm text-zinc-800 dark:text-zinc-300 whitespace-pre-line",children:i}),e[22]=i,e[23]=g):g=e[23];let k;e[24]!==g||e[25]!==x?(k=(0,t.jsx)(we,{options:x,children:g}),e[24]=g,e[25]=x,e[26]=k):k=e[26];let N;return e[27]!==k||e[28]!==u?(N=(0,t.jsxs)("div",{className:"p-4",children:[u,k]}),e[27]=k,e[28]=u,e[29]=N):N=e[29],N},it=Gs;function Js(s){return s.stopPropagation()}var Ks=d.memo(({reel:s,isActive:e,isMuted:a})=>{const l=ke(),{currentUser:i}=pt(),{addToast:m}=xt(),n=(0,d.useRef)(null),[o,f]=(0,d.useState)(!1),[v,c]=(0,d.useState)(!1),[p,r]=(0,d.useState)(!1),[u,x]=(0,d.useState)(null),[g,k]=(0,d.useState)(!1),[N,w]=(0,d.useState)(s.stats?.likes||0),[j,S]=(0,d.useState)(!1),[F,h]=(0,d.useState)(0),$=(0,d.useRef)(null),M=(0,d.useMemo)(()=>Array.isArray(s.media)?s.media[0]?.src||s.media[0]?.url:s.media?.src||s.media?.url||s.url,[s.media,s.url]);(0,d.useEffect)(()=>{let z;const y=n.current?.plyr;return y&&(e?z=setTimeout(()=>{typeof y.play=="function"&&y.play().catch(()=>{y&&(y.muted=!0,y.play().catch(()=>{}))})},100):typeof y.pause=="function"&&y.pause()),()=>{z&&clearTimeout(z)}},[e]),(0,d.useEffect)(()=>{if(!i?.id||!e)return;(async()=>{try{const[y,_]=await Promise.all([Kt(s.id,i.id),Zt(i.id,s.user?.id)]);k(y),S(_)}catch(y){console.error("Failed to check interaction status:",y)}})()},[s.id,i?.id,e,s.user?.id]),(0,d.useEffect)(()=>{const z=n.current?.plyr;z&&(z.muted=a)},[a]),(0,d.useEffect)(()=>{const z=n.current?.plyr;if(!z||!e)return;const y=()=>{const _=z.currentTime,U=z.duration;U>0&&h(_/U*100)};if(typeof z.on=="function")return z.on("timeupdate",y),()=>{typeof z.off=="function"&&z.off("timeupdate",y)}},[e]);const I=z=>{z.target.closest("button")||z.target.closest("a")||($.current?(clearTimeout($.current),$.current=null,L()):$.current=setTimeout(()=>{$.current=null,E()},200))},E=()=>{const z=n.current?.plyr;z&&(z.paused?(z.play().catch(()=>{}),x("play")):(z.pause(),x("pause")),setTimeout(()=>x(null),500))},L=async()=>{if(i&&(f(!0),setTimeout(()=>f(!1),800),!g)){k(!0),w(z=>z+1);try{await He(s.id,i.id)}catch{k(!1),w(z=>z-1)}}},O=async z=>{if(z.stopPropagation(),!i)return;const y=!g;k(y),w(_=>y?_+1:_-1);try{await He(s.id,i.id)}catch{k(!y),w(_=>y?_-1:_+1)}},A=async z=>{if(z.stopPropagation(),!i)return;const y=!j;S(y);try{await ls(i.id,s.user?.id)}catch{S(!y)}},D=z=>{z.stopPropagation(),r(!0)},W=(0,d.useMemo)(()=>({source:{type:"video",sources:[{src:M,type:"video/mp4"}]},options:{controls:[],loop:{active:!0},clickToPlay:!0,ratio:"9:16"}}),[M]);return(0,t.jsxs)("div",{"data-id":s.id,className:"reel-item relative h-screen w-full bg-black snap-start flex items-center justify-center overflow-hidden cursor-pointer",onClick:I,children:[(0,t.jsx)("div",{className:"w-full h-full max-w-[450px]",children:(0,t.jsx)(lt,{ref:n,...W})}),o&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-50",children:(0,t.jsx)("div",{className:"animate-in zoom-in-50 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)(pe,{size:120,fill:"white",className:"text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.4)] scale-125"})})}),u&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-50",children:(0,t.jsx)("div",{className:"animate-in fade-in zoom-in-90 scale-100 animate-out zoom-out-110 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)("div",{className:"p-8 bg-white/10 backdrop-blur-md rounded-full border border-white/20 shadow-2xl",children:u==="play"?(0,t.jsx)(It,{size:50,fill:"white",className:"text-white ml-1.5"}):(0,t.jsx)(Mt,{size:50,fill:"white",className:"text-white"})})})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/60 pointer-events-none"}),(0,t.jsxs)("div",{className:"absolute bottom-6 left-4 right-16 text-white pointer-events-none",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3 pointer-events-auto",children:[(0,t.jsxs)(yt,{to:`/u/${s.user?.handle}`,className:"flex items-center gap-2 hover:opacity-80 transition-opacity",onClick:z=>z.stopPropagation(),children:[(0,t.jsxs)(J,{className:"size-10 border-2 border-white",children:[(0,t.jsx)(K,{src:s.user?.avatar,alt:s.user?.handle,className:"object-cover"}),(0,t.jsx)(G,{children:s.user?.handle?.[0]?.toUpperCase()})]}),(0,t.jsxs)("span",{className:"font-bold",children:["@",s.user?.handle]})]}),i?.id!==s.user?.id&&(0,t.jsx)("button",{className:`text-xs font-bold px-3 py-1.5 rounded-full ml-2 transition-all active:scale-95 flex items-center gap-1.5 ${j?"bg-transparent border border-white/50 text-white":"bg-white text-black hover:bg-zinc-200"}`,onClick:A,children:j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(xs,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Following"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ds,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Follow"})]})})]}),(0,t.jsx)(we,{options:{...ye,render:({attributes:z,content:y})=>{const{href:_,...U}=z,q=!_.startsWith("/")&&(_.startsWith("http")||_.startsWith("www"));return _.startsWith("/u/")||_.startsWith("/tags/")||_.startsWith("/c/")||_.startsWith("/explore")?(0,t.jsx)("span",{...U,className:"text-white font-bold hover:underline cursor-pointer",onClick:Z=>{Z.stopPropagation(),l(_)},children:y},y):(0,t.jsx)("a",{href:_,...U,className:"text-white hover:underline",target:q?"_blank":void 0,rel:q?"noopener noreferrer":void 0,onClick:Z=>Z.stopPropagation(),children:y},y)}},children:(0,t.jsx)("p",{className:"text-sm mb-3 line-clamp-2",children:s.content})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[(0,t.jsx)($t,{size:14,className:"animate-spin-slow"}),(0,t.jsxs)("span",{children:["Original Audio - ",s.user?.handle]})]})]}),(0,t.jsxs)("div",{className:"absolute bottom-6 right-2 flex flex-col items-center gap-6 z-10",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1 pointer-events-auto",children:[(0,t.jsx)("button",{className:`p-3 rounded-full backdrop-blur-md transition-all active:scale-90 ${g?"bg-rose-500/20 text-rose-500":"bg-zinc-800/50 text-white hover:bg-zinc-700"}`,onClick:O,children:(0,t.jsx)(pe,{size:28,fill:g?"currentColor":"none"})}),(0,t.jsx)("span",{className:"text-white text-xs font-bold",children:N})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1 pointer-events-auto",children:[(0,t.jsx)("button",{className:"p-3 bg-zinc-800/50 rounded-full text-white backdrop-blur-md hover:bg-zinc-700 transition-colors active:scale-90",onClick:z=>{z.stopPropagation(),c(!0)},children:(0,t.jsx)(mt,{size:28})}),(0,t.jsx)("span",{className:"text-white text-xs font-bold",children:s.stats?.comments||0})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1 pointer-events-auto",children:[(0,t.jsx)("button",{className:"p-3 bg-zinc-800/50 rounded-full text-white backdrop-blur-md hover:bg-zinc-700 transition-colors active:scale-90",onClick:D,children:(0,t.jsx)(xe,{size:28})}),(0,t.jsx)("span",{className:"text-white text-xs font-bold",children:s.stats?.shares||0})]})]}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-[3px] bg-white/20 z-50",children:(0,t.jsx)("div",{className:"h-full bg-white transition-all duration-100 ease-linear shadow-[0_0_8px_rgba(255,255,255,0.8)]",style:{width:`${F}%`}})}),(0,t.jsx)(Zs,{isOpen:v,onClose:()=>c(!1),reelId:s.id,currentUser:i,showToast:m}),(0,t.jsx)(gt,{isOpen:p,onClose:()=>r(!1),url:`${window.location.origin}/reels?id=${s.id}`,title:"Share Reel"})]})},(s,e)=>s.isActive===e.isActive&&s.reel.id===e.reel.id&&s.isMuted===e.isMuted),oa=Ks,Xs=({isOpen:s,onClose:e,reelId:a,currentUser:l,showToast:i})=>{const[m,n]=(0,d.useState)([]),[o,f]=(0,d.useState)(!1),[v,c]=(0,d.useState)(!1),[p,r]=(0,d.useState)(""),[u,x]=(0,d.useState)([]),[g,k]=(0,d.useState)(!1),[N,w]=(0,d.useState)(!0),[j,S]=(0,d.useState)(!1),F=(0,d.useRef)(m);(0,d.useEffect)(()=>{F.current=m},[m]);const h=(0,d.useCallback)(async(M=!1)=>{if(a){M?S(!0):f(!0);try{const I=F.current,E=await dt(a,M&&I.length>0?I[I.length-1].created_at:null,10);E.length<10?w(!1):w(!0),n(M?L=>[...L,...E]:E)}catch(I){console.error("Failed to load comments:",I),i&&i("Failed to load comments","error")}finally{f(!1),S(!1)}}},[a,i]);(0,d.useEffect)(()=>{s&&a?h():(n([]),w(!0))},[s,a,h]);const $=async M=>{if(M.preventDefault(),!(!p.trim()&&u.length===0||!l)){c(!0),k(!0);try{const I=[];for(const E of u){const L=await Ne(E);I.push(L)}await ht(a,l.id,p,I),r(""),x([]),i&&i("Reply posted!"),h()}catch(I){console.error("Failed to post comment:",I),i&&i("Failed to post reply.","error")}finally{c(!1),k(!1)}}};return(0,t.jsx)(ct,{isOpen:s,onClose:e,title:"Comments",className:"max-sm:h-[95dvh] sm:max-w-xl h-[85vh] !p-0 overflow-hidden",children:(0,t.jsxs)("div",{className:"flex flex-col h-full bg-white dark:bg-zinc-900 overflow-hidden",children:[(0,t.jsx)("div",{className:"h-1.5 w-12 bg-zinc-200 dark:bg-zinc-800 rounded-full mx-auto my-3 sm:hidden shrink-0"}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800 scroll-smooth",children:o?(0,t.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,t.jsx)(X,{className:"animate-spin text-violet-500",size:32})}):m.length>0?(0,t.jsxs)("div",{className:"flex flex-col",children:[m.map(M=>(0,t.jsx)(Hs,{...M,isComment:!0,currentUser:l,showToast:i,onDelete:I=>n(E=>E.filter(L=>L.id!==I))},M.id)),N&&(0,t.jsxs)("button",{onClick:()=>h(!0),disabled:j,className:"w-full py-6 text-sm font-bold text-violet-600 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-colors flex items-center justify-center gap-2",children:[j&&(0,t.jsx)(X,{size:16,className:"animate-spin"}),"View more replies"]})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] text-center text-zinc-500 p-8",children:[(0,t.jsx)("div",{className:"size-16 rounded-full bg-zinc-100 dark:bg-zinc-900 flex items-center justify-center mb-4",children:(0,t.jsx)(ot,{size:32,className:"text-zinc-400"})}),(0,t.jsx)("p",{className:"font-bold text-lg dark:text-zinc-300",children:"No comments yet"}),(0,t.jsx)("p",{className:"text-sm dark:text-zinc-500",children:"Be the first to share what you think!"})]})}),(0,t.jsx)("div",{className:"bg-white dark:bg-zinc-900 shrink-0 border-t border-zinc-100 dark:border-zinc-800 pb-safe",children:(0,t.jsx)(ut,{currentUser:l,newComment:p,setNewComment:r,handleSubmitComment:$,loading:v,selectedFiles:u,setSelectedFiles:x,isUploading:g})})]})})},Zs=Xs,Ys=({isOpen:s,onClose:e,url:a,title:l="Share"})=>{const[i,m]=(0,d.useState)(!1),[n,o]=(0,d.useState)(""),[f,v]=(0,d.useState)([]),[c,p]=(0,d.useState)(!1),[r,u]=(0,d.useState)(null),{addToast:x}=xt(),{currentUser:g}=pt();(0,d.useEffect)(()=>{s&&g?k():(o(""),v([]))},[s,g]);const k=async()=>{p(!0);try{v(await es(g.id,null,10))}catch(h){console.error("Failed to fetch following:",h)}finally{p(!1)}};(0,d.useEffect)(()=>{const h=setTimeout(()=>{n.trim()&&s?N():!n.trim()&&s&&k()},300);return()=>clearTimeout(h)},[n,s]);const N=async()=>{p(!0);try{v((await ns(n)).filter(h=>h.id!==g.id))}catch(h){console.error("Search failed:",h)}finally{p(!1)}},w=async h=>{h&&h.stopPropagation();try{await navigator.clipboard.writeText(a),m(!0),x("Link copied to clipboard!","success"),setTimeout(()=>m(!1),2e3)}catch($){console.error("Failed to copy:",$),x("Failed to copy link","error")}},j=async h=>{if(g){u(h.id);try{await ss(await Yt(g.id,h.id),g.id,a,"text"),x(`Sent to ${h.name||h.handle}!`,"success")}catch($){console.error("Failed to send message:",$),x("Failed to send message","error")}finally{u(null)}}},S=[{name:"X",icon:Gt,color:"bg-black text-white",href:`https://twitter.com/intent/tweet?url=${encodeURIComponent(a)}`},{name:"Facebook",icon:Tt,color:"bg-[#1877F2] text-white",href:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(a)}`},{name:"LinkedIn",icon:At,color:"bg-[#0A66C2] text-white",href:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(a)}`},{name:"WhatsApp",icon:Lt,color:"bg-[#25D366] text-white",href:`https://wa.me/?text=${encodeURIComponent(a)}`},{name:"Email",icon:Pt,color:"bg-zinc-600 text-white",href:`mailto:?body=${encodeURIComponent(a)}`}],F=async()=>{if(navigator.share)try{await navigator.share({title:l,url:a})}catch(h){h.name!=="AbortError"&&console.error("Native share failed:",h)}else w()};return(0,t.jsx)(ct,{isOpen:s,onClose:e,title:l,className:"max-w-[420px] !p-0 overflow-hidden",children:(0,t.jsxs)("div",{className:"flex flex-col bg-white dark:bg-zinc-900 h-full",children:[(0,t.jsx)("div",{className:"px-5 pt-4 pb-2",children:(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(Ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-zinc-400 group-focus-within:text-violet-500 transition-colors"}),(0,t.jsx)("input",{type:"text",placeholder:"Search people...",value:n,onChange:h=>o(h.target.value),className:"w-full bg-zinc-100 dark:bg-zinc-800/50 border-none rounded-xl py-2.5 pl-10 pr-4 text-sm focus:ring-2 focus:ring-violet-500/20 transition-all outline-none"})]})}),(0,t.jsx)("div",{className:"flex gap-4 overflow-x-auto px-5 py-4 no-scrollbar min-h-[100px] items-center",children:c?(0,t.jsx)("div",{className:"flex-1 flex justify-center",children:(0,t.jsx)(X,{size:24,className:"animate-spin text-zinc-400"})}):f.length>0?f.map(h=>(0,t.jsxs)("button",{onClick:()=>j(h),disabled:r!==null,className:"flex flex-col items-center gap-1.5 shrink-0 group disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"size-14 rounded-full bg-zinc-100 dark:bg-zinc-800 border-2 border-white dark:border-zinc-900 shadow-sm overflow-hidden group-hover:scale-105 transition-transform",children:(0,t.jsx)("img",{src:h.avatar||`https://i.pravatar.cc/150?u=${h.id}`,alt:h.handle,className:"size-full object-cover"})}),r===h.id?(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40 rounded-full flex items-center justify-center",children:(0,t.jsx)(X,{size:16,className:"animate-spin text-white"})}):(0,t.jsx)("div",{className:"absolute bottom-0 right-0 size-3.5 bg-emerald-500 border-2 border-white dark:border-zinc-900 rounded-full"})]}),(0,t.jsx)("span",{className:"text-[10px] font-medium text-zinc-500 dark:text-zinc-400 truncate max-w-[60px]",children:h.name?.split(" ")[0]||h.handle})]},h.id)):(0,t.jsx)("div",{className:"flex-1 text-center py-2",children:(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"No people found"})})}),(0,t.jsx)("div",{className:"h-px bg-zinc-100 dark:bg-zinc-800 mx-5"}),(0,t.jsxs)("div",{className:"grid grid-cols-5 gap-2 px-5 py-6",children:[S.map(h=>(0,t.jsxs)("a",{href:h.href,target:"_blank",rel:"noopener noreferrer",className:"flex flex-col items-center gap-2 group",children:[(0,t.jsx)("div",{className:`size-12 ${h.color} rounded-2xl flex items-center justify-center transition-all group-hover:scale-110 group-hover:-translate-y-1 shadow-md group-hover:shadow-lg`,children:(0,t.jsx)(h.icon,{size:20,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-tighter",children:h.name})]},h.name)),(0,t.jsxs)("button",{onClick:F,className:"flex flex-col items-center gap-2 group",children:[(0,t.jsx)("div",{className:"size-12 bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 rounded-2xl flex items-center justify-center transition-all group-hover:scale-110 group-hover:-translate-y-1 border border-zinc-200 dark:border-zinc-700 shadow-sm",children:(0,t.jsx)(je,{size:20,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-tighter",children:"More"})]})]}),(0,t.jsx)("div",{className:"px-5 pb-6",children:(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("input",{type:"text",readOnly:!0,value:a,className:"w-full bg-zinc-50 dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-2xl py-3.5 pl-4 pr-14 text-sm font-medium focus:outline-none transition-colors group-hover:border-zinc-300 dark:group-hover:border-zinc-700"}),(0,t.jsx)("button",{onClick:w,className:`absolute right-1.5 top-1/2 -translate-y-1/2 h-10 px-4 rounded-xl font-bold text-xs transition-all active:scale-95 flex items-center gap-2 shadow-sm ${i?"bg-emerald-500 text-white":"bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 hover:opacity-90"}`,children:i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Ut,{size:14,strokeWidth:3}),(0,t.jsx)("span",{children:"Copied"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Ht,{size:14,strokeWidth:3}),(0,t.jsx)("span",{children:"Copy"})]})})]})}),(0,t.jsx)("div",{className:"px-5 pb-5",children:(0,t.jsxs)("button",{onClick:e,className:"relative flex items-center justify-center w-full py-4 bg-zinc-900 dark:bg-white rounded-2xl text-white dark:text-zinc-900 font-bold overflow-hidden group hover:shadow-xl hover:shadow-zinc-900/10 dark:hover:shadow-white/10 transition-all active:scale-[0.98]",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-zinc-500 to-zinc-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),(0,t.jsx)("div",{className:"relative flex items-center gap-2",children:(0,t.jsx)("span",{children:"Close"})})]})})]})})},gt=Ys;export{Hs as n,oa as t};
