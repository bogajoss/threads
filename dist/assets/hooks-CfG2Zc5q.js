import{a as fe}from"./rolldown-runtime-BaZ8gS7u.js";import{E as me,S as de,b as ee,c as G,x as re}from"./framework-CsA6nn9m.js";import{a as te,n as ie,r as ne,t as Z}from"./query-QyXblnmD.js";import{$t as ge,At as he,Bt as ye,Ct as pe,Et as _e,Ht as Pe,It as be,Jt as ve,Kt as we,Lt as Me,Mt as Se,Nt as $e,Ot as Re,Pt as qe,Qt as Fe,Rt as Le,Tt as ke,Ut as Ce,Vt as Ne,Wt as Te,Xt as xe,Yt as De,_t as Qe,an as Ke,bt as Ee,c as Ae,dn as le,en as Oe,in as Be,jt as je,mn as U,on as Je,pn as I,qt as ze,rn as He,vt as ae,wt as Ve,xt as se,yt as We,zt as Xe}from"./index-B5uPPvtO.js";var Ge=G(),Q=fe(me(),1);const Ye=(e,i,s)=>{const t=(0,Ge.c)(16);let o,a;t[0]!==i||t[1]!==e?(o=["follows",i,e],a=r=>{const{pageParam:g}=r;return(i==="Followers"?He:Be)(e,g,10)},t[0]=i,t[1]=e,t[2]=o,t[3]=a):(o=t[2],a=t[3]);const n=!!e&&s;let h;t[4]!==o||t[5]!==a||t[6]!==n?(h={queryKey:o,queryFn:a,initialPageParam:null,getNextPageParam:Ze,enabled:n},t[4]=o,t[5]=a,t[6]=n,t[7]=h):h=t[7];const{data:f,fetchNextPage:l,hasNextPage:d,isFetchingNextPage:c,isLoading:v}=Z(h);let P;t[8]!==f?.pages?(P=f?.pages.flatMap(Ie)||[],t[8]=f?.pages,t[9]=P):P=t[9];const y=P;let p;return t[10]!==l||t[11]!==y||t[12]!==d||t[13]!==c||t[14]!==v?(p={followList:y,fetchNextPage:l,hasNextPage:d,isFetchingNextPage:c,isLoading:v},t[10]=l,t[11]=y,t[12]=d,t[13]=c,t[14]=v,t[15]=p):p=t[15],p};function Ze(e){if(!(!e||e.length<10))return e[e.length-1].followed_at}function Ie(e){return e}const Ue=(e,i)=>{const s=te(),{addToast:t}=ae(),o=(0,Q.useCallback)((r=[],g=[])=>r.map(m=>({id:m.id,sender:m.sender_id===e?.id?"me":"them",senderAvatar:m.sender?.avatar,senderName:m.sender?.name,text:m.content,type:m.type||"text",media:m.media?Array.isArray(m.media)?m.media:[m.media]:[],isRead:m.is_read,replyToId:m.reply_to_id,reactions:g.filter(_=>_.message_id===m.id),time:new Date(m.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),updatedAt:m.updated_at})),[e?.id]),{data:a,fetchNextPage:n,hasNextPage:h,isFetchingNextPage:f,isLoading:l,refetch:d}=Z({queryKey:["messages",i],queryFn:({pageParam:r})=>be(i,r,20),initialPageParam:null,getNextPageParam:r=>{if(!(!r||r.length<20))return r[r.length-1].created_at},enabled:!!i,refetchOnWindowFocus:!1}),{data:c=[]}=ne({queryKey:["reactions",i],queryFn:()=>Me(i),enabled:!!i,staleTime:1e3*60*5}),v=ie({mutationFn:({convId:r,text:g,type:m="text",media:_=[],replyToId:b=null})=>ye(r,e.id,g,m,_,b),onSuccess:r=>{r&&(s.invalidateQueries({queryKey:["messages",r.conversation_id]}),s.invalidateQueries({queryKey:["conversations",e.id]}))},onError:()=>{t("Failed to send message","error")}}),P=ie({mutationFn:({messageId:r,content:g})=>qe(r,g),onSuccess:r=>{r&&(s.invalidateQueries({queryKey:["messages",i]}),s.invalidateQueries({queryKey:["conversations",e?.id]}))},onError:()=>{t("Failed to edit message","error")}}),y=async(r,g)=>{if(e?.id)try{await Ne(r,e.id,g),s.invalidateQueries({queryKey:["reactions",i]})}catch(m){console.error("Failed to toggle reaction:",m),t("Failed to update reaction","error")}},p=async r=>{try{await $e(r),s.invalidateQueries({queryKey:["messages",i]}),s.invalidateQueries({queryKey:["conversations",e?.id]})}catch(g){console.error("Failed to delete message:",g),t("Failed to delete message","error")}};return{messages:(0,Q.useMemo)(()=>[...a?.pages.flatMap(r=>r)||[]].reverse(),[a]),isMsgLoading:l,refetchMessages:d,fetchNextMessages:n,hasMoreMessages:h,isFetchingMoreMessages:f,sendMessage:(r,g,m,_,b)=>v.mutate({convId:r,text:g,type:m,media:_,replyToId:b}),editMessage:(r,g)=>P.mutate({messageId:r,content:g}),isSending:v.isPending,isEditing:P.isPending,onToggleReaction:y,onDeleteMessage:p,conversationReactions:c,formatMessages:o}};var et=G();const tt=(e,i)=>{const s=(0,et.c)(20),t=te();let o;s[0]===Symbol.for("react.memo_cache_sentinel")?(o={},s[0]=o):o=s[0];const[a,n]=(0,Q.useState)(o),h=(0,Q.useRef)(null);let f;s[1]!==e||s[2]!==t?(f=async r=>{if(!(!e?.id||!r))try{await Xe(r),t.invalidateQueries({queryKey:["unread_messages_count",e.id]}),t.invalidateQueries({queryKey:["conversations",e.id]})}catch(g){console.error("Failed to mark as read:",g)}},s[1]=e,s[2]=t,s[3]=f):f=s[3];const l=f;let d;s[4]!==i||s[5]!==e||s[6]!==l||s[7]!==t?(d=()=>{if(!e?.id)return;const r=U.channel(`messages_realtime:${i||"global"}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},m=>{const _=m.new;i&&_.conversation_id===i&&(t.invalidateQueries({queryKey:["messages",i]}),_.sender_id!==e.id&&l(i)),t.invalidateQueries({queryKey:["conversations",e.id]}),_.sender_id!==e.id&&t.invalidateQueries({queryKey:["unread_messages_count",e.id]}),n(b=>({...b,[_.conversation_id]:!1}))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"messages"},()=>{t.invalidateQueries({queryKey:["messages"]}),t.invalidateQueries({queryKey:["conversations",e.id]})}).on("postgres_changes",{event:"*",schema:"public",table:"message_reactions"},()=>{i&&t.invalidateQueries({queryKey:["reactions",i]})}).subscribe(),g=U.channel("chat_typing_shared").on("broadcast",{event:"typing"},m=>{const{payload:_}=m,{conversationId:b,isTyping:u,userId:M}=_;M!==e.id&&n(S=>({...S,[b]:u}))}).subscribe();return h.current=g,()=>{U.removeChannel(r),U.removeChannel(g)}},s[4]=i,s[5]=e,s[6]=l,s[7]=t,s[8]=d):d=s[8];const c=e?.id;let v;s[9]!==i||s[10]!==l||s[11]!==t||s[12]!==c?(v=[c,t,i,l],s[9]=i,s[10]=l,s[11]=t,s[12]=c,s[13]=v):v=s[13],(0,Q.useEffect)(d,v);let P;s[14]!==e?(P=(r,g)=>{h.current&&e&&h.current.send({type:"broadcast",event:"typing",payload:{conversationId:r,isTyping:g,userId:e.id}})},s[14]=e,s[15]=P):P=s[15];const y=P;let p;return s[16]!==l||s[17]!==y||s[18]!==a?(p={typingStatus:a,sendTypingStatus:y,markAsRead:l},s[16]=l,s[17]=y,s[18]=a,s[19]=p):p=s[19],p};var st=G();const it=(e,i)=>{const s=(0,st.c)(22),{conversations:t,unreadCount:o,isConvLoading:a,refetchConversations:n}=Ae(e),{messages:h,isMsgLoading:f,refetchMessages:l,fetchNextMessages:d,hasMoreMessages:c,isFetchingMoreMessages:v,sendMessage:P,editMessage:y,isSending:p,isEditing:r,onToggleReaction:g,onDeleteMessage:m,conversationReactions:_,formatMessages:b}=Ue(e,i),{typingStatus:u,sendTypingStatus:M,markAsRead:S}=tt(e,i);let $;return s[0]!==_||s[1]!==t||s[2]!==y||s[3]!==d||s[4]!==b||s[5]!==c||s[6]!==a||s[7]!==r||s[8]!==v||s[9]!==f||s[10]!==p||s[11]!==S||s[12]!==h||s[13]!==m||s[14]!==g||s[15]!==n||s[16]!==l||s[17]!==P||s[18]!==M||s[19]!==u||s[20]!==o?($={conversations:t,unreadCount:o,isConvLoading:a,refetchConversations:n,refetchMessages:l,sendMessage:P,editMessage:y,sendTypingStatus:M,typingStatus:u,markAsRead:S,formatMessages:b,onToggleReaction:g,onDeleteMessage:m,conversationReactions:_,isSending:p,isEditing:r,messages:h,isMsgLoading:f,fetchNextMessages:d,hasMoreMessages:c,isFetchingMoreMessages:v},s[0]=_,s[1]=t,s[2]=y,s[3]=d,s[4]=b,s[5]=c,s[6]=a,s[7]=r,s[8]=v,s[9]=f,s[10]=p,s[11]=S,s[12]=h,s[13]=m,s[14]=g,s[15]=n,s[16]=l,s[17]=P,s[18]=M,s[19]=u,s[20]=o,s[21]=$):$=s[21],$};var nt=G();const Ut=(e,i,s)=>{const t=(0,nt.c)(85),o=te(),{addToast:a}=ae();let n;t[0]!==i?(n=i||{comments:0,likes:0,mirrors:0,reposts:0},t[0]=i,t[1]=n):n=t[1];const[h,f]=(0,Q.useState)(n),[l,d]=(0,Q.useState)(i);i!==l&&(d(i),f(T=>({...T,...i})));const c=s?.id;let v;t[2]!==e||t[3]!==c?(v=["post",e,"liked",c],t[2]=e,t[3]=c,t[4]=v):v=t[4];let P,y;t[5]!==s||t[6]!==e?(P=()=>Ce(e,s.id),y=!!s&&I(e)&&I(s.id),t[5]=s,t[6]=e,t[7]=P,t[8]=y):(P=t[7],y=t[8]);let p;t[9]!==v||t[10]!==P||t[11]!==y?(p={queryKey:v,queryFn:P,enabled:y,staleTime:6e5},t[9]=v,t[10]=P,t[11]=y,t[12]=p):p=t[12];const{data:r}=ne(p),g=r===void 0?!1:r,m=s?.id;let _;t[13]!==e||t[14]!==m?(_=["post",e,"reposted",m],t[13]=e,t[14]=m,t[15]=_):_=t[15];let b,u;t[16]!==s||t[17]!==e?(u=()=>Te(e,s.id),b=!!s&&I(e)&&I(s.id),t[16]=s,t[17]=e,t[18]=b,t[19]=u):(b=t[18],u=t[19]);let M;t[20]!==b||t[21]!==_||t[22]!==u?(M={queryKey:_,queryFn:u,enabled:b,staleTime:6e5},t[20]=b,t[21]=_,t[22]=u,t[23]=M):M=t[23];const{data:S}=ne(M),$=S===void 0?!1:S;let q;t[24]!==s||t[25]!==e?(q=()=>ge(e,s.id),t[24]=s,t[25]=e,t[26]=q):q=t[26];let K;t[27]!==s||t[28]!==e||t[29]!==o?(K=async()=>{const T=s.id;await o.cancelQueries({queryKey:["post",e,"liked",T]});const j=o.getQueryData(["post",e,"liked",T]);return o.setQueryData(["post",e,"liked",T],!j),f(w=>({...w,likes:j?(w.likes||0)-1:(w.likes||0)+1})),{previousLiked:j}},t[27]=s,t[28]=e,t[29]=o,t[30]=K):K=t[30];let E;t[31]!==a||t[32]!==s||t[33]!==e||t[34]!==o?(E=(T,j,w)=>{w?.previousLiked!==void 0&&(o.setQueryData(["post",e,"liked",s.id],w.previousLiked),f(V=>({...V,likes:w.previousLiked?(V.likes||0)+1:(V.likes||0)-1}))),a("Failed to update like","error")},t[31]=a,t[32]=s,t[33]=e,t[34]=o,t[35]=E):E=t[35];let J;t[36]!==s?.id||t[37]!==e||t[38]!==o?(J=()=>{o.invalidateQueries({queryKey:["post",e,"liked",s?.id]})},t[36]=s?.id,t[37]=e,t[38]=o,t[39]=J):J=t[39];let O;t[40]!==q||t[41]!==K||t[42]!==E||t[43]!==J?(O={mutationFn:q,onMutate:K,onError:E,onSettled:J},t[40]=q,t[41]=K,t[42]=E,t[43]=J,t[44]=O):O=t[44];const L=ie(O);let k;t[45]!==s||t[46]!==e?(k=()=>Oe(e,s.id),t[45]=s,t[46]=e,t[47]=k):k=t[47];let R;t[48]!==s||t[49]!==e||t[50]!==o?(R=async()=>{const T=s.id;await o.cancelQueries({queryKey:["post",e,"reposted",T]});const j=o.getQueryData(["post",e,"reposted",T]);return o.setQueryData(["post",e,"reposted",T],!j),f(w=>({...w,reposts:j?(w.reposts||0)-1:(w.reposts||0)+1,mirrors:j?(w.mirrors||0)-1:(w.mirrors||0)+1})),{previousReposted:j}},t[48]=s,t[49]=e,t[50]=o,t[51]=R):R=t[51];let x;t[52]!==a||t[53]!==s||t[54]!==e||t[55]!==o?(x=(T,j,w)=>{w?.previousReposted!==void 0&&(o.setQueryData(["post",e,"reposted",s.id],w.previousReposted),f(V=>({...V,reposts:w.previousReposted?(V.reposts||0)+1:(V.reposts||0)-1,mirrors:w.previousReposted?(V.mirrors||0)+1:(V.mirrors||0)-1}))),a("Failed to update repost","error")},t[52]=a,t[53]=s,t[54]=e,t[55]=o,t[56]=x):x=t[56];let D;t[57]!==s?.id||t[58]!==e||t[59]!==o?(D=()=>{o.invalidateQueries({queryKey:["post",e,"reposted",s?.id]})},t[57]=s?.id,t[58]=e,t[59]=o,t[60]=D):D=t[60];let B;t[61]!==a?(B=T=>{a(T?"Reposted!":"Removed repost")},t[61]=a,t[62]=B):B=t[62];let A;t[63]!==k||t[64]!==R||t[65]!==x||t[66]!==D||t[67]!==B?(A={mutationFn:k,onMutate:R,onError:x,onSettled:D,onSuccess:B},t[63]=k,t[64]=R,t[65]=x,t[66]=D,t[67]=B,t[68]=A):A=t[68];const W=ie(A);let H;t[69]!==a||t[70]!==s||t[71]!==L||t[72]!==e?(H=async T=>{if(T&&T.stopPropagation(),!s)return a("Please login to like!","error");!I(e)||!I(s.id)||L.mutate()},t[69]=a,t[70]=s,t[71]=L,t[72]=e,t[73]=H):H=t[73];const z=H;let C;t[74]!==a||t[75]!==s||t[76]!==e||t[77]!==W?(C=async T=>{if(T&&T.stopPropagation(),!s)return a("Please login to repost!","error");!I(e)||!I(s.id)||W.mutate()},t[74]=a,t[75]=s,t[76]=e,t[77]=W,t[78]=C):C=t[78];const N=C;let F;return t[79]!==z||t[80]!==N||t[81]!==g||t[82]!==$||t[83]!==h?(F={liked:g,reposted:$,localStats:h,setLocalStats:f,handleLike:z,handleRepost:N},t[79]=z,t[80]=N,t[81]=g,t[82]=$,t[83]=h,t[84]=F):F=t[84],F};var at=G();const es=e=>{const i=(0,at.c)(5);let s;i[0]!==e?(s=()=>le(e),i[0]=e,i[1]=s):s=i[1];const[t,o]=(0,Q.useState)(s);let a,n;return i[2]!==e?(a=()=>{if(!e)return;const h=setTimeout(()=>{o(le(e))},0),f=setInterval(()=>{o(le(e))},6e4);return()=>{clearTimeout(h),clearInterval(f)}},n=[e],i[2]=e,i[3]=a,i[4]=n):(a=i[3],n=i[4]),(0,Q.useEffect)(a,n),t};var ot=G();const ts=()=>{const e=(0,ot.c)(30),[i,s]=(0,Q.useState)(!1),[t,o]=(0,Q.useState)(!1),[a,n]=(0,Q.useState)(0),[h,f]=(0,Q.useState)(null),[l,d]=(0,Q.useState)(null),c=(0,Q.useRef)(null),v=(0,Q.useRef)(null);let P;e[0]===Symbol.for("react.memo_cache_sentinel")?(P=[],e[0]=P):P=e[0];const y=(0,Q.useRef)(P);let p,r;e[1]!==l?(p=()=>()=>{v.current&&clearInterval(v.current),c.current&&c.current.state!=="inactive"&&(c.current.stop(),c.current.stream.getTracks().forEach(rt)),l&&URL.revokeObjectURL(l)},r=[l],e[1]=l,e[2]=p,e[3]=r):(p=e[2],r=e[3]),(0,Q.useEffect)(p,r);let g;e[4]===Symbol.for("react.memo_cache_sentinel")?(g=()=>{v.current=window.setInterval(()=>{n(lt)},1e3)},e[4]=g):g=e[4];const m=g;let _;e[5]===Symbol.for("react.memo_cache_sentinel")?(_=()=>{v.current&&(clearInterval(v.current),v.current=null)},e[5]=_):_=e[5];const b=_;let u;e[6]===Symbol.for("react.memo_cache_sentinel")?(u=async()=>{try{const D=await navigator.mediaDevices.getUserMedia({audio:!0}),B=new MediaRecorder(D);c.current=B,y.current=[],B.ondataavailable=A=>{A.data.size>0&&y.current.push(A.data)},B.onstop=()=>{const A=new Blob(y.current,{type:"audio/webm;codecs=opus"}),W=URL.createObjectURL(A);f(A),d(W),D.getTracks().forEach(ct)},B.start(),s(!0),o(!1),n(0),m()}catch(D){const B=D;throw console.error("Error accessing microphone:",B),B}},e[6]=u):u=e[6];const M=u;let S;e[7]!==i?(S=()=>{c.current&&i&&(c.current.stop(),s(!1),o(!1),b())},e[7]=i,e[8]=S):S=e[8];const $=S;let q;e[9]!==t||e[10]!==i?(q=()=>{c.current&&i&&!t&&(c.current.pause(),o(!0),b())},e[9]=t,e[10]=i,e[11]=q):q=e[11];const K=q;let E;e[12]!==t||e[13]!==i?(E=()=>{c.current&&i&&t&&(c.current.resume(),o(!1),m())},e[12]=t,e[13]=i,e[14]=E):E=e[14];const J=E;let O;e[15]!==i?(O=()=>{c.current&&i&&(c.current.stop(),c.current.onstop=null,s(!1),o(!1),b(),n(0),c.current.stream&&c.current.stream.getTracks().forEach(ut))},e[15]=i,e[16]=O):O=e[16];const L=O;let k;e[17]!==l?(k=()=>{l&&URL.revokeObjectURL(l),f(null),d(null),n(0)},e[17]=l,e[18]=k):k=e[18];const R=k;let x;return e[19]!==h||e[20]!==l||e[21]!==L||e[22]!==R||e[23]!==t||e[24]!==i||e[25]!==K||e[26]!==a||e[27]!==J||e[28]!==$?(x={isRecording:i,isPaused:t,recordingTime:a,startRecording:M,stopRecording:$,pauseRecording:K,resumeRecording:J,cancelRecording:L,audioBlob:h,audioUrl:l,clearAudio:R},e[19]=h,e[20]=l,e[21]=L,e[22]=R,e[23]=t,e[24]=i,e[25]=K,e[26]=a,e[27]=J,e[28]=$,e[29]=x):x=e[29],x};function rt(e){return e.stop()}function lt(e){return e+1}function ct(e){return e.stop()}function ut(e){return e.stop()}var dt=G();const ss=(e,i,s)=>{const t=(0,dt.c)(31),o=te();let a,n;t[0]!==s||t[1]!==e?(a=["comments",e,s],n=S=>{const{pageParam:$}=S;return we(e,$,10,s)},t[0]=s,t[1]=e,t[2]=a,t[3]=n):(a=t[2],n=t[3]);let h;t[4]!==i?(h=i?{pages:[i],pageParams:[null]}:void 0,t[4]=i,t[5]=h):h=t[5];const f=!!e;let l;t[6]!==a||t[7]!==n||t[8]!==h||t[9]!==f?(l={queryKey:a,queryFn:n,initialPageParam:null,getNextPageParam:ft,initialData:h,enabled:f},t[6]=a,t[7]=n,t[8]=h,t[9]=f,t[10]=l):l=t[10];const{data:d,fetchNextPage:c,hasNextPage:v,isFetchingNextPage:P,isLoading:y,refetch:p}=Z(l);let r;t[11]!==d?.pages?(r=d?.pages.flatMap(mt)||[],t[11]=d?.pages,t[12]=r):r=t[12];const g=r;let m;t[13]!==e?(m=S=>{const{userId:$,content:q,media:K,replyToId:E}=S;return Pe(e,$,q,K,E)},t[13]=e,t[14]=m):m=t[14];let _;t[15]!==s||t[16]!==e||t[17]!==o?(_=()=>{o.invalidateQueries({queryKey:["comments",e]}),s&&o.invalidateQueries({queryKey:["comments",e,s]})},t[15]=s,t[16]=e,t[17]=o,t[18]=_):_=t[18];let b;t[19]!==m||t[20]!==_?(b={mutationFn:m,onSuccess:_},t[19]=m,t[20]=_,t[21]=b):b=t[21];const u=ie(b);let M;return t[22]!==u.isPending||t[23]!==u.mutateAsync||t[24]!==g||t[25]!==c||t[26]!==v||t[27]!==P||t[28]!==y||t[29]!==p?(M={comments:g,fetchNextPage:c,hasNextPage:v,isFetchingNextPage:P,isLoading:y,refetch:p,addComment:u.mutateAsync,isSubmitting:u.isPending},t[22]=u.isPending,t[23]=u.mutateAsync,t[24]=g,t[25]=c,t[26]=v,t[27]=P,t[28]=y,t[29]=p,t[30]=M):M=t[30],M};function ft(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function mt(e){return e}var gt=G();const is=()=>{const e=(0,gt.c)(53),{handle:i}=re(),s=ee(),{currentUser:t}=se(),{addToast:o}=ae();let a,n;e[0]!==i?(a=["profile",i],n=()=>Ke(i),e[0]=i,e[1]=a,e[2]=n):(a=e[1],n=e[2]);const h=!!i;let f;e[3]!==a||e[4]!==n||e[5]!==h?(f={queryKey:a,queryFn:n,enabled:h,staleTime:3e5},e[3]=a,e[4]=n,e[5]=h,e[6]=f):f=e[6];const{data:l,isLoading:d}=ne(f),[c,v]=(0,Q.useState)("feed"),P=l?.id;let y;e[7]!==P?(y=["posts","user",P],e[7]=P,e[8]=y):y=e[8];let p;e[9]!==l?(p=w=>{const{pageParam:V}=w;return De(l.id,V,10)},e[9]=l,e[10]=p):p=e[10];const r=!!l?.id;let g;e[11]!==y||e[12]!==p||e[13]!==r?(g={queryKey:y,queryFn:p,enabled:r,initialPageParam:null,getNextPageParam:ht},e[11]=y,e[12]=p,e[13]=r,e[14]=g):g=e[14];const{data:m,fetchNextPage:_,hasNextPage:b,isFetchingNextPage:u,isLoading:M}=Z(g);let S;e[15]!==m?.pages?(S=m?.pages.flatMap(yt)||[],e[15]=m?.pages,e[16]=S):S=e[16];const $=S,[q,K]=(0,Q.useState)(!1),[E,J]=(0,Q.useState)("Followers"),{followList:O,fetchNextPage:L,hasNextPage:k,isFetchingNextPage:R,isLoading:x}=Ye(l?.id,E,q);let D;e[17]===Symbol.for("react.memo_cache_sentinel")?(D=w=>{J(w),K(!0)},e[17]=D):D=e[17];const B=D;let A;e:{if(c==="feed"){let w;e[18]!==$?(w=$.filter(pt),e[18]=$,e[19]=w):w=e[19],A=w;break e}if(c==="media"){let w;e[20]!==$?(w=$.filter(_t),e[20]=$,e[21]=w):w=e[21],A=w;break e}if(c==="collections"){let w;e[22]===Symbol.for("react.memo_cache_sentinel")?(w=[],e[22]=w):w=e[22],A=w;break e}A=$}const W=A;let H;e[23]!==s?(H=w=>{s(`/p/${w}`)},e[23]=s,e[24]=H):H=e[24];const z=H;let C;e[25]!==i||e[26]!==s?(C=w=>{w!==i&&s(`/u/${w}`)},e[25]=i,e[26]=s,e[27]=C):C=e[27];const N=C;let F;e[28]!==_?(F=()=>{_()},e[28]=_,e[29]=F):F=e[29];const T=F;let j;return e[30]!==c||e[31]!==o||e[32]!==t||e[33]!==L||e[34]!==W||e[35]!==O||e[36]!==E||e[37]!==i||e[38]!==z||e[39]!==N||e[40]!==k||e[41]!==b||e[42]!==R||e[43]!==u||e[44]!==q||e[45]!==x||e[46]!==T||e[47]!==M||e[48]!==d||e[49]!==s||e[50]!==l||e[51]!==$?(j={handle:i,profile:l,loading:d,userPosts:$,setUserPosts:Pt,activeProfileTab:c,setActiveProfileTab:v,loadingPosts:M,isFetchingMorePosts:u,hasMorePosts:b,filteredPosts:W,isFollowModalOpen:q,setIsFollowModalOpen:K,followModalType:E,followListData:O,isListLoading:x,isFetchingMoreFollows:R,hasMoreFollows:k,openFollowModal:B,fetchNextFollows:L,handlePostClick:z,handleUserClick:N,loadUserPosts:T,currentUser:t,addToast:o,navigate:s},e[30]=c,e[31]=o,e[32]=t,e[33]=L,e[34]=W,e[35]=O,e[36]=E,e[37]=i,e[38]=z,e[39]=N,e[40]=k,e[41]=b,e[42]=R,e[43]=u,e[44]=q,e[45]=x,e[46]=T,e[47]=M,e[48]=d,e[49]=s,e[50]=l,e[51]=$,e[52]=j):j=e[52],j};function ht(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function yt(e){return e}function pt(e){return e.community_id===null&&e.parent_id===null}function _t(e){return e.community_id===null&&e.parent_id===null&&(e.type==="video"||e.type==="image"||e.media&&e.media.length>0)}function Pt(){return console.warn("setUserPosts is deprecated")}var bt=G();const ns=()=>{const e=(0,bt.c)(75),{handle:i}=re(),s=ee(),{currentUser:t}=se(),{addToast:o}=ae(),a=te();let n,h;e[0]!==i?(n=["community",i],h=()=>ke(i),e[0]=i,e[1]=n,e[2]=h):(n=e[1],h=e[2]);const f=!!i;let l;e[3]!==n||e[4]!==h||e[5]!==f?(l={queryKey:n,queryFn:h,enabled:f,staleTime:6e5},e[3]=n,e[4]=h,e[5]=f,e[6]=l):l=e[6];const{data:d,isLoading:c,refetch:v}=ne(l),P=d?.id,y=t?.id;let p;e[7]!==P||e[8]!==y?(p=["community",P,"membership",y],e[7]=P,e[8]=y,e[9]=p):p=e[9];let r;e[10]!==d||e[11]!==t?(r=()=>pe(d.id,t.id),e[10]=d,e[11]=t,e[12]=r):r=e[12];const g=!!d?.id&&!!t?.id;let m;e[13]!==p||e[14]!==r||e[15]!==g?(m={queryKey:p,queryFn:r,enabled:g,staleTime:3e5},e[13]=p,e[14]=r,e[15]=g,e[16]=m):m=e[16];const{data:_}=ne(m),b=!!_,u=_?.role||null,M=d?.id;let S;e[17]!==M?(S=["posts","community",M],e[17]=M,e[18]=S):S=e[18];let $;e[19]!==d?($=j=>{const{pageParam:w}=j;return _e(d.id,w,10)},e[19]=d,e[20]=$):$=e[20];const q=!!d?.id;let K;e[21]!==S||e[22]!==$||e[23]!==q?(K={queryKey:S,queryFn:$,enabled:q,initialPageParam:null,getNextPageParam:vt},e[21]=S,e[22]=$,e[23]=q,e[24]=K):K=e[24];const{data:E,fetchNextPage:J,hasNextPage:O,isFetchingNextPage:L,isLoading:k}=Z(K);let R;e[25]!==E?.pages?(R=E?.pages.flatMap(wt)||[],e[25]=E?.pages,e[26]=R):R=e[26];const x=R;let D;e[27]!==d||e[28]!==t?(D=()=>Re(d.id,t.id),e[27]=d,e[28]=t,e[29]=D):D=e[29];let B;e[30]!==d||e[31]!==t||e[32]!==i||e[33]!==a?(B=async()=>{const j=d.id,w=t.id;await a.cancelQueries({queryKey:["community",j,"membership",w]}),await a.cancelQueries({queryKey:["community",i]});const V=a.getQueryData(["community",j,"membership",w]),oe=a.getQueryData(["community",i]);return a.setQueryData(["community",j,"membership",w],V?null:{role:"member"}),a.setQueryData(["community",i],X=>X&&{...X,membersCount:V?X.membersCount-1:X.membersCount+1}),{previousMembership:V,previousCommunity:oe}},e[30]=d,e[31]=t,e[32]=i,e[33]=a,e[34]=B):B=e[34];let A;e[35]!==o||e[36]!==d||e[37]!==t||e[38]!==i||e[39]!==a?(A=(j,w,V)=>{V?.previousMembership!==void 0&&a.setQueryData(["community",d.id,"membership",t.id],V.previousMembership),V?.previousCommunity&&a.setQueryData(["community",i],V.previousCommunity),o("Failed to update membership","error")},e[35]=o,e[36]=d,e[37]=t,e[38]=i,e[39]=a,e[40]=A):A=e[40];let W;e[41]!==d?.id||e[42]!==t?.id||e[43]!==i||e[44]!==a?(W=()=>{a.invalidateQueries({queryKey:["community",d?.id,"membership",t?.id]}),a.invalidateQueries({queryKey:["community",i]})},e[41]=d?.id,e[42]=t?.id,e[43]=i,e[44]=a,e[45]=W):W=e[45];let H;e[46]!==o||e[47]!==d?(H=j=>{d&&o(j?`Joined ${d.name}`:`Left ${d.name}`)},e[46]=o,e[47]=d,e[48]=H):H=e[48];let z;e[49]!==D||e[50]!==B||e[51]!==A||e[52]!==W||e[53]!==H?(z={mutationFn:D,onMutate:B,onError:A,onSettled:W,onSuccess:H},e[49]=D,e[50]=B,e[51]=A,e[52]=W,e[53]=H,e[54]=z):z=e[54];const C=ie(z);let N;e[55]!==o||e[56]!==t||e[57]!==C?(N=async()=>{if(!t)return o("Please login to join communities","error");C.mutate()},e[55]=o,e[56]=t,e[57]=C,e[58]=N):N=e[58];const F=N;let T;return e[59]!==o||e[60]!==d||e[61]!==x||e[62]!==t||e[63]!==J||e[64]!==F||e[65]!==O||e[66]!==L||e[67]!==b||e[68]!==C.isPending||e[69]!==c||e[70]!==k||e[71]!==s||e[72]!==v||e[73]!==u?(T={community:d,loading:c,isMember:b,userRole:u,isJoining:C.isPending,communityPosts:x,loadingPosts:k,isFetchingMorePosts:L,hasMorePosts:O,handleJoinToggle:F,loadCommunityPosts:J,refetchCommunity:v,currentUser:t,addToast:o,navigate:s},e[59]=o,e[60]=d,e[61]=x,e[62]=t,e[63]=J,e[64]=F,e[65]=O,e[66]=L,e[67]=b,e[68]=C.isPending,e[69]=c,e[70]=k,e[71]=s,e[72]=v,e[73]=u,e[74]=T):T=e[74],T};function vt(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function wt(e){return e}var Mt=G();const as=()=>{const e=(0,Mt.c)(48),{currentUser:i}=se(),s=ee(),[t,o]=de();let a;e[0]!==t?(a=t.get("q")||"",e[0]=t,e[1]=a):a=e[1];const n=a;let h;e[2]!==t||e[3]!==n?(h=t.get("tab")||(n?"posts":"communities"),e[2]=t,e[3]=n,e[4]=h):h=e[4];const f=h,[l,d]=(0,Q.useState)(!1);let c;e[5]===Symbol.for("react.memo_cache_sentinel")?(c=["explore","communities"],e[5]=c):c=e[5];let v;e[6]===Symbol.for("react.memo_cache_sentinel")?(v={queryKey:c,queryFn:St,initialPageParam:null,getNextPageParam:$t},e[6]=v):v=e[6];const{data:P,fetchNextPage:y,hasNextPage:p,isFetchingNextPage:r,isLoading:g}=Z(v);let m;e[7]!==P?.pages?(m=P?.pages.flatMap(Rt)||[],e[7]=P?.pages,e[8]=m):m=e[8];const _=m;let b,u;e[9]!==n?(b=["explore","posts",n],u=z=>{const{pageParam:C}=z;return n?Fe(n,C,10,!0):ze(C,10)},e[9]=n,e[10]=b,e[11]=u):(b=e[10],u=e[11]);let M;e[12]!==b||e[13]!==u?(M={queryKey:b,queryFn:u,initialPageParam:null,getNextPageParam:qt},e[12]=b,e[13]=u,e[14]=M):M=e[14];const{data:S,fetchNextPage:$,hasNextPage:q,isFetchingNextPage:K,isLoading:E}=Z(M);let J;e[15]!==S?.pages?(J=S?.pages.flatMap(Ft)||[],e[15]=S?.pages,e[16]=J):J=e[16];const O=J;let L=_;if(n){let z;if(e[17]!==L||e[18]!==n){let C;e[20]!==n?(C=N=>N.name?.toLowerCase().includes(n.toLowerCase())||N.handle?.toLowerCase().includes(n.toLowerCase()),e[20]=n,e[21]=C):C=e[21],z=L.filter(C),e[17]=L,e[18]=n,e[19]=z}else z=e[19];L=z}const k=L;let R;e[22]!==s?(R=z=>{s(`/c/${z}`)},e[22]=s,e[23]=R):R=e[23];const x=R;let D;e[24]!==o?(D=z=>{o(C=>(z?C.set("q",z):C.delete("q"),C),{replace:!0})},e[24]=o,e[25]=D):D=e[25];const B=D;let A;e[26]!==o?(A=z=>{o(C=>(C.set("tab",z),C),{replace:!0})},e[26]=o,e[27]=A):A=e[27];const W=A;let H;return e[28]!==f||e[29]!==_||e[30]!==i||e[31]!==y||e[32]!==$||e[33]!==k||e[34]!==x||e[35]!==B||e[36]!==W||e[37]!==p||e[38]!==q||e[39]!==g||e[40]!==l||e[41]!==r||e[42]!==K||e[43]!==E||e[44]!==s||e[45]!==O||e[46]!==n?(H={currentUser:i,searchQuery:n,setSearchQuery:B,activeTab:f,setActiveTab:W,isCreateModalOpen:l,setIsCreateModalOpen:d,communitiesData:_,isCommunitiesLoading:g,isFetchingMoreCommunities:r,hasMoreCommunities:p,postsData:O,isPostsLoading:E,isFetchingMorePosts:K,hasMorePosts:q,filteredCommunities:k,handleCommunityClick:x,loadCommunities:y,loadPosts:$,navigate:s},e[28]=f,e[29]=_,e[30]=i,e[31]=y,e[32]=$,e[33]=k,e[34]=x,e[35]=B,e[36]=W,e[37]=p,e[38]=q,e[39]=g,e[40]=l,e[41]=r,e[42]=K,e[43]=E,e[44]=s,e[45]=O,e[46]=n,e[47]=H):H=e[47],H};function St(e){const{pageParam:i}=e;return Ve(i,10)}function $t(e){if(!(!e||e.length<10))return e[e.length-1].createdAt}function Rt(e){return e}function qt(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function Ft(e){return e}var Lt=G();const os=()=>{const e=(0,Lt.c)(21),{currentUser:i}=se(),{posts:s,loading:t,hasMore:o,isFetchingNextPage:a,fetchNextPage:n,refreshPosts:h}=Qe(),{addToast:f}=ae(),l=ee();let d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=["stories"],e[0]=d):d=e[0];let c;e[1]===Symbol.for("react.memo_cache_sentinel")?(c={queryKey:d,queryFn:kt,initialPageParam:null,getNextPageParam:Ct,refetchInterval:6e4},e[1]=c):c=e[1];const{data:v,isLoading:P}=Z(c);let y;if(e[2]!==v?.pages){const u=v?.pages.flatMap(Nt)||[],M=JSON.parse(localStorage.getItem("seenStories")||"[]");y=u.reduce(Tt,[]).map(S=>({...S,isSeen:M.includes(S.user.id)})),e[2]=v?.pages,e[3]=y}else y=e[3];const p=y;let r;e[4]!==l?(r=u=>{l(`/p/${u}`)},e[4]=l,e[5]=r):r=e[5];const g=r;let m;e[6]!==l?(m=u=>{l(`/u/${u}`)},e[6]=l,e[7]=m):m=e[7];const _=m;let b;return e[8]!==f||e[9]!==i||e[10]!==n||e[11]!==p||e[12]!==g||e[13]!==_||e[14]!==o||e[15]!==s||e[16]!==a||e[17]!==t||e[18]!==P||e[19]!==h?(b={currentUser:i,homePosts:s,groupedStories:p,isPostsLoading:t,isStoriesLoading:P,hasMore:o,isFetchingNextPage:a,fetchNextPage:n,refreshPosts:h,addToast:f,handlePostClick:g,handleUserClick:_},e[8]=f,e[9]=i,e[10]=n,e[11]=p,e[12]=g,e[13]=_,e[14]=o,e[15]=s,e[16]=a,e[17]=t,e[18]=P,e[19]=h,e[20]=b):b=e[20],b};function kt(e){const{pageParam:i}=e;return he(i,10)}function Ct(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Nt(e){return e}function Tt(e,i){const s=e.find(t=>t.user.id===i.user_id);return s?s.stories.push(i):e.push({user:i.user,stories:[i],isSeen:!1}),e}var xt=G();const rs=()=>{const e=(0,xt.c)(61),{id:i}=re(),s=ee(),{currentUser:t}=se(),{onlineUsers:o}=Ee(),a=te(),[n,h]=(0,Q.useState)("");let f;e[0]===Symbol.for("react.memo_cache_sentinel")?(f=[],e[0]=f):f=e[0];const[l,d]=(0,Q.useState)(f),{conversations:c,isConvLoading:v,refetchConversations:P,refetchMessages:y,sendMessage:p,editMessage:r,sendTypingStatus:g,typingStatus:m,markAsRead:_,formatMessages:b,onDeleteMessage:u,onToggleReaction:M,conversationReactions:S,messages:$,isMsgLoading:q,fetchNextMessages:K,hasMoreMessages:E,isFetchingMoreMessages:J}=it(t,i);let O;e:{if(!i||c.length===0){O=null;break e}let X;e[1]!==c||e[2]!==i?(X=c.find(Y=>Y.id===i)||null,e[1]=c,e[2]=i,e[3]=X):X=e[3],O=X}const L=O;let k,R;e[4]!==i||e[5]!==_?(k=()=>{i&&_(i)},R=[i,_],e[4]=i,e[5]=_,e[6]=k,e[7]=R):(k=e[6],R=e[7]),(0,Q.useEffect)(k,R);let x;e[8]!==c||e[9]!==t?.id||e[10]!==n?(x=()=>{const X=setTimeout(async()=>{if(n.length>1){const Y=await Je(n),ce=c.map(Dt);d(Y.filter(ue=>ue.id!==t?.id&&!ce.includes(ue.id)))}else d([])},300);return()=>clearTimeout(X)},e[8]=c,e[9]=t?.id,e[10]=n,e[11]=x):x=e[11];const D=t?.id;let B;e[12]!==c||e[13]!==n||e[14]!==D?(B=[n,c,D],e[12]=c,e[13]=n,e[14]=D,e[15]=B):B=e[15],(0,Q.useEffect)(x,B);let A;e[16]!==t||e[17]!==s||e[18]!==a?(A=async X=>{if(t)try{const Y=await Le(t.id,X.id);a.invalidateQueries({queryKey:["conversations",t.id]}),h(""),s(`/m/${Y}`)}catch(Y){console.error("Failed to start conversation:",Y)}},e[16]=t,e[17]=s,e[18]=a,e[19]=A):A=e[19];const W=A;let H;e[20]!==s?(H=X=>{s(`/m/${X.id}`)},e[20]=s,e[21]=H):H=e[21];const z=H;let C;e[22]!==S||e[23]!==b||e[24]!==$?(C=b($,S),e[22]=S,e[23]=b,e[24]=$,e[25]=C):C=e[25];const N=C;let F;if(e[26]!==c||e[27]!==n){let X;e[29]!==n?(X=Y=>Y.user?.name?.toLowerCase().includes(n.toLowerCase())||Y.user?.handle?.toLowerCase().includes(n.toLowerCase())||Y.lastMessage?.toLowerCase().includes(n.toLowerCase()),e[29]=n,e[30]=X):X=e[30],F=c.filter(X),e[26]=c,e[27]=n,e[28]=F}else F=e[28];const T=F,j=L&&m[L.id];let w;e[31]!==o||e[32]!==L?(w=L&&L.user?.id&&o.has(L.user.id),e[31]=o,e[32]=L,e[33]=w):w=e[33];const V=w;let oe;return e[34]!==c||e[35]!==j||e[36]!==t||e[37]!==r||e[38]!==K||e[39]!==T||e[40]!==z||e[41]!==W||e[42]!==E||e[43]!==i||e[44]!==v||e[45]!==J||e[46]!==q||e[47]!==N||e[48]!==n||e[49]!==s||e[50]!==u||e[51]!==M||e[52]!==o||e[53]!==V||e[54]!==P||e[55]!==y||e[56]!==L||e[57]!==p||e[58]!==g||e[59]!==l?(oe={id:i,currentUser:t,onlineUsers:o,msgSearchQuery:n,setMsgSearchQuery:h,userSearchResults:l,conversations:c,filteredConversations:T,selectedConversation:L,localMessages:N,isConvLoading:v,isMsgLoading:q,currentIsTyping:j,otherUserIsOnline:V,handleStartConversation:W,handleSelectConversation:z,refetchConversations:P,refetchMessages:y,sendMessage:p,editMessage:r,onDeleteMessage:u,sendTypingStatus:g,onToggleReaction:M,navigate:s,fetchNextMessages:K,hasMoreMessages:E,isFetchingMoreMessages:J},e[34]=c,e[35]=j,e[36]=t,e[37]=r,e[38]=K,e[39]=T,e[40]=z,e[41]=W,e[42]=E,e[43]=i,e[44]=v,e[45]=J,e[46]=q,e[47]=N,e[48]=n,e[49]=s,e[50]=u,e[51]=M,e[52]=o,e[53]=V,e[54]=P,e[55]=y,e[56]=L,e[57]=p,e[58]=g,e[59]=l,e[60]=oe):oe=e[60],oe};function Dt(e){return e.user?.id}var Qt=G();const ls=()=>{const e=(0,Qt.c)(48),{currentUser:i}=se(),s=ee(),t=te(),o=i?.id;let a;e[0]!==o?(a=["notifications",o],e[0]=o,e[1]=a):a=e[1];let n;e[2]!==i?(n=R=>{const{pageParam:x}=R;return je(i.id,x,10)},e[2]=i,e[3]=n):n=e[3];const h=!!i?.id;let f;e[4]!==a||e[5]!==n||e[6]!==h?(f={queryKey:a,queryFn:n,enabled:h,initialPageParam:null,getNextPageParam:Kt},e[4]=a,e[5]=n,e[6]=h,e[7]=f):f=e[7];const{data:l,fetchNextPage:d,hasNextPage:c,isFetchingNextPage:v,isLoading:P,refetch:y}=Z(f);let p;e[8]!==l?.pages?(p=l?.pages.flatMap(Et)||[],e[8]=l?.pages,e[9]=p):p=e[9];const r=p;let g;e[10]!==i||e[11]!==t?(g=()=>{if(!i?.id)return;const R=i.id,x=U.channel(`user_notifications:${R}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${R}`},()=>{t.invalidateQueries({queryKey:["notifications",R]})}).subscribe();return()=>{U.removeChannel(x)}},e[10]=i,e[11]=t,e[12]=g):g=e[12];const m=i?.id;let _;e[13]!==t||e[14]!==m?(_=[m,t],e[13]=t,e[14]=m,e[15]=_):_=e[15],(0,Q.useEffect)(g,_);let b;e[16]!==i?(b=()=>i?Se(i.id):Promise.resolve(),e[16]=i,e[17]=b):b=e[17];let u,M,S;e[18]!==i?.id||e[19]!==t?(u=async()=>{const R=i?.id;await t.cancelQueries({queryKey:["notifications",R]});const x=t.getQueryData(["notifications",R]);return t.setQueryData(["notifications",R],Bt),{previousNotifications:x}},M=(R,x,D)=>{D?.previousNotifications&&t.setQueryData(["notifications",i?.id],D.previousNotifications)},S=()=>{t.invalidateQueries({queryKey:["notifications",i?.id]})},e[18]=i?.id,e[19]=t,e[20]=u,e[21]=M,e[22]=S):(u=e[20],M=e[21],S=e[22]);let $;e[23]!==u||e[24]!==M||e[25]!==S||e[26]!==b?($={mutationFn:b,onMutate:u,onError:M,onSettled:S},e[23]=u,e[24]=M,e[25]=S,e[26]=b,e[27]=$):$=e[27];const q=ie($);let K;e[28]!==s?(K=R=>{R.type==="follow"?s(`/u/${R.user}`):R.post_id&&s(`/p/${R.post_id}`)},e[28]=s,e[29]=K):K=e[29];const E=K;let J;e[30]!==i?.id||e[31]!==q||e[32]!==r?(J=()=>{i?.id&&r.some(jt)&&q.mutate()},e[30]=i?.id,e[31]=q,e[32]=r,e[33]=J):J=e[33];const O=i?.id;let L;e[34]!==q||e[35]!==r||e[36]!==O?(L=[O,r,q],e[34]=q,e[35]=r,e[36]=O,e[37]=L):L=e[37],(0,Q.useEffect)(J,L);let k;return e[38]!==i||e[39]!==d||e[40]!==E||e[41]!==c||e[42]!==v||e[43]!==P||e[44]!==s||e[45]!==r||e[46]!==y?(k={currentUser:i,notifications:r,isLoading:P,isFetchingMore:v,hasMore:c,loadNotifications:d,refreshNotifications:y,handleNotificationClick:E,navigate:s},e[38]=i,e[39]=d,e[40]=E,e[41]=c,e[42]=v,e[43]=P,e[44]=s,e[45]=r,e[46]=y,e[47]=k):k=e[47],k};function Kt(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Et(e){return e}function At(e){return{...e,is_read:!0}}function Ot(e){return e.map(At)}function Bt(e){return e&&{...e,pages:e.pages.map(Ot)}}function jt(e){return!e.is_read}var Jt=G();const cs=()=>{const e=(0,Jt.c)(23),{id:i}=re(),s=ee(),{currentUser:t}=se(),{addToast:o}=ae(),a=te();let n,h;e[0]!==i?(n=["post",i],h=async()=>{if(!i||!I(i))throw new Error("Invalid post ID");return ve(i)},e[0]=i,e[1]=n,e[2]=h):(n=e[1],h=e[2]);const f=!!i;let l;e[3]!==n||e[4]!==h||e[5]!==f?(l={queryKey:n,queryFn:h,enabled:f,retry:!1},e[3]=n,e[4]=h,e[5]=f,e[6]=l):l=e[6];const{data:d,isLoading:c,isError:v}=ne(l);let P;e[7]!==s?(P=b=>{s(`/u/${b}`)},e[7]=s,e[8]=P):P=e[8];const y=P;let p;e[9]!==s?(p=()=>{s(-1)},e[9]=s,e[10]=p):p=e[10];const r=p;let g;e[11]!==a?(g=(b,u,M)=>{a.setQueryData(["post",b],S=>S&&{...S,content:u,media:M})},e[11]=a,e[12]=g):g=e[12];const m=g;let _;return e[13]!==o||e[14]!==t||e[15]!==r||e[16]!==m||e[17]!==y||e[18]!==v||e[19]!==c||e[20]!==s||e[21]!==d?(_={post:d,isLoading:c,isError:v,currentUser:t,addToast:o,navigate:s,handleUserClick:y,handleDelete:r,handleUpdate:m},e[13]=o,e[14]=t,e[15]=r,e[16]=m,e[17]=y,e[18]=v,e[19]=c,e[20]=s,e[21]=d,e[22]=_):_=e[22],_};var zt=G();const us=()=>{const e=(0,zt.c)(44),i=ee(),{id:s}=re(),[t]=de();let o;e[0]!==s||e[1]!==t?(o=s||t.get("id"),e[0]=s,e[1]=t,e[2]=o):o=e[2];const a=o,n=(0,Q.useRef)(null);let h;e[3]===Symbol.for("react.memo_cache_sentinel")?(h=new Map,e[3]=h):h=e[3];const f=(0,Q.useRef)(h),[l,d]=(0,Q.useState)(null),[c,v]=(0,Q.useState)(!0);let P;e[4]===Symbol.for("react.memo_cache_sentinel")?(P=["reels"],e[4]=P):P=e[4];let y;e[5]===Symbol.for("react.memo_cache_sentinel")?(y={queryKey:P,queryFn:Ht,initialPageParam:null,getNextPageParam:Vt},e[5]=y):y=e[5];const{data:p,fetchNextPage:r,hasNextPage:g,isFetchingNextPage:m,isLoading:_}=Z(y);let b;e[6]!==p?.pages?(b=p?.pages.flatMap(Wt)||[],e[6]=p?.pages,e[7]=b):b=e[7];const u=b,[M,S]=(0,Q.useState)(0);u.length>0&&u.length!==M&&!l&&(S(u.length),a&&u.find(N=>N.id===a)?d(a):d(u[0].id));let $,q;e[8]!==u.length||e[9]!==a?($=()=>{if(u.length>0&&a){const N=f.current.get(a);N&&N.scrollIntoView({behavior:"instant"})}},q=[u.length,a],e[8]=u.length,e[9]=a,e[10]=$,e[11]=q):($=e[10],q=e[11]),(0,Q.useEffect)($,q);let K;e[12]===Symbol.for("react.memo_cache_sentinel")?(K=()=>{v(Xt)},e[12]=K):K=e[12];const E=K;let J;e[13]!==l||e[14]!==u?(J=()=>{if(u.length===0)return;const N=u.findIndex(F=>F.id===l);if(N<u.length-1){const F=u[N+1];f.current.get(F.id)?.scrollIntoView({behavior:"smooth"})}},e[13]=l,e[14]=u,e[15]=J):J=e[15];const O=J;let L;e[16]!==l||e[17]!==u?(L=()=>{if(u.length===0)return;const N=u.findIndex(F=>F.id===l);if(N>0){const F=u[N-1];f.current.get(F.id)?.scrollIntoView({behavior:"smooth"})}},e[16]=l,e[17]=u,e[18]=L):L=e[18];const k=L;let R,x;e[19]!==u.length?(R=()=>{if(u.length===0)return;const N={root:n.current,threshold:.6},F=j=>{j.forEach(w=>{if(w.isIntersecting){const V=w.target.getAttribute("data-id");V&&d(V)}})},T=new IntersectionObserver(F,N);return f.current.forEach(j=>T.observe(j)),()=>T.disconnect()},x=[u.length],e[19]=u.length,e[20]=R,e[21]=x):(R=e[20],x=e[21]),(0,Q.useEffect)(R,x);let D,B;e[22]!==l||e[23]!==O||e[24]!==k?(D=()=>{const N=F=>{const T=F.target;if(!(T.tagName==="INPUT"||T.tagName==="TEXTAREA"||T.isContentEditable)&&!(F.ctrlKey||F.altKey||F.metaKey))e:switch(F.key){case"ArrowUp":F.preventDefault(),k();break e;case"ArrowDown":F.preventDefault(),O();break e;case"m":case"M":E();break e;case" ":{F.preventDefault();const j=f.current.get(l||"");if(j){const w=j.querySelector(".reel-item");w&&w.click()}}}};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},B=[l,O,k,E],e[22]=l,e[23]=O,e[24]=k,e[25]=D,e[26]=B):(D=e[25],B=e[26]),(0,Q.useEffect)(D,B);let A;e[27]===Symbol.for("react.memo_cache_sentinel")?(A=(N,F)=>{F?f.current.set(N,F):f.current.delete(N)},e[27]=A):A=e[27];const W=A;let H,z;e[28]!==r||e[29]!==g||e[30]!==m?(H=()=>{const N=()=>{if(!n.current||m||!g)return;const{scrollTop:T,scrollHeight:j,clientHeight:w}=n.current;T+w>=j-800&&r()},F=n.current;if(F)return F.addEventListener("scroll",N),()=>F.removeEventListener("scroll",N)},z=[m,g,r],e[28]=r,e[29]=g,e[30]=m,e[31]=H,e[32]=z):(H=e[31],z=e[32]),(0,Q.useEffect)(H,z);let C;return e[33]!==l||e[34]!==r||e[35]!==g||e[36]!==m||e[37]!==_||e[38]!==c||e[39]!==i||e[40]!==u||e[41]!==O||e[42]!==k?(C={reels:u,loading:_,loadingMore:m,activeReelId:l,hasMore:g,isMuted:c,containerRef:n,setReelRef:W,navigate:i,toggleMute:E,scrollToNext:O,scrollToPrev:k,loadReels:r},e[33]=l,e[34]=r,e[35]=g,e[36]=m,e[37]=_,e[38]=c,e[39]=i,e[40]=u,e[41]=O,e[42]=k,e[43]=C):C=e[43],C};function Ht(e){const{pageParam:i}=e;return xe(i,10)}function Vt(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function Wt(e){return e}function Xt(e){return!e}const ds=()=>{const{currentUser:e,logout:i}=se(),{darkMode:s,toggleDarkMode:t,fontSize:o,setFontSize:a,dataSaver:n,setDataSaver:h}=We(),{addToast:f}=ae(),[l,d]=(0,Q.useState)(!1),[c,v]=(0,Q.useState)({newPassword:"",confirmPassword:""}),[P,y]=(0,Q.useState)(!1),p=async()=>{try{await i(),f("Logged out successfully")}catch(M){console.error("Logout error:",M),f("Failed to logout")}};return{currentUser:e,darkMode:s,toggleDarkMode:t,fontSize:o,setFontSize:a,dataSaver:n,setDataSaver:h,isChangingPassword:l,setIsChangingPassword:d,passwordData:c,setPasswordData:v,loading:P,handleLogout:p,handlePasswordChange:async M=>{if(M.preventDefault(),c.newPassword!==c.confirmPassword){f("Passwords do not match","error");return}if(c.newPassword.length<6){f("Password must be at least 6 characters","error");return}y(!0);try{const{error:S}=await U.auth.updateUser({password:c.newPassword});if(S)throw S;f("Password updated successfully!"),d(!1),v({newPassword:"",confirmPassword:""})}catch(S){console.error("Password update error:",S),f(S.message||"Failed to update password","error")}finally{y(!1)}},handlePasswordReset:async()=>{if(e?.email){y(!0);try{const{error:M}=await U.auth.resetPasswordForEmail(e.email,{redirectTo:`${window.location.origin}/settings?type=recovery`});if(M)throw M;f("Password reset email sent!")}catch(M){console.error("Reset password error:",M),f(M.message||"Failed to send reset email","error")}finally{y(!1)}}},handleClearCache:()=>{["seenStories","font-size","data-saver","theme"].forEach(M=>localStorage.removeItem(M)),f("Cache cleared! Reloading..."),setTimeout(()=>window.location.reload(),1500)},handleDownloadData:async()=>{if(e){y(!0);try{const M={user:{id:e.id,handle:e.handle,name:e.name,email:e.email},exportDate:new Date().toISOString(),note:"This is a mock export of your Sysm data."},S=new Blob([JSON.stringify(M,null,2)],{type:"application/json"}),$=URL.createObjectURL(S),q=document.createElement("a");q.href=$,q.download=`sysm-data-${e.handle}.json`,q.click(),URL.revokeObjectURL($),f("Data export started!")}catch{f("Failed to export data","error")}finally{y(!1)}}},handleDeleteAccount:()=>{window.confirm("Are you absolutely sure? This will permanently delete your account and all associated data. This action is irreversible.")&&(f("Account deletion request submitted. Logging out..."),setTimeout(p,2e3))},handleReportBug:()=>{window.prompt("Please describe the bug you found:")&&f("Bug reported! Thank you for your feedback.")}}};export{rs as a,ns as c,ts as d,es as f,ls as i,is as l,us as n,os as o,Ut as p,cs as r,as as s,ds as t,ss as u};
