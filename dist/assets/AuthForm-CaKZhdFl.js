import{a as x}from"./rolldown-runtime-BaZ8gS7u.js";import{l as w,w as k}from"./framework-3lkjbTvb.js";import{En as N,Qn as y,er as C,nr as S}from"./ui-libs-oBja7Jpd.js";import{Ut as _,dn as z,kn as A,ln as q,vt as c}from"./index-N8uoH5tK.js";var t=x(k(),1),e=x(w(),1),L=({type:s,onComplete:g,onSwitch:f})=>{const{login:b,signup:p}=z(),{addToast:n}=q(),[a,i]=(0,t.useState)({name:"",email:"",username:"",password:""}),[v,m]=(0,t.useState)(!1),[u,h]=(0,t.useState)(null),[l,o]=(0,t.useState)({loading:!1,available:null});(0,t.useEffect)(()=>{if(s==="signup"&&a.username.length>=5){const r=setTimeout(async()=>{o({loading:!0,available:null});try{o({loading:!1,available:await A(a.username)})}catch{o({loading:!1,available:null})}},500);return()=>clearTimeout(r)}else o({loading:!1,available:null})},[a.username,s]);const j=async r=>{if(r.preventDefault(),s==="signup"&&(l.available===!1||a.username.length<5)){n(a.username.length<5?"Username must be at least 5 characters":"Please choose a different username","error");return}m(!0),h(null);try{s==="login"?(await b({email:a.email,password:a.password}),n("Welcome back!"),g()):(await p({email:a.email,password:a.password,username:a.username,name:a.name}),n("Account created! Please verify your email."),window.location.href=`/verify-otp?email=${encodeURIComponent(a.email)}&type=signup`)}catch(d){console.error("Auth error:",d),h(d.message||"Authentication failed. Please check your credentials."),n("Authentication failed!","error")}finally{m(!1)}};return(0,e.jsxs)("div",{className:"mx-auto w-full max-w-md animate-in fade-in slide-in-from-bottom-5 duration-300 p-8 bg-card border border-border rounded-3xl shadow-xl",children:[(0,e.jsxs)("div",{className:"mb-8 text-center",children:[(0,e.jsx)("div",{className:"mb-4 flex justify-center",children:(0,e.jsx)("div",{className:"rounded-2xl bg-black p-3 shadow-lg text-white dark:bg-white dark:text-black",children:(0,e.jsx)("img",{src:"/logo.webp",alt:"Logo",className:"size-16 rounded-2xl shadow-xl"})})}),(0,e.jsx)("h2",{className:"mb-2 text-3xl font-extrabold tracking-tight dark:text-white",children:s==="login"?"Welcome back!":"Join MySys today"}),(0,e.jsx)("p",{className:"font-medium text-zinc-500",children:"The decentralized social network"})]}),u&&(0,e.jsxs)("div",{className:"mb-6 flex items-center gap-3 rounded-xl border border-rose-100 bg-rose-50 p-4 text-sm text-rose-600 dark:border-rose-800 dark:bg-rose-900/20 dark:text-rose-400",children:[(0,e.jsx)(S,{size:18}),(0,e.jsx)("span",{children:u})]}),(0,e.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,e.jsx)(c,{label:"Email",type:"email",placeholder:"john@example.com",value:a.email,onChange:r=>i({...a,email:r.target.value}),required:!0}),s==="signup"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(c,{label:"Name",placeholder:"John Doe",value:a.name,onChange:r=>i({...a,name:r.target.value}),required:!0}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)(c,{label:"Username",placeholder:"johndoe",value:a.username,onChange:r=>{const d=r.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"");i({...a,username:d})},required:!0}),(0,e.jsx)("div",{className:"absolute right-3 top-[38px]",children:l.loading?(0,e.jsx)(N,{size:18,className:"animate-spin text-zinc-400"}):l.available===!0?(0,e.jsx)(C,{size:18,className:"text-emerald-500"}):l.available===!1?(0,e.jsx)(y,{size:18,className:"text-rose-500"}):null})]})]}),(0,e.jsx)(c,{label:"Password",type:"password",placeholder:"••••••••",value:a.password,onChange:r=>i({...a,password:r.target.value}),required:!0}),s==="login"&&(0,e.jsx)("div",{className:"flex justify-end",children:(0,e.jsx)("button",{type:"button",onClick:()=>{window.location.href="/forgot-password"},className:"text-xs font-medium text-zinc-500 hover:text-black hover:underline dark:hover:text-white",children:"Forgot password?"})}),(0,e.jsx)(_,{type:"submit",className:"mt-6 w-full justify-center py-3 text-lg",loading:v,disabled:s==="signup"&&(l.available===!1||a.username.length<5),children:s==="login"?"Log in":"Sign up"})]}),(0,e.jsxs)("div",{className:"mt-8 text-center text-sm",children:[(0,e.jsx)("span",{className:"text-zinc-500",children:s==="login"?"Don't have an account?":"Already have an account?"}),(0,e.jsx)("button",{onClick:f,className:"ml-1 font-bold hover:underline dark:text-white",children:s==="login"?"Sign up":"Log in"})]})]})},T=L;export{T as t};
