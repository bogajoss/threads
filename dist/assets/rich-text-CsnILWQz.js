import{a as b}from"./rolldown-runtime-BaZ8gS7u.js";import{c as A,l as E,v as j,w}from"./framework-pz3E8ggb.js";import{Fn as x}from"./index-HyJg9jTV.js";import{i as C,n as D,r as H,t as R}from"./text-processing-BCvMLdJG.js";var S=H("hashtag",{isLink:!0});function I({scanner:n,parser:t}){const{POUND:i,UNDERSCORE:p,FULLWIDTHMIDDLEDOT:l,ASCIINUMERICAL:m,ALPHANUMERICAL:h}=n.tokens,{alpha:c,numeric:u,alphanumeric:e,emoji:o}=n.tokens.groups,s=t.start.tt(i),a=s.tt(p),r=new D(S);s.tt(m,r),s.tt(h,r),s.ta(u,a),s.ta(c,r),s.ta(o,r),s.ta(l,r),a.tt(m,r),a.tt(h,r),a.ta(c,r),a.ta(o,r),a.ta(l,r),a.ta(u,a),a.tt(p,a),r.ta(e,r),r.ta(o,r),r.tt(l,r),r.tt(p,r)}C("hashtag",I);var M=H("mention",{isLink:!0,toHref(){return"/"+this.toString().slice(1)}});function T({scanner:n,parser:t}){const{HYPHEN:i,SLASH:p,UNDERSCORE:l,AT:m}=n.tokens,{domain:h}=n.tokens.groups,c=t.start.tt(m),u=c.tt(i);u.tt(i,u);const e=c.tt(l,M);c.ta(h,e),u.tt(l,e),u.ta(h,e),e.ta(h,e),e.tt(i,e),e.tt(l,e);const o=e.tt(p);o.ta(h,e),o.tt(l,e),o.tt(i,e)}C("mention",T);const U={formatHref:(n,t)=>t==="mention"?`/u/${n.substring(1)}`:t==="hashtag"?`/tags/${n.substring(1)}`:n,attributes:{onClick:n=>n.stopPropagation(),className:"cursor-pointer font-bold text-rose-600 hover:underline dark:text-rose-400"},validate:{hashtag:n=>/^#[\u0980-\u09FF\w]+$/.test(n)},target:(n,t)=>t==="url"?"_blank":void 0,rel:(n,t)=>t==="url"?"noopener noreferrer":void 0};var F=A(),B=b(w(),1),k=b(E(),1),$=n=>{const t=(0,F.c)(13),{content:i,className:p,onClick:l}=n,m=j(),h=O;let c;t[0]!==i?(c=typeof i=="string"?h(i):i,t[0]=i,t[1]=c):c=t[1];const u=c;let e;t[2]!==p?(e=x("whitespace-pre-line break-words",p),t[2]=p,t[3]=e):e=t[3];let o;t[4]!==m?(o={...U,render:r=>{const{attributes:L,content:d}=r,{href:f,...g}=L,N=window.location.origin;if(f.includes("internal.tag/")){const v=decodeURIComponent(f.split("internal.tag/")[1]);return(0,k.jsxs)("span",{...g,className:x("cursor-pointer font-bold text-blue-600 hover:underline dark:text-blue-400",g.className),onClick:P=>{P.stopPropagation(),m(`/tags/${v}`)},children:["#",v]},d)}let _=null;return f.startsWith("/")?_=f:f.startsWith(N)&&(_=f.replace(N,"")),_?(0,k.jsx)("span",{...g,className:x("cursor-pointer font-medium text-blue-600 hover:underline dark:text-blue-400",g.className),onClick:v=>{v.stopPropagation(),m(_)},children:d},d):(0,k.jsx)("a",{href:f,...g,target:"_blank",rel:"noopener noreferrer",className:x("text-blue-600 hover:underline dark:text-blue-400",g.className),onClick:q,children:d},d)}},t[4]=m,t[5]=o):o=t[5];let s;t[6]!==u||t[7]!==o?(s=(0,k.jsx)(R,{options:o,children:u}),t[6]=u,t[7]=o,t[8]=s):s=t[8];let a;return t[9]!==l||t[10]!==e||t[11]!==s?(a=(0,k.jsx)("div",{className:e,onClick:l,children:s}),t[9]=l,t[10]=e,t[11]=s,t[12]=a):a=t[12],a},G=$;function O(n){return n.replace(/#([\u0980-\u09FF\w]+)/g,"https://internal.tag/$1")}function q(n){return n.stopPropagation()}export{G as t};
