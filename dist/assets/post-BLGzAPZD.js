import{a as Et}from"./rolldown-runtime-BaZ8gS7u.js";import{c as Z,d as Yt,l as es,n as ts,v as It,w as ss}from"./framework-3lkjbTvb.js";import{a as is,r as ls}from"./query-CZHA9T67.js";import{$t as as,At as ke,Bn as ns,Dn as rs,En as os,Fn as Me,Gn as cs,Gt as ds,Hn as ms,Ht as fs,Jn as xs,Kn as Ae,Ln as nt,Lt as rt,Sn as us,Un as hs,Vt as ot,Zt as ct,an as Oe,cn as dt,dn as ps,gn as gs,hn as mt,in as bs,on as Ue,pn as vs,rn as Ve,sn as ft,tr as js,un as ys,yn as Lt,zn as Be,zt as ks}from"./ui-libs-BrvosAtl.js";import{n as zs}from"./media-libs-C98UjHPF.js";import{$t as xt,Cn as Ns,Ct as ws,Dn as ut,Dt as Cs,Et as _s,F as Ss,Fn as ye,Ft as $s,H as Ee,I as Ps,Jt as We,K as Ts,Ln as je,M as Dt,N as Fs,Nn as Rs,On as Ms,Q as Es,Qt as ht,Rn as He,Sn as Is,St as Ls,Tn as At,Tt as xe,U as Ds,Un as pt,Wt as Ot,Xt as gt,Yt as bt,Z as As,Zt as vt,_ as Os,_n as Us,_t as Ut,an as he,cn as Vs,en as jt,fn as Vt,g as yt,gn as kt,in as pe,j as Bs,kn as Ws,ln as Hs,nn as zt,pn as qs,qt as K,rn as ge,sn as Bt,tn as Nt,un as Ge,v as Qs,vn as Gs,wn as Js,z as Ks,zn as Te}from"./index-Cg52Q0DN.js";import{a as Xs,i as qe,n as wt,r as Je}from"./VideoPlayer-Dd8o4VaR.js";import{n as ue,t as Zs}from"./actionsheet-DwRqLrpw.js";var Ys=Z(),N=Et(ss(),1),t=Et(es(),1),ei=i=>{const e=(0,Ys.c)(37),{isComment:s,liked:r,reposted:l,handleLike:a,handleRepost:o,handleCommentClick:n,handleShareClick:c,isDetail:x}=i;if(x!==void 0&&x){let z;e[0]!==a||e[1]!==r?(z=(0,t.jsx)(ce,{icon:Me,label:"Like",type:"like",onClick:a,active:r}),e[0]=a,e[1]=r,e[2]=z):z=e[2];let w;e[3]!==o||e[4]!==s||e[5]!==l?(w=!s&&(0,t.jsx)(ce,{icon:Ve,label:"Repost",type:"repost",onClick:o,active:l}),e[3]=o,e[4]=s,e[5]=l,e[6]=w):w=e[6];let _;e[7]!==n?(_=(0,t.jsx)(ce,{icon:Dt,label:"Comment",type:"comment",onClick:n}),e[7]=n,e[8]=_):_=e[8];let S;e[9]!==c||e[10]!==s?(S=!s&&(0,t.jsx)(ce,{icon:Ee,label:"Share",type:"share",onClick:c}),e[9]=c,e[10]=s,e[11]=S):S=e[11];let p;return e[12]!==z||e[13]!==w||e[14]!==_||e[15]!==S?(p=(0,t.jsxs)("div",{className:"mt-5 flex w-full items-center justify-around py-2",children:[z,w,_,S]}),e[12]=z,e[13]=w,e[14]=_,e[15]=S,e[16]=p):p=e[16],p}const b=`flex items-center gap-x-1.5 ${s?"mt-2":"mt-3.5"}`,m=s?16:18;let u;e[17]!==a||e[18]!==r||e[19]!==m?(u=(0,t.jsx)(ce,{icon:Me,size:m,type:"like",onClick:a,active:r}),e[17]=a,e[18]=r,e[19]=m,e[20]=u):u=e[20];const g=s?16:18;let d;e[21]!==n||e[22]!==g?(d=(0,t.jsx)(ce,{icon:Lt,size:g,type:"comment",onClick:n}),e[21]=n,e[22]=g,e[23]=d):d=e[23];const v=s?16:18;let h;e[24]!==o||e[25]!==l||e[26]!==v?(h=(0,t.jsx)(ce,{icon:Ve,size:v,type:"repost",onClick:o,active:l}),e[24]=o,e[25]=l,e[26]=v,e[27]=h):h=e[27];let f;e[28]!==c||e[29]!==s?(f=!s&&c&&(0,t.jsx)(ce,{icon:Ee,type:"share",onClick:c}),e[28]=c,e[29]=s,e[30]=f):f=e[30];let k;return e[31]!==b||e[32]!==u||e[33]!==d||e[34]!==h||e[35]!==f?(k=(0,t.jsxs)("div",{className:b,children:[u,d,h,f]}),e[31]=b,e[32]=u,e[33]=d,e[34]=h,e[35]=f,e[36]=k):k=e[36],k},Ct=ei,ti=Z(),si=i=>{const e=(0,ti.c)(38),{views:s,likes:r,comments:l,isDetail:a,isComment:o,onRepliesClick:n}=i,c=a===void 0?!1:a,x=o===void 0?!1:o;if(c){const h=s||0;let f;e[0]!==h?(f=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:h}),e[0]=h,e[1]=f):f=e[1];let k;e[2]===Symbol.for("react.memo_cache_sentinel")?(k=(0,t.jsx)("span",{className:"opacity-70",children:"Views"}),e[2]=k):k=e[2];let z;e[3]!==f?(z=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[f," ",k]}),e[3]=f,e[4]=z):z=e[4];const w=r||0;let _;e[5]!==w?(_=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:w}),e[5]=w,e[6]=_):_=e[6];let S;e[7]===Symbol.for("react.memo_cache_sentinel")?(S=(0,t.jsx)("span",{className:"opacity-70",children:"Likes"}),e[7]=S):S=e[7];let p;e[8]!==_?(p=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[_," ",S]}),e[8]=_,e[9]=p):p=e[9];const F=l||0;let M;e[10]!==F?(M=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:F}),e[10]=F,e[11]=M):M=e[11];let T;e[12]===Symbol.for("react.memo_cache_sentinel")?(T=(0,t.jsx)("span",{className:"opacity-70",children:"Comments"}),e[12]=T):T=e[12];let j;e[13]!==M?(j=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[M," ",T]}),e[13]=M,e[14]=j):j=e[14];let P;return e[15]!==p||e[16]!==j||e[17]!==z?(P=(0,t.jsxs)("div",{className:"mt-5 flex items-center gap-x-6 border-b border-zinc-100 pb-4 text-sm text-zinc-500 dark:border-zinc-800 dark:text-zinc-400",children:[z,p,j]}),e[15]=p,e[16]=j,e[17]=z,e[18]=P):P=e[18],P}if(l===0&&r===0&&(s===0||x))return null;const b=`mt-2 flex items-center gap-x-2 px-0.5 ${x?"text-[12px]":"text-[14px]"} font-medium text-zinc-500 dark:text-zinc-400`;let m;e[19]!==l||e[20]!==x||e[21]!==r||e[22]!==s?(m=s>0&&!x&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{className:"hover:underline",children:[s," ",s===1?"view":"views"]}),(l>0||r>0)&&(0,t.jsx)("span",{className:"opacity-50",children:"·"})]}),e[19]=l,e[20]=x,e[21]=r,e[22]=s,e[23]=m):m=e[23];let u;e[24]!==l||e[25]!==n?(u=l>0&&(0,t.jsxs)("button",{className:"hover:underline",onClick:h=>{h.stopPropagation(),n&&n(h)},children:[l," ",l===1?"reply":"replies"]}),e[24]=l,e[25]=n,e[26]=u):u=e[26];let g;e[27]!==l||e[28]!==r?(g=l>0&&r>0&&(0,t.jsx)("span",{className:"opacity-50",children:"·"}),e[27]=l,e[28]=r,e[29]=g):g=e[29];let d;e[30]!==r?(d=r>0&&(0,t.jsxs)("button",{className:"hover:underline",children:[r," ",r===1?"like":"likes"]}),e[30]=r,e[31]=d):d=e[31];let v;return e[32]!==b||e[33]!==m||e[34]!==u||e[35]!==g||e[36]!==d?(v=(0,t.jsxs)("div",{className:b,children:[m,u,g,d]}),e[32]=b,e[33]=m,e[34]=u,e[35]=g,e[36]=d,e[37]=v):v=e[37],v},_t=si,ii=Z(),li=i=>{const e=(0,ii.c)(52),{user:s,timeAgo:r,community:l,onUserClick:a,actionsMenu:o,isComment:n,isDetail:c,showAvatar:x,isPinned:b}=i,m=x===void 0?!1:x,u=b===void 0?!1:b,g=It();let d;e[0]!==a||e[1]!==s.handle?(d=D=>{D.stopPropagation(),a&&a(s.handle)},e[0]=a,e[1]=s.handle,e[2]=d):d=e[2];const v=d;let h;e[3]!==l||e[4]!==g?(h=D=>{D.stopPropagation(),l&&g(`/c/${l.handle}`)},e[3]=l,e[4]=g,e[5]=h):h=e[5];const f=h,k=`flex items-center justify-between ${c?"pb-5":"min-h-[40px] mb-2"}`;let z;e[6]!==v||e[7]!==n||e[8]!==c||e[9]!==m||e[10]!==s.avatar||e[11]!==s.handle?(z=m&&(0,t.jsx)("button",{className:"shrink-0",onClick:v,children:(0,t.jsxs)(ge,{className:`${c?"size-12":n?"size-8":"size-10"} border-0 shadow-sm`,children:[(0,t.jsx)(he,{src:s.avatar,alt:s.handle,className:"object-cover"}),(0,t.jsx)(pe,{className:"text-xs",children:s.handle[0]?.toUpperCase()})]})}),e[6]=v,e[7]=n,e[8]=c,e[9]=m,e[10]=s.avatar,e[11]=s.handle,e[12]=z):z=e[12];const w=`flex shrink-0 items-center gap-1 font-bold text-zinc-900 hover:underline dark:text-white ${c?"text-base sm:text-lg":n?"text-[14px]":"text-[15px]"}`;let _;e[13]!==s.handle?(_=(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:s.handle}),e[13]=s.handle,e[14]=_):_=e[14];let S;e[15]!==n||e[16]!==c||e[17]!==s.role?(S=s.role==="admin"&&(0,t.jsx)(Bs,{size:c?28:n?22:24}),e[15]=n,e[16]=c,e[17]=s.role,e[18]=S):S=e[18];let p;e[19]!==n||e[20]!==c||e[21]!==s.verified?(p=s.verified&&(0,t.jsx)(Ds,{size:c?16:n?12:14}),e[19]=n,e[20]=c,e[21]=s.verified,e[22]=p):p=e[22];let F;e[23]!==v||e[24]!==p||e[25]!==w||e[26]!==_||e[27]!==S?(F=(0,t.jsxs)("button",{className:w,onClick:v,children:[_,S,p]}),e[23]=v,e[24]=p,e[25]=w,e[26]=_,e[27]=S,e[28]=F):F=e[28];let M;e[29]!==l||e[30]!==f||e[31]!==c?(M=l&&(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-1 text-zinc-500",children:[(0,t.jsx)(Fs,{size:c?14:12,className:"shrink-0 text-zinc-400"}),(0,t.jsxs)("button",{className:`flex items-center gap-1 font-bold text-zinc-900 hover:underline dark:text-zinc-100 ${c?"text-[14px] sm:text-[15px]":"text-[13px]"}`,onClick:f,children:[(0,t.jsxs)(ge,{className:"size-3.5 shrink-0 border border-zinc-200 bg-zinc-100 dark:border-zinc-700 dark:bg-zinc-800",children:[(0,t.jsx)(he,{src:l.avatar,alt:l.name,className:"object-cover"}),(0,t.jsx)(pe,{className:"text-[6px] font-bold text-zinc-500",children:l.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:l.name})]})]}),e[29]=l,e[30]=f,e[31]=c,e[32]=M):M=e[32];let T;e[33]!==F||e[34]!==M?(T=(0,t.jsx)("div",{className:"flex min-w-0 flex-1 flex-col",children:(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex min-w-0 max-w-full items-center gap-1.5",children:[F,M]})})}),e[33]=F,e[34]=M,e[35]=T):T=e[35];let j;e[36]!==T||e[37]!==z?(j=(0,t.jsxs)("div",{className:"flex items-center gap-x-3.5 flex-1 min-w-0",children:[z,T]}),e[36]=T,e[37]=z,e[38]=j):j=e[38];let P;e[39]!==n||e[40]!==u?(P=u&&!n&&(0,t.jsx)("div",{className:"flex items-center justify-center p-1 opacity-80",children:(0,t.jsx)(Ue,{size:14,className:"fill-zinc-400 text-zinc-400 dark:fill-zinc-500 dark:text-zinc-500"})}),e[39]=n,e[40]=u,e[41]=P):P=e[41];const C=r||"Recent";let E;e[42]!==C?(E=(0,t.jsx)("span",{className:"whitespace-nowrap text-[12px] text-zinc-500 dark:text-zinc-400",children:C}),e[42]=C,e[43]=E):E=e[43];let I;e[44]!==o||e[45]!==P||e[46]!==E?(I=(0,t.jsxs)("div",{className:"-mt-1 flex items-center gap-2.5",children:[P,E,o]}),e[44]=o,e[45]=P,e[46]=E,e[47]=I):I=e[47];let A;return e[48]!==j||e[49]!==I||e[50]!==k?(A=(0,t.jsxs)("div",{className:k,children:[j,I]}),e[48]=j,e[49]=I,e[50]=k,e[51]=A):A=e[51],A},St=li,ai=Z(),ni=i=>{const e=(0,ai.c)(40),{content:s,isDetail:r,isEditing:l,editedContent:a,setEditedContent:o,onCancelEdit:n,onSaveEdit:c,isUpdating:x,contentClass:b}=i,[m,u]=(0,N.useState)(!1),g=typeof s=="string"&&pt(s);if(l&&o){let F;e[0]!==o?(F=D=>o(D.target.value),e[0]=o,e[1]=F):F=e[1];const M=`min-h-[100px] w-full rounded-xl border-zinc-200 bg-zinc-50 focus:ring-violet-500 dark:border-zinc-800 dark:bg-zinc-900 ${pt(a||"")?"font-bangla text-lg":"font-english"}`;let T;e[2]!==a||e[3]!==F||e[4]!==M?(T=(0,t.jsx)(Ts,{value:a,onChange:F,className:M,autoFocus:!0}),e[2]=a,e[3]=F,e[4]=M,e[5]=T):T=e[5];let j;e[6]!==n?(j=(0,t.jsx)("button",{onClick:n,className:"px-4 py-1.5 text-sm font-bold text-zinc-500 transition-colors hover:text-zinc-700 dark:hover:text-zinc-300",children:"Cancel"}),e[6]=n,e[7]=j):j=e[7];let P;e[8]!==s||e[9]!==a||e[10]!==x?(P=x||!a?.trim()||a===s,e[8]=s,e[9]=a,e[10]=x,e[11]=P):P=e[11];const C=x?"Saving...":"Save";let E;e[12]!==c||e[13]!==P||e[14]!==C?(E=(0,t.jsx)("button",{onClick:c,disabled:P,className:"rounded-full bg-violet-600 px-4 py-1.5 text-sm font-bold text-white transition-all hover:bg-violet-700 disabled:opacity-50 active:scale-95",children:C}),e[12]=c,e[13]=P,e[14]=C,e[15]=E):E=e[15];let I;e[16]!==j||e[17]!==E?(I=(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[j,E]}),e[16]=j,e[17]=E,e[18]=I):I=e[18];let A;return e[19]!==T||e[20]!==I?(A=(0,t.jsxs)("div",{className:"mt-2 flex flex-col gap-2",onClick:ri,children:[T,I]}),e[19]=T,e[20]=I,e[21]=A):A=e[21],A}const d=!r&&s.length>280;let v;e[22]!==s||e[23]!==m||e[24]!==d?(v=d&&!m?s.substring(0,280):s,e[22]=s,e[23]=m,e[24]=d,e[25]=v):v=e[25];const h=v,f=r?"text-lg leading-relaxed sm:text-xl sm:leading-8 mt-1":"text-[15px] leading-snug mt-0.5",k=g?"font-bangla text-[1.15em]":"font-english";let z;e[26]!==b||e[27]!==f||e[28]!==k?(z=je("whitespace-pre-line break-words",f,k,b),e[26]=b,e[27]=f,e[28]=k,e[29]=z):z=e[29];let w;e[30]!==h?(w=(0,t.jsx)(Je,{content:h}),e[30]=h,e[31]=w):w=e[31];const _=d&&!m&&"...";let S;e[32]!==m||e[33]!==d?(S=d&&(0,t.jsx)("button",{onClick:F=>{F.stopPropagation(),u(!m)},className:"ml-1 cursor-pointer font-bold text-rose-600 hover:underline dark:text-rose-400",children:m?"Show less":"See more"}),e[32]=m,e[33]=d,e[34]=S):S=e[34];let p;return e[35]!==z||e[36]!==w||e[37]!==_||e[38]!==S?(p=(0,t.jsxs)("div",{className:z,children:[w,_,S]}),e[35]=z,e[36]=w,e[37]=_,e[38]=S,e[39]=p):p=e[39],p},$t=ni;function ri(i){return i.stopPropagation()}var oi=Z(),ci=i=>{const e=(0,oi.c)(28),{media:s,isEditing:r,editedMedia:l,setEditedMedia:a,newFiles:o,setNewFiles:n}=i;let c;e[0]!==l?(c=l===void 0?[]:l,e[0]=l,e[1]=c):c=e[1];const x=c;let b;e[2]!==o?(b=o===void 0?[]:o,e[2]=o,e[3]=b):b=e[3];const m=b,u=(0,N.useRef)(null);if(r&&a&&n){let d;if(e[4]!==x||e[5]!==a){let w;e[7]!==a?(w=(_,S)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[_.type==="video"?(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(ns,{size:24,className:"text-zinc-400"})}):(0,t.jsx)("img",{src:_.url||_.src,className:"size-full object-cover",alt:""}),(0,t.jsx)("button",{onClick:p=>{p.stopPropagation(),a(F=>F.filter((M,T)=>T!==S))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(ke,{size:16})})]},`old-${S}`),e[7]=a,e[8]=w):w=e[8],d=x.map(w),e[4]=x,e[5]=a,e[6]=d}else d=e[6];let v;if(e[9]!==m||e[10]!==n){let w;e[12]!==n?(w=(_,S)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border-2 border-dashed border-violet-500 bg-violet-50/10",children:[_.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(_),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center",children:(0,t.jsx)(os,{size:24,className:"animate-spin text-violet-500"})}),(0,t.jsx)("button",{onClick:p=>{p.stopPropagation(),n(F=>F.filter((M,T)=>T!==S))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(ke,{size:16})}),(0,t.jsx)("div",{className:"absolute bottom-1 left-1 rounded bg-violet-600 px-1 text-[8px] font-bold text-white",children:"NEW"})]},`new-${S}`),e[12]=n,e[13]=w):w=e[13],v=m.map(w),e[9]=m,e[10]=n,e[11]=v}else v=e[11];let h;e[14]!==x.length||e[15]!==m.length?(h=x.length+m.length<4&&(0,t.jsxs)("button",{onClick:w=>{w.stopPropagation(),u.current?.click()},className:"relative flex aspect-square flex-col items-center justify-center gap-1 rounded-xl border-2 border-dashed border-zinc-200 text-zinc-400 transition-all hover:border-violet-500 hover:bg-violet-50/5 hover:text-violet-500 dark:border-zinc-800",children:[(0,t.jsx)(bs,{size:20}),(0,t.jsx)("span",{className:"text-[10px] font-bold",children:"Add Media"})]}),e[14]=x.length,e[15]=m.length,e[16]=h):h=e[16];let f;e[17]!==d||e[18]!==v||e[19]!==h?(f=(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:[d,v,h]}),e[17]=d,e[18]=v,e[19]=h,e[20]=f):f=e[20];let k;e[21]!==n?(k=(0,t.jsx)("input",{type:"file",ref:u,onChange:w=>{if(w.target.files){const _=Array.from(w.target.files);n(S=>[...S,..._])}},multiple:!0,className:"hidden",accept:"image/*,video/*"}),e[21]=n,e[22]=k):k=e[22];let z;return e[23]!==f||e[24]!==k?(z=(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[f,k]}),e[23]=f,e[24]=k,e[25]=z):z=e[25],z}if(!s||s.length===0)return null;let g;return e[26]!==s?(g=(0,t.jsx)(Mi,{items:s}),e[26]=s,e[27]=g):g=e[27],g},Pt=ci,di=Z(),mi=i=>{const e=(0,di.c)(48),{icon:s,count:r,label:l,onClick:a,active:o,activeColorClass:n,size:c,type:x}=i,b=c===void 0?18:c,m=x===void 0?"default":x;let u,g,d,v,h,f,k;if(e[0]!==o||e[1]!==n||e[2]!==r||e[3]!==l||e[4]!==a||e[5]!==m){const I={like:{hoverBg:"group-hover:bg-rose-500/10",hoverText:"group-hover:text-rose-500",activeText:"text-rose-500",activeFill:"fill-rose-500"},repost:{hoverBg:"group-hover:bg-emerald-500/10",hoverText:"group-hover:text-emerald-500",activeText:"text-emerald-500",activeFill:"fill-emerald-500"},comment:{hoverBg:"group-hover:bg-sky-500/10",hoverText:"group-hover:text-sky-500",activeText:"text-sky-500",activeFill:"fill-sky-500"},share:{hoverBg:"group-hover:bg-violet-500/10",hoverText:"group-hover:text-violet-500",activeText:"text-violet-500",activeFill:"fill-violet-500"},default:{hoverBg:"group-hover:bg-zinc-500/10",hoverText:"group-hover:text-zinc-500",activeText:"text-zinc-900 dark:text-white",activeFill:"fill-current"}};g=I[m]||I.default;const A=n||g.activeText;u=K.button,e[13]===Symbol.for("react.memo_cache_sentinel")?(v={scale:.85},e[13]=v):v=e[13],e[14]!==a?(h=D=>{D.stopPropagation(),a&&a(D)},e[14]=a,e[15]=h):h=e[15],f=`${l} ${r!==void 0?`(${r})`:""}`,k=je("group -ml-2 flex items-center gap-x-0.5 rounded-xl px-2 py-1.5 text-[12px] font-bold transition-all sm:gap-x-1 sm:text-[13px]",o?A:"text-zinc-500",!o&&g.hoverText),d=je("rounded-full p-2 transition-all duration-200",!o&&g.hoverBg),e[0]=o,e[1]=n,e[2]=r,e[3]=l,e[4]=a,e[5]=m,e[6]=u,e[7]=g,e[8]=d,e[9]=v,e[10]=h,e[11]=f,e[12]=k}else u=e[6],g=e[7],d=e[8],v=e[9],h=e[10],f=e[11],k=e[12];let z;e[16]!==o?(z=o?{scale:[1,1.4,1],rotate:[0,15,0]}:{scale:1},e[16]=o,e[17]=z):z=e[17];let w;e[18]===Symbol.for("react.memo_cache_sentinel")?(w={duration:.45,type:"spring",stiffness:300,damping:15},e[18]=w):w=e[18];const _=o?2.5:2,S=o&&g.activeFill;let p;e[19]!==S?(p=je("transition-colors duration-200",S),e[19]=S,e[20]=p):p=e[20];let F;e[21]!==s||e[22]!==b||e[23]!==_||e[24]!==p?(F=(0,t.jsx)(s,{size:b,strokeWidth:_,className:p}),e[21]=s,e[22]=b,e[23]=_,e[24]=p,e[25]=F):F=e[25];let M;e[26]!==F||e[27]!==z?(M=(0,t.jsx)(K.div,{animate:z,transition:w,children:F}),e[26]=F,e[27]=z,e[28]=M):M=e[28];let T;e[29]!==M||e[30]!==d?(T=(0,t.jsx)("div",{className:d,children:M}),e[29]=M,e[30]=d,e[31]=T):T=e[31];let j;e[32]!==l?(j=l&&(0,t.jsx)("span",{className:"hidden xs:inline",children:l}),e[32]=l,e[33]=j):j=e[33];let P;e[34]!==o||e[35]!==r?(P=r!=null&&(0,t.jsx)(K.span,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:je("transition-all",o?"font-black":"font-bold"),children:r||0},r),e[34]=o,e[35]=r,e[36]=P):P=e[36];let C;e[37]!==P?(C=(0,t.jsx)(We,{mode:"wait",children:P}),e[37]=P,e[38]=C):C=e[38];let E;return e[39]!==u||e[40]!==T||e[41]!==j||e[42]!==C||e[43]!==v||e[44]!==h||e[45]!==f||e[46]!==k?(E=(0,t.jsxs)(u,{whileTap:v,onClick:h,"aria-label":f,className:k,children:[T,j,C]}),e[39]=u,e[40]=T,e[41]=j,e[42]=C,e[43]=v,e[44]=h,e[45]=f,e[46]=k,e[47]=E):E=e[47],E},ce=mi,fi=Z(),xi=i=>{const e=(0,fi.c)(18),{poll:s,onVote:r}=i,l=s.options.reduce(ui,0),[a,o]=(0,N.useState)(null);let n;e[0]!==r||e[1]!==a?(n=d=>{a||(o(d),r&&r(d))},e[0]=r,e[1]=a,e[2]=n):n=e[2];const c=n;let x;if(e[3]!==c||e[4]!==s.options||e[5]!==l||e[6]!==a){let d;e[8]!==c||e[9]!==l||e[10]!==a?(d=(v,h)=>{const f=l>0?Math.round((v.votes+(a===v.id?1:0))/(l+(a?1:0))*100):0,k=a===v.id;return(0,t.jsxs)("div",{onClick:()=>c(v.id),className:`relative h-10 w-full overflow-hidden rounded-xl border cursor-pointer ${k?"border-violet-500 dark:border-violet-500":"border-zinc-200 dark:border-zinc-700"}`,children:[a&&(0,t.jsx)("div",{className:"absolute left-0 top-0 h-full bg-zinc-200 transition-all duration-500 dark:bg-zinc-800",style:{width:`${f}%`}}),(0,t.jsxs)("div",{className:"absolute inset-0 z-10 flex items-center justify-between px-4",children:[(0,t.jsxs)("span",{className:`text-sm font-medium ${k?"font-bold text-violet-600":"text-zinc-700 dark:text-zinc-200"}`,children:[v.text," ",k&&(0,t.jsx)(js,{size:14,className:"mb-0.5 inline ml-1"})]}),a&&(0,t.jsxs)("span",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:[f,"%"]})]})]},v.id||h)},e[8]=c,e[9]=l,e[10]=a,e[11]=d):d=e[11],x=s.options.map(d),e[3]=c,e[4]=s.options,e[5]=l,e[6]=a,e[7]=x}else x=e[7];const b=l+(a?1:0),m=a?"6 days left":"Click to vote";let u;e[12]!==b||e[13]!==m?(u=(0,t.jsxs)("div",{className:"pl-1 text-xs text-zinc-500 dark:text-zinc-400",children:[b," votes •"," ",m]}),e[12]=b,e[13]=m,e[14]=u):u=e[14];let g;return e[15]!==x||e[16]!==u?(g=(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[x,u]}),e[15]=x,e[16]=u,e[17]=g):g=e[17],g},Tt=xi;function ui(i,e){return i+e.votes}var hi=Z(),pi=i=>{const e=(0,hi.c)(25),{user:s,time:r,content:l}=i;let a;e[0]!==s.avatar||e[1]!==s.handle?(a=(0,t.jsx)(he,{src:s.avatar,alt:s.handle}),e[0]=s.avatar,e[1]=s.handle,e[2]=a):a=e[2];let o;e[3]!==s.handle[0]?(o=s.handle[0]?.toUpperCase(),e[3]=s.handle[0],e[4]=o):o=e[4];let n;e[5]!==o?(n=(0,t.jsx)(pe,{children:o}),e[5]=o,e[6]=n):n=e[6];let c;e[7]!==a||e[8]!==n?(c=(0,t.jsxs)(ge,{className:"size-6",children:[a,n]}),e[7]=a,e[8]=n,e[9]=c):c=e[9];let x;e[10]!==s.handle?(x=(0,t.jsx)("span",{className:"text-sm font-semibold",children:s.handle}),e[10]=s.handle,e[11]=x):x=e[11];let b;e[12]!==c||e[13]!==x?(b=(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[c,x]}),e[12]=c,e[13]=x,e[14]=b):b=e[14];let m;e[15]!==r?(m=(0,t.jsx)("span",{className:"text-xs text-zinc-500 sm:text-sm",children:r}),e[15]=r,e[16]=m):m=e[16];let u;e[17]!==b||e[18]!==m?(u=(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between gap-x-2",children:[b,m]}),e[17]=b,e[18]=m,e[19]=u):u=e[19];let g;e[20]!==l?(g=(0,t.jsx)(Je,{content:l,className:"text-sm text-zinc-800 dark:text-zinc-300"}),e[20]=l,e[21]=g):g=e[21];let d;return e[22]!==u||e[23]!==g?(d=(0,t.jsxs)("div",{className:"p-4",children:[u,g]}),e[22]=u,e[23]=g,e[24]=d):d=e[24],d},Ft=pi,gi=Z(),bi=i=>{const e=(0,gi.c)(81),{currentUser:s,newComment:r,setNewComment:l,handleSubmitComment:a,loading:o,selectedFiles:n,setSelectedFiles:c,isUploading:x}=i;let b;e[0]!==n?(b=n===void 0?[]:n,e[0]=n,e[1]=b):b=e[1];const m=b,u=(0,N.useRef)(null),{isRecording:g,recordingTime:d,startRecording:v,stopRecording:h,audioBlob:f,audioUrl:k,clearAudio:z}=Os();let w;e[2]!==c?(w=U=>{if(U.target.files){const G=Array.from(U.target.files);c&&c(te=>[...te,...G])}},e[2]=c,e[3]=w):w=e[3];const _=w;let S;e[4]!==c?(S=U=>{c&&c(G=>G.filter((te,se)=>se!==U))},e[4]=c,e[5]=S):S=e[5];const p=S;let F;e[6]!==m?(F=m.map(vi),e[6]=m,e[7]=F):F=e[7];const M=F;let T,j;e[8]!==M?(T=()=>()=>{M.forEach(ji)},j=[M],e[8]=M,e[9]=T,e[10]=j):(T=e[9],j=e[10]),(0,N.useEffect)(T,j);let P;e[11]!==c?(P=U=>{const G=U.clipboardData.files;if(G&&G.length>0){const te=Array.from(G).filter(yi);te.length>0&&(U.preventDefault(),c&&c(se=>[...se,...te]))}},e[11]=c,e[12]=P):P=e[12];const C=P;let E;e[13]!==f||e[14]!==z||e[15]!==a||e[16]!==d?(E=U=>{f?(a(U,{blob:f,duration:d}),z()):a(U)},e[13]=f,e[14]=z,e[15]=a,e[16]=d,e[17]=E):E=e[17];const I=E,A=ki;if(!s){let U;return e[18]===Symbol.for("react.memo_cache_sentinel")?(U=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-6 text-center dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"Please login to join the conversation."})}),e[18]=U):U=e[18],U}let D;e[19]!==s.avatar||e[20]!==s.handle?(D=(0,t.jsx)(he,{src:s.avatar,alt:s.handle,className:"object-cover"}),e[19]=s.avatar,e[20]=s.handle,e[21]=D):D=e[21];let q;e[22]!==s.handle?.[0]?(q=s.handle?.[0]?.toUpperCase(),e[22]=s.handle?.[0],e[23]=q):q=e[23];let V;e[24]!==q?(V=(0,t.jsx)(pe,{children:q}),e[24]=q,e[25]=V):V=e[25];let B;e[26]!==D||e[27]!==V?(B=(0,t.jsxs)(ge,{className:"size-9 border border-zinc-200 dark:border-zinc-700",children:[D,V]}),e[26]=D,e[27]=V,e[28]=B):B=e[28];let Q;e[29]!==k||e[30]!==z||e[31]!==C||e[32]!==g||e[33]!==r||e[34]!==d||e[35]!==l||e[36]!==h?(Q=g?(0,t.jsxs)("div",{className:"flex items-center justify-between bg-violet-50 dark:bg-violet-900/20 rounded-xl px-4 py-3 animate-pulse",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 text-violet-600",children:[(0,t.jsx)("div",{className:"size-2 rounded-full bg-red-500 animate-ping"}),(0,t.jsx)("span",{className:"font-mono font-bold",children:A(d)})]}),(0,t.jsx)("button",{onClick:h,className:"text-violet-600 hover:scale-110 transition-transform",children:(0,t.jsx)(ds,{size:20,fill:"currentColor"})})]}):k?(0,t.jsxs)("div",{className:"flex items-center justify-between bg-zinc-100 dark:bg-zinc-800 rounded-xl px-4 py-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 text-zinc-600 dark:text-zinc-400",children:[(0,t.jsx)(mt,{size:18}),(0,t.jsx)("span",{className:"text-sm font-bold",children:"Voice comment ready"})]}),(0,t.jsx)("button",{onClick:z,className:"text-rose-500 hover:scale-110 transition-transform",children:(0,t.jsx)(fs,{size:18})})]}):(0,t.jsx)("textarea",{id:"comment-input",className:"min-h-[60px] w-full resize-none bg-transparent text-base outline-none placeholder:text-zinc-500 dark:text-white",placeholder:"Post your reply...",value:r,onChange:U=>l(U.target.value),onPaste:C}),e[29]=k,e[30]=z,e[31]=C,e[32]=g,e[33]=r,e[34]=d,e[35]=l,e[36]=h,e[37]=Q):Q=e[37];let W;e[38]!==M||e[39]!==p||e[40]!==m?(W=m.length>0&&(0,t.jsx)("div",{className:"mt-2 mb-2 flex flex-wrap gap-2",children:m.map((U,G)=>(0,t.jsxs)("div",{className:"relative size-20 overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[U.type.startsWith("image/")?(0,t.jsx)("img",{src:M[G],className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)(ps,{size:20,className:"text-zinc-500"})}),(0,t.jsx)("button",{onClick:()=>p(G),className:"absolute right-1 top-1 rounded-full bg-black/60 p-1 text-white transition-colors hover:bg-black",children:(0,t.jsx)(ke,{size:12})})]},G))}),e[38]=M,e[39]=p,e[40]=m,e[41]=W):W=e[41];let y;e[42]===Symbol.for("react.memo_cache_sentinel")?(y=()=>u.current?.click(),e[42]=y):y=e[42];const $=g||!!k;let L;e[43]===Symbol.for("react.memo_cache_sentinel")?(L=(0,t.jsx)(Ks,{size:20}),e[43]=L):L=e[43];let O;e[44]!==$?(O=(0,t.jsx)("button",{type:"button",onClick:y,disabled:$,className:"rounded-full p-2 text-violet-600 transition-colors hover:bg-violet-50 dark:hover:bg-zinc-800 disabled:opacity-30",title:"Attach media",children:L}),e[44]=$,e[45]=O):O=e[45];let H;e[46]!==k||e[47]!==g||e[48]!==v||e[49]!==h?(H=!k&&(0,t.jsx)("button",{type:"button",onClick:g?h:v,className:`rounded-full p-2 transition-colors ${g?"bg-red-50 text-red-600 animate-pulse":"text-violet-600 hover:bg-violet-50 dark:hover:bg-zinc-800"}`,title:g?"Stop recording":"Record voice comment",children:(0,t.jsx)(mt,{size:20,className:g?"fill-current":""})}),e[46]=k,e[47]=g,e[48]=v,e[49]=h,e[50]=H):H=e[50];let le;e[51]!==_?(le=(0,t.jsx)("input",{type:"file",ref:u,onChange:_,multiple:!0,className:"hidden",accept:"image/*,video/*,application/pdf"}),e[51]=_,e[52]=le):le=e[52];let ae;e[53]!==O||e[54]!==H||e[55]!==le?(ae=(0,t.jsxs)("div",{className:"flex gap-1 text-violet-600",children:[O,H,le]}),e[53]=O,e[54]=H,e[55]=le,e[56]=ae):ae=e[56];const be=o||x?"primary":"animated";let ne;e[57]!==x||e[58]!==o?(ne=!(o||x)&&(0,t.jsx)(Ee,{size:20}),e[57]=x,e[58]=o,e[59]=ne):ne=e[59];const de=o||x;let Y;e[60]!==f||e[61]!==g||e[62]!==r||e[63]!==m.length?(Y=!r.trim()&&m.length===0&&!f||g,e[60]=f,e[61]=g,e[62]=r,e[63]=m.length,e[64]=Y):Y=e[64];let ee;e[65]!==I||e[66]!==be||e[67]!==ne||e[68]!==de||e[69]!==Y?(ee=(0,t.jsx)(Ot,{variant:be,icon:ne,className:"min-w-[70px] !w-auto",onClick:I,loading:de,disabled:Y,children:"Reply"}),e[65]=I,e[66]=be,e[67]=ne,e[68]=de,e[69]=Y,e[70]=ee):ee=e[70];let ie;e[71]!==ae||e[72]!==ee?(ie=(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between border-t border-zinc-100 pt-3 dark:border-zinc-800",children:[ae,ee]}),e[71]=ae,e[72]=ee,e[73]=ie):ie=e[73];let re;e[74]!==Q||e[75]!==W||e[76]!==ie?(re=(0,t.jsxs)("div",{className:"flex-1",children:[Q,W,ie]}),e[74]=Q,e[75]=W,e[76]=ie,e[77]=re):re=e[77];let me;return e[78]!==B||e[79]!==re?(me=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-4 dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[B,re]})}),e[78]=B,e[79]=re,e[80]=me):me=e[80],me},Wt=N.memo(bi);function vi(i){return URL.createObjectURL(i)}function ji(i){return URL.revokeObjectURL(i)}function yi(i){return i.type.startsWith("image/")}function ki(i){return`${Math.floor(i/60)}:${Math.floor(i%60).toString().padStart(2,"0")}`}var zi=Z(),Ni=i=>{const e=(0,zi.c)(30),{url:s}=i;let r,l;e[0]!==s?(r=["link-preview",s],l=()=>qs(s),e[0]=s,e[1]=r,e[2]=l):(r=e[1],l=e[2]);const a=!!s;let o;e[3]!==r||e[4]!==l||e[5]!==a?(o={queryKey:r,queryFn:l,staleTime:864e5,enabled:a},e[3]=r,e[4]=l,e[5]=a,e[6]=o):o=e[6];const{data:n,isLoading:c,isError:x}=ls(o);if(c){let z;return e[7]===Symbol.for("react.memo_cache_sentinel")?(z=(0,t.jsx)("div",{className:"mt-3 flex h-24 animate-pulse items-center justify-center overflow-hidden rounded-2xl border border-zinc-100 bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-900/50",children:(0,t.jsx)(nt,{className:"animate-spin text-zinc-300 dark:text-zinc-700",size:24})}),e[7]=z):z=e[7],z}if(x||!n||!n.title&&!n.image)return null;let b;e[8]!==n.image||e[9]!==n.title?(b=n.image&&(0,t.jsx)("div",{className:"aspect-[1.91/1] w-full overflow-hidden border-b border-zinc-100 bg-zinc-100 dark:border-zinc-800 dark:bg-zinc-900",children:(0,t.jsx)("img",{src:n.image,alt:n.title??void 0,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-[1.02]",onError:Ci})}),e[8]=n.image,e[9]=n.title,e[10]=b):b=e[10];let m;e[11]===Symbol.for("react.memo_cache_sentinel")?(m=(0,t.jsx)(nt,{size:12}),e[11]=m):m=e[11];let u;e[12]!==n.siteName?(u=(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs font-bold uppercase tracking-wider text-zinc-600",children:[m,(0,t.jsx)("span",{children:n.siteName})]}),e[12]=n.siteName,e[13]=u):u=e[13];let g;e[14]!==n.title?(g=(0,t.jsx)("div",{className:"line-clamp-2 text-[15px] font-bold leading-snug transition-colors group-hover:text-violet-700 dark:text-white",children:n.title}),e[14]=n.title,e[15]=g):g=e[15];let d;e[16]!==n.description?(d=n.description&&(0,t.jsx)("p",{className:"line-clamp-2 text-xs leading-relaxed text-zinc-600 dark:text-zinc-400",children:n.description}),e[16]=n.description,e[17]=d):d=e[17];let v;e[18]===Symbol.for("react.memo_cache_sentinel")?(v=(0,t.jsx)(cs,{size:10}),e[18]=v):v=e[18];let h;e[19]!==s?(h=(0,t.jsxs)("div",{className:"flex items-center gap-1 pt-1 text-[11px] font-medium text-zinc-500",children:[v,(0,t.jsx)("span",{className:"truncate",children:s})]}),e[19]=s,e[20]=h):h=e[20];let f;e[21]!==h||e[22]!==u||e[23]!==g||e[24]!==d?(f=(0,t.jsxs)("div",{className:"space-y-1 p-3.5",children:[u,g,d,h]}),e[21]=h,e[22]=u,e[23]=g,e[24]=d,e[25]=f):f=e[25];let k;return e[26]!==f||e[27]!==b||e[28]!==s?(k=(0,t.jsxs)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"group mt-3 flex flex-col overflow-hidden rounded-2xl border border-zinc-100 bg-white shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-900",onClick:wi,children:[b,f]}),e[26]=f,e[27]=b,e[28]=s,e[29]=k):k=e[29],k},Rt=Ni;function wi(i){return i.stopPropagation()}function Ci(i){return i.target.style.display="none"}var _i=Z(),Si=i=>{const e=(0,_i.c)(15),{file:s}=i;let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=(0,t.jsx)("div",{className:"flex size-10 items-center justify-center rounded-xl bg-violet-100 text-violet-600 dark:bg-violet-900/30",children:(0,t.jsx)(ms,{size:20})}),e[0]=r):r=e[0];let l;e[1]!==s.name?(l=(0,t.jsx)("div",{className:"truncate text-sm font-bold dark:text-white",children:s.name}),e[1]=s.name,e[2]=l):l=e[2];let a;e[3]!==s.size?(a=s.size!==void 0&&(0,t.jsxs)("div",{className:"text-xs uppercase text-zinc-500",children:[(s.size/1024/1024).toFixed(2)," MB"]}),e[3]=s.size,e[4]=a):a=e[4];let o;e[5]!==l||e[6]!==a?(o=(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[l,a]}),e[5]=l,e[6]=a,e[7]=o):o=e[7];let n;e[8]===Symbol.for("react.memo_cache_sentinel")?(n=(0,t.jsx)(xs,{size:18}),e[8]=n):n=e[8];let c;e[9]!==s.name||e[10]!==s.url?(c=(0,t.jsx)("a",{href:s.url,download:s.name,className:"p-2 text-zinc-400 transition-colors hover:text-violet-600",onClick:Pi,children:n}),e[9]=s.name,e[10]=s.url,e[11]=c):c=e[11];let x;return e[12]!==o||e[13]!==c?(x=(0,t.jsxs)("div",{className:"group mt-3 flex items-center gap-3 rounded-2xl border border-zinc-100 bg-zinc-50/50 p-3 transition-colors hover:border-violet-500/30 dark:border-zinc-800 dark:bg-zinc-900/10",children:[r,o,c]}),e[12]=o,e[13]=c,e[14]=x):x=e[14],x},$i=Si;function Pi(i){return i.stopPropagation()}var Ke=Z(),Ti=i=>{const e=(0,Ke.c)(18),{item:s,onClick:r}=i,[l,a]=(0,N.useState)(!1);let o,n,c;e[0]===Symbol.for("react.memo_cache_sentinel")?(o={scale:1.02},n={scale:.98},c={type:"spring",stiffness:400,damping:25},e[0]=o,e[1]=n,e[2]=c):(o=e[0],n=e[1],c=e[2]);let x;e[3]!==l?(x=!l&&(0,t.jsx)("div",{className:"absolute inset-0 animate-pulse bg-zinc-200 dark:bg-zinc-800"}),e[3]=l,e[4]=x):x=e[4];const b=s.url||s.src;let m;e[5]===Symbol.for("react.memo_cache_sentinel")?(m={opacity:0,scale:1.1,filter:"blur(10px)"},e[5]=m):m=e[5];let u;e[6]!==l?(u=l?{opacity:1,scale:1,filter:"blur(0px)"}:{},e[6]=l,e[7]=u):u=e[7];let g;e[8]===Symbol.for("react.memo_cache_sentinel")?(g={duration:.5,ease:"easeOut"},e[8]=g):g=e[8];let d;e[9]===Symbol.for("react.memo_cache_sentinel")?(d=()=>a(!0),e[9]=d):d=e[9];let v;e[10]!==b||e[11]!==u?(v=(0,t.jsx)(K.img,{src:b,initial:m,animate:u,transition:g,className:"size-full object-cover transition-transform duration-500 group-hover:scale-105",alt:"",loading:"lazy",onLoad:d}),e[10]=b,e[11]=u,e[12]=v):v=e[12];let h;e[13]===Symbol.for("react.memo_cache_sentinel")?(h=(0,t.jsx)("div",{className:"absolute inset-0 bg-black/0 transition-colors group-hover:bg-black/10"}),e[13]=h):h=e[13];let f;return e[14]!==r||e[15]!==v||e[16]!==x?(f=(0,t.jsxs)(K.div,{whileHover:o,whileTap:n,transition:c,className:"group relative size-full overflow-hidden",onClick:r,children:[x,v,h]}),e[14]=r,e[15]=v,e[16]=x,e[17]=f):f=e[17],f},Fi=i=>{const e=(0,Ke.c)(21),{item:s,onClick:r}=i,[l,a]=(0,N.useState)(!1);let o,n,c;e[0]===Symbol.for("react.memo_cache_sentinel")?(o={scale:1.02},n={scale:.98},c={type:"spring",stiffness:400,damping:25},e[0]=o,e[1]=n,e[2]=c):(o=e[0],n=e[1],c=e[2]);let x;e[3]!==l?(x=!l&&(0,t.jsx)("div",{className:"absolute inset-0 animate-pulse bg-zinc-200 dark:bg-zinc-800"}),e[3]=l,e[4]=x):x=e[4];let b;e[5]!==s.poster||e[6]!==l?(b=s.poster&&(0,t.jsx)(K.img,{src:s.poster,initial:{opacity:0,scale:1.1,filter:"blur(10px)"},animate:l?{opacity:1,scale:1,filter:"blur(0px)"}:{},transition:{duration:.5,ease:"easeOut"},className:"size-full object-cover transition-transform duration-500 group-hover:scale-105",alt:"",loading:"lazy",onLoad:()=>a(!0)}),e[5]=s.poster,e[6]=l,e[7]=b):b=e[7];let m;e[8]!==s.poster?(m=!s.poster&&(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-900",onMouseEnter:()=>a(!0),children:(0,t.jsx)("div",{className:"size-full bg-zinc-800/20"})}),e[8]=s.poster,e[9]=m):m=e[9];let u;e[10]===Symbol.for("react.memo_cache_sentinel")?(u=(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent opacity-80"}),e[10]=u):u=e[10];let g;e[11]===Symbol.for("react.memo_cache_sentinel")?(g=(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)("div",{className:"flex size-14 items-center justify-center rounded-full bg-white/15 backdrop-blur-md ring-1 ring-white/30 transition-all group-hover:bg-white/25 group-hover:scale-110 group-active:scale-95 shadow-2xl",children:(0,t.jsx)(Oe,{className:"ml-1 size-7 text-white fill-white drop-shadow-xl",strokeWidth:0})})}),e[11]=g):g=e[11];let d;e[12]===Symbol.for("react.memo_cache_sentinel")?(d=(0,t.jsx)(Oe,{className:"size-2.5 fill-white",strokeWidth:0}),e[12]=d):d=e[12];const v=s.duration||"0:00";let h;e[13]!==v?(h=(0,t.jsx)("div",{className:"absolute bottom-3 left-3 flex items-center gap-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 rounded-lg bg-black/40 px-2 py-1 text-[11px] font-bold text-white backdrop-blur-md border border-white/10 shadow-lg",children:[d,(0,t.jsx)("span",{className:"tabular-nums tracking-wider",children:v})]})}),e[13]=v,e[14]=h):h=e[14];let f;return e[15]!==r||e[16]!==h||e[17]!==x||e[18]!==b||e[19]!==m?(f=(0,t.jsxs)(K.div,{whileHover:o,whileTap:n,transition:c,className:"group relative size-full overflow-hidden",onClick:r,children:[x,b,m,u,g,h]}),e[15]=r,e[16]=h,e[17]=x,e[18]=b,e[19]=m,e[20]=f):f=e[20],f},Ri=i=>{const e=(0,Ke.c)(3),{items:s}=i,r=s===void 0?[]:s,{openLightbox:l}=Vs();if(!r||Array.isArray(r)&&r.length===0)return null;const a=Array.isArray(r)?r:[r],o=a.filter(Ei),n=a.filter(Ii),c=o.some(Li),x=d=>{l(o,d)},b="mt-2 space-y-2",m=o.length>0&&(0,t.jsx)("div",{className:`grid gap-2 overflow-hidden rounded-2xl border border-zinc-100 dark:border-zinc-800 ${o.length===1?"grid-cols-1":o.length===2?c?"aspect-[8/9] grid-cols-1 grid-rows-2":"aspect-[16/9] grid-cols-2":(o.length===3,"aspect-[16/9] grid-cols-2 grid-rows-2")}`,children:o.map((d,v)=>(0,t.jsx)("div",{className:`relative cursor-pointer overflow-hidden bg-zinc-100 dark:bg-zinc-900 group ${o.length===3&&v===0?"row-span-2":""}`,children:d.type==="video"?(0,t.jsx)(Fi,{item:d,onClick:h=>{h.stopPropagation(),x(v)}}):(0,t.jsx)(Ti,{item:d,onClick:h=>{h.stopPropagation(),x(v)}})},v))}),u=n.map(Di);let g;return e[0]!==m||e[1]!==u?(g=(0,t.jsxs)("div",{className:b,children:[m,u]}),e[0]=m,e[1]=u,e[2]=g):g=e[2],g},Mi=Ri;function Ei(i){return i.type==="image"||i.type==="video"}function Ii(i){return i.type==="file"}function Li(i){return i.type==="video"}function Di(i,e){return(0,t.jsx)($i,{file:i},e)}var Ai=({isOpen:i,onClose:e,url:s,title:r="Share",overlayClassName:l})=>{const[a,o]=(0,N.useState)(!1),[n,c]=(0,N.useState)(""),[x,b]=(0,N.useState)([]),[m,u]=(0,N.useState)(!1),[g,d]=(0,N.useState)(null),{addToast:v}=Ge(),{currentUser:h}=Vt(),f=(0,N.useCallback)(async()=>{if(h){u(!0);try{b((await kt(h.id)).map(p=>p.user).filter(p=>p!==null).slice(0,5))}catch(p){console.error("Failed to fetch conversations:",p)}finally{u(!1)}}},[h]),k=(0,N.useCallback)(async()=>{if(h){u(!0);try{b((await kt(h.id)).map(p=>p.user).filter(p=>p!==null&&(p.name?.toLowerCase().includes(n.toLowerCase())||p.handle?.toLowerCase().includes(n.toLowerCase()))))}catch(p){console.error("Search failed:",p)}finally{u(!1)}}},[n,h]);(0,N.useEffect)(()=>{if(!i||!h){c(""),b([]);return}const p=setTimeout(()=>{n.trim()?k():f()},300);return()=>clearTimeout(p)},[n,i,h,k,f]);const z=async p=>{p&&p.stopPropagation();try{await He(s),o(!0),v("Link copied to clipboard!","success"),setTimeout(()=>o(!1),2e3)}catch(F){console.error("Failed to copy:",F),v("Failed to copy link","error")}},w=async p=>{if(h){d(p.id);try{await Gs(await Us(h.id,p.id),h.id,s,"text"),v(`Sent to ${p.name||p.handle}!`,"success")}catch(F){console.error("Failed to send message:",F),v("Failed to send message","error")}finally{d(null)}}},_=[{name:"X",icon:ks,color:"bg-black text-white",href:`https://twitter.com/intent/tweet?url=${encodeURIComponent(s)}`},{name:"Facebook",icon:hs,color:"bg-[#1877F2] text-white",href:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(s)}`},{name:"LinkedIn",icon:rs,color:"bg-[#0A66C2] text-white",href:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(s)}`},{name:"WhatsApp",icon:gs,color:"bg-[#25D366] text-white",href:`https://wa.me/?text=${encodeURIComponent(s)}`},{name:"Email",icon:us,color:"bg-zinc-600 text-white",href:`mailto:?body=${encodeURIComponent(s)}`}],S=async()=>{if(navigator.share)try{await navigator.share({title:r,url:s})}catch(p){p.name!=="AbortError"&&console.error("Native share failed:",p)}else z()};return(0,t.jsx)(Ut,{isOpen:i,onClose:e,className:"max-w-[360px] overflow-hidden rounded-[32px] border border-black/10 bg-white/75 p-0 shadow-2xl backdrop-blur-xl dark:border-white/10 dark:bg-zinc-900/75 sm:max-w-[380px]",overlayClassName:l,children:(0,t.jsxs)("div",{className:"flex h-full flex-col",children:[(0,t.jsx)("div",{className:"flex items-center justify-center pt-6 pb-2",children:(0,t.jsx)("h2",{className:"text-[17px] font-semibold text-zinc-900 dark:text-zinc-50",children:r})}),(0,t.jsx)("div",{className:"px-5 py-3",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)(as,{className:"absolute left-3.5 top-1/2 size-4 -translate-y-1/2 text-zinc-400 transition-colors group-focus-within:text-violet-500"}),(0,t.jsx)("input",{type:"text",placeholder:"Search people...",value:n,onChange:p=>c(p.target.value),className:"w-full rounded-2xl border border-black/5 bg-black/5 py-3 pl-11 pr-4 text-[15px] outline-none transition-all focus:bg-white/50 focus:ring-4 focus:ring-violet-500/10 dark:border-white/5 dark:bg-white/5 dark:focus:bg-black/50"})]})}),(0,t.jsx)("div",{className:"no-scrollbar flex min-h-[110px] items-center gap-4 overflow-x-auto px-5 py-4",children:m?(0,t.jsx)("div",{className:"flex flex-1 justify-center",children:(0,t.jsx)("span",{className:"animate-pulse text-[13px] font-medium text-zinc-400",children:"Loading..."})}):x.length>0?x.map(p=>(0,t.jsxs)("button",{onClick:()=>w(p),disabled:g!==null,className:"group flex shrink-0 flex-col items-center gap-2 transition-transform active:scale-95 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"size-16 overflow-hidden rounded-full border-2 border-white/50 shadow-sm dark:border-zinc-800/50 bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)("img",{src:p.avatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${p.handle}`,alt:p.handle,className:"size-full object-cover"})}),g===p.id&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-full bg-black/40",children:(0,t.jsx)("span",{className:"animate-pulse text-white font-bold",children:"..."})})]}),(0,t.jsx)("span",{className:"max-w-[70px] truncate text-[11px] font-medium text-zinc-500 dark:text-zinc-400",children:p.name?.split(" ")[0]||p.handle})]},p.id)):(0,t.jsx)("div",{className:"flex-1 py-2 text-center",children:(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"No people found"})})}),(0,t.jsx)("div",{className:"mx-5 h-px bg-black/5 dark:bg-white/5"}),(0,t.jsxs)("div",{className:"grid grid-cols-5 gap-3 px-5 py-6",children:[_.map(p=>(0,t.jsxs)("a",{href:p.href,target:"_blank",rel:"noopener noreferrer",className:"group flex flex-col items-center gap-2.5",children:[(0,t.jsx)("div",{className:`size-12 ${p.color} flex items-center justify-center rounded-[18px] shadow-sm ring-1 ring-black/5 transition-all group-hover:-translate-y-1 group-hover:scale-105 group-hover:shadow-lg dark:ring-white/5`,children:(0,t.jsx)(p.icon,{size:22,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-wider text-zinc-500/80 dark:text-zinc-400/80",children:p.name})]},p.name)),(0,t.jsxs)("button",{onClick:S,className:"group flex flex-col items-center gap-2.5",children:[(0,t.jsx)("div",{className:"flex size-12 items-center justify-center rounded-[18px] border border-black/10 bg-white/50 text-zinc-600 shadow-sm transition-all group-hover:-translate-y-1 group-hover:scale-105 dark:border-white/10 dark:bg-white/5 dark:text-zinc-300",children:(0,t.jsx)(Ae,{size:22,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-wider text-zinc-500/80 dark:text-zinc-400/80",children:"More"})]})]}),(0,t.jsx)("div",{className:"px-5 pb-6",children:(0,t.jsxs)("div",{className:"group relative flex items-center overflow-hidden rounded-2xl border border-black/10 bg-white/40 dark:border-white/10 dark:bg-black/20",children:[(0,t.jsx)("input",{type:"text",readOnly:!0,value:s,className:"w-full bg-transparent py-4 pl-4 pr-16 text-[14px] font-medium text-zinc-600 outline-none dark:text-zinc-300"}),(0,t.jsx)("button",{onClick:z,className:`absolute right-1 text-[13px] font-bold active:scale-95 transition-all px-4 h-10 rounded-xl leading-none ${a?"text-emerald-500":"text-violet-600 hover:text-violet-700 dark:text-violet-400"}`,children:a?"Copied":"Copy"})]})}),(0,t.jsx)("div",{className:"border-t border-black/10 dark:border-white/10",children:(0,t.jsx)("button",{onClick:e,className:"flex h-16 w-full items-center justify-center text-[19px] font-medium text-zinc-500 transition-colors active:bg-black/5 dark:text-zinc-400 dark:active:bg-white/5",children:"Close"})})]})})},Ht=Ai,qt=Z(),Oi=i=>{const e=(0,qt.c)(6),{avatars:s}=i;if(!s||s.length===0)return null;let r,l;if(e[0]!==s){const o=s.slice(0,3);r="relative mt-2.5 h-8 w-8",l=o.map((n,c)=>{let x,b;return o.length===1?(x="top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",b="size-5"):o.length===2?(b="size-4.5",x=c===0?"top-0 right-0":"bottom-0 left-0"):(b=c===0?"size-4.5":"size-3.5",c===0?x="top-0 left-1/2 -translate-x-1/2":c===1?x="bottom-0.5 left-0":x="bottom-0.5 right-0"),(0,t.jsx)("div",{className:`absolute rounded-full border-2 border-white bg-zinc-100 dark:border-black dark:bg-zinc-800 overflow-hidden shadow-md transition-transform hover:scale-110 ${x} ${b}`,style:{zIndex:10-c},children:(0,t.jsx)("img",{src:n,alt:"",className:"h-full w-full object-cover",loading:"lazy"})},c)}),e[0]=s,e[1]=r,e[2]=l}else r=e[1],l=e[2];let a;return e[3]!==r||e[4]!==l?(a=(0,t.jsx)("div",{className:r,children:l}),e[3]=r,e[4]=l,e[5]=a):a=e[5],a},Mt=i=>{const e=(0,qt.c)(78),{id:s,user:r,isCurrentUser:l,isComment:a,isPinned:o,onEdit:n,onDelete:c,onTogglePin:x,addToast:b,trigger:m}=i,{openReport:u}=Bt(),[g,d]=(0,N.useState)(!1);if($s("(min-width: 1024px)")){let C;e[0]!==m?(C=(0,t.jsx)(Cs,{asChild:!0,onClick:Wi,children:(0,t.jsx)("div",{className:"cursor-pointer outline-none",children:m})}),e[0]=m,e[1]=C):C=e[1];let E;e[2]!==b||e[3]!==s||e[4]!==a?(E=!a&&(0,t.jsxs)(xe,{onClick:$=>{$.stopPropagation(),He(qe(s)).then(()=>{b("Link copied"),d(!1)}).catch(()=>{b("Failed to copy link","error")})},children:[(0,t.jsx)(ct,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Copy link"})]}),e[2]=b,e[3]=s,e[4]=a,e[5]=E):E=e[5];let I;e[6]!==s||e[7]!==u?(I=$=>{$.stopPropagation(),u("post",s),d(!1)},e[6]=s,e[7]=u,e[8]=I):I=e[8];let A;e[9]===Symbol.for("react.memo_cache_sentinel")?(A=(0,t.jsx)(Be,{className:"mr-2 h-4 w-4"}),e[9]=A):A=e[9];const D=a?"comment":"post";let q;e[10]!==D?(q=(0,t.jsxs)("span",{children:["Report ",D]}),e[10]=D,e[11]=q):q=e[11];let V;e[12]!==I||e[13]!==q?(V=(0,t.jsxs)(xe,{onClick:I,children:[A,q]}),e[12]=I,e[13]=q,e[14]=V):V=e[14];let B;e[15]!==l||e[16]!==u||e[17]!==r?(B=!l&&(0,t.jsxs)(xe,{onClick:$=>{$.stopPropagation(),u("user",r.id),d(!1)},children:[(0,t.jsx)(rt,{className:"mr-2 h-4 w-4"}),(0,t.jsxs)("span",{children:["Report @",r.handle]})]}),e[15]=l,e[16]=u,e[17]=r,e[18]=B):B=e[18];let Q;e[19]!==a||e[20]!==l||e[21]!==o||e[22]!==c||e[23]!==n||e[24]!==x?(Q=l&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(_s,{}),!a&&x&&(0,t.jsx)(xe,{onClick:$=>{$.stopPropagation(),x(),d(!1)},children:o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ft,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Unpin from profile"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Ue,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Pin to profile"})]})}),(0,t.jsxs)(xe,{onClick:$=>{$.stopPropagation(),n(),d(!1)},children:[(0,t.jsx)(dt,{className:"mr-2 h-4 w-4"}),(0,t.jsxs)("span",{children:["Edit ",a?"Comment":"Post"]})]}),(0,t.jsxs)(xe,{className:"text-red-500 focus:text-red-500",onClick:$=>{$.stopPropagation(),c(),d(!1)},children:[(0,t.jsx)(ot,{className:"mr-2 h-4 w-4"}),(0,t.jsxs)("span",{children:["Delete ",a?"comment":"post"]})]})]}),e[19]=a,e[20]=l,e[21]=o,e[22]=c,e[23]=n,e[24]=x,e[25]=Q):Q=e[25];let W;e[26]!==E||e[27]!==V||e[28]!==B||e[29]!==Q?(W=(0,t.jsxs)(ws,{align:"end",className:"w-56",onClick:Hi,children:[E,V,B,Q]}),e[26]=E,e[27]=V,e[28]=B,e[29]=Q,e[30]=W):W=e[30];let y;return e[31]!==g||e[32]!==C||e[33]!==W?(y=(0,t.jsx)("div",{onClick:Bi,children:(0,t.jsxs)(Ls,{open:g,onOpenChange:d,modal:!0,children:[C,W]})}),e[31]=g,e[32]=C,e[33]=W,e[34]=y):y=e[34],y}let v;e[35]===Symbol.for("react.memo_cache_sentinel")?(v=C=>{C.stopPropagation(),d(!0)},e[35]=v):v=e[35];let h;e[36]!==m?(h=(0,t.jsx)("div",{onClick:v,className:"cursor-pointer",children:m}),e[36]=m,e[37]=h):h=e[37];let f;e[38]===Symbol.for("react.memo_cache_sentinel")?(f=()=>d(!1),e[38]=f):f=e[38];let k;e[39]!==b||e[40]!==s||e[41]!==a?(k=!a&&(0,t.jsx)(ue,{icon:(0,t.jsx)(ct,{size:18}),onClick:C=>{C.stopPropagation(),He(qe(s)).then(()=>{b("Link copied"),d(!1)}).catch(()=>{b("Failed to copy link","error")})},children:"Copy link"}),e[39]=b,e[40]=s,e[41]=a,e[42]=k):k=e[42];let z;e[43]===Symbol.for("react.memo_cache_sentinel")?(z=(0,t.jsx)(Be,{size:18}),e[43]=z):z=e[43];let w;e[44]!==s||e[45]!==u?(w=C=>{C.stopPropagation(),u("post",s),d(!1)},e[44]=s,e[45]=u,e[46]=w):w=e[46];const _=a?"comment":"post";let S;e[47]!==w||e[48]!==_?(S=(0,t.jsxs)(ue,{icon:z,onClick:w,children:["Report ",_]}),e[47]=w,e[48]=_,e[49]=S):S=e[49];let p;e[50]!==l||e[51]!==u||e[52]!==r?(p=!l&&(0,t.jsxs)(ue,{icon:(0,t.jsx)(rt,{size:18}),onClick:C=>{C.stopPropagation(),u("user",r.id),d(!1)},children:["Report @",r.handle]}),e[50]=l,e[51]=u,e[52]=r,e[53]=p):p=e[53];let F;e[54]!==a||e[55]!==l||e[56]!==o||e[57]!==x?(F=l&&!a&&x&&(0,t.jsx)(ue,{icon:o?(0,t.jsx)(ft,{size:18}):(0,t.jsx)(Ue,{size:18}),onClick:C=>{C.stopPropagation(),x(),d(!1)},children:o?"Unpin from profile":"Pin to profile"}),e[54]=a,e[55]=l,e[56]=o,e[57]=x,e[58]=F):F=e[58];let M;e[59]!==a||e[60]!==l||e[61]!==n?(M=l&&(0,t.jsxs)(ue,{icon:(0,t.jsx)(dt,{size:18}),onClick:C=>{C.stopPropagation(),n(),d(!1)},children:["Edit ",a?"Comment":"Post"]}),e[59]=a,e[60]=l,e[61]=n,e[62]=M):M=e[62];let T;e[63]!==a||e[64]!==l||e[65]!==c?(T=l&&(0,t.jsxs)(ue,{variant:"destructive",icon:(0,t.jsx)(ot,{size:18}),onClick:C=>{C.stopPropagation(),c(),d(!1)},children:["Delete ",a?"comment":"post"]}),e[63]=a,e[64]=l,e[65]=c,e[66]=T):T=e[66];let j;e[67]!==g||e[68]!==F||e[69]!==M||e[70]!==T||e[71]!==k||e[72]!==S||e[73]!==p?(j=(0,t.jsx)("div",{onClick:qi,children:(0,t.jsxs)(Zs,{isOpen:g,onClose:f,children:[k,S,p,F,M,T]})}),e[67]=g,e[68]=F,e[69]=M,e[70]=T,e[71]=k,e[72]=S,e[73]=p,e[74]=j):j=e[74];let P;return e[75]!==j||e[76]!==h?(P=(0,t.jsxs)(t.Fragment,{children:[h,j]}),e[75]=j,e[76]=h,e[77]=P):P=e[77],P},Qe=({id:i,user:e,timeAgo:s,content:r,contentClass:l,media:a,quotedPost:o,stats:n,onClick:c,repostedBy:x,onUserClick:b,currentUser:m,poll:u,isDetail:g,initialComments:d,onDelete:v,onUpdate:h,isComment:f,onReply:k,community:z,parent_id:w,post_id:_,commenterAvatars:S=[],is_pinned:p=!1,type:F="text",duration:M})=>{const T=It(),{addToast:j}=Ge(),P=is(),[C,E]=(0,N.useState)(p),{liked:I,reposted:A,localStats:D,setLocalStats:q,handleLike:V,handleRepost:B}=Qs(_||i,n,m),{deletePost:Q,updatePost:W}=Hs(),y=async()=>{try{const R=!C;await W(i,{is_pinned:R,pinned_at:R?new Date().toISOString():null}),E(R),P.invalidateQueries({queryKey:["posts","user",e.id]}),j(R?"Post pinned to profile":"Post unpinned")}catch(R){console.error("Failed to toggle pin:",R),j("Failed to update pin status")}},{comments:$,fetchNextPage:L,hasNextPage:O,isFetchingNextPage:H,addComment:le,deleteComment:ae,updateComment:be,isSubmitting:ne}=yt(_||i,d),[de,Y]=(0,N.useState)(""),[ee,ie]=(0,N.useState)([]),[re,me]=(0,N.useState)(!1),[U,G]=(0,N.useState)(!1),[te,se]=(0,N.useState)(!1),[fe,ze]=(0,N.useState)(r),[Ne,we]=(0,N.useState)(a||[]),[Ce,ve]=(0,N.useState)([]),[Ze,Ye]=(0,N.useState)(!1),[Qt,Ie]=(0,N.useState)(!1),[Le,_e]=(0,N.useState)(null),[De,et]=(0,N.useState)(!1),{comments:Gt,refetch:tt}=yt(_||i,void 0,De?i:void 0),{ref:st,inView:it}=ts({threshold:.5,triggerOnce:!0});(0,N.useEffect)(()=>{if(it&&!f&&i&&!i.startsWith("temp-")){const R=setTimeout(()=>{At(i).catch(console.error)},1500);return()=>clearTimeout(R)}},[it,i,f]);const Jt=(0,N.useCallback)(async()=>{!i||!_&&!i||D.comments===0||(et(!0),tt())},[i,_,D.comments,tt]),lt=async()=>{const R=JSON.stringify(Ne)!==JSON.stringify(a||[])||Ce.length>0;if(!fe.trim()||fe===r&&!R){se(!1);return}Ye(!0);try{const J=[];for(const oe of Ce){const $e=await ye(oe);J.push($e)}const X=[...Ne,...J];f?await be({commentId:i,content:fe,media:X}):await W(i,{content:fe,media:X}),ve([]),se(!1),j(`${f?"Comment":"Post"} updated`),h&&h(i,fe,X)}catch(J){console.error(`Failed to update ${f?"comment":"post"}:`,J),j(`Failed to update ${f?"comment":"post"}`)}finally{Ye(!1)}},at=async R=>{R&&R.stopPropagation();try{f?await ae(i):await Q(i),j(`${f?"Comment":"Post"} deleted successfully`),v&&v(i)}catch(J){console.error(`Failed to delete ${f?"comment":"post"}:`,J),j(`Failed to delete ${f?"comment":"post"}`)}finally{G(!1)}},Kt=async(R,J)=>{if(R?.preventDefault(),!(!de.trim()&&ee.length===0&&!J||!m)){me(!0);try{let X=[],oe="text",$e;if(J)X=[await ye(new File([J.blob],"voice-comment.webm",{type:"audio/webm"}))],oe="voice",$e=J.duration;else for(const Pe of ee){const Zt=await ye(Pe);X.push(Zt)}await le({userId:m.id,content:de,media:X,replyToId:Le?.id,type:oe,duration:$e}),Y(""),ie([]),_e(null),q(Pe=>({...Pe,comments:(Pe.comments||0)+1})),j(oe==="voice"?"Voice reply posted!":"Reply posted!")}catch(X){console.error("Failed to post comment:",X),j("Failed to post reply.")}finally{me(!1)}}},Se=m?.handle===e.handle,Xt=(R,J)=>{_e(J?{handle:R,id:f?w||i:J}:null),Y(X=>{const oe=`@${R} `;return X.includes(oe)?X:oe+X}),document.getElementById("comment-input")?.focus()};return g?(0,t.jsxs)(K.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col",ref:st,children:[(0,t.jsxs)("article",{className:"p-6 dark:bg-black",children:[(0,t.jsx)(St,{user:e,timeAgo:s,community:z,onUserClick:b,isDetail:!0,showAvatar:!0,isPinned:C,actionsMenu:(0,t.jsx)(Mt,{id:i,user:e,isCurrentUser:Se,isComment:f,isPinned:C,onEdit:()=>se(!0),onDelete:()=>G(!0),onTogglePin:y,addToast:j,trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,t.jsx)(Ae,{size:20})})})}),(0,t.jsx)($t,{content:r,isDetail:!0,isEditing:te,editedContent:fe,setEditedContent:ze,onCancelEdit:()=>{se(!1),ze(r),we(a||[]),ve([])},onSaveEdit:lt,isUpdating:Ze,contentClass:l}),F==="voice"&&a?.[0]&&(0,t.jsx)("div",{className:"mt-4 max-w-[300px]",children:(0,t.jsx)(wt,{url:a[0].url,duration:M||0,isMe:Se})}),Te(r)&&(0,t.jsx)(Rt,{url:Te(r)}),(0,t.jsx)(Pt,{media:a,isEditing:te,editedMedia:Ne,setEditedMedia:we,newFiles:Ce,setNewFiles:ve}),u&&(0,t.jsx)(Tt,{poll:u,onVote:R=>Ms(i,R,m.id)}),o&&(0,t.jsx)("div",{className:"mt-5 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm dark:border-zinc-700",children:(0,t.jsx)(Ft,{...o})}),(0,t.jsx)(_t,{views:D.views||0,likes:D.likes||0,comments:D.comments||0,isDetail:!0}),(0,t.jsx)("div",{className:"my-4"}),(0,t.jsx)(Ct,{liked:I,reposted:A,handleLike:V,handleRepost:B,handleCommentClick:()=>document.getElementById("comment-input")?.focus(),handleShareClick:()=>Ie(!0),isDetail:!0,isComment:f})]}),Le&&(0,t.jsxs)("div",{className:"flex items-center justify-between bg-zinc-50 px-5 py-2 dark:bg-zinc-900/50",children:[(0,t.jsxs)("span",{className:"text-sm text-zinc-500",children:["Replying to"," ",(0,t.jsxs)("span",{className:"font-bold text-violet-600",children:["@",Le.handle]})]}),(0,t.jsx)("button",{onClick:()=>_e(null),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,t.jsx)(ke,{size:16})})]}),(0,t.jsx)(Wt,{currentUser:m,newComment:de,setNewComment:Y,handleSubmitComment:Kt,loading:ne,selectedFiles:ee,setSelectedFiles:ie,isUploading:re}),(0,t.jsxs)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:[(0,t.jsx)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:(0,t.jsxs)(t.Fragment,{children:[O&&$.length>0&&(0,t.jsxs)("button",{onClick:()=>L(),disabled:H,className:"flex w-full items-center justify-center gap-2 py-3 text-sm font-bold text-violet-600 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[H&&(0,t.jsx)("span",{className:"animate-spin",children:"⌛"}),"View more replies"]}),$.map(R=>(0,t.jsx)(Qe,{...R,isComment:!0,post_id:i,onReply:Xt,onUserClick:b,currentUser:m,stats:{likes:R.stats?.likes||0,comments:R.stats?.comments||0,reposts:R.stats?.reposts||0},timeAgo:R.timeAgo||R.created_at},R.id))]})}),(0,t.jsx)(bt,{open:U,onOpenChange:G,children:(0,t.jsxs)(ht,{onClick:R=>R.stopPropagation(),children:[(0,t.jsxs)(Nt,{children:[(0,t.jsx)(zt,{children:"Are you absolutely sure?"}),(0,t.jsx)(xt,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(jt,{children:[(0,t.jsx)(vt,{onClick:R=>R.stopPropagation(),children:"Cancel"}),(0,t.jsx)(gt,{onClick:at,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})]}):(0,t.jsxs)(K.article,{initial:{opacity:0,y:10},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-50px"},transition:{duration:.4,ease:"easeOut"},ref:st,onClick:c,className:`px-5 transition-all ${f?"py-3 bg-transparent hover:bg-zinc-50/30 dark:hover:bg-zinc-800/20":"py-5 bg-white hover:bg-zinc-50/30 dark:bg-black dark:hover:bg-white/[0.02]"} ${c?"cursor-pointer":""}`,children:[x&&(0,t.jsxs)("div",{className:"mb-2.5 ml-1 flex items-center space-x-1.5 text-[13px] font-semibold text-zinc-600",children:[(0,t.jsx)(Ve,{size:14,className:"text-zinc-500"}),(0,t.jsxs)("span",{className:"flex cursor-pointer items-center text-zinc-700 hover:underline dark:text-zinc-300",onClick:R=>{R.stopPropagation(),b&&b(x.handle)},children:[x.handle," Reposted"]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-x-3.5",children:[(0,t.jsxs)("div",{className:"flex shrink-0 flex-col items-center self-stretch pt-0.5",children:[(0,t.jsx)("div",{className:"cursor-pointer",onClick:R=>{R.stopPropagation(),b&&b(e.handle)},children:(0,t.jsxs)(ge,{className:`${f?"size-8":"size-10"} border-0 shadow-sm`,children:[(0,t.jsx)(he,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(pe,{className:"text-xs",children:e.handle[0]?.toUpperCase()})]})}),(!f&&D.comments>0||f&&!w&&D.comments>0)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mt-2 w-0.5 flex-1 rounded-full bg-zinc-100 dark:bg-zinc-800"}),!f&&(0,t.jsx)(Oi,{avatars:S.length>0?S:($||[]).slice(0,3).map(R=>R.user.avatar)})]})]}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,t.jsx)(St,{user:e,timeAgo:s,community:z,onUserClick:b,isComment:f,isPinned:C,actionsMenu:(0,t.jsx)(Mt,{id:i,user:e,isCurrentUser:Se,isComment:f,isPinned:C,onEdit:()=>se(!0),onDelete:()=>G(!0),onTogglePin:y,addToast:j,trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 group-hover:bg-zinc-100 dark:hover:bg-zinc-800 dark:group-hover:bg-zinc-800/50",children:(0,t.jsx)(Ae,{size:18})})})}),(0,t.jsx)($t,{content:r,isEditing:te,editedContent:fe,setEditedContent:ze,onCancelEdit:()=>{se(!1),ze(r),we(a||[]),ve([])},onSaveEdit:lt,isUpdating:Ze,contentClass:l}),F==="voice"&&a?.[0]&&(0,t.jsx)("div",{className:"mt-3 max-w-[280px]",children:(0,t.jsx)(wt,{url:a[0].url,duration:M||0,isMe:Se})}),Te(r)&&(0,t.jsx)(Rt,{url:Te(r)}),(0,t.jsx)(Pt,{media:a,isEditing:te,editedMedia:Ne,setEditedMedia:we,newFiles:Ce,setNewFiles:ve}),u&&(0,t.jsx)(Tt,{poll:u}),o&&(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-900",onClick:R=>{R.stopPropagation(),T(`/p/${o.id}`)},children:(0,t.jsx)(Ft,{...o})}),(0,t.jsx)(Ct,{liked:I,reposted:A,handleLike:V,handleRepost:B,handleCommentClick:R=>{if(R?.stopPropagation(),k){const J=f&&w||i;k(e.handle,J)}else c&&c()},handleShareClick:R=>{R?.stopPropagation(),Ie(!0)},isComment:f}),(0,t.jsx)(_t,{views:D.views||0,likes:D.likes||0,comments:D.comments||0,isComment:f,onRepliesClick:()=>{De?et(!1):Jt()}}),De&&(0,t.jsxs)("div",{className:"relative mt-2 space-y-0",children:[(0,t.jsx)("div",{className:"absolute left-[19px] top-0 bottom-4 w-0.5 bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsx)("div",{className:"flex flex-col",children:Gt.map(R=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute left-[19px] top-5 h-0.5 w-4 bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsx)("div",{className:"pl-6",children:(0,t.jsx)(Qe,{...R,isComment:!0,post_id:_||i,onReply:k,onUserClick:b,currentUser:m,stats:{likes:R.stats?.likes||0,comments:R.stats?.comments||0,reposts:R.stats?.reposts||0},timeAgo:R.timeAgo||R.created_at})})]},R.id))})]}),(0,t.jsx)(Ht,{isOpen:Qt,onClose:()=>Ie(!1),url:qe(i),title:"Share Post",overlayClassName:"z-[9999]"}),(0,t.jsx)(bt,{open:U,onOpenChange:G,children:(0,t.jsxs)(ht,{onClick:R=>R.stopPropagation(),children:[(0,t.jsxs)(Nt,{children:[(0,t.jsx)(zt,{children:"Are you absolutely sure?"}),(0,t.jsx)(xt,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(jt,{children:[(0,t.jsx)(vt,{onClick:R=>R.stopPropagation(),children:"Cancel"}),(0,t.jsx)(gt,{onClick:at,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})]})]})};function Ui(i,e){const s=!i.media&&!e.media||i.media?.length===e.media?.length&&i.media?.every((l,a)=>l.url===e.media?.[a].url),r=i.repostedBy?.handle===e.repostedBy?.handle;return i.id===e.id&&i.content===e.content&&i.timeAgo===e.timeAgo&&i.user.id===e.user.id&&i.user.avatar===e.user.avatar&&i.stats.likes===e.stats.likes&&i.stats.comments===e.stats.comments&&i.stats.reposts===e.stats.reposts&&i.currentUser?.id===e.currentUser?.id&&!!s&&!!r}var Vi=N.memo(Qe,Ui);function Bi(i){return i.stopPropagation()}function Wi(i){return i.stopPropagation()}function Hi(i){return i.stopPropagation()}function qi(i){return i.stopPropagation()}var Xe=null;const Fe=i=>{Xe=i},Re=()=>Xe,ll=()=>{Xe=null};var Qi=N.memo(({reel:i,isActive:e,volume:s,shouldLoad:r=!0})=>{const{currentUser:l}=Vt(),{addToast:a}=Ge(),{openReport:o}=Bt(),n=(0,N.useRef)(null),[c,x]=(0,N.useState)(!1),[b,m]=(0,N.useState)(!1),[u,g]=(0,N.useState)(!1),[d,v]=(0,N.useState)(!1),[h,f]=(0,N.useState)(null),[k,z]=(0,N.useState)(!1),[w,_]=(0,N.useState)(i.stats?.likes||0),[S,p]=(0,N.useState)(!1),[F,M]=(0,N.useState)(0),[T,j]=(0,N.useState)(!1),P=(0,N.useRef)(null);(0,N.useEffect)(()=>{if(e&&i.id&&!i.id.toString().startsWith("temp-")){const y=setTimeout(()=>{At(i.id).catch(console.error)},1500);return()=>clearTimeout(y)}},[e,i.id]);const C=(0,N.useMemo)(()=>Array.isArray(i.media)?i.media[0]?.src||i.media[0]?.url:i.media?.src||i.media?.url||i.url,[i.media,i.url]);(0,N.useEffect)(()=>{v(!1),j(!1);const y=n.current?.plyr;if(y&&typeof y.on=="function"){const $=()=>v(!0),L=()=>j(!0);y.on("ready",$),y.on("canplay",$),y.on("loadeddata",$),y.on("playing",L);const O=setTimeout(()=>{!T&&e&&j(!0)},3e3);return()=>{clearTimeout(O),typeof y.off=="function"&&(y.off("ready",$),y.off("canplay",$),y.off("loadeddata",$),y.off("playing",L))}}else{const $=setTimeout(()=>{v(!0),e&&j(!0)},1500);return()=>clearTimeout($)}},[C,e]);const E=(0,N.useRef)(null);(0,N.useEffect)(()=>{const y=n.current,$=y?.plyr;if(E.current&&(clearTimeout(E.current),E.current=null),!(!$||!d))return e?E.current=setTimeout(()=>{E.current=null;const L=n.current?.plyr;if(L&&typeof L.play=="function"){const O=Re();O&&O!==L&&typeof O.pause=="function"&&(O.pause(),typeof O.currentTime<"u"&&(O.currentTime=0)),L.play().catch(()=>{const H=n.current?.plyr;H&&typeof H.play=="function"&&H.play().catch(()=>{})}).then(()=>{Fe(L)})}},50):typeof $.pause=="function"&&($.pause(),typeof $.currentTime<"u"&&($.currentTime=0),Re()===$&&Fe(null)),()=>{E.current&&(clearTimeout(E.current),E.current=null);const L=y?.plyr;L&&typeof L.pause=="function"&&(L.pause(),typeof L.currentTime<"u"&&(L.currentTime=0),Re()===L&&Fe(null))}},[e,d]),(0,N.useEffect)(()=>{const y=n.current;return()=>{E.current&&(clearTimeout(E.current),E.current=null);const $=y?.plyr;$&&typeof $.pause=="function"&&($.pause(),$.currentTime=0,Re()===$&&Fe(null)),v(!1),j(!1),M(0)}},[]),(0,N.useEffect)(()=>{if(!l?.id||!e)return;(async()=>{try{const[$,L]=await Promise.all([Ns(i.id,l.id),Ws(l.id,i.user?.id)]);z($),p(L)}catch($){console.error("Failed to check interaction status:",$)}})()},[i.id,l?.id,e,i.user?.id]),(0,N.useEffect)(()=>{const y=n.current?.plyr;y&&e&&(y.muted=s===0,y.volume=s)},[s,d,e]),(0,N.useEffect)(()=>{const y=n.current?.plyr;if(!y||!e)return;const $=()=>{const L=y.currentTime,O=y.duration;O>0&&M(L/O*100)};if(typeof y.on=="function")return y.on("timeupdate",$),()=>{typeof y.off=="function"&&y.off("timeupdate",$)}},[e]);const I=y=>{y.stopPropagation();const $=y.currentTarget.getBoundingClientRect(),L=y.clientX-$.left,O=Math.min(Math.max(0,L/$.width),1),H=n.current?.plyr;H&&H.duration&&(H.currentTime=O*H.duration,M(O*100))};(0,N.useEffect)(()=>()=>{P.current&&clearTimeout(P.current)},[]);const A=y=>{const $=y.target;$.closest("button")||$.closest("a")||$.closest(".plyr__controls")||(P.current?(clearTimeout(P.current),P.current=null,q()):P.current=setTimeout(()=>{P.current=null,D()},250))},D=()=>{const y=n.current?.plyr;y&&(y.paused?(typeof y.play=="function"&&y.play().catch(()=>{}),f("play")):(typeof y.pause=="function"&&y.pause(),f("pause")),setTimeout(()=>f(null),800))},q=async()=>{if(l&&(x(!0),setTimeout(()=>x(!1),800),!k)){z(!0),_(y=>y+1);try{await ut(i.id,l.id)}catch{z(!1),_(y=>y-1)}}},V=async y=>{if(y.stopPropagation(),!l)return;const $=!k;z($),_(L=>$?L+1:L-1);try{await ut(i.id,l.id)}catch{z(!$),_(L=>$?L-1:L+1)}},B=async y=>{if(y.stopPropagation(),!l)return;const $=!S;p($);try{await Rs(l.id,i.user?.id)}catch{p(!$)}},Q=y=>{y.stopPropagation(),g(!0)},W=(0,N.useMemo)(()=>({source:{type:"video",sources:[{src:C,type:"video/mp4"}]},options:{controls:[],loop:{active:!0},clickToPlay:!1,ratio:"9:16",autoplay:!1,playsinline:!0,muted:!0}}),[C]);return(0,t.jsxs)("div",{"data-id":i.id,className:"reel-item relative flex h-[100dvh] w-full snap-start items-center justify-center overflow-hidden bg-black cursor-pointer select-none",onClick:A,children:[(0,t.jsxs)("div",{className:"relative flex h-full w-full max-w-[450px] items-center justify-center",children:[(0,t.jsx)("div",{className:"w-full",children:r?(0,t.jsx)(zs,{ref:n,...W}):(0,t.jsx)("div",{className:"aspect-[9/16] w-full bg-zinc-900",children:(0,t.jsx)("img",{src:i.media?.[0]?.preview||i.media?.[0]?.thumbnail||C,className:"h-full w-full object-cover opacity-50 blur-xl",alt:"Reel preview"})})}),!T&&(0,t.jsx)("div",{className:"absolute inset-0 z-[60] flex items-center justify-center bg-zinc-900 pointer-events-none",children:(0,t.jsx)(Es,{})}),(0,t.jsx)(We,{children:c&&(0,t.jsx)(K.div,{initial:{scale:0,opacity:0},animate:{scale:[0,1.2,1],opacity:1},exit:{scale:1.5,opacity:0},transition:{duration:.5,type:"spring",stiffness:400,damping:20},className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)(Me,{size:120,fill:"white",className:"text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.4)]"})})}),(0,t.jsx)(We,{children:h&&(0,t.jsx)(K.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},transition:{duration:.4},className:"absolute inset-0 z-50 flex items-center justify-center",onClick:y=>{y.stopPropagation(),D()},children:(0,t.jsx)("div",{className:"rounded-full border border-white/20 bg-white/10 p-8 shadow-2xl backdrop-blur-md cursor-pointer hover:bg-white/20 transition-colors",children:h==="play"?(0,t.jsx)(Oe,{size:50,fill:"white",className:"ml-1.5 text-white"}):(0,t.jsx)(ys,{size:50,fill:"white",className:"text-white"})})})}),(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/60"}),(0,t.jsxs)("div",{className:"pointer-events-none absolute bottom-6 left-4 right-16 text-white",children:[(0,t.jsxs)("div",{className:"pointer-events-auto mb-3 flex items-center gap-2",children:[(0,t.jsxs)(Yt,{to:`/u/${i.user?.handle}`,className:"flex items-center gap-2 transition-opacity hover:opacity-80 active:scale-95",onClick:y=>y.stopPropagation(),children:[(0,t.jsxs)(ge,{className:"size-10 border-2 border-white",children:[(0,t.jsx)(he,{src:i.user?.avatar,alt:i.user?.handle,className:"object-cover"}),(0,t.jsx)(pe,{children:i.user?.handle?.[0]?.toUpperCase()})]}),(0,t.jsxs)("span",{className:"font-bold",children:["@",i.user?.handle]})]}),l?.id!==i.user?.id&&(0,t.jsx)("button",{className:`ml-2 flex items-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-bold transition-all active:scale-95 ${S?"border border-white/50 bg-transparent text-white":"bg-white text-black hover:bg-zinc-200"}`,onClick:B,children:S?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Ps,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Following"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Ss,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Follow"})]})})]}),(0,t.jsx)(Je,{content:i.content,className:"mb-3 line-clamp-2 text-sm text-white"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[(0,t.jsx)(vs,{size:14,className:"animate-spin-slow"}),(0,t.jsxs)("span",{children:["Original Audio - ",i.user?.handle]})]})]}),(0,t.jsxs)("div",{className:"absolute bottom-6 right-2 z-10 flex flex-col items-center gap-6",children:[(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)(K.button,{whileTap:{scale:.8},className:`rounded-full p-3 backdrop-blur-md transition-all ${k?"bg-rose-500/20 text-rose-500":"bg-zinc-800/50 text-white hover:bg-zinc-700"}`,onClick:V,children:(0,t.jsx)(K.div,{animate:k?{scale:[1,1.3,1]}:{scale:1},transition:{duration:.3},children:(0,t.jsx)(Me,{size:28,fill:k?"currentColor":"none"})})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:w})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)(K.button,{whileTap:{scale:.8},className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700",onClick:y=>{y.stopPropagation(),m(!0)},children:(0,t.jsx)(Dt,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:i.stats?.comments||0})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)(K.button,{whileTap:{scale:.8},className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700",onClick:Q,children:(0,t.jsx)(Ee,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:i.stats?.shares||0})]}),(0,t.jsx)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:(0,t.jsx)(K.button,{whileTap:{scale:.8},className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-rose-500/20 hover:text-rose-500",onClick:y=>{y.stopPropagation(),o("reel",i.id)},children:(0,t.jsx)(Be,{size:28})})})]}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 z-50 h-[3px] w-full bg-white/20 hover:h-[8px] transition-all cursor-pointer group",onClick:I,children:(0,t.jsx)("div",{className:"h-full bg-white shadow-[0_0_8px_rgba(255,255,255,0.8)] transition-all duration-100 ease-linear relative",style:{width:`${F}%`},children:(0,t.jsx)("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 size-3 bg-white rounded-full shadow-lg scale-0 group-hover:scale-100 transition-transform"})})})]}),(0,t.jsx)(Ji,{isOpen:b,onClose:()=>m(!1),reelId:i.id,currentUser:l,showToast:a}),(0,t.jsx)(Ht,{isOpen:u,onClose:()=>g(!1),url:Xs(i.id),title:"Share Reel",overlayClassName:"z-[9999]"})]})},(i,e)=>i.isActive===e.isActive&&i.reel.id===e.reel.id&&i.volume===e.volume&&i.shouldLoad===e.shouldLoad),al=Qi,Gi=({isOpen:i,onClose:e,reelId:s,currentUser:r,showToast:l})=>{const[a,o]=(0,N.useState)([]),[n,c]=(0,N.useState)(!1),[x,b]=(0,N.useState)(!1),[m,u]=(0,N.useState)(""),[g,d]=(0,N.useState)([]),[v,h]=(0,N.useState)(!1),[f,k]=(0,N.useState)(!0),[z,w]=(0,N.useState)(!1),[_,S]=(0,N.useState)(null),p=(0,N.useRef)(a);(0,N.useEffect)(()=>{p.current=a},[a]);const F=(0,N.useCallback)(async(T=!1)=>{if(!(!s||s.startsWith("temp-"))){T?w(!0):c(!0);try{const j=p.current,P=await Js(s,T&&j.length>0?j[j.length-1].created_at:null,10);P.length<10?k(!1):k(!0),o(T?C=>[...C,...P]:P)}catch(j){console.error("Failed to load comments:",j),l&&l("Failed to load comments","error")}finally{c(!1),w(!1)}}},[s,l]);(0,N.useEffect)(()=>{i&&s?F():(o([]),k(!0))},[i,s,F]);const M=async(T,j)=>{if(T?.preventDefault(),!(!m.trim()&&g.length===0&&!j||!r)){b(!0),h(!0);try{let P=[],C="text",E=null;if(j)P=[await ye(new File([j.blob],"voice-comment.webm",{type:"audio/webm"}))],C="voice",E=j.duration;else for(const I of g){const A=await ye(I);P.push(A)}await Is(s,r.id,m,P,_?.id,C,E),u(""),d([]),S(null),l&&l(C==="voice"?"Voice reply posted!":"Reply posted!"),F()}catch(P){console.error("Failed to post comment:",P),l&&l("Failed to post reply.","error")}finally{b(!1),h(!1)}}};return(0,t.jsx)(Ut,{isOpen:i,onClose:e,title:"Comments",className:"max-sm:h-[95dvh] h-[85vh] overflow-hidden !p-0 sm:max-w-xl",children:(0,t.jsxs)("div",{className:"flex h-full flex-col overflow-hidden bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"mx-auto my-3 h-1.5 w-12 shrink-0 rounded-full bg-zinc-200 dark:bg-zinc-800 sm:hidden"}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto scroll-smooth scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800",children:n?(0,t.jsx)("div",{className:"flex flex-col",children:[1,2,3].map(T=>(0,t.jsx)(As,{},T))}):a.length>0?(0,t.jsxs)("div",{className:"flex flex-col",children:[a.map(T=>(0,t.jsx)(Vi,{...T,isComment:!0,post_id:s,currentUser:r,showToast:l,onReply:(j,P)=>{S(P?{handle:j,id:P}:null),u(C=>C.includes(`@${j}`)?C:C+`@${j} `)},onDelete:j=>o(P=>P.filter(C=>C.id!==j)),onUpdate:(j,P,C)=>o(E=>E.map(I=>I.id===j?{...I,content:P,media:C}:I))},T.id)),f&&(0,t.jsx)("div",{className:"flex justify-center border-t border-zinc-100 py-4 dark:border-zinc-800",children:(0,t.jsx)(Ot,{variant:"ghost",onClick:()=>F(!0),loading:z,className:"text-violet-600 font-bold",children:"View more replies"})})]}):(0,t.jsxs)("div",{className:"flex h-full min-h-[300px] flex-col items-center justify-center p-8 text-center text-zinc-500",children:[(0,t.jsx)("div",{className:"mb-4 flex size-16 items-center justify-center rounded-full bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(Lt,{size:32,className:"text-zinc-400"})}),(0,t.jsx)("p",{className:"text-lg font-bold dark:text-zinc-300",children:"No comments yet"}),(0,t.jsx)("p",{className:"text-sm dark:text-zinc-500",children:"Be the first to share what you think!"})]})}),(0,t.jsxs)("div",{className:"shrink-0 border-t border-zinc-100 bg-white pb-safe dark:border-zinc-800 dark:bg-zinc-900",children:[_&&(0,t.jsxs)("div",{className:"flex items-center justify-between border-b border-zinc-50 bg-zinc-50/50 px-4 py-2 dark:border-zinc-800/50 dark:bg-zinc-900/50",children:[(0,t.jsxs)("span",{className:"text-xs text-zinc-500",children:["Replying to"," ",(0,t.jsxs)("span",{className:"font-bold text-violet-600",children:["@",_.handle]})]}),(0,t.jsx)("button",{onClick:()=>S(null),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,t.jsx)(ke,{size:14})})]}),(0,t.jsx)(Wt,{currentUser:r,newComment:m,setNewComment:u,handleSubmitComment:M,loading:x,selectedFiles:g,setSelectedFiles:d,isUploading:v})]})]})})},Ji=Gi;export{ll as n,Vi as r,al as t};
