import{n as H}from"./rolldown-runtime-2JzG8er9.js";import{s as q,u as ne,w as le,y as ee}from"./framework-pMVb9Z5_.js";import"./database-ApDMvJcm.js";import{At as Z,Bt as ce,Dn as oe,Fn as de,In as xe,It as me,Kt as ue,Tn as he,Ut as te,Vn as pe,Yt as be,en as fe,kt as je,ln as V,on as ge}from"./ui-libs-CVo_NHeJ.js";import{$ as B,B as ve,F as se,I as re,J,K as ze,P as ie,Q as ke,X as G,Y as Ne,Z as we,_t as ye,dt as Ce,et as F,h as Se,k as Me,q as Ie,tt as K}from"./index-Dj_euOpA.js";import{n as $e,t as Te}from"./linkify-bYOTkjrL.js";import{a as Pe,u as ae}from"./hooks-CsE4EoXJ.js";var Re=q(),R=H(le(),1),e=H(ne(),1),Ue=s=>{const t=(0,Re.c)(55),{conv:i,selectedId:b,onSelect:o,onlineUsers:c}=s,d=ee(),n=ae(i.user?.lastSeen);let a;t[0]!==i.user?.id||t[1]!==c?(a=c.has(i.user?.id),t[0]=i.user?.id,t[1]=c,t[2]=a):a=t[2];const m=a;let v;t[3]!==i.user||t[4]!==d?(v=Q=>{Q.stopPropagation(),i.user?.handle&&d(`/u/${i.user.handle}`)},t[3]=i.user,t[4]=d,t[5]=v):v=t[5];const x=v;let j;t[6]!==i||t[7]!==o?(j=()=>o(i),t[6]=i,t[7]=o,t[8]=j):j=t[8];const g=`flex cursor-pointer items-center gap-3 p-4 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900 ${b===i.id?"border-r-2 border-violet-500 bg-zinc-50 dark:bg-zinc-900":""}`,w=i.user?.avatar,P=i.user?.name;let y;t[9]!==w||t[10]!==P?(y=(0,e.jsx)(K,{src:w,alt:P,className:"object-cover"}),t[9]=w,t[10]=P,t[11]=y):y=t[11];let f;t[12]!==i.user?.name?.[0]?(f=i.user?.name?.[0]?.toUpperCase(),t[12]=i.user?.name?.[0],t[13]=f):f=t[13];let N;t[14]!==f?(N=(0,e.jsx)(F,{children:f}),t[14]=f,t[15]=N):N=t[15];let M;t[16]!==y||t[17]!==N?(M=(0,e.jsxs)(B,{className:"size-12 transition-all group-hover:brightness-90",children:[y,N]}),t[16]=y,t[17]=N,t[18]=M):M=t[18];let I;t[19]!==m?(I=m&&(0,e.jsx)("span",{className:"absolute bottom-0 right-0 size-3 rounded-full border-2 border-white bg-emerald-500 dark:border-black"}),t[19]=m,t[20]=I):I=t[20];let z;t[21]!==x||t[22]!==M||t[23]!==I?(z=(0,e.jsxs)("div",{className:"group relative",onClick:x,children:[M,I]}),t[21]=x,t[22]=M,t[23]=I,t[24]=z):z=t[24];const $=i.user?.name;let C;t[25]!==x||t[26]!==$?(C=(0,e.jsx)("span",{onClick:x,className:"mt-1 cursor-pointer truncate font-bold dark:text-white",children:$}),t[25]=x,t[26]=$,t[27]=C):C=t[27];let p;t[28]!==i.user?.lastSeen||t[29]!==m||t[30]!==n?(p=m?(0,e.jsx)("span",{className:"mb-1 text-[10px] font-medium leading-none text-emerald-500",children:"Online"}):i.user?.lastSeen&&(0,e.jsx)("span",{className:"mb-1 text-[10px] font-medium leading-none text-zinc-500",children:n}),t[28]=i.user?.lastSeen,t[29]=m,t[30]=n,t[31]=p):p=t[31];let h;t[32]!==C||t[33]!==p?(h=(0,e.jsxs)("div",{className:"flex min-w-0 flex-col",children:[C,p]}),t[32]=C,t[33]=p,t[34]=h):h=t[34];let k;t[35]!==i.time?(k=(0,e.jsx)("span",{className:"ml-2 whitespace-nowrap text-xs text-zinc-500",children:i.time}),t[35]=i.time,t[36]=k):k=t[36];let S;t[37]!==h||t[38]!==k?(S=(0,e.jsxs)("div",{className:"mb-0.5 flex items-center justify-between",children:[h,k]}),t[37]=h,t[38]=k,t[39]=S):S=t[39];let u;t[40]!==i.lastMessage?(u=(0,e.jsx)("p",{className:"truncate pr-2 text-sm text-zinc-500",children:i.lastMessage}),t[40]=i.lastMessage,t[41]=u):u=t[41];let E;t[42]!==i.unread?(E=i.unread>0&&(0,e.jsx)("span",{className:"flex size-5 shrink-0 items-center justify-center rounded-full bg-violet-600 text-[10px] font-bold text-white",children:i.unread}),t[42]=i.unread,t[43]=E):E=t[43];let O;t[44]!==u||t[45]!==E?(O=(0,e.jsxs)("div",{className:"flex flex-1 items-center justify-between",children:[u,E]}),t[44]=u,t[45]=E,t[46]=O):O=t[46];let L;t[47]!==S||t[48]!==O?(L=(0,e.jsxs)("div",{className:"min-w-0 flex-1",children:[S,O]}),t[47]=S,t[48]=O,t[49]=L):L=t[49];let A;return t[50]!==z||t[51]!==L||t[52]!==j||t[53]!==g?(A=(0,e.jsxs)("div",{onClick:j,className:g,children:[z,L]}),t[50]=z,t[51]=L,t[52]=j,t[53]=g,t[54]=A):A=t[54],A},Ee=({conversations:s,userResults:t=[],onSelect:i,onStartNew:b,selectedId:o,searchQuery:c,onSearchChange:d,onlineUsers:n=new Set})=>(0,e.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col bg-white dark:bg-black",children:[(0,e.jsx)("div",{className:"border-b border-zinc-100 p-4 dark:border-zinc-800",children:(0,e.jsx)(Me,{value:c,onChange:d,onClear:()=>d(""),placeholder:"Search people or messages..."})}),(0,e.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[s.length>0&&(0,e.jsx)("div",{className:"py-2",children:s.filter(a=>a.lastMessage!=="No messages yet"||a.id===o).map(a=>(0,e.jsx)(Ue,{conv:a,selectedId:o,onSelect:i,onlineUsers:n},a.id))}),t.length>0&&(0,e.jsxs)("div",{className:"border-t border-zinc-100 dark:border-zinc-800",children:[(0,e.jsx)("div",{className:"px-4 py-3 text-xs font-bold uppercase tracking-wider text-zinc-500",children:"People"}),t.map(a=>(0,e.jsxs)("div",{onClick:()=>b(a),className:"flex cursor-pointer items-center gap-3 p-4 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[(0,e.jsxs)(B,{className:"size-12",children:[(0,e.jsx)(K,{src:a.avatar,alt:a.name,className:"object-cover"}),(0,e.jsx)(F,{children:a.name?.[0]?.toUpperCase()})]}),(0,e.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,e.jsx)("div",{className:"truncate font-bold dark:text-white",children:a.name}),(0,e.jsxs)("div",{className:"truncate text-sm text-zinc-500",children:["@",a.handle]})]}),(0,e.jsx)(me,{size:18,className:"text-violet-500"})]},a.id))]}),s.length===0&&t.length===0&&c&&(0,e.jsx)("div",{className:"p-8 text-center",children:(0,e.jsxs)("p",{className:"text-sm text-zinc-500",children:['No conversations or people found for "',c,'"']})}),s.length===0&&!c&&(0,e.jsx)("div",{className:"p-8 text-center",children:(0,e.jsx)("p",{className:"text-sm text-zinc-500",children:"No messages yet. Search for people to start a chat!"})})]})]}),Oe=Ee,Le=q(),Ae=["â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ‘"],_e=s=>{const t=(0,Le.c)(6),{onSelect:i,currentReaction:b}=s;let o;t[0]===Symbol.for("react.memo_cache_sentinel")?(o=(0,e.jsx)(re,{asChild:!0,children:(0,e.jsx)("button",{className:"rounded-full p-1.5 text-zinc-400 transition-all hover:bg-zinc-100 hover:text-zinc-600 active:scale-90 dark:hover:bg-zinc-800 dark:hover:text-zinc-300",onClick:Fe,children:(0,e.jsx)(te,{size:16})})}),t[0]=o):o=t[0];let c;t[1]!==b||t[2]!==i?(c=Ae.map(n=>(0,e.jsx)("button",{onClick:()=>i(n),className:`rounded-full p-2 text-xl transition-all hover:bg-zinc-100 active:scale-125 dark:hover:bg-zinc-800 ${b===n?"bg-zinc-100 dark:bg-zinc-800":""}`,children:n},n)),t[1]=b,t[2]=i,t[3]=c):c=t[3];let d;return t[4]!==c?(d=(0,e.jsxs)(ie,{children:[o,(0,e.jsx)(se,{side:"top",align:"center",className:"w-fit border border-zinc-100 bg-white p-1 shadow-xl dark:border-zinc-800 dark:bg-zinc-900 rounded-full",onClick:Ke,children:(0,e.jsx)("div",{className:"flex items-center gap-1",children:c})})]}),t[4]=c,t[5]=d):d=t[5],d},Be=_e;function Fe(s){return s.stopPropagation()}function Ke(s){return s.stopPropagation()}var qe=q(),Qe=s=>{const t=(0,qe.c)(10),{reactions:i,currentUser:b,onToggle:o}=s;let c;t[0]!==i?(c=i===void 0?[]:i,t[0]=i,t[1]=c):c=t[1];const d=c;let n;t[2]!==b?.id||t[3]!==d?(n={},d.forEach(x=>{n[x.emoji]||(n[x.emoji]={count:0,me:!1}),n[x.emoji].count=n[x.emoji].count+1,x.user_id===b?.id&&(n[x.emoji].me=!0)}),t[2]=b?.id,t[3]=d,t[4]=n):n=t[4];const a=n;if(d.length===0)return null;let m;t[5]!==a?(m=Object.entries(a),t[5]=a,t[6]=m):m=t[6];let v;return t[7]!==o||t[8]!==m?(v=(0,e.jsx)("div",{className:"mt-1 flex flex-wrap gap-1 px-2",children:m.map(x=>{const[j,g]=x;return(0,e.jsxs)("button",{onClick:w=>{w.stopPropagation(),o(j)},className:`flex items-center gap-1.5 rounded-full border px-2 py-0.5 text-xs font-medium transition-all active:scale-90 ${g.me?"border-violet-200 bg-violet-50 text-violet-600 dark:border-violet-800 dark:bg-violet-900/30 dark:text-violet-400":"border-zinc-100 bg-white text-zinc-600 dark:border-zinc-800 dark:bg-zinc-900 dark:text-zinc-400"}`,children:[(0,e.jsx)("span",{children:j}),g.count>1&&(0,e.jsx)("span",{children:g.count})]},j)})}),t[7]=o,t[8]=m,t[9]=v):v=t[9],v},We=Qe,Je=["â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ‘"],Ve=({conversation:s,messages:t,onBack:i,onSendMessage:b,onToggleReaction:o,onDeleteMessage:c,currentUser:d,onTyping:n,isLoading:a,isTyping:m,isOnline:v})=>{const x=ee(),{openLightbox:j}=Ce(),[g,w]=(0,R.useState)(""),[P,y]=(0,R.useState)(!1),[f,N]=(0,R.useState)([]),[M,I]=(0,R.useState)(!1),[z,$]=(0,R.useState)(null),C=(0,R.useRef)(null),p=(0,R.useRef)(null),h=(0,R.useRef)(null),k=ae(s.user?.lastSeen);(0,R.useEffect)(()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)},[t,m]);const S=r=>{const l=r.target.value;w(l),n&&(n(!0),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{n(!1)},2e3))},u=r=>{w(l=>l+r.emoji)},E=r=>{r.preventDefault(),!(!g.trim()&&f.length===0)&&(n&&(h.current&&clearTimeout(h.current),n(!1)),b(s.id,g,f.length>0?"image":"text",f,z?.id),w(""),N([]),$(null))},O=async r=>{if(!r.target.files)return;const l=Array.from(r.target.files);if(l.length!==0){y(!0);try{const T=await Promise.all(l.map(U=>ye(U)));N(U=>[...U,...T])}catch(T){console.error("Upload failed:",T)}finally{y(!1)}}},L=r=>{N(l=>l.filter(T=>T.url!==r))},A=r=>{!r.media||r.media.length===0||j(r.media.map(l=>l.url),0)},Q=(0,R.useMemo)(()=>{const r=t.filter(l=>l.sender==="me");return r.length>0?r[r.length-1].id:null},[t]),Y=r=>t.find(l=>l.id===r);return(0,e.jsxs)("div",{className:"flex h-full min-w-0 flex-1 flex-col bg-white dark:bg-black md:border-l md:border-zinc-100 dark:md:border-zinc-800",children:[(0,e.jsxs)("div",{className:"sticky top-0 z-10 flex shrink-0 items-center justify-between border-b border-zinc-100 bg-white/80 p-4 backdrop-blur-md dark:border-zinc-800 dark:bg-black/80",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)("button",{onClick:i,className:"rounded-full p-1 transition-colors hover:bg-zinc-100 dark:text-white dark:hover:bg-zinc-800 md:hidden",children:(0,e.jsx)(pe,{size:20})}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsxs)(B,{className:"size-10 border border-zinc-200 dark:border-zinc-700",children:[(0,e.jsx)(K,{src:s.user.avatar,alt:s.user.name,className:"object-cover"}),(0,e.jsx)(F,{children:s.user.name?.[0]?.toUpperCase()})]}),v&&(0,e.jsx)("span",{className:"absolute bottom-0 right-0 size-3 rounded-full border-2 border-white bg-emerald-500 dark:border-black"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"font-bold dark:text-white",children:s.user.name}),v?(0,e.jsxs)("div",{className:"flex items-center gap-1 text-xs font-medium text-emerald-500",children:[(0,e.jsx)("span",{className:"size-1.5 animate-pulse rounded-full bg-emerald-500"}),"Online"]}):(0,e.jsx)("div",{className:"text-xs font-medium text-zinc-500",children:s.user.lastSeen?`Last seen ${k}`:"Offline"})]})]}),(0,e.jsx)("button",{className:"rounded-full p-2 hover:bg-zinc-100 dark:text-zinc-400 dark:hover:bg-zinc-800",children:(0,e.jsx)(he,{size:20})})]}),(0,e.jsxs)("div",{className:"flex-1 space-y-4 overflow-y-auto p-4",ref:p,children:[(0,e.jsxs)("div",{className:"py-8 text-center",children:[(0,e.jsxs)("div",{className:"relative mx-auto w-fit",children:[(0,e.jsxs)(B,{className:"mx-auto mb-3 size-20 border-4 border-zinc-50 shadow-sm dark:border-zinc-900",children:[(0,e.jsx)(K,{src:s.user.avatar,alt:s.user.name,className:"object-cover"}),(0,e.jsx)(F,{className:"text-2xl font-bold",children:s.user.name?.[0]?.toUpperCase()})]}),v&&(0,e.jsx)("span",{className:"absolute bottom-4 right-1 size-5 animate-in zoom-in rounded-full border-4 border-white bg-emerald-500 duration-300 dark:border-black"})]}),(0,e.jsx)("h4",{className:"text-lg font-bold dark:text-white",children:s.user.name}),(0,e.jsxs)("p",{className:"text-sm text-zinc-500",children:["@",s.user.handle]}),(0,e.jsxs)("p",{className:"mx-auto mt-4 max-w-xs text-xs text-zinc-400",children:["This is the beginning of your direct message history with"," ",(0,e.jsxs)("span",{className:"font-bold",children:["@",s.user.handle]})]})]}),a&&t.length===0?(0,e.jsx)("div",{className:"flex justify-center p-8",children:(0,e.jsx)(V,{className:"animate-spin text-violet-500",size:32})}):t.map(r=>(0,e.jsxs)(ze,{children:[(0,e.jsx)(we,{asChild:!0,children:(0,e.jsxs)("div",{id:`msg-${r.id}`,className:`group flex items-end gap-2 ${r.sender==="me"?"flex-row-reverse":"flex-row"}`,children:[(0,e.jsxs)("div",{className:`relative max-w-[75%] rounded-2xl p-1 text-[15px] shadow-sm ${r.sender==="me"?"rounded-tr-none bg-violet-600 text-white":"rounded-tl-none bg-zinc-100 dark:bg-zinc-800 dark:text-white"}`,children:[r.replyToId&&(0,e.jsxs)("div",{className:`mb-2 cursor-pointer truncate rounded-lg border-l-4 p-2 text-xs ${r.sender==="me"?"border-violet-300 bg-violet-500/50 text-violet-100":"border-zinc-400 bg-zinc-200/50 text-zinc-600 dark:border-zinc-500 dark:bg-zinc-700/50 dark:text-zinc-300"}`,onClick:l=>{l.stopPropagation(),document.getElementById(`msg-${r.replyToId}`)?.scrollIntoView({behavior:"smooth",block:"center"})},children:[(0,e.jsx)("span",{className:"mb-0.5 block font-bold",children:Y(r.replyToId)?.sender==="me"?"You":s.user.name}),Y(r.replyToId)?.text||"Media"]}),r.media?.length>0&&(0,e.jsx)("div",{className:"mb-2 grid cursor-pointer grid-cols-1 gap-1 overflow-hidden rounded-lg",onClick:()=>A(r),children:r.media.map((l,T)=>(0,e.jsx)("img",{src:l.url,alt:"",className:"max-h-60 w-full rounded-md object-cover transition-all hover:brightness-90"},T))}),r.text&&(0,e.jsx)("div",{className:"m-0 break-words whitespace-pre-line px-3 py-1 leading-tight",children:(0,e.jsx)($e,{options:{...Te,render:({attributes:l,content:T})=>{const{href:U,...D}=l,X=window.location.origin;let _=null;return U.startsWith("/")?_=U:U.startsWith(X)&&(_=U.replace(X,"")),_?(0,e.jsx)("span",{...D,className:`cursor-pointer break-all font-semibold underline decoration-1 underline-offset-4 transition-opacity ${r.sender==="me"?"text-white":"text-violet-600 dark:text-violet-400"}`,onClick:W=>{W.stopPropagation(),x(_)},children:T},T):(0,e.jsx)("a",{href:U,...D,className:`break-all underline decoration-1 underline-offset-4 transition-opacity hover:opacity-80 ${r.sender==="me"?"text-white":"text-violet-600 dark:text-violet-400"}`,target:"_blank",rel:"noopener noreferrer",onClick:W=>W.stopPropagation(),children:T},T)}},children:r.text})}),r.reactions?.length>0&&(0,e.jsx)(We,{reactions:r.reactions,currentUser:d,onToggle:l=>o(r.id,l)}),(0,e.jsxs)("div",{className:`flex items-center justify-end gap-1 px-3 pb-1 text-[10px] ${r.sender==="me"?"text-violet-200":"text-zinc-400"}`,children:[r.time,r.sender==="me"&&r.id===Q&&(0,e.jsx)("span",{className:"ml-0.5",children:r.isRead?(0,e.jsx)(xe,{size:14,className:"text-white"}):(0,e.jsx)(de,{size:14,className:"text-violet-200"})})]})]}),(0,e.jsx)("div",{className:"opacity-0 transition-opacity group-hover:opacity-100",children:(0,e.jsx)(Be,{onSelect:l=>o(r.id,l),currentReaction:r.reactions?.find(l=>l.user_id===d?.id)?.emoji})})]})}),(0,e.jsxs)(Ie,{className:"w-64 rounded-xl border-zinc-100 bg-white shadow-xl dark:border-zinc-800 dark:bg-zinc-950",children:[(0,e.jsx)(Ne,{className:"px-3 py-2 text-xs font-bold text-zinc-500",children:"QUICK REACTION"}),(0,e.jsx)("div",{className:"flex items-center justify-between px-2 pb-2",children:Je.map(l=>(0,e.jsx)("button",{onClick:()=>o(r.id,l),className:"rounded-full p-2 text-xl transition-all hover:bg-zinc-100 active:scale-125 dark:hover:bg-zinc-800",children:l},l))}),(0,e.jsx)(G,{className:"bg-zinc-100 dark:bg-zinc-800"}),(0,e.jsxs)(J,{className:"cursor-pointer gap-3 px-3 py-2.5 focus:bg-zinc-50 dark:focus:bg-zinc-900",onClick:()=>{navigator.clipboard.writeText(r.text)},children:[(0,e.jsx)(oe,{size:16,className:"text-zinc-500"}),(0,e.jsx)("span",{className:"font-medium",children:"Copy Text"})]}),(0,e.jsxs)(J,{className:"cursor-pointer gap-3 px-3 py-2.5 focus:bg-zinc-50 dark:focus:bg-zinc-900",onClick:()=>$(r),children:[(0,e.jsx)(be,{size:16,className:"text-zinc-500"}),(0,e.jsx)("span",{className:"font-medium",children:"Reply"})]}),(0,e.jsx)(G,{className:"bg-zinc-100 dark:bg-zinc-800"}),(0,e.jsxs)(J,{className:"cursor-pointer gap-3 px-3 py-2.5 text-rose-500 focus:bg-rose-50 focus:text-rose-500 dark:focus:bg-rose-900/20",onClick:()=>c&&c(r.id),children:[(0,e.jsx)(ce,{size:16}),(0,e.jsx)("span",{className:"font-medium",children:"Delete message"})]})]})]},r.id)),m&&(0,e.jsx)("div",{className:"flex animate-in fade-in slide-in-from-bottom-2 justify-start duration-300",children:(0,e.jsx)("div",{className:"rounded-2xl rounded-tl-none border border-zinc-200/50 bg-zinc-100 px-3 py-2 shadow-sm dark:border-zinc-700/30 dark:bg-zinc-800/50",children:(0,e.jsx)(Se,{})})})]}),(0,e.jsxs)("div",{className:"shrink-0 border-t border-zinc-100 bg-white p-4 dark:border-zinc-800 dark:bg-black",children:[z&&(0,e.jsxs)("div",{className:"mb-3 flex animate-in slide-in-from-bottom-2 items-center justify-between rounded-xl border border-zinc-100 bg-zinc-50 p-3 duration-200 dark:border-zinc-800 dark:bg-zinc-900",children:[(0,e.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,e.jsxs)("span",{className:"mb-1 block text-xs font-bold text-violet-600 dark:text-violet-400",children:["Replying to"," ",z.sender==="me"?"yourself":s.user.name]}),(0,e.jsx)("p",{className:"truncate text-sm text-zinc-500",children:z.text||"Media"})]}),(0,e.jsx)("button",{onClick:()=>$(null),className:"rounded-full p-1 text-zinc-400 transition-colors hover:bg-zinc-200 dark:hover:bg-zinc-800",children:(0,e.jsx)(Z,{size:18})})]}),f.length>0&&(0,e.jsxs)("div",{className:"mb-3 flex flex-wrap gap-2",children:[f.map(r=>(0,e.jsxs)("div",{className:"relative size-16 overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[(0,e.jsx)("img",{src:r.url,className:"size-full object-cover",alt:""}),(0,e.jsx)("button",{type:"button",onClick:()=>L(r.url),className:"absolute right-1 top-1 rounded-full bg-black/50 p-0.5 text-white transition-colors hover:bg-black",children:(0,e.jsx)(Z,{size:12})})]},r.url)),P&&(0,e.jsx)("div",{className:"flex size-16 items-center justify-center rounded-xl bg-zinc-100 dark:bg-zinc-900",children:(0,e.jsx)(V,{className:"animate-spin text-violet-500",size:20})})]}),(0,e.jsxs)("form",{onSubmit:E,className:"flex items-center gap-2 rounded-2xl border border-transparent bg-zinc-100 p-2 transition-all focus-within:border-violet-500 dark:bg-zinc-900",children:[(0,e.jsxs)(ie,{open:M,onOpenChange:I,children:[(0,e.jsx)(re,{asChild:!0,children:(0,e.jsx)("button",{type:"button",className:"p-2 text-zinc-500 transition-colors hover:text-violet-600",children:(0,e.jsx)(te,{size:20})})}),(0,e.jsx)(se,{className:"w-fit border-none bg-transparent p-0 shadow-none",side:"top",align:"start",sideOffset:10,children:(0,e.jsx)(ve,{onEmojiSelect:r=>{u(r)}})})]}),(0,e.jsx)("input",{type:"text",className:"min-w-0 flex-1 border-none bg-transparent px-1 py-1 outline-none dark:text-white",placeholder:"Start a new message",value:g,onChange:S}),(0,e.jsx)("input",{type:"file",ref:C,onChange:O,className:"hidden",multiple:!0,accept:"image/*"}),(0,e.jsx)("button",{type:"button",onClick:()=>C.current?.click(),className:"p-2 text-zinc-500 transition-colors hover:text-violet-600",disabled:P,children:(0,e.jsx)(fe,{size:20})}),(0,e.jsx)(ke,{type:"submit",className:"size-10 rounded-xl !p-0",disabled:!g.trim()&&f.length===0||P,children:(0,e.jsx)(ue,{size:18})})]})]})]})},Ye=Ve,De=q(),Xe=()=>{const s=(0,De.c)(30),{id:t,currentUser:i,onlineUsers:b,msgSearchQuery:o,setMsgSearchQuery:c,userSearchResults:d,filteredConversations:n,selectedConversation:a,localMessages:m,isConvLoading:v,isMsgLoading:x,currentIsTyping:j,otherUserIsOnline:g,handleStartConversation:w,handleSelectConversation:P,sendMessage:y,sendTypingStatus:f,onToggleReaction:N,navigate:M}=Pe();if(!i){let u;return s[0]===Symbol.for("react.memo_cache_sentinel")?(u=(0,e.jsxs)("div",{className:"flex h-screen flex-col items-center justify-center gap-4 border-zinc-100 bg-white p-8 text-center dark:border-zinc-800 dark:bg-black md:rounded-xl md:border",children:[(0,e.jsx)("div",{className:"rounded-full bg-zinc-100 p-4 dark:bg-zinc-900",children:(0,e.jsx)(je,{size:40,className:"text-zinc-400"})}),(0,e.jsx)("h3",{className:"text-xl font-bold dark:text-white",children:"Sign in to message others"}),(0,e.jsx)("p",{className:"max-w-xs text-zinc-500",children:"Start decentralized conversations with anyone on the network."})]}),s[0]=u):u=s[0],u}if(v){let u;return s[1]===Symbol.for("react.memo_cache_sentinel")?(u=(0,e.jsx)("div",{className:"flex h-screen items-center justify-center border-zinc-100 bg-white dark:border-zinc-800 dark:bg-black md:rounded-xl md:border",children:(0,e.jsx)(V,{className:"animate-spin text-violet-500",size:32})}),s[1]=u):u=s[1],u}const I=`flex ${t?"h-[100dvh]":"h-[calc(100dvh-4rem)]"} overflow-hidden border-zinc-100 bg-white dark:border-zinc-800 dark:bg-black md:h-[calc(100vh-2rem)] md:rounded-xl md:border`,z=`w-full flex-col border-r border-zinc-100 dark:border-zinc-800 md:flex md:w-80 ${a?"hidden":"flex"}`;let $;s[2]===Symbol.for("react.memo_cache_sentinel")?($=(0,e.jsx)("div",{className:"border-b border-zinc-100 p-4 dark:border-zinc-800",children:(0,e.jsx)("h2",{className:"text-xl font-bold dark:text-white",children:"Messages"})}),s[2]=$):$=s[2];const C=t??null;let p;s[3]!==n||s[4]!==P||s[5]!==w||s[6]!==o||s[7]!==b||s[8]!==c||s[9]!==C||s[10]!==d?(p=(0,e.jsx)(Oe,{conversations:n,userResults:d,onSelect:P,onStartNew:w,selectedId:C,searchQuery:o,onSearchChange:c,onlineUsers:b}),s[3]=n,s[4]=P,s[5]=w,s[6]=o,s[7]=b,s[8]=c,s[9]=C,s[10]=d,s[11]=p):p=s[11];let h;s[12]!==z||s[13]!==p?(h=(0,e.jsxs)("div",{className:z,children:[$,p]}),s[12]=z,s[13]=p,s[14]=h):h=s[14];let k;s[15]!==j||s[16]!==i||s[17]!==x||s[18]!==m||s[19]!==M||s[20]!==N||s[21]!==g||s[22]!==a||s[23]!==y||s[24]!==f?(k=a?(0,e.jsx)(Ye,{conversation:a,messages:m,onBack:()=>M("/messages"),onSendMessage:y,onToggleReaction:N,currentUser:i,onTyping:u=>f(a.id,u),isLoading:x,isTyping:!!j,isOnline:!!g}):(0,e.jsxs)("div",{className:"hidden flex-1 flex-col items-center justify-center gap-4 text-zinc-500 md:flex",children:[(0,e.jsx)("div",{className:"rounded-full bg-zinc-50 p-6 dark:bg-zinc-900",children:(0,e.jsx)(ge,{size:48,className:"text-zinc-300"})}),(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:"Select a message"}),(0,e.jsx)("p",{children:"Choose from your existing conversations or start a new one."})]})]}),s[15]=j,s[16]=i,s[17]=x,s[18]=m,s[19]=M,s[20]=N,s[21]=g,s[22]=a,s[23]=y,s[24]=f,s[25]=k):k=s[25];let S;return s[26]!==I||s[27]!==h||s[28]!==k?(S=(0,e.jsxs)("div",{className:I,children:[h,k]}),s[26]=I,s[27]=h,s[28]=k,s[29]=S):S=s[29],S},it=Xe;export{it as default};
