import{a as I}from"./rolldown-runtime-BaZ8gS7u.js";import{l as O,v as T,w as M}from"./framework-pz3E8ggb.js";import"./database-OCX2jLsI.js";import{Ft as B,In as $,Vn as q,ar as G,lr as S,tn as J,xn as K}from"./ui-libs-DAoIcasR.js";import"./media-libs-_YS1-DNr.js";import{$t as Q,Pn as _,Qt as V,Zt as Y,a as Z,dn as H,ln as X,tn as F,vt as w}from"./index-yyPWUcfF.js";import{t as ee}from"./useAutoResizeTextArea-DpECpPFe.js";import{t as te}from"./CircularProgress-rtgGP6xS.js";var a=I(M(),1),e=I(O(),1),se=()=>{const u=T(),{currentUser:r,updateProfile:L}=H(),{addToast:h}=X(),l=r?.id?`edit-profile-draft:${r.id}`:null,[D,z]=(0,a.useState)(!1),[s,d]=(0,a.useState)(r||{}),[x,y]=(0,a.useState)(null),[o,k]=(0,a.useState)(null),C=(0,a.useRef)(null),R=(0,a.useRef)(null),v=(0,a.useRef)(!1),b=(0,a.useRef)(!1),E=ee(s?.bio||"",80,300),m=(0,a.useMemo)(()=>o?URL.createObjectURL(o):null,[o]),p=(0,a.useMemo)(()=>x?URL.createObjectURL(x):null,[x]);(0,a.useEffect)(()=>()=>{m&&URL.revokeObjectURL(m)},[m]),(0,a.useEffect)(()=>()=>{p&&URL.revokeObjectURL(p)},[p]);const f=t=>{b.current=!0,d(t)};(0,a.useEffect)(()=>{if(!(!r||v.current)){if(l){const t=sessionStorage.getItem(l);if(t)try{const i=JSON.parse(t);d({...r,...i}),b.current=!0}catch(i){console.error("Failed to restore edit profile draft",i),sessionStorage.removeItem(l),d(r)}else d(r)}else d(r);v.current=!0}},[r,l]),(0,a.useEffect)(()=>{if(!l||!v.current)return;const t={name:s?.name||"",bio:s?.bio||"",location:s?.location||"",website:s?.website||""};if(!t.name?.trim()&&!t.bio?.trim()&&!t.location?.trim()&&!t.website?.trim()){sessionStorage.removeItem(l);return}sessionStorage.setItem(l,JSON.stringify(t))},[l,s?.bio,s?.location,s?.name,s?.website]);const P=(t,i)=>{const n=t.target.files?.[0];if(n){if(n.type==="image/gif"&&!r?.isPro){h("GIF profile pictures are only available for PRO users!","error");return}i==="avatar"?y(n):k(n)}},W=async()=>{z(!0);try{let t=s.avatar,i=s.cover;x&&(t=(await _(x)).url),o&&(i=(await _(o)).url);const g=(j=>{if(!j)return j;const c=j.trim();if(!c)return c;try{const N=new URL(/^https?:\/\//i.test(c)?c:`https://${c}`);return N.hostname.replace(/^www\./i,"")+(N.pathname==="/"?"":N.pathname)}catch{return c.replace(/^https?:\/\//i,"").replace(/^www\./i,"")}})(s?.website);await L({...s,avatar:t,cover:i,website:g}),l&&sessionStorage.removeItem(l),b.current=!1,y(null),k(null),h("Profile updated!"),u(-1)}catch(t){console.error("Failed to update profile:",t),h("Failed to update profile.","error")}finally{z(!1)}},U=(t=>(t||"").trim().split(/\s+/).filter(Boolean).length)(s?.bio),A=U>=50;return r?(0,e.jsx)(Z,{children:(0,e.jsxs)("div",{className:"flex min-h-screen flex-col border-zinc-100 bg-white dark:border-zinc-800 dark:bg-black md:rounded-xl md:border",children:[(0,e.jsx)("div",{className:"sticky top-0 z-10 border-b border-zinc-100 bg-white/80 p-4 backdrop-blur-md dark:border-zinc-800 dark:bg-black/80",children:(0,e.jsxs)("div",{className:"flex items-center gap-4",children:[(0,e.jsx)("button",{onClick:()=>u(-1),className:"rounded-full p-2 transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,e.jsx)(G,{size:24})}),(0,e.jsx)("h2",{className:"text-xl font-bold dark:text-white",children:"Edit Profile"})]})}),(0,e.jsxs)("div",{className:"mx-auto mt-4 w-full max-w-2xl space-y-8 p-4 pb-24",children:[(0,e.jsx)("input",{type:"file",ref:R,className:"hidden",accept:"image/*",onChange:t=>P(t,"cover")}),(0,e.jsx)("input",{type:"file",ref:C,className:"hidden",accept:"image/*",onChange:t=>P(t,"avatar")}),(0,e.jsxs)("section",{className:"space-y-4",children:[(0,e.jsx)("h3",{className:"px-2 text-sm font-bold uppercase tracking-wider text-zinc-500",children:"Media"}),(0,e.jsxs)("div",{className:"overflow-hidden rounded-2xl bg-zinc-50 dark:bg-zinc-900",children:[(0,e.jsxs)("div",{className:"group relative h-40 cursor-pointer overflow-hidden bg-zinc-100 dark:bg-zinc-800",onClick:()=>R.current?.click(),children:[(o||s?.cover)&&(0,e.jsx)("img",{src:m??s.cover,className:"h-full w-full object-cover opacity-80 transition-opacity group-hover:opacity-60",alt:""}),(0,e.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 opacity-0 transition-opacity group-hover:opacity-100",children:(0,e.jsxs)("div",{className:"flex flex-col items-center gap-1 text-white",children:[(0,e.jsx)(S,{size:24}),(0,e.jsx)("span",{className:"text-xs font-bold uppercase",children:"Change Cover"})]})})]}),(0,e.jsxs)("div",{className:"flex items-center gap-6 p-4",children:[(0,e.jsxs)("div",{className:"group relative size-24 cursor-pointer overflow-hidden rounded-full ring-4 ring-white shadow-lg dark:ring-zinc-800",onClick:()=>C.current?.click(),children:[(0,e.jsxs)(Y,{className:"size-full rounded-none",children:[(0,e.jsx)(Q,{src:p??s.avatar,className:"object-cover transition-opacity group-hover:opacity-60"}),(0,e.jsx)(V,{children:s?.handle?.[0]?.toUpperCase()})]}),(0,e.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 opacity-0 transition-opacity group-hover:opacity-100",children:(0,e.jsx)(S,{size:20,className:"text-white"})})]}),(0,e.jsxs)("div",{className:"flex-1",children:[(0,e.jsx)("p",{className:"text-sm font-bold dark:text-zinc-200",children:"Profile Picture"}),(0,e.jsx)("p",{className:"text-xs text-zinc-500",children:"Recommended size: 400x400px"})]})]})]})]}),(0,e.jsxs)("section",{className:"space-y-4",children:[(0,e.jsx)("h3",{className:"px-2 text-sm font-bold uppercase tracking-wider text-zinc-500",children:"Basic Info"}),(0,e.jsxs)("div",{className:"divide-y divide-zinc-200 overflow-hidden rounded-2xl bg-zinc-50 dark:divide-zinc-800 dark:bg-zinc-900",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-2 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-zinc-500",children:[(0,e.jsx)(B,{size:16}),(0,e.jsx)("label",{className:"text-xs font-bold uppercase tracking-tight",children:"Display Name"})]}),(0,e.jsx)(w,{value:s?.name||"",className:"h-auto bg-transparent p-0 text-base font-medium placeholder:text-zinc-400 focus-visible:ring-0 dark:text-zinc-100 shadow-none",onChange:t=>f({...s,name:t.target.value})})]}),(0,e.jsxs)("div",{className:"flex flex-col gap-2 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-zinc-500",children:[(0,e.jsx)(q,{size:16}),(0,e.jsx)("label",{className:"text-xs font-bold uppercase tracking-tight",children:"Bio"})]}),(0,e.jsx)(te,{current:U,max:60,size:20,strokeWidth:3,isWarning:A})]}),(0,e.jsx)("textarea",{ref:E,value:s?.bio||"",className:"min-h-[80px] max-h-[400px] w-full bg-transparent p-0 text-base font-medium resize-none placeholder:text-zinc-400 focus-visible:ring-0 dark:text-zinc-100 shadow-none outline-none",placeholder:"Tell others about yourself...",onChange:t=>{const i=t.target.value,n=i.trim().split(/\s+/).filter(Boolean);if(n.length>60){const g=n.slice(0,60).join(" ");f({...s,bio:g})}else f({...s,bio:i})}})]})]})]}),(0,e.jsxs)("section",{className:"space-y-4",children:[(0,e.jsx)("h3",{className:"px-2 text-sm font-bold uppercase tracking-wider text-zinc-500",children:"Public Details"}),(0,e.jsxs)("div",{className:"divide-y divide-zinc-200 overflow-hidden rounded-2xl bg-zinc-50 dark:divide-zinc-800 dark:bg-zinc-900",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-2 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-zinc-500",children:[(0,e.jsx)(K,{size:16}),(0,e.jsx)("label",{className:"text-xs font-bold uppercase tracking-tight",children:"Location"})]}),(0,e.jsx)(w,{placeholder:"Where are you based?",value:s?.location||"",className:"h-auto bg-transparent p-0 text-base font-medium placeholder:text-zinc-400 focus-visible:ring-0 dark:text-zinc-100 shadow-none",onChange:t=>f({...s,location:t.target.value})})]}),(0,e.jsxs)("div",{className:"flex flex-col gap-2 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-zinc-500",children:[(0,e.jsx)($,{size:16}),(0,e.jsx)("label",{className:"text-xs font-bold uppercase tracking-tight",children:"Website"})]}),(0,e.jsx)(w,{placeholder:"yoursite.com",value:s?.website||"",className:"h-auto bg-transparent p-0 text-base font-medium placeholder:text-zinc-400 focus-visible:ring-0 dark:text-zinc-100 shadow-none",onChange:t=>f({...s,website:t.target.value})})]})]})]}),(0,e.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,e.jsx)(F,{variant:"secondary",className:"flex-1 rounded-2xl p-4 font-bold",onClick:()=>u(-1),children:"Cancel"}),(0,e.jsxs)(F,{className:"flex-1 rounded-2xl p-4 font-bold bg-violet-600 hover:bg-violet-700 text-white",onClick:W,loading:D,children:[(0,e.jsx)(J,{size:18,className:"mr-2"}),"Save Changes"]})]}),(0,e.jsx)("div",{className:"py-10 text-center text-xs text-zinc-400",children:"Your profile changes will be visible to everyone on MySys."})]})]})}):(u("/login"),null)},fe=se;export{fe as default};
