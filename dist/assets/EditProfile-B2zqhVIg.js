import{s as _}from"./rolldown-runtime-C0YIJfRR.js";import{T as A,u as O,y as M}from"./framework-ZbZgMru0.js";import"./database-COznt_u0.js";import{Dn as T,Pt as B,Rn as G,Sn as q,Wn as J,dr as F,sr as $,tn as K}from"./ui-libs-DXmn9bAF.js";import"./media-libs-B7hMDJJu.js";import{Fn as L,Ln as H,a as Q,an as V,fn as X,in as Y,rn as Z,un as ee,yt as k}from"./index-BzPGmvOw.js";import{t as te}from"./useAutoResizeTextArea-D6pMbSDF.js";import{t as re}from"./CircularProgress-BaQTkJcS.js";var s=_(A(),1),e=_(O(),1),se=()=>{const d=M(),{currentUser:a,updateProfile:D}=X(),{addToast:b}=ee(),i=a?.id?`edit-profile-draft:${a.id}`:null,[u,C]=(0,s.useState)(!1),[r,f]=(0,s.useState)(a||{}),[m,P]=(0,s.useState)(null),[l,R]=(0,s.useState)(null),g=(0,s.useRef)(null),z=(0,s.useRef)(null),v=(0,s.useRef)(!1),j=(0,s.useRef)(!1),I=te(r?.bio||"",80,300),p=(0,s.useMemo)(()=>l?URL.createObjectURL(l):null,[l]),h=(0,s.useMemo)(()=>m?URL.createObjectURL(m):null,[m]);(0,s.useEffect)(()=>()=>{p&&URL.revokeObjectURL(p)},[p]),(0,s.useEffect)(()=>()=>{h&&URL.revokeObjectURL(h)},[h]);const x=t=>{j.current=!0,f(t)};(0,s.useEffect)(()=>{if(!(!a||v.current)){if(i){const t=sessionStorage.getItem(i);if(t)try{const o=JSON.parse(t);f({...a,...o}),j.current=!0}catch(o){console.error("Failed to restore edit profile draft",o),sessionStorage.removeItem(i),f(a)}else f(a)}else f(a);v.current=!0}},[a,i]),(0,s.useEffect)(()=>{if(!i||!v.current)return;const t={name:r?.name||"",bio:r?.bio||"",location:r?.location||"",website:r?.website||""};if(!t.name?.trim()&&!t.bio?.trim()&&!t.location?.trim()&&!t.website?.trim()){sessionStorage.removeItem(i);return}sessionStorage.setItem(i,JSON.stringify(t))},[i,r?.bio,r?.location,r?.name,r?.website]);const S=(t,o)=>{const n=t.target.files?.[0];if(n){if(n.type==="image/gif"&&!a?.isPro){b("GIF profile pictures are only available for PRO users!","error");return}o==="avatar"?P(n):R(n)}},U=async()=>{C(!0);try{let t=r.avatar,o=r.cover;m&&(t=(await L(m)).url),l&&(o=(await L(l)).url);const N=(w=>{if(!w)return w;const c=w.trim();if(!c)return c;try{const y=new URL(/^https?:\/\//i.test(c)?c:`https://${c}`);return y.hostname.replace(/^www\./i,"")+(y.pathname==="/"?"":y.pathname)}catch{return c.replace(/^https?:\/\//i,"").replace(/^www\./i,"")}})(r?.website);await D({...r,avatar:t,cover:o,website:N}),i&&sessionStorage.removeItem(i),j.current=!1,P(null),R(null),b("Profile updated!"),d(-1)}catch(t){console.error("Failed to update profile:",t),b("Failed to update profile.","error")}finally{C(!1)}},W=(t=>(t||"").trim().split(/\s+/).filter(Boolean).length)(r?.bio),E=W>=50;return(0,s.useEffect)(()=>{a||d("/login")},[a,d]),a?(0,e.jsx)(Q,{children:(0,e.jsxs)("div",{className:"flex min-h-screen flex-col bg-muted/30 md:rounded-2xl md:border md:border-border",children:[(0,e.jsxs)("div",{className:"sticky top-0 z-20 flex items-center justify-between border-b border-border bg-background/80 px-6 py-4 backdrop-blur-xl",children:[(0,e.jsxs)("div",{className:"flex items-center gap-4",children:[(0,e.jsx)("button",{onClick:()=>d(-1),className:"flex size-9 items-center justify-center rounded-full transition-all active:scale-90 active:bg-accent",children:(0,e.jsx)($,{size:24,strokeWidth:2.5,className:"text-foreground"})}),(0,e.jsx)("h2",{className:"text-[20px] font-black tracking-tight text-foreground",children:"Edit Profile"})]}),(0,e.jsx)("button",{onClick:U,disabled:u,className:H("text-[16px] font-bold text-primary transition-all active:scale-95 disabled:opacity-50",u&&"animate-pulse"),children:u?"Saving...":"Done"})]}),(0,e.jsxs)("div",{className:"mx-auto w-full max-w-2xl space-y-8 p-4 pb-32",children:[(0,e.jsx)("input",{type:"file",ref:z,className:"hidden",accept:"image/*",onChange:t=>S(t,"cover")}),(0,e.jsx)("input",{type:"file",ref:g,className:"hidden",accept:"image/*",onChange:t=>S(t,"avatar")}),(0,e.jsxs)("section",{className:"space-y-2",children:[(0,e.jsx)("h3",{className:"px-4 text-[12px] font-bold uppercase tracking-widest text-muted-foreground",children:"Profile Media"}),(0,e.jsxs)("div",{className:"overflow-hidden rounded-[20px] border border-border bg-card shadow-sm",children:[(0,e.jsxs)("div",{className:"group relative h-44 cursor-pointer overflow-hidden bg-muted/50 transition-colors hover:bg-muted",onClick:()=>z.current?.click(),children:[(l||r?.cover)&&(0,e.jsx)("img",{src:p??r.cover,className:"h-full w-full object-cover transition-opacity group-hover:opacity-90",alt:""}),(0,e.jsx)("div",{className:"absolute bottom-3 right-3 z-10",children:(0,e.jsx)("div",{className:"rounded-full bg-black/20 p-2 text-white/90 backdrop-blur-md transition-all active:scale-90 active:bg-black/40 shadow-sm border border-white/10",children:(0,e.jsx)(F,{size:18,strokeWidth:2})})})]}),(0,e.jsxs)("div",{className:"flex items-center gap-4 border-t border-border p-4",children:[(0,e.jsxs)("div",{className:"group relative size-20 shrink-0 cursor-pointer overflow-hidden rounded-full ring-2 ring-background shadow-md",onClick:()=>g.current?.click(),children:[(0,e.jsxs)(Z,{className:"size-full rounded-none",children:[(0,e.jsx)(V,{src:h??r.avatar,className:"object-cover transition-opacity group-hover:opacity-80"}),(0,e.jsx)(Y,{className:"bg-muted text-xl font-bold text-muted-foreground",children:r?.handle?.[0]?.toUpperCase()})]}),(0,e.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 opacity-0 transition-opacity group-hover:opacity-100",children:(0,e.jsx)(F,{size:18,className:"text-white"})})]}),(0,e.jsxs)("div",{className:"flex-1",children:[(0,e.jsx)("h4",{className:"text-[15px] font-bold text-foreground",children:"Profile Picture"}),(0,e.jsx)("p",{className:"text-[12px] font-medium text-muted-foreground",children:"GIFs enabled for PRO users"}),(0,e.jsx)("button",{onClick:()=>g.current?.click(),className:"mt-1 text-[13px] font-bold text-primary active:opacity-60",children:"Change Photo"})]})]})]})]}),(0,e.jsxs)("section",{className:"space-y-2",children:[(0,e.jsx)("h3",{className:"px-4 text-[12px] font-bold uppercase tracking-widest text-muted-foreground",children:"Personal Information"}),(0,e.jsxs)("div",{className:"divide-y divide-border overflow-hidden rounded-[20px] border border-border bg-card shadow-sm",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-1 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,e.jsx)(B,{size:14,strokeWidth:2.5,className:"text-muted-foreground/70"}),(0,e.jsx)("label",{className:"text-[11px] font-bold uppercase tracking-widest",children:"Name"})]}),(0,e.jsx)(k,{value:r?.name||"",className:"h-auto border-none bg-transparent p-0 text-[16px] font-medium text-foreground shadow-none focus-visible:ring-0",onChange:t=>x({...r,name:t.target.value})})]}),(0,e.jsxs)("div",{className:"flex flex-col gap-1 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,e.jsx)(J,{size:14,strokeWidth:2.5,className:"text-muted-foreground/70"}),(0,e.jsx)("label",{className:"text-[11px] font-bold uppercase tracking-widest",children:"Bio"})]}),(0,e.jsx)(re,{current:W,max:60,size:16,strokeWidth:3,isWarning:E})]}),(0,e.jsx)("textarea",{ref:I,value:r?.bio||"",className:"min-h-[60px] max-h-[400px] w-full resize-none border-none bg-transparent p-0 text-[16px] font-medium text-foreground outline-none shadow-none focus-visible:ring-0",placeholder:"Bio...",onChange:t=>{const o=t.target.value,n=o.trim().split(/\s+/).filter(Boolean);if(n.length>60){const N=n.slice(0,60).join(" ");x({...r,bio:N})}else x({...r,bio:o})}})]})]})]}),(0,e.jsxs)("section",{className:"space-y-2",children:[(0,e.jsx)("h3",{className:"px-4 text-[12px] font-bold uppercase tracking-widest text-muted-foreground",children:"Public Details"}),(0,e.jsxs)("div",{className:"divide-y divide-border overflow-hidden rounded-[20px] border border-border bg-card shadow-sm",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-1 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,e.jsx)(q,{size:14,strokeWidth:2.5,className:"text-muted-foreground/70"}),(0,e.jsx)("label",{className:"text-[11px] font-bold uppercase tracking-widest",children:"Location"})]}),(0,e.jsx)(k,{placeholder:"Based in...",value:r?.location||"",className:"h-auto border-none bg-transparent p-0 text-[16px] font-medium text-foreground shadow-none focus-visible:ring-0",onChange:t=>x({...r,location:t.target.value})})]}),(0,e.jsxs)("div",{className:"flex flex-col gap-1 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,e.jsx)(G,{size:14,strokeWidth:2.5,className:"text-muted-foreground/70"}),(0,e.jsx)("label",{className:"text-[11px] font-bold uppercase tracking-widest",children:"Website"})]}),(0,e.jsx)(k,{placeholder:"yoursite.com",value:r?.website||"",className:"h-auto border-none bg-transparent p-0 text-[16px] font-medium text-foreground shadow-none focus-visible:ring-0",onChange:t=>x({...r,website:t.target.value})})]})]})]}),(0,e.jsxs)("div",{className:"flex flex-col gap-3 pt-4",children:[(0,e.jsx)("button",{onClick:U,disabled:u,className:"flex h-14 w-full items-center justify-center gap-2 rounded-2xl bg-primary font-bold text-primary-foreground shadow-lg shadow-primary/20 transition-all active:scale-[0.98] disabled:opacity-50",children:u?(0,e.jsx)(T,{size:20,className:"animate-spin"}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(K,{size:20}),"Save Changes"]})}),(0,e.jsx)("button",{onClick:()=>d(-1),className:"flex h-14 w-full items-center justify-center font-bold text-muted-foreground transition-all active:scale-95 active:text-foreground",children:"Discard Changes"})]}),(0,e.jsx)("div",{className:"pt-10 text-center",children:(0,e.jsx)("p",{className:"text-[12px] font-bold text-muted-foreground/60 uppercase tracking-widest",children:"MySys Profile Management"})})]})]})}):null},me=se;export{me as default};
