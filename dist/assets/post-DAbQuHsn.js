const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/VideoPlayer-CYhXM_j2.js","assets/framework-i0QTTZ5z.js","assets/database-OCX2jLsI.js","assets/rolldown-runtime-CIzSbf4l.js","assets/framework-sg0yWRLc.css","assets/media-libs-CSO2-zwb.js","assets/media-libs-CqCaMccn.css","assets/VideoPlayer-DfkpDK0n.js","assets/index-mx-8cwWk.js","assets/ui-libs-BsCs0W7b.js","assets/query-D9AYMyAs.js","assets/animations-BjdNH4pZ.js","assets/index-NV7zzvw9.css"])))=>i.map(i=>d[i]);
import{o as gt}from"./rolldown-runtime-CIzSbf4l.js";import{c as X,d as Et,l as Dt,n as Lt,v as bt,w as At,x as Ot}from"./framework-i0QTTZ5z.js";import{r as Ut}from"./query-D9AYMyAs.js";import{$n as Vt,At as me,Bt,Dn as Ht,En as Wt,Gn as Ne,Hn as qt,Ht as He,In as We,Pn as ve,Qt as qe,Rn as we,Rt as Ge,Sn as Gt,Vn as Qt,Wn as Xt,an as Jt,cn as Qe,dn as Kt,en as Zt,gn as Yt,in as Ce,on as es,pn as ts,qn as ss,un as ls,yn as vt,zn as is}from"./ui-libs-BsCs0W7b.js";import{n as as}from"./media-libs-CSO2-zwb.js";import{$t as Xe,A as ns,Cn as rs,Dn as os,En as Je,Et as cs,F as ds,Fn as de,G as ms,H as fs,In as $e,Jt as Ke,Kt as G,Ln as be,M as xs,Mn as us,On as hs,P as ps,Pn as _e,Pt as gs,Qt as Ze,R as bs,Sn as vs,St as js,Tt as ys,Ut as jt,V as je,Vn as Ye,X as ks,Xt as et,Yt as tt,Z as zs,Zt as st,_n as Ns,cn as ws,dn as yt,en as lt,fn as Cs,g as it,gn as $s,gt as kt,hn as at,in as le,j as zt,ln as Te,nn as ie,on as Nt,qt as Se,rn as ae,sn as _s,tn as nt,v as Ss,wn as Fs,wt as oe,xn as Ts,xt as Ps,zn as rt}from"./index-mx-8cwWk.js";import{t as Pe}from"./rich-text-asyQH3Eo.js";import{n as ce,t as Rs}from"./actionsheet-WlrZudVp.js";var Ms=X(),z=gt(At(),1),t=gt(Dt(),1),Is=l=>{const e=(0,Ms.c)(37),{isComment:s,liked:r,reposted:i,handleLike:a,handleRepost:c,handleCommentClick:n,handleShareClick:o,isDetail:p}=l;if(p!==void 0&&p){let w;e[0]!==a||e[1]!==r?(w=(0,t.jsx)(Z,{icon:ve,label:"Like",type:"like",onClick:a,active:r}),e[0]=a,e[1]=r,e[2]=w):w=e[2];let C;e[3]!==c||e[4]!==s||e[5]!==i?(C=!s&&(0,t.jsx)(Z,{icon:Ce,label:"Repost",type:"repost",onClick:c,active:i}),e[3]=c,e[4]=s,e[5]=i,e[6]=C):C=e[6];let $;e[7]!==n?($=(0,t.jsx)(Z,{icon:zt,label:"Comment",type:"comment",onClick:n}),e[7]=n,e[8]=$):$=e[8];let S;e[9]!==o||e[10]!==s?(S=!s&&(0,t.jsx)(Z,{icon:je,label:"Share",type:"share",onClick:o}),e[9]=o,e[10]=s,e[11]=S):S=e[11];let d;return e[12]!==w||e[13]!==C||e[14]!==$||e[15]!==S?(d=(0,t.jsxs)("div",{className:"mt-5 flex w-full items-center justify-around py-2",children:[w,C,$,S]}),e[12]=w,e[13]=C,e[14]=$,e[15]=S,e[16]=d):d=e[16],d}const h=`flex items-center gap-x-1.5 ${s?"mt-2":"mt-3.5"}`,m=s?16:18;let x;e[17]!==a||e[18]!==r||e[19]!==m?(x=(0,t.jsx)(Z,{icon:ve,size:m,type:"like",onClick:a,active:r}),e[17]=a,e[18]=r,e[19]=m,e[20]=x):x=e[20];const g=s?16:18;let f;e[21]!==n||e[22]!==g?(f=(0,t.jsx)(Z,{icon:vt,size:g,type:"comment",onClick:n}),e[21]=n,e[22]=g,e[23]=f):f=e[23];const v=s?16:18;let b;e[24]!==c||e[25]!==i||e[26]!==v?(b=(0,t.jsx)(Z,{icon:Ce,size:v,type:"repost",onClick:c,active:i}),e[24]=c,e[25]=i,e[26]=v,e[27]=b):b=e[27];let u;e[28]!==o||e[29]!==s?(u=!s&&o&&(0,t.jsx)(Z,{icon:je,type:"share",onClick:o}),e[28]=o,e[29]=s,e[30]=u):u=e[30];let y;return e[31]!==h||e[32]!==x||e[33]!==f||e[34]!==b||e[35]!==u?(y=(0,t.jsxs)("div",{className:h,children:[x,f,b,u]}),e[31]=h,e[32]=x,e[33]=f,e[34]=b,e[35]=u,e[36]=y):y=e[36],y},ot=Is,Es=X(),Ds=l=>{const e=(0,Es.c)(38),{views:s,likes:r,comments:i,isDetail:a,isComment:c,onRepliesClick:n}=l,o=a===void 0?!1:a,p=c===void 0?!1:c;if(o){const b=s||0;let u;e[0]!==b?(u=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:b}),e[0]=b,e[1]=u):u=e[1];let y;e[2]===Symbol.for("react.memo_cache_sentinel")?(y=(0,t.jsx)("span",{className:"opacity-70",children:"Views"}),e[2]=y):y=e[2];let w;e[3]!==u?(w=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[u," ",y]}),e[3]=u,e[4]=w):w=e[4];const C=r||0;let $;e[5]!==C?($=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:C}),e[5]=C,e[6]=$):$=e[6];let S;e[7]===Symbol.for("react.memo_cache_sentinel")?(S=(0,t.jsx)("span",{className:"opacity-70",children:"Likes"}),e[7]=S):S=e[7];let d;e[8]!==$?(d=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[$," ",S]}),e[8]=$,e[9]=d):d=e[9];const _=i||0;let R;e[10]!==_?(R=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:_}),e[10]=_,e[11]=R):R=e[11];let N;e[12]===Symbol.for("react.memo_cache_sentinel")?(N=(0,t.jsx)("span",{className:"opacity-70",children:"Comments"}),e[12]=N):N=e[12];let j;e[13]!==R?(j=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[R," ",N]}),e[13]=R,e[14]=j):j=e[14];let F;return e[15]!==d||e[16]!==j||e[17]!==w?(F=(0,t.jsxs)("div",{className:"mt-5 flex items-center gap-x-6 border-b border-zinc-100 pb-4 text-sm text-zinc-500 dark:border-zinc-800 dark:text-zinc-400",children:[w,d,j]}),e[15]=d,e[16]=j,e[17]=w,e[18]=F):F=e[18],F}if(i===0&&r===0&&(s===0||p))return null;const h=`mt-2 flex items-center gap-x-2 px-0.5 ${p?"text-[12px]":"text-[14px]"} font-medium text-zinc-500 dark:text-zinc-400`;let m;e[19]!==i||e[20]!==p||e[21]!==r||e[22]!==s?(m=s>0&&!p&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{className:"hover:underline",children:[s," ",s===1?"view":"views"]}),(i>0||r>0)&&(0,t.jsx)("span",{className:"opacity-50",children:"·"})]}),e[19]=i,e[20]=p,e[21]=r,e[22]=s,e[23]=m):m=e[23];let x;e[24]!==i||e[25]!==n?(x=i>0&&(0,t.jsxs)("button",{className:"hover:underline",onClick:b=>{b.stopPropagation(),n&&n(b)},children:[i," ",i===1?"reply":"replies"]}),e[24]=i,e[25]=n,e[26]=x):x=e[26];let g;e[27]!==i||e[28]!==r?(g=i>0&&r>0&&(0,t.jsx)("span",{className:"opacity-50",children:"·"}),e[27]=i,e[28]=r,e[29]=g):g=e[29];let f;e[30]!==r?(f=r>0&&(0,t.jsxs)("button",{className:"hover:underline",children:[r," ",r===1?"like":"likes"]}),e[30]=r,e[31]=f):f=e[31];let v;return e[32]!==h||e[33]!==m||e[34]!==x||e[35]!==g||e[36]!==f?(v=(0,t.jsxs)("div",{className:h,children:[m,x,g,f]}),e[32]=h,e[33]=m,e[34]=x,e[35]=g,e[36]=f,e[37]=v):v=e[37],v},ct=Ds,Ls=X(),As=l=>{const e=(0,Ls.c)(48),{user:s,timeAgo:r,community:i,onUserClick:a,actionsMenu:c,isComment:n,isDetail:o,showAvatar:p}=l,h=p===void 0?!1:p,m=bt();let x;e[0]!==a||e[1]!==s.handle?(x=I=>{I.stopPropagation(),a&&a(s.handle)},e[0]=a,e[1]=s.handle,e[2]=x):x=e[2];const g=x;let f;e[3]!==i||e[4]!==m?(f=I=>{I.stopPropagation(),i&&m(`/c/${i.handle}`)},e[3]=i,e[4]=m,e[5]=f):f=e[5];const v=f,b=`flex items-center justify-between ${o?"pb-5":"min-h-[40px] mb-2"}`;let u;e[6]!==g||e[7]!==n||e[8]!==o||e[9]!==h||e[10]!==s.avatar||e[11]!==s.handle?(u=h&&(0,t.jsx)("button",{className:"shrink-0",onClick:g,children:(0,t.jsxs)(ie,{className:`${o?"size-12":n?"size-8":"size-10"} border-0 shadow-sm`,children:[(0,t.jsx)(le,{src:s.avatar,alt:s.handle,className:"object-cover"}),(0,t.jsx)(ae,{className:"text-xs",children:s.handle[0]?.toUpperCase()})]})}),e[6]=g,e[7]=n,e[8]=o,e[9]=h,e[10]=s.avatar,e[11]=s.handle,e[12]=u):u=e[12];const y=`flex shrink-0 items-center gap-1 font-bold text-zinc-900 hover:underline dark:text-white ${o?"text-base sm:text-lg":n?"text-[14px]":"text-[15px]"}`;let w;e[13]!==s.handle?(w=(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:s.handle}),e[13]=s.handle,e[14]=w):w=e[14];let C;e[15]!==n||e[16]!==o||e[17]!==s.role?(C=s.role==="admin"&&(0,t.jsx)(ns,{size:o?28:n?22:24}),e[15]=n,e[16]=o,e[17]=s.role,e[18]=C):C=e[18];let $;e[19]!==n||e[20]!==o||e[21]!==s.verified?($=s.verified&&(0,t.jsx)(fs,{size:o?16:n?12:14}),e[19]=n,e[20]=o,e[21]=s.verified,e[22]=$):$=e[22];let S;e[23]!==g||e[24]!==y||e[25]!==w||e[26]!==C||e[27]!==$?(S=(0,t.jsxs)("button",{className:y,onClick:g,children:[w,C,$]}),e[23]=g,e[24]=y,e[25]=w,e[26]=C,e[27]=$,e[28]=S):S=e[28];let d;e[29]!==i||e[30]!==v||e[31]!==o?(d=i&&(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-1 text-zinc-500",children:[(0,t.jsx)(xs,{size:o?14:12,className:"shrink-0 text-zinc-400"}),(0,t.jsxs)("button",{className:`flex items-center gap-1 font-bold text-zinc-900 hover:underline dark:text-zinc-100 ${o?"text-[14px] sm:text-[15px]":"text-[13px]"}`,onClick:v,children:[(0,t.jsxs)(ie,{className:"size-3.5 shrink-0 border border-zinc-200 bg-zinc-100 dark:border-zinc-700 dark:bg-zinc-800",children:[(0,t.jsx)(le,{src:i.avatar,alt:i.name,className:"object-cover"}),(0,t.jsx)(ae,{className:"text-[6px] font-bold text-zinc-500",children:i.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:i.name})]})]}),e[29]=i,e[30]=v,e[31]=o,e[32]=d):d=e[32];let _;e[33]!==S||e[34]!==d?(_=(0,t.jsx)("div",{className:"flex min-w-0 flex-1 flex-col",children:(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex min-w-0 max-w-full items-center gap-1.5",children:[S,d]})})}),e[33]=S,e[34]=d,e[35]=_):_=e[35];let R;e[36]!==_||e[37]!==u?(R=(0,t.jsxs)("div",{className:"flex items-center gap-x-3.5 flex-1 min-w-0",children:[u,_]}),e[36]=_,e[37]=u,e[38]=R):R=e[38];const N=r||"Recent";let j;e[39]!==N?(j=(0,t.jsx)("span",{className:"whitespace-nowrap text-[12px] text-zinc-500 dark:text-zinc-400",children:N}),e[39]=N,e[40]=j):j=e[40];let F;e[41]!==c||e[42]!==j?(F=(0,t.jsxs)("div",{className:"-mt-1 flex items-center gap-2.5",children:[j,c]}),e[41]=c,e[42]=j,e[43]=F):F=e[43];let M;return e[44]!==R||e[45]!==F||e[46]!==b?(M=(0,t.jsxs)("div",{className:b,children:[R,F]}),e[44]=R,e[45]=F,e[46]=b,e[47]=M):M=e[47],M},dt=As,Os=X(),Us=l=>{const e=(0,Os.c)(40),{content:s,isDetail:r,isEditing:i,editedContent:a,setEditedContent:c,onCancelEdit:n,onSaveEdit:o,isUpdating:p,contentClass:h}=l,[m,x]=(0,z.useState)(!1),g=typeof s=="string"&&Ye(s);if(i&&c){let _;e[0]!==c?(_=O=>c(O.target.value),e[0]=c,e[1]=_):_=e[1];const R=`min-h-[100px] w-full rounded-xl border-zinc-200 bg-zinc-50 focus:ring-violet-500 dark:border-zinc-800 dark:bg-zinc-900 ${Ye(a||"")?"font-bangla text-lg":"font-english"}`;let N;e[2]!==a||e[3]!==_||e[4]!==R?(N=(0,t.jsx)(ms,{value:a,onChange:_,className:R,autoFocus:!0}),e[2]=a,e[3]=_,e[4]=R,e[5]=N):N=e[5];let j;e[6]!==n?(j=(0,t.jsx)("button",{onClick:n,className:"px-4 py-1.5 text-sm font-bold text-zinc-500 transition-colors hover:text-zinc-700 dark:hover:text-zinc-300",children:"Cancel"}),e[6]=n,e[7]=j):j=e[7];let F;e[8]!==s||e[9]!==a||e[10]!==p?(F=p||!a?.trim()||a===s,e[8]=s,e[9]=a,e[10]=p,e[11]=F):F=e[11];const M=p?"Saving...":"Save";let I;e[12]!==o||e[13]!==F||e[14]!==M?(I=(0,t.jsx)("button",{onClick:o,disabled:F,className:"rounded-full bg-violet-600 px-4 py-1.5 text-sm font-bold text-white transition-all hover:bg-violet-700 disabled:opacity-50 active:scale-95",children:M}),e[12]=o,e[13]=F,e[14]=M,e[15]=I):I=e[15];let D;e[16]!==j||e[17]!==I?(D=(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[j,I]}),e[16]=j,e[17]=I,e[18]=D):D=e[18];let L;return e[19]!==N||e[20]!==D?(L=(0,t.jsxs)("div",{className:"mt-2 flex flex-col gap-2",onClick:Vs,children:[N,D]}),e[19]=N,e[20]=D,e[21]=L):L=e[21],L}const f=!r&&s.length>280;let v;e[22]!==s||e[23]!==m||e[24]!==f?(v=f&&!m?s.substring(0,280):s,e[22]=s,e[23]=m,e[24]=f,e[25]=v):v=e[25];const b=v,u=r?"text-lg leading-relaxed sm:text-xl sm:leading-8 mt-1":"text-[15px] leading-snug mt-0.5",y=g?"font-bangla text-[1.15em]":"font-english";let w;e[26]!==h||e[27]!==u||e[28]!==y?(w=de("whitespace-pre-line break-words",u,y,h),e[26]=h,e[27]=u,e[28]=y,e[29]=w):w=e[29];let C;e[30]!==b?(C=(0,t.jsx)(Pe,{content:b}),e[30]=b,e[31]=C):C=e[31];const $=f&&!m&&"...";let S;e[32]!==m||e[33]!==f?(S=f&&(0,t.jsx)("button",{onClick:_=>{_.stopPropagation(),x(!m)},className:"ml-1 cursor-pointer font-bold text-rose-600 hover:underline dark:text-rose-400",children:m?"Show less":"See more"}),e[32]=m,e[33]=f,e[34]=S):S=e[34];let d;return e[35]!==w||e[36]!==C||e[37]!==$||e[38]!==S?(d=(0,t.jsxs)("div",{className:w,children:[C,$,S]}),e[35]=w,e[36]=C,e[37]=$,e[38]=S,e[39]=d):d=e[39],d},mt=Us;function Vs(l){return l.stopPropagation()}var Bs=X(),Hs=l=>{const e=(0,Bs.c)(28),{media:s,isEditing:r,editedMedia:i,setEditedMedia:a,newFiles:c,setNewFiles:n}=l;let o;e[0]!==i?(o=i===void 0?[]:i,e[0]=i,e[1]=o):o=e[1];const p=o;let h;e[2]!==c?(h=c===void 0?[]:c,e[2]=c,e[3]=h):h=e[3];const m=h,x=(0,z.useRef)(null);if(r&&a&&n){let f;if(e[4]!==p||e[5]!==a){let C;e[7]!==a?(C=($,S)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[$.type==="video"?(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(is,{size:24,className:"text-zinc-400"})}):(0,t.jsx)("img",{src:$.url||$.src,className:"size-full object-cover",alt:""}),(0,t.jsx)("button",{onClick:d=>{d.stopPropagation(),a(_=>_.filter((R,N)=>N!==S))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(me,{size:16})})]},`old-${S}`),e[7]=a,e[8]=C):C=e[8],f=p.map(C),e[4]=p,e[5]=a,e[6]=f}else f=e[6];let v;if(e[9]!==m||e[10]!==n){let C;e[12]!==n?(C=($,S)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border-2 border-dashed border-violet-500 bg-violet-50/10",children:[$.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL($),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center",children:(0,t.jsx)(Wt,{size:24,className:"animate-spin text-violet-500"})}),(0,t.jsx)("button",{onClick:d=>{d.stopPropagation(),n(_=>_.filter((R,N)=>N!==S))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(me,{size:16})}),(0,t.jsx)("div",{className:"absolute bottom-1 left-1 rounded bg-violet-600 px-1 text-[8px] font-bold text-white",children:"NEW"})]},`new-${S}`),e[12]=n,e[13]=C):C=e[13],v=m.map(C),e[9]=m,e[10]=n,e[11]=v}else v=e[11];let b;e[14]!==p.length||e[15]!==m.length?(b=p.length+m.length<4&&(0,t.jsxs)("button",{onClick:C=>{C.stopPropagation(),x.current?.click()},className:"relative flex aspect-square flex-col items-center justify-center gap-1 rounded-xl border-2 border-dashed border-zinc-200 text-zinc-400 transition-all hover:border-violet-500 hover:bg-violet-50/5 hover:text-violet-500 dark:border-zinc-800",children:[(0,t.jsx)(Jt,{size:20}),(0,t.jsx)("span",{className:"text-[10px] font-bold",children:"Add Media"})]}),e[14]=p.length,e[15]=m.length,e[16]=b):b=e[16];let u;e[17]!==f||e[18]!==v||e[19]!==b?(u=(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:[f,v,b]}),e[17]=f,e[18]=v,e[19]=b,e[20]=u):u=e[20];let y;e[21]!==n?(y=(0,t.jsx)("input",{type:"file",ref:x,onChange:C=>{if(C.target.files){const $=Array.from(C.target.files);n(S=>[...S,...$])}},multiple:!0,className:"hidden",accept:"image/*,video/*"}),e[21]=n,e[22]=y):y=e[22];let w;return e[23]!==u||e[24]!==y?(w=(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[u,y]}),e[23]=u,e[24]=y,e[25]=w):w=e[25],w}if(!s||s.length===0)return null;let g;return e[26]!==s?(g=(0,t.jsx)(ul,{items:s}),e[26]=s,e[27]=g):g=e[27],g},ft=Hs,Ws=X(),qs=l=>{const e=(0,Ws.c)(48),{icon:s,count:r,label:i,onClick:a,active:c,activeColorClass:n,size:o,type:p}=l,h=o===void 0?18:o,m=p===void 0?"default":p;let x,g,f,v,b,u,y;if(e[0]!==c||e[1]!==n||e[2]!==r||e[3]!==i||e[4]!==a||e[5]!==m){const D={like:{hoverBg:"group-hover:bg-rose-500/10",hoverText:"group-hover:text-rose-500",activeText:"text-rose-500",activeFill:"fill-rose-500"},repost:{hoverBg:"group-hover:bg-emerald-500/10",hoverText:"group-hover:text-emerald-500",activeText:"text-emerald-500",activeFill:"fill-emerald-500"},comment:{hoverBg:"group-hover:bg-sky-500/10",hoverText:"group-hover:text-sky-500",activeText:"text-sky-500",activeFill:"fill-sky-500"},share:{hoverBg:"group-hover:bg-violet-500/10",hoverText:"group-hover:text-violet-500",activeText:"text-violet-500",activeFill:"fill-violet-500"},default:{hoverBg:"group-hover:bg-zinc-500/10",hoverText:"group-hover:text-zinc-500",activeText:"text-zinc-900 dark:text-white",activeFill:"fill-current"}};g=D[m]||D.default;const L=n||g.activeText;x=G.button,e[13]===Symbol.for("react.memo_cache_sentinel")?(v={scale:.85},e[13]=v):v=e[13],e[14]!==a?(b=O=>{O.stopPropagation(),a&&a(O)},e[14]=a,e[15]=b):b=e[15],u=`${i} ${r!==void 0?`(${r})`:""}`,y=de("group -ml-2 flex items-center gap-x-0.5 rounded-xl px-2 py-1.5 text-[12px] font-bold transition-all sm:gap-x-1 sm:text-[13px]",c?L:"text-zinc-500",!c&&g.hoverText),f=de("rounded-full p-2 transition-all duration-200",!c&&g.hoverBg),e[0]=c,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=m,e[6]=x,e[7]=g,e[8]=f,e[9]=v,e[10]=b,e[11]=u,e[12]=y}else x=e[6],g=e[7],f=e[8],v=e[9],b=e[10],u=e[11],y=e[12];let w;e[16]!==c?(w=c?{scale:[1,1.4,1],rotate:[0,15,0]}:{scale:1},e[16]=c,e[17]=w):w=e[17];let C;e[18]===Symbol.for("react.memo_cache_sentinel")?(C={duration:.45,type:"spring",stiffness:300,damping:15},e[18]=C):C=e[18];const $=c?2.5:2,S=c&&g.activeFill;let d;e[19]!==S?(d=de("transition-colors duration-200",S),e[19]=S,e[20]=d):d=e[20];let _;e[21]!==s||e[22]!==h||e[23]!==$||e[24]!==d?(_=(0,t.jsx)(s,{size:h,strokeWidth:$,className:d}),e[21]=s,e[22]=h,e[23]=$,e[24]=d,e[25]=_):_=e[25];let R;e[26]!==_||e[27]!==w?(R=(0,t.jsx)(G.div,{animate:w,transition:C,children:_}),e[26]=_,e[27]=w,e[28]=R):R=e[28];let N;e[29]!==R||e[30]!==f?(N=(0,t.jsx)("div",{className:f,children:R}),e[29]=R,e[30]=f,e[31]=N):N=e[31];let j;e[32]!==i?(j=i&&(0,t.jsx)("span",{className:"hidden xs:inline",children:i}),e[32]=i,e[33]=j):j=e[33];let F;e[34]!==c||e[35]!==r?(F=r!=null&&(0,t.jsx)(G.span,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:de("transition-all",c?"font-black":"font-bold"),children:r||0},r),e[34]=c,e[35]=r,e[36]=F):F=e[36];let M;e[37]!==F?(M=(0,t.jsx)(Se,{mode:"wait",children:F}),e[37]=F,e[38]=M):M=e[38];let I;return e[39]!==x||e[40]!==N||e[41]!==j||e[42]!==M||e[43]!==v||e[44]!==b||e[45]!==u||e[46]!==y?(I=(0,t.jsxs)(x,{whileTap:v,onClick:b,"aria-label":u,className:y,children:[N,j,M]}),e[39]=x,e[40]=N,e[41]=j,e[42]=M,e[43]=v,e[44]=b,e[45]=u,e[46]=y,e[47]=I):I=e[47],I},Z=qs,Gs=X(),Qs=l=>{const e=(0,Gs.c)(18),{poll:s,onVote:r}=l,i=s.options.reduce(Xs,0),[a,c]=(0,z.useState)(null);let n;e[0]!==r||e[1]!==a?(n=f=>{a||(c(f),r&&r(f))},e[0]=r,e[1]=a,e[2]=n):n=e[2];const o=n;let p;if(e[3]!==o||e[4]!==s.options||e[5]!==i||e[6]!==a){let f;e[8]!==o||e[9]!==i||e[10]!==a?(f=(v,b)=>{const u=i>0?Math.round((v.votes+(a===v.id?1:0))/(i+(a?1:0))*100):0,y=a===v.id;return(0,t.jsxs)("div",{onClick:()=>o(v.id),className:`relative h-10 w-full overflow-hidden rounded-xl border cursor-pointer ${y?"border-violet-500 dark:border-violet-500":"border-zinc-200 dark:border-zinc-700"}`,children:[a&&(0,t.jsx)("div",{className:"absolute left-0 top-0 h-full bg-zinc-200 transition-all duration-500 dark:bg-zinc-800",style:{width:`${u}%`}}),(0,t.jsxs)("div",{className:"absolute inset-0 z-10 flex items-center justify-between px-4",children:[(0,t.jsxs)("span",{className:`text-sm font-medium ${y?"font-bold text-violet-600":"text-zinc-700 dark:text-zinc-200"}`,children:[v.text," ",y&&(0,t.jsx)(Vt,{size:14,className:"mb-0.5 inline ml-1"})]}),a&&(0,t.jsxs)("span",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:[u,"%"]})]})]},v.id||b)},e[8]=o,e[9]=i,e[10]=a,e[11]=f):f=e[11],p=s.options.map(f),e[3]=o,e[4]=s.options,e[5]=i,e[6]=a,e[7]=p}else p=e[7];const h=i+(a?1:0),m=a?"6 days left":"Click to vote";let x;e[12]!==h||e[13]!==m?(x=(0,t.jsxs)("div",{className:"pl-1 text-xs text-zinc-500 dark:text-zinc-400",children:[h," votes •"," ",m]}),e[12]=h,e[13]=m,e[14]=x):x=e[14];let g;return e[15]!==p||e[16]!==x?(g=(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[p,x]}),e[15]=p,e[16]=x,e[17]=g):g=e[17],g},xt=Qs;function Xs(l,e){return l+e.votes}var Js=X(),Ks=l=>{const e=(0,Js.c)(25),{user:s,time:r,content:i}=l;let a;e[0]!==s.avatar||e[1]!==s.handle?(a=(0,t.jsx)(le,{src:s.avatar,alt:s.handle}),e[0]=s.avatar,e[1]=s.handle,e[2]=a):a=e[2];let c;e[3]!==s.handle[0]?(c=s.handle[0]?.toUpperCase(),e[3]=s.handle[0],e[4]=c):c=e[4];let n;e[5]!==c?(n=(0,t.jsx)(ae,{children:c}),e[5]=c,e[6]=n):n=e[6];let o;e[7]!==a||e[8]!==n?(o=(0,t.jsxs)(ie,{className:"size-6",children:[a,n]}),e[7]=a,e[8]=n,e[9]=o):o=e[9];let p;e[10]!==s.handle?(p=(0,t.jsx)("span",{className:"text-sm font-semibold",children:s.handle}),e[10]=s.handle,e[11]=p):p=e[11];let h;e[12]!==o||e[13]!==p?(h=(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[o,p]}),e[12]=o,e[13]=p,e[14]=h):h=e[14];let m;e[15]!==r?(m=(0,t.jsx)("span",{className:"text-xs text-zinc-500 sm:text-sm",children:r}),e[15]=r,e[16]=m):m=e[16];let x;e[17]!==h||e[18]!==m?(x=(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between gap-x-2",children:[h,m]}),e[17]=h,e[18]=m,e[19]=x):x=e[19];let g;e[20]!==i?(g=(0,t.jsx)(Pe,{content:i,className:"text-sm text-zinc-800 dark:text-zinc-300"}),e[20]=i,e[21]=g):g=e[21];let f;return e[22]!==x||e[23]!==g?(f=(0,t.jsxs)("div",{className:"p-4",children:[x,g]}),e[22]=x,e[23]=g,e[24]=f):f=e[24],f},ut=Ks,Zs=X(),Ys=l=>{const e=(0,Zs.c)(60),{currentUser:s,newComment:r,setNewComment:i,handleSubmitComment:a,loading:c,selectedFiles:n,setSelectedFiles:o,isUploading:p}=l;let h;e[0]!==n?(h=n===void 0?[]:n,e[0]=n,e[1]=h):h=e[1];const m=h,x=(0,z.useRef)(null);let g;e[2]!==o?(g=E=>{if(E.target.files){const A=Array.from(E.target.files);o&&o(q=>[...q,...A])}},e[2]=o,e[3]=g):g=e[3];const f=g;let v;e[4]!==o?(v=E=>{o&&o(A=>A.filter((q,ee)=>ee!==E))},e[4]=o,e[5]=v):v=e[5];const b=v;let u;e[6]!==m?(u=m.map(el),e[6]=m,e[7]=u):u=e[7];const y=u;let w,C;e[8]!==y?(w=()=>()=>{y.forEach(tl)},C=[y],e[8]=y,e[9]=w,e[10]=C):(w=e[9],C=e[10]),(0,z.useEffect)(w,C);let $;e[11]!==o?($=E=>{const A=E.clipboardData.files;if(A&&A.length>0){const q=Array.from(A).filter(sl);q.length>0&&(E.preventDefault(),o&&o(ee=>[...ee,...q]))}},e[11]=o,e[12]=$):$=e[12];const S=$;if(!s){let E;return e[13]===Symbol.for("react.memo_cache_sentinel")?(E=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-6 text-center dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"Please login to join the conversation."})}),e[13]=E):E=e[13],E}let d;e[14]!==s.avatar||e[15]!==s.handle?(d=(0,t.jsx)(le,{src:s.avatar,alt:s.handle,className:"object-cover"}),e[14]=s.avatar,e[15]=s.handle,e[16]=d):d=e[16];let _;e[17]!==s.handle?.[0]?(_=s.handle?.[0]?.toUpperCase(),e[17]=s.handle?.[0],e[18]=_):_=e[18];let R;e[19]!==_?(R=(0,t.jsx)(ae,{children:_}),e[19]=_,e[20]=R):R=e[20];let N;e[21]!==R||e[22]!==d?(N=(0,t.jsxs)(ie,{className:"size-9 border border-zinc-200 dark:border-zinc-700",children:[d,R]}),e[21]=R,e[22]=d,e[23]=N):N=e[23];let j;e[24]!==i?(j=E=>i(E.target.value),e[24]=i,e[25]=j):j=e[25];let F;e[26]!==S||e[27]!==r||e[28]!==j?(F=(0,t.jsx)("textarea",{id:"comment-input",className:"min-h-[60px] w-full resize-none bg-transparent text-base outline-none placeholder:text-zinc-500 dark:text-white",placeholder:"Post your reply...",value:r,onChange:j,onPaste:S}),e[26]=S,e[27]=r,e[28]=j,e[29]=F):F=e[29];let M;e[30]!==y||e[31]!==b||e[32]!==m?(M=m.length>0&&(0,t.jsx)("div",{className:"mt-2 mb-2 flex flex-wrap gap-2",children:m.map((E,A)=>(0,t.jsxs)("div",{className:"relative size-20 overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[E.type.startsWith("image/")?(0,t.jsx)("img",{src:y[A],className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)(Kt,{size:20,className:"text-zinc-500"})}),(0,t.jsx)("button",{onClick:()=>b(A),className:"absolute right-1 top-1 rounded-full bg-black/60 p-1 text-white transition-colors hover:bg-black",children:(0,t.jsx)(me,{size:12})})]},A))}),e[30]=y,e[31]=b,e[32]=m,e[33]=M):M=e[33];let I;e[34]===Symbol.for("react.memo_cache_sentinel")?(I=()=>x.current?.click(),e[34]=I):I=e[34];let D;e[35]===Symbol.for("react.memo_cache_sentinel")?(D=(0,t.jsx)("button",{type:"button",onClick:I,className:"rounded-full p-2 text-violet-600 transition-colors hover:bg-violet-50 dark:hover:bg-zinc-800",title:"Attach media",children:(0,t.jsx)(bs,{size:20})}),e[35]=D):D=e[35];let L;e[36]!==f?(L=(0,t.jsxs)("div",{className:"flex gap-1 text-violet-600",children:[D,(0,t.jsx)("input",{type:"file",ref:x,onChange:f,multiple:!0,className:"hidden",accept:"image/*,video/*,application/pdf"})]}),e[36]=f,e[37]=L):L=e[37];const O=c||p?"primary":"animated";let V;e[38]!==p||e[39]!==c?(V=!(c||p)&&(0,t.jsx)(je,{size:20}),e[38]=p,e[39]=c,e[40]=V):V=e[40];const W=c||p;let B;e[41]!==r||e[42]!==m.length?(B=!r.trim()&&m.length===0,e[41]=r,e[42]=m.length,e[43]=B):B=e[43];let U;e[44]!==a||e[45]!==O||e[46]!==V||e[47]!==W||e[48]!==B?(U=(0,t.jsx)(jt,{variant:O,icon:V,className:"min-w-[70px] !w-auto",onClick:a,loading:W,disabled:B,children:"Reply"}),e[44]=a,e[45]=O,e[46]=V,e[47]=W,e[48]=B,e[49]=U):U=e[49];let K;e[50]!==L||e[51]!==U?(K=(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between border-t border-zinc-100 pt-3 dark:border-zinc-800",children:[L,U]}),e[50]=L,e[51]=U,e[52]=K):K=e[52];let k;e[53]!==F||e[54]!==M||e[55]!==K?(k=(0,t.jsxs)("div",{className:"flex-1",children:[F,M,K]}),e[53]=F,e[54]=M,e[55]=K,e[56]=k):k=e[56];let T;return e[57]!==N||e[58]!==k?(T=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-4 dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[N,k]})}),e[57]=N,e[58]=k,e[59]=T):T=e[59],T},wt=z.memo(Ys);function el(l){return URL.createObjectURL(l)}function tl(l){return URL.revokeObjectURL(l)}function sl(l){return l.type.startsWith("image/")}var ll=X(),il=l=>{const e=(0,ll.c)(30),{url:s}=l;let r,i;e[0]!==s?(r=["link-preview",s],i=()=>Cs(s),e[0]=s,e[1]=r,e[2]=i):(r=e[1],i=e[2]);const a=!!s;let c;e[3]!==r||e[4]!==i||e[5]!==a?(c={queryKey:r,queryFn:i,staleTime:864e5,enabled:a},e[3]=r,e[4]=i,e[5]=a,e[6]=c):c=e[6];const{data:n,isLoading:o,isError:p}=Ut(c);if(o){let w;return e[7]===Symbol.for("react.memo_cache_sentinel")?(w=(0,t.jsx)("div",{className:"mt-3 flex h-24 animate-pulse items-center justify-center overflow-hidden rounded-2xl border border-zinc-100 bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-900/50",children:(0,t.jsx)(We,{className:"animate-spin text-zinc-300 dark:text-zinc-700",size:24})}),e[7]=w):w=e[7],w}if(p||!n||!n.title&&!n.image)return null;let h;e[8]!==n.image||e[9]!==n.title?(h=n.image&&(0,t.jsx)("div",{className:"aspect-[1.91/1] w-full overflow-hidden border-b border-zinc-100 bg-zinc-100 dark:border-zinc-800 dark:bg-zinc-900",children:(0,t.jsx)("img",{src:n.image,alt:n.title??void 0,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-[1.02]",onError:nl})}),e[8]=n.image,e[9]=n.title,e[10]=h):h=e[10];let m;e[11]===Symbol.for("react.memo_cache_sentinel")?(m=(0,t.jsx)(We,{size:12}),e[11]=m):m=e[11];let x;e[12]!==n.siteName?(x=(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs font-bold uppercase tracking-wider text-zinc-600",children:[m,(0,t.jsx)("span",{children:n.siteName})]}),e[12]=n.siteName,e[13]=x):x=e[13];let g;e[14]!==n.title?(g=(0,t.jsx)("div",{className:"line-clamp-2 text-[15px] font-bold leading-snug transition-colors group-hover:text-violet-700 dark:text-white",children:n.title}),e[14]=n.title,e[15]=g):g=e[15];let f;e[16]!==n.description?(f=n.description&&(0,t.jsx)("p",{className:"line-clamp-2 text-xs leading-relaxed text-zinc-600 dark:text-zinc-400",children:n.description}),e[16]=n.description,e[17]=f):f=e[17];let v;e[18]===Symbol.for("react.memo_cache_sentinel")?(v=(0,t.jsx)(Xt,{size:10}),e[18]=v):v=e[18];let b;e[19]!==s?(b=(0,t.jsxs)("div",{className:"flex items-center gap-1 pt-1 text-[11px] font-medium text-zinc-500",children:[v,(0,t.jsx)("span",{className:"truncate",children:s})]}),e[19]=s,e[20]=b):b=e[20];let u;e[21]!==b||e[22]!==x||e[23]!==g||e[24]!==f?(u=(0,t.jsxs)("div",{className:"space-y-1 p-3.5",children:[x,g,f,b]}),e[21]=b,e[22]=x,e[23]=g,e[24]=f,e[25]=u):u=e[25];let y;return e[26]!==u||e[27]!==h||e[28]!==s?(y=(0,t.jsxs)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"group mt-3 flex flex-col overflow-hidden rounded-2xl border border-zinc-100 bg-white shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-900",onClick:al,children:[h,u]}),e[26]=u,e[27]=h,e[28]=s,e[29]=y):y=e[29],y},ht=il;function al(l){return l.stopPropagation()}function nl(l){return l.target.style.display="none"}var rl=X(),ol=l=>{const e=(0,rl.c)(15),{file:s}=l;let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=(0,t.jsx)("div",{className:"flex size-10 items-center justify-center rounded-xl bg-violet-100 text-violet-600 dark:bg-violet-900/30",children:(0,t.jsx)(Qt,{size:20})}),e[0]=r):r=e[0];let i;e[1]!==s.name?(i=(0,t.jsx)("div",{className:"truncate text-sm font-bold dark:text-white",children:s.name}),e[1]=s.name,e[2]=i):i=e[2];let a;e[3]!==s.size?(a=s.size!==void 0&&(0,t.jsxs)("div",{className:"text-xs uppercase text-zinc-500",children:[(s.size/1024/1024).toFixed(2)," MB"]}),e[3]=s.size,e[4]=a):a=e[4];let c;e[5]!==i||e[6]!==a?(c=(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[i,a]}),e[5]=i,e[6]=a,e[7]=c):c=e[7];let n;e[8]===Symbol.for("react.memo_cache_sentinel")?(n=(0,t.jsx)(ss,{size:18}),e[8]=n):n=e[8];let o;e[9]!==s.name||e[10]!==s.url?(o=(0,t.jsx)("a",{href:s.url,download:s.name,className:"p-2 text-zinc-400 transition-colors hover:text-violet-600",onClick:dl,children:n}),e[9]=s.name,e[10]=s.url,e[11]=o):o=e[11];let p;return e[12]!==c||e[13]!==o?(p=(0,t.jsxs)("div",{className:"group mt-3 flex items-center gap-3 rounded-2xl border border-zinc-100 bg-zinc-50/50 p-3 transition-colors hover:border-violet-500/30 dark:border-zinc-800 dark:bg-zinc-900/10",children:[r,c,o]}),e[12]=c,e[13]=o,e[14]=p):p=e[14],p},cl=ol;function dl(l){return l.stopPropagation()}var Ct=X(),ml=z.lazy(()=>Ot(()=>import("./VideoPlayer-CYhXM_j2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),fl=l=>{const e=(0,Ct.c)(16),{item:s,onClick:r}=l,[i,a]=(0,z.useState)(!1);let c,n;e[0]===Symbol.for("react.memo_cache_sentinel")?(c={scale:.98},n={type:"spring",stiffness:400,damping:25},e[0]=c,e[1]=n):(c=e[0],n=e[1]);let o;e[2]!==i?(o=!i&&(0,t.jsx)("div",{className:"absolute inset-0 animate-pulse bg-zinc-200 dark:bg-zinc-800"}),e[2]=i,e[3]=o):o=e[3];const p=s.url||s.src;let h;e[4]===Symbol.for("react.memo_cache_sentinel")?(h={opacity:0,scale:1.05,filter:"blur(10px)"},e[4]=h):h=e[4];let m;e[5]!==i?(m=i?{opacity:1,scale:1,filter:"blur(0px)"}:{},e[5]=i,e[6]=m):m=e[6];let x;e[7]===Symbol.for("react.memo_cache_sentinel")?(x={duration:.4,ease:"easeOut"},e[7]=x):x=e[7];let g;e[8]===Symbol.for("react.memo_cache_sentinel")?(g=()=>a(!0),e[8]=g):g=e[8];let f;e[9]!==p||e[10]!==m?(f=(0,t.jsx)(G.img,{src:p,initial:h,animate:m,transition:x,className:"size-full object-cover",alt:"",loading:"lazy",onLoad:g}),e[9]=p,e[10]=m,e[11]=f):f=e[11];let v;return e[12]!==r||e[13]!==o||e[14]!==f?(v=(0,t.jsxs)(G.div,{whileTap:c,transition:n,className:"relative size-full overflow-hidden",onClick:r,children:[o,f]}),e[12]=r,e[13]=o,e[14]=f,e[15]=v):v=e[15],v},xl=l=>{const e=(0,Ct.c)(3),{items:s}=l,r=s===void 0?[]:s,{openLightbox:i}=_s();if(!r||Array.isArray(r)&&r.length===0)return null;const a=Array.isArray(r)?r:[r],c=a.filter(hl),n=a.filter(pl),o=c.some(gl),p=f=>{const v=c.filter(bl).map(vl),b=c[f];i(v,v.indexOf(b.url||b.src))},h="mt-2 space-y-2",m=c.length>0&&(0,t.jsx)("div",{className:`grid gap-2 overflow-hidden rounded-2xl border border-zinc-100 dark:border-zinc-800 ${c.length===1?"grid-cols-1":c.length===2?o?"aspect-[8/9] grid-cols-1 grid-rows-2":"aspect-[16/9] grid-cols-2":(c.length===3,"aspect-[16/9] grid-cols-2 grid-rows-2")}`,children:c.map((f,v)=>(0,t.jsx)("div",{className:`relative cursor-pointer overflow-hidden bg-zinc-100 dark:bg-zinc-900 ${c.length===3&&v===0?"row-span-2":""}`,children:f.type==="video"?(0,t.jsx)(z.Suspense,{fallback:(0,t.jsx)("div",{className:"flex aspect-video w-full items-center justify-center bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)("div",{className:"size-8 animate-spin rounded-full border-2 border-violet-500 border-t-transparent"})}),children:(0,t.jsx)(ml,{src:f.url,poster:f.poster||void 0})}):(0,t.jsx)(fl,{item:f,onClick:b=>{b.stopPropagation(),p(v)}})},v))}),x=n.map(jl);let g;return e[0]!==m||e[1]!==x?(g=(0,t.jsxs)("div",{className:h,children:[m,x]}),e[0]=m,e[1]=x,e[2]=g):g=e[2],g},ul=xl;function hl(l){return l.type==="image"||l.type==="video"}function pl(l){return l.type==="file"}function gl(l){return l.type==="video"}function bl(l){return l.type==="image"}function vl(l){return l.url||l.src}function jl(l,e){return(0,t.jsx)(cl,{file:l},e)}var yl=({isOpen:l,onClose:e,url:s,title:r="Share",overlayClassName:i})=>{const[a,c]=(0,z.useState)(!1),[n,o]=(0,z.useState)(""),[p,h]=(0,z.useState)([]),[m,x]=(0,z.useState)(!1),[g,f]=(0,z.useState)(null),{addToast:v}=Te(),{currentUser:b}=yt(),u=(0,z.useCallback)(async()=>{if(b){x(!0);try{h((await at(b.id)).map(d=>d.user).filter(d=>d!==null).slice(0,5))}catch(d){console.error("Failed to fetch conversations:",d)}finally{x(!1)}}},[b]);(0,z.useEffect)(()=>{l&&b?u():(o(""),h([]))},[l,b,u]);const y=(0,z.useCallback)(async()=>{if(b){x(!0);try{h((await at(b.id)).map(d=>d.user).filter(d=>d!==null&&(d.name?.toLowerCase().includes(n.toLowerCase())||d.handle.toLowerCase().includes(n.toLowerCase()))))}catch(d){console.error("Search failed:",d)}finally{x(!1)}}},[n,b]);(0,z.useEffect)(()=>{const d=setTimeout(()=>{n.trim()&&l?y():!n.trim()&&l&&u()},300);return()=>clearTimeout(d)},[n,l,y,u]);const w=async d=>{d&&d.stopPropagation();try{await $e(s),c(!0),v("Link copied to clipboard!","success"),setTimeout(()=>c(!1),2e3)}catch(_){console.error("Failed to copy:",_),v("Failed to copy link","error")}},C=async d=>{if(b){f(d.id);try{await Ns(await $s(b.id,d.id),b.id,s,"text"),v(`Sent to ${d.name||d.handle}!`,"success")}catch(_){console.error("Failed to send message:",_),v("Failed to send message","error")}finally{f(null)}}},$=[{name:"X",icon:Bt,color:"bg-black text-white",href:`https://twitter.com/intent/tweet?url=${encodeURIComponent(s)}`},{name:"Facebook",icon:qt,color:"bg-[#1877F2] text-white",href:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(s)}`},{name:"LinkedIn",icon:Ht,color:"bg-[#0A66C2] text-white",href:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(s)}`},{name:"WhatsApp",icon:Yt,color:"bg-[#25D366] text-white",href:`https://wa.me/?text=${encodeURIComponent(s)}`},{name:"Email",icon:Gt,color:"bg-zinc-600 text-white",href:`mailto:?body=${encodeURIComponent(s)}`}],S=async()=>{if(navigator.share)try{await navigator.share({title:r,url:s})}catch(d){d.name!=="AbortError"&&console.error("Native share failed:",d)}else w()};return(0,t.jsx)(kt,{isOpen:l,onClose:e,className:"max-w-[360px] overflow-hidden rounded-[32px] border border-black/10 bg-white/75 p-0 shadow-2xl backdrop-blur-xl dark:border-white/10 dark:bg-zinc-900/75 sm:max-w-[380px]",overlayClassName:i,children:(0,t.jsxs)("div",{className:"flex h-full flex-col",children:[(0,t.jsx)("div",{className:"flex items-center justify-center pt-6 pb-2",children:(0,t.jsx)("h2",{className:"text-[17px] font-semibold text-zinc-900 dark:text-zinc-50",children:r})}),(0,t.jsx)("div",{className:"px-5 py-3",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)(Zt,{className:"absolute left-3.5 top-1/2 size-4 -translate-y-1/2 text-zinc-400 transition-colors group-focus-within:text-violet-500"}),(0,t.jsx)("input",{type:"text",placeholder:"Search people...",value:n,onChange:d=>o(d.target.value),className:"w-full rounded-2xl border border-black/5 bg-black/5 py-3 pl-11 pr-4 text-[15px] outline-none transition-all focus:bg-white/50 focus:ring-4 focus:ring-violet-500/10 dark:border-white/5 dark:bg-white/5 dark:focus:bg-black/50"})]})}),(0,t.jsx)("div",{className:"no-scrollbar flex min-h-[110px] items-center gap-4 overflow-x-auto px-5 py-4",children:m?(0,t.jsx)("div",{className:"flex flex-1 justify-center",children:(0,t.jsx)("span",{className:"animate-pulse text-[13px] font-medium text-zinc-400",children:"Loading..."})}):p.length>0?p.map(d=>(0,t.jsxs)("button",{onClick:()=>C(d),disabled:g!==null,className:"group flex shrink-0 flex-col items-center gap-2 transition-transform active:scale-95 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"size-16 overflow-hidden rounded-full border-2 border-white/50 shadow-sm dark:border-zinc-800/50 bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)("img",{src:d.avatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${d.handle}`,alt:d.handle,className:"size-full object-cover"})}),g===d.id&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-full bg-black/40",children:(0,t.jsx)("span",{className:"animate-pulse text-white font-bold",children:"..."})})]}),(0,t.jsx)("span",{className:"max-w-[70px] truncate text-[11px] font-medium text-zinc-500 dark:text-zinc-400",children:d.name?.split(" ")[0]||d.handle})]},d.id)):(0,t.jsx)("div",{className:"flex-1 py-2 text-center",children:(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"No people found"})})}),(0,t.jsx)("div",{className:"mx-5 h-px bg-black/5 dark:bg-white/5"}),(0,t.jsxs)("div",{className:"grid grid-cols-5 gap-3 px-5 py-6",children:[$.map(d=>(0,t.jsxs)("a",{href:d.href,target:"_blank",rel:"noopener noreferrer",className:"group flex flex-col items-center gap-2.5",children:[(0,t.jsx)("div",{className:`size-12 ${d.color} flex items-center justify-center rounded-[18px] shadow-sm ring-1 ring-black/5 transition-all group-hover:-translate-y-1 group-hover:scale-105 group-hover:shadow-lg dark:ring-white/5`,children:(0,t.jsx)(d.icon,{size:22,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-wider text-zinc-500/80 dark:text-zinc-400/80",children:d.name})]},d.name)),(0,t.jsxs)("button",{onClick:S,className:"group flex flex-col items-center gap-2.5",children:[(0,t.jsx)("div",{className:"flex size-12 items-center justify-center rounded-[18px] border border-black/10 bg-white/50 text-zinc-600 shadow-sm transition-all group-hover:-translate-y-1 group-hover:scale-105 dark:border-white/10 dark:bg-white/5 dark:text-zinc-300",children:(0,t.jsx)(Ne,{size:22,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-wider text-zinc-500/80 dark:text-zinc-400/80",children:"More"})]})]}),(0,t.jsx)("div",{className:"px-5 pb-6",children:(0,t.jsxs)("div",{className:"group relative flex items-center overflow-hidden rounded-2xl border border-black/10 bg-white/40 dark:border-white/10 dark:bg-black/20",children:[(0,t.jsx)("input",{type:"text",readOnly:!0,value:s,className:"w-full bg-transparent py-4 pl-4 pr-16 text-[14px] font-medium text-zinc-600 outline-none dark:text-zinc-300"}),(0,t.jsx)("button",{onClick:w,className:`absolute right-1 text-[13px] font-bold active:scale-95 transition-all px-4 h-10 rounded-xl leading-none ${a?"text-emerald-500":"text-violet-600 hover:text-violet-700 dark:text-violet-400"}`,children:a?"Copied":"Copy"})]})}),(0,t.jsx)("div",{className:"border-t border-black/10 dark:border-white/10",children:(0,t.jsx)("button",{onClick:e,className:"flex h-16 w-full items-center justify-center text-[19px] font-medium text-zinc-500 transition-colors active:bg-black/5 dark:text-zinc-400 dark:active:bg-white/5",children:"Close"})})]})})},$t=yl,_t=X(),kl=l=>{const e=(0,_t.c)(6),{avatars:s}=l;if(!s||s.length===0)return null;let r,i;if(e[0]!==s){const c=s.slice(0,3);r="relative mt-2 h-7 w-7",i=c.map((n,o)=>{let p,h;return c.length===1?(p="top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",h="size-5"):c.length===2?(h="size-4",p=o===0?"top-0 right-0":"bottom-0 left-0"):(h=o===0?"size-3.5":"size-3",o===0?p="top-0 right-0":o===1?p="bottom-0 right-0":p="top-1/2 left-0 -translate-y-1/2"),(0,t.jsx)("div",{className:`absolute rounded-full border border-white bg-zinc-100 dark:border-black dark:bg-zinc-800 overflow-hidden shadow-sm ${p} ${h}`,style:{zIndex:10-o},children:(0,t.jsx)("img",{src:n,alt:"",className:"h-full w-full object-cover"})},o)}),e[0]=s,e[1]=r,e[2]=i}else r=e[1],i=e[2];let a;return e[3]!==r||e[4]!==i?(a=(0,t.jsx)("div",{className:r,children:i}),e[3]=r,e[4]=i,e[5]=a):a=e[5],a},pt=l=>{const e=(0,_t.c)(70),{id:s,user:r,isCurrentUser:i,isComment:a,onEdit:c,onDelete:n,addToast:o,trigger:p}=l,{openReport:h}=Nt(),[m,x]=(0,z.useState)(!1);if(gs("(min-width: 1024px)")){let N;e[0]!==p?(N=(0,t.jsx)(cs,{asChild:!0,onClick:Cl,children:(0,t.jsx)("div",{className:"cursor-pointer outline-none",children:p})}),e[0]=p,e[1]=N):N=e[1];let j;e[2]!==o||e[3]!==s||e[4]!==a?(j=!a&&(0,t.jsxs)(oe,{onClick:U=>{U.stopPropagation(),$e(`${rt()}/p/${s}`).then(()=>{o("Link copied"),x(!1)}).catch(()=>{o("Failed to copy link","error")})},children:[(0,t.jsx)(qe,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Copy link"})]}),e[2]=o,e[3]=s,e[4]=a,e[5]=j):j=e[5];let F;e[6]!==s||e[7]!==h?(F=U=>{U.stopPropagation(),h("post",s),x(!1)},e[6]=s,e[7]=h,e[8]=F):F=e[8];let M;e[9]===Symbol.for("react.memo_cache_sentinel")?(M=(0,t.jsx)(we,{className:"mr-2 h-4 w-4"}),e[9]=M):M=e[9];const I=a?"comment":"post";let D;e[10]!==I?(D=(0,t.jsxs)("span",{children:["Report ",I]}),e[10]=I,e[11]=D):D=e[11];let L;e[12]!==F||e[13]!==D?(L=(0,t.jsxs)(oe,{onClick:F,children:[M,D]}),e[12]=F,e[13]=D,e[14]=L):L=e[14];let O;e[15]!==i||e[16]!==h||e[17]!==r?(O=!i&&(0,t.jsxs)(oe,{onClick:U=>{U.stopPropagation(),h("user",r.id),x(!1)},children:[(0,t.jsx)(Ge,{className:"mr-2 h-4 w-4"}),(0,t.jsxs)("span",{children:["Report @",r.handle]})]}),e[15]=i,e[16]=h,e[17]=r,e[18]=O):O=e[18];let V;e[19]!==a||e[20]!==i||e[21]!==n||e[22]!==c?(V=i&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ys,{}),(0,t.jsxs)(oe,{onClick:U=>{U.stopPropagation(),c(),x(!1)},children:[(0,t.jsx)(Qe,{className:"mr-2 h-4 w-4"}),(0,t.jsxs)("span",{children:["Edit ",a?"Comment":"Post"]})]}),(0,t.jsxs)(oe,{className:"text-red-500 focus:text-red-500",onClick:U=>{U.stopPropagation(),n(),x(!1)},children:[(0,t.jsx)(He,{className:"mr-2 h-4 w-4"}),(0,t.jsxs)("span",{children:["Delete ",a?"comment":"post"]})]})]}),e[19]=a,e[20]=i,e[21]=n,e[22]=c,e[23]=V):V=e[23];let W;e[24]!==j||e[25]!==L||e[26]!==O||e[27]!==V?(W=(0,t.jsxs)(js,{align:"end",className:"w-56",onClick:$l,children:[j,L,O,V]}),e[24]=j,e[25]=L,e[26]=O,e[27]=V,e[28]=W):W=e[28];let B;return e[29]!==m||e[30]!==N||e[31]!==W?(B=(0,t.jsx)("div",{onClick:wl,children:(0,t.jsxs)(Ps,{open:m,onOpenChange:x,modal:!0,children:[N,W]})}),e[29]=m,e[30]=N,e[31]=W,e[32]=B):B=e[32],B}let g;e[33]===Symbol.for("react.memo_cache_sentinel")?(g=N=>{N.stopPropagation(),x(!0)},e[33]=g):g=e[33];let f;e[34]!==p?(f=(0,t.jsx)("div",{onClick:g,className:"cursor-pointer",children:p}),e[34]=p,e[35]=f):f=e[35];let v;e[36]===Symbol.for("react.memo_cache_sentinel")?(v=()=>x(!1),e[36]=v):v=e[36];let b;e[37]!==o||e[38]!==s||e[39]!==a?(b=!a&&(0,t.jsx)(ce,{icon:(0,t.jsx)(qe,{size:18}),onClick:N=>{N.stopPropagation(),$e(`${rt()}/p/${s}`).then(()=>{o("Link copied"),x(!1)}).catch(()=>{o("Failed to copy link","error")})},children:"Copy link"}),e[37]=o,e[38]=s,e[39]=a,e[40]=b):b=e[40];let u;e[41]===Symbol.for("react.memo_cache_sentinel")?(u=(0,t.jsx)(we,{size:18}),e[41]=u):u=e[41];let y;e[42]!==s||e[43]!==h?(y=N=>{N.stopPropagation(),h("post",s),x(!1)},e[42]=s,e[43]=h,e[44]=y):y=e[44];const w=a?"comment":"post";let C;e[45]!==y||e[46]!==w?(C=(0,t.jsxs)(ce,{icon:u,onClick:y,children:["Report ",w]}),e[45]=y,e[46]=w,e[47]=C):C=e[47];let $;e[48]!==i||e[49]!==h||e[50]!==r?($=!i&&(0,t.jsxs)(ce,{icon:(0,t.jsx)(Ge,{size:18}),onClick:N=>{N.stopPropagation(),h("user",r.id),x(!1)},children:["Report @",r.handle]}),e[48]=i,e[49]=h,e[50]=r,e[51]=$):$=e[51];let S;e[52]!==a||e[53]!==i||e[54]!==c?(S=i&&(0,t.jsxs)(ce,{icon:(0,t.jsx)(Qe,{size:18}),onClick:N=>{N.stopPropagation(),c(),x(!1)},children:["Edit ",a?"Comment":"Post"]}),e[52]=a,e[53]=i,e[54]=c,e[55]=S):S=e[55];let d;e[56]!==a||e[57]!==i||e[58]!==n?(d=i&&(0,t.jsxs)(ce,{variant:"destructive",icon:(0,t.jsx)(He,{size:18}),onClick:N=>{N.stopPropagation(),n(),x(!1)},children:["Delete ",a?"comment":"post"]}),e[56]=a,e[57]=i,e[58]=n,e[59]=d):d=e[59];let _;e[60]!==m||e[61]!==S||e[62]!==d||e[63]!==b||e[64]!==C||e[65]!==$?(_=(0,t.jsx)("div",{onClick:_l,children:(0,t.jsxs)(Rs,{isOpen:m,onClose:v,children:[b,C,$,S,d]})}),e[60]=m,e[61]=S,e[62]=d,e[63]=b,e[64]=C,e[65]=$,e[66]=_):_=e[66];let R;return e[67]!==_||e[68]!==f?(R=(0,t.jsxs)(t.Fragment,{children:[f,_]}),e[67]=_,e[68]=f,e[69]=R):R=e[69],R},Fe=({id:l,user:e,timeAgo:s,content:r,contentClass:i,media:a,quotedPost:c,stats:n,onClick:o,repostedBy:p,onUserClick:h,currentUser:m,poll:x,isDetail:g,initialComments:f,onDelete:v,onUpdate:b,isComment:u,onReply:y,community:w,parent_id:C,post_id:$,commenterAvatars:S=[]})=>{const d=bt(),{addToast:_}=Te(),{liked:R,reposted:N,localStats:j,setLocalStats:F,handleLike:M,handleRepost:I}=Ss($||l,n,m),{deletePost:D,updatePost:L}=ws(),{comments:O,fetchNextPage:V,hasNextPage:W,isFetchingNextPage:B,addComment:U,deleteComment:K,updateComment:k,isSubmitting:T}=it($||l,f),[E,A]=(0,z.useState)(""),[q,ee]=(0,z.useState)([]),[St,Re]=(0,z.useState)(!1),[Me,ne]=(0,z.useState)(!1),[fe,te]=(0,z.useState)(!1),[Y,xe]=(0,z.useState)(r),[ue,he]=(0,z.useState)(a||[]),[pe,re]=(0,z.useState)([]),[Ie,Ee]=(0,z.useState)(!1),[Ft,ye]=(0,z.useState)(!1),[ke,ge]=(0,z.useState)(null),[ze,De]=(0,z.useState)(!1),{comments:Tt,refetch:Le}=it($||l,void 0,ze?l:void 0),{ref:Ae,inView:Oe}=Lt({threshold:.5,triggerOnce:!0});(0,z.useEffect)(()=>{if(Oe&&!u&&l&&!l.startsWith("temp-")){const P=setTimeout(()=>{Fs(l).catch(console.error)},1500);return()=>clearTimeout(P)}},[Oe,l,u]);const Pt=(0,z.useCallback)(async()=>{!l||!$&&!l||j.comments===0||(De(!0),Le())},[l,$,j.comments,Le]),Ue=async()=>{const P=JSON.stringify(ue)!==JSON.stringify(a||[])||pe.length>0;if(!Y.trim()||Y===r&&!P){te(!1);return}Ee(!0);try{const H=[];for(const se of pe){const It=await _e(se);H.push(It)}const J=[...ue,...H];u?await k({commentId:l,content:Y,media:J}):await L(l,{content:Y,media:J}),re([]),te(!1),_(`${u?"Comment":"Post"} updated`),b&&b(l,Y,J)}catch(H){console.error(`Failed to update ${u?"comment":"post"}:`,H),_(`Failed to update ${u?"comment":"post"}`)}finally{Ee(!1)}},Ve=async P=>{P&&P.stopPropagation();try{u?await K(l):await D(l),_(`${u?"Comment":"Post"} deleted successfully`),v&&v(l)}catch(H){console.error(`Failed to delete ${u?"comment":"post"}:`,H),_(`Failed to delete ${u?"comment":"post"}`)}finally{ne(!1)}},Rt=async P=>{if(P.preventDefault(),!(!E.trim()&&q.length===0||!m)){Re(!0);try{const H=[];for(const J of q){const se=await _e(J);H.push(se)}await U({userId:m.id,content:E,media:H,replyToId:ke?.id}),A(""),ee([]),ge(null),F(J=>({...J,comments:(J.comments||0)+1})),_("Reply posted!")}catch(H){console.error("Failed to post comment:",H),_("Failed to post reply.")}finally{Re(!1)}}},Be=m?.handle===e.handle,Mt=(P,H)=>{ge(H?{handle:P,id:u?C||l:H}:null),A(J=>{const se=`@${P} `;return J.includes(se)?J:se+J}),document.getElementById("comment-input")?.focus()};return g?(0,t.jsxs)(G.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col",ref:Ae,children:[(0,t.jsxs)("article",{className:"p-6 dark:bg-black",children:[(0,t.jsx)(dt,{user:e,timeAgo:s,community:w,onUserClick:h,isDetail:!0,showAvatar:!0,actionsMenu:(0,t.jsx)(pt,{id:l,user:e,isCurrentUser:Be,isComment:u,onEdit:()=>te(!0),onDelete:()=>ne(!0),addToast:_,trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,t.jsx)(Ne,{size:20})})})}),(0,t.jsx)(mt,{content:r,isDetail:!0,isEditing:fe,editedContent:Y,setEditedContent:xe,onCancelEdit:()=>{te(!1),xe(r),he(a||[]),re([])},onSaveEdit:Ue,isUpdating:Ie,contentClass:i}),be(r)&&(0,t.jsx)(ht,{url:be(r)}),(0,t.jsx)(ft,{media:a,isEditing:fe,editedMedia:ue,setEditedMedia:he,newFiles:pe,setNewFiles:re}),x&&(0,t.jsx)(xt,{poll:x,onVote:P=>os(l,P,m.id)}),c&&(0,t.jsx)("div",{className:"mt-5 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm dark:border-zinc-700",children:(0,t.jsx)(ut,{...c})}),(0,t.jsx)(ct,{views:j.views||0,likes:j.likes||0,comments:j.comments||0,isDetail:!0}),(0,t.jsx)("div",{className:"my-4"}),(0,t.jsx)(ot,{liked:R,reposted:N,handleLike:M,handleRepost:I,handleCommentClick:()=>document.getElementById("comment-input")?.focus(),handleShareClick:()=>ye(!0),isDetail:!0,isComment:u})]}),ke&&(0,t.jsxs)("div",{className:"flex items-center justify-between bg-zinc-50 px-5 py-2 dark:bg-zinc-900/50",children:[(0,t.jsxs)("span",{className:"text-sm text-zinc-500",children:["Replying to"," ",(0,t.jsxs)("span",{className:"font-bold text-violet-600",children:["@",ke.handle]})]}),(0,t.jsx)("button",{onClick:()=>ge(null),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,t.jsx)(me,{size:16})})]}),(0,t.jsx)(wt,{currentUser:m,newComment:E,setNewComment:A,handleSubmitComment:Rt,loading:T,selectedFiles:q,setSelectedFiles:ee,isUploading:St}),(0,t.jsxs)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:[(0,t.jsx)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:(0,t.jsxs)(t.Fragment,{children:[W&&O.length>0&&(0,t.jsxs)("button",{onClick:()=>V(),disabled:B,className:"flex w-full items-center justify-center gap-2 py-3 text-sm font-bold text-violet-600 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[B&&(0,t.jsx)("span",{className:"animate-spin",children:"⌛"}),"View more replies"]}),O.map(P=>(0,t.jsx)(Fe,{...P,isComment:!0,post_id:l,onReply:Mt,onUserClick:h,currentUser:m,stats:{likes:P.stats?.likes||0,comments:P.stats?.comments||0,reposts:P.stats?.reposts||0},timeAgo:P.timeAgo||P.created_at},P.id))]})}),(0,t.jsx)(Ke,{open:Me,onOpenChange:ne,children:(0,t.jsxs)(st,{onClick:P=>P.stopPropagation(),children:[(0,t.jsxs)(lt,{children:[(0,t.jsx)(nt,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ze,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(Xe,{children:[(0,t.jsx)(et,{onClick:P=>P.stopPropagation(),children:"Cancel"}),(0,t.jsx)(tt,{onClick:Ve,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})]}):(0,t.jsxs)(G.article,{initial:{opacity:0,y:10},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-50px"},transition:{duration:.4,ease:"easeOut"},ref:Ae,onClick:o,className:`px-5 transition-all ${u?"py-3 bg-transparent hover:bg-zinc-50/30 dark:hover:bg-zinc-800/20":"py-5 bg-white hover:bg-zinc-50/30 dark:bg-black dark:hover:bg-white/[0.02]"} ${o?"cursor-pointer":""}`,children:[p&&(0,t.jsxs)("div",{className:"mb-2.5 ml-1 flex items-center space-x-1.5 text-[13px] font-semibold text-zinc-600",children:[(0,t.jsx)(Ce,{size:14,className:"text-zinc-500"}),(0,t.jsxs)("span",{className:"flex cursor-pointer items-center text-zinc-700 hover:underline dark:text-zinc-300",onClick:P=>{P.stopPropagation(),h&&h(p.handle)},children:[p.handle," Reposted"]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-x-3.5",children:[(0,t.jsxs)("div",{className:"flex shrink-0 flex-col items-center self-stretch pt-0.5",children:[(0,t.jsx)("div",{className:"cursor-pointer",onClick:P=>{P.stopPropagation(),h&&h(e.handle)},children:(0,t.jsxs)(ie,{className:`${u?"size-8":"size-10"} border-0 shadow-sm`,children:[(0,t.jsx)(le,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(ae,{className:"text-xs",children:e.handle[0]?.toUpperCase()})]})}),(!u&&j.comments>0||u&&!C&&j.comments>0)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mt-2 w-0.5 flex-1 rounded-full bg-zinc-100 dark:bg-zinc-800"}),!u&&(0,t.jsx)(kl,{avatars:S.length>0?S:(O||[]).slice(0,3).map(P=>P.user.avatar)})]})]}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,t.jsx)(dt,{user:e,timeAgo:s,community:w,onUserClick:h,isComment:u,actionsMenu:(0,t.jsx)(pt,{id:l,user:e,isCurrentUser:Be,isComment:u,onEdit:()=>te(!0),onDelete:()=>ne(!0),addToast:_,trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 group-hover:bg-zinc-100 dark:hover:bg-zinc-800 dark:group-hover:bg-zinc-800/50",children:(0,t.jsx)(Ne,{size:18})})})}),(0,t.jsx)(mt,{content:r,isEditing:fe,editedContent:Y,setEditedContent:xe,onCancelEdit:()=>{te(!1),xe(r),he(a||[]),re([])},onSaveEdit:Ue,isUpdating:Ie,contentClass:i}),be(r)&&(0,t.jsx)(ht,{url:be(r)}),(0,t.jsx)(ft,{media:a,isEditing:fe,editedMedia:ue,setEditedMedia:he,newFiles:pe,setNewFiles:re}),x&&(0,t.jsx)(xt,{poll:x}),c&&(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-900",onClick:P=>{P.stopPropagation(),d(`/p/${c.id}`)},children:(0,t.jsx)(ut,{...c})}),(0,t.jsx)(ot,{liked:R,reposted:N,handleLike:M,handleRepost:I,handleCommentClick:P=>{if(P?.stopPropagation(),y){const H=u&&C||l;y(e.handle,H)}else o&&o()},handleShareClick:P=>{P?.stopPropagation(),ye(!0)},isComment:u}),(0,t.jsx)(ct,{views:j.views||0,likes:j.likes||0,comments:j.comments||0,isComment:u,onRepliesClick:()=>{ze?De(!1):Pt()}}),ze&&(0,t.jsxs)("div",{className:"relative mt-2 space-y-0",children:[(0,t.jsx)("div",{className:"absolute left-[19px] top-0 bottom-4 w-0.5 bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsx)("div",{className:"flex flex-col",children:Tt.map(P=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute left-[19px] top-5 h-0.5 w-4 bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsx)("div",{className:"pl-6",children:(0,t.jsx)(Fe,{...P,isComment:!0,post_id:$||l,onReply:y,onUserClick:h,currentUser:m,stats:{likes:P.stats?.likes||0,comments:P.stats?.comments||0,reposts:P.stats?.reposts||0},timeAgo:P.timeAgo||P.created_at})})]},P.id))})]}),(0,t.jsx)($t,{isOpen:Ft,onClose:()=>ye(!1),url:`${window.location.origin}/p/${l}`,title:"Share Post",overlayClassName:"z-[9999]"}),(0,t.jsx)(Ke,{open:Me,onOpenChange:ne,children:(0,t.jsxs)(st,{onClick:P=>P.stopPropagation(),children:[(0,t.jsxs)(lt,{children:[(0,t.jsx)(nt,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ze,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(Xe,{children:[(0,t.jsx)(et,{onClick:P=>P.stopPropagation(),children:"Cancel"}),(0,t.jsx)(tt,{onClick:Ve,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})]})]})};function zl(l,e){const s=!l.media&&!e.media||l.media?.length===e.media?.length&&l.media?.every((i,a)=>i.url===e.media?.[a].url),r=l.repostedBy?.handle===e.repostedBy?.handle;return l.id===e.id&&l.content===e.content&&l.timeAgo===e.timeAgo&&l.user.id===e.user.id&&l.user.avatar===e.user.avatar&&l.stats.likes===e.stats.likes&&l.stats.comments===e.stats.comments&&l.stats.reposts===e.stats.reposts&&l.currentUser?.id===e.currentUser?.id&&!!s&&!!r}var Nl=z.memo(Fe,zl);function wl(l){return l.stopPropagation()}function Cl(l){return l.stopPropagation()}function $l(l){return l.stopPropagation()}function _l(l){return l.stopPropagation()}var Q=null;const Ol=()=>{Q=null};var Sl=z.memo(({reel:l,isActive:e,volume:s,shouldLoad:r=!0})=>{const{currentUser:i}=yt(),{addToast:a}=Te(),{openReport:c}=Nt(),n=(0,z.useRef)(null),[o,p]=(0,z.useState)(!1),[h,m]=(0,z.useState)(!1),[x,g]=(0,z.useState)(!1),[f,v]=(0,z.useState)(!1),[b,u]=(0,z.useState)(null),[y,w]=(0,z.useState)(!1),[C,$]=(0,z.useState)(l.stats?.likes||0),[S,d]=(0,z.useState)(!1),[_,R]=(0,z.useState)(0),[N,j]=(0,z.useState)(!1),F=(0,z.useRef)(null),M=(0,z.useMemo)(()=>Array.isArray(l.media)?l.media[0]?.src||l.media[0]?.url:l.media?.src||l.media?.url||l.url,[l.media,l.url]);(0,z.useEffect)(()=>{v(!1),j(!1);const k=n.current?.plyr;if(k&&typeof k.on=="function"){const T=()=>v(!0),E=()=>j(!0);k.on("ready",T),k.on("canplay",T),k.on("loadeddata",T),k.on("playing",E);const A=setTimeout(()=>{!N&&e&&j(!0)},3e3);return()=>{clearTimeout(A),typeof k.off=="function"&&(k.off("ready",T),k.off("canplay",T),k.off("loadeddata",T),k.off("playing",E))}}else{const T=setTimeout(()=>{v(!0),e&&j(!0)},1500);return()=>clearTimeout(T)}},[M,e]);const I=(0,z.useRef)(null);(0,z.useEffect)(()=>{const k=n.current?.plyr;if(I.current&&(clearTimeout(I.current),I.current=null),!(!k||!f))return e?I.current=setTimeout(()=>{I.current=null;const T=n.current?.plyr;T&&typeof T.play=="function"&&(Q&&Q!==T&&(Q.pause(),typeof Q.currentTime<"u"&&(Q.currentTime=0)),T.play().catch(()=>{const E=n.current?.plyr;E&&(E.muted=!0,E.play().catch(()=>{}))}).then(()=>{Q=T}))},50):typeof k.pause=="function"&&(k.pause(),typeof k.currentTime<"u"&&(k.currentTime=0),Q===k&&(Q=null)),()=>{I.current&&(clearTimeout(I.current),I.current=null);const T=n.current?.plyr;T&&typeof T.pause=="function"&&(T.pause(),typeof T.currentTime<"u"&&(T.currentTime=0),Q===T&&(Q=null))}},[e,f]),(0,z.useEffect)(()=>()=>{I.current&&(clearTimeout(I.current),I.current=null);const k=n.current?.plyr;k&&(k.pause(),k.currentTime=0,Q===k&&(Q=null)),v(!1),j(!1),R(0)},[]),(0,z.useEffect)(()=>{if(!i?.id||!e)return;(async()=>{try{const[T,E]=await Promise.all([vs(l.id,i.id),hs(i.id,l.user?.id)]);w(T),d(E)}catch(T){console.error("Failed to check interaction status:",T)}})()},[l.id,i?.id,e,l.user?.id]),(0,z.useEffect)(()=>{const k=n.current?.plyr;k&&(k.muted=s===0,k.volume=s)},[s,f]),(0,z.useEffect)(()=>{const k=n.current?.plyr;if(!k||!e)return;const T=()=>{const E=k.currentTime,A=k.duration;A>0&&R(E/A*100)};if(typeof k.on=="function")return k.on("timeupdate",T),()=>{typeof k.off=="function"&&k.off("timeupdate",T)}},[e]);const D=k=>{k.stopPropagation();const T=k.currentTarget.getBoundingClientRect(),E=k.clientX-T.left,A=Math.min(Math.max(0,E/T.width),1),q=n.current?.plyr;q&&q.duration&&(q.currentTime=A*q.duration,R(A*100))};(0,z.useEffect)(()=>()=>{F.current&&clearTimeout(F.current)},[]);const L=k=>{const T=k.target;T.closest("button")||T.closest("a")||T.closest(".plyr__controls")||(F.current?(clearTimeout(F.current),F.current=null,V()):F.current=setTimeout(()=>{F.current=null,O()},250))},O=()=>{const k=n.current?.plyr;k&&(k.paused?(k.play().catch(()=>{}),u("play")):(k.pause(),u("pause")),setTimeout(()=>u(null),800))},V=async()=>{if(i&&(p(!0),setTimeout(()=>p(!1),800),!y)){w(!0),$(k=>k+1);try{await Je(l.id,i.id)}catch{w(!1),$(k=>k-1)}}},W=async k=>{if(k.stopPropagation(),!i)return;const T=!y;w(T),$(E=>T?E+1:E-1);try{await Je(l.id,i.id)}catch{w(!T),$(E=>T?E-1:E+1)}},B=async k=>{if(k.stopPropagation(),!i)return;const T=!S;d(T);try{await us(i.id,l.user?.id)}catch{d(!T)}},U=k=>{k.stopPropagation(),g(!0)},K=(0,z.useMemo)(()=>({source:{type:"video",sources:[{src:M,type:"video/mp4"}]},options:{controls:[],loop:{active:!0},clickToPlay:!1,ratio:"9:16",autoplay:!1,playsinline:!0,muted:!0}}),[M]);return(0,t.jsxs)("div",{"data-id":l.id,className:"reel-item relative flex h-[100dvh] w-full snap-start items-center justify-center overflow-hidden bg-black cursor-pointer select-none",onClick:L,children:[(0,t.jsxs)("div",{className:"relative flex h-full w-full max-w-[450px] items-center justify-center",children:[(0,t.jsx)("div",{className:"w-full",children:r?(0,t.jsx)(as,{ref:n,...K}):(0,t.jsx)("div",{className:"aspect-[9/16] w-full bg-zinc-900",children:(0,t.jsx)("img",{src:l.media?.[0]?.preview||l.media?.[0]?.thumbnail||M,className:"h-full w-full object-cover opacity-50 blur-xl",alt:"Reel preview"})})}),!N&&(0,t.jsx)("div",{className:"absolute inset-0 z-[60] flex items-center justify-center bg-zinc-900 pointer-events-none",children:(0,t.jsx)(zs,{})}),(0,t.jsx)(Se,{children:o&&(0,t.jsx)(G.div,{initial:{scale:0,opacity:0},animate:{scale:[0,1.2,1],opacity:1},exit:{scale:1.5,opacity:0},transition:{duration:.5,type:"spring",stiffness:400,damping:20},className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)(ve,{size:120,fill:"white",className:"text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.4)]"})})}),(0,t.jsx)(Se,{children:b&&(0,t.jsx)(G.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},transition:{duration:.4},className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"rounded-full border border-white/20 bg-white/10 p-8 shadow-2xl backdrop-blur-md",children:b==="play"?(0,t.jsx)(es,{size:50,fill:"white",className:"ml-1.5 text-white"}):(0,t.jsx)(ls,{size:50,fill:"white",className:"text-white"})})})}),(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/60"}),(0,t.jsxs)("div",{className:"pointer-events-none absolute bottom-6 left-4 right-16 text-white",children:[(0,t.jsxs)("div",{className:"pointer-events-auto mb-3 flex items-center gap-2",children:[(0,t.jsxs)(Et,{to:`/u/${l.user?.handle}`,className:"flex items-center gap-2 transition-opacity hover:opacity-80 active:scale-95",onClick:k=>k.stopPropagation(),children:[(0,t.jsxs)(ie,{className:"size-10 border-2 border-white",children:[(0,t.jsx)(le,{src:l.user?.avatar,alt:l.user?.handle,className:"object-cover"}),(0,t.jsx)(ae,{children:l.user?.handle?.[0]?.toUpperCase()})]}),(0,t.jsxs)("span",{className:"font-bold",children:["@",l.user?.handle]})]}),i?.id!==l.user?.id&&(0,t.jsx)("button",{className:`ml-2 flex items-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-bold transition-all active:scale-95 ${S?"border border-white/50 bg-transparent text-white":"bg-white text-black hover:bg-zinc-200"}`,onClick:B,children:S?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ds,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Following"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ps,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Follow"})]})})]}),(0,t.jsx)(Pe,{content:l.content,className:"mb-3 line-clamp-2 text-sm text-white"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[(0,t.jsx)(ts,{size:14,className:"animate-spin-slow"}),(0,t.jsxs)("span",{children:["Original Audio - ",l.user?.handle]})]})]}),(0,t.jsxs)("div",{className:"absolute bottom-6 right-2 z-10 flex flex-col items-center gap-6",children:[(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)(G.button,{whileTap:{scale:.8},className:`rounded-full p-3 backdrop-blur-md transition-all ${y?"bg-rose-500/20 text-rose-500":"bg-zinc-800/50 text-white hover:bg-zinc-700"}`,onClick:W,children:(0,t.jsx)(G.div,{animate:y?{scale:[1,1.3,1]}:{scale:1},transition:{duration:.3},children:(0,t.jsx)(ve,{size:28,fill:y?"currentColor":"none"})})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:C})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)(G.button,{whileTap:{scale:.8},className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700",onClick:k=>{k.stopPropagation(),m(!0)},children:(0,t.jsx)(zt,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:l.stats?.comments||0})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)(G.button,{whileTap:{scale:.8},className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700",onClick:U,children:(0,t.jsx)(je,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:l.stats?.shares||0})]}),(0,t.jsx)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:(0,t.jsx)(G.button,{whileTap:{scale:.8},className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-rose-500/20 hover:text-rose-500",onClick:k=>{k.stopPropagation(),c("reel",l.id)},children:(0,t.jsx)(we,{size:28})})})]}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 z-50 h-[3px] w-full bg-white/20 hover:h-[8px] transition-all cursor-pointer group",onClick:D,children:(0,t.jsx)("div",{className:"h-full bg-white shadow-[0_0_8px_rgba(255,255,255,0.8)] transition-all duration-100 ease-linear relative",style:{width:`${_}%`},children:(0,t.jsx)("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 size-3 bg-white rounded-full shadow-lg scale-0 group-hover:scale-100 transition-transform"})})})]}),(0,t.jsx)(Tl,{isOpen:h,onClose:()=>m(!1),reelId:l.id,currentUser:i,showToast:a}),(0,t.jsx)($t,{isOpen:x,onClose:()=>g(!1),url:`${window.location.origin}/r/${l.id}`,title:"Share Reel",overlayClassName:"z-[9999]"})]})},(l,e)=>l.isActive===e.isActive&&l.reel.id===e.reel.id&&l.volume===e.volume&&l.shouldLoad===e.shouldLoad),Ul=Sl,Fl=({isOpen:l,onClose:e,reelId:s,currentUser:r,showToast:i})=>{const[a,c]=(0,z.useState)([]),[n,o]=(0,z.useState)(!1),[p,h]=(0,z.useState)(!1),[m,x]=(0,z.useState)(""),[g,f]=(0,z.useState)([]),[v,b]=(0,z.useState)(!1),[u,y]=(0,z.useState)(!0),[w,C]=(0,z.useState)(!1),[$,S]=(0,z.useState)(null),d=(0,z.useRef)(a);(0,z.useEffect)(()=>{d.current=a},[a]);const _=(0,z.useCallback)(async(N=!1)=>{if(!(!s||s.startsWith("temp-"))){N?C(!0):o(!0);try{const j=d.current,F=await rs(s,N&&j.length>0?j[j.length-1].created_at:null,10);F.length<10?y(!1):y(!0),c(N?M=>[...M,...F]:F)}catch(j){console.error("Failed to load comments:",j),i&&i("Failed to load comments","error")}finally{o(!1),C(!1)}}},[s,i]);(0,z.useEffect)(()=>{l&&s?_():(c([]),y(!0))},[l,s,_]);const R=async N=>{if(N.preventDefault(),!(!m.trim()&&g.length===0||!r)){h(!0),b(!0);try{const j=[];for(const F of g){const M=await _e(F);j.push(M)}await Ts(s,r.id,m,j,$?.id),x(""),f([]),S(null),i&&i("Reply posted!"),_()}catch(j){console.error("Failed to post comment:",j),i&&i("Failed to post reply.","error")}finally{h(!1),b(!1)}}};return(0,t.jsx)(kt,{isOpen:l,onClose:e,title:"Comments",className:"max-sm:h-[95dvh] h-[85vh] overflow-hidden !p-0 sm:max-w-xl",children:(0,t.jsxs)("div",{className:"flex h-full flex-col overflow-hidden bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"mx-auto my-3 h-1.5 w-12 shrink-0 rounded-full bg-zinc-200 dark:bg-zinc-800 sm:hidden"}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto scroll-smooth scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800",children:n?(0,t.jsx)("div",{className:"flex flex-col",children:[1,2,3].map(N=>(0,t.jsx)(ks,{},N))}):a.length>0?(0,t.jsxs)("div",{className:"flex flex-col",children:[a.map(N=>(0,t.jsx)(Nl,{...N,isComment:!0,post_id:s,currentUser:r,showToast:i,onReply:(j,F)=>{S(F?{handle:j,id:F}:null),x(M=>M.includes(`@${j}`)?M:M+`@${j} `)},onDelete:j=>c(F=>F.filter(M=>M.id!==j)),onUpdate:(j,F,M)=>c(I=>I.map(D=>D.id===j?{...D,content:F,media:M}:D))},N.id)),u&&(0,t.jsx)("div",{className:"flex justify-center border-t border-zinc-100 py-4 dark:border-zinc-800",children:(0,t.jsx)(jt,{variant:"ghost",onClick:()=>_(!0),loading:w,className:"text-violet-600 font-bold",children:"View more replies"})})]}):(0,t.jsxs)("div",{className:"flex h-full min-h-[300px] flex-col items-center justify-center p-8 text-center text-zinc-500",children:[(0,t.jsx)("div",{className:"mb-4 flex size-16 items-center justify-center rounded-full bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(vt,{size:32,className:"text-zinc-400"})}),(0,t.jsx)("p",{className:"text-lg font-bold dark:text-zinc-300",children:"No comments yet"}),(0,t.jsx)("p",{className:"text-sm dark:text-zinc-500",children:"Be the first to share what you think!"})]})}),(0,t.jsxs)("div",{className:"shrink-0 border-t border-zinc-100 bg-white pb-safe dark:border-zinc-800 dark:bg-zinc-900",children:[$&&(0,t.jsxs)("div",{className:"flex items-center justify-between border-b border-zinc-50 bg-zinc-50/50 px-4 py-2 dark:border-zinc-800/50 dark:bg-zinc-900/50",children:[(0,t.jsxs)("span",{className:"text-xs text-zinc-500",children:["Replying to"," ",(0,t.jsxs)("span",{className:"font-bold text-violet-600",children:["@",$.handle]})]}),(0,t.jsx)("button",{onClick:()=>S(null),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,t.jsx)(me,{size:14})})]}),(0,t.jsx)(wt,{currentUser:r,newComment:m,setNewComment:x,handleSubmitComment:R,loading:p,selectedFiles:g,setSelectedFiles:f,isUploading:v})]})]})})},Tl=Fl;export{Ol as n,Nl as r,Ul as t};
