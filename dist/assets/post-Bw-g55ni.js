import{a as Mt}from"./rolldown-runtime-BaZ8gS7u.js";import{c as Y,d as Xt,l as Zt,n as Yt,v as Et,w as es}from"./framework-3lkjbTvb.js";import{a as ts,r as ss}from"./query-CZHA9T67.js";import{$t as ls,At as $e,Bn as is,Dn as as,En as ns,Fn as Le,Gn as rs,Gt as at,Hn as os,Ht as cs,Jn as ds,Kn as Ue,Ln as nt,Lt as rt,Sn as ms,Un as fs,Vt as ot,Zt as ct,an as Ae,cn as dt,dn as us,er as xs,gn as hs,hn as ps,in as gs,on as Ve,pn as bs,rn as Be,sn as mt,un as vs,yn as It,zn as We,zt as js}from"./ui-libs-oBja7Jpd.js";import{n as ys}from"./media-libs-C98UjHPF.js";import{Cn as ks,Dn as zs,En as ft,Et as Ns,Gt as ut,Hn as xt,In as Se,Jt as ht,Kt as pt,Ln as qe,Mn as ws,N as Cs,On as Ss,Pn as _e,Pt as _s,R as $s,Rn as Me,Sn as Ps,St as Ts,Tt as Fs,Un as Rs,Ut as Lt,Wt as gt,Xt as bt,Yt as vt,Zt as jt,_ as Ms,_n as Es,cn as Is,ct as Ls,dn as At,dt as As,en as Q,et as Ds,fn as Os,g as yt,gn as Us,gt as Dt,hn as kt,in as Ne,it as Vs,ln as Je,nn as we,on as Ot,qt as zt,rn as Ce,rt as Bs,sn as Ws,st as qs,tn as He,tt as Ut,ut as De,v as Hs,wn as Vt,wt as ke,xn as Gs,xt as Qs,z as Js}from"./index-CkzoBLwx.js";import{a as Ks,i as Ge,n as Nt,r as Ke}from"./VideoPlayer-D2EsucdO.js";import{n as ze,t as Xs}from"./actionsheet-DWHzhXjJ.js";var Zs=Y(),z=Mt(es(),1),t=Mt(Zt(),1),Ys=l=>{const e=(0,Zs.c)(37),{isComment:s,liked:r,reposted:i,handleLike:a,handleRepost:o,handleCommentClick:n,handleShareClick:c,isDetail:h}=l;if(h!==void 0&&h){let w;e[0]!==a||e[1]!==r?(w=(0,t.jsx)(ge,{icon:Le,label:"Like",type:"like",onClick:a,active:r}),e[0]=a,e[1]=r,e[2]=w):w=e[2];let N;e[3]!==o||e[4]!==s||e[5]!==i?(N=!s&&(0,t.jsx)(ge,{icon:Be,label:"Repost",type:"repost",onClick:o,active:i}),e[3]=o,e[4]=s,e[5]=i,e[6]=N):N=e[6];let S;e[7]!==n?(S=(0,t.jsx)(ge,{icon:Ut,label:"Comment",type:"comment",onClick:n}),e[7]=n,e[8]=S):S=e[8];let C;e[9]!==c||e[10]!==s?(C=!s&&(0,t.jsx)(ge,{icon:De,label:"Share",type:"share",onClick:c}),e[9]=c,e[10]=s,e[11]=C):C=e[11];let m;return e[12]!==w||e[13]!==N||e[14]!==S||e[15]!==C?(m=(0,t.jsxs)("div",{className:"mt-5 flex w-full items-center justify-around py-2",children:[w,N,S,C]}),e[12]=w,e[13]=N,e[14]=S,e[15]=C,e[16]=m):m=e[16],m}const g=`flex items-center gap-x-1.5 ${s?"mt-2":"mt-3.5"}`,f=s?16:18;let x;e[17]!==a||e[18]!==r||e[19]!==f?(x=(0,t.jsx)(ge,{icon:Le,size:f,type:"like",onClick:a,active:r}),e[17]=a,e[18]=r,e[19]=f,e[20]=x):x=e[20];const u=s?16:18;let d;e[21]!==n||e[22]!==u?(d=(0,t.jsx)(ge,{icon:It,size:u,type:"comment",onClick:n}),e[21]=n,e[22]=u,e[23]=d):d=e[23];const v=s?16:18;let b;e[24]!==o||e[25]!==i||e[26]!==v?(b=(0,t.jsx)(ge,{icon:Be,size:v,type:"repost",onClick:o,active:i}),e[24]=o,e[25]=i,e[26]=v,e[27]=b):b=e[27];let p;e[28]!==c||e[29]!==s?(p=!s&&c&&(0,t.jsx)(ge,{icon:De,type:"share",onClick:c}),e[28]=c,e[29]=s,e[30]=p):p=e[30];let j;return e[31]!==g||e[32]!==x||e[33]!==d||e[34]!==b||e[35]!==p?(j=(0,t.jsxs)("div",{className:g,children:[x,d,b,p]}),e[31]=g,e[32]=x,e[33]=d,e[34]=b,e[35]=p,e[36]=j):j=e[36],j},wt=Ys,el=Y(),tl=l=>{const e=(0,el.c)(38),{views:s,likes:r,comments:i,isDetail:a,isComment:o,onRepliesClick:n}=l,c=a===void 0?!1:a,h=o===void 0?!1:o;if(c){const b=s||0;let p;e[0]!==b?(p=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:b}),e[0]=b,e[1]=p):p=e[1];let j;e[2]===Symbol.for("react.memo_cache_sentinel")?(j=(0,t.jsx)("span",{className:"opacity-70",children:"Views"}),e[2]=j):j=e[2];let w;e[3]!==p?(w=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[p," ",j]}),e[3]=p,e[4]=w):w=e[4];const N=r||0;let S;e[5]!==N?(S=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:N}),e[5]=N,e[6]=S):S=e[6];let C;e[7]===Symbol.for("react.memo_cache_sentinel")?(C=(0,t.jsx)("span",{className:"opacity-70",children:"Likes"}),e[7]=C):C=e[7];let m;e[8]!==S?(m=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[S," ",C]}),e[8]=S,e[9]=m):m=e[9];const F=i||0;let E;e[10]!==F?(E=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:F}),e[10]=F,e[11]=E):E=e[11];let T;e[12]===Symbol.for("react.memo_cache_sentinel")?(T=(0,t.jsx)("span",{className:"opacity-70",children:"Comments"}),e[12]=T):T=e[12];let y;e[13]!==E?(y=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[E," ",T]}),e[13]=E,e[14]=y):y=e[14];let $;return e[15]!==m||e[16]!==y||e[17]!==w?($=(0,t.jsxs)("div",{className:"mt-5 flex items-center gap-x-6 border-b border-zinc-100 pb-4 text-sm text-zinc-500 dark:border-zinc-800 dark:text-zinc-400",children:[w,m,y]}),e[15]=m,e[16]=y,e[17]=w,e[18]=$):$=e[18],$}if(i===0&&r===0&&(s===0||h))return null;const g=`mt-2 flex items-center gap-x-2 px-0.5 ${h?"text-[12px]":"text-[14px]"} font-medium text-zinc-500 dark:text-zinc-400`;let f;e[19]!==i||e[20]!==h||e[21]!==r||e[22]!==s?(f=s>0&&!h&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{className:"hover:underline",children:[s," ",s===1?"view":"views"]}),(i>0||r>0)&&(0,t.jsx)("span",{className:"opacity-50",children:"·"})]}),e[19]=i,e[20]=h,e[21]=r,e[22]=s,e[23]=f):f=e[23];let x;e[24]!==i||e[25]!==n?(x=i>0&&(0,t.jsxs)("button",{className:"hover:underline",onClick:b=>{b.stopPropagation(),n&&n(b)},children:[i," ",i===1?"reply":"replies"]}),e[24]=i,e[25]=n,e[26]=x):x=e[26];let u;e[27]!==i||e[28]!==r?(u=i>0&&r>0&&(0,t.jsx)("span",{className:"opacity-50",children:"·"}),e[27]=i,e[28]=r,e[29]=u):u=e[29];let d;e[30]!==r?(d=r>0&&(0,t.jsxs)("button",{className:"hover:underline",children:[r," ",r===1?"like":"likes"]}),e[30]=r,e[31]=d):d=e[31];let v;return e[32]!==g||e[33]!==f||e[34]!==x||e[35]!==u||e[36]!==d?(v=(0,t.jsxs)("div",{className:g,children:[f,x,u,d]}),e[32]=g,e[33]=f,e[34]=x,e[35]=u,e[36]=d,e[37]=v):v=e[37],v},Ct=tl,sl=Y(),ll=l=>{const e=(0,sl.c)(53),{user:s,timeAgo:r,community:i,onUserClick:a,actionsMenu:o,isComment:n,isDetail:c,showAvatar:h,isPinned:g}=l,f=h===void 0?!1:h,x=g===void 0?!1:g,u=Et();let d;e[0]!==a||e[1]!==s.handle?(d=O=>{O.stopPropagation(),a&&a(s.handle)},e[0]=a,e[1]=s.handle,e[2]=d):d=e[2];const v=d;let b;e[3]!==i||e[4]!==u?(b=O=>{O.stopPropagation(),i&&u(`/c/${i.handle}`)},e[3]=i,e[4]=u,e[5]=b):b=e[5];const p=b,j=`flex items-center justify-between ${c?"pb-5":"min-h-[40px] mb-2"}`;let w;e[6]!==v||e[7]!==n||e[8]!==c||e[9]!==f||e[10]!==s.avatar||e[11]!==s.handle?(w=f&&(0,t.jsx)("button",{className:"shrink-0",onClick:v,children:(0,t.jsxs)(we,{className:`${c?"size-12":n?"size-8":"size-10"} border-0 shadow-sm`,children:[(0,t.jsx)(Ne,{src:s.avatar,alt:s.handle,className:"object-cover"}),(0,t.jsx)(Ce,{className:"text-xs",children:s.handle[0]?.toUpperCase()})]})}),e[6]=v,e[7]=n,e[8]=c,e[9]=f,e[10]=s.avatar,e[11]=s.handle,e[12]=w):w=e[12];const N=`flex shrink-0 items-center gap-1 font-bold text-zinc-900 hover:underline dark:text-white ${c?"text-base sm:text-lg":n?"text-[14px]":"text-[15px]"}`;let S;e[13]!==s.handle?(S=(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:s.handle}),e[13]=s.handle,e[14]=S):S=e[14];let C;e[15]!==n||e[16]!==c||e[17]!==s.role?(C=s.role==="admin"&&(0,t.jsx)(Ds,{size:c?28:n?22:24}),e[15]=n,e[16]=c,e[17]=s.role,e[18]=C):C=e[18];let m;e[19]!==n||e[20]!==c||e[21]!==s.isPro||e[22]!==s.verified?(m=s.verified?(0,t.jsx)(As,{size:c?16:n?12:14}):s.isPro&&(0,t.jsx)(Ls,{size:c?16:n?12:14}),e[19]=n,e[20]=c,e[21]=s.isPro,e[22]=s.verified,e[23]=m):m=e[23];let F;e[24]!==v||e[25]!==m||e[26]!==N||e[27]!==S||e[28]!==C?(F=(0,t.jsxs)("button",{className:N,onClick:v,children:[S,C,m]}),e[24]=v,e[25]=m,e[26]=N,e[27]=S,e[28]=C,e[29]=F):F=e[29];let E;e[30]!==i||e[31]!==p||e[32]!==c?(E=i&&(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-1 text-zinc-500",children:[(0,t.jsx)("span",{className:"text-zinc-400",children:"›"}),(0,t.jsxs)("button",{className:`flex items-center gap-1 font-bold text-zinc-900 hover:underline dark:text-zinc-100 ${c?"text-[14px] sm:text-[15px]":"text-[13px]"}`,onClick:p,children:[(0,t.jsxs)(we,{className:"size-5 shrink-0",children:[(0,t.jsx)(Ne,{src:i.avatar,alt:i.name,className:"object-cover"}),(0,t.jsx)(Ce,{className:"text-[8px] font-bold text-zinc-500",children:i.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:i.name})]})]}),e[30]=i,e[31]=p,e[32]=c,e[33]=E):E=e[33];let T;e[34]!==F||e[35]!==E?(T=(0,t.jsx)("div",{className:"flex min-w-0 flex-1 flex-col",children:(0,t.jsx)("div",{className:"flex flex-wrap items-start gap-x-1.5 leading-none sm:items-center",children:(0,t.jsxs)("div",{className:"flex min-w-0 max-w-full flex-col gap-y-1 sm:flex-row sm:items-center sm:gap-x-1.5",children:[F,E]})})}),e[34]=F,e[35]=E,e[36]=T):T=e[36];let y;e[37]!==T||e[38]!==w?(y=(0,t.jsxs)("div",{className:"flex items-center gap-x-3.5 flex-1 min-w-0",children:[w,T]}),e[37]=T,e[38]=w,e[39]=y):y=e[39];let $;e[40]!==n||e[41]!==x?($=x&&!n&&(0,t.jsx)("div",{className:"flex items-center justify-center p-1 opacity-80",children:(0,t.jsx)(Ve,{size:14,className:"fill-zinc-400 text-zinc-400 dark:fill-zinc-500 dark:text-zinc-500"})}),e[40]=n,e[41]=x,e[42]=$):$=e[42];const P=r||"Recent";let M;e[43]!==P?(M=(0,t.jsx)("span",{className:"whitespace-nowrap text-[12px] text-zinc-500 dark:text-zinc-400",children:P}),e[43]=P,e[44]=M):M=e[44];let I;e[45]!==o||e[46]!==$||e[47]!==M?(I=(0,t.jsxs)("div",{className:"-mt-1 flex items-center gap-2.5",children:[$,M,o]}),e[45]=o,e[46]=$,e[47]=M,e[48]=I):I=e[48];let A;return e[49]!==y||e[50]!==I||e[51]!==j?(A=(0,t.jsxs)("div",{className:j,children:[y,I]}),e[49]=y,e[50]=I,e[51]=j,e[52]=A):A=e[52],A},St=ll,il=Y(),al=l=>{const e=(0,il.c)(40),{content:s,isDetail:r,isEditing:i,editedContent:a,setEditedContent:o,onCancelEdit:n,onSaveEdit:c,isUpdating:h,contentClass:g}=l,[f,x]=(0,z.useState)(!1),u=typeof s=="string"&&xt(s);if(i&&o){let F;e[0]!==o?(F=O=>o(O.target.value),e[0]=o,e[1]=F):F=e[1];const E=`min-h-[100px] w-full rounded-xl border-zinc-200 bg-zinc-50 focus:ring-violet-500 dark:border-zinc-800 dark:bg-zinc-900 ${xt(a||"")?"font-bangla text-lg":"font-english"}`;let T;e[2]!==a||e[3]!==F||e[4]!==E?(T=(0,t.jsx)(Cs,{value:a,onChange:F,className:E,autoFocus:!0}),e[2]=a,e[3]=F,e[4]=E,e[5]=T):T=e[5];let y;e[6]!==n?(y=(0,t.jsx)("button",{onClick:n,className:"px-4 py-1.5 text-sm font-bold text-zinc-500 transition-colors hover:text-zinc-700 dark:hover:text-zinc-300",children:"Cancel"}),e[6]=n,e[7]=y):y=e[7];let $;e[8]!==s||e[9]!==a||e[10]!==h?($=h||!a?.trim()||a===s,e[8]=s,e[9]=a,e[10]=h,e[11]=$):$=e[11];const P=h?"Saving...":"Save";let M;e[12]!==c||e[13]!==$||e[14]!==P?(M=(0,t.jsx)("button",{onClick:c,disabled:$,className:"rounded-full bg-violet-600 px-4 py-1.5 text-sm font-bold text-white transition-all hover:bg-violet-700 disabled:opacity-50 active:scale-95",children:P}),e[12]=c,e[13]=$,e[14]=P,e[15]=M):M=e[15];let I;e[16]!==y||e[17]!==M?(I=(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[y,M]}),e[16]=y,e[17]=M,e[18]=I):I=e[18];let A;return e[19]!==T||e[20]!==I?(A=(0,t.jsxs)("div",{className:"mt-2 flex flex-col gap-2",onClick:nl,children:[T,I]}),e[19]=T,e[20]=I,e[21]=A):A=e[21],A}const d=!r&&s.length>280;let v;e[22]!==s||e[23]!==f||e[24]!==d?(v=d&&!f?s.substring(0,280):s,e[22]=s,e[23]=f,e[24]=d,e[25]=v):v=e[25];const b=v,p=r?"text-lg leading-relaxed sm:text-xl sm:leading-8 mt-1":"text-[15px] leading-snug mt-0.5",j=u?"font-bangla text-[1.15em]":"font-english";let w;e[26]!==g||e[27]!==p||e[28]!==j?(w=Se("whitespace-pre-line break-words",p,j,g),e[26]=g,e[27]=p,e[28]=j,e[29]=w):w=e[29];let N;e[30]!==b?(N=(0,t.jsx)(Ke,{content:b}),e[30]=b,e[31]=N):N=e[31];const S=d&&!f&&"...";let C;e[32]!==f||e[33]!==d?(C=d&&(0,t.jsx)("button",{onClick:F=>{F.stopPropagation(),x(!f)},className:"ml-1 cursor-pointer font-bold text-rose-600 hover:underline dark:text-rose-400",children:f?"Show less":"See more"}),e[32]=f,e[33]=d,e[34]=C):C=e[34];let m;return e[35]!==w||e[36]!==N||e[37]!==S||e[38]!==C?(m=(0,t.jsxs)("div",{className:w,children:[N,S,C]}),e[35]=w,e[36]=N,e[37]=S,e[38]=C,e[39]=m):m=e[39],m},_t=al;function nl(l){return l.stopPropagation()}var rl=Y(),ol=l=>{const e=(0,rl.c)(28),{media:s,isEditing:r,editedMedia:i,setEditedMedia:a,newFiles:o,setNewFiles:n}=l;let c;e[0]!==i?(c=i===void 0?[]:i,e[0]=i,e[1]=c):c=e[1];const h=c;let g;e[2]!==o?(g=o===void 0?[]:o,e[2]=o,e[3]=g):g=e[3];const f=g,x=(0,z.useRef)(null);if(r&&a&&n){let d;if(e[4]!==h||e[5]!==a){let N;e[7]!==a?(N=(S,C)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[S.type==="video"?(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(is,{size:24,className:"text-zinc-400"})}):(0,t.jsx)("img",{src:S.url||S.src,className:"size-full object-cover",alt:""}),(0,t.jsx)("button",{onClick:m=>{m.stopPropagation(),a(F=>F.filter((E,T)=>T!==C))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)($e,{size:16})})]},`old-${C}`),e[7]=a,e[8]=N):N=e[8],d=h.map(N),e[4]=h,e[5]=a,e[6]=d}else d=e[6];let v;if(e[9]!==f||e[10]!==n){let N;e[12]!==n?(N=(S,C)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border-2 border-dashed border-violet-500 bg-violet-50/10",children:[S.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(S),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center",children:(0,t.jsx)(ns,{size:24,className:"animate-spin text-violet-500"})}),(0,t.jsx)("button",{onClick:m=>{m.stopPropagation(),n(F=>F.filter((E,T)=>T!==C))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)($e,{size:16})}),(0,t.jsx)("div",{className:"absolute bottom-1 left-1 rounded bg-violet-600 px-1 text-[8px] font-bold text-white",children:"NEW"})]},`new-${C}`),e[12]=n,e[13]=N):N=e[13],v=f.map(N),e[9]=f,e[10]=n,e[11]=v}else v=e[11];let b;e[14]!==h.length||e[15]!==f.length?(b=h.length+f.length<4&&(0,t.jsxs)("button",{onClick:N=>{N.stopPropagation(),x.current?.click()},className:"relative flex aspect-square flex-col items-center justify-center gap-1 rounded-xl border-2 border-dashed border-zinc-200 text-zinc-400 transition-all hover:border-violet-500 hover:bg-violet-50/5 hover:text-violet-500 dark:border-zinc-800",children:[(0,t.jsx)(gs,{size:20}),(0,t.jsx)("span",{className:"text-[10px] font-bold",children:"Add Media"})]}),e[14]=h.length,e[15]=f.length,e[16]=b):b=e[16];let p;e[17]!==d||e[18]!==v||e[19]!==b?(p=(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:[d,v,b]}),e[17]=d,e[18]=v,e[19]=b,e[20]=p):p=e[20];let j;e[21]!==n?(j=(0,t.jsx)("input",{type:"file",ref:x,onChange:N=>{if(N.target.files){const S=Array.from(N.target.files);n(C=>[...C,...S])}},multiple:!0,className:"hidden",accept:"image/*,video/*"}),e[21]=n,e[22]=j):j=e[22];let w;return e[23]!==p||e[24]!==j?(w=(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[p,j]}),e[23]=p,e[24]=j,e[25]=w):w=e[25],w}if(!s||s.length===0)return null;let u;return e[26]!==s?(u=(0,t.jsx)(Rl,{items:s}),e[26]=s,e[27]=u):u=e[27],u},$t=ol,cl=Y(),dl=l=>{const e=(0,cl.c)(48),{icon:s,count:r,label:i,onClick:a,active:o,activeColorClass:n,size:c,type:h}=l,g=c===void 0?18:c,f=h===void 0?"default":h;let x,u,d,v,b,p,j;if(e[0]!==o||e[1]!==n||e[2]!==r||e[3]!==i||e[4]!==a||e[5]!==f){const I={like:{hoverBg:"group-hover:bg-rose-500/10",hoverText:"group-hover:text-rose-500",activeText:"text-rose-500",activeFill:"fill-rose-500"},repost:{hoverBg:"group-hover:bg-emerald-500/10",hoverText:"group-hover:text-emerald-500",activeText:"text-emerald-500",activeFill:"fill-emerald-500"},comment:{hoverBg:"group-hover:bg-sky-500/10",hoverText:"group-hover:text-sky-500",activeText:"text-sky-500",activeFill:"fill-sky-500"},share:{hoverBg:"group-hover:bg-violet-500/10",hoverText:"group-hover:text-violet-500",activeText:"text-violet-500",activeFill:"fill-violet-500"},default:{hoverBg:"group-hover:bg-zinc-500/10",hoverText:"group-hover:text-zinc-500",activeText:"text-zinc-900 dark:text-white",activeFill:"fill-current"}};u=I[f]||I.default;const A=n||u.activeText;x=Q.button,e[13]===Symbol.for("react.memo_cache_sentinel")?(v={scale:.85},e[13]=v):v=e[13],e[14]!==a?(b=O=>{O.stopPropagation(),a&&a(O)},e[14]=a,e[15]=b):b=e[15],p=`${i} ${r!==void 0?`(${r})`:""}`,j=Se("group -ml-2 flex items-center gap-x-0.5 rounded-xl px-2 py-1.5 text-[12px] font-bold transition-all sm:gap-x-1 sm:text-[13px]",o?A:"text-zinc-500",!o&&u.hoverText),d=Se("rounded-full p-2 transition-all duration-200",!o&&u.hoverBg),e[0]=o,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=f,e[6]=x,e[7]=u,e[8]=d,e[9]=v,e[10]=b,e[11]=p,e[12]=j}else x=e[6],u=e[7],d=e[8],v=e[9],b=e[10],p=e[11],j=e[12];let w;e[16]!==o?(w=o?{scale:[1,1.4,1],rotate:[0,15,0]}:{scale:1},e[16]=o,e[17]=w):w=e[17];let N;e[18]===Symbol.for("react.memo_cache_sentinel")?(N={duration:.45,type:"spring",stiffness:300,damping:15},e[18]=N):N=e[18];const S=o?2.5:2,C=o&&u.activeFill;let m;e[19]!==C?(m=Se("transition-colors duration-200",C),e[19]=C,e[20]=m):m=e[20];let F;e[21]!==s||e[22]!==g||e[23]!==S||e[24]!==m?(F=(0,t.jsx)(s,{size:g,strokeWidth:S,className:m}),e[21]=s,e[22]=g,e[23]=S,e[24]=m,e[25]=F):F=e[25];let E;e[26]!==F||e[27]!==w?(E=(0,t.jsx)(Q.div,{animate:w,transition:N,children:F}),e[26]=F,e[27]=w,e[28]=E):E=e[28];let T;e[29]!==E||e[30]!==d?(T=(0,t.jsx)("div",{className:d,children:E}),e[29]=E,e[30]=d,e[31]=T):T=e[31];let y;e[32]!==i?(y=i&&(0,t.jsx)("span",{className:"hidden xs:inline",children:i}),e[32]=i,e[33]=y):y=e[33];let $;e[34]!==o||e[35]!==r?($=r!=null&&(0,t.jsx)(Q.span,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:Se("transition-all",o?"font-black":"font-bold"),children:r||0},r),e[34]=o,e[35]=r,e[36]=$):$=e[36];let P;e[37]!==$?(P=(0,t.jsx)(He,{mode:"wait",children:$}),e[37]=$,e[38]=P):P=e[38];let M;return e[39]!==x||e[40]!==T||e[41]!==y||e[42]!==P||e[43]!==v||e[44]!==b||e[45]!==p||e[46]!==j?(M=(0,t.jsxs)(x,{whileTap:v,onClick:b,"aria-label":p,className:j,children:[T,y,P]}),e[39]=x,e[40]=T,e[41]=y,e[42]=P,e[43]=v,e[44]=b,e[45]=p,e[46]=j,e[47]=M):M=e[47],M},ge=dl,ml=Y(),fl=l=>{const e=(0,ml.c)(18),{poll:s,onVote:r}=l,i=s.options.reduce(ul,0),[a,o]=(0,z.useState)(null);let n;e[0]!==r||e[1]!==a?(n=d=>{a||(o(d),r&&r(d))},e[0]=r,e[1]=a,e[2]=n):n=e[2];const c=n;let h;if(e[3]!==c||e[4]!==s.options||e[5]!==i||e[6]!==a){let d;e[8]!==c||e[9]!==i||e[10]!==a?(d=(v,b)=>{const p=i>0?Math.round((v.votes+(a===v.id?1:0))/(i+(a?1:0))*100):0,j=a===v.id;return(0,t.jsxs)("div",{onClick:()=>c(v.id),className:`relative h-10 w-full overflow-hidden rounded-xl border cursor-pointer ${j?"border-violet-500 dark:border-violet-500":"border-zinc-200 dark:border-zinc-700"}`,children:[a&&(0,t.jsx)("div",{className:"absolute left-0 top-0 h-full bg-zinc-200 transition-all duration-500 dark:bg-zinc-800",style:{width:`${p}%`}}),(0,t.jsxs)("div",{className:"absolute inset-0 z-10 flex items-center justify-between px-4",children:[(0,t.jsxs)("span",{className:`text-sm font-medium ${j?"font-bold text-violet-600":"text-zinc-700 dark:text-zinc-200"}`,children:[v.text," ",j&&(0,t.jsx)(xs,{size:14,className:"mb-0.5 inline ml-1"})]}),a&&(0,t.jsxs)("span",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:[p,"%"]})]})]},v.id||b)},e[8]=c,e[9]=i,e[10]=a,e[11]=d):d=e[11],h=s.options.map(d),e[3]=c,e[4]=s.options,e[5]=i,e[6]=a,e[7]=h}else h=e[7];const g=i+(a?1:0),f=a?"6 days left":"Click to vote";let x;e[12]!==g||e[13]!==f?(x=(0,t.jsxs)("div",{className:"pl-1 text-xs text-zinc-500 dark:text-zinc-400",children:[g," votes •"," ",f]}),e[12]=g,e[13]=f,e[14]=x):x=e[14];let u;return e[15]!==h||e[16]!==x?(u=(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[h,x]}),e[15]=h,e[16]=x,e[17]=u):u=e[17],u},Pt=fl;function ul(l,e){return l+e.votes}var xl=Y(),hl=l=>{const e=(0,xl.c)(25),{user:s,time:r,content:i}=l;let a;e[0]!==s.avatar||e[1]!==s.handle?(a=(0,t.jsx)(Ne,{src:s.avatar,alt:s.handle}),e[0]=s.avatar,e[1]=s.handle,e[2]=a):a=e[2];let o;e[3]!==s.handle[0]?(o=s.handle[0]?.toUpperCase(),e[3]=s.handle[0],e[4]=o):o=e[4];let n;e[5]!==o?(n=(0,t.jsx)(Ce,{children:o}),e[5]=o,e[6]=n):n=e[6];let c;e[7]!==a||e[8]!==n?(c=(0,t.jsxs)(we,{className:"size-6",children:[a,n]}),e[7]=a,e[8]=n,e[9]=c):c=e[9];let h;e[10]!==s.handle?(h=(0,t.jsx)("span",{className:"text-sm font-semibold",children:s.handle}),e[10]=s.handle,e[11]=h):h=e[11];let g;e[12]!==c||e[13]!==h?(g=(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[c,h]}),e[12]=c,e[13]=h,e[14]=g):g=e[14];let f;e[15]!==r?(f=(0,t.jsx)("span",{className:"text-xs text-zinc-500 sm:text-sm",children:r}),e[15]=r,e[16]=f):f=e[16];let x;e[17]!==g||e[18]!==f?(x=(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between gap-x-2",children:[g,f]}),e[17]=g,e[18]=f,e[19]=x):x=e[19];let u;e[20]!==i?(u=(0,t.jsx)(Ke,{content:i,className:"text-sm text-zinc-800 dark:text-zinc-300"}),e[20]=i,e[21]=u):u=e[21];let d;return e[22]!==x||e[23]!==u?(d=(0,t.jsxs)("div",{className:"p-4",children:[x,u]}),e[22]=x,e[23]=u,e[24]=d):d=e[24],d},Tt=hl,pl=Y(),gl=l=>{const e=(0,pl.c)(92),{currentUser:s,newComment:r,setNewComment:i,handleSubmitComment:a,loading:o,selectedFiles:n,setSelectedFiles:c,isUploading:h}=l;let g;e[0]!==n?(g=n===void 0?[]:n,e[0]=n,e[1]=g):g=e[1];const f=g,x=(0,z.useRef)(null),{isRecording:u,recordingTime:d,startRecording:v,stopRecording:b,audioBlob:p,audioUrl:j,clearAudio:w}=Ms(),[N,S]=(0,z.useState)(!1),C=(0,z.useRef)(null);let m;e[2]!==j||e[3]!==N?(m=()=>{j&&(C.current||(C.current=new Audio(j),C.current.onended=()=>S(!1)),N?C.current.pause():C.current.play(),S(!N))},e[2]=j,e[3]=N,e[4]=m):m=e[4];const F=m;let E,T;e[5]===Symbol.for("react.memo_cache_sentinel")?(E=()=>()=>{C.current&&(C.current.pause(),C.current=null)},T=[],e[5]=E,e[6]=T):(E=e[5],T=e[6]),(0,z.useEffect)(E,T);let y,$;e[7]!==p||e[8]!==N?(y=()=>{!p&&C.current&&(C.current.pause(),C.current=null,N&&S(!1))},$=[p,N],e[7]=p,e[8]=N,e[9]=y,e[10]=$):(y=e[9],$=e[10]),(0,z.useEffect)(y,$);let P;e[11]!==c?(P=U=>{if(U.target.files){const X=Array.from(U.target.files);c&&c(me=>[...me,...X])}},e[11]=c,e[12]=P):P=e[12];const M=P;let I;e[13]!==c?(I=U=>{c&&c(X=>X.filter((me,ve)=>ve!==U))},e[13]=c,e[14]=I):I=e[14];const A=I;let O;e[15]!==f?(O=f.map(bl),e[15]=f,e[16]=O):O=e[16];const V=O;let J,W;e[17]!==V?(J=()=>()=>{V.forEach(vl)},W=[V],e[17]=V,e[18]=J,e[19]=W):(J=e[18],W=e[19]),(0,z.useEffect)(J,W);let q;e[20]!==c?(q=U=>{const X=U.clipboardData.files;if(X&&X.length>0){const me=Array.from(X).filter(jl);me.length>0&&(U.preventDefault(),c&&c(ve=>[...ve,...me]))}},e[20]=c,e[21]=q):q=e[21];const H=q;let k;e[22]!==p||e[23]!==w||e[24]!==a||e[25]!==d?(k=U=>{p?(a(U,{blob:p,duration:d}),w()):a(U)},e[22]=p,e[23]=w,e[24]=a,e[25]=d,e[26]=k):k=e[26];const _=k,L=yl;if(!s){let U;return e[27]===Symbol.for("react.memo_cache_sentinel")?(U=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-6 text-center dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"Please login to join the conversation."})}),e[27]=U):U=e[27],U}let D;e[28]!==s.avatar||e[29]!==s.handle?(D=(0,t.jsx)(Ne,{src:s.avatar,alt:s.handle,className:"object-cover"}),e[28]=s.avatar,e[29]=s.handle,e[30]=D):D=e[30];let B;e[31]!==s.handle?.[0]?(B=s.handle?.[0]?.toUpperCase(),e[31]=s.handle?.[0],e[32]=B):B=e[32];let fe;e[33]!==B?(fe=(0,t.jsx)(Ce,{children:B}),e[33]=B,e[34]=fe):fe=e[34];let ue;e[35]!==D||e[36]!==fe?(ue=(0,t.jsxs)(we,{className:"size-9 border border-zinc-200 dark:border-zinc-700",children:[D,fe]}),e[35]=D,e[36]=fe,e[37]=ue):ue=e[37];let ne;e[38]!==j||e[39]!==w||e[40]!==H||e[41]!==N||e[42]!==u||e[43]!==r||e[44]!==d||e[45]!==i||e[46]!==b||e[47]!==F?(ne=u?(0,t.jsxs)("div",{className:"flex items-center justify-between bg-violet-50 dark:bg-violet-900/20 rounded-xl px-4 py-3 animate-pulse",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 text-violet-600",children:[(0,t.jsx)("div",{className:"size-2 rounded-full bg-red-500 animate-ping"}),(0,t.jsx)("span",{className:"font-mono font-bold",children:L(d)})]}),(0,t.jsx)("button",{onClick:b,className:"text-violet-600 hover:scale-110 transition-transform",children:(0,t.jsx)(at,{size:20,fill:"currentColor"})})]}):j?(0,t.jsxs)("div",{className:"flex items-center justify-between bg-zinc-100 dark:bg-zinc-800 rounded-xl px-3 py-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:F,className:"flex size-10 shrink-0 items-center justify-center rounded-full bg-violet-500 text-white transition-all hover:bg-violet-600",children:N?(0,t.jsx)(at,{size:16,fill:"currentColor"}):(0,t.jsx)(Ae,{size:20,fill:"currentColor",className:"ml-0.5"})}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs font-semibold text-zinc-500 dark:text-zinc-400",children:"Voice Message"}),(0,t.jsx)("span",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:L(d)})]})]}),(0,t.jsx)("button",{onClick:w,className:"rounded-full p-2 text-zinc-400 transition-colors hover:bg-rose-50 hover:text-rose-500 dark:hover:bg-rose-500/10",children:(0,t.jsx)(cs,{size:18})})]}):(0,t.jsx)("textarea",{id:"comment-input",className:"min-h-[60px] w-full resize-none bg-transparent text-base outline-none placeholder:text-zinc-500 dark:text-white",placeholder:"Post your reply...",value:r,onChange:U=>i(U.target.value),onPaste:H}),e[38]=j,e[39]=w,e[40]=H,e[41]=N,e[42]=u,e[43]=r,e[44]=d,e[45]=i,e[46]=b,e[47]=F,e[48]=ne):ne=e[48];let re;e[49]!==V||e[50]!==A||e[51]!==f?(re=f.length>0&&(0,t.jsx)("div",{className:"mt-2 mb-2 flex flex-wrap gap-2",children:f.map((U,X)=>(0,t.jsxs)("div",{className:"relative size-20 overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[U.type.startsWith("image/")?(0,t.jsx)("img",{src:V[X],className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)(us,{size:20,className:"text-zinc-500"})}),(0,t.jsx)("button",{onClick:()=>A(X),className:"absolute right-1 top-1 rounded-full bg-black/60 p-1 text-white transition-colors hover:bg-black",children:(0,t.jsx)($e,{size:12})})]},X))}),e[49]=V,e[50]=A,e[51]=f,e[52]=re):re=e[52];let xe;e[53]===Symbol.for("react.memo_cache_sentinel")?(xe=()=>x.current?.click(),e[53]=xe):xe=e[53];const je=u||!!j;let ye;e[54]===Symbol.for("react.memo_cache_sentinel")?(ye=(0,t.jsx)(qs,{size:20}),e[54]=ye):ye=e[54];let ce;e[55]!==je?(ce=(0,t.jsx)("button",{type:"button",onClick:xe,disabled:je,className:"rounded-full p-2 text-violet-600 transition-colors hover:bg-violet-50 dark:hover:bg-zinc-800 disabled:opacity-30",title:"Attach media",children:ye}),e[55]=je,e[56]=ce):ce=e[56];let de;e[57]!==j||e[58]!==u||e[59]!==v||e[60]!==b?(de=!j&&(0,t.jsx)("button",{type:"button",onClick:u?b:v,className:`rounded-full p-2 transition-colors ${u?"bg-red-50 text-red-600 animate-pulse":"text-violet-600 hover:bg-violet-50 dark:hover:bg-zinc-800"}`,title:u?"Stop recording":"Record voice comment",children:(0,t.jsx)(ps,{size:20,className:u?"fill-current":""})}),e[57]=j,e[58]=u,e[59]=v,e[60]=b,e[61]=de):de=e[61];let ee;e[62]!==M?(ee=(0,t.jsx)("input",{type:"file",ref:x,onChange:M,multiple:!0,className:"hidden",accept:"image/*,video/*,application/pdf"}),e[62]=M,e[63]=ee):ee=e[63];let se;e[64]!==ce||e[65]!==de||e[66]!==ee?(se=(0,t.jsxs)("div",{className:"flex gap-1 text-violet-600",children:[ce,de,ee]}),e[64]=ce,e[65]=de,e[66]=ee,e[67]=se):se=e[67];const oe=o||h?"primary":"animated";let K;e[68]!==h||e[69]!==o?(K=!(o||h)&&(0,t.jsx)(De,{size:20}),e[68]=h,e[69]=o,e[70]=K):K=e[70];const he=o||h;let le;e[71]!==p||e[72]!==u||e[73]!==r||e[74]!==f.length?(le=!r.trim()&&f.length===0&&!p||u,e[71]=p,e[72]=u,e[73]=r,e[74]=f.length,e[75]=le):le=e[75];let ie;e[76]!==_||e[77]!==oe||e[78]!==K||e[79]!==he||e[80]!==le?(ie=(0,t.jsx)(Lt,{variant:oe,icon:K,className:"min-w-[70px] !w-auto",onClick:_,loading:he,disabled:le,children:"Reply"}),e[76]=_,e[77]=oe,e[78]=K,e[79]=he,e[80]=le,e[81]=ie):ie=e[81];let ae;e[82]!==se||e[83]!==ie?(ae=(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between border-t border-zinc-100 pt-3 dark:border-zinc-800",children:[se,ie]}),e[82]=se,e[83]=ie,e[84]=ae):ae=e[84];let te;e[85]!==ne||e[86]!==re||e[87]!==ae?(te=(0,t.jsxs)("div",{className:"flex-1",children:[ne,re,ae]}),e[85]=ne,e[86]=re,e[87]=ae,e[88]=te):te=e[88];let be;return e[89]!==ue||e[90]!==te?(be=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-4 dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[ue,te]})}),e[89]=ue,e[90]=te,e[91]=be):be=e[91],be},Bt=z.memo(gl);function bl(l){return URL.createObjectURL(l)}function vl(l){return URL.revokeObjectURL(l)}function jl(l){return l.type.startsWith("image/")}function yl(l){return`${Math.floor(l/60)}:${Math.floor(l%60).toString().padStart(2,"0")}`}var kl=Y(),zl=l=>{const e=(0,kl.c)(30),{url:s}=l;let r,i;e[0]!==s?(r=["link-preview",s],i=()=>Os(s),e[0]=s,e[1]=r,e[2]=i):(r=e[1],i=e[2]);const a=!!s;let o;e[3]!==r||e[4]!==i||e[5]!==a?(o={queryKey:r,queryFn:i,staleTime:864e5,enabled:a},e[3]=r,e[4]=i,e[5]=a,e[6]=o):o=e[6];const{data:n,isLoading:c,isError:h}=ss(o);if(c){let w;return e[7]===Symbol.for("react.memo_cache_sentinel")?(w=(0,t.jsx)("div",{className:"mt-3 flex h-24 animate-pulse items-center justify-center overflow-hidden rounded-2xl border border-zinc-100 bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-900/50",children:(0,t.jsx)(nt,{className:"animate-spin text-zinc-300 dark:text-zinc-700",size:24})}),e[7]=w):w=e[7],w}if(h||!n||!n.title&&!n.image)return null;let g;e[8]!==n.image||e[9]!==n.title?(g=n.image&&(0,t.jsx)("div",{className:"aspect-[1.91/1] w-full overflow-hidden border-b border-zinc-100 bg-zinc-100 dark:border-zinc-800 dark:bg-zinc-900",children:(0,t.jsx)("img",{src:n.image,alt:n.title??void 0,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-[1.02]",onError:wl})}),e[8]=n.image,e[9]=n.title,e[10]=g):g=e[10];let f;e[11]===Symbol.for("react.memo_cache_sentinel")?(f=(0,t.jsx)(nt,{size:12}),e[11]=f):f=e[11];let x;e[12]!==n.siteName?(x=(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs font-bold uppercase tracking-wider text-zinc-600",children:[f,(0,t.jsx)("span",{children:n.siteName})]}),e[12]=n.siteName,e[13]=x):x=e[13];let u;e[14]!==n.title?(u=(0,t.jsx)("div",{className:"line-clamp-2 text-[15px] font-bold leading-snug transition-colors group-hover:text-violet-700 dark:text-white",children:n.title}),e[14]=n.title,e[15]=u):u=e[15];let d;e[16]!==n.description?(d=n.description&&(0,t.jsx)("p",{className:"line-clamp-2 text-xs leading-relaxed text-zinc-600 dark:text-zinc-400",children:n.description}),e[16]=n.description,e[17]=d):d=e[17];let v;e[18]===Symbol.for("react.memo_cache_sentinel")?(v=(0,t.jsx)(rs,{size:10}),e[18]=v):v=e[18];let b;e[19]!==s?(b=(0,t.jsxs)("div",{className:"flex items-center gap-1 pt-1 text-[11px] font-medium text-zinc-500",children:[v,(0,t.jsx)("span",{className:"truncate",children:s})]}),e[19]=s,e[20]=b):b=e[20];let p;e[21]!==b||e[22]!==x||e[23]!==u||e[24]!==d?(p=(0,t.jsxs)("div",{className:"space-y-1 p-3.5",children:[x,u,d,b]}),e[21]=b,e[22]=x,e[23]=u,e[24]=d,e[25]=p):p=e[25];let j;return e[26]!==p||e[27]!==g||e[28]!==s?(j=(0,t.jsxs)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"group mt-3 flex flex-col overflow-hidden rounded-2xl border border-zinc-100 bg-white shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-900",onClick:Nl,children:[g,p]}),e[26]=p,e[27]=g,e[28]=s,e[29]=j):j=e[29],j},Ft=zl;function Nl(l){return l.stopPropagation()}function wl(l){return l.target.style.display="none"}var Cl=Y(),Sl=l=>{const e=(0,Cl.c)(15),{file:s}=l;let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=(0,t.jsx)("div",{className:"flex size-10 items-center justify-center rounded-xl bg-violet-100 text-violet-600 dark:bg-violet-900/30",children:(0,t.jsx)(os,{size:20})}),e[0]=r):r=e[0];let i;e[1]!==s.name?(i=(0,t.jsx)("div",{className:"truncate text-sm font-bold dark:text-white",children:s.name}),e[1]=s.name,e[2]=i):i=e[2];let a;e[3]!==s.size?(a=s.size!==void 0&&(0,t.jsxs)("div",{className:"text-xs uppercase text-zinc-500",children:[(s.size/1024/1024).toFixed(2)," MB"]}),e[3]=s.size,e[4]=a):a=e[4];let o;e[5]!==i||e[6]!==a?(o=(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[i,a]}),e[5]=i,e[6]=a,e[7]=o):o=e[7];let n;e[8]===Symbol.for("react.memo_cache_sentinel")?(n=(0,t.jsx)(ds,{size:18}),e[8]=n):n=e[8];let c;e[9]!==s.name||e[10]!==s.url?(c=(0,t.jsx)("a",{href:s.url,download:s.name,className:"p-2 text-zinc-400 transition-colors hover:text-violet-600",onClick:$l,children:n}),e[9]=s.name,e[10]=s.url,e[11]=c):c=e[11];let h;return e[12]!==o||e[13]!==c?(h=(0,t.jsxs)("div",{className:"group mt-3 flex items-center gap-3 rounded-2xl border border-zinc-100 bg-zinc-50/50 p-3 transition-colors hover:border-violet-500/30 dark:border-zinc-800 dark:bg-zinc-900/10",children:[r,o,c]}),e[12]=o,e[13]=c,e[14]=h):h=e[14],h},_l=Sl;function $l(l){return l.stopPropagation()}var Xe=Y(),Pl=l=>{const e=(0,Xe.c)(15),{item:s,onClick:r}=l,[i,a]=(0,z.useState)(!1);let o;e[0]!==i?(o=!i&&(0,t.jsx)("div",{className:"absolute inset-0 animate-pulse bg-zinc-200 dark:bg-zinc-800"}),e[0]=i,e[1]=o):o=e[1];const n=s.url||s.src;let c;e[2]===Symbol.for("react.memo_cache_sentinel")?(c={opacity:0,scale:1.1,filter:"blur(10px)"},e[2]=c):c=e[2];let h;e[3]!==i?(h=i?{opacity:1,scale:1,filter:"blur(0px)"}:{},e[3]=i,e[4]=h):h=e[4];let g;e[5]===Symbol.for("react.memo_cache_sentinel")?(g={duration:.5,ease:"easeOut"},e[5]=g):g=e[5];let f;e[6]===Symbol.for("react.memo_cache_sentinel")?(f=()=>a(!0),e[6]=f):f=e[6];let x;e[7]!==n||e[8]!==h?(x=(0,t.jsx)(Q.img,{src:n,initial:c,animate:h,transition:g,className:"size-full object-cover",alt:"",loading:"lazy",onLoad:f}),e[7]=n,e[8]=h,e[9]=x):x=e[9];let u;e[10]===Symbol.for("react.memo_cache_sentinel")?(u=(0,t.jsx)("div",{className:"absolute inset-0 bg-black/0 transition-colors group-hover:bg-black/10"}),e[10]=u):u=e[10];let d;return e[11]!==r||e[12]!==o||e[13]!==x?(d=(0,t.jsxs)(Q.div,{className:"group relative size-full overflow-hidden",onClick:r,children:[o,x,u]}),e[11]=r,e[12]=o,e[13]=x,e[14]=d):d=e[14],d},Tl=l=>{const e=(0,Xe.c)(18),{item:s,onClick:r}=l,[i,a]=(0,z.useState)(!1);let o;e[0]!==i?(o=!i&&(0,t.jsx)("div",{className:"absolute inset-0 animate-pulse bg-zinc-200 dark:bg-zinc-800"}),e[0]=i,e[1]=o):o=e[1];let n;e[2]!==s.poster||e[3]!==i?(n=s.poster&&(0,t.jsx)(Q.img,{src:s.poster,initial:{opacity:0,scale:1.1,filter:"blur(10px)"},animate:i?{opacity:1,scale:1,filter:"blur(0px)"}:{},transition:{duration:.5,ease:"easeOut"},className:"size-full object-cover",alt:"",loading:"lazy",onLoad:()=>a(!0)}),e[2]=s.poster,e[3]=i,e[4]=n):n=e[4];let c;e[5]!==s.poster?(c=!s.poster&&(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-900",onMouseEnter:()=>a(!0),children:(0,t.jsx)("div",{className:"size-full bg-zinc-800/20"})}),e[5]=s.poster,e[6]=c):c=e[6];let h;e[7]===Symbol.for("react.memo_cache_sentinel")?(h=(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent opacity-80"}),e[7]=h):h=e[7];let g;e[8]===Symbol.for("react.memo_cache_sentinel")?(g=(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)("div",{className:"flex size-14 items-center justify-center rounded-full bg-white/15 backdrop-blur-md ring-1 ring-white/30 transition-all group-hover:bg-white/25 group-hover:scale-110 group-active:scale-95 shadow-2xl",children:(0,t.jsx)(Ae,{className:"ml-1 size-7 text-white fill-white drop-shadow-xl",strokeWidth:0})})}),e[8]=g):g=e[8];let f;e[9]===Symbol.for("react.memo_cache_sentinel")?(f=(0,t.jsx)(Ae,{className:"size-2.5 fill-white",strokeWidth:0}),e[9]=f):f=e[9];const x=s.duration||"0:00";let u;e[10]!==x?(u=(0,t.jsx)("div",{className:"absolute bottom-3 left-3 flex items-center gap-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 rounded-lg bg-black/40 px-2 py-1 text-[11px] font-bold text-white backdrop-blur-md border border-white/10 shadow-lg",children:[f,(0,t.jsx)("span",{className:"tabular-nums tracking-wider",children:x})]})}),e[10]=x,e[11]=u):u=e[11];let d;return e[12]!==r||e[13]!==o||e[14]!==n||e[15]!==c||e[16]!==u?(d=(0,t.jsxs)(Q.div,{className:"group relative size-full overflow-hidden",onClick:r,children:[o,n,c,h,g,u]}),e[12]=r,e[13]=o,e[14]=n,e[15]=c,e[16]=u,e[17]=d):d=e[17],d},Fl=l=>{const e=(0,Xe.c)(3),{items:s}=l,r=s===void 0?[]:s,{openLightbox:i}=Ws();if(!r||Array.isArray(r)&&r.length===0)return null;const a=Array.isArray(r)?r:[r],o=a.filter(Ml),n=a.filter(El),c=o.some(Il),h=d=>{i(o,d)},g="mt-2 space-y-2",f=o.length>0&&(0,t.jsx)("div",{className:`grid gap-2 overflow-hidden rounded-2xl border border-zinc-100 dark:border-zinc-800 ${o.length===1?"grid-cols-1":o.length===2?c?"aspect-[8/9] grid-cols-1 grid-rows-2":"aspect-[16/9] grid-cols-2":(o.length===3,"aspect-[16/9] grid-cols-2 grid-rows-2")}`,children:o.map((d,v)=>(0,t.jsx)("div",{className:`relative cursor-pointer overflow-hidden bg-zinc-100 dark:bg-zinc-900 group ${o.length===3&&v===0?"row-span-2":""}`,children:d.type==="video"?(0,t.jsx)(Tl,{item:d,onClick:b=>{b.stopPropagation(),h(v)}}):(0,t.jsx)(Pl,{item:d,onClick:b=>{b.stopPropagation(),h(v)}})},v))}),x=n.map(Ll);let u;return e[0]!==f||e[1]!==x?(u=(0,t.jsxs)("div",{className:g,children:[f,x]}),e[0]=f,e[1]=x,e[2]=u):u=e[2],u},Rl=Fl;function Ml(l){return l.type==="image"||l.type==="video"}function El(l){return l.type==="file"}function Il(l){return l.type==="video"}function Ll(l,e){return(0,t.jsx)(_l,{file:l},e)}var Al=({isOpen:l,onClose:e,url:s,title:r="Share",overlayClassName:i})=>{const[a,o]=(0,z.useState)(!1),[n,c]=(0,z.useState)(""),[h,g]=(0,z.useState)([]),[f,x]=(0,z.useState)(!1),[u,d]=(0,z.useState)(null),{addToast:v}=Je(),{currentUser:b}=At(),p=(0,z.useCallback)(async()=>{if(b){x(!0);try{g((await kt(b.id)).map(m=>m.user).filter(m=>m!==null).slice(0,5))}catch(m){console.error("Failed to fetch conversations:",m)}finally{x(!1)}}},[b]),j=(0,z.useCallback)(async()=>{if(b){x(!0);try{g((await kt(b.id)).map(m=>m.user).filter(m=>m!==null&&(m.name?.toLowerCase().includes(n.toLowerCase())||m.handle?.toLowerCase().includes(n.toLowerCase()))))}catch(m){console.error("Search failed:",m)}finally{x(!1)}}},[n,b]);(0,z.useEffect)(()=>{if(!l||!b){c(""),g([]);return}const m=setTimeout(()=>{n.trim()?j():p()},300);return()=>clearTimeout(m)},[n,l,b,j,p]);const w=async m=>{m&&m.stopPropagation();try{await qe(s),o(!0),v("Link copied to clipboard!","success"),setTimeout(()=>o(!1),2e3)}catch(F){console.error("Failed to copy:",F),v("Failed to copy link","error")}},N=async m=>{if(b){d(m.id);try{await Es(await Us(b.id,m.id),b.id,s,"text"),v(`Sent to ${m.name||m.handle}!`,"success")}catch(F){console.error("Failed to send message:",F),v("Failed to send message","error")}finally{d(null)}}},S=[{name:"X",icon:js,color:"bg-black text-white",href:`https://twitter.com/intent/tweet?url=${encodeURIComponent(s)}`},{name:"Facebook",icon:fs,color:"bg-[#1877F2] text-white",href:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(s)}`},{name:"LinkedIn",icon:as,color:"bg-[#0A66C2] text-white",href:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(s)}`},{name:"WhatsApp",icon:hs,color:"bg-[#25D366] text-white",href:`https://wa.me/?text=${encodeURIComponent(s)}`},{name:"Email",icon:ms,color:"bg-zinc-600 text-white",href:`mailto:?body=${encodeURIComponent(s)}`}],C=async()=>{if(navigator.share)try{await navigator.share({title:r,url:s})}catch(m){m.name!=="AbortError"&&console.error("Native share failed:",m)}else w()};return(0,t.jsx)(Dt,{isOpen:l,onClose:e,className:"max-w-[360px] overflow-hidden rounded-[32px] border border-black/10 bg-white/75 p-0 shadow-2xl backdrop-blur-xl dark:border-white/10 dark:bg-zinc-900/75 sm:max-w-[380px]",overlayClassName:i,children:(0,t.jsxs)("div",{className:"flex h-full flex-col",children:[(0,t.jsx)("div",{className:"flex items-center justify-center pt-6 pb-2",children:(0,t.jsx)("h2",{className:"text-[17px] font-semibold text-zinc-900 dark:text-zinc-50",children:r})}),(0,t.jsx)("div",{className:"px-5 py-3",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)(ls,{className:"absolute left-3.5 top-1/2 size-4 -translate-y-1/2 text-zinc-400 transition-colors group-focus-within:text-violet-500"}),(0,t.jsx)("input",{type:"text",placeholder:"Search people...",value:n,onChange:m=>c(m.target.value),className:"w-full rounded-2xl border border-black/5 bg-black/5 py-3 pl-11 pr-4 text-[15px] outline-none transition-all focus:ring-4 focus:ring-violet-500/10 dark:border-white/5 dark:bg-white/5 dark:focus:bg-black/50"})]})}),(0,t.jsx)("div",{className:"no-scrollbar flex min-h-[110px] items-center gap-4 overflow-x-auto px-5 py-4",children:f?(0,t.jsx)("div",{className:"flex flex-1 justify-center",children:(0,t.jsx)("span",{className:"animate-pulse text-[13px] font-medium text-zinc-400",children:"Loading..."})}):h.length>0?h.map(m=>(0,t.jsxs)("button",{onClick:()=>N(m),disabled:u!==null,className:"group flex shrink-0 flex-col items-center gap-2 transition-transform active:scale-95 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"size-16 overflow-hidden rounded-full border-2 border-white/50 shadow-sm dark:border-zinc-800/50 bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)("img",{src:m.avatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${m.handle}`,alt:m.handle,className:"size-full object-cover"})}),u===m.id&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-full bg-black/40",children:(0,t.jsx)("span",{className:"animate-pulse text-white font-bold",children:"..."})})]}),(0,t.jsx)("span",{className:"max-w-[70px] truncate text-[11px] font-medium text-zinc-500 dark:text-zinc-400",children:m.name?.split(" ")[0]||m.handle})]},m.id)):(0,t.jsx)("div",{className:"flex-1 py-2 text-center",children:(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"No people found"})})}),(0,t.jsx)("div",{className:"mx-5 h-px bg-black/5 dark:bg-white/5"}),(0,t.jsxs)("div",{className:"grid grid-cols-5 gap-3 px-5 py-6",children:[S.map(m=>(0,t.jsxs)("a",{href:m.href,target:"_blank",rel:"noopener noreferrer",className:"group flex flex-col items-center gap-2.5",children:[(0,t.jsx)("div",{className:`size-12 ${m.color} flex items-center justify-center rounded-[18px] shadow-sm ring-1 ring-black/5 transition-all group-hover:-translate-y-1 group-hover:scale-105 group-hover:shadow-lg dark:ring-white/5`,children:(0,t.jsx)(m.icon,{size:22,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-wider text-zinc-500/80 dark:text-zinc-400/80",children:m.name})]},m.name)),(0,t.jsxs)("button",{onClick:C,className:"group flex flex-col items-center gap-2.5",children:[(0,t.jsx)("div",{className:"flex size-12 items-center justify-center rounded-[18px] border border-black/10 bg-white/50 text-zinc-600 shadow-sm transition-all group-hover:-translate-y-1 group-hover:scale-105 dark:border-white/10 dark:bg-white/5 dark:text-zinc-300",children:(0,t.jsx)(Ue,{size:22,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-wider text-zinc-500/80 dark:text-zinc-400/80",children:"More"})]})]}),(0,t.jsx)("div",{className:"px-5 pb-6",children:(0,t.jsxs)("div",{className:"group relative flex items-center overflow-hidden rounded-2xl border border-black/10 bg-white/40 dark:border-white/10 dark:bg-black/20",children:[(0,t.jsx)("input",{type:"text",readOnly:!0,value:s,className:"w-full bg-transparent py-4 pl-4 pr-16 text-[14px] font-medium text-zinc-600 outline-none dark:text-zinc-300"}),(0,t.jsx)("button",{onClick:w,className:`absolute right-1 text-[13px] font-bold active:scale-95 transition-all px-4 h-10 rounded-xl leading-none ${a?"text-emerald-500":"text-violet-600 hover:text-violet-700 dark:text-violet-400"}`,children:a?"Copied":"Copy"})]})}),(0,t.jsx)("div",{className:"border-t border-black/10 dark:border-white/10",children:(0,t.jsx)("button",{onClick:e,className:"flex h-16 w-full items-center justify-center text-[19px] font-medium text-zinc-500 transition-colors active:bg-black/5 dark:text-zinc-400 dark:active:bg-white/5",children:"Close"})})]})})},Wt=Al,qt=Y(),Dl=l=>{const e=(0,qt.c)(6),{avatars:s}=l;if(!s||s.length===0)return null;let r,i;if(e[0]!==s){const o=s.slice(0,3);r="relative mt-2.5 h-8 w-8",i=o.map((n,c)=>{let h,g;return o.length===1?(h="top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",g="size-5"):o.length===2?(g="size-4.5",h=c===0?"top-0 right-0":"bottom-0 left-0"):(g=c===0?"size-4.5":"size-3.5",c===0?h="top-0 left-1/2 -translate-x-1/2":c===1?h="bottom-0.5 left-0":h="bottom-0.5 right-0"),(0,t.jsx)("div",{className:`absolute rounded-full border-2 border-white bg-zinc-100 dark:border-black dark:bg-zinc-800 overflow-hidden shadow-md transition-transform hover:scale-110 ${h} ${g}`,style:{zIndex:10-c},children:(0,t.jsx)("img",{src:n,alt:"",className:"h-full w-full object-cover",loading:"lazy"})},c)}),e[0]=s,e[1]=r,e[2]=i}else r=e[1],i=e[2];let a;return e[3]!==r||e[4]!==i?(a=(0,t.jsx)("div",{className:r,children:i}),e[3]=r,e[4]=i,e[5]=a):a=e[5],a},Rt=l=>{const e=(0,qt.c)(78),{id:s,user:r,isCurrentUser:i,isComment:a,isPinned:o,onEdit:n,onDelete:c,onTogglePin:h,addToast:g,trigger:f}=l,{openReport:x}=Ot(),[u,d]=(0,z.useState)(!1);if(_s("(min-width: 1024px)")){let P;e[0]!==f?(P=(0,t.jsx)(Ns,{asChild:!0,onClick:Bl,children:(0,t.jsx)("div",{className:"cursor-pointer outline-none",children:f})}),e[0]=f,e[1]=P):P=e[1];let M;e[2]!==g||e[3]!==s||e[4]!==a?(M=!a&&(0,t.jsxs)(ke,{onClick:_=>{_.stopPropagation(),qe(Ge(s)).then(()=>{g("Link copied"),d(!1)}).catch(()=>{g("Failed to copy link","error")})},children:[(0,t.jsx)(ct,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Copy link"})]}),e[2]=g,e[3]=s,e[4]=a,e[5]=M):M=e[5];let I;e[6]!==s||e[7]!==x?(I=_=>{_.stopPropagation(),x("post",s),d(!1)},e[6]=s,e[7]=x,e[8]=I):I=e[8];let A;e[9]===Symbol.for("react.memo_cache_sentinel")?(A=(0,t.jsx)(We,{className:"mr-2 h-4 w-4"}),e[9]=A):A=e[9];const O=a?"comment":"post";let V;e[10]!==O?(V=(0,t.jsxs)("span",{children:["Report ",O]}),e[10]=O,e[11]=V):V=e[11];let J;e[12]!==I||e[13]!==V?(J=(0,t.jsxs)(ke,{onClick:I,children:[A,V]}),e[12]=I,e[13]=V,e[14]=J):J=e[14];let W;e[15]!==i||e[16]!==x||e[17]!==r?(W=!i&&(0,t.jsxs)(ke,{onClick:_=>{_.stopPropagation(),x("user",r.id),d(!1)},children:[(0,t.jsx)(rt,{className:"mr-2 h-4 w-4"}),(0,t.jsxs)("span",{children:["Report @",r.handle]})]}),e[15]=i,e[16]=x,e[17]=r,e[18]=W):W=e[18];let q;e[19]!==a||e[20]!==i||e[21]!==o||e[22]!==c||e[23]!==n||e[24]!==h?(q=i&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Fs,{}),!a&&h&&(0,t.jsx)(ke,{onClick:_=>{_.stopPropagation(),h(),d(!1)},children:o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(mt,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Unpin from profile"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Ve,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Pin to profile"})]})}),(0,t.jsxs)(ke,{onClick:_=>{_.stopPropagation(),n(),d(!1)},children:[(0,t.jsx)(dt,{className:"mr-2 h-4 w-4"}),(0,t.jsxs)("span",{children:["Edit ",a?"Comment":"Post"]})]}),(0,t.jsxs)(ke,{className:"text-red-500 focus:text-red-500",onClick:_=>{_.stopPropagation(),c(),d(!1)},children:[(0,t.jsx)(ot,{className:"mr-2 h-4 w-4"}),(0,t.jsxs)("span",{children:["Delete ",a?"comment":"post"]})]})]}),e[19]=a,e[20]=i,e[21]=o,e[22]=c,e[23]=n,e[24]=h,e[25]=q):q=e[25];let H;e[26]!==M||e[27]!==J||e[28]!==W||e[29]!==q?(H=(0,t.jsxs)(Ts,{align:"end",className:"w-56",onClick:Wl,children:[M,J,W,q]}),e[26]=M,e[27]=J,e[28]=W,e[29]=q,e[30]=H):H=e[30];let k;return e[31]!==u||e[32]!==P||e[33]!==H?(k=(0,t.jsx)("div",{onClick:Vl,children:(0,t.jsxs)(Qs,{open:u,onOpenChange:d,modal:!0,children:[P,H]})}),e[31]=u,e[32]=P,e[33]=H,e[34]=k):k=e[34],k}let v;e[35]===Symbol.for("react.memo_cache_sentinel")?(v=P=>{P.stopPropagation(),d(!0)},e[35]=v):v=e[35];let b;e[36]!==f?(b=(0,t.jsx)("div",{onClick:v,className:"cursor-pointer",children:f}),e[36]=f,e[37]=b):b=e[37];let p;e[38]===Symbol.for("react.memo_cache_sentinel")?(p=()=>d(!1),e[38]=p):p=e[38];let j;e[39]!==g||e[40]!==s||e[41]!==a?(j=!a&&(0,t.jsx)(ze,{icon:(0,t.jsx)(ct,{size:18}),onClick:P=>{P.stopPropagation(),qe(Ge(s)).then(()=>{g("Link copied"),d(!1)}).catch(()=>{g("Failed to copy link","error")})},children:"Copy link"}),e[39]=g,e[40]=s,e[41]=a,e[42]=j):j=e[42];let w;e[43]===Symbol.for("react.memo_cache_sentinel")?(w=(0,t.jsx)(We,{size:18}),e[43]=w):w=e[43];let N;e[44]!==s||e[45]!==x?(N=P=>{P.stopPropagation(),x("post",s),d(!1)},e[44]=s,e[45]=x,e[46]=N):N=e[46];const S=a?"comment":"post";let C;e[47]!==N||e[48]!==S?(C=(0,t.jsxs)(ze,{icon:w,onClick:N,children:["Report ",S]}),e[47]=N,e[48]=S,e[49]=C):C=e[49];let m;e[50]!==i||e[51]!==x||e[52]!==r?(m=!i&&(0,t.jsxs)(ze,{icon:(0,t.jsx)(rt,{size:18}),onClick:P=>{P.stopPropagation(),x("user",r.id),d(!1)},children:["Report @",r.handle]}),e[50]=i,e[51]=x,e[52]=r,e[53]=m):m=e[53];let F;e[54]!==a||e[55]!==i||e[56]!==o||e[57]!==h?(F=i&&!a&&h&&(0,t.jsx)(ze,{icon:o?(0,t.jsx)(mt,{size:18}):(0,t.jsx)(Ve,{size:18}),onClick:P=>{P.stopPropagation(),h(),d(!1)},children:o?"Unpin from profile":"Pin to profile"}),e[54]=a,e[55]=i,e[56]=o,e[57]=h,e[58]=F):F=e[58];let E;e[59]!==a||e[60]!==i||e[61]!==n?(E=i&&(0,t.jsxs)(ze,{icon:(0,t.jsx)(dt,{size:18}),onClick:P=>{P.stopPropagation(),n(),d(!1)},children:["Edit ",a?"Comment":"Post"]}),e[59]=a,e[60]=i,e[61]=n,e[62]=E):E=e[62];let T;e[63]!==a||e[64]!==i||e[65]!==c?(T=i&&(0,t.jsxs)(ze,{variant:"destructive",icon:(0,t.jsx)(ot,{size:18}),onClick:P=>{P.stopPropagation(),c(),d(!1)},children:["Delete ",a?"comment":"post"]}),e[63]=a,e[64]=i,e[65]=c,e[66]=T):T=e[66];let y;e[67]!==u||e[68]!==F||e[69]!==E||e[70]!==T||e[71]!==j||e[72]!==C||e[73]!==m?(y=(0,t.jsx)("div",{onClick:ql,children:(0,t.jsxs)(Xs,{isOpen:u,onClose:p,children:[j,C,m,F,E,T]})}),e[67]=u,e[68]=F,e[69]=E,e[70]=T,e[71]=j,e[72]=C,e[73]=m,e[74]=y):y=e[74];let $;return e[75]!==y||e[76]!==b?($=(0,t.jsxs)(t.Fragment,{children:[b,y]}),e[75]=y,e[76]=b,e[77]=$):$=e[77],$},Qe=({id:l,user:e,timeAgo:s,content:r,contentClass:i,media:a,quotedPost:o,stats:n,onClick:c,repostedBy:h,onUserClick:g,currentUser:f,poll:x,isDetail:u,initialComments:d,onDelete:v,onUpdate:b,isComment:p,onReply:j,community:w,parent_id:N,post_id:S,commenterAvatars:C=[],is_pinned:m=!1,type:F="text",duration:E})=>{const T=Et(),{addToast:y}=Je(),$=ts(),{liked:P,reposted:M,localStats:I,setLocalStats:A,handleLike:O,handleRepost:V}=Hs(S||l,n,f,p?l:void 0),{deletePost:J,updatePost:W}=Is(),q=async()=>{try{const R=!m;await W(l,{is_pinned:R,pinned_at:R?new Date().toISOString():null}),$.invalidateQueries({queryKey:["posts","user",e.id]}),y(R?"Post pinned to profile":"Post unpinned")}catch(R){console.error("Failed to toggle pin:",R),y("Failed to update pin status")}},{comments:H,fetchNextPage:k,hasNextPage:_,isFetchingNextPage:L,addComment:D,deleteComment:B,updateComment:fe,isSubmitting:ue}=yt(S||l,d),[ne,re]=(0,z.useState)(""),[xe,je]=(0,z.useState)([]),[ye,ce]=(0,z.useState)(!1),[de,ee]=(0,z.useState)(!1),[se,oe]=(0,z.useState)(!1),[K,he]=(0,z.useState)(r),[le,ie]=(0,z.useState)(a||[]),[ae,te]=(0,z.useState)([]),[be,U]=(0,z.useState)(!1),[X,me]=(0,z.useState)(!1),[ve,Pe]=(0,z.useState)(null),[Oe,Ye]=(0,z.useState)(!1),{comments:Ht,refetch:et}=yt(S||l,void 0,Oe?l:void 0),{ref:tt,inView:st}=Yt({threshold:.5,triggerOnce:!0});(0,z.useEffect)(()=>{if(st&&!p&&l&&!l.startsWith("temp-")){const R=setTimeout(()=>{Rs(l,"post")&&Vt(l).catch(console.error)},1500);return()=>clearTimeout(R)}},[st,l,p]);const Gt=(0,z.useCallback)(async()=>{!l||!S&&!l||I.comments===0||(Ye(!0),et())},[l,S,I.comments,et]),lt=async()=>{const R=JSON.stringify(le)!==JSON.stringify(a||[])||ae.length>0;if(!K.trim()||K===r&&!R){oe(!1);return}U(!0);try{const G=[];for(const pe of ae){const Fe=await _e(pe);G.push(Fe)}const Z=[...le,...G];p?await fe({commentId:l,content:K,media:Z}):await W(l,{content:K,media:Z}),te([]),oe(!1),y(`${p?"Comment":"Post"} updated`),b&&b(l,K,Z)}catch(G){console.error(`Failed to update ${p?"comment":"post"}:`,G),y(`Failed to update ${p?"comment":"post"}`)}finally{U(!1)}},it=async R=>{R&&R.stopPropagation();try{p?await B(l):await J(l),y(`${p?"Comment":"Post"} deleted successfully`),v&&v(l)}catch(G){console.error(`Failed to delete ${p?"comment":"post"}:`,G),y(`Failed to delete ${p?"comment":"post"}`)}finally{ee(!1)}},Qt=async(R,G)=>{if(R?.preventDefault(),!(!ne.trim()&&xe.length===0&&!G||!f)){ce(!0);try{let Z=[],pe="text",Fe;if(G)Z=[await _e(new File([G.blob],"voice-comment.webm",{type:"audio/webm"}))],pe="voice",Fe=G.duration;else for(const Re of xe){const Kt=await _e(Re);Z.push(Kt)}await D({userId:f.id,content:ne,media:Z,replyToId:ve?.id,type:pe,duration:Fe}),re(""),je([]),Pe(null),A(Re=>({...Re,comments:(Re.comments||0)+1})),y(pe==="voice"?"Voice reply posted!":"Reply posted!")}catch(Z){console.error("Failed to post comment:",Z),y("Failed to post reply.")}finally{ce(!1)}}},Te=f?.handle===e.handle,Jt=(R,G)=>{Pe(G?{handle:R,id:p?N||l:G}:null),re(Z=>{const pe=`@${R} `;return Z.includes(pe)?Z:pe+Z}),document.getElementById("comment-input")?.focus()};return u?(0,t.jsxs)(Q.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col",ref:tt,children:[(0,t.jsxs)("article",{className:"p-6 dark:bg-black",children:[(0,t.jsx)(St,{user:e,timeAgo:s,community:w,onUserClick:g,isDetail:!0,showAvatar:!0,isPinned:m,actionsMenu:(0,t.jsx)(Rt,{id:l,user:e,isCurrentUser:Te,isComment:p,isPinned:m,onEdit:()=>oe(!0),onDelete:()=>ee(!0),onTogglePin:q,addToast:y,trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,t.jsx)(Ue,{size:20})})})}),(0,t.jsx)(_t,{content:r,isDetail:!0,isEditing:se,editedContent:K,setEditedContent:he,onCancelEdit:()=>{oe(!1),he(r),ie(a||[]),te([])},onSaveEdit:lt,isUpdating:be,contentClass:i}),F==="voice"&&a?.[0]&&(0,t.jsx)("div",{className:"mt-4 max-w-[300px]",children:(0,t.jsx)(Nt,{url:a[0].url,duration:E||0,isMe:Te})}),Me(r)&&(0,t.jsx)(Ft,{url:Me(r)}),(0,t.jsx)($t,{media:a,isEditing:se,editedMedia:le,setEditedMedia:ie,newFiles:ae,setNewFiles:te}),x&&(0,t.jsx)(Pt,{poll:x,onVote:R=>zs(l,R,f.id)}),o&&(0,t.jsx)("div",{className:"mt-5 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm dark:border-zinc-700",children:(0,t.jsx)(Tt,{...o})}),(0,t.jsx)(Ct,{views:I.views||0,likes:I.likes||0,comments:I.comments||0,isDetail:!0}),(0,t.jsx)("div",{className:"my-4"}),(0,t.jsx)(wt,{liked:P,reposted:M,handleLike:O,handleRepost:V,handleCommentClick:()=>document.getElementById("comment-input")?.focus(),handleShareClick:()=>me(!0),isDetail:!0,isComment:p})]}),ve&&(0,t.jsxs)("div",{className:"flex items-center justify-between bg-zinc-50 px-5 py-2 dark:bg-zinc-900/50",children:[(0,t.jsxs)("span",{className:"text-sm text-zinc-500",children:["Replying to"," ",(0,t.jsxs)("span",{className:"font-bold text-violet-600",children:["@",ve.handle]})]}),(0,t.jsx)("button",{onClick:()=>Pe(null),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,t.jsx)($e,{size:16})})]}),(0,t.jsx)(Bt,{currentUser:f,newComment:ne,setNewComment:re,handleSubmitComment:Qt,loading:ue,selectedFiles:xe,setSelectedFiles:je,isUploading:ye}),(0,t.jsxs)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:[(0,t.jsx)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:(0,t.jsxs)(t.Fragment,{children:[_&&H.length>0&&(0,t.jsxs)("button",{onClick:()=>k(),disabled:L,className:"flex w-full items-center justify-center gap-2 py-3 text-sm font-bold text-violet-600 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[L&&(0,t.jsx)("span",{className:"animate-spin",children:"⌛"}),"View more replies"]}),H.map(R=>(0,t.jsx)(Qe,{...R,isComment:!0,post_id:l,onReply:Jt,onUserClick:g,currentUser:f,stats:{likes:R.stats?.likes||0,comments:R.stats?.comments||0,reposts:R.stats?.reposts||0},timeAgo:R.timeAgo||R.created_at},R.id))]})}),(0,t.jsx)(gt,{open:de,onOpenChange:ee,children:(0,t.jsxs)(zt,{onClick:R=>R.stopPropagation(),children:[(0,t.jsxs)(bt,{children:[(0,t.jsx)(jt,{children:"Are you absolutely sure?"}),(0,t.jsx)(ht,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(vt,{children:[(0,t.jsx)(pt,{onClick:R=>R.stopPropagation(),children:"Cancel"}),(0,t.jsx)(ut,{onClick:it,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})]}):(0,t.jsxs)(Q.article,{initial:{opacity:0,y:10},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-50px"},transition:{duration:.4,ease:"easeOut"},ref:tt,onClick:c,className:`px-5 transition-all ${p?"py-3 bg-transparent hover:bg-zinc-50/30 dark:hover:bg-zinc-800/20":"py-5 bg-white hover:bg-zinc-50/30 dark:bg-black dark:hover:bg-white/[0.02]"} ${c?"cursor-pointer":""}`,children:[h&&(0,t.jsxs)("div",{className:"mb-2.5 ml-1 flex items-center space-x-1.5 text-[13px] font-semibold text-zinc-600",children:[(0,t.jsx)(Be,{size:14,className:"text-zinc-500"}),(0,t.jsxs)("span",{className:"flex cursor-pointer items-center text-zinc-700 hover:underline dark:text-zinc-300",onClick:R=>{R.stopPropagation(),g&&g(h.handle)},children:[h.handle," Reposted"]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-x-3.5",children:[(0,t.jsxs)("div",{className:"flex shrink-0 flex-col items-center self-stretch pt-0.5",children:[(0,t.jsx)("div",{className:"cursor-pointer",onClick:R=>{R.stopPropagation(),g&&g(e.handle)},children:(0,t.jsxs)(we,{className:`${p?"size-8":"size-10"} border-0 shadow-sm`,children:[(0,t.jsx)(Ne,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(Ce,{className:"text-xs",children:e.handle[0]?.toUpperCase()})]})}),(!p&&I.comments>0||p&&!N&&I.comments>0)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mt-2 w-0.5 flex-1 rounded-full bg-zinc-100 dark:bg-zinc-800"}),!p&&(0,t.jsx)(Dl,{avatars:C.length>0?C:(H||[]).slice(0,3).map(R=>R.user.avatar)})]})]}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col xl:max-w-xl",children:[(0,t.jsx)(St,{user:e,timeAgo:s,community:w,onUserClick:g,isComment:p,isPinned:m,actionsMenu:(0,t.jsx)(Rt,{id:l,user:e,isCurrentUser:Te,isComment:p,isPinned:m,onEdit:()=>oe(!0),onDelete:()=>ee(!0),onTogglePin:q,addToast:y,trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 group-hover:bg-zinc-100 dark:hover:bg-zinc-800 dark:group-hover:bg-zinc-800/50",children:(0,t.jsx)(Ue,{size:18})})})}),(0,t.jsx)(_t,{content:r,isEditing:se,editedContent:K,setEditedContent:he,onCancelEdit:()=>{oe(!1),he(r),ie(a||[]),te([])},onSaveEdit:lt,isUpdating:be,contentClass:i}),F==="voice"&&a?.[0]&&(0,t.jsx)("div",{className:"mt-3 max-w-[280px]",children:(0,t.jsx)(Nt,{url:a[0].url,duration:E||0,isMe:Te})}),Me(r)&&(0,t.jsx)(Ft,{url:Me(r)}),(0,t.jsx)($t,{media:a,isEditing:se,editedMedia:le,setEditedMedia:ie,newFiles:ae,setNewFiles:te}),x&&(0,t.jsx)(Pt,{poll:x}),o&&(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-900",onClick:R=>{R.stopPropagation(),T(`/p/${o.id}`)},children:(0,t.jsx)(Tt,{...o})}),(0,t.jsx)(wt,{liked:P,reposted:M,handleLike:O,handleRepost:V,handleCommentClick:R=>{if(R?.stopPropagation(),j){const G=p&&N||l;j(e.handle,G)}else c&&c()},handleShareClick:R=>{R?.stopPropagation(),me(!0)},isComment:p}),(0,t.jsx)(Ct,{views:I.views||0,likes:I.likes||0,comments:I.comments||0,isComment:p,onRepliesClick:()=>{Oe?Ye(!1):Gt()}}),Oe&&(0,t.jsxs)("div",{className:"relative mt-2 space-y-0",children:[(0,t.jsx)("div",{className:"absolute left-[19px] top-0 bottom-4 w-0.5 bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsx)("div",{className:"flex flex-col",children:Ht.map(R=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute left-[19px] top-5 h-0.5 w-4 bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsx)("div",{className:"pl-6",children:(0,t.jsx)(Qe,{...R,isComment:!0,post_id:S||l,onReply:j,onUserClick:g,currentUser:f,stats:{likes:R.stats?.likes||0,comments:R.stats?.comments||0,reposts:R.stats?.reposts||0},timeAgo:R.timeAgo||R.created_at})})]},R.id))})]}),(0,t.jsx)(Wt,{isOpen:X,onClose:()=>me(!1),url:Ge(l),title:"Share Post",overlayClassName:"z-[9999]"}),(0,t.jsx)(gt,{open:de,onOpenChange:ee,children:(0,t.jsxs)(zt,{onClick:R=>R.stopPropagation(),children:[(0,t.jsxs)(bt,{children:[(0,t.jsx)(jt,{children:"Are you absolutely sure?"}),(0,t.jsx)(ht,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(vt,{children:[(0,t.jsx)(pt,{onClick:R=>R.stopPropagation(),children:"Cancel"}),(0,t.jsx)(ut,{onClick:it,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})]})]})};function Ol(l,e){const s=!l.media&&!e.media||l.media?.length===e.media?.length&&l.media?.every((i,a)=>i.url===e.media?.[a].url),r=l.repostedBy?.handle===e.repostedBy?.handle;return l.id===e.id&&l.content===e.content&&l.timeAgo===e.timeAgo&&l.user.id===e.user.id&&l.user.avatar===e.user.avatar&&l.stats.likes===e.stats.likes&&l.stats.comments===e.stats.comments&&l.stats.reposts===e.stats.reposts&&l.currentUser?.id===e.currentUser?.id&&l.is_pinned===e.is_pinned&&!!s&&!!r}var Ul=z.memo(Qe,Ol);function Vl(l){return l.stopPropagation()}function Bl(l){return l.stopPropagation()}function Wl(l){return l.stopPropagation()}function ql(l){return l.stopPropagation()}var Ze=null;const Ee=l=>{Ze=l},Ie=()=>Ze,li=()=>{Ze=null};var Hl=z.memo(({reel:l,isActive:e,volume:s,shouldLoad:r=!0})=>{const{currentUser:i}=At(),{addToast:a}=Je(),{openReport:o}=Ot(),n=(0,z.useRef)(null),[c,h]=(0,z.useState)(!1),[g,f]=(0,z.useState)(!1),[x,u]=(0,z.useState)(!1),[d,v]=(0,z.useState)(!1),[b,p]=(0,z.useState)(null),[j,w]=(0,z.useState)(!1),[N,S]=(0,z.useState)(l.stats?.likes||0),[C,m]=(0,z.useState)(!1),[F,E]=(0,z.useState)(0),[T,y]=(0,z.useState)(!1),$=(0,z.useRef)(null);(0,z.useEffect)(()=>{if(e&&l.id&&!l.id.toString().startsWith("temp-")){const k=setTimeout(()=>{Vt(l.id).catch(console.error)},1500);return()=>clearTimeout(k)}},[e,l.id]);const P=(0,z.useMemo)(()=>Array.isArray(l.media)?l.media[0]?.src||l.media[0]?.url:l.media?.src||l.media?.url||l.url,[l.media,l.url]);(0,z.useEffect)(()=>{v(!1),y(!1);const k=n.current?.plyr;if(k&&typeof k.on=="function"){const _=()=>v(!0),L=()=>y(!0);k.on("ready",_),k.on("canplay",_),k.on("loadeddata",_),k.on("playing",L);const D=setTimeout(()=>{e&&y(!0)},3e3);return()=>{clearTimeout(D),typeof k.off=="function"&&(k.off("ready",_),k.off("canplay",_),k.off("loadeddata",_),k.off("playing",L))}}else{const _=setTimeout(()=>{v(!0),e&&y(!0)},1500);return()=>clearTimeout(_)}},[P]);const M=(0,z.useRef)(null);(0,z.useEffect)(()=>{const k=n.current,_=k?.plyr;if(M.current&&(clearTimeout(M.current),M.current=null),!(!_||!d))return e?M.current=setTimeout(()=>{M.current=null;const L=n.current?.plyr;if(L&&typeof L.play=="function"){const D=Ie();D&&D!==L&&typeof D.pause=="function"&&(D.pause(),typeof D.currentTime<"u"&&(D.currentTime=0)),L.play().catch(()=>{const B=n.current?.plyr;B&&typeof B.play=="function"&&B.play().catch(()=>{})}).then(()=>{Ee(L)})}},50):typeof _.pause=="function"&&(_.pause(),typeof _.currentTime<"u"&&(_.currentTime=0),Ie()===_&&Ee(null)),()=>{M.current&&(clearTimeout(M.current),M.current=null);const L=k?.plyr;L&&typeof L.pause=="function"&&(L.pause(),typeof L.currentTime<"u"&&(L.currentTime=0),Ie()===L&&Ee(null))}},[e,d]),(0,z.useEffect)(()=>{const k=n.current;return()=>{M.current&&(clearTimeout(M.current),M.current=null);const _=k?.plyr;_&&typeof _.pause=="function"&&(_.pause(),_.currentTime=0,Ie()===_&&Ee(null)),v(!1),y(!1),E(0)}},[]),(0,z.useEffect)(()=>{if(!i?.id||!e)return;(async()=>{try{if(!l.id||l.id.toString().startsWith("temp-"))return;const _=[Ps(i.id,l.id)];l.user?.id&&l.user.id!=="undefined"?_.push(Ss(i.id,l.user.id)):_.push(Promise.resolve(!1));const[L,D]=await Promise.all(_);w(L),m(D)}catch(_){console.error("Failed to check interaction status:",_)}})()},[l.id,i?.id,e,l.user?.id]),(0,z.useEffect)(()=>{const k=n.current?.plyr;k&&e&&(k.muted=s===0,k.volume=s)},[s,d,e]),(0,z.useEffect)(()=>{const k=n.current?.plyr;if(!k||!e)return;const _=()=>{const L=k.currentTime,D=k.duration;D>0&&E(L/D*100)};if(typeof k.on=="function")return k.on("timeupdate",_),()=>{typeof k.off=="function"&&k.off("timeupdate",_)}},[e]);const I=k=>{k.stopPropagation();const _=k.currentTarget.getBoundingClientRect(),L=k.clientX-_.left,D=Math.min(Math.max(0,L/_.width),1),B=n.current?.plyr;B&&B.duration&&(B.currentTime=D*B.duration,E(D*100))};(0,z.useEffect)(()=>()=>{$.current&&clearTimeout($.current)},[]);const A=k=>{const _=k.target;_.closest("button")||_.closest("a")||_.closest(".plyr__controls")||($.current?(clearTimeout($.current),$.current=null,V()):$.current=setTimeout(()=>{$.current=null,O()},250))},O=()=>{const k=n.current?.plyr;k&&(k.paused?(typeof k.play=="function"&&k.play().catch(()=>{}),p("play")):(typeof k.pause=="function"&&k.pause(),p("pause")),setTimeout(()=>p(null),800))},V=async()=>{if(i&&(h(!0),setTimeout(()=>h(!1),800),!j)){w(!0),S(k=>k+1);try{await ft(i.id,l.id)}catch{w(!1),S(k=>k-1)}}},J=async k=>{if(k.stopPropagation(),!i)return;const _=!j;w(_),S(L=>_?L+1:L-1);try{await ft(i.id,l.id)}catch{w(!_),S(L=>_?L-1:L+1)}},W=async k=>{if(k.stopPropagation(),!i)return;const _=!C;m(_);try{await ws(i.id,l.user?.id)}catch{m(!_)}},q=k=>{k.stopPropagation(),u(!0)},H=(0,z.useMemo)(()=>({source:{type:"video",sources:[{src:P,type:"video/mp4"}]},options:{controls:[],loop:{active:!0},clickToPlay:!1,ratio:"9:16",autoplay:!1,playsinline:!0,muted:!0}}),[P]);return(0,t.jsxs)("div",{"data-id":l.id,className:"reel-item relative flex h-[100dvh] w-full snap-start items-center justify-center overflow-hidden bg-black cursor-pointer select-none",onClick:A,children:[(0,t.jsxs)("div",{className:"relative flex h-full w-full max-w-[450px] items-center justify-center",children:[(0,t.jsx)("div",{className:"w-full",children:r?(0,t.jsx)(ys,{ref:n,...H}):(0,t.jsx)("div",{className:"aspect-[9/16] w-full bg-zinc-900",children:(0,t.jsx)("img",{src:l.media?.[0]?.preview||l.media?.[0]?.thumbnail||P,className:"h-full w-full object-cover opacity-50 blur-xl",alt:"Reel preview"})})}),!T&&(0,t.jsx)("div",{className:"absolute inset-0 z-[60] flex items-center justify-center bg-zinc-900 pointer-events-none",children:(0,t.jsx)(Js,{})}),(0,t.jsx)(He,{children:c&&(0,t.jsx)(Q.div,{initial:{scale:0,opacity:0},animate:{scale:[0,1.2,1],opacity:1},exit:{scale:1.5,opacity:0},transition:{duration:.5,type:"spring",stiffness:400,damping:20},className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)(Le,{size:120,fill:"white",className:"text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.4)]"})})}),(0,t.jsx)(He,{children:b&&(0,t.jsx)(Q.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},transition:{duration:.4},className:"absolute inset-0 z-50 flex items-center justify-center",onClick:k=>{k.stopPropagation(),O()},children:(0,t.jsx)("div",{className:"rounded-full border border-white/20 bg-white/10 p-8 shadow-2xl backdrop-blur-md cursor-pointer hover:bg-white/20 transition-colors",children:b==="play"?(0,t.jsx)(Ae,{size:50,fill:"white",className:"ml-1.5 text-white"}):(0,t.jsx)(vs,{size:50,fill:"white",className:"text-white"})})})}),(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/60"}),(0,t.jsxs)("div",{className:"pointer-events-none absolute bottom-6 left-4 right-16 text-white",children:[(0,t.jsxs)("div",{className:"pointer-events-auto mb-3 flex items-center gap-2",children:[(0,t.jsxs)(Xt,{to:`/u/${l.user?.handle}`,className:"flex items-center gap-2 transition-opacity hover:opacity-80 active:scale-95",onClick:k=>k.stopPropagation(),children:[(0,t.jsxs)(we,{className:"size-10 border-2 border-white",children:[(0,t.jsx)(Ne,{src:l.user?.avatar,alt:l.user?.handle,className:"object-cover"}),(0,t.jsx)(Ce,{children:l.user?.handle?.[0]?.toUpperCase()})]}),(0,t.jsxs)("span",{className:"font-bold",children:["@",l.user?.handle]})]}),i?.id!==l.user?.id&&(0,t.jsx)("button",{className:`ml-2 flex items-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-bold transition-all active:scale-95 ${C?"border border-white/50 bg-transparent text-white":"bg-white text-black hover:bg-zinc-200"}`,onClick:W,children:C?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Vs,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Following"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Bs,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Follow"})]})})]}),(0,t.jsx)(Ke,{content:l.content,className:"mb-3 line-clamp-2 text-sm text-white"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[(0,t.jsx)(bs,{size:14,className:"animate-spin-slow"}),(0,t.jsxs)("span",{children:["Original Audio - ",l.user?.handle]})]})]}),(0,t.jsxs)("div",{className:"absolute bottom-6 right-2 z-10 flex flex-col items-center gap-6",children:[(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)(Q.button,{whileTap:{scale:.8},className:`rounded-full p-3 backdrop-blur-md transition-all ${j?"bg-rose-500/20 text-rose-500":"bg-zinc-800/50 text-white hover:bg-zinc-700"}`,onClick:J,children:(0,t.jsx)(Q.div,{animate:j?{scale:[1,1.3,1]}:{scale:1},transition:{duration:.3},children:(0,t.jsx)(Le,{size:28,fill:j?"currentColor":"none"})})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:N})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)(Q.button,{whileTap:{scale:.8},className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700",onClick:k=>{k.stopPropagation(),f(!0)},children:(0,t.jsx)(Ut,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:l.stats?.comments||0})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)(Q.button,{whileTap:{scale:.8},className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700",onClick:q,children:(0,t.jsx)(De,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:l.stats?.shares||0})]}),(0,t.jsx)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:(0,t.jsx)(Q.button,{whileTap:{scale:.8},className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-rose-500/20 hover:text-rose-500",onClick:k=>{k.stopPropagation(),o("reel",l.id)},children:(0,t.jsx)(We,{size:28})})})]}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 z-50 h-[3px] w-full bg-white/20 hover:h-[8px] transition-all cursor-pointer group",onClick:I,children:(0,t.jsx)("div",{className:"h-full bg-white shadow-[0_0_8px_rgba(255,255,255,0.8)] transition-all duration-100 ease-linear relative",style:{width:`${F}%`},children:(0,t.jsx)("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 size-3 bg-white rounded-full shadow-lg scale-0 group-hover:scale-100 transition-transform"})})})]}),(0,t.jsx)(Ql,{isOpen:g,onClose:()=>f(!1),reelId:l.id,currentUser:i,showToast:a}),(0,t.jsx)(Wt,{isOpen:x,onClose:()=>u(!1),url:Ks(l.id),title:"Share Reel",overlayClassName:"z-[9999]"})]})},(l,e)=>l.isActive===e.isActive&&l.reel.id===e.reel.id&&l.volume===e.volume&&l.shouldLoad===e.shouldLoad),ii=Hl,Gl=({isOpen:l,onClose:e,reelId:s,currentUser:r,showToast:i})=>{const[a,o]=(0,z.useState)([]),[n,c]=(0,z.useState)(!1),[h,g]=(0,z.useState)(!1),[f,x]=(0,z.useState)(""),[u,d]=(0,z.useState)([]),[v,b]=(0,z.useState)(!1),[p,j]=(0,z.useState)(!0),[w,N]=(0,z.useState)(!1),[S,C]=(0,z.useState)(null),m=(0,z.useRef)(a);(0,z.useEffect)(()=>{m.current=a},[a]);const F=(0,z.useCallback)(async(T=!1)=>{if(!(!s||s.startsWith("temp-"))){T?N(!0):c(!0);try{const y=m.current,$=await ks(s,T&&y.length>0?y[y.length-1].created_at:null,10);$.length<10?j(!1):j(!0),o(T?P=>[...P,...$]:$)}catch(y){console.error("Failed to load comments:",y),i&&i("Failed to load comments","error")}finally{c(!1),N(!1)}}},[s,i]);(0,z.useEffect)(()=>{l&&s?F():(o([]),j(!0))},[l,s,F]);const E=async(T,y)=>{if(T?.preventDefault(),!(!f.trim()&&u.length===0&&!y||!r)){g(!0),b(!0);try{let $=[],P="text",M=null;if(y)$=[await _e(new File([y.blob],"voice-comment.webm",{type:"audio/webm"}))],P="voice",M=y.duration;else for(const I of u){const A=await _e(I);$.push(A)}await Gs(s,r.id,f,$,S?.id,P,M),x(""),d([]),C(null),i&&i(P==="voice"?"Voice reply posted!":"Reply posted!"),F()}catch($){console.error("Failed to post comment:",$),i&&i("Failed to post reply.","error")}finally{g(!1),b(!1)}}};return(0,t.jsx)(Dt,{isOpen:l,onClose:e,title:"Comments",className:"max-sm:h-[95dvh] h-[85vh] overflow-hidden !p-0 sm:max-w-xl",children:(0,t.jsxs)("div",{className:"flex h-full flex-col overflow-hidden bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"mx-auto my-3 h-1.5 w-12 shrink-0 rounded-full bg-zinc-200 dark:bg-zinc-800 sm:hidden"}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto scroll-smooth scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800",children:n?(0,t.jsx)("div",{className:"flex flex-col",children:[1,2,3].map(T=>(0,t.jsx)($s,{},T))}):a.length>0?(0,t.jsxs)("div",{className:"flex flex-col",children:[a.map(T=>(0,t.jsx)(Ul,{...T,isComment:!0,post_id:s,currentUser:r,showToast:i,onReply:(y,$)=>{C($?{handle:y,id:$}:null),x(P=>P.includes(`@${y}`)?P:P+`@${y} `)},onDelete:y=>o($=>$.filter(P=>P.id!==y)),onUpdate:(y,$,P)=>o(M=>M.map(I=>I.id===y?{...I,content:$,media:P}:I))},T.id)),p&&(0,t.jsx)("div",{className:"flex justify-center border-t border-zinc-100 py-4 dark:border-zinc-800",children:(0,t.jsx)(Lt,{variant:"ghost",onClick:()=>F(!0),loading:w,className:"text-violet-600 font-bold",children:"View more replies"})})]}):(0,t.jsxs)("div",{className:"flex h-full min-h-[300px] flex-col items-center justify-center p-8 text-center text-zinc-500",children:[(0,t.jsx)("div",{className:"mb-4 flex size-16 items-center justify-center rounded-full bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(It,{size:32,className:"text-zinc-400"})}),(0,t.jsx)("p",{className:"text-lg font-bold dark:text-zinc-300",children:"No comments yet"}),(0,t.jsx)("p",{className:"text-sm dark:text-zinc-500",children:"Be the first to share what you think!"})]})}),(0,t.jsxs)("div",{className:"shrink-0 border-t border-zinc-100 bg-white pb-safe dark:border-zinc-800 dark:bg-zinc-900",children:[S&&(0,t.jsxs)("div",{className:"flex items-center justify-between border-b border-zinc-50 bg-zinc-50/50 px-4 py-2 dark:border-zinc-800/50 dark:bg-zinc-900/50",children:[(0,t.jsxs)("span",{className:"text-xs text-zinc-500",children:["Replying to"," ",(0,t.jsxs)("span",{className:"font-bold text-violet-600",children:["@",S.handle]})]}),(0,t.jsx)("button",{onClick:()=>C(null),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,t.jsx)($e,{size:14})})]}),(0,t.jsx)(Bt,{currentUser:r,newComment:f,setNewComment:x,handleSubmitComment:E,loading:h,selectedFiles:u,setSelectedFiles:d,isUploading:v})]})]})})},Ql=Gl;export{li as n,Ul as r,ii as t};
