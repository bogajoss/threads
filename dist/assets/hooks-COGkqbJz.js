import{a as Xe}from"./rolldown-runtime-BaZ8gS7u.js";import{s as Ze}from"./animations-pEILWrFP.js";import{_ as de,c as te,v as Ae,y as Ke}from"./framework-di2JoXyY.js";import{a as me,n as he,r as ye,t as re}from"./query-CXZjka15.js";import{$t as Ie,An as De,Cn as Ue,Ft as et,Gt as tt,Ht as st,It as it,Jt as nt,Lt as ue,Mn as ce,Nn as fe,Nt as rt,Pt as _e,Qt as at,Sn as ot,Tn as Se,Ut as ct,Vt as lt,Wt as ut,Xt as ft,Yt as ht,Zt as dt,_n as mt,an as gt,c as pt,dn as yt,en as _t,fn as Mt,gn as At,hn as Pt,in as wt,ln as Ft,nn as Et,on as Dt,pn as bt,qt as St,sn as xt,tn as vt,un as Ct,wn as Rt}from"./index-DHu-CTyd.js";var $t=te(),H=Xe(Ze(),1);const Lt=(e,i,s)=>{const t=(0,$t.c)(16);let n,r;t[0]!==i||t[1]!==e?(n=["follows",i,e],r=M=>{const{pageParam:_}=M;return(i==="Followers"?ot:Ue)(e,_,10)},t[0]=i,t[1]=e,t[2]=n,t[3]=r):(n=t[2],r=t[3]);const a=!!e&&s;let o;t[4]!==n||t[5]!==r||t[6]!==a?(o={queryKey:n,queryFn:r,initialPageParam:null,getNextPageParam:Nt,enabled:a},t[4]=n,t[5]=r,t[6]=a,t[7]=o):o=t[7];const{data:c,fetchNextPage:l,hasNextPage:f,isFetchingNextPage:u,isLoading:h}=re(o);let g;t[8]!==c?.pages?(g=c?.pages.flatMap(Bt)||[],t[8]=c?.pages,t[9]=g):g=t[9];const m=g;let p;return t[10]!==l||t[11]!==m||t[12]!==f||t[13]!==u||t[14]!==h?(p={followList:m,fetchNextPage:l,hasNextPage:f,isFetchingNextPage:u,isLoading:h},t[10]=l,t[11]=m,t[12]=f,t[13]=u,t[14]=h,t[15]=p):p=t[15],p};function Nt(e){if(!(!e||e.length<10))return e[e.length-1].followed_at}function Bt(e){return e}var kt=te();const Tt=(e,i)=>{const s=(0,kt.c)(95),t=me(),{addToast:n}=_e();let r;s[0]!==e?.id?(r=($,Y)=>{const z=$===void 0?[]:$,U=Y===void 0?[]:Y;return z.map(W=>{const ne=W.reply_to_id;let ae=null;if(ne){const se=z.find(Ee=>Ee.id===ne);se&&(ae={id:se.id,senderName:se.sender?.name||se.sender?.display_name||"Unknown",text:se.content||(se.type==="image"?"Photo":se.type==="video"?"Video":se.type==="voice"?"Voice message":"")})}return{id:W.id,sender:W.sender_id===e?.id?"me":"them",senderAvatar:W.sender?.avatar,senderName:W.sender?.name,text:W.content||"",type:W.type||"text",media:W.media?Array.isArray(W.media)?W.media:[W.media]:[],isRead:W.is_read||!1,replyToId:ne,replyTo:ae,reactions:U.filter(se=>se.message_id===W.id),time:W.created_at?new Date(W.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Just now",updatedAt:W.updated_at,isOptimistic:W.isOptimistic}})},s[0]=e?.id,s[1]=r):r=s[1],e?.id;const a=r;let o,c;s[2]!==i?(o=["messages",i],c=$=>{const{pageParam:Y}=$;return St(i,Y,20)},s[2]=i,s[3]=o,s[4]=c):(o=s[3],c=s[4]);const l=!!i;let f;s[5]!==o||s[6]!==c||s[7]!==l?(f={queryKey:o,queryFn:c,initialPageParam:null,getNextPageParam:qt,enabled:l,refetchOnWindowFocus:!1},s[5]=o,s[6]=c,s[7]=l,s[8]=f):f=s[8];const{data:u,fetchNextPage:h,hasNextPage:g,isFetchingNextPage:m,isLoading:p,refetch:M}=re(f);let _,F;s[9]!==i?(_=["reactions",i],F=()=>nt(i),s[9]=i,s[10]=_,s[11]=F):(_=s[10],F=s[11]);const w=!!i;let D;s[12]!==_||s[13]!==F||s[14]!==w?(D={queryKey:_,queryFn:F,enabled:w,staleTime:3e5},s[12]=_,s[13]=F,s[14]=w,s[15]=D):D=s[15];const{data:d}=ye(D);let A;s[16]!==d?(A=d===void 0?[]:d,s[16]=d,s[17]=A):A=s[17];const y=A;let P;s[18]!==e?(P=$=>{const{convId:Y,text:z,type:U,media:W,replyToId:ne}=$,ae=U===void 0?"text":U,se=W===void 0?[]:W,Ee=ne===void 0?null:ne;return dt(Y,e.id,z,ae,se,Ee)},s[18]=e,s[19]=P):P=s[19];let b;s[20]!==i||s[21]!==e||s[22]!==t?(b=async $=>{await t.cancelQueries({queryKey:["messages",i]});const Y=t.getQueryData(["messages",i]),z={id:`temp-${Date.now()}`,conversation_id:i,sender_id:e.id,content:$.text,type:$.type||"text",media:$.media||[],reply_to_id:$.replyToId,reply_to:null,is_read:!1,created_at:new Date().toISOString(),isOptimistic:!0,sender:{id:e.id,handle:e.handle,name:e.name,avatar:e.avatar,verified:e.verified}};return t.setQueryData(["messages",i],U=>{if(!U)return{pages:[[z]],pageParams:[null]};const W=[...U.pages];return W[0]=[z,...W[0]],{...U,pages:W}}),{previousMessages:Y}},s[20]=i,s[21]=e,s[22]=t,s[23]=b):b=s[23];let L;s[24]!==i||s[25]!==n||s[26]!==t?(L=($,Y,z)=>{t.setQueryData(["messages",i],z?.previousMessages),n("Failed to send message","error")},s[24]=i,s[25]=n,s[26]=t,s[27]=L):L=s[27];let R;s[28]!==i||s[29]!==e||s[30]!==t?(R=()=>{t.invalidateQueries({queryKey:["messages",i]}),t.invalidateQueries({queryKey:["conversations",e.id]})},s[28]=i,s[29]=e,s[30]=t,s[31]=R):R=s[31];let N;s[32]!==P||s[33]!==b||s[34]!==L||s[35]!==R?(N={mutationFn:P,onMutate:b,onError:L,onSettled:R},s[32]=P,s[33]=b,s[34]=L,s[35]=R,s[36]=N):N=s[36];const S=he(N);let x;s[37]!==i||s[38]!==t?(x=async $=>{const{messageId:Y,content:z}=$;await t.cancelQueries({queryKey:["messages",i]});const U=t.getQueryData(["messages",i]);return t.setQueryData(["messages",i],W=>W&&{...W,pages:W.pages.map(ne=>ne.map(ae=>ae.id===Y?{...ae,content:z}:ae))}),{previousMessages:U}},s[37]=i,s[38]=t,s[39]=x):x=s[39];let v;s[40]!==i||s[41]!==e?.id||s[42]!==t?(v=$=>{$&&(t.invalidateQueries({queryKey:["messages",i]}),t.invalidateQueries({queryKey:["conversations",e?.id]}))},s[40]=i,s[41]=e?.id,s[42]=t,s[43]=v):v=s[43];let C;s[44]!==i||s[45]!==n||s[46]!==t?(C=($,Y,z)=>{t.setQueryData(["messages",i],z?.previousMessages),n("Failed to edit message","error")},s[44]=i,s[45]=n,s[46]=t,s[47]=C):C=s[47];let Q;s[48]!==x||s[49]!==v||s[50]!==C?(Q={mutationFn:Qt,onMutate:x,onSuccess:v,onError:C},s[48]=x,s[49]=v,s[50]=C,s[51]=Q):Q=s[51];const K=he(Q);let j;s[52]!==i||s[53]!==n||s[54]!==e||s[55]!==t?(j=async($,Y)=>{if(!e?.id||!i)return;await t.cancelQueries({queryKey:["reactions",i]});const z=t.getQueryData(["reactions",i]),U=z?.find(W=>W.message_id===$&&W.user_id===e.id&&W.emoji===Y);t.setQueryData(["reactions",i],W=>{const ne=W===void 0?[]:W;if(U)return ne.filter(se=>se.id!==U.id);const ae={id:`temp-${Date.now()}`,message_id:$,user_id:e.id,emoji:Y,created_at:new Date().toISOString()};return[...ne,ae]});try{await at($,e.id,Y),t.invalidateQueries({queryKey:["reactions",i]})}catch(W){console.error("Failed to toggle reaction:",W),t.setQueryData(["reactions",i],z),n("Failed to update reaction","error")}},s[52]=i,s[53]=n,s[54]=e,s[55]=t,s[56]=j):j=s[56];const V=j;let Z;s[57]!==i||s[58]!==t?(Z=async $=>{await t.cancelQueries({queryKey:["messages",i]});const Y=t.getQueryData(["messages",i]);return t.setQueryData(["messages",i],z=>z&&{...z,pages:z.pages.map(U=>U.filter(W=>W.id!==$))}),{previousMessages:Y}},s[57]=i,s[58]=t,s[59]=Z):Z=s[59];let G;s[60]!==i||s[61]!==e?.id||s[62]!==t?(G=()=>{t.invalidateQueries({queryKey:["messages",i]}),t.invalidateQueries({queryKey:["conversations",e?.id]})},s[60]=i,s[61]=e?.id,s[62]=t,s[63]=G):G=s[63];let I;s[64]!==i||s[65]!==n||s[66]!==t?(I=($,Y,z)=>{t.setQueryData(["messages",i],z?.previousMessages),n("Failed to delete message","error")},s[64]=i,s[65]=n,s[66]=t,s[67]=I):I=s[67];let X;s[68]!==Z||s[69]!==G||s[70]!==I?(X={mutationFn:Kt,onMutate:Z,onSuccess:G,onError:I},s[68]=Z,s[69]=G,s[70]=I,s[71]=X):X=s[71];const O=he(X);let B;s[72]!==u?.pages?(B=[...u?.pages.flatMap(Ot)||[]].reverse(),s[72]=u?.pages,s[73]=B):B=s[73];const k=B;let T;s[74]!==S?(T=($,Y,z,U,W)=>S.mutate({convId:$,text:Y,type:z,media:U,replyToId:W}),s[74]=S,s[75]=T):T=s[75];let E;s[76]!==K?(E=($,Y)=>K.mutate({messageId:$,content:Y}),s[76]=K,s[77]=E):E=s[77];let J;s[78]!==O?(J=$=>O.mutate($),s[78]=O,s[79]=J):J=s[79];let ee;return s[80]!==y||s[81]!==K.isPending||s[82]!==h||s[83]!==k||s[84]!==a||s[85]!==g||s[86]!==m||s[87]!==p||s[88]!==V||s[89]!==M||s[90]!==S.isPending||s[91]!==T||s[92]!==E||s[93]!==J?(ee={messages:k,isMsgLoading:p,refetchMessages:M,fetchNextMessages:h,hasMoreMessages:g,isFetchingMoreMessages:m,sendMessage:T,editMessage:E,isSending:S.isPending,isEditing:K.isPending,onToggleReaction:V,onDeleteMessage:J,conversationReactions:y,formatMessages:a},s[80]=y,s[81]=K.isPending,s[82]=h,s[83]=k,s[84]=a,s[85]=g,s[86]=m,s[87]=p,s[88]=V,s[89]=M,s[90]=S.isPending,s[91]=T,s[92]=E,s[93]=J,s[94]=ee):ee=s[94],ee};function qt(e){if(!(!e||e.length<20))return e[e.length-1].created_at}function Qt(e){const{messageId:i,content:s}=e;return tt(i,s)}function Kt(e){return ut(e)}function Ot(e){return e}var jt=te();const zt=(e,i)=>{const s=(0,jt.c)(21),t=me();let n;s[0]===Symbol.for("react.memo_cache_sentinel")?(n={},s[0]=n):n=s[0];const[r,a]=(0,H.useState)(n),o=(0,H.useRef)(null);let c;s[1]===Symbol.for("react.memo_cache_sentinel")?(c={},s[1]=c):c=s[1];const l=(0,H.useRef)(c);let f;s[2]!==e||s[3]!==t?(f=async F=>{if(!(!e?.id||!F))try{await ft(F),t.invalidateQueries({queryKey:["unread_messages_count",e.id]}),t.invalidateQueries({queryKey:["conversations",e.id]})}catch(w){console.error("Failed to mark as read:",w)}},s[2]=e,s[3]=t,s[4]=f):f=s[4];const u=f;let h;s[5]!==i||s[6]!==e||s[7]!==u||s[8]!==t?(h=()=>{if(!e?.id)return;const F=fe.channel(`messages_realtime:${i||"global"}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},d=>{const A=d.new;i&&A.conversation_id===i&&(t.invalidateQueries({queryKey:["messages",i]}),A.sender_id!==e.id&&u(i)),t.invalidateQueries({queryKey:["conversations",e.id]}),A.sender_id!==e.id&&t.invalidateQueries({queryKey:["unread_messages_count",e.id]}),a(y=>({...y,[A.conversation_id]:!1}))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"messages"},()=>{t.invalidateQueries({queryKey:["messages"]}),t.invalidateQueries({queryKey:["conversations",e.id]})}).on("postgres_changes",{event:"*",schema:"public",table:"message_reactions"},()=>{i&&t.invalidateQueries({queryKey:["reactions",i]})}).subscribe(),w=fe.channel("chat_typing_shared").on("broadcast",{event:"typing"},d=>{const{payload:A}=d,{conversationId:y,isTyping:P,userId:b}=A;b!==e.id&&(a(L=>({...L,[y]:P})),l.current[y]&&window.clearTimeout(l.current[y]),P&&(l.current[y]=window.setTimeout(()=>{a(L=>({...L,[y]:!1}))},5e3)))}).subscribe();o.current=w;const D=l.current;return()=>{fe.removeChannel(F),fe.removeChannel(w),Object.values(D).forEach(window.clearTimeout)}},s[5]=i,s[6]=e,s[7]=u,s[8]=t,s[9]=h):h=s[9];const g=e?.id;let m;s[10]!==i||s[11]!==u||s[12]!==t||s[13]!==g?(m=[g,t,i,u],s[10]=i,s[11]=u,s[12]=t,s[13]=g,s[14]=m):m=s[14],(0,H.useEffect)(h,m);let p;s[15]!==e?(p=(F,w)=>{o.current&&e&&o.current.send({type:"broadcast",event:"typing",payload:{conversationId:F,isTyping:w,userId:e.id}})},s[15]=e,s[16]=p):p=s[16];const M=p;let _;return s[17]!==u||s[18]!==M||s[19]!==r?(_={typingStatus:r,sendTypingStatus:M,markAsRead:u},s[17]=u,s[18]=M,s[19]=r,s[20]=_):_=s[20],_};var Wt=te();const Vt=(e,i)=>{const s=(0,Wt.c)(22),{conversations:t,unreadCount:n,isConvLoading:r,refetchConversations:a}=pt(e),{messages:o,isMsgLoading:c,refetchMessages:l,fetchNextMessages:f,hasMoreMessages:u,isFetchingMoreMessages:h,sendMessage:g,editMessage:m,isSending:p,isEditing:M,onToggleReaction:_,onDeleteMessage:F,conversationReactions:w,formatMessages:D}=Tt(e,i),{typingStatus:d,sendTypingStatus:A,markAsRead:y}=zt(e,i);let P;return s[0]!==w||s[1]!==t||s[2]!==m||s[3]!==f||s[4]!==D||s[5]!==u||s[6]!==r||s[7]!==M||s[8]!==h||s[9]!==c||s[10]!==p||s[11]!==y||s[12]!==o||s[13]!==F||s[14]!==_||s[15]!==a||s[16]!==l||s[17]!==g||s[18]!==A||s[19]!==d||s[20]!==n?(P={conversations:t,unreadCount:n,isConvLoading:r,refetchConversations:a,refetchMessages:l,sendMessage:g,editMessage:m,sendTypingStatus:A,typingStatus:d,markAsRead:y,formatMessages:D,onToggleReaction:_,onDeleteMessage:F,conversationReactions:w,isSending:p,isEditing:M,messages:o,isMsgLoading:c,fetchNextMessages:f,hasMoreMessages:u,isFetchingMoreMessages:h},s[0]=w,s[1]=t,s[2]=m,s[3]=f,s[4]=D,s[5]=u,s[6]=r,s[7]=M,s[8]=h,s[9]=c,s[10]=p,s[11]=y,s[12]=o,s[13]=F,s[14]=_,s[15]=a,s[16]=l,s[17]=g,s[18]=A,s[19]=d,s[20]=n,s[21]=P):P=s[21],P};var Ht=te();const $i=(e,i,s)=>{const t=(0,Ht.c)(85),n=me(),{addToast:r}=_e();let a;t[0]!==i?(a=i||{comments:0,likes:0,mirrors:0,reposts:0},t[0]=i,t[1]=a):a=t[1];const[o,c]=(0,H.useState)(a),[l,f]=(0,H.useState)(i);i!==l&&(f(i),c(k=>({...k,...i})));const u=s?.id;let h;t[2]!==e||t[3]!==u?(h=["post",e,"liked",u],t[2]=e,t[3]=u,t[4]=h):h=t[4];let g,m;t[5]!==s||t[6]!==e?(g=()=>Dt(e,s.id),m=!!s&&ce(e)&&ce(s.id),t[5]=s,t[6]=e,t[7]=g,t[8]=m):(g=t[7],m=t[8]);let p;t[9]!==h||t[10]!==g||t[11]!==m?(p={queryKey:h,queryFn:g,enabled:m,staleTime:6e5},t[9]=h,t[10]=g,t[11]=m,t[12]=p):p=t[12];const{data:M}=ye(p),_=M===void 0?!1:M,F=s?.id;let w;t[13]!==e||t[14]!==F?(w=["post",e,"reposted",F],t[13]=e,t[14]=F,t[15]=w):w=t[15];let D,d;t[16]!==s||t[17]!==e?(d=()=>xt(e,s.id),D=!!s&&ce(e)&&ce(s.id),t[16]=s,t[17]=e,t[18]=D,t[19]=d):(D=t[18],d=t[19]);let A;t[20]!==D||t[21]!==w||t[22]!==d?(A={queryKey:w,queryFn:d,enabled:D,staleTime:6e5},t[20]=D,t[21]=w,t[22]=d,t[23]=A):A=t[23];const{data:y}=ye(A),P=y===void 0?!1:y;let b;t[24]!==s||t[25]!==e?(b=()=>At(e,s.id),t[24]=s,t[25]=e,t[26]=b):b=t[26];let L;t[27]!==s||t[28]!==e||t[29]!==n?(L=async()=>{const k=s.id;await n.cancelQueries({queryKey:["post",e,"liked",k]});const T=n.getQueryData(["post",e,"liked",k]);return n.setQueryData(["post",e,"liked",k],!T),c(E=>({...E,likes:T?(E.likes||0)-1:(E.likes||0)+1})),{previousLiked:T}},t[27]=s,t[28]=e,t[29]=n,t[30]=L):L=t[30];let R;t[31]!==r||t[32]!==s||t[33]!==e||t[34]!==n?(R=(k,T,E)=>{E?.previousLiked!==void 0&&(n.setQueryData(["post",e,"liked",s.id],E.previousLiked),c(J=>({...J,likes:E.previousLiked?(J.likes||0)+1:(J.likes||0)-1}))),r("Failed to update like","error")},t[31]=r,t[32]=s,t[33]=e,t[34]=n,t[35]=R):R=t[35];let N;t[36]!==s?.id||t[37]!==e||t[38]!==n?(N=()=>{n.invalidateQueries({queryKey:["post",e,"liked",s?.id]})},t[36]=s?.id,t[37]=e,t[38]=n,t[39]=N):N=t[39];let S;t[40]!==b||t[41]!==L||t[42]!==R||t[43]!==N?(S={mutationFn:b,onMutate:L,onError:R,onSettled:N},t[40]=b,t[41]=L,t[42]=R,t[43]=N,t[44]=S):S=t[44];const x=he(S);let v;t[45]!==s||t[46]!==e?(v=()=>mt(e,s.id),t[45]=s,t[46]=e,t[47]=v):v=t[47];let C;t[48]!==s||t[49]!==e||t[50]!==n?(C=async()=>{const k=s.id;await n.cancelQueries({queryKey:["post",e,"reposted",k]});const T=n.getQueryData(["post",e,"reposted",k]);return n.setQueryData(["post",e,"reposted",k],!T),c(E=>({...E,reposts:T?(E.reposts||0)-1:(E.reposts||0)+1,mirrors:T?(E.mirrors||0)-1:(E.mirrors||0)+1})),{previousReposted:T}},t[48]=s,t[49]=e,t[50]=n,t[51]=C):C=t[51];let Q;t[52]!==r||t[53]!==s||t[54]!==e||t[55]!==n?(Q=(k,T,E)=>{E?.previousReposted!==void 0&&(n.setQueryData(["post",e,"reposted",s.id],E.previousReposted),c(J=>({...J,reposts:E.previousReposted?(J.reposts||0)+1:(J.reposts||0)-1,mirrors:E.previousReposted?(J.mirrors||0)+1:(J.mirrors||0)-1}))),r("Failed to update repost","error")},t[52]=r,t[53]=s,t[54]=e,t[55]=n,t[56]=Q):Q=t[56];let K;t[57]!==s?.id||t[58]!==e||t[59]!==n?(K=()=>{n.invalidateQueries({queryKey:["post",e,"reposted",s?.id]})},t[57]=s?.id,t[58]=e,t[59]=n,t[60]=K):K=t[60];let j;t[61]!==r?(j=k=>{r(k?"Reposted!":"Removed repost")},t[61]=r,t[62]=j):j=t[62];let V;t[63]!==v||t[64]!==C||t[65]!==Q||t[66]!==K||t[67]!==j?(V={mutationFn:v,onMutate:C,onError:Q,onSettled:K,onSuccess:j},t[63]=v,t[64]=C,t[65]=Q,t[66]=K,t[67]=j,t[68]=V):V=t[68];const Z=he(V);let G;t[69]!==r||t[70]!==s||t[71]!==x||t[72]!==e?(G=async k=>{if(k&&k.stopPropagation(),!s)return r("Please login to like!","error");!ce(e)||!ce(s.id)||x.mutate()},t[69]=r,t[70]=s,t[71]=x,t[72]=e,t[73]=G):G=t[73];const I=G;let X;t[74]!==r||t[75]!==s||t[76]!==e||t[77]!==Z?(X=async k=>{if(k&&k.stopPropagation(),!s)return r("Please login to repost!","error");!ce(e)||!ce(s.id)||Z.mutate()},t[74]=r,t[75]=s,t[76]=e,t[77]=Z,t[78]=X):X=t[78];const O=X;let B;return t[79]!==I||t[80]!==O||t[81]!==_||t[82]!==P||t[83]!==o?(B={liked:_,reposted:P,localStats:o,setLocalStats:c,handleLike:I,handleRepost:O},t[79]=I,t[80]=O,t[81]=_,t[82]=P,t[83]=o,t[84]=B):B=t[84],B};var Jt=te();const Li=e=>{const i=(0,Jt.c)(5);let s;i[0]!==e?(s=()=>De(e),i[0]=e,i[1]=s):s=i[1];const[t,n]=(0,H.useState)(s);let r,a;return i[2]!==e?(r=()=>{if(!e)return;const o=setTimeout(()=>{n(De(e))},0),c=setInterval(()=>{n(De(e))},6e4);return()=>{clearTimeout(o),clearInterval(c)}},a=[e],i[2]=e,i[3]=r,i[4]=a):(r=i[3],a=i[4]),(0,H.useEffect)(r,a),t};var Gt=te();const Ni=()=>{const e=(0,Gt.c)(30),[i,s]=(0,H.useState)(!1),[t,n]=(0,H.useState)(!1),[r,a]=(0,H.useState)(0),[o,c]=(0,H.useState)(null),[l,f]=(0,H.useState)(null),u=(0,H.useRef)(null),h=(0,H.useRef)(null);let g;e[0]===Symbol.for("react.memo_cache_sentinel")?(g=[],e[0]=g):g=e[0];const m=(0,H.useRef)(g);let p,M;e[1]!==l?(p=()=>()=>{h.current&&clearInterval(h.current),u.current&&u.current.state!=="inactive"&&(u.current.stop(),u.current.stream.getTracks().forEach(Yt)),l&&URL.revokeObjectURL(l)},M=[l],e[1]=l,e[2]=p,e[3]=M):(p=e[2],M=e[3]),(0,H.useEffect)(p,M);let _;e[4]===Symbol.for("react.memo_cache_sentinel")?(_=()=>{h.current=window.setInterval(()=>{a(Xt)},1e3)},e[4]=_):_=e[4];const F=_;let w;e[5]===Symbol.for("react.memo_cache_sentinel")?(w=()=>{h.current&&(clearInterval(h.current),h.current=null)},e[5]=w):w=e[5];const D=w;let d;e[6]===Symbol.for("react.memo_cache_sentinel")?(d=async()=>{try{const K=await navigator.mediaDevices.getUserMedia({audio:!0}),j=new MediaRecorder(K);u.current=j,m.current=[],j.ondataavailable=V=>{V.data.size>0&&m.current.push(V.data)},j.onstop=()=>{const V=new Blob(m.current,{type:"audio/webm;codecs=opus"}),Z=URL.createObjectURL(V);c(V),f(Z),K.getTracks().forEach(Zt)},j.start(),s(!0),n(!1),a(0),F()}catch(K){const j=K;throw console.error("Error accessing microphone:",j),j}},e[6]=d):d=e[6];const A=d;let y;e[7]!==i?(y=()=>{u.current&&i&&(u.current.stop(),s(!1),n(!1),D())},e[7]=i,e[8]=y):y=e[8];const P=y;let b;e[9]!==t||e[10]!==i?(b=()=>{u.current&&i&&!t&&(u.current.pause(),n(!0),D())},e[9]=t,e[10]=i,e[11]=b):b=e[11];const L=b;let R;e[12]!==t||e[13]!==i?(R=()=>{u.current&&i&&t&&(u.current.resume(),n(!1),F())},e[12]=t,e[13]=i,e[14]=R):R=e[14];const N=R;let S;e[15]!==i?(S=()=>{u.current&&i&&(u.current.stop(),u.current.onstop=null,s(!1),n(!1),D(),a(0),u.current.stream&&u.current.stream.getTracks().forEach(It))},e[15]=i,e[16]=S):S=e[16];const x=S;let v;e[17]!==l?(v=()=>{l&&URL.revokeObjectURL(l),c(null),f(null),a(0)},e[17]=l,e[18]=v):v=e[18];const C=v;let Q;return e[19]!==o||e[20]!==l||e[21]!==x||e[22]!==C||e[23]!==t||e[24]!==i||e[25]!==L||e[26]!==r||e[27]!==N||e[28]!==P?(Q={isRecording:i,isPaused:t,recordingTime:r,startRecording:A,stopRecording:P,pauseRecording:L,resumeRecording:N,cancelRecording:x,audioBlob:o,audioUrl:l,clearAudio:C},e[19]=o,e[20]=l,e[21]=x,e[22]=C,e[23]=t,e[24]=i,e[25]=L,e[26]=r,e[27]=N,e[28]=P,e[29]=Q):Q=e[29],Q};function Yt(e){return e.stop()}function Xt(e){return e+1}function Zt(e){return e.stop()}function It(e){return e.stop()}var Ut=te();const Bi=(e,i,s)=>{const t=(0,Ut.c)(42),n=me(),{currentUser:r}=ue();let a,o;t[0]!==s||t[1]!==e?(a=["comments",e,s],o=R=>{const{pageParam:N}=R;return Ft(e,N,10,s)},t[0]=s,t[1]=e,t[2]=a,t[3]=o):(a=t[2],o=t[3]);let c;t[4]!==i?(c=i?{pages:[i],pageParams:[null]}:void 0,t[4]=i,t[5]=c):c=t[5];const l=!!e;let f;t[6]!==a||t[7]!==o||t[8]!==c||t[9]!==l?(f={queryKey:a,queryFn:o,initialPageParam:null,getNextPageParam:es,initialData:c,enabled:l},t[6]=a,t[7]=o,t[8]=c,t[9]=l,t[10]=f):f=t[10];const{data:u,fetchNextPage:h,hasNextPage:g,isFetchingNextPage:m,isLoading:p,refetch:M}=re(f);let _;t[11]!==u?.pages?(_=u?.pages.flatMap(ts)||[],t[11]=u?.pages,t[12]=_):_=t[12];const F=_;let w;t[13]!==r||t[14]!==e?(w=async R=>{const{userId:N,content:S,media:x,replyToId:v}=R;if(!r)throw new Error("User not authenticated");return gt(e,N,S,x,v)},t[13]=r,t[14]=e,t[15]=w):w=t[15];let D;t[16]!==r||t[17]!==s||t[18]!==e||t[19]!==n?(D=async R=>{if(!r)return;const N=["comments",e,s];await n.cancelQueries({queryKey:N});const S=n.getQueryData(N),x={id:`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,post_id:e,user_id:r.id,content:R.content,media:R.media||null,created_at:new Date().toISOString(),parent_id:R.replyToId||s||null,stats:{likes:0,comments:0,reposts:0},user:r,timeAgo:"Just now"};return n.setQueryData(N,v=>v?{...v,pages:[[x,...v.pages[0]],...v.pages.slice(1)]}:{pages:[[x]],pageParams:[null]}),{previousComments:S}},t[16]=r,t[17]=s,t[18]=e,t[19]=n,t[20]=D):D=t[20];let d,A;t[21]!==s||t[22]!==e||t[23]!==n?(d=(R,N,S)=>{const x=["comments",e,s];S?.previousComments&&n.setQueryData(x,S.previousComments)},A=()=>{const R=["comments",e,s];n.invalidateQueries({queryKey:R}),n.invalidateQueries({queryKey:["post",e]})},t[21]=s,t[22]=e,t[23]=n,t[24]=d,t[25]=A):(d=t[24],A=t[25]);let y;t[26]!==w||t[27]!==D||t[28]!==d||t[29]!==A?(y={mutationFn:w,onMutate:D,onError:d,onSettled:A},t[26]=w,t[27]=D,t[28]=d,t[29]=A,t[30]=y):y=t[30];const P=he(y);let b;t[31]!==F?(b=F||[],t[31]=F,t[32]=b):b=t[32];let L;return t[33]!==P.isPending||t[34]!==P.mutateAsync||t[35]!==h||t[36]!==g||t[37]!==m||t[38]!==p||t[39]!==M||t[40]!==b?(L={comments:b,fetchNextPage:h,hasNextPage:g,isFetchingNextPage:m,isLoading:p,refetch:M,addComment:P.mutateAsync,isSubmitting:P.isPending},t[33]=P.isPending,t[34]=P.mutateAsync,t[35]=h,t[36]=g,t[37]=m,t[38]=p,t[39]=M,t[40]=b,t[41]=L):L=t[41],L};function es(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function ts(e){return e}var ss=te();const ki=()=>{const e=(0,ss.c)(53),{handle:i}=Ae(),s=de(),{currentUser:t}=ue(),{addToast:n}=_e();let r,a;e[0]!==i?(r=["profile",i],a=()=>Rt(i),e[0]=i,e[1]=r,e[2]=a):(r=e[1],a=e[2]);const o=!!i;let c;e[3]!==r||e[4]!==a||e[5]!==o?(c={queryKey:r,queryFn:a,enabled:o,staleTime:3e5},e[3]=r,e[4]=a,e[5]=o,e[6]=c):c=e[6];const{data:l,isLoading:f}=ye(c),[u,h]=(0,H.useState)("feed"),g=l?.id;let m;e[7]!==g?(m=["posts","user",g],e[7]=g,e[8]=m):m=e[8];let p;e[9]!==l?(p=E=>{const{pageParam:J}=E;return Mt(l.id,J,20)},e[9]=l,e[10]=p):p=e[10];const M=!!l?.id;let _;e[11]!==m||e[12]!==p||e[13]!==M?(_={queryKey:m,queryFn:p,enabled:M,initialPageParam:null,getNextPageParam:is},e[11]=m,e[12]=p,e[13]=M,e[14]=_):_=e[14];const{data:F,fetchNextPage:w,hasNextPage:D,isFetchingNextPage:d,isLoading:A}=re(_);let y;e[15]!==F?.pages?(y=F?.pages.flatMap(ns)||[],e[15]=F?.pages,e[16]=y):y=e[16];const P=y,[b,L]=(0,H.useState)(!1),[R,N]=(0,H.useState)("Followers"),{followList:S,fetchNextPage:x,hasNextPage:v,isFetchingNextPage:C,isLoading:Q}=Lt(l?.id,R,b);let K;e[17]===Symbol.for("react.memo_cache_sentinel")?(K=E=>{N(E),L(!0)},e[17]=K):K=e[17];const j=K;let V;e:{if(u==="feed"){let E;e[18]!==P?(E=P.filter(rs),e[18]=P,e[19]=E):E=e[19],V=E;break e}if(u==="media"){let E;e[20]!==P?(E=P.filter(as),e[20]=P,e[21]=E):E=e[21],V=E;break e}if(u==="collections"){let E;e[22]===Symbol.for("react.memo_cache_sentinel")?(E=[],e[22]=E):E=e[22],V=E;break e}V=P}const Z=V;let G;e[23]!==s?(G=E=>{s(`/p/${E}`)},e[23]=s,e[24]=G):G=e[24];const I=G;let X;e[25]!==i||e[26]!==s?(X=E=>{E!==i&&s(`/u/${E}`)},e[25]=i,e[26]=s,e[27]=X):X=e[27];const O=X;let B;e[28]!==w?(B=()=>{w()},e[28]=w,e[29]=B):B=e[29];const k=B;let T;return e[30]!==u||e[31]!==n||e[32]!==t||e[33]!==x||e[34]!==Z||e[35]!==S||e[36]!==R||e[37]!==i||e[38]!==I||e[39]!==O||e[40]!==v||e[41]!==D||e[42]!==C||e[43]!==d||e[44]!==b||e[45]!==Q||e[46]!==k||e[47]!==A||e[48]!==f||e[49]!==s||e[50]!==l||e[51]!==P?(T={handle:i,profile:l,loading:f,userPosts:P,setUserPosts:os,activeProfileTab:u,setActiveProfileTab:h,loadingPosts:A,isFetchingMorePosts:d,hasMorePosts:D,filteredPosts:Z,isFollowModalOpen:b,setIsFollowModalOpen:L,followModalType:R,followListData:S,isListLoading:Q,isFetchingMoreFollows:C,hasMoreFollows:v,openFollowModal:j,fetchNextFollows:x,handlePostClick:I,handleUserClick:O,loadUserPosts:k,currentUser:t,addToast:n,navigate:s},e[30]=u,e[31]=n,e[32]=t,e[33]=x,e[34]=Z,e[35]=S,e[36]=R,e[37]=i,e[38]=I,e[39]=O,e[40]=v,e[41]=D,e[42]=C,e[43]=d,e[44]=b,e[45]=Q,e[46]=k,e[47]=A,e[48]=f,e[49]=s,e[50]=l,e[51]=P,e[52]=T):T=e[52],T};function is(e){if(!(!e||e.length<20))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function ns(e){return e}function rs(e){return e.community_id===null&&e.parent_id===null}function as(e){return e.community_id===null&&e.parent_id===null&&(e.type==="video"||e.type==="image"||e.media&&e.media.length>0)}function os(){return console.warn("setUserPosts is deprecated")}var cs=te();const Ti=()=>{const e=(0,cs.c)(75),{handle:i}=Ae(),s=de(),{currentUser:t}=ue(),{addToast:n}=_e(),r=me();let a,o;e[0]!==i?(a=["community",i],o=()=>vt(i),e[0]=i,e[1]=a,e[2]=o):(a=e[1],o=e[2]);const c=!!i;let l;e[3]!==a||e[4]!==o||e[5]!==c?(l={queryKey:a,queryFn:o,enabled:c,staleTime:6e5},e[3]=a,e[4]=o,e[5]=c,e[6]=l):l=e[6];const{data:f,isLoading:u,refetch:h}=ye(l),g=f?.id,m=t?.id;let p;e[7]!==g||e[8]!==m?(p=["community",g,"membership",m],e[7]=g,e[8]=m,e[9]=p):p=e[9];let M;e[10]!==f||e[11]!==t?(M=()=>Ie(f.id,t.id),e[10]=f,e[11]=t,e[12]=M):M=e[12];const _=!!f?.id&&!!t?.id;let F;e[13]!==p||e[14]!==M||e[15]!==_?(F={queryKey:p,queryFn:M,enabled:_,staleTime:3e5},e[13]=p,e[14]=M,e[15]=_,e[16]=F):F=e[16];const{data:w}=ye(F),D=!!w,d=w?.role||null,A=f?.id;let y;e[17]!==A?(y=["posts","community",A],e[17]=A,e[18]=y):y=e[18];let P;e[19]!==f?(P=T=>{const{pageParam:E}=T;return Et(f.id,E,10)},e[19]=f,e[20]=P):P=e[20];const b=!!f?.id;let L;e[21]!==y||e[22]!==P||e[23]!==b?(L={queryKey:y,queryFn:P,enabled:b,initialPageParam:null,getNextPageParam:ls},e[21]=y,e[22]=P,e[23]=b,e[24]=L):L=e[24];const{data:R,fetchNextPage:N,hasNextPage:S,isFetchingNextPage:x,isLoading:v}=re(L);let C;e[25]!==R?.pages?(C=R?.pages.flatMap(us)||[],e[25]=R?.pages,e[26]=C):C=e[26];const Q=C;let K;e[27]!==f||e[28]!==t?(K=()=>wt(f.id,t.id),e[27]=f,e[28]=t,e[29]=K):K=e[29];let j;e[30]!==f||e[31]!==t||e[32]!==i||e[33]!==r?(j=async()=>{const T=f.id,E=t.id;await r.cancelQueries({queryKey:["community",T,"membership",E]}),await r.cancelQueries({queryKey:["community",i]});const J=r.getQueryData(["community",T,"membership",E]),ee=r.getQueryData(["community",i]);return r.setQueryData(["community",T,"membership",E],J?null:{role:"member"}),r.setQueryData(["community",i],$=>$&&{...$,membersCount:J?$.membersCount-1:$.membersCount+1}),{previousMembership:J,previousCommunity:ee}},e[30]=f,e[31]=t,e[32]=i,e[33]=r,e[34]=j):j=e[34];let V;e[35]!==n||e[36]!==f||e[37]!==t||e[38]!==i||e[39]!==r?(V=(T,E,J)=>{J?.previousMembership!==void 0&&r.setQueryData(["community",f.id,"membership",t.id],J.previousMembership),J?.previousCommunity&&r.setQueryData(["community",i],J.previousCommunity),n("Failed to update membership","error")},e[35]=n,e[36]=f,e[37]=t,e[38]=i,e[39]=r,e[40]=V):V=e[40];let Z;e[41]!==f?.id||e[42]!==t?.id||e[43]!==i||e[44]!==r?(Z=()=>{r.invalidateQueries({queryKey:["community",f?.id,"membership",t?.id]}),r.invalidateQueries({queryKey:["community",i]})},e[41]=f?.id,e[42]=t?.id,e[43]=i,e[44]=r,e[45]=Z):Z=e[45];let G;e[46]!==n||e[47]!==f?(G=T=>{f&&n(T?`Joined ${f.name}`:`Left ${f.name}`)},e[46]=n,e[47]=f,e[48]=G):G=e[48];let I;e[49]!==K||e[50]!==j||e[51]!==V||e[52]!==Z||e[53]!==G?(I={mutationFn:K,onMutate:j,onError:V,onSettled:Z,onSuccess:G},e[49]=K,e[50]=j,e[51]=V,e[52]=Z,e[53]=G,e[54]=I):I=e[54];const X=he(I);let O;e[55]!==n||e[56]!==t||e[57]!==X?(O=async()=>{if(!t)return n("Please login to join communities","error");X.mutate()},e[55]=n,e[56]=t,e[57]=X,e[58]=O):O=e[58];const B=O;let k;return e[59]!==n||e[60]!==f||e[61]!==Q||e[62]!==t||e[63]!==N||e[64]!==B||e[65]!==S||e[66]!==x||e[67]!==D||e[68]!==X.isPending||e[69]!==u||e[70]!==v||e[71]!==s||e[72]!==h||e[73]!==d?(k={community:f,loading:u,isMember:D,userRole:d,isJoining:X.isPending,communityPosts:Q,loadingPosts:v,isFetchingMorePosts:x,hasMorePosts:S,handleJoinToggle:B,loadCommunityPosts:N,refetchCommunity:h,currentUser:t,addToast:n,navigate:s},e[59]=n,e[60]=f,e[61]=Q,e[62]=t,e[63]=N,e[64]=B,e[65]=S,e[66]=x,e[67]=D,e[68]=X.isPending,e[69]=u,e[70]=v,e[71]=s,e[72]=h,e[73]=d,e[74]=k):k=e[74],k};function ls(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function us(e){return e}function le(e){return Array.isArray?Array.isArray(e):ze(e)==="[object Array]"}var fs=1/0;function hs(e){if(typeof e=="string")return e;let i=e+"";return i=="0"&&1/e==-fs?"-0":i}function ds(e){return e==null?"":hs(e)}function oe(e){return typeof e=="string"}function Oe(e){return typeof e=="number"}function ms(e){return e===!0||e===!1||gs(e)&&ze(e)=="[object Boolean]"}function je(e){return typeof e=="object"}function gs(e){return je(e)&&e!==null}function ie(e){return e!=null}function be(e){return!e.trim().length}function ze(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}var ps="Incorrect 'index' type",ys=e=>`Invalid value for key ${e}`,_s=e=>`Pattern length exceeds max of ${e}.`,Ms=e=>`Missing ${e} property in key`,As=e=>`Property 'weight' in key '${e}' must be a positive integer`,Be=Object.prototype.hasOwnProperty,Ps=class{constructor(e){this._keys=[],this._keyMap={};let i=0;e.forEach(s=>{let t=We(s);this._keys.push(t),this._keyMap[t.id]=t,i+=t.weight}),this._keys.forEach(s=>{s.weight/=i})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}};function We(e){let i=null,s=null,t=null,n=1,r=null;if(oe(e)||le(e))t=e,i=ke(e),s=xe(e);else{if(!Be.call(e,"name"))throw new Error(Ms("name"));const a=e.name;if(t=a,Be.call(e,"weight")&&(n=e.weight,n<=0))throw new Error(As(a));i=ke(a),s=xe(a),r=e.getFn}return{path:i,id:s,weight:n,src:t,getFn:r}}function ke(e){return le(e)?e:e.split(".")}function xe(e){return le(e)?e.join("."):e}function ws(e,i){let s=[],t=!1;const n=(r,a,o)=>{if(ie(r))if(!a[o])s.push(r);else{const c=r[a[o]];if(!ie(c))return;if(o===a.length-1&&(oe(c)||Oe(c)||ms(c)))s.push(ds(c));else if(le(c)){t=!0;for(let l=0,f=c.length;l<f;l+=1)n(c[l],a,o+1)}else a.length&&n(c,a,o+1)}};return n(e,oe(i)?i.split("."):i,0),t?s:s[0]}var Fs={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},Es={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,i)=>e.score===i.score?e.idx<i.idx?-1:1:e.score<i.score?-1:1},Ds={location:0,threshold:.6,distance:100},bs={useExtendedSearch:!1,getFn:ws,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1},q={...Es,...Fs,...Ds,...bs},Ss=/[^ ]+/g;function xs(e=1,i=3){const s=new Map,t=Math.pow(10,i);return{get(n){const r=n.match(Ss).length;if(s.has(r))return s.get(r);const a=1/Math.pow(r,.5*e),o=parseFloat(Math.round(a*t)/t);return s.set(r,o),o},clear(){s.clear()}}}var Ne=class{constructor({getFn:e=q.getFn,fieldNormWeight:i=q.fieldNormWeight}={}){this.norm=xs(i,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((i,s)=>{this._keysMap[i.id]=s})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,oe(this.docs[0])?this.docs.forEach((e,i)=>{this._addString(e,i)}):this.docs.forEach((e,i)=>{this._addObject(e,i)}),this.norm.clear())}add(e){const i=this.size();oe(e)?this._addString(e,i):this._addObject(e,i)}removeAt(e){this.records.splice(e,1);for(let i=e,s=this.size();i<s;i+=1)this.records[i].i-=1}getValueForItemAtKeyId(e,i){return e[this._keysMap[i]]}size(){return this.records.length}_addString(e,i){if(!ie(e)||be(e))return;let s={v:e,i,n:this.norm.get(e)};this.records.push(s)}_addObject(e,i){let s={i,$:{}};this.keys.forEach((t,n)=>{let r=t.getFn?t.getFn(e):this.getFn(e,t.path);if(ie(r)){if(le(r)){let a=[];const o=[{nestedArrIndex:-1,value:r}];for(;o.length;){const{nestedArrIndex:c,value:l}=o.pop();if(ie(l))if(oe(l)&&!be(l)){let f={v:l,i:c,n:this.norm.get(l)};a.push(f)}else le(l)&&l.forEach((f,u)=>{o.push({nestedArrIndex:u,value:f})})}s.$[n]=a}else if(oe(r)&&!be(r)){let a={v:r,n:this.norm.get(r)};s.$[n]=a}}}),this.records.push(s)}toJSON(){return{keys:this.keys,records:this.records}}};function Ve(e,i,{getFn:s=q.getFn,fieldNormWeight:t=q.fieldNormWeight}={}){const n=new Ne({getFn:s,fieldNormWeight:t});return n.setKeys(e.map(We)),n.setSources(i),n.create(),n}function vs(e,{getFn:i=q.getFn,fieldNormWeight:s=q.fieldNormWeight}={}){const{keys:t,records:n}=e,r=new Ne({getFn:i,fieldNormWeight:s});return r.setKeys(t),r.setIndexRecords(n),r}function Pe(e,{errors:i=0,currentLocation:s=0,expectedLocation:t=0,distance:n=q.distance,ignoreLocation:r=q.ignoreLocation}={}){const a=i/e.length;if(r)return a;const o=Math.abs(t-s);return n?a+o/n:o?1:a}function Cs(e=[],i=q.minMatchCharLength){let s=[],t=-1,n=-1,r=0;for(let a=e.length;r<a;r+=1){let o=e[r];o&&t===-1?t=r:!o&&t!==-1&&(n=r-1,n-t+1>=i&&s.push([t,n]),t=-1)}return e[r-1]&&r-t>=i&&s.push([t,r-1]),s}var pe=32;function Rs(e,i,s,{location:t=q.location,distance:n=q.distance,threshold:r=q.threshold,findAllMatches:a=q.findAllMatches,minMatchCharLength:o=q.minMatchCharLength,includeMatches:c=q.includeMatches,ignoreLocation:l=q.ignoreLocation}={}){if(i.length>pe)throw new Error(_s(pe));const f=i.length,u=e.length,h=Math.max(0,Math.min(t,u));let g=r,m=h;const p=o>1||c,M=p?Array(u):[];let _;for(;(_=e.indexOf(i,m))>-1;){let y=Pe(i,{currentLocation:_,expectedLocation:h,distance:n,ignoreLocation:l});if(g=Math.min(y,g),m=_+f,p){let P=0;for(;P<f;)M[_+P]=1,P+=1}}m=-1;let F=[],w=1,D=f+u;const d=1<<f-1;for(let y=0;y<f;y+=1){let P=0,b=D;for(;P<b;)Pe(i,{errors:y,currentLocation:h+b,expectedLocation:h,distance:n,ignoreLocation:l})<=g?P=b:D=b,b=Math.floor((D-P)/2+P);D=b;let L=Math.max(1,h-b+1),R=a?u:Math.min(h+b,u)+f,N=Array(R+2);N[R+1]=(1<<y)-1;for(let S=R;S>=L;S-=1){let x=S-1,v=s[e.charAt(x)];if(p&&(M[x]=+!!v),N[S]=(N[S+1]<<1|1)&v,y&&(N[S]|=(F[S+1]|F[S])<<1|1|F[S+1]),N[S]&d&&(w=Pe(i,{errors:y,currentLocation:x,expectedLocation:h,distance:n,ignoreLocation:l}),w<=g)){if(g=w,m=x,m<=h)break;L=Math.max(1,2*h-m)}}if(Pe(i,{errors:y+1,currentLocation:h,expectedLocation:h,distance:n,ignoreLocation:l})>g)break;F=N}const A={isMatch:m>=0,score:Math.max(.001,w)};if(p){const y=Cs(M,o);y.length?c&&(A.indices=y):A.isMatch=!1}return A}function $s(e){let i={};for(let s=0,t=e.length;s<t;s+=1){const n=e.charAt(s);i[n]=(i[n]||0)|1<<t-s-1}return i}var we=String.prototype.normalize?(e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,"")):(e=>e),He=class{constructor(e,{location:i=q.location,threshold:s=q.threshold,distance:t=q.distance,includeMatches:n=q.includeMatches,findAllMatches:r=q.findAllMatches,minMatchCharLength:a=q.minMatchCharLength,isCaseSensitive:o=q.isCaseSensitive,ignoreDiacritics:c=q.ignoreDiacritics,ignoreLocation:l=q.ignoreLocation}={}){if(this.options={location:i,threshold:s,distance:t,includeMatches:n,findAllMatches:r,minMatchCharLength:a,isCaseSensitive:o,ignoreDiacritics:c,ignoreLocation:l},e=o?e:e.toLowerCase(),e=c?we(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const f=(h,g)=>{this.chunks.push({pattern:h,alphabet:$s(h),startIndex:g})},u=this.pattern.length;if(u>pe){let h=0;const g=u%pe,m=u-g;for(;h<m;)f(this.pattern.substr(h,pe),h),h+=pe;if(g){const p=u-pe;f(this.pattern.substr(p),p)}}else f(this.pattern,0)}searchIn(e){const{isCaseSensitive:i,ignoreDiacritics:s,includeMatches:t}=this.options;if(e=i?e:e.toLowerCase(),e=s?we(e):e,this.pattern===e){let m={isMatch:!0,score:0};return t&&(m.indices=[[0,e.length-1]]),m}const{location:n,distance:r,threshold:a,findAllMatches:o,minMatchCharLength:c,ignoreLocation:l}=this.options;let f=[],u=0,h=!1;this.chunks.forEach(({pattern:m,alphabet:p,startIndex:M})=>{const{isMatch:_,score:F,indices:w}=Rs(e,m,p,{location:n+M,distance:r,threshold:a,findAllMatches:o,minMatchCharLength:c,includeMatches:t,ignoreLocation:l});_&&(h=!0),u+=F,_&&w&&(f=[...f,...w])});let g={isMatch:h,score:h?u/this.chunks.length:1};return h&&t&&(g.indices=f),g}},ge=class{constructor(e){this.pattern=e}static isMultiMatch(e){return Te(e,this.multiRegex)}static isSingleMatch(e){return Te(e,this.singleRegex)}search(){}};function Te(e,i){const s=e.match(i);return s?s[1]:null}var Ls=class extends ge{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const i=e===this.pattern;return{isMatch:i,score:i?0:1,indices:[0,this.pattern.length-1]}}},Ns=class extends ge{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const i=e.indexOf(this.pattern)===-1;return{isMatch:i,score:i?0:1,indices:[0,e.length-1]}}},Bs=class extends ge{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const i=e.startsWith(this.pattern);return{isMatch:i,score:i?0:1,indices:[0,this.pattern.length-1]}}},ks=class extends ge{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const i=!e.startsWith(this.pattern);return{isMatch:i,score:i?0:1,indices:[0,e.length-1]}}},Ts=class extends ge{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const i=e.endsWith(this.pattern);return{isMatch:i,score:i?0:1,indices:[e.length-this.pattern.length,e.length-1]}}},qs=class extends ge{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const i=!e.endsWith(this.pattern);return{isMatch:i,score:i?0:1,indices:[0,e.length-1]}}},Je=class extends ge{constructor(e,{location:i=q.location,threshold:s=q.threshold,distance:t=q.distance,includeMatches:n=q.includeMatches,findAllMatches:r=q.findAllMatches,minMatchCharLength:a=q.minMatchCharLength,isCaseSensitive:o=q.isCaseSensitive,ignoreDiacritics:c=q.ignoreDiacritics,ignoreLocation:l=q.ignoreLocation}={}){super(e),this._bitapSearch=new He(e,{location:i,threshold:s,distance:t,includeMatches:n,findAllMatches:r,minMatchCharLength:a,isCaseSensitive:o,ignoreDiacritics:c,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}},Ge=class extends ge{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let i=0,s;const t=[],n=this.pattern.length;for(;(s=e.indexOf(this.pattern,i))>-1;)i=s+n,t.push([s,i-1]);const r=!!t.length;return{isMatch:r,score:r?0:1,indices:t}}},ve=[Ls,Ge,Bs,ks,qs,Ts,Ns,Je],qe=ve.length,Qs=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Ks="|";function Os(e,i={}){return e.split(Ks).map(s=>{let t=s.trim().split(Qs).filter(r=>r&&!!r.trim()),n=[];for(let r=0,a=t.length;r<a;r+=1){const o=t[r];let c=!1,l=-1;for(;!c&&++l<qe;){const f=ve[l];let u=f.isMultiMatch(o);u&&(n.push(new f(u,i)),c=!0)}if(!c)for(l=-1;++l<qe;){const f=ve[l];let u=f.isSingleMatch(o);if(u){n.push(new f(u,i));break}}}return n})}var js=new Set([Je.type,Ge.type]),zs=class{constructor(e,{isCaseSensitive:i=q.isCaseSensitive,ignoreDiacritics:s=q.ignoreDiacritics,includeMatches:t=q.includeMatches,minMatchCharLength:n=q.minMatchCharLength,ignoreLocation:r=q.ignoreLocation,findAllMatches:a=q.findAllMatches,location:o=q.location,threshold:c=q.threshold,distance:l=q.distance}={}){this.query=null,this.options={isCaseSensitive:i,ignoreDiacritics:s,includeMatches:t,minMatchCharLength:n,findAllMatches:a,ignoreLocation:r,location:o,threshold:c,distance:l},e=i?e:e.toLowerCase(),e=s?we(e):e,this.pattern=e,this.query=Os(this.pattern,this.options)}static condition(e,i){return i.useExtendedSearch}searchIn(e){const i=this.query;if(!i)return{isMatch:!1,score:1};const{includeMatches:s,isCaseSensitive:t,ignoreDiacritics:n}=this.options;e=t?e:e.toLowerCase(),e=n?we(e):e;let r=0,a=[],o=0;for(let c=0,l=i.length;c<l;c+=1){const f=i[c];a.length=0,r=0;for(let u=0,h=f.length;u<h;u+=1){const g=f[u],{isMatch:m,indices:p,score:M}=g.search(e);if(m){if(r+=1,o+=M,s){const _=g.constructor.type;js.has(_)?a=[...a,...p]:a.push(p)}}else{o=0,r=0,a.length=0;break}}if(r){let u={isMatch:!0,score:o/r};return s&&(u.indices=a),u}}return{isMatch:!1,score:1}}},Ce=[];function Ws(...e){Ce.push(...e)}function Re(e,i){for(let s=0,t=Ce.length;s<t;s+=1){let n=Ce[s];if(n.condition(e,i))return new n(e,i)}return new He(e,i)}var Fe={AND:"$and",OR:"$or"},$e={PATH:"$path",PATTERN:"$val"},Le=e=>!!(e[Fe.AND]||e[Fe.OR]),Vs=e=>!!e[$e.PATH],Hs=e=>!le(e)&&je(e)&&!Le(e),Qe=e=>({[Fe.AND]:Object.keys(e).map(i=>({[i]:e[i]}))});function Ye(e,i,{auto:s=!0}={}){const t=n=>{let r=Object.keys(n);const a=Vs(n);if(!a&&r.length>1&&!Le(n))return t(Qe(n));if(Hs(n)){const c=a?n[$e.PATH]:r[0],l=a?n[$e.PATTERN]:n[c];if(!oe(l))throw new Error(ys(c));const f={keyId:xe(c),pattern:l};return s&&(f.searcher=Re(l,i)),f}let o={children:[],operator:r[0]};return r.forEach(c=>{const l=n[c];le(l)&&l.forEach(f=>{o.children.push(t(f))})}),o};return Le(e)||(e=Qe(e)),t(e)}function Js(e,{ignoreFieldNorm:i=q.ignoreFieldNorm}){e.forEach(s=>{let t=1;s.matches.forEach(({key:n,norm:r,score:a})=>{const o=n?n.weight:null;t*=Math.pow(a===0&&o?Number.EPSILON:a,(o||1)*(i?1:r))}),s.score=t})}function Gs(e,i){const s=e.matches;i.matches=[],ie(s)&&s.forEach(t=>{if(!ie(t.indices)||!t.indices.length)return;const{indices:n,value:r}=t;let a={indices:n,value:r};t.key&&(a.key=t.key.src),t.idx>-1&&(a.refIndex=t.idx),i.matches.push(a)})}function Ys(e,i){i.score=e.score}function Xs(e,i,{includeMatches:s=q.includeMatches,includeScore:t=q.includeScore}={}){const n=[];return s&&n.push(Gs),t&&n.push(Ys),e.map(r=>{const{idx:a}=r,o={item:i[a],refIndex:a};return n.length&&n.forEach(c=>{c(r,o)}),o})}var Me=class{constructor(e,i={},s){this.options={...q,...i},this.options.useExtendedSearch,this._keyStore=new Ps(this.options.keys),this.setCollection(e,s)}setCollection(e,i){if(this._docs=e,i&&!(i instanceof Ne))throw new Error(ps);this._myIndex=i||Ve(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){ie(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const i=[];for(let s=0,t=this._docs.length;s<t;s+=1){const n=this._docs[s];e(n,s)&&(this.removeAt(s),s-=1,t-=1,i.push(n))}return i}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:i=-1}={}){const{includeMatches:s,includeScore:t,shouldSort:n,sortFn:r,ignoreFieldNorm:a}=this.options;let o=oe(e)?oe(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Js(o,{ignoreFieldNorm:a}),n&&o.sort(r),Oe(i)&&i>-1&&(o=o.slice(0,i)),Xs(o,this._docs,{includeMatches:s,includeScore:t})}_searchStringList(e){const i=Re(e,this.options),{records:s}=this._myIndex,t=[];return s.forEach(({v:n,i:r,n:a})=>{if(!ie(n))return;const{isMatch:o,score:c,indices:l}=i.searchIn(n);o&&t.push({item:n,idx:r,matches:[{score:c,value:n,norm:a,indices:l}]})}),t}_searchLogical(e){const i=Ye(e,this.options),s=(a,o,c)=>{if(!a.children){const{keyId:f,searcher:u}=a,h=this._findMatches({key:this._keyStore.get(f),value:this._myIndex.getValueForItemAtKeyId(o,f),searcher:u});return h&&h.length?[{idx:c,item:o,matches:h}]:[]}const l=[];for(let f=0,u=a.children.length;f<u;f+=1){const h=a.children[f],g=s(h,o,c);if(g.length)l.push(...g);else if(a.operator===Fe.AND)return[]}return l},t=this._myIndex.records,n={},r=[];return t.forEach(({$:a,i:o})=>{if(ie(a)){let c=s(i,a,o);c.length&&(n[o]||(n[o]={idx:o,item:a,matches:[]},r.push(n[o])),c.forEach(({matches:l})=>{n[o].matches.push(...l)}))}}),r}_searchObjectList(e){const i=Re(e,this.options),{keys:s,records:t}=this._myIndex,n=[];return t.forEach(({$:r,i:a})=>{if(!ie(r))return;let o=[];s.forEach((c,l)=>{o.push(...this._findMatches({key:c,value:r[l],searcher:i}))}),o.length&&n.push({idx:a,item:r,matches:o})}),n}_findMatches({key:e,value:i,searcher:s}){if(!ie(i))return[];let t=[];if(le(i))i.forEach(({v:n,i:r,n:a})=>{if(!ie(n))return;const{isMatch:o,score:c,indices:l}=s.searchIn(n);o&&t.push({score:c,key:e,value:n,idx:r,norm:a,indices:l})});else{const{v:n,n:r}=i,{isMatch:a,score:o,indices:c}=s.searchIn(n);a&&t.push({score:o,key:e,value:n,norm:r,indices:c})}return t}};Me.version="7.1.0";Me.createIndex=Ve;Me.parseIndex=vs;Me.config=q;Me.parseQuery=Ye;Ws(zs);var Zs=te();const qi=()=>{const e=(0,Zs.c)(60),{currentUser:i}=ue(),s=de(),[t,n]=Ke();let r;e[0]!==t?(r=t.get("q")||"",e[0]=t,e[1]=r):r=e[1];const a=r;let o;e[2]!==t||e[3]!==a?(o=t.get("tab")||(a?"posts":"communities"),e[2]=t,e[3]=a,e[4]=o):o=e[4];const c=o,[l,f]=(0,H.useState)(!1);let u,h;e[5]!==a?(u=["explore","users",a],h=()=>a?Se(a):Se(""),e[5]=a,e[6]=u,e[7]=h):(u=e[6],h=e[7]);const g=c==="users";let m;e[8]!==u||e[9]!==h||e[10]!==g?(m={queryKey:u,queryFn:h,enabled:g,initialPageParam:null,getNextPageParam:Is},e[8]=u,e[9]=h,e[10]=g,e[11]=m):m=e[11];const{data:p,fetchNextPage:M,hasNextPage:_,isFetchingNextPage:F,isLoading:w}=re(m);let D;e[12]!==p?.pages?(D=p?.pages.flatMap(Us)||[],e[12]=p?.pages,e[13]=D):D=e[13];const d=D;let A;e[14]===Symbol.for("react.memo_cache_sentinel")?(A=["explore","communities"],e[14]=A):A=e[14];let y;e[15]===Symbol.for("react.memo_cache_sentinel")?(y={queryKey:A,queryFn:ei,initialPageParam:null,getNextPageParam:ti},e[15]=y):y=e[15];const{data:P,fetchNextPage:b,hasNextPage:L,isFetchingNextPage:R,isLoading:N}=re(y);let S;e[16]!==P?.pages?(S=P?.pages.flatMap(si)||[],e[16]=P?.pages,e[17]=S):S=e[17];const x=S;let v,C;e[18]!==a?(v=["explore","posts",a],C=z=>{const{pageParam:U}=z;return a?Pt(a,U,20,!1):Ct(U,20)},e[18]=a,e[19]=v,e[20]=C):(v=e[19],C=e[20]);let Q;e[21]!==v||e[22]!==C?(Q={queryKey:v,queryFn:C,initialPageParam:null,getNextPageParam:ii},e[21]=v,e[22]=C,e[23]=Q):Q=e[23];const{data:K,fetchNextPage:j,hasNextPage:V,isFetchingNextPage:Z,isLoading:G}=re(Q);let I;e[24]!==K?.pages?(I=K?.pages.flatMap(ni)||[],e[24]=K?.pages,e[25]=I):I=e[25];const X=I;let O;e:{if(!a.trim()){O=x;break e}let z;e[26]!==x||e[27]!==a?(z=new Me(x,{keys:["name","handle","description"],threshold:.3,ignoreLocation:!0}).search(a).map(ri),e[26]=x,e[27]=a,e[28]=z):z=e[28],O=z}const B=O;let k;e[29]!==s?(k=z=>{s(`/c/${z}`)},e[29]=s,e[30]=k):k=e[30];const T=k;let E;e[31]!==n?(E=z=>{n(U=>(z?U.set("q",z):U.delete("q"),U),{replace:!0})},e[31]=n,e[32]=E):E=e[32];const J=E;let ee;e[33]!==n?(ee=z=>{n(U=>(U.set("tab",z),U),{replace:!0})},e[33]=n,e[34]=ee):ee=e[34];const $=ee;let Y;return e[35]!==c||e[36]!==x||e[37]!==i||e[38]!==b||e[39]!==j||e[40]!==M||e[41]!==B||e[42]!==T||e[43]!==J||e[44]!==$||e[45]!==L||e[46]!==V||e[47]!==_||e[48]!==N||e[49]!==l||e[50]!==R||e[51]!==Z||e[52]!==F||e[53]!==G||e[54]!==w||e[55]!==s||e[56]!==X||e[57]!==a||e[58]!==d?(Y={currentUser:i,searchQuery:a,setSearchQuery:J,activeTab:c,setActiveTab:$,isCreateModalOpen:l,setIsCreateModalOpen:f,communitiesData:x,isCommunitiesLoading:N,isFetchingMoreCommunities:R,hasMoreCommunities:L,postsData:X,isPostsLoading:G,isFetchingMorePosts:Z,hasMorePosts:V,filteredCommunities:B,usersData:d,isUsersLoading:w,hasMoreUsers:_,isFetchingMoreUsers:F,handleCommunityClick:T,loadCommunities:b,loadPosts:j,loadUsers:M,navigate:s},e[35]=c,e[36]=x,e[37]=i,e[38]=b,e[39]=j,e[40]=M,e[41]=B,e[42]=T,e[43]=J,e[44]=$,e[45]=L,e[46]=V,e[47]=_,e[48]=N,e[49]=l,e[50]=R,e[51]=Z,e[52]=F,e[53]=G,e[54]=w,e[55]=s,e[56]=X,e[57]=a,e[58]=d,e[59]=Y):Y=e[59],Y};function Is(){}function Us(e){return e}function ei(e){const{pageParam:i}=e;return _t(i,10)}function ti(e){if(!(!e||e.length<10))return e[e.length-1].createdAt}function si(e){return e}function ii(e){if(!(!e||e.length<20))return e[e.length-1].sort_timestamp}function ni(e){return e}function ri(e){return e.item}var ai=te();const Qi=()=>{const e=(0,ai.c)(21),{currentUser:i}=ue(),{posts:s,loading:t,hasMore:n,isFetchingNextPage:r,fetchNextPage:a,refreshPosts:o}=rt(),{addToast:c}=_e(),l=de();let f;e[0]===Symbol.for("react.memo_cache_sentinel")?(f=["stories"],e[0]=f):f=e[0];let u;e[1]===Symbol.for("react.memo_cache_sentinel")?(u={queryKey:f,queryFn:oi,initialPageParam:null,getNextPageParam:ci,refetchInterval:6e4},e[1]=u):u=e[1];const{data:h,isLoading:g}=re(u);let m;if(e[2]!==h?.pages){const d=h?.pages.flatMap(li)||[],A=JSON.parse(localStorage.getItem("seenStories")||"[]");m=d.reduce(ui,[]).map(y=>({...y,isSeen:A.includes(y.user.id)})),e[2]=h?.pages,e[3]=m}else m=e[3];const p=m;let M;e[4]!==l?(M=d=>{l(`/p/${d}`)},e[4]=l,e[5]=M):M=e[5];const _=M;let F;e[6]!==l?(F=d=>{l(`/u/${d}`)},e[6]=l,e[7]=F):F=e[7];const w=F;let D;return e[8]!==c||e[9]!==i||e[10]!==a||e[11]!==p||e[12]!==_||e[13]!==w||e[14]!==n||e[15]!==s||e[16]!==r||e[17]!==t||e[18]!==g||e[19]!==o?(D={currentUser:i,homePosts:s,groupedStories:p,isPostsLoading:t,isStoriesLoading:g,hasMore:n,isFetchingNextPage:r,fetchNextPage:a,refreshPosts:o,addToast:c,handlePostClick:_,handleUserClick:w},e[8]=c,e[9]=i,e[10]=a,e[11]=p,e[12]=_,e[13]=w,e[14]=n,e[15]=s,e[16]=r,e[17]=t,e[18]=g,e[19]=o,e[20]=D):D=e[20],D};function oi(e){const{pageParam:i}=e;return lt(i,10)}function ci(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function li(e){return e}function ui(e,i){const s=e.find(t=>t.user.id===i.user_id);return s?s.stories.push(i):e.push({user:i.user,stories:[i],isSeen:!1}),e}var fi=te();const Ki=()=>{const e=(0,fi.c)(60),{id:i}=Ae(),s=de(),{currentUser:t}=ue(),{onlineUsers:n}=it(),r=me(),[a,o]=(0,H.useState)("");let c;e[0]===Symbol.for("react.memo_cache_sentinel")?(c=[],e[0]=c):c=e[0];const[l,f]=(0,H.useState)(c),{conversations:u,isConvLoading:h,refetchConversations:g,refetchMessages:m,sendMessage:p,editMessage:M,sendTypingStatus:_,typingStatus:F,markAsRead:w,formatMessages:D,onDeleteMessage:d,onToggleReaction:A,conversationReactions:y,messages:P,isMsgLoading:b,fetchNextMessages:L,hasMoreMessages:R,isFetchingMoreMessages:N}=Vt(t,i);let S;e:{if(!i||u.length===0){S=null;break e}let $;e[1]!==u||e[2]!==i?($=u.find(Y=>Y.id===i)||null,e[1]=u,e[2]=i,e[3]=$):$=e[3],S=$}const x=S;let v,C;e[4]!==i||e[5]!==w?(v=()=>{i&&w(i)},C=[i,w],e[4]=i,e[5]=w,e[6]=v,e[7]=C):(v=e[6],C=e[7]),(0,H.useEffect)(v,C);let Q;e[8]!==u||e[9]!==t?.id||e[10]!==a?(Q=()=>{const $=setTimeout(async()=>{if(a.length>1){const Y=await Se(a),z=u.map(hi);f(Y.filter(U=>U.id!==t?.id&&!z.includes(U.id)))}else f([])},300);return()=>clearTimeout($)},e[8]=u,e[9]=t?.id,e[10]=a,e[11]=Q):Q=e[11];const K=t?.id;let j;e[12]!==u||e[13]!==a||e[14]!==K?(j=[a,u,K],e[12]=u,e[13]=a,e[14]=K,e[15]=j):j=e[15],(0,H.useEffect)(Q,j);let V;e[16]!==t||e[17]!==s||e[18]!==r?(V=async $=>{if(t)try{const Y=await ht(t.id,$.id);r.invalidateQueries({queryKey:["conversations",t.id]}),o(""),s(`/m/${Y}`)}catch(Y){console.error("Failed to start conversation:",Y)}},e[16]=t,e[17]=s,e[18]=r,e[19]=V):V=e[19];const Z=V;let G;e[20]!==s?(G=$=>{s(`/m/${$.id}`)},e[20]=s,e[21]=G):G=e[21];const I=G;let X;e[22]!==y||e[23]!==D||e[24]!==P?(X=D(P,y),e[22]=y,e[23]=D,e[24]=P,e[25]=X):X=e[25];const O=X;let B;e:{if(!a.trim()){B=u;break e}let $;e[26]!==u||e[27]!==a?($=new Me(u,{keys:["user.name","user.handle","lastMessage"],threshold:.3,ignoreLocation:!0}).search(a).map(di),e[26]=u,e[27]=a,e[28]=$):$=e[28],B=$}const k=B,T=x&&F[x.id];let E;e[29]!==n||e[30]!==x?(E=x&&x.user?.id&&n.has(x.user.id),e[29]=n,e[30]=x,e[31]=E):E=e[31];const J=E;let ee;return e[32]!==u||e[33]!==T||e[34]!==t||e[35]!==M||e[36]!==L||e[37]!==k||e[38]!==I||e[39]!==Z||e[40]!==R||e[41]!==i||e[42]!==h||e[43]!==N||e[44]!==b||e[45]!==O||e[46]!==a||e[47]!==s||e[48]!==d||e[49]!==A||e[50]!==n||e[51]!==J||e[52]!==g||e[53]!==m||e[54]!==x||e[55]!==p||e[56]!==_||e[57]!==F||e[58]!==l?(ee={id:i,currentUser:t,onlineUsers:n,msgSearchQuery:a,setMsgSearchQuery:o,userSearchResults:l,conversations:u,filteredConversations:k,selectedConversation:x,localMessages:O,isConvLoading:h,isMsgLoading:b,currentIsTyping:T,otherUserIsOnline:J,handleStartConversation:Z,handleSelectConversation:I,refetchConversations:g,refetchMessages:m,sendMessage:p,editMessage:M,onDeleteMessage:d,sendTypingStatus:_,typingStatus:F,onToggleReaction:A,navigate:s,fetchNextMessages:L,hasMoreMessages:R,isFetchingMoreMessages:N},e[32]=u,e[33]=T,e[34]=t,e[35]=M,e[36]=L,e[37]=k,e[38]=I,e[39]=Z,e[40]=R,e[41]=i,e[42]=h,e[43]=N,e[44]=b,e[45]=O,e[46]=a,e[47]=s,e[48]=d,e[49]=A,e[50]=n,e[51]=J,e[52]=g,e[53]=m,e[54]=x,e[55]=p,e[56]=_,e[57]=F,e[58]=l,e[59]=ee):ee=e[59],ee};function hi(e){return e.user?.id}function di(e){return e.item}var mi=te();const Oi=()=>{const e=(0,mi.c)(48),{currentUser:i}=ue(),s=de(),t=me(),n=i?.id;let r;e[0]!==n?(r=["notifications",n],e[0]=n,e[1]=r):r=e[1];let a;e[2]!==i?(a=C=>{const{pageParam:Q}=C;return st(i.id,Q,10)},e[2]=i,e[3]=a):a=e[3];const o=!!i?.id;let c;e[4]!==r||e[5]!==a||e[6]!==o?(c={queryKey:r,queryFn:a,enabled:o,initialPageParam:null,getNextPageParam:gi},e[4]=r,e[5]=a,e[6]=o,e[7]=c):c=e[7];const{data:l,fetchNextPage:f,hasNextPage:u,isFetchingNextPage:h,isLoading:g,refetch:m}=re(c);let p;e[8]!==l?.pages?(p=l?.pages.flatMap(pi)||[],e[8]=l?.pages,e[9]=p):p=e[9];const M=p;let _;e[10]!==i||e[11]!==t?(_=()=>{if(!i?.id)return;const C=i.id,Q=fe.channel(`user_notifications:${C}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${C}`},()=>{t.invalidateQueries({queryKey:["notifications",C]})}).subscribe();return()=>{fe.removeChannel(Q)}},e[10]=i,e[11]=t,e[12]=_):_=e[12];const F=i?.id;let w;e[13]!==t||e[14]!==F?(w=[F,t],e[13]=t,e[14]=F,e[15]=w):w=e[15],(0,H.useEffect)(_,w);let D;e[16]!==i?(D=()=>i?ct(i.id):Promise.resolve(),e[16]=i,e[17]=D):D=e[17];let d,A,y;e[18]!==i?.id||e[19]!==t?(d=async()=>{const C=i?.id;await t.cancelQueries({queryKey:["notifications",C]});const Q=t.getQueryData(["notifications",C]);return t.setQueryData(["notifications",C],Mi),{previousNotifications:Q}},A=(C,Q,K)=>{K?.previousNotifications&&t.setQueryData(["notifications",i?.id],K.previousNotifications)},y=()=>{t.invalidateQueries({queryKey:["notifications",i?.id]})},e[18]=i?.id,e[19]=t,e[20]=d,e[21]=A,e[22]=y):(d=e[20],A=e[21],y=e[22]);let P;e[23]!==d||e[24]!==A||e[25]!==y||e[26]!==D?(P={mutationFn:D,onMutate:d,onError:A,onSettled:y},e[23]=d,e[24]=A,e[25]=y,e[26]=D,e[27]=P):P=e[27];const b=he(P);let L;e[28]!==s?(L=C=>{C.type==="follow"?s(`/u/${C.user}`):C.post_id&&s(`/p/${C.post_id}`)},e[28]=s,e[29]=L):L=e[29];const R=L;let N;e[30]!==i?.id||e[31]!==b||e[32]!==M?(N=()=>{i?.id&&M.some(Ai)&&b.mutate()},e[30]=i?.id,e[31]=b,e[32]=M,e[33]=N):N=e[33];const S=i?.id;let x;e[34]!==b||e[35]!==M||e[36]!==S?(x=[S,M,b],e[34]=b,e[35]=M,e[36]=S,e[37]=x):x=e[37],(0,H.useEffect)(N,x);let v;return e[38]!==i||e[39]!==f||e[40]!==R||e[41]!==u||e[42]!==h||e[43]!==g||e[44]!==s||e[45]!==M||e[46]!==m?(v={currentUser:i,notifications:M,isLoading:g,isFetchingMore:h,hasMore:u,loadNotifications:f,refreshNotifications:m,handleNotificationClick:R,navigate:s},e[38]=i,e[39]=f,e[40]=R,e[41]=u,e[42]=h,e[43]=g,e[44]=s,e[45]=M,e[46]=m,e[47]=v):v=e[47],v};function gi(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function pi(e){return e}function yi(e){return{...e,is_read:!0}}function _i(e){return e.map(yi)}function Mi(e){return e&&{...e,pages:e.pages.map(_i)}}function Ai(e){return!e.is_read}var Pi=te();const ji=()=>{const e=(0,Pi.c)(23),{id:i}=Ae(),s=de(),{currentUser:t}=ue(),{addToast:n}=_e(),r=me();let a,o;e[0]!==i?(a=["post",i],o=async()=>{if(!i||!ce(i))throw new Error("Invalid post ID");return yt(i)},e[0]=i,e[1]=a,e[2]=o):(a=e[1],o=e[2]);const c=!!i;let l;e[3]!==a||e[4]!==o||e[5]!==c?(l={queryKey:a,queryFn:o,enabled:c,retry:!1},e[3]=a,e[4]=o,e[5]=c,e[6]=l):l=e[6];const{data:f,isLoading:u,isError:h}=ye(l);let g;e[7]!==s?(g=D=>{s(`/u/${D}`)},e[7]=s,e[8]=g):g=e[8];const m=g;let p;e[9]!==s?(p=()=>{s(-1)},e[9]=s,e[10]=p):p=e[10];const M=p;let _;e[11]!==r?(_=(D,d,A)=>{r.setQueryData(["post",D],y=>y&&{...y,content:d,media:A})},e[11]=r,e[12]=_):_=e[12];const F=_;let w;return e[13]!==n||e[14]!==t||e[15]!==M||e[16]!==F||e[17]!==m||e[18]!==h||e[19]!==u||e[20]!==s||e[21]!==f?(w={post:f,isLoading:u,isError:h,currentUser:t,addToast:n,navigate:s,handleUserClick:m,handleDelete:M,handleUpdate:F},e[13]=n,e[14]=t,e[15]=M,e[16]=F,e[17]=m,e[18]=h,e[19]=u,e[20]=s,e[21]=f,e[22]=w):w=e[22],w};var wi=te();const zi=()=>{const e=(0,wi.c)(44),i=de(),{id:s}=Ae(),[t]=Ke();let n;e[0]!==s||e[1]!==t?(n=s||t.get("id"),e[0]=s,e[1]=t,e[2]=n):n=e[2];const r=n,a=(0,H.useRef)(null);let o;e[3]===Symbol.for("react.memo_cache_sentinel")?(o=new Map,e[3]=o):o=e[3];const c=(0,H.useRef)(o),[l,f]=(0,H.useState)(null),[u,h]=(0,H.useState)(!0);let g;e[4]===Symbol.for("react.memo_cache_sentinel")?(g=["reels"],e[4]=g):g=e[4];let m;e[5]===Symbol.for("react.memo_cache_sentinel")?(m={queryKey:g,queryFn:Fi,initialPageParam:null,getNextPageParam:Ei},e[5]=m):m=e[5];const{data:p,fetchNextPage:M,hasNextPage:_,isFetchingNextPage:F,isLoading:w}=re(m);let D;e[6]!==p?.pages?(D=p?.pages.flatMap(Di)||[],e[6]=p?.pages,e[7]=D):D=e[7];const d=D,[A,y]=(0,H.useState)(0);d.length>0&&d.length!==A&&!l&&(y(d.length),r&&d.find(O=>O.id===r)?f(r):f(d[0].id));let P,b;e[8]!==d.length||e[9]!==r?(P=()=>{if(d.length>0&&r){const O=c.current.get(r);O&&O.scrollIntoView({behavior:"instant"})}},b=[d.length,r],e[8]=d.length,e[9]=r,e[10]=P,e[11]=b):(P=e[10],b=e[11]),(0,H.useEffect)(P,b);let L;e[12]===Symbol.for("react.memo_cache_sentinel")?(L=()=>{h(bi)},e[12]=L):L=e[12];const R=L;let N;e[13]!==l||e[14]!==d?(N=()=>{if(d.length===0)return;const O=d.findIndex(B=>B.id===l);if(O<d.length-1){const B=d[O+1];c.current.get(B.id)?.scrollIntoView({behavior:"smooth"})}},e[13]=l,e[14]=d,e[15]=N):N=e[15];const S=N;let x;e[16]!==l||e[17]!==d?(x=()=>{if(d.length===0)return;const O=d.findIndex(B=>B.id===l);if(O>0){const B=d[O-1];c.current.get(B.id)?.scrollIntoView({behavior:"smooth"})}},e[16]=l,e[17]=d,e[18]=x):x=e[18];const v=x;let C,Q;e[19]!==d.length?(C=()=>{if(d.length===0)return;const O={root:a.current,threshold:.6},B=T=>{T.forEach(E=>{if(E.isIntersecting){const J=E.target.getAttribute("data-id");J&&f(J)}})},k=new IntersectionObserver(B,O);return c.current.forEach(T=>k.observe(T)),()=>k.disconnect()},Q=[d.length],e[19]=d.length,e[20]=C,e[21]=Q):(C=e[20],Q=e[21]),(0,H.useEffect)(C,Q);let K,j;e[22]!==l||e[23]!==S||e[24]!==v?(K=()=>{const O=B=>{const k=B.target;if(!(k.tagName==="INPUT"||k.tagName==="TEXTAREA"||k.isContentEditable)&&!(B.ctrlKey||B.altKey||B.metaKey))e:switch(B.key){case"ArrowUp":B.preventDefault(),v();break e;case"ArrowDown":B.preventDefault(),S();break e;case"m":case"M":R();break e;case" ":{B.preventDefault();const T=c.current.get(l||"");if(T){const E=T.querySelector(".reel-item");E&&E.click()}}}};return window.addEventListener("keydown",O),()=>window.removeEventListener("keydown",O)},j=[l,S,v,R],e[22]=l,e[23]=S,e[24]=v,e[25]=K,e[26]=j):(K=e[25],j=e[26]),(0,H.useEffect)(K,j);let V;e[27]===Symbol.for("react.memo_cache_sentinel")?(V=(O,B)=>{B?c.current.set(O,B):c.current.delete(O)},e[27]=V):V=e[27];const Z=V;let G,I;e[28]!==M||e[29]!==_||e[30]!==F?(G=()=>{const O=()=>{if(!a.current||F||!_)return;const{scrollTop:k,scrollHeight:T,clientHeight:E}=a.current;k+E>=T-800&&M()},B=a.current;if(B)return B.addEventListener("scroll",O),()=>B.removeEventListener("scroll",O)},I=[F,_,M],e[28]=M,e[29]=_,e[30]=F,e[31]=G,e[32]=I):(G=e[31],I=e[32]),(0,H.useEffect)(G,I);let X;return e[33]!==l||e[34]!==M||e[35]!==_||e[36]!==F||e[37]!==w||e[38]!==u||e[39]!==i||e[40]!==d||e[41]!==S||e[42]!==v?(X={reels:d,loading:w,loadingMore:F,activeReelId:l,hasMore:_,isMuted:u,containerRef:a,setReelRef:Z,navigate:i,toggleMute:R,scrollToNext:S,scrollToPrev:v,loadReels:M},e[33]=l,e[34]=M,e[35]=_,e[36]=F,e[37]=w,e[38]=u,e[39]=i,e[40]=d,e[41]=S,e[42]=v,e[43]=X):X=e[43],X};function Fi(e){const{pageParam:i}=e;return bt(i,10)}function Ei(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function Di(e){return e}function bi(e){return!e}const Wi=()=>{const{currentUser:e,logout:i}=ue(),{darkMode:s,toggleDarkMode:t,fontSize:n,setFontSize:r,dataSaver:a,setDataSaver:o}=et(),{addToast:c}=_e(),[l,f]=(0,H.useState)(!1),[u,h]=(0,H.useState)({newPassword:"",confirmPassword:""}),[g,m]=(0,H.useState)(!1),p=async()=>{try{await i(),c("Logged out successfully")}catch(A){console.error("Logout error:",A),c("Failed to logout")}};return{currentUser:e,darkMode:s,toggleDarkMode:t,fontSize:n,setFontSize:r,dataSaver:a,setDataSaver:o,isChangingPassword:l,setIsChangingPassword:f,passwordData:u,setPasswordData:h,loading:g,handleLogout:p,handlePasswordChange:async A=>{if(A.preventDefault(),u.newPassword!==u.confirmPassword){c("Passwords do not match","error");return}if(u.newPassword.length<6){c("Password must be at least 6 characters","error");return}m(!0);try{const{error:y}=await fe.auth.updateUser({password:u.newPassword});if(y)throw y;c("Password updated successfully!"),f(!1),h({newPassword:"",confirmPassword:""})}catch(y){console.error("Password update error:",y),c(y.message||"Failed to update password","error")}finally{m(!1)}},handlePasswordReset:async()=>{if(e?.email){m(!0);try{const{error:A}=await fe.auth.resetPasswordForEmail(e.email,{redirectTo:`${window.location.origin}/settings?type=recovery`});if(A)throw A;c("Password reset email sent!")}catch(A){console.error("Reset password error:",A),c(A.message||"Failed to send reset email","error")}finally{m(!1)}}},handleClearCache:()=>{["seenStories","font-size","data-saver","theme"].forEach(A=>localStorage.removeItem(A)),c("Cache cleared! Reloading..."),setTimeout(()=>window.location.reload(),1500)},handleDownloadData:async()=>{if(e){m(!0);try{const A={user:{id:e.id,handle:e.handle,name:e.name,email:e.email},exportDate:new Date().toISOString(),note:"This is a mock export of your Sysm data."},y=new Blob([JSON.stringify(A,null,2)],{type:"application/json"}),P=URL.createObjectURL(y),b=document.createElement("a");b.href=P,b.download=`sysm-data-${e.handle}.json`,b.click(),URL.revokeObjectURL(P),c("Data export started!")}catch{c("Failed to export data","error")}finally{m(!1)}}},handleDeleteAccount:()=>{window.confirm("Are you absolutely sure? This will permanently delete your account and all associated data. This action is irreversible.")&&(c("Account deletion request submitted. Logging out..."),setTimeout(p,2e3))},handleReportBug:()=>{window.prompt("Please describe the bug you found:")&&c("Bug reported! Thank you for your feedback.")}}};export{Ki as a,Ti as c,Ni as d,Li as f,Oi as i,ki as l,zi as n,Qi as o,$i as p,ji as r,qi as s,Wi as t,Bi as u};
