import{a as ut}from"./rolldown-runtime-BaZ8gS7u.js";import{E as Pt,b as le,c as B,d as Mt,n as Rt,p as It}from"./framework-CsA6nn9m.js";import{r as Et}from"./query-QyXblnmD.js";import{$t as At,An as Ge,En as Dt,Fn as Tt,Ft as ae,Gt as Lt,Ht as Ut,In as Ot,Ln as ke,Mn as Je,On as he,Pn as Wt,Rn as Vt,Sn as Bt,Ut as qt,Vn as Ht,an as Gt,cn as Jt,dn as Qt,gn as ft,in as ze,jn as Kt,ln as Xt,mn as Yt,on as Zt,qn as es,sn as ts,t as ht,tn as ss,vn as is,xn as Q,zn as as}from"./ui-libs-RMDc8kCU.js";import{$t as fe,At as ls,Ft as ns,G as rs,Gt as os,It as Ne,J as cs,K as Qe,Kt as ds,Mt as pt,Nt as ms,Qt as q,Ut as Ke,V as gt,Vt as xs,W as us,Xt as fs,Y as hs,Zt as ye,_ as ps,_t as gs,at as Xe,bt as vs,c as vt,ct as Ye,d as bs,dt as Ze,f as js,ft as zs,g as we,gt as bt,ht as ks,it as et,jt as Ns,kt as tt,l as ys,lt as st,mt as ws,nt as K,ot as it,pt as Cs,q as ie,rt as X,st as at,tn as lt,tt as Y,ut as nt,y as Ss,yt as jt}from"./index-B0Tzh2Hg.js";import{d as $s}from"./hooks-CZwPMQL6.js";import{n as Se,t as $e}from"./linkify-BNMTbiql.js";var _s=B(),p=ut(Pt(),1),t=ut(Mt(),1),Fs=s=>{const e=(0,_s.c)(35),{icon:i,count:f,label:l,onClick:r,active:o,activeColorClass:c,size:d,type:z}=s,j=d===void 0?18:d,g=z===void 0?"default":z;let n,h,x,m,v;if(e[0]!==o||e[1]!==c||e[2]!==f||e[3]!==l||e[4]!==r||e[5]!==g){const D={like:{hoverBg:"group-hover:bg-rose-500/10",hoverText:"group-hover:text-rose-500",activeText:"text-rose-500",activeFill:"fill-rose-500"},repost:{hoverBg:"group-hover:bg-emerald-500/10",hoverText:"group-hover:text-emerald-500",activeText:"text-emerald-500",activeFill:"fill-emerald-500"},comment:{hoverBg:"group-hover:bg-sky-500/10",hoverText:"group-hover:text-sky-500",activeText:"text-sky-500",activeFill:"fill-sky-500"},share:{hoverBg:"group-hover:bg-violet-500/10",hoverText:"group-hover:text-violet-500",activeText:"text-violet-500",activeFill:"fill-violet-500"},default:{hoverBg:"group-hover:bg-zinc-500/10",hoverText:"group-hover:text-zinc-500",activeText:"text-zinc-900 dark:text-white",activeFill:"fill-current"}};n=D[g]||D.default;const w=c||n.activeText;e[11]!==r?(x=F=>{F.stopPropagation(),r&&r(F)},e[11]=r,e[12]=x):x=e[12],m=`${l} ${f!==void 0?`(${f})`:""}`,v=q("group -ml-2 flex items-center gap-x-0.5 rounded-xl px-2 py-1.5 text-[12px] font-bold transition-all sm:gap-x-1 sm:text-[13px]",o?w:"text-zinc-500",!o&&n.hoverText),h=q("rounded-full p-2 transition-all duration-200",!o&&n.hoverBg),e[0]=o,e[1]=c,e[2]=f,e[3]=l,e[4]=r,e[5]=g,e[6]=n,e[7]=h,e[8]=x,e[9]=m,e[10]=v}else n=e[6],h=e[7],x=e[8],m=e[9],v=e[10];const y=o?2.5:2,u=o&&n.activeFill;let k;e[13]!==u?(k=q("transition-colors duration-200",u),e[13]=u,e[14]=k):k=e[14];let b;e[15]!==i||e[16]!==j||e[17]!==y||e[18]!==k?(b=(0,t.jsx)(i,{size:j,strokeWidth:y,className:k}),e[15]=i,e[16]=j,e[17]=y,e[18]=k,e[19]=b):b=e[19];let S;e[20]!==b||e[21]!==h?(S=(0,t.jsx)("div",{className:h,children:b}),e[20]=b,e[21]=h,e[22]=S):S=e[22];let a;e[23]!==l?(a=l&&(0,t.jsx)("span",{className:"hidden xs:inline",children:l}),e[23]=l,e[24]=a):a=e[24];let _;e[25]!==o||e[26]!==f?(_=f!=null&&(0,t.jsx)("span",{className:q("transition-all",o?"font-black":"font-bold"),children:f||0}),e[25]=o,e[26]=f,e[27]=_):_=e[27];let P;return e[28]!==S||e[29]!==a||e[30]!==_||e[31]!==x||e[32]!==m||e[33]!==v?(P=(0,t.jsxs)("button",{onClick:x,"aria-label":m,className:v,children:[S,a,_]}),e[28]=S,e[29]=a,e[30]=_,e[31]=x,e[32]=m,e[33]=v,e[34]=P):P=e[34],P},H=Fs,Ps=B(),Ms=s=>{const e=(0,Ps.c)(49),{currentUser:i,newComment:f,setNewComment:l,handleSubmitComment:r,loading:o,selectedFiles:c,setSelectedFiles:d,isUploading:z}=s;let j;e[0]!==c?(j=c===void 0?[]:c,e[0]=c,e[1]=j):j=e[1];const g=j,n=(0,p.useRef)(null);let h;e[2]!==d?(h=A=>{if(A.target.files){const O=Array.from(A.target.files);d&&d(V=>[...V,...O])}},e[2]=d,e[3]=h):h=e[3];const x=h;let m;e[4]!==d?(m=A=>{d&&d(O=>O.filter((V,Z)=>Z!==A))},e[4]=d,e[5]=m):m=e[5];const v=m;let y;e[6]!==d?(y=A=>{const O=A.clipboardData.files;if(O&&O.length>0){const V=Array.from(O).filter(Rs);V.length>0&&(A.preventDefault(),d&&d(Z=>[...Z,...V]))}},e[6]=d,e[7]=y):y=e[7];const u=y;if(!i){let A;return e[8]===Symbol.for("react.memo_cache_sentinel")?(A=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-6 text-center dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"Please login to join the conversation."})}),e[8]=A):A=e[8],A}let k;e[9]!==i.avatar||e[10]!==i.handle?(k=(0,t.jsx)(X,{src:i.avatar,alt:i.handle,className:"object-cover"}),e[9]=i.avatar,e[10]=i.handle,e[11]=k):k=e[11];let b;e[12]!==i.handle?.[0]?(b=i.handle?.[0]?.toUpperCase(),e[12]=i.handle?.[0],e[13]=b):b=e[13];let S;e[14]!==b?(S=(0,t.jsx)(K,{children:b}),e[14]=b,e[15]=S):S=e[15];let a;e[16]!==k||e[17]!==S?(a=(0,t.jsxs)(Y,{className:"size-9 border border-zinc-200 dark:border-zinc-700",children:[k,S]}),e[16]=k,e[17]=S,e[18]=a):a=e[18];let _;e[19]!==l?(_=A=>l(A.target.value),e[19]=l,e[20]=_):_=e[20];let P;e[21]!==u||e[22]!==f||e[23]!==_?(P=(0,t.jsx)("textarea",{id:"comment-input",className:"min-h-[60px] w-full resize-none bg-transparent text-base outline-none placeholder:text-zinc-500 dark:text-white",placeholder:"Post your reply...",value:f,onChange:_,onPaste:u}),e[21]=u,e[22]=f,e[23]=_,e[24]=P):P=e[24];let D;e[25]!==v||e[26]!==g?(D=g.length>0&&(0,t.jsx)("div",{className:"mt-2 mb-2 flex flex-wrap gap-2",children:g.map((A,O)=>(0,t.jsxs)("div",{className:"relative size-20 overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[A.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(A),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)(Xt,{size:20,className:"text-zinc-500"})}),(0,t.jsx)("button",{onClick:()=>v(O),className:"absolute right-1 top-1 rounded-full bg-black/60 p-1 text-white transition-colors hover:bg-black",children:(0,t.jsx)(ae,{size:12})})]},O))}),e[25]=v,e[26]=g,e[27]=D):D=e[27];let w;e[28]===Symbol.for("react.memo_cache_sentinel")?(w=()=>n.current?.click(),e[28]=w):w=e[28];let F;e[29]===Symbol.for("react.memo_cache_sentinel")?(F=(0,t.jsx)("button",{type:"button",onClick:w,className:"rounded-full p-2 text-violet-600 transition-colors hover:bg-violet-50 dark:hover:bg-zinc-800",title:"Attach media",children:(0,t.jsx)(Dt,{size:20})}),e[29]=F):F=e[29];let E;e[30]!==x?(E=(0,t.jsxs)("div",{className:"flex gap-1 text-violet-600",children:[F,(0,t.jsx)("input",{type:"file",ref:n,onChange:x,multiple:!0,className:"hidden",accept:"image/*,video/*,application/pdf"})]}),e[30]=x,e[31]=E):E=e[31];const I=o||z;let L;e[32]!==f||e[33]!==g.length?(L=!f.trim()&&g.length===0,e[32]=f,e[33]=g.length,e[34]=L):L=e[34];let T;e[35]!==r||e[36]!==I||e[37]!==L?(T=(0,t.jsx)(Cs,{className:"min-w-[70px] !w-auto px-5 py-1.5 text-sm font-bold",onClick:r,loading:I,disabled:L,children:"Reply"}),e[35]=r,e[36]=I,e[37]=L,e[38]=T):T=e[38];let N;e[39]!==E||e[40]!==T?(N=(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between border-t border-zinc-100 pt-3 dark:border-zinc-800",children:[E,T]}),e[39]=E,e[40]=T,e[41]=N):N=e[41];let C;e[42]!==P||e[43]!==D||e[44]!==N?(C=(0,t.jsxs)("div",{className:"flex-1",children:[P,D,N]}),e[42]=P,e[43]=D,e[44]=N,e[45]=C):C=e[45];let M;return e[46]!==C||e[47]!==a?(M=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-4 dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[a,C]})}),e[46]=C,e[47]=a,e[48]=M):M=e[48],M},zt=p.memo(Ms);function Rs(s){return s.type.startsWith("image/")}var Is=B(),Es=s=>{const e=(0,Is.c)(15),{file:i}=s;let f;e[0]===Symbol.for("react.memo_cache_sentinel")?(f=(0,t.jsx)("div",{className:"flex size-10 items-center justify-center rounded-xl bg-violet-100 text-violet-600 dark:bg-violet-900/30",children:(0,t.jsx)(Wt,{size:20})}),e[0]=f):f=e[0];let l;e[1]!==i.name?(l=(0,t.jsx)("div",{className:"truncate text-sm font-bold dark:text-white",children:i.name}),e[1]=i.name,e[2]=l):l=e[2];let r;e[3]!==i.size?(r=i.size!==void 0&&(0,t.jsxs)("div",{className:"text-xs uppercase text-zinc-500",children:[(i.size/1024/1024).toFixed(2)," MB"]}),e[3]=i.size,e[4]=r):r=e[4];let o;e[5]!==l||e[6]!==r?(o=(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[l,r]}),e[5]=l,e[6]=r,e[7]=o):o=e[7];let c;e[8]===Symbol.for("react.memo_cache_sentinel")?(c=(0,t.jsx)(Vt,{size:18}),e[8]=c):c=e[8];let d;e[9]!==i.name||e[10]!==i.url?(d=(0,t.jsx)("a",{href:i.url,download:i.name,className:"p-2 text-zinc-400 transition-colors hover:text-violet-600",onClick:Ds,children:c}),e[9]=i.name,e[10]=i.url,e[11]=d):d=e[11];let z;return e[12]!==o||e[13]!==d?(z=(0,t.jsxs)("div",{className:"group mt-3 flex items-center gap-3 rounded-2xl border border-zinc-100 bg-zinc-50/50 p-3 transition-colors hover:border-violet-500/30 dark:border-zinc-800 dark:bg-zinc-900/10",children:[f,o,d]}),e[12]=o,e[13]=d,e[14]=z):z=e[14],z},As=Es;function Ds(s){return s.stopPropagation()}var $i=B(),Ts=B(),Ls=s=>{const e=(0,Ts.c)(30),{url:i}=s;let f,l;e[0]!==i?(f=["link-preview",i],l=()=>vs(i),e[0]=i,e[1]=f,e[2]=l):(f=e[1],l=e[2]);const r=!!i;let o;e[3]!==f||e[4]!==l||e[5]!==r?(o={queryKey:f,queryFn:l,staleTime:864e5,enabled:r},e[3]=f,e[4]=l,e[5]=r,e[6]=o):o=e[6];const{data:c,isLoading:d,isError:z}=Et(o);if(d){let k;return e[7]===Symbol.for("react.memo_cache_sentinel")?(k=(0,t.jsx)("div",{className:"mt-3 flex h-24 animate-pulse items-center justify-center overflow-hidden rounded-2xl border border-zinc-100 bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-900/50",children:(0,t.jsx)(Ge,{className:"animate-spin text-zinc-300 dark:text-zinc-700",size:24})}),e[7]=k):k=e[7],k}if(z||!c||!c.title&&!c.image)return null;let j;e[8]!==c.image||e[9]!==c.title?(j=c.image&&(0,t.jsx)("div",{className:"aspect-[1.91/1] w-full overflow-hidden border-b border-zinc-100 bg-zinc-100 dark:border-zinc-800 dark:bg-zinc-900",children:(0,t.jsx)("img",{src:c.image,alt:c.title??void 0,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-[1.02]",onError:Os})}),e[8]=c.image,e[9]=c.title,e[10]=j):j=e[10];let g;e[11]===Symbol.for("react.memo_cache_sentinel")?(g=(0,t.jsx)(Ge,{size:12}),e[11]=g):g=e[11];let n;e[12]!==c.siteName?(n=(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs font-bold uppercase tracking-wider text-zinc-600",children:[g,(0,t.jsx)("span",{children:c.siteName})]}),e[12]=c.siteName,e[13]=n):n=e[13];let h;e[14]!==c.title?(h=(0,t.jsx)("div",{className:"line-clamp-2 text-[15px] font-bold leading-snug transition-colors group-hover:text-violet-700 dark:text-white",children:c.title}),e[14]=c.title,e[15]=h):h=e[15];let x;e[16]!==c.description?(x=c.description&&(0,t.jsx)("p",{className:"line-clamp-2 text-xs leading-relaxed text-zinc-600 dark:text-zinc-400",children:c.description}),e[16]=c.description,e[17]=x):x=e[17];let m;e[18]===Symbol.for("react.memo_cache_sentinel")?(m=(0,t.jsx)(Ot,{size:10}),e[18]=m):m=e[18];let v;e[19]!==i?(v=(0,t.jsxs)("div",{className:"flex items-center gap-1 pt-1 text-[11px] font-medium text-zinc-500",children:[m,(0,t.jsx)("span",{className:"truncate",children:i})]}),e[19]=i,e[20]=v):v=e[20];let y;e[21]!==v||e[22]!==n||e[23]!==h||e[24]!==x?(y=(0,t.jsxs)("div",{className:"space-y-1 p-3.5",children:[n,h,x,v]}),e[21]=v,e[22]=n,e[23]=h,e[24]=x,e[25]=y):y=e[25];let u;return e[26]!==y||e[27]!==j||e[28]!==i?(u=(0,t.jsxs)("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"group mt-3 flex flex-col overflow-hidden rounded-2xl border border-zinc-100 bg-white shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-900",onClick:Us,children:[j,y]}),e[26]=y,e[27]=j,e[28]=i,e[29]=u):u=e[29],u},rt=Ls;function Us(s){return s.stopPropagation()}function Os(s){return s.target.style.display="none"}var Ws=B(),Vs=s=>{const e=(0,Ws.c)(17),{src:i,poster:f}=s,l=(0,p.useRef)(null),{reportVisibility:r,unregister:o}=zs(),{dataSaver:c}=gs(),d=(0,p.useId)();let z;e[0]===Symbol.for("react.memo_cache_sentinel")?(z={play:()=>{const k=l.current?.plyr;k&&(k.muted=!0,k.play().catch(qs))},pause:()=>{l.current?.plyr?.pause()}},e[0]=z):z=e[0];const j=z;let g,n;e[1]!==c||e[2]!==d||e[3]!==r||e[4]!==o?(g=()=>{const k=new IntersectionObserver(S=>{const[a]=S;r(d,c?0:a.intersectionRatio,j)},{threshold:[0,.6]}),b=l.current?.elements?.container;return b&&k.observe(b),()=>{o(d),b&&k.unobserve(b)}},n=[d,r,o,j,c],e[1]=c,e[2]=d,e[3]=r,e[4]=o,e[5]=g,e[6]=n):(g=e[5],n=e[6]),(0,p.useEffect)(g,n);let h;e[7]!==i?(h=[{src:i,type:"video/mp4"}],e[7]=i,e[8]=h):h=e[8];let x;e[9]!==f||e[10]!==h?(x={type:"video",sources:h,poster:f},e[9]=f,e[10]=h,e[11]=x):x=e[11];let m;e[12]===Symbol.for("react.memo_cache_sentinel")?(m={controls:["play-large","play","progress","current-time","mute","volume","fullscreen"],settings:["quality","speed"],ratio:"16:9",clickToPlay:!0,hideControls:!0,resetOnEnd:!0},e[12]=m):m=e[12];let v;e[13]!==x?(v={source:x,options:m},e[13]=x,e[14]=v):v=e[14];const y=v;let u;return e[15]!==y?(u=(0,t.jsx)("div",{className:"w-full bg-black",onClick:Hs,children:(0,t.jsx)(ht,{ref:l,...y})}),e[15]=y,e[16]=u):u=e[16],u},Bs=Vs;function qs(){}function Hs(s){return s.stopPropagation()}var Gs=B(),Js=s=>{const e=(0,Gs.c)(3),{items:i}=s,f=i===void 0?[]:i,{openLightbox:l}=ws();if(!f||Array.isArray(f)&&f.length===0)return null;const r=Array.isArray(f)?f:[f],o=r.filter(Ks),c=r.filter(Xs),d=h=>{const x=o.filter(Ys).map(Zs),m=o[h];l(x,x.indexOf(m.url||m.src))},z="mt-2 space-y-2",j=o.length>0&&(0,t.jsx)("div",{className:`grid gap-2 overflow-hidden rounded-2xl border border-zinc-100 dark:border-zinc-800 ${o.length===1?"grid-cols-1":o.length===2?"aspect-[16/9] grid-cols-2":(o.length===3,"aspect-[16/9] grid-cols-2 grid-rows-2")}`,children:o.map((h,x)=>(0,t.jsx)("div",{className:`relative cursor-pointer overflow-hidden bg-zinc-100 dark:bg-zinc-900 ${o.length===3&&x===0?"row-span-2":""}
                                `,onClick:m=>{h.type==="image"&&(m.stopPropagation(),d(x))},children:h.type==="video"?(0,t.jsx)(Bs,{src:h.url,poster:h.poster||void 0}):(0,t.jsx)("img",{src:h.url||h.src,className:"size-full object-cover transition-transform duration-500 hover:scale-[1.02]",alt:"",loading:"lazy"})},x))}),g=c.map(ei);let n;return e[0]!==j||e[1]!==g?(n=(0,t.jsxs)("div",{className:z,children:[j,g]}),e[0]=j,e[1]=g,e[2]=n):n=e[2],n},Qs=Js;function Ks(s){return s.type==="image"||s.type==="video"}function Xs(s){return s.type==="file"}function Ys(s){return s.type==="image"}function Zs(s){return s.url||s.src}function ei(s,e){return(0,t.jsx)(As,{file:s},e)}var ti=B(),si=s=>{const e=(0,ti.c)(18),{poll:i,onVote:f}=s,l=i.options.reduce(ii,0),[r,o]=(0,p.useState)(null);let c;e[0]!==f||e[1]!==r?(c=x=>{r||(o(x),f&&f(x))},e[0]=f,e[1]=r,e[2]=c):c=e[2];const d=c;let z;if(e[3]!==d||e[4]!==i.options||e[5]!==l||e[6]!==r){let x;e[8]!==d||e[9]!==l||e[10]!==r?(x=(m,v)=>{const y=l>0?Math.round((m.votes+(r===m.id?1:0))/(l+(r?1:0))*100):0,u=r===m.id;return(0,t.jsxs)("div",{onClick:k=>{k.stopPropagation(),d(m.id)},className:`relative h-10 w-full overflow-hidden rounded-xl border cursor-pointer ${u?"border-violet-500 dark:border-violet-500":"border-zinc-200 dark:border-zinc-700"}`,children:[r&&(0,t.jsx)("div",{className:"absolute left-0 top-0 h-full bg-zinc-200 transition-all duration-500 dark:bg-zinc-800",style:{width:`${y}%`}}),(0,t.jsxs)("div",{className:"absolute inset-0 z-10 flex items-center justify-between px-4",children:[(0,t.jsxs)("span",{className:`text-sm font-medium ${u?"font-bold text-violet-600":"text-zinc-700 dark:text-zinc-200"}`,children:[m.text," ",u&&(0,t.jsx)(Ht,{size:14,className:"mb-0.5 inline ml-1"})]}),r&&(0,t.jsxs)("span",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:[y,"%"]})]})]},m.id||v)},e[8]=d,e[9]=l,e[10]=r,e[11]=x):x=e[11],z=i.options.map(x),e[3]=d,e[4]=i.options,e[5]=l,e[6]=r,e[7]=z}else z=e[7];const j=l+(r?1:0),g=r?"6 days left":"Click to vote";let n;e[12]!==j||e[13]!==g?(n=(0,t.jsxs)("div",{className:"pl-1 text-xs text-zinc-500 dark:text-zinc-400",children:[j," votes •"," ",g]}),e[12]=j,e[13]=g,e[14]=n):n=e[14];let h;return e[15]!==z||e[16]!==n?(h=(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[z,n]}),e[15]=z,e[16]=n,e[17]=h):h=e[17],h},ot=si;function ii(s,e){return s+e.votes}var Ce=({id:s,user:e,timeAgo:i,content:f,contentClass:l,media:r,quotedPost:o,stats:c,onClick:d,repostedBy:z,onUserClick:j,currentUser:g,showToast:n,poll:h,isDetail:x,initialComments:m,onDelete:v,onUpdate:y,isComment:u,onReply:k,community:b,parent_id:S,post_id:a})=>{const _=le(),{liked:P,reposted:D,localStats:w,setLocalStats:F,handleLike:E,handleRepost:I}=$s(s,c,g,n||(()=>{})),{deletePost:L,updatePost:T}=ks(),[N,C]=(0,p.useState)(m||[]),[M,A]=(0,p.useState)(""),[O,V]=(0,p.useState)(!1),[Z,_e]=(0,p.useState)(!1),[Fe,Pe]=(0,p.useState)(!1),[Nt,Me]=(0,p.useState)(!0),[pe,Re]=(0,p.useState)([]),[yt,Ie]=(0,p.useState)(!1),[Ee,ne]=(0,p.useState)(!1),[re,ee]=(0,p.useState)(!1),[G,oe]=(0,p.useState)(f),[ce,de]=(0,p.useState)(r||[]),[me,te]=(0,p.useState)([]),[Ae,De]=(0,p.useState)(!1),[wt,ge]=(0,p.useState)(!1),[ve,xe]=(0,p.useState)(null),[Te,Le]=(0,p.useState)(!1),[Ct,be]=(0,p.useState)([]),[St,Ue]=(0,p.useState)(!1),{ref:Oe,inView:We}=Rt({threshold:.5,triggerOnce:!0});(0,p.useEffect)(()=>{if(We&&!u){const $=setTimeout(()=>{xs(s).catch(console.error)},1500);return()=>clearTimeout($)}},[We,s,u]);const Ve=(0,p.useRef)(N);(0,p.useEffect)(()=>{Ve.current=N},[N]);const $t=(0,p.useCallback)(async()=>{if(!(!s||!a||w.comments===0)){Ue(!0);try{be(await Ne(a,null,10,s)),Le(!0)}catch($){console.error("Failed to load replies:",$)}finally{Ue(!1)}}},[s,a,w.comments]),Be=async()=>{const $=JSON.stringify(ce)!==JSON.stringify(r||[])||me.length>0;if(!G.trim()||G===f&&!$){ee(!1);return}De(!0);try{const R=[];for(const W of me){const se=await ye(W);R.push(se)}const U=[...ce,...R];u?await os(s,{content:G,media:U}):await T(s,{content:G,media:U}),te([]),ee(!1),n&&n(`${u?"Comment":"Post"} updated`),y&&y(s,G,U)}catch(R){console.error(`Failed to update ${u?"comment":"post"}:`,R),n&&n(`Failed to update ${u?"comment":"post"}`)}finally{De(!1)}},qe=async $=>{$&&$.stopPropagation();try{u?await ns(s):await L(s),n&&n(`${u?"Comment":"Post"} deleted successfully`),v&&v(s)}catch(R){console.error(`Failed to delete ${u?"comment":"post"}:`,R),n&&n(`Failed to delete ${u?"comment":"post"}`)}finally{ne(!1)}},ue=(0,p.useCallback)(async($=!1)=>{if(s){$?Pe(!0):V(!0);try{const R=Ve.current,U=await Ne(s,$&&R.length>0?R[R.length-1].created_at:null,10);U.length<10?Me(!1):Me(!0),C($?W=>[...W,...U]:U)}catch(R){console.error("Failed to load comments:",R)}finally{V(!1),Pe(!1)}}},[s]);(0,p.useEffect)(()=>{x&&s&&ue()},[x,s,ue]);const _t=async $=>{if($.preventDefault(),!(!M.trim()&&pe.length===0||!g)){_e(!0),Ie(!0);try{const R=[];for(const U of pe){const W=await ye(U);R.push(W)}await pt(s,g.id,M,R,ve?.id),A(""),Re([]),xe(null),F(U=>({...U,comments:(U.comments||0)+1})),n&&n("Reply posted!"),ue()}catch(R){console.error("Failed to post comment:",R),n&&n("Failed to post reply.")}finally{_e(!1),Ie(!1)}}},He=({trigger:$})=>(0,t.jsxs)(us,{children:[(0,t.jsx)(hs,{asChild:!0,onClick:R=>R.stopPropagation(),children:$}),(0,t.jsxs)(rs,{align:"end",className:"w-48 rounded-xl border-zinc-100 bg-white dark:border-zinc-800 dark:bg-zinc-900",children:[(0,t.jsxs)(Qe,{children:[!u&&(0,t.jsxs)(ie,{className:"cursor-pointer gap-2 py-2.5",onClick:R=>{R.stopPropagation(),navigator.clipboard.writeText(`${window.location.origin}/post/${s}`),n&&n("Link copied")},children:[(0,t.jsx)(At,{size:16}),(0,t.jsx)("span",{children:"Copy link"})]}),!u&&(0,t.jsxs)(ie,{className:"cursor-pointer gap-2 py-2.5",onClick:R=>{R.stopPropagation(),n&&n("Post reported")},children:[(0,t.jsx)(Kt,{size:16}),(0,t.jsx)("span",{children:"Report post"})]}),!je&&(0,t.jsxs)(ie,{className:"cursor-pointer gap-2 py-2.5",onClick:R=>{R.stopPropagation(),n&&n("User blocked")},children:[(0,t.jsx)(Ut,{size:16}),(0,t.jsxs)("span",{children:["Block @",e.handle]})]}),je&&(0,t.jsxs)(ie,{onClick:R=>{R.stopPropagation(),ee(!0)},className:"cursor-pointer gap-2 py-2.5",children:[(0,t.jsx)(ts,{size:16}),"Edit Post"]})]}),je&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(cs,{}),(0,t.jsx)(Qe,{children:(0,t.jsxs)(ie,{variant:"destructive",className:"cursor-pointer gap-2 py-2.5",onClick:R=>{R.stopPropagation(),ne(!0)},children:[(0,t.jsx)(Lt,{size:16}),(0,t.jsx)("span",{children:"Delete post"})]})})]})]})]}),je=g?.handle===e.handle,Ft=($,R)=>{xe(R?{handle:$,id:u?S||s:R}:null),A(U=>{const W=`@${$} `;return U.includes(W)?U:W+U}),document.getElementById("comment-input")?.focus()};return x?(0,t.jsxs)("div",{className:"flex flex-col",ref:Oe,children:[(0,t.jsxs)("article",{className:"p-5 dark:bg-black",children:[(0,t.jsx)(ct,{user:e,timeAgo:i,community:b,onUserClick:j,isDetail:!0,showAvatar:!0,actionsMenu:(0,t.jsx)(He,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,t.jsx)(ke,{size:20})})})}),(0,t.jsx)(dt,{content:f,isDetail:!0,isEditing:re,editedContent:G,setEditedContent:oe,onCancelEdit:()=>{ee(!1),oe(f),de(r||[]),te([])},onSaveEdit:Be,isUpdating:Ae,contentClass:l}),fe(f)&&(0,t.jsx)(rt,{url:fe(f)}),(0,t.jsx)(mt,{media:r,isEditing:re,editedMedia:ce,setEditedMedia:de,newFiles:me,setNewFiles:te}),h&&(0,t.jsx)(ot,{poll:h}),o&&(0,t.jsx)("div",{className:"mt-4 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm dark:border-zinc-700",children:(0,t.jsx)(xt,{...o})}),(0,t.jsxs)("div",{className:"mt-4 flex items-center gap-x-6 border-b border-zinc-100 pb-4 text-sm text-zinc-500 dark:border-zinc-800 dark:text-zinc-400",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:w.views||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Views"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:w.likes||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Likes"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:w.comments||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Comments"})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex w-full items-center justify-around py-1",children:[(0,t.jsx)(H,{icon:he,label:"Like",type:"like",onClick:E,active:P}),!u&&(0,t.jsx)(H,{icon:ze,label:"Repost",type:"repost",onClick:I,active:D}),(0,t.jsx)(H,{icon:vt,label:"Comment",type:"comment",onClick:()=>document.getElementById("comment-input")?.focus()}),!u&&(0,t.jsx)(H,{icon:we,label:"Share",type:"share",onClick:()=>ge(!0)})]})]}),ve&&(0,t.jsxs)("div",{className:"flex items-center justify-between bg-zinc-50 px-5 py-2 dark:bg-zinc-900/50",children:[(0,t.jsxs)("span",{className:"text-sm text-zinc-500",children:["Replying to ",(0,t.jsxs)("span",{className:"font-bold text-violet-600",children:["@",ve.handle]})]}),(0,t.jsx)("button",{onClick:()=>xe(null),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,t.jsx)(ae,{size:16})})]}),(0,t.jsx)(zt,{currentUser:g,newComment:M,setNewComment:A,handleSubmitComment:_t,loading:Z,selectedFiles:pe,setSelectedFiles:Re,isUploading:yt}),(0,t.jsx)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:O?(0,t.jsx)("div",{className:"flex justify-center p-8",children:(0,t.jsx)(Q,{className:"animate-spin text-violet-500"})}):(0,t.jsxs)(t.Fragment,{children:[Nt&&N.length>0&&(0,t.jsxs)("button",{onClick:()=>ue(!0),disabled:Fe,className:"flex w-full items-center justify-center gap-2 py-3 text-sm font-bold text-violet-600 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[Fe&&(0,t.jsx)(Q,{size:14,className:"animate-spin"}),"View more replies"]}),N.map($=>(0,t.jsx)(Ce,{...$,isComment:!0,post_id:s,onReply:Ft,onUserClick:j,currentUser:g,showToast:n,onDelete:R=>C(U=>U.filter(W=>W.id!==R)),onUpdate:(R,U,W)=>C(se=>se.map(J=>J.id===R?{...J,content:U,media:W}:J)),stats:{likes:$.stats?.likes||0,comments:$.stats?.comments||0,reposts:$.stats?.reposts||0},timeAgo:$.timeAgo||$.created_at},$.id))]})}),(0,t.jsx)(et,{open:Ee,onOpenChange:ne,children:(0,t.jsxs)(at,{onClick:$=>$.stopPropagation(),children:[(0,t.jsxs)(nt,{children:[(0,t.jsx)(Ze,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ye,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(st,{children:[(0,t.jsx)(it,{onClick:$=>$.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Xe,{onClick:qe,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]}):(0,t.jsxs)("article",{ref:Oe,onClick:d,className:`px-4 transition-all ${u?"py-2 bg-transparent hover:bg-zinc-50/30 dark:hover:bg-zinc-800/20":"py-4 border-b border-zinc-100 bg-white hover:bg-zinc-50/30 dark:border-zinc-800 dark:bg-black dark:hover:bg-white/[0.02]"} ${d?"cursor-pointer":""}`,children:[z&&(0,t.jsxs)("div",{className:"mb-2 ml-1 flex items-center space-x-1.5 text-[13px] font-semibold text-zinc-600",children:[(0,t.jsx)(ze,{size:14,className:"text-zinc-500"}),(0,t.jsxs)("span",{className:"flex cursor-pointer items-center text-zinc-700 hover:underline dark:text-zinc-300",onClick:$=>{$.stopPropagation(),j&&j(z.handle)},children:[z.handle," Reposted"]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsxs)("div",{className:"flex shrink-0 flex-col items-center self-stretch pt-0.5",children:[(0,t.jsx)("div",{className:"cursor-pointer",onClick:$=>{$.stopPropagation(),j&&j(e.handle)},children:(0,t.jsxs)(Y,{className:`${u?"size-8":"size-10"} border-0 shadow-sm`,children:[(0,t.jsx)(X,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(K,{className:"text-xs",children:e.handle[0]?.toUpperCase()})]})}),(!u&&w.comments>0||u&&!S&&w.comments>0)&&(0,t.jsx)("div",{className:"mt-2 w-0.5 flex-1 rounded-full bg-zinc-100 dark:bg-zinc-800"})]}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,t.jsx)(ct,{user:e,timeAgo:i,community:b,onUserClick:j,isComment:u,actionsMenu:(0,t.jsx)(He,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 group-hover:bg-zinc-100 dark:hover:bg-zinc-800 dark:group-hover:bg-zinc-800/50",children:(0,t.jsx)(ke,{size:18})})})}),(0,t.jsx)(dt,{content:f,isEditing:re,editedContent:G,setEditedContent:oe,onCancelEdit:()=>{ee(!1),oe(f),de(r||[]),te([])},onSaveEdit:Be,isUpdating:Ae,contentClass:l}),fe(f)&&(0,t.jsx)(rt,{url:fe(f)}),(0,t.jsx)(mt,{media:r,isEditing:re,editedMedia:ce,setEditedMedia:de,newFiles:me,setNewFiles:te}),h&&(0,t.jsx)(ot,{poll:h}),o&&(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-900",onClick:$=>{$.stopPropagation(),_(`/post/${o.id}`)},children:(0,t.jsx)(xt,{...o})}),(0,t.jsxs)("div",{className:`flex items-center gap-x-1 ${u?"mt-1.5":"mt-3"}`,children:[(0,t.jsx)(H,{icon:he,size:u?16:18,type:"like",onClick:E,active:P}),(0,t.jsx)(H,{icon:ft,size:u?16:18,type:"comment",onClick:$=>{$?.stopPropagation(),k?k(e.handle,s):d&&d()}}),(0,t.jsx)(H,{icon:ze,size:u?16:18,type:"repost",onClick:I,active:D}),!u&&(0,t.jsx)(H,{icon:we,type:"share",onClick:$=>{$?.stopPropagation(),ge(!0)}})]}),(w.comments>0||w.likes>0||(w.views||0)>0)&&(0,t.jsxs)("div",{className:`mt-1 flex items-center gap-x-1.5 px-0.5 ${u?"text-[12px]":"text-[14px]"} font-medium text-zinc-500 dark:text-zinc-400`,children:[(w.views||0)>0&&!u&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{className:"hover:underline",children:[w.views," ",w.views===1?"view":"views"]}),(w.comments>0||w.likes>0)&&(0,t.jsx)("span",{className:"opacity-50",children:"·"})]}),w.comments>0&&(0,t.jsxs)("button",{className:"hover:underline",onClick:$=>{$.stopPropagation(),Te?Le(!1):$t()},children:[w.comments," ",w.comments===1?"reply":"replies"]}),w.comments>0&&w.likes>0&&(0,t.jsx)("span",{className:"opacity-50",children:"·"}),w.likes>0&&(0,t.jsxs)("button",{className:"hover:underline",children:[w.likes," ",w.likes===1?"like":"likes"]})]}),Te&&(0,t.jsxs)("div",{className:"relative mt-2 space-y-0",children:[(0,t.jsx)("div",{className:"absolute left-[19px] top-0 bottom-4 w-0.5 bg-zinc-100 dark:bg-zinc-800"}),St?(0,t.jsx)("div",{className:"flex py-4 pl-12",children:(0,t.jsx)(Q,{size:18,className:"animate-spin text-violet-500"})}):(0,t.jsx)("div",{className:"flex flex-col",children:Ct.map($=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute left-[19px] top-5 h-0.5 w-4 bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsx)("div",{className:"pl-6",children:(0,t.jsx)(Ce,{...$,isComment:!0,post_id:a,onReply:k,onUserClick:j,currentUser:g,showToast:n,onDelete:R=>be(U=>U.filter(W=>W.id!==R)),onUpdate:(R,U,W)=>be(se=>se.map(J=>J.id===R?{...J,content:U,media:W}:J)),stats:{likes:$.stats?.likes||0,comments:$.stats?.comments||0,reposts:$.stats?.reposts||0},timeAgo:$.timeAgo||$.created_at})})]},$.id))})]})]})]}),(0,t.jsx)(kt,{isOpen:wt,onClose:()=>ge(!1),url:`${window.location.origin}/post/${s}`,title:"Share Post"}),(0,t.jsx)(et,{open:Ee,onOpenChange:ne,children:(0,t.jsxs)(at,{onClick:$=>$.stopPropagation(),children:[(0,t.jsxs)(nt,{children:[(0,t.jsx)(Ze,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ye,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(st,{children:[(0,t.jsx)(it,{onClick:$=>$.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Xe,{onClick:qe,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})};function ai(s,e){return s.id===e.id&&s.content===e.content&&s.timeAgo===e.timeAgo&&s.user.id===e.user.id&&s.user.avatar===e.user.avatar&&s.stats.likes===e.stats.likes&&s.stats.comments===e.stats.comments&&s.stats.reposts===e.stats.reposts&&s.currentUser?.id===e.currentUser?.id&&JSON.stringify(s.media)===JSON.stringify(e.media)&&JSON.stringify(s.repostedBy)===JSON.stringify(e.repostedBy)}var li=p.memo(Ce,ai),ni=B(),ri=s=>{const e=(0,ni.c)(43),{user:i,timeAgo:f,community:l,onUserClick:r,actionsMenu:o,isComment:c,isDetail:d,showAvatar:z}=s,j=z===void 0?!1:z,g=le();let n;e[0]!==r||e[1]!==i.handle?(n=I=>{I.stopPropagation(),r&&r(i.handle)},e[0]=r,e[1]=i.handle,e[2]=n):n=e[2];const h=n;let x;e[3]!==l||e[4]!==g?(x=I=>{I.stopPropagation(),l&&g(`/c/${l.handle}`)},e[3]=l,e[4]=g,e[5]=x):x=e[5];const m=x,v=`flex items-center justify-between ${d?"pb-4":"min-h-[40px] mb-1"}`;let y;e[6]!==h||e[7]!==c||e[8]!==d||e[9]!==j||e[10]!==i.avatar||e[11]!==i.handle?(y=j&&(0,t.jsx)("button",{className:"shrink-0",onClick:h,children:(0,t.jsxs)(Y,{className:`${d?"size-12":c?"size-8":"size-10"} border-0 shadow-sm`,children:[(0,t.jsx)(X,{src:i.avatar,alt:i.handle,className:"object-cover"}),(0,t.jsx)(K,{className:"text-xs",children:i.handle[0]?.toUpperCase()})]})}),e[6]=h,e[7]=c,e[8]=d,e[9]=j,e[10]=i.avatar,e[11]=i.handle,e[12]=y):y=e[12];const u=`flex shrink-0 items-center gap-1 font-bold text-zinc-900 hover:underline dark:text-white ${d?"text-base sm:text-lg":c?"text-[14px]":"text-[15px]"}`;let k;e[13]!==i.handle?(k=(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:i.handle}),e[13]=i.handle,e[14]=k):k=e[14];let b;e[15]!==c||e[16]!==d||e[17]!==i.verified?(b=i.verified&&(0,t.jsx)(ps,{size:d?16:c?12:14,className:"text-blue-500"}),e[15]=c,e[16]=d,e[17]=i.verified,e[18]=b):b=e[18];let S;e[19]!==h||e[20]!==u||e[21]!==k||e[22]!==b?(S=(0,t.jsxs)("button",{className:u,onClick:h,children:[k,b]}),e[19]=h,e[20]=u,e[21]=k,e[22]=b,e[23]=S):S=e[23];let a;e[24]!==l||e[25]!==m||e[26]!==d?(a=l&&(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-1 text-zinc-500",children:[(0,t.jsx)(ys,{size:d?14:12,className:"shrink-0 text-zinc-400"}),(0,t.jsxs)("button",{className:`flex items-center gap-1 font-bold text-zinc-900 hover:underline dark:text-zinc-100 ${d?"text-[14px] sm:text-[15px]":"text-[13px]"}`,onClick:m,children:[(0,t.jsxs)(Y,{className:"size-3.5 shrink-0 border border-zinc-200 bg-zinc-100 dark:border-zinc-700 dark:bg-zinc-800",children:[(0,t.jsx)(X,{src:l.avatar,alt:l.name,className:"object-cover"}),(0,t.jsx)(K,{className:"text-[6px] font-bold text-zinc-500",children:l.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:l.name})]})]}),e[24]=l,e[25]=m,e[26]=d,e[27]=a):a=e[27];let _;e[28]!==a||e[29]!==S?(_=(0,t.jsx)("div",{className:"flex min-w-0 flex-1 flex-col",children:(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex min-w-0 max-w-full items-center gap-1.5",children:[S,a]})})}),e[28]=a,e[29]=S,e[30]=_):_=e[30];let P;e[31]!==_||e[32]!==y?(P=(0,t.jsxs)("div",{className:"flex items-center gap-x-3 flex-1 min-w-0",children:[y,_]}),e[31]=_,e[32]=y,e[33]=P):P=e[33];const D=f||"Recent";let w;e[34]!==D?(w=(0,t.jsx)("span",{className:"whitespace-nowrap text-[12px] text-zinc-500 dark:text-zinc-400",children:D}),e[34]=D,e[35]=w):w=e[35];let F;e[36]!==o||e[37]!==w?(F=(0,t.jsxs)("div",{className:"-mt-1 flex items-center gap-2",children:[w,o]}),e[36]=o,e[37]=w,e[38]=F):F=e[38];let E;return e[39]!==P||e[40]!==F||e[41]!==v?(E=(0,t.jsxs)("div",{className:v,children:[P,F]}),e[39]=P,e[40]=F,e[41]=v,e[42]=E):E=e[42],E},ct=ri,oi=B(),ci=s=>{const e=(0,oi.c)(45),{content:i,isDetail:f,isEditing:l,editedContent:r,setEditedContent:o,onCancelEdit:c,onSaveEdit:d,isUpdating:z,contentClass:j}=s,g=le(),[n,h]=(0,p.useState)(!1),x=typeof i=="string"&&lt(i);if(l&&o){let F;e[0]!==o?(F=O=>o(O.target.value),e[0]=o,e[1]=F):F=e[1];const E=`min-h-[100px] w-full rounded-xl border-zinc-200 bg-zinc-50 focus:ring-violet-500 dark:border-zinc-800 dark:bg-zinc-900 ${lt(r||"")?"font-bangla text-lg":"font-english"}`;let I;e[2]!==r||e[3]!==F||e[4]!==E?(I=(0,t.jsx)(Ss,{value:r,onChange:F,className:E,autoFocus:!0}),e[2]=r,e[3]=F,e[4]=E,e[5]=I):I=e[5];let L;e[6]!==c?(L=(0,t.jsx)("button",{onClick:c,className:"px-4 py-1.5 text-sm font-bold text-zinc-500 transition-colors hover:text-zinc-700 dark:hover:text-zinc-300",children:"Cancel"}),e[6]=c,e[7]=L):L=e[7];let T;e[8]!==i||e[9]!==r||e[10]!==z?(T=z||!r?.trim()||r===i,e[8]=i,e[9]=r,e[10]=z,e[11]=T):T=e[11];const N=z?"Saving...":"Save";let C;e[12]!==d||e[13]!==T||e[14]!==N?(C=(0,t.jsx)("button",{onClick:d,disabled:T,className:"rounded-full bg-violet-600 px-4 py-1.5 text-sm font-bold text-white transition-all hover:bg-violet-700 disabled:opacity-50 active:scale-95",children:N}),e[12]=d,e[13]=T,e[14]=N,e[15]=C):C=e[15];let M;e[16]!==L||e[17]!==C?(M=(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[L,C]}),e[16]=L,e[17]=C,e[18]=M):M=e[18];let A;return e[19]!==I||e[20]!==M?(A=(0,t.jsxs)("div",{className:"mt-2 flex flex-col gap-2",onClick:di,children:[I,M]}),e[19]=I,e[20]=M,e[21]=A):A=e[21],A}const m=!f&&i.length>280;let v;e[22]!==i||e[23]!==n||e[24]!==m?(v=m&&!n?i.substring(0,280):i,e[22]=i,e[23]=n,e[24]=m,e[25]=v):v=e[25];const y=v,u=f?"text-lg leading-relaxed sm:text-xl sm:leading-8":"text-[15px] leading-relaxed",k=x?"font-bangla text-[1.15em]":"font-english";let b;e[26]!==j||e[27]!==u||e[28]!==k?(b=q("whitespace-pre-line break-words",u,k,j),e[26]=j,e[27]=u,e[28]=k,e[29]=b):b=e[29];let S;e[30]!==g?(S={...$e,render:F=>{const{attributes:E,content:I}=F,{href:L,...T}=E,N=window.location.origin;if(L.includes("internal.tag/")){const M=decodeURIComponent(L.split("internal.tag/")[1]);return(0,t.jsxs)("span",{...T,className:q("cursor-pointer font-bold text-rose-600 hover:underline dark:text-rose-400 font-bangla",T.className),onClick:A=>{A.stopPropagation(),g(`/tags/${M}`)},children:["#",M]},I)}let C=null;return L.startsWith("/")?C=L:L.startsWith(N)&&(C=L.replace(N,"")),C?(0,t.jsx)("span",{...T,className:q("cursor-pointer font-medium text-violet-600 hover:underline dark:text-violet-400",T.className),onClick:M=>{M.stopPropagation(),g(C)},children:I},I):(0,t.jsx)("a",{href:L,...T,target:"_blank",rel:"noopener noreferrer",className:q("text-violet-600 hover:underline dark:text-violet-400",T.className),onClick:mi,children:I},I)}},e[30]=g,e[31]=S):S=e[31];let a;e[32]!==y?(a=typeof y=="string"?y.replace(/#([\u0980-\u09FF\w]+)/g,"https://internal.tag/$1"):y,e[32]=y,e[33]=a):a=e[33];let _;e[34]!==S||e[35]!==a?(_=(0,t.jsx)(Se,{options:S,children:a}),e[34]=S,e[35]=a,e[36]=_):_=e[36];const P=m&&!n&&"...";let D;e[37]!==n||e[38]!==m?(D=m&&(0,t.jsx)("button",{onClick:F=>{F.stopPropagation(),h(!n)},className:"ml-1 cursor-pointer font-bold text-rose-600 hover:underline dark:text-rose-400",children:n?"Show less":"See more"}),e[37]=n,e[38]=m,e[39]=D):D=e[39];let w;return e[40]!==b||e[41]!==_||e[42]!==P||e[43]!==D?(w=(0,t.jsxs)("div",{className:b,children:[_,P,D]}),e[40]=b,e[41]=_,e[42]=P,e[43]=D,e[44]=w):w=e[44],w},dt=ci;function di(s){return s.stopPropagation()}function mi(s){return s.stopPropagation()}var xi=B(),ui=s=>{const e=(0,xi.c)(28),{media:i,isEditing:f,editedMedia:l,setEditedMedia:r,newFiles:o,setNewFiles:c}=s;let d;e[0]!==l?(d=l===void 0?[]:l,e[0]=l,e[1]=d):d=e[1];const z=d;let j;e[2]!==o?(j=o===void 0?[]:o,e[2]=o,e[3]=j):j=e[3];const g=j,n=(0,p.useRef)(null);if(f&&r&&c){let x;if(e[4]!==z||e[5]!==r){let b;e[7]!==r?(b=(S,a)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[S.type==="video"?(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(Je,{size:24,className:"text-zinc-400"})}):(0,t.jsx)("img",{src:S.url||S.src,className:"size-full object-cover",alt:""}),(0,t.jsx)("button",{onClick:_=>{_.stopPropagation(),r(P=>P.filter((D,w)=>w!==a))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(ae,{size:16})})]},`old-${a}`),e[7]=r,e[8]=b):b=e[8],x=z.map(b),e[4]=z,e[5]=r,e[6]=x}else x=e[6];let m;if(e[9]!==g||e[10]!==c){let b;e[12]!==c?(b=(S,a)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border-2 border-dashed border-violet-500 bg-violet-50/10",children:[S.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(S),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center",children:(0,t.jsx)(Je,{size:24,className:"animate-pulse text-violet-500"})}),(0,t.jsx)("button",{onClick:_=>{_.stopPropagation(),c(P=>P.filter((D,w)=>w!==a))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(ae,{size:16})}),(0,t.jsx)("div",{className:"absolute bottom-1 left-1 rounded bg-violet-600 px-1 text-[8px] font-bold text-white",children:"NEW"})]},`new-${a}`),e[12]=c,e[13]=b):b=e[13],m=g.map(b),e[9]=g,e[10]=c,e[11]=m}else m=e[11];let v;e[14]!==z.length||e[15]!==g.length?(v=z.length+g.length<4&&(0,t.jsxs)("button",{onClick:b=>{b.stopPropagation(),n.current?.click()},className:"relative flex aspect-square flex-col items-center justify-center gap-1 rounded-xl border-2 border-dashed border-zinc-200 text-zinc-400 transition-all hover:border-violet-500 hover:bg-violet-50/5 hover:text-violet-500 dark:border-zinc-800",children:[(0,t.jsx)(Gt,{size:20}),(0,t.jsx)("span",{className:"text-[10px] font-bold",children:"Add Media"})]}),e[14]=z.length,e[15]=g.length,e[16]=v):v=e[16];let y;e[17]!==x||e[18]!==m||e[19]!==v?(y=(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:[x,m,v]}),e[17]=x,e[18]=m,e[19]=v,e[20]=y):y=e[20];let u;e[21]!==c?(u=(0,t.jsx)("input",{type:"file",ref:n,onChange:b=>{if(b.target.files){const S=Array.from(b.target.files);c(a=>[...a,...S])}},multiple:!0,className:"hidden",accept:"image/*,video/*"}),e[21]=c,e[22]=u):u=e[22];let k;return e[23]!==y||e[24]!==u?(k=(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[y,u]}),e[23]=y,e[24]=u,e[25]=k):k=e[25],k}if(!i||i.length===0)return null;let h;return e[26]!==i?(h=(0,t.jsx)(Qs,{items:i}),e[26]=i,e[27]=h):h=e[27],h},mt=ui,fi=B(),hi=s=>{const e=(0,fi.c)(30),{user:i,time:f,content:l}=s,r=le();let o;e[0]!==i.avatar||e[1]!==i.handle?(o=(0,t.jsx)(X,{src:i.avatar,alt:i.handle}),e[0]=i.avatar,e[1]=i.handle,e[2]=o):o=e[2];let c;e[3]!==i.handle[0]?(c=i.handle[0]?.toUpperCase(),e[3]=i.handle[0],e[4]=c):c=e[4];let d;e[5]!==c?(d=(0,t.jsx)(K,{children:c}),e[5]=c,e[6]=d):d=e[6];let z;e[7]!==o||e[8]!==d?(z=(0,t.jsxs)(Y,{className:"size-6",children:[o,d]}),e[7]=o,e[8]=d,e[9]=z):z=e[9];let j;e[10]!==i.handle?(j=(0,t.jsx)("span",{className:"text-sm font-semibold",children:i.handle}),e[10]=i.handle,e[11]=j):j=e[11];let g;e[12]!==z||e[13]!==j?(g=(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[z,j]}),e[12]=z,e[13]=j,e[14]=g):g=e[14];let n;e[15]!==f?(n=(0,t.jsx)("span",{className:"text-xs text-zinc-500 sm:text-sm",children:f}),e[15]=f,e[16]=n):n=e[16];let h;e[17]!==g||e[18]!==n?(h=(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between gap-x-2",children:[g,n]}),e[17]=g,e[18]=n,e[19]=h):h=e[19];let x;e[20]!==r?(x={...$e,render:u=>{const{attributes:k,content:b}=u,{href:S,...a}=k,_=window.location.origin;let P=null;return S.startsWith("/")?P=S:S.startsWith(_)&&(P=S.replace(_,"")),P?(0,t.jsx)("span",{...a,className:q("cursor-pointer font-medium text-violet-600 hover:underline dark:text-violet-400",a.className),onClick:D=>{D.stopPropagation(),r(P)},children:b},b):(0,t.jsx)("a",{href:S,...a,target:"_blank",rel:"noopener noreferrer",className:q("text-violet-600 hover:underline dark:text-violet-400",a.className),onClick:pi,children:b},b)}},e[20]=r,e[21]=x):x=e[21];let m;e[22]!==l?(m=(0,t.jsx)("p",{className:"whitespace-pre-line text-sm text-zinc-800 dark:text-zinc-300",children:l}),e[22]=l,e[23]=m):m=e[23];let v;e[24]!==m||e[25]!==x?(v=(0,t.jsx)(Se,{options:x,children:m}),e[24]=m,e[25]=x,e[26]=v):v=e[26];let y;return e[27]!==v||e[28]!==h?(y=(0,t.jsxs)("div",{className:"p-4",children:[h,v]}),e[27]=v,e[28]=h,e[29]=y):y=e[29],y},xt=hi;function pi(s){return s.stopPropagation()}var gi=p.memo(({reel:s,isActive:e,isMuted:i})=>{const f=le(),{currentUser:l}=jt(),{addToast:r}=bt(),o=(0,p.useRef)(null),[c,d]=(0,p.useState)(!1),[z,j]=(0,p.useState)(!1),[g,n]=(0,p.useState)(!1),[h,x]=(0,p.useState)(null),[m,v]=(0,p.useState)(!1),[y,u]=(0,p.useState)(s.stats?.likes||0),[k,b]=(0,p.useState)(!1),[S,a]=(0,p.useState)(0),_=(0,p.useRef)(null),P=(0,p.useMemo)(()=>Array.isArray(s.media)?s.media[0]?.src||s.media[0]?.url:s.media?.src||s.media?.url||s.url,[s.media,s.url]);(0,p.useEffect)(()=>{let N;const C=o.current?.plyr;return C&&(e?N=setTimeout(()=>{typeof C.play=="function"&&C.play().catch(()=>{C&&(C.muted=!0,C.play().catch(()=>{}))})},100):typeof C.pause=="function"&&C.pause()),()=>{N&&clearTimeout(N)}},[e]),(0,p.useEffect)(()=>{if(!l?.id||!e)return;(async()=>{try{const[C,M]=await Promise.all([ms(s.id,l.id),ds(l.id,s.user?.id)]);v(C),b(M)}catch(C){console.error("Failed to check interaction status:",C)}})()},[s.id,l?.id,e,s.user?.id]),(0,p.useEffect)(()=>{const N=o.current?.plyr;N&&(N.muted=i)},[i]),(0,p.useEffect)(()=>{const N=o.current?.plyr;if(!N||!e)return;const C=()=>{const M=N.currentTime,A=N.duration;A>0&&a(M/A*100)};if(typeof N.on=="function")return N.on("timeupdate",C),()=>{typeof N.off=="function"&&N.off("timeupdate",C)}},[e]),(0,p.useEffect)(()=>()=>{_.current&&clearTimeout(_.current)},[]);const D=N=>{const C=N.target;C.closest("button")||C.closest("a")||C.closest(".plyr__controls")||(_.current?(clearTimeout(_.current),_.current=null,F()):_.current=setTimeout(()=>{_.current=null,w()},250))},w=()=>{const N=o.current?.plyr;N&&(N.paused?(N.play().catch(()=>{}),x("play")):(N.pause(),x("pause")),setTimeout(()=>x(null),800))},F=async()=>{if(l&&(d(!0),setTimeout(()=>d(!1),1e3),!m)){v(!0),u(N=>N+1);try{await Ke(s.id,l.id)}catch{v(!1),u(N=>N-1)}}},E=async N=>{if(N.stopPropagation(),!l)return;const C=!m;v(C),u(M=>C?M+1:M-1);try{await Ke(s.id,l.id)}catch{v(!C),u(M=>C?M-1:M+1)}},I=async N=>{if(N.stopPropagation(),!l)return;const C=!k;b(C);try{await fs(l.id,s.user?.id)}catch{b(!C)}},L=N=>{N.stopPropagation(),n(!0)},T=(0,p.useMemo)(()=>({source:{type:"video",sources:[{src:P,type:"video/mp4"}]},options:{controls:[],loop:{active:!0},clickToPlay:!1,ratio:"9:16"}}),[P]);return(0,t.jsxs)("div",{"data-id":s.id,className:"reel-item relative flex h-[100dvh] w-full snap-start items-center justify-center overflow-hidden bg-black cursor-pointer",onClick:D,children:[(0,t.jsx)("div",{className:"flex h-full w-full max-w-[450px] items-center justify-center",children:(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(ht,{ref:o,...T})})}),c&&(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-in zoom-in-50 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)(he,{size:120,fill:"white",className:"scale-125 text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.4)]"})})}),h&&(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-in fade-in zoom-in-90 scale-100 animate-out zoom-out-110 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)("div",{className:"rounded-full border border-white/20 bg-white/10 p-8 shadow-2xl backdrop-blur-md",children:h==="play"?(0,t.jsx)(Zt,{size:50,fill:"white",className:"ml-1.5 text-white"}):(0,t.jsx)(Jt,{size:50,fill:"white",className:"text-white"})})})}),(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/60"}),(0,t.jsxs)("div",{className:"pointer-events-none absolute bottom-6 left-4 right-16 text-white",children:[(0,t.jsxs)("div",{className:"pointer-events-auto mb-3 flex items-center gap-2",children:[(0,t.jsxs)(It,{to:`/u/${s.user?.handle}`,className:"flex items-center gap-2 transition-opacity hover:opacity-80",onClick:N=>N.stopPropagation(),children:[(0,t.jsxs)(Y,{className:"size-10 border-2 border-white",children:[(0,t.jsx)(X,{src:s.user?.avatar,alt:s.user?.handle,className:"object-cover"}),(0,t.jsx)(K,{children:s.user?.handle?.[0]?.toUpperCase()})]}),(0,t.jsxs)("span",{className:"font-bold",children:["@",s.user?.handle]})]}),l?.id!==s.user?.id&&(0,t.jsx)("button",{className:`ml-2 flex items-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-bold transition-all active:scale-95 ${k?"border border-white/50 bg-transparent text-white":"bg-white text-black hover:bg-zinc-200"}`,onClick:I,children:k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(js,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Following"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(bs,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Follow"})]})})]}),(0,t.jsx)(Se,{options:{...$e,render:({attributes:N,content:C})=>{const{href:M,...A}=N,O=!M.startsWith("/")&&(M.startsWith("http")||M.startsWith("www"));return M.startsWith("/u/")||M.startsWith("/tags/")||M.startsWith("/c/")||M.startsWith("/explore")?(0,t.jsx)("span",{...A,className:"cursor-pointer font-bold text-white hover:underline",onClick:V=>{V.stopPropagation(),f(M)},children:C},C):(0,t.jsx)("a",{href:M,...A,className:"text-white hover:underline",target:O?"_blank":void 0,rel:O?"noopener noreferrer":void 0,onClick:V=>V.stopPropagation(),children:C},C)}},children:(0,t.jsx)("p",{className:"mb-3 line-clamp-2 text-sm",children:s.content})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[(0,t.jsx)(Qt,{size:14,className:"animate-spin-slow"}),(0,t.jsxs)("span",{children:["Original Audio - ",s.user?.handle]})]})]}),(0,t.jsxs)("div",{className:"absolute bottom-6 right-2 z-10 flex flex-col items-center gap-6",children:[(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:`rounded-full p-3 backdrop-blur-md transition-all active:scale-90 ${m?"bg-rose-500/20 text-rose-500":"bg-zinc-800/50 text-white hover:bg-zinc-700"}`,onClick:E,children:(0,t.jsx)(he,{size:28,fill:m?"currentColor":"none"})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:y})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700 active:scale-90",onClick:N=>{N.stopPropagation(),j(!0)},children:(0,t.jsx)(vt,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:s.stats?.comments||0})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700 active:scale-90",onClick:L,children:(0,t.jsx)(we,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:s.stats?.shares||0})]})]}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 z-50 h-[3px] w-full bg-white/20",children:(0,t.jsx)("div",{className:"h-full bg-white shadow-[0_0_8px_rgba(255,255,255,0.8)] transition-all duration-100 ease-linear",style:{width:`${S}%`}})}),(0,t.jsx)(bi,{isOpen:z,onClose:()=>j(!1),reelId:s.id,currentUser:l,showToast:r}),(0,t.jsx)(kt,{isOpen:g,onClose:()=>n(!1),url:`${window.location.origin}/reels?id=${s.id}`,title:"Share Reel"})]})},(s,e)=>s.isActive===e.isActive&&s.reel.id===e.reel.id&&s.isMuted===e.isMuted),_i=gi,vi=({isOpen:s,onClose:e,reelId:i,currentUser:f,showToast:l})=>{const[r,o]=(0,p.useState)([]),[c,d]=(0,p.useState)(!1),[z,j]=(0,p.useState)(!1),[g,n]=(0,p.useState)(""),[h,x]=(0,p.useState)([]),[m,v]=(0,p.useState)(!1),[y,u]=(0,p.useState)(!0),[k,b]=(0,p.useState)(!1),[S,a]=(0,p.useState)(null),_=(0,p.useRef)(r);(0,p.useEffect)(()=>{_.current=r},[r]);const P=(0,p.useCallback)(async(w=!1)=>{if(i){w?b(!0):d(!0);try{const F=_.current,E=await Ne(i,w&&F.length>0?F[F.length-1].created_at:null,10);E.length<10?u(!1):u(!0),o(w?I=>[...I,...E]:E)}catch(F){console.error("Failed to load comments:",F),l&&l("Failed to load comments","error")}finally{d(!1),b(!1)}}},[i,l]);(0,p.useEffect)(()=>{s&&i?P():(o([]),u(!0))},[s,i,P]);const D=async w=>{if(w.preventDefault(),!(!g.trim()&&h.length===0||!f)){j(!0),v(!0);try{const F=[];for(const E of h){const I=await ye(E);F.push(I)}await pt(i,f.id,g,F,S?.id),n(""),x([]),a(null),l&&l("Reply posted!"),P()}catch(F){console.error("Failed to post comment:",F),l&&l("Failed to post reply.","error")}finally{j(!1),v(!1)}}};return(0,t.jsx)(gt,{isOpen:s,onClose:e,title:"Comments",className:"max-sm:h-[95dvh] h-[85vh] overflow-hidden !p-0 sm:max-w-xl",children:(0,t.jsxs)("div",{className:"flex h-full flex-col overflow-hidden bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"mx-auto my-3 h-1.5 w-12 shrink-0 rounded-full bg-zinc-200 dark:bg-zinc-800 sm:hidden"}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto scroll-smooth scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800",children:c?(0,t.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,t.jsx)(Q,{className:"animate-spin text-violet-500",size:32})}):r.length>0?(0,t.jsxs)("div",{className:"flex flex-col",children:[r.map(w=>(0,t.jsx)(li,{...w,isComment:!0,post_id:i,currentUser:f,showToast:l,onReply:(F,E)=>{a(E?{handle:F,id:E}:null),n(I=>I.includes(`@${F}`)?I:I+`@${F} `)},onDelete:F=>o(E=>E.filter(I=>I.id!==F)),onUpdate:(F,E,I)=>o(L=>L.map(T=>T.id===F?{...T,content:E,media:I}:T))},w.id)),y&&(0,t.jsxs)("button",{onClick:()=>P(!0),disabled:k,className:"flex w-full items-center justify-center gap-2 py-6 text-sm font-bold text-violet-600 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[k&&(0,t.jsx)(Q,{size:16,className:"animate-spin"}),"View more replies"]})]}):(0,t.jsxs)("div",{className:"flex h-full min-h-[300px] flex-col items-center justify-center p-8 text-center text-zinc-500",children:[(0,t.jsx)("div",{className:"mb-4 flex size-16 items-center justify-center rounded-full bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(ft,{size:32,className:"text-zinc-400"})}),(0,t.jsx)("p",{className:"text-lg font-bold dark:text-zinc-300",children:"No comments yet"}),(0,t.jsx)("p",{className:"text-sm dark:text-zinc-500",children:"Be the first to share what you think!"})]})}),(0,t.jsxs)("div",{className:"shrink-0 border-t border-zinc-100 bg-white pb-safe dark:border-zinc-800 dark:bg-zinc-900",children:[S&&(0,t.jsxs)("div",{className:"flex items-center justify-between border-b border-zinc-50 bg-zinc-50/50 px-4 py-2 dark:border-zinc-800/50 dark:bg-zinc-900/50",children:[(0,t.jsxs)("span",{className:"text-xs text-zinc-500",children:["Replying to ",(0,t.jsxs)("span",{className:"font-bold text-violet-600",children:["@",S.handle]})]}),(0,t.jsx)("button",{onClick:()=>a(null),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,t.jsx)(ae,{size:14})})]}),(0,t.jsx)(zt,{currentUser:f,newComment:g,setNewComment:n,handleSubmitComment:D,loading:z,selectedFiles:h,setSelectedFiles:x,isUploading:m})]})]})})},bi=vi,ji=({isOpen:s,onClose:e,url:i,title:f="Share"})=>{const[l,r]=(0,p.useState)(!1),[o,c]=(0,p.useState)(""),[d,z]=(0,p.useState)([]),[j,g]=(0,p.useState)(!1),[n,h]=(0,p.useState)(null),{addToast:x}=bt(),{currentUser:m}=jt(),v=(0,p.useCallback)(async()=>{if(m){g(!0);try{z((await tt(m.id)).map(a=>a.user).filter(a=>a!==null).slice(0,5))}catch(a){console.error("Failed to fetch conversations:",a)}finally{g(!1)}}},[m?.id]);(0,p.useEffect)(()=>{s&&m?v():(c(""),z([]))},[s,m,v]);const y=(0,p.useCallback)(async()=>{if(m){g(!0);try{z((await tt(m.id)).map(a=>a.user).filter(a=>a!==null&&(a.name?.toLowerCase().includes(o.toLowerCase())||a.handle.toLowerCase().includes(o.toLowerCase()))))}catch(a){console.error("Search failed:",a)}finally{g(!1)}}},[o,m?.id]);(0,p.useEffect)(()=>{const a=setTimeout(()=>{o.trim()&&s?y():!o.trim()&&s&&v()},300);return()=>clearTimeout(a)},[o,s,y,v]);const u=async a=>{a&&a.stopPropagation();try{await navigator.clipboard.writeText(i),r(!0),x("Link copied to clipboard!","success"),setTimeout(()=>r(!1),2e3)}catch(_){console.error("Failed to copy:",_),x("Failed to copy link","error")}},k=async a=>{if(m){h(a.id);try{await Ns(await ls(m.id,a.id),m.id,i,"text"),x(`Sent to ${a.name||a.handle}!`,"success")}catch(_){console.error("Failed to send message:",_),x("Failed to send message","error")}finally{h(null)}}},b=[{name:"X",icon:qt,color:"bg-black text-white",href:`https://twitter.com/intent/tweet?url=${encodeURIComponent(i)}`},{name:"Facebook",icon:Tt,color:"bg-[#1877F2] text-white",href:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(i)}`},{name:"LinkedIn",icon:Bt,color:"bg-[#0A66C2] text-white",href:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(i)}`},{name:"WhatsApp",icon:Yt,color:"bg-[#25D366] text-white",href:`https://wa.me/?text=${encodeURIComponent(i)}`},{name:"Email",icon:is,color:"bg-zinc-600 text-white",href:`mailto:?body=${encodeURIComponent(i)}`}],S=async()=>{if(navigator.share)try{await navigator.share({title:f,url:i})}catch(a){a.name!=="AbortError"&&console.error("Native share failed:",a)}else u()};return(0,t.jsx)(gt,{isOpen:s,onClose:e,title:f,className:"max-w-[420px] !p-0 overflow-hidden",children:(0,t.jsxs)("div",{className:"flex h-full flex-col bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"px-5 pb-2 pt-4",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)(ss,{className:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-zinc-400 transition-colors group-focus-within:text-violet-500"}),(0,t.jsx)("input",{type:"text",placeholder:"Search people...",value:o,onChange:a=>c(a.target.value),className:"w-full rounded-xl border-none bg-zinc-100 py-2.5 pl-10 pr-4 text-sm transition-all focus:ring-2 focus:ring-violet-500/20 outline-none dark:bg-zinc-800/50"})]})}),(0,t.jsx)("div",{className:"no-scrollbar flex min-h-[100px] items-center gap-4 overflow-x-auto px-5 py-4",children:j?(0,t.jsx)("div",{className:"flex flex-1 justify-center",children:(0,t.jsx)(Q,{size:24,className:"animate-spin text-zinc-400"})}):d.length>0?d.map(a=>(0,t.jsxs)("button",{onClick:()=>k(a),disabled:n!==null,className:"group flex shrink-0 flex-col items-center gap-1.5 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"size-14 overflow-hidden rounded-full border-2 border-white shadow-sm transition-transform group-hover:scale-105 bg-zinc-100 dark:bg-zinc-800 dark:border-zinc-900",children:(0,t.jsx)("img",{src:a.avatar||`https://i.pravatar.cc/150?u=${a.id}`,alt:a.handle,className:"size-full object-cover"})}),n===a.id&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-full bg-black/40",children:(0,t.jsx)(Q,{size:16,className:"animate-spin text-white"})})]}),(0,t.jsx)("span",{className:"max-w-[60px] truncate text-[10px] font-medium text-zinc-500 dark:text-zinc-400",children:a.name?.split(" ")[0]||a.handle})]},a.id)):(0,t.jsx)("div",{className:"flex-1 py-2 text-center",children:(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"No people found"})})}),(0,t.jsx)("div",{className:"mx-5 h-px bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsxs)("div",{className:"grid grid-cols-5 gap-2 px-5 py-6",children:[b.map(a=>(0,t.jsxs)("a",{href:a.href,target:"_blank",rel:"noopener noreferrer",className:"group flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:`size-12 ${a.color} flex items-center justify-center rounded-2xl shadow-md transition-all group-hover:-translate-y-1 group-hover:scale-110 group-hover:shadow-lg`,children:(0,t.jsx)(a.icon,{size:20,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-tighter text-zinc-500 dark:text-zinc-400",children:a.name})]},a.name)),(0,t.jsxs)("button",{onClick:S,className:"group flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:"flex size-12 items-center justify-center rounded-2xl border border-zinc-200 bg-zinc-100 text-zinc-600 shadow-sm transition-all group-hover:-translate-y-1 group-hover:scale-110 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-300",children:(0,t.jsx)(ke,{size:20,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-tighter text-zinc-500 dark:text-zinc-400",children:"More"})]})]}),(0,t.jsx)("div",{className:"px-5 pb-6",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)("input",{type:"text",readOnly:!0,value:i,className:"w-full rounded-2xl border border-zinc-200 bg-zinc-50 py-3.5 pl-4 pr-14 text-sm font-medium transition-colors focus:outline-none group-hover:border-zinc-300 dark:border-zinc-800 dark:bg-zinc-950 dark:group-hover:border-zinc-700"}),(0,t.jsx)("button",{onClick:u,className:`absolute right-1.5 top-1/2 flex -translate-y-1/2 items-center gap-2 rounded-xl h-10 px-4 text-xs font-bold shadow-sm transition-all active:scale-95 ${l?"bg-emerald-500 text-white":"bg-zinc-900 text-white hover:opacity-90 dark:bg-white dark:text-zinc-900"}`,children:l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(es,{size:14,strokeWidth:3}),(0,t.jsx)("span",{children:"Copied"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(as,{size:14,strokeWidth:3}),(0,t.jsx)("span",{children:"Copy"})]})})]})}),(0,t.jsx)("div",{className:"px-5 pb-5",children:(0,t.jsxs)("button",{onClick:e,className:"group relative flex w-full items-center justify-center overflow-hidden rounded-2xl bg-zinc-900 py-4 font-bold text-white transition-all hover:shadow-xl hover:shadow-zinc-900/10 active:scale-[0.98] dark:bg-white dark:text-zinc-900 dark:hover:shadow-white/10",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-zinc-500 to-zinc-600 opacity-0 transition-opacity duration-300 group-hover:opacity-100"}),(0,t.jsx)("div",{className:"relative flex items-center gap-2",children:(0,t.jsx)("span",{children:"Close"})})]})})]})})},kt=ji;export{li as n,_i as t};
