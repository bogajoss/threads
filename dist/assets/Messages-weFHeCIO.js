import{a as ae}from"./rolldown-runtime-BaZ8gS7u.js";import{E as de,b as oe,c as le,d as xe}from"./framework-CsA6nn9m.js";import"./database-BOtUlDBt.js";import{En as me,Ft as Q,Gt as he,Jn as ue,Jt as pe,Pt as fe,Rt as be,Tn as ge,Vt as ee,X as je,Y as te,Yt as ve,en as ze,er as Ne,hn as ke,ln as we,pn as ye,qn as Ce,rn as se,tn as re,xn as ne,zn as Se}from"./ui-libs-RMDc8kCU.js";import{$ as Me,L as Ge,N as Ie,Q as K,Qt as T,R as Ae,U as Pe,X as Te,Z as Ue,Zt as ie,et as Oe,mt as Re,n as $e,nt as J,pt as Le,r as Ee,rt as V,t as De,tt as W,v as _e,z as qe}from"./index-Cp7Ymh1E.js";import{a as Fe,u as Ye}from"./hooks-CyUdrAuE.js";import{n as Be,t as Je}from"./linkify-BNMTbiql.js";var Ve=le(),P=ae(de(),1),e=ae(xe(),1),We=s=>{const t=(0,Ve.c)(60),{conv:a,selectedId:U,onSelect:y,onlineUsers:d}=s;let I;t[0]!==a.isGroup||t[1]!==a.user||t[2]!==d?(I=!a.isGroup&&a.user?d.has(a.user.id):!1,t[0]=a.isGroup,t[1]=a.user,t[2]=d,t[3]=I):I=t[3];const C=I,z=U===a.id,h=a.unread>0,N=a.isGroup?a.name:a.user?.name,i=a.isGroup?a.avatar:a.user?.avatar;let k;t[4]!==a||t[5]!==y?(k=()=>y(a),t[4]=a,t[5]=y,t[6]=k):k=t[6];const R=z?"bg-violet-500/10 dark:bg-violet-500/20":"hover:bg-zinc-100 dark:hover:bg-zinc-800/50";let p;t[7]!==R?(p=T("group relative flex cursor-pointer items-center gap-4 p-3 mx-2 rounded-2xl transition-all duration-200",R),t[7]=R,t[8]=p):p=t[8];const f=z?"border-violet-500/30":"border-transparent group-hover:border-zinc-200 dark:group-hover:border-zinc-700";let b;t[9]!==f?(b=T("size-[52px] border-2 transition-all",f),t[9]=f,t[10]=b):b=t[10];const O=N||"";let A;t[11]!==i||t[12]!==O?(A=(0,e.jsx)(V,{src:i,alt:O,className:"object-cover"}),t[11]=i,t[12]=O,t[13]=A):A=t[13];let x;t[14]!==N?.[0]?(x=N?.[0]?.toUpperCase(),t[14]=N?.[0],t[15]=x):x=t[15];let w;t[16]!==x?(w=(0,e.jsx)(J,{className:"bg-zinc-100 text-zinc-500 font-bold text-lg dark:bg-zinc-800 dark:text-zinc-400",children:x}),t[16]=x,t[17]=w):w=t[17];let S;t[18]!==w||t[19]!==b||t[20]!==A?(S=(0,e.jsxs)(W,{className:b,children:[A,w]}),t[18]=w,t[19]=b,t[20]=A,t[21]=S):S=t[21];let g;t[22]!==C?(g=C&&(0,e.jsx)("span",{className:"absolute bottom-0.5 right-0.5 size-3.5 rounded-full border-[2.5px] border-white bg-emerald-500 ring-0 dark:border-black"}),t[22]=C,t[23]=g):g=t[23];let u;t[24]!==S||t[25]!==g?(u=(0,e.jsxs)("div",{className:"relative",children:[S,g]}),t[24]=S,t[25]=g,t[26]=u):u=t[26];const j=h?"text-zinc-900 dark:text-white":"text-zinc-700 dark:text-zinc-200";let o;t[27]!==j?(o=T("truncate text-[15px] font-semibold",j),t[27]=j,t[28]=o):o=t[28];let M;t[29]!==N||t[30]!==o?(M=(0,e.jsx)("span",{className:o,children:N}),t[29]=N,t[30]=o,t[31]=M):M=t[31];const n=h?"text-violet-600 dark:text-violet-400":"text-zinc-400";let v;t[32]!==n?(v=T("ml-2 whitespace-nowrap text-[11px] font-medium",n),t[32]=n,t[33]=v):v=t[33];let $;t[34]!==a.time||t[35]!==v?($=(0,e.jsx)("span",{className:v,children:a.time}),t[34]=a.time,t[35]=v,t[36]=$):$=t[36];let L;t[37]!==M||t[38]!==$?(L=(0,e.jsxs)("div",{className:"flex items-center justify-between mb-0.5",children:[M,$]}),t[37]=M,t[38]=$,t[39]=L):L=t[39];const Y=h?"font-semibold text-zinc-900 dark:text-zinc-100":"text-zinc-500 dark:text-zinc-400 group-hover:text-zinc-600 dark:group-hover:text-zinc-300";let E;t[40]!==Y?(E=T("truncate text-[13px] leading-relaxed",Y),t[40]=Y,t[41]=E):E=t[41];const X=a.currentUserSent?"You: ":"";let D;t[42]!==a.lastMessage||t[43]!==E||t[44]!==X?(D=(0,e.jsxs)("p",{className:E,children:[X,a.lastMessage]}),t[42]=a.lastMessage,t[43]=E,t[44]=X,t[45]=D):D=t[45];let _;t[46]!==a.unread||t[47]!==h?(_=h&&(0,e.jsx)("span",{className:"flex size-5 shrink-0 items-center justify-center rounded-full bg-violet-600 text-[10px] font-bold text-white shadow-sm shadow-violet-500/30",children:a.unread}),t[46]=a.unread,t[47]=h,t[48]=_):_=t[48];let q;t[49]!==D||t[50]!==_?(q=(0,e.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[D,_]}),t[49]=D,t[50]=_,t[51]=q):q=t[51];let F;t[52]!==L||t[53]!==q?(F=(0,e.jsxs)("div",{className:"min-w-0 flex-1 py-1",children:[L,q]}),t[52]=L,t[53]=q,t[54]=F):F=t[54];let B;return t[55]!==u||t[56]!==k||t[57]!==F||t[58]!==p?(B=(0,e.jsxs)("div",{onClick:k,className:p,children:[u,F]}),t[55]=u,t[56]=k,t[57]=F,t[58]=p,t[59]=B):B=t[59],B},Xe=({conversations:s,userResults:t=[],onSelect:a,onStartNew:U,selectedId:y,searchQuery:d,onSearchChange:I,onlineUsers:C=new Set})=>{const[z,h]=(0,P.useState)(!1),N=s.filter(i=>C.has(i.user?.id));return(0,e.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col bg-white dark:bg-black h-full",children:[(0,e.jsxs)("div",{className:"px-5 pt-5 pb-2",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between mb-5",children:[(0,e.jsx)("h2",{className:"text-2xl font-black tracking-tight text-zinc-900 dark:text-white",children:"Chats"}),(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)("button",{onClick:()=>h(!0),className:"rounded-full bg-zinc-100 p-2.5 text-zinc-600 transition-colors hover:bg-zinc-200 dark:bg-zinc-900 dark:text-zinc-400 dark:hover:bg-zinc-800",title:"New Group",children:(0,e.jsx)(be,{size:20})}),(0,e.jsx)("button",{className:"rounded-full bg-zinc-100 p-2.5 text-zinc-600 transition-colors hover:bg-zinc-200 dark:bg-zinc-900 dark:text-zinc-400 dark:hover:bg-zinc-800",children:(0,e.jsx)(pe,{size:20})})]})]}),(0,e.jsxs)("div",{className:"relative group",children:[(0,e.jsx)(re,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-violet-500 transition-colors",size:18}),(0,e.jsx)("input",{type:"text",value:d,onChange:i=>I(i.target.value),placeholder:"Search Messenger",className:"w-full rounded-2xl border-none bg-zinc-100 py-3 pl-12 pr-4 text-[15px] font-medium text-zinc-900 placeholder:text-zinc-500 transition-all focus:bg-white focus:ring-2 focus:ring-violet-500/20 focus:shadow-md dark:bg-zinc-900 dark:text-white dark:focus:bg-black"})]})]}),(0,e.jsx)(Ie,{className:"flex-1",children:(0,e.jsxs)("div",{className:"flex flex-col pb-4",children:[!d&&N.length>0&&(0,e.jsx)("div",{className:"mb-4 mt-2",children:(0,e.jsxs)("div",{className:"flex gap-4 overflow-x-auto px-5 pb-4 pt-2 no-scrollbar",children:[(0,e.jsxs)("div",{className:"flex flex-col items-center gap-2 min-w-[64px] cursor-pointer group",children:[(0,e.jsxs)("div",{className:"relative flex size-[60px] items-center justify-center rounded-full bg-zinc-50 border border-zinc-200 dark:bg-zinc-900 dark:border-zinc-800 group-hover:bg-zinc-100 dark:group-hover:bg-zinc-800 transition-colors",children:[(0,e.jsx)(ee,{size:24,className:"text-zinc-400"}),(0,e.jsx)("div",{className:"absolute bottom-0 right-0 size-5 bg-white dark:bg-black rounded-full flex items-center justify-center",children:(0,e.jsx)("div",{className:"size-4 bg-zinc-200 dark:bg-zinc-700 rounded-full flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-[10px] text-zinc-500 font-bold",children:"+"})})})]}),(0,e.jsx)("span",{className:"text-[11px] font-medium text-zinc-500",children:"Your Story"})]}),N.map(i=>(0,e.jsxs)("div",{onClick:()=>a(i),className:"flex flex-col items-center gap-2 cursor-pointer group min-w-[64px] transition-transform active:scale-95",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute -inset-[3px] rounded-full bg-gradient-to-tr from-violet-500 via-fuchsia-500 to-orange-500 opacity-90 p-[2px]"}),(0,e.jsx)("div",{className:"relative rounded-full border-[3px] border-white dark:border-black p-[2px] bg-white dark:bg-black",children:(0,e.jsxs)(W,{className:"size-[50px]",children:[(0,e.jsx)(V,{src:i.user?.avatar,className:"object-cover"}),(0,e.jsx)(J,{children:i.user?.name?.[0]})]})}),(0,e.jsx)("span",{className:"absolute bottom-1 right-1 size-3.5 rounded-full border-[2.5px] border-white bg-emerald-500 dark:border-black"})]}),(0,e.jsx)("span",{className:"w-full truncate text-center text-[11px] font-medium text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white transition-colors",children:i.user?.name.split(" ")[0]})]},i.id))]})}),(0,e.jsx)("div",{className:"px-2 space-y-1",children:s.length>0&&s.filter(i=>i.lastMessage!=="No messages yet"||i.id===y||d).map(i=>(0,e.jsx)(We,{conv:i,selectedId:y,onSelect:a,onlineUsers:C},i.id))}),t.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"px-6 py-3 mt-2 text-xs font-bold uppercase tracking-wider text-zinc-400",children:"More People"}),(0,e.jsx)("div",{className:"px-2 space-y-1",children:t.map(i=>(0,e.jsxs)("div",{onClick:()=>U(i),className:"flex cursor-pointer items-center gap-4 px-3 py-2 rounded-2xl transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800/50",children:[(0,e.jsxs)(W,{className:"size-10",children:[(0,e.jsx)(V,{src:i.avatar,className:"object-cover"}),(0,e.jsx)(J,{children:i.name?.[0]?.toUpperCase()})]}),(0,e.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,e.jsx)("div",{className:"truncate text-sm font-bold text-zinc-900 dark:text-white",children:i.name}),(0,e.jsxs)("div",{className:"truncate text-xs text-zinc-500",children:["@",i.handle]})]}),(0,e.jsx)("button",{className:"flex size-8 items-center justify-center rounded-full bg-violet-50 text-violet-600 dark:bg-violet-900/20 dark:text-violet-400",children:(0,e.jsx)(ee,{size:16})})]},i.id))})]}),s.length===0&&t.length===0&&d&&(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center px-6",children:[(0,e.jsx)("div",{className:"mb-4 rounded-full bg-zinc-100 p-4 dark:bg-zinc-900",children:(0,e.jsx)(re,{className:"text-zinc-400",size:24})}),(0,e.jsxs)("p",{className:"text-zinc-500",children:['No results found for "',d,'"']})]})]})}),(0,e.jsx)(Ee,{isOpen:z,onClose:()=>h(!1),onCreated:i=>{a({id:i,isGroup:!0})}})]})},Ze=Xe,He=({conversation:s,messages:t,onBack:a,onSendMessage:U,onDeleteMessage:y,onTyping:d,isLoading:I,isTyping:C,isOnline:z})=>{const h=oe(),{openLightbox:N}=Re(),[i,k]=(0,P.useState)(""),[R,p]=(0,P.useState)(!1),[f,b]=(0,P.useState)([]),[O,A]=(0,P.useState)(!1),[x,w]=(0,P.useState)(null),[S,g]=(0,P.useState)(!1),u=(0,P.useRef)(null),j=(0,P.useRef)(null),o=(0,P.useRef)(null),M=Ye(s.user?.lastSeen),n=s.isGroup?s.name:s.user?.name,v=s.isGroup?s.avatar:s.user?.avatar;(0,P.useEffect)(()=>{j.current&&(j.current.scrollTop=j.current.scrollHeight)},[t,C,f,x]);const $=r=>{const l=r.target.value;k(l),r.target.style.height="auto",r.target.style.height=`${Math.min(r.target.scrollHeight,120)}px`,d&&(d(!0),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{d(!1)},2e3))},L=r=>{k(l=>l+r.emoji)},Y=r=>{if(r&&r.preventDefault(),!i.trim()&&f.length===0)return;d&&(o.current&&clearTimeout(o.current),d(!1)),U(s.id,i,f.length>0?"image":"text",f,x?.id),k(""),b([]),w(null);const l=document.querySelector('textarea[name="chat-input"]');l&&(l.style.height="auto")},E=async r=>{if(!r.target.files)return;const l=Array.from(r.target.files);if(l.length!==0){p(!0);try{const c=await Promise.all(l.map(m=>ie(m)));b(m=>[...m,...c])}catch(c){console.error("Upload failed:",c)}finally{p(!1)}}},X=async r=>{const l=r.clipboardData.files;if(l&&l.length>0){const c=Array.from(l).filter(m=>m.type.startsWith("image/"));if(c.length>0){r.preventDefault(),p(!0);try{const m=await Promise.all(c.map(G=>ie(G)));b(G=>[...G,...m])}catch(m){console.error("Paste upload failed:",m)}finally{p(!1)}}}},D=r=>{b(l=>l.filter(c=>c.url!==r))},_=r=>{!r.media||r.media.length===0||N(r.media.map(l=>l.url),0)},q=(0,P.useMemo)(()=>{const r=t.filter(l=>l.sender==="me");return r.length>0?r[r.length-1].id:null},[t]),F=r=>t.find(l=>l.id===r),B=(r,l)=>r===0?!1:t[r-1].sender===l.sender,ce=(r,l)=>r===t.length-1?!1:t[r+1].sender===l.sender;return(0,e.jsxs)("div",{className:"relative flex h-full w-full flex-col overflow-hidden bg-white/50 dark:bg-black/50 md:border-l md:border-zinc-200/50 dark:md:border-zinc-800/50",children:[(0,e.jsxs)("div",{className:"sticky top-0 z-30 flex shrink-0 items-center justify-between border-b border-zinc-100 bg-white/75 px-4 py-3 backdrop-blur-xl dark:border-zinc-800 dark:bg-black/75",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)("button",{onClick:a,className:"mr-1 -ml-2 rounded-full p-2 text-zinc-600 transition-colors hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-zinc-800 md:hidden",children:(0,e.jsx)(Ne,{size:24})}),(0,e.jsxs)("div",{className:"relative cursor-pointer",onClick:()=>!s.isGroup&&s.user&&h(`/u/${s.user.handle}`),children:[(0,e.jsxs)(W,{className:"size-10 border-2 border-white shadow-sm dark:border-zinc-800",children:[(0,e.jsx)(V,{src:v,alt:n||"",className:"object-cover"}),(0,e.jsx)(J,{children:n?.[0]?.toUpperCase()})]}),z&&!s.isGroup&&(0,e.jsx)("span",{className:"absolute bottom-0 right-0 size-3 rounded-full border-2 border-white bg-emerald-500 dark:border-black"})]}),(0,e.jsxs)("div",{className:"flex flex-col cursor-pointer",onClick:()=>!s.isGroup&&s.user&&h(`/u/${s.user.handle}`),children:[(0,e.jsx)("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:n}),(0,e.jsx)("span",{className:"text-[11px] font-medium text-zinc-500",children:s.isGroup?"Group Chat":z?(0,e.jsx)("span",{className:"text-emerald-500",children:"Active now"}):s.user?.lastSeen?`Last seen ${M}`:"Offline"})]})]}),(0,e.jsx)("div",{className:"flex items-center gap-1",children:(0,e.jsx)("button",{onClick:()=>g(!0),className:"rounded-full p-2.5 text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:(0,e.jsx)(ge,{size:20})})})]}),(0,e.jsx)("div",{className:"flex-1 min-h-0 overflow-y-auto px-4 py-4",ref:j,children:(0,e.jsxs)("div",{className:"flex flex-col min-h-full justify-end",children:[t.length<5&&(0,e.jsxs)("div",{className:"py-12 flex flex-col items-center justify-center opacity-80 mb-auto",children:[(0,e.jsxs)(W,{className:"size-24 border-4 border-zinc-100 dark:border-zinc-800 mb-4 bg-zinc-50 dark:bg-zinc-900",children:[(0,e.jsx)(V,{src:v,className:"object-cover"}),(0,e.jsx)(J,{className:"text-4xl",children:n?.[0]})]}),(0,e.jsx)("h2",{className:"text-xl font-bold dark:text-white",children:n}),(0,e.jsx)("p",{className:"text-zinc-500 text-sm mb-4",children:s.isGroup?"Group chat on AntiGravity":"You're friends on AntiGravity"}),!s.isGroup&&(0,e.jsx)(Le,{variant:"outline",className:"rounded-full h-8 text-xs",children:"View Profile"})]}),I&&t.length===0?(0,e.jsx)("div",{className:"flex justify-center p-8",children:(0,e.jsx)(ne,{className:"animate-spin text-violet-500",size:32})}):(0,e.jsx)("div",{className:"space-y-[2px]",children:t.map((r,l)=>{const c=r.sender==="me",m=B(l,r),G=ce(l,r);return(0,e.jsx)(te.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},className:T("flex w-full",c?"justify-end":"justify-start",!G&&"mb-4"),children:(0,e.jsxs)("div",{className:T("flex max-w-[75%] md:max-w-[65%] items-end gap-2 group",c?"flex-row-reverse":"flex-row"),children:[!c&&(0,e.jsx)("div",{className:"w-7 shrink-0",children:G?null:(0,e.jsxs)(W,{className:"size-7 border border-zinc-100 shadow-sm dark:border-zinc-800",children:[(0,e.jsx)(V,{src:r.senderAvatar||v}),(0,e.jsx)(J,{children:(r.senderName||n)?.[0]})]})}),(0,e.jsxs)(Te,{children:[(0,e.jsx)(Oe,{children:(0,e.jsxs)("div",{className:T("relative px-4 py-2.5 shadow-sm text-[15px] leading-[1.4]",c?"bg-gradient-to-br from-violet-600 to-indigo-600 text-white":"bg-white text-zinc-900 dark:bg-zinc-800 dark:text-white border border-zinc-200/50 dark:border-zinc-700/50",!G&&!m&&"rounded-[22px]",c&&!G&&m&&"rounded-[22px] rounded-tr-md",c&&G&&!m&&"rounded-[22px] rounded-br-md",c&&G&&m&&"rounded-[22px] rounded-r-md",!c&&!G&&m&&"rounded-[22px] rounded-tl-md",!c&&G&&!m&&"rounded-[22px] rounded-bl-md",!c&&G&&m&&"rounded-[22px] rounded-l-md"),children:[r.replyToId&&(0,e.jsxs)("div",{className:T("mb-1.5 -mx-1 px-3 py-1.5 rounded-xl text-xs border-l-2 cursor-pointer",c?"bg-black/10 border-white/40 text-white/90":"bg-zinc-100 border-zinc-300 text-zinc-600 dark:bg-zinc-700 dark:border-zinc-500 dark:text-zinc-300"),onClick:H=>{H.stopPropagation();const Z=document.getElementById(`msg-${r.replyToId}`);Z&&Z.scrollIntoView({behavior:"smooth",block:"center"})},children:[(0,e.jsxs)("div",{className:"flex items-center gap-1.5 mb-0.5 opacity-75",children:[(0,e.jsx)(se,{size:10}),(0,e.jsx)("span",{className:"font-bold",children:"Reply"})]}),(0,e.jsx)("div",{className:"truncate opacity-90",children:F(r.replyToId)?.text||"Attachment"})]}),r.media?.length>0&&(0,e.jsx)("div",{className:"grid gap-1 mb-1 overflow-hidden rounded-lg",children:r.media.map((H,Z)=>(0,e.jsx)("img",{src:H.url,className:"max-h-64 object-cover w-full rounded-md cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>_(r)},Z))}),(0,e.jsx)("div",{className:"whitespace-pre-wrap break-words",children:(0,e.jsx)(Be,{options:{...Je,className:c?"text-white underline":"text-violet-600 dark:text-violet-400 underline"},children:r.text})}),(0,e.jsxs)("div",{className:T("flex justify-end items-center gap-1 mt-0.5 select-none",c?"text-white/70":"text-zinc-400"),children:[(0,e.jsx)("span",{className:"text-[9px] font-medium",children:r.time}),c&&r.id===q&&(r.isRead?(0,e.jsx)(ue,{size:12,className:"text-white"}):(0,e.jsx)(Ce,{size:12,className:"text-white/60"}))]})]})}),(0,e.jsxs)(Ue,{className:"w-48",children:[(0,e.jsxs)(K,{onClick:()=>{navigator.clipboard.writeText(r.text)},children:[(0,e.jsx)(Se,{size:14,className:"mr-2"})," Copy"]}),(0,e.jsxs)(K,{onClick:()=>w(r),children:[(0,e.jsx)(se,{size:14,className:"mr-2"})," Reply"]}),(0,e.jsx)(Me,{}),(0,e.jsxs)(K,{className:"text-red-500",onClick:()=>y&&y(r.id),children:[(0,e.jsx)(he,{size:14,className:"mr-2"})," Delete"]})]})]})]})},r.id)})}),C&&(0,e.jsx)("div",{className:"flex items-center gap-2 mt-2 ml-9",children:(0,e.jsx)("div",{className:"bg-zinc-100 dark:bg-zinc-800 px-4 py-2.5 rounded-[22px] rounded-tl-md",children:(0,e.jsx)(_e,{})})})]})}),(0,e.jsxs)("div",{className:"shrink-0 p-3 md:p-4 bg-white dark:bg-black border-t border-zinc-100 dark:border-zinc-800",children:[(0,e.jsx)(je,{children:x&&(0,e.jsxs)(te.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"flex items-center justify-between mb-2 px-4 py-2 bg-zinc-50 dark:bg-zinc-900 rounded-xl border border-zinc-100 dark:border-zinc-800",children:[(0,e.jsxs)("div",{className:"text-sm",children:[(0,e.jsxs)("span",{className:"text-xs font-bold text-violet-500 block mb-0.5",children:["Replying to ",x.sender==="me"?"yourself":x.senderName||n]}),(0,e.jsx)("p",{className:"line-clamp-1 text-zinc-500",children:x.text})]}),(0,e.jsx)("button",{onClick:()=>w(null),children:(0,e.jsx)(Q,{size:16,className:"text-zinc-400"})})]})}),f.length>0&&(0,e.jsx)("div",{className:"flex gap-2 mb-2 px-1",children:f.map(r=>(0,e.jsxs)("div",{className:"relative size-16 rounded-lg overflow-hidden border border-zinc-200",children:[(0,e.jsx)("img",{src:r.url,className:"size-full object-cover"}),(0,e.jsx)("button",{onClick:()=>D(r.url),className:"absolute top-0 right-0 bg-black/50 text-white p-0.5",children:(0,e.jsx)(Q,{size:12})})]},r.url))}),(0,e.jsxs)("div",{className:"flex items-end gap-2",children:[(0,e.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,e.jsx)("button",{className:"p-2 text-zinc-400 hover:text-violet-600 transition-colors rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-800",onClick:()=>u.current?.click(),children:(0,e.jsx)(me,{size:24})}),(0,e.jsx)("button",{className:"hidden sm:block p-2 text-zinc-400 hover:text-violet-600 transition-colors rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,e.jsx)(we,{size:22})})]}),(0,e.jsxs)("form",{className:"flex-1 flex items-center gap-2 bg-zinc-100 dark:bg-zinc-900 rounded-[24px] px-2 py-1.5 transition-all focus-within:ring-2 focus-within:ring-violet-500/20 focus-within:bg-white dark:focus-within:bg-zinc-900 overflow-hidden border border-transparent focus-within:border-violet-200 dark:focus-within:border-violet-900",onSubmit:Y,children:[(0,e.jsxs)(Ge,{open:O,onOpenChange:A,children:[(0,e.jsx)(qe,{asChild:!0,children:(0,e.jsx)("button",{type:"button",className:"p-2 text-zinc-400 hover:text-yellow-500 transition-colors",children:(0,e.jsx)(ve,{size:24})})}),(0,e.jsx)(Ae,{className:"w-full p-0 border-none bg-transparent shadow-none",side:"top",align:"start",children:(0,e.jsx)(Pe,{onEmojiSelect:L})})]}),(0,e.jsx)("textarea",{name:"chat-input",value:i,onChange:$,onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),Y())},onPaste:X,placeholder:"Message...",className:"flex-1 bg-transparent border-none outline-none text-[15px] resize-none max-h-32 py-2.5 min-h-[40px] text-zinc-900 dark:text-white placeholder:text-zinc-500",rows:1}),i.trim()||f.length>0?(0,e.jsx)("button",{type:"submit",className:"p-2 mr-1 rounded-full bg-violet-600 text-white hover:bg-violet-700 hover:scale-105 transition-all shadow-sm",children:(0,e.jsx)(ze,{size:18,className:"translate-x-0.5 translate-y-0.5"})}):(0,e.jsx)("button",{type:"button",className:"p-2 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,e.jsx)(ye,{size:22})})]}),(0,e.jsx)("input",{type:"file",ref:u,onChange:E,className:"hidden",multiple:!0,accept:"image/*"})]})]}),s.isGroup?(0,e.jsx)($e,{isOpen:S,onClose:()=>g(!1),conversation:s,onUpdate:r=>{g(!1)}}):(0,e.jsx)(De,{isOpen:S,onClose:()=>g(!1),user:s.user,conversationId:s.id})]})},Ke=He,Qe=le(),et=()=>{const s=(0,Qe.c)(29),{id:t,currentUser:a,onlineUsers:U,msgSearchQuery:y,setMsgSearchQuery:d,userSearchResults:I,filteredConversations:C,selectedConversation:z,localMessages:h,isConvLoading:N,isMsgLoading:i,currentIsTyping:k,otherUserIsOnline:R,handleStartConversation:p,handleSelectConversation:f,sendMessage:b,onDeleteMessage:O,sendTypingStatus:A,navigate:x}=Fe();if(!a){let n;s[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,e.jsx)("div",{className:"rounded-3xl bg-zinc-50 p-6 dark:bg-zinc-900",children:(0,e.jsx)(fe,{size:48,className:"text-zinc-300 dark:text-zinc-600"})}),s[0]=n):n=s[0];let v;return s[1]===Symbol.for("react.memo_cache_sentinel")?(v=(0,e.jsxs)("div",{className:"flex h-screen flex-col items-center justify-center gap-6 border-zinc-100 bg-white p-8 text-center dark:border-zinc-800 dark:bg-black md:rounded-2xl md:border",children:[n,(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)("h3",{className:"text-2xl font-black tracking-tight dark:text-white",children:"Sign in to message"}),(0,e.jsx)("p",{className:"max-w-xs text-zinc-500 font-medium",children:"Join the conversation. Sign up or log in to start chatting."})]})]}),s[1]=v):v=s[1],v}if(N){let n;return s[2]===Symbol.for("react.memo_cache_sentinel")?(n=(0,e.jsx)("div",{className:"flex h-screen items-center justify-center border-zinc-100 bg-white dark:border-zinc-800 dark:bg-black md:rounded-2xl md:border",children:(0,e.jsx)(ne,{className:"animate-spin text-violet-500",size:32})}),s[2]=n):n=s[2],n}const w=`flex ${t?"h-[100dvh]":"h-[calc(100dvh-4rem)]"} overflow-hidden bg-white shadow-2xl shadow-zinc-200/50 dark:border-zinc-800 dark:bg-black dark:shadow-none md:h-[calc(100vh-1.5rem)] md:rounded-3xl md:border md:border-zinc-200/50`,S=`flex-col md:flex md:w-[400px] ${z?"hidden":"flex"} h-full min-h-0 shrink-0 w-full bg-white dark:bg-black border-r border-zinc-100 dark:border-zinc-800 z-10`,g=t??null;let u;s[3]!==C||s[4]!==f||s[5]!==p||s[6]!==y||s[7]!==U||s[8]!==d||s[9]!==g||s[10]!==I?(u=(0,e.jsx)("div",{className:"flex-1 min-h-0 flex flex-col overflow-y-auto",children:(0,e.jsx)(Ze,{conversations:C,userResults:I,onSelect:f,onStartNew:p,selectedId:g,searchQuery:y,onSearchChange:d,onlineUsers:U})}),s[3]=C,s[4]=f,s[5]=p,s[6]=y,s[7]=U,s[8]=d,s[9]=g,s[10]=I,s[11]=u):u=s[11];let j;s[12]!==S||s[13]!==u?(j=(0,e.jsx)("div",{className:S,children:u}),s[12]=S,s[13]=u,s[14]=j):j=s[14];let o;s[15]!==k||s[16]!==i||s[17]!==h||s[18]!==x||s[19]!==O||s[20]!==R||s[21]!==z||s[22]!==b||s[23]!==A?(o=z?(0,e.jsx)(Ke,{conversation:z,messages:h,onBack:()=>x("/messages"),onSendMessage:b,onDeleteMessage:O,onTyping:n=>A(z.id,n),isLoading:i,isTyping:!!k,isOnline:!!R}):(0,e.jsxs)("div",{className:"hidden flex-1 flex-col items-center justify-center gap-6 text-zinc-500 md:flex bg-zinc-50/30 dark:bg-zinc-900/10",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute -inset-10 rounded-full bg-violet-500/5 blur-3xl dark:bg-violet-500/10"}),(0,e.jsx)("div",{className:"relative rounded-[2.5rem] bg-white p-10 shadow-xl shadow-zinc-200/50 dark:bg-zinc-900/50 dark:shadow-none ring-1 ring-zinc-100 dark:ring-zinc-800",children:(0,e.jsx)(ke,{size:80,className:"text-violet-500 stroke-[1.5]"})})]}),(0,e.jsxs)("div",{className:"text-center max-w-sm px-4 space-y-3",children:[(0,e.jsx)("h3",{className:"text-3xl font-black tracking-tighter text-zinc-900 dark:text-white",children:"Your Messages"}),(0,e.jsx)("p",{className:"text-zinc-500 font-medium text-lg",children:"Send private photos and messages to a friend or group."})]})]}),s[15]=k,s[16]=i,s[17]=h,s[18]=x,s[19]=O,s[20]=R,s[21]=z,s[22]=b,s[23]=A,s[24]=o):o=s[24];let M;return s[25]!==w||s[26]!==j||s[27]!==o?(M=(0,e.jsxs)("div",{className:w,children:[j,o]}),s[25]=w,s[26]=j,s[27]=o,s[28]=M):M=s[28],M},ct=et;export{ct as default};
