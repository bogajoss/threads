import{a as de}from"./rolldown-runtime-BaZ8gS7u.js";import{E as fe,S as ue,b as ee,c as X,x as oe}from"./framework-CsA6nn9m.js";import{a as te,n as ae,r as ie,t as Z}from"./query-QyXblnmD.js";import{$t as me,Ct as ge,Dt as he,Et as ye,Ft as pe,Gt as Pe,Ht as ve,It as we,Jt as _e,Lt as be,Mt as Me,Nt as Re,Ot as Se,Pt as $e,Qt as qe,Rt as Ce,St as Fe,Tt as ke,Ut as Le,Vt as Ne,Wt as Te,Yt as xe,_t as De,cn as I,en as Qe,gt as ne,ht as Ke,jt as Ee,kt as Ae,ln as U,on as re,qt as Oe,s as Be,tn as je,vt as Je,wt as ze,xt as He,yt as se,zt as Ve}from"./index-C4JMGnPL.js";var Ge=X(),C=de(fe(),1);const We=(e,i,s)=>{const t=(0,Ge.c)(16);let o,a;t[0]!==i||t[1]!==e?(o=["follows",i,e],a=h=>{const{pageParam:g}=h;return(i==="Followers"?qe:me)(e,g,10)},t[0]=i,t[1]=e,t[2]=o,t[3]=a):(o=t[2],a=t[3]);const n=!!e&&s;let y;t[4]!==o||t[5]!==a||t[6]!==n?(y={queryKey:o,queryFn:a,initialPageParam:null,getNextPageParam:Xe,enabled:n},t[4]=o,t[5]=a,t[6]=n,t[7]=y):y=t[7];const{data:m,fetchNextPage:f,hasNextPage:u,isFetchingNextPage:l,isLoading:v}=Z(y);let w;t[8]!==m?.pages?(w=m?.pages.flatMap(Ye)||[],t[8]=m?.pages,t[9]=w):w=t[9];const p=w;let r;return t[10]!==f||t[11]!==p||t[12]!==u||t[13]!==l||t[14]!==v?(r={followList:p,fetchNextPage:f,hasNextPage:u,isFetchingNextPage:l,isLoading:v},t[10]=f,t[11]=p,t[12]=u,t[13]=l,t[14]=v,t[15]=r):r=t[15],r};function Xe(e){if(!(!e||e.length<10))return e[e.length-1].followed_at}function Ye(e){return e}const Ze=(e,i)=>{const s=te(),{addToast:t}=ne(),o=(0,C.useCallback)((r=[],h=[])=>r.map(g=>({id:g.id,sender:g.sender_id===e?.id?"me":"them",senderAvatar:g.sender?.avatar,senderName:g.sender?.name,text:g.content,type:g.type||"text",media:g.media?Array.isArray(g.media)?g.media:[g.media]:[],isRead:g.is_read,replyToId:g.reply_to_id,reactions:h.filter(M=>M.message_id===g.id),time:new Date(g.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})),[e?.id]),{data:a,fetchNextPage:n,hasNextPage:y,isFetchingNextPage:m,isLoading:f,refetch:u}=Z({queryKey:["messages",i],queryFn:({pageParam:r})=>Ee(i,r,20),initialPageParam:null,getNextPageParam:r=>{if(!(!r||r.length<20))return r[r.length-1].created_at},enabled:!!i,refetchOnWindowFocus:!1}),{data:l=[]}=ie({queryKey:["reactions",i],queryFn:()=>Me(i),enabled:!!i,staleTime:1e3*60*5}),v=ae({mutationFn:({convId:r,text:h,type:g="text",media:M=[],replyToId:b=null})=>pe(r,e.id,h,g,M,b),onSuccess:r=>{r&&(s.invalidateQueries({queryKey:["messages",r.conversation_id]}),s.invalidateQueries({queryKey:["conversations",e.id]}))},onError:()=>{t("Failed to send message","error")}}),w=async(r,h)=>{if(e?.id)try{await we(r,e.id,h),s.invalidateQueries({queryKey:["reactions",i]})}catch(g){console.error("Failed to toggle reaction:",g),t("Failed to update reaction","error")}},p=async r=>{try{await Ae(r),s.invalidateQueries({queryKey:["messages",i]}),s.invalidateQueries({queryKey:["conversations",e?.id]})}catch(h){console.error("Failed to delete message:",h),t("Failed to delete message","error")}};return{messages:(0,C.useMemo)(()=>[...a?.pages.flatMap(r=>r)||[]].reverse(),[a]),isMsgLoading:f,refetchMessages:u,fetchNextMessages:n,hasMoreMessages:y,isFetchingMoreMessages:m,sendMessage:(r,h,g,M,b)=>v.mutate({convId:r,text:h,type:g,media:M,replyToId:b}),isSending:v.isPending,onToggleReaction:w,onDeleteMessage:p,conversationReactions:l,formatMessages:o}},Ie=(e,i)=>{const s=te(),[t,o]=(0,C.useState)({}),a=(0,C.useRef)(null),n=(0,C.useCallback)(async m=>{if(!(!e?.id||!m))try{await $e(m,e.id),s.invalidateQueries({queryKey:["unread_messages_count",e.id]}),s.invalidateQueries({queryKey:["conversations",e.id]})}catch(f){console.error("Failed to mark as read:",f)}},[e?.id,s]);return(0,C.useEffect)(()=>{if(!e?.id)return;const m=U.channel(`messages_realtime:${i||"global"}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},u=>{const l=u.new;i&&l.conversation_id===i&&(s.invalidateQueries({queryKey:["messages",i]}),l.sender_id!==e.id&&n(i)),s.invalidateQueries({queryKey:["conversations",e.id]}),l.sender_id!==e.id&&s.invalidateQueries({queryKey:["unread_messages_count",e.id]}),o(v=>({...v,[l.conversation_id]:!1}))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"messages"},()=>{s.invalidateQueries({queryKey:["messages"]}),s.invalidateQueries({queryKey:["conversations",e.id]})}).on("postgres_changes",{event:"*",schema:"public",table:"message_reactions"},()=>{i&&s.invalidateQueries({queryKey:["reactions",i]})}).subscribe(),f=U.channel("chat_typing_shared").on("broadcast",{event:"typing"},({payload:u})=>{const{conversationId:l,isTyping:v,userId:w}=u;w!==e.id&&o(p=>({...p,[l]:v}))}).subscribe();return a.current=f,()=>{U.removeChannel(m),U.removeChannel(f)}},[e?.id,s,i,n]),{typingStatus:t,sendTypingStatus:(m,f)=>{a.current&&e&&a.current.send({type:"broadcast",event:"typing",payload:{conversationId:m,isTyping:f,userId:e.id}})},markAsRead:n}};var Ue=X();const et=(e,i)=>{const s=(0,Ue.c)(20),{conversations:t,unreadCount:o,isConvLoading:a,refetchConversations:n}=Be(e),{messages:y,isMsgLoading:m,refetchMessages:f,fetchNextMessages:u,hasMoreMessages:l,isFetchingMoreMessages:v,sendMessage:w,isSending:p,onToggleReaction:r,onDeleteMessage:h,conversationReactions:g,formatMessages:M}=Ze(e,i),{typingStatus:b,sendTypingStatus:c,markAsRead:d}=Ie(e,i);let P;return s[0]!==g||s[1]!==t||s[2]!==u||s[3]!==M||s[4]!==l||s[5]!==a||s[6]!==v||s[7]!==m||s[8]!==p||s[9]!==d||s[10]!==y||s[11]!==h||s[12]!==r||s[13]!==n||s[14]!==f||s[15]!==w||s[16]!==c||s[17]!==b||s[18]!==o?(P={conversations:t,unreadCount:o,isConvLoading:a,refetchConversations:n,refetchMessages:f,sendMessage:w,sendTypingStatus:c,typingStatus:b,markAsRead:d,formatMessages:M,onToggleReaction:r,onDeleteMessage:h,conversationReactions:g,isSending:p,messages:y,isMsgLoading:m,fetchNextMessages:u,hasMoreMessages:l,isFetchingMoreMessages:v},s[0]=g,s[1]=t,s[2]=u,s[3]=M,s[4]=l,s[5]=a,s[6]=v,s[7]=m,s[8]=p,s[9]=d,s[10]=y,s[11]=h,s[12]=r,s[13]=n,s[14]=f,s[15]=w,s[16]=c,s[17]=b,s[18]=o,s[19]=P):P=s[19],P};var tt=X();const Ht=(e,i,s)=>{const t=(0,tt.c)(92),o=te(),{addToast:a}=ne();let n;t[0]!==i?(n=i||{comments:0,likes:0,mirrors:0,reposts:0},t[0]=i,t[1]=n):n=t[1];const[y,m]=(0,C.useState)(n);let f,u;t[2]!==i?(f=()=>{i&&m(D=>({...D,...i}))},u=[i],t[2]=i,t[3]=f,t[4]=u):(f=t[3],u=t[4]),(0,C.useEffect)(f,u);const l=s?.id;let v;t[5]!==e||t[6]!==l?(v=["post",e,"liked",l],t[5]=e,t[6]=l,t[7]=v):v=t[7];let w;t[8]!==s?.id||t[9]!==e?(w=()=>Ce(e,s?.id),t[8]=s?.id,t[9]=e,t[10]=w):w=t[10];let p;t[11]!==s||t[12]!==e?(p=!!s&&I(e)&&I(s.id),t[11]=s,t[12]=e,t[13]=p):p=t[13];let r;t[14]!==v||t[15]!==w||t[16]!==p?(r={queryKey:v,queryFn:w,enabled:p,staleTime:6e5},t[14]=v,t[15]=w,t[16]=p,t[17]=r):r=t[17];const{data:h}=ie(r),g=h===void 0?!1:h,M=s?.id;let b;t[18]!==e||t[19]!==M?(b=["post",e,"reposted",M],t[18]=e,t[19]=M,t[20]=b):b=t[20];let c;t[21]!==s?.id||t[22]!==e?(c=()=>Ve(e,s?.id),t[21]=s?.id,t[22]=e,t[23]=c):c=t[23];let d;t[24]!==s||t[25]!==e?(d=!!s&&I(e)&&I(s.id),t[24]=s,t[25]=e,t[26]=d):d=t[26];let P;t[27]!==b||t[28]!==c||t[29]!==d?(P={queryKey:b,queryFn:c,enabled:d,staleTime:6e5},t[27]=b,t[28]=c,t[29]=d,t[30]=P):P=t[30];const{data:_}=ie(P),R=_===void 0?!1:_;let S;t[31]!==s?.id||t[32]!==e?(S=()=>_e(e,s?.id),t[31]=s?.id,t[32]=e,t[33]=S):S=t[33];let T;t[34]!==s?.id||t[35]!==e||t[36]!==o?(T=async()=>{await o.cancelQueries({queryKey:["post",e,"liked",s?.id]});const D=o.getQueryData(["post",e,"liked",s?.id]);return o.setQueryData(["post",e,"liked",s?.id],!D),m(j=>({...j,likes:D?(j.likes||0)-1:(j.likes||0)+1})),{previousLiked:D}},t[34]=s?.id,t[35]=e,t[36]=o,t[37]=T):T=t[37];let N;t[38]!==a||t[39]!==s?.id||t[40]!==e||t[41]!==o?(N=(D,j,$)=>{$?.previousLiked!==void 0&&(o.setQueryData(["post",e,"liked",s?.id],$.previousLiked),m(J=>({...J,likes:$.previousLiked?(J.likes||0)+1:(J.likes||0)-1}))),a("Failed to update like","error")},t[38]=a,t[39]=s?.id,t[40]=e,t[41]=o,t[42]=N):N=t[42];let O;t[43]!==s?.id||t[44]!==e||t[45]!==o?(O=()=>{o.invalidateQueries({queryKey:["post",e,"liked",s?.id]})},t[43]=s?.id,t[44]=e,t[45]=o,t[46]=O):O=t[46];let F;t[47]!==S||t[48]!==T||t[49]!==N||t[50]!==O?(F={mutationFn:S,onMutate:T,onError:N,onSettled:O},t[47]=S,t[48]=T,t[49]=N,t[50]=O,t[51]=F):F=t[51];const E=ae(F);let x;t[52]!==s?.id||t[53]!==e?(x=()=>xe(e,s?.id),t[52]=s?.id,t[53]=e,t[54]=x):x=t[54];let q;t[55]!==s?.id||t[56]!==e||t[57]!==o?(q=async()=>{await o.cancelQueries({queryKey:["post",e,"reposted",s?.id]});const D=o.getQueryData(["post",e,"reposted",s?.id]);return o.setQueryData(["post",e,"reposted",s?.id],!D),m(j=>({...j,reposts:D?(j.reposts||0)-1:(j.reposts||0)+1,mirrors:D?(j.mirrors||0)-1:(j.mirrors||0)+1})),{previousReposted:D}},t[55]=s?.id,t[56]=e,t[57]=o,t[58]=q):q=t[58];let B;t[59]!==a||t[60]!==s?.id||t[61]!==e||t[62]!==o?(B=(D,j,$)=>{$?.previousReposted!==void 0&&(o.setQueryData(["post",e,"reposted",s?.id],$.previousReposted),m(J=>({...J,reposts:$.previousReposted?(J.reposts||0)+1:(J.reposts||0)-1,mirrors:$.previousReposted?(J.mirrors||0)+1:(J.mirrors||0)-1}))),a("Failed to update repost","error")},t[59]=a,t[60]=s?.id,t[61]=e,t[62]=o,t[63]=B):B=t[63];let k;t[64]!==s?.id||t[65]!==e||t[66]!==o?(k=()=>{o.invalidateQueries({queryKey:["post",e,"reposted",s?.id]})},t[64]=s?.id,t[65]=e,t[66]=o,t[67]=k):k=t[67];let Q;t[68]!==a?(Q=D=>{a(D?"Reposted!":"Removed repost")},t[68]=a,t[69]=Q):Q=t[69];let K;t[70]!==x||t[71]!==q||t[72]!==B||t[73]!==k||t[74]!==Q?(K={mutationFn:x,onMutate:q,onError:B,onSettled:k,onSuccess:Q},t[70]=x,t[71]=q,t[72]=B,t[73]=k,t[74]=Q,t[75]=K):K=t[75];const z=ae(K);let H;t[76]!==a||t[77]!==s||t[78]!==E||t[79]!==e?(H=async D=>{if(D&&D.stopPropagation(),!s)return a("Please login to like!","error");!I(e)||!I(s.id)||E.mutate()},t[76]=a,t[77]=s,t[78]=E,t[79]=e,t[80]=H):H=t[80];const A=H;let L;t[81]!==a||t[82]!==s||t[83]!==e||t[84]!==z?(L=async D=>{if(D&&D.stopPropagation(),!s)return a("Please login to repost!","error");!I(e)||!I(s.id)||z.mutate()},t[81]=a,t[82]=s,t[83]=e,t[84]=z,t[85]=L):L=t[85];const V=L;let G;return t[86]!==A||t[87]!==V||t[88]!==g||t[89]!==R||t[90]!==y?(G={liked:g,reposted:R,localStats:y,setLocalStats:m,handleLike:A,handleRepost:V},t[86]=A,t[87]=V,t[88]=g,t[89]=R,t[90]=y,t[91]=G):G=t[91],G};var st=X();const Vt=e=>{const i=(0,st.c)(5);let s;i[0]!==e?(s=()=>re(e),i[0]=e,i[1]=s):s=i[1];const[t,o]=(0,C.useState)(s);let a,n;return i[2]!==e?(a=()=>{if(!e)return;const y=setTimeout(()=>{o(re(e))},0),m=setInterval(()=>{o(re(e))},6e4);return()=>{clearTimeout(y),clearInterval(m)}},n=[e],i[2]=e,i[3]=a,i[4]=n):(a=i[3],n=i[4]),(0,C.useEffect)(a,n),t};var it=X();const Gt=()=>{const e=(0,it.c)(30),[i,s]=(0,C.useState)(!1),[t,o]=(0,C.useState)(!1),[a,n]=(0,C.useState)(0),[y,m]=(0,C.useState)(null),[f,u]=(0,C.useState)(null),l=(0,C.useRef)(null),v=(0,C.useRef)(null);let w;e[0]===Symbol.for("react.memo_cache_sentinel")?(w=[],e[0]=w):w=e[0];const p=(0,C.useRef)(w);let r,h;e[1]!==f?(r=()=>()=>{v.current&&clearInterval(v.current),l.current&&l.current.state!=="inactive"&&(l.current.stop(),l.current.stream.getTracks().forEach(nt)),f&&URL.revokeObjectURL(f)},h=[f],e[1]=f,e[2]=r,e[3]=h):(r=e[2],h=e[3]),(0,C.useEffect)(r,h);let g;e[4]===Symbol.for("react.memo_cache_sentinel")?(g=()=>{v.current=window.setInterval(()=>{n(at)},1e3)},e[4]=g):g=e[4];const M=g;let b;e[5]===Symbol.for("react.memo_cache_sentinel")?(b=()=>{v.current&&(clearInterval(v.current),v.current=null)},e[5]=b):b=e[5];const c=b;let d;e[6]===Symbol.for("react.memo_cache_sentinel")?(d=async()=>{try{const k=await navigator.mediaDevices.getUserMedia({audio:!0}),Q=new MediaRecorder(k);l.current=Q,p.current=[],Q.ondataavailable=K=>{K.data.size>0&&p.current.push(K.data)},Q.onstop=()=>{const K=new Blob(p.current,{type:"audio/webm;codecs=opus"}),z=URL.createObjectURL(K);m(K),u(z),k.getTracks().forEach(ot)},Q.start(),s(!0),o(!1),n(0),M()}catch(k){const Q=k;throw console.error("Error accessing microphone:",Q),Q}},e[6]=d):d=e[6];const P=d;let _;e[7]!==i?(_=()=>{l.current&&i&&(l.current.stop(),s(!1),o(!1),c())},e[7]=i,e[8]=_):_=e[8];const R=_;let S;e[9]!==t||e[10]!==i?(S=()=>{l.current&&i&&!t&&(l.current.pause(),o(!0),c())},e[9]=t,e[10]=i,e[11]=S):S=e[11];const T=S;let N;e[12]!==t||e[13]!==i?(N=()=>{l.current&&i&&t&&(l.current.resume(),o(!1),M())},e[12]=t,e[13]=i,e[14]=N):N=e[14];const O=N;let F;e[15]!==i?(F=()=>{l.current&&i&&(l.current.stop(),l.current.onstop=null,s(!1),o(!1),c(),n(0),l.current.stream&&l.current.stream.getTracks().forEach(rt))},e[15]=i,e[16]=F):F=e[16];const E=F;let x;e[17]!==f?(x=()=>{f&&URL.revokeObjectURL(f),m(null),u(null),n(0)},e[17]=f,e[18]=x):x=e[18];const q=x;let B;return e[19]!==y||e[20]!==f||e[21]!==E||e[22]!==q||e[23]!==t||e[24]!==i||e[25]!==T||e[26]!==a||e[27]!==O||e[28]!==R?(B={isRecording:i,isPaused:t,recordingTime:a,startRecording:P,stopRecording:R,pauseRecording:T,resumeRecording:O,cancelRecording:E,audioBlob:y,audioUrl:f,clearAudio:q},e[19]=y,e[20]=f,e[21]=E,e[22]=q,e[23]=t,e[24]=i,e[25]=T,e[26]=a,e[27]=O,e[28]=R,e[29]=B):B=e[29],B};function nt(e){return e.stop()}function at(e){return e+1}function ot(e){return e.stop()}function rt(e){return e.stop()}var lt=X();const Wt=(e,i,s)=>{const t=(0,lt.c)(31),o=te();let a,n;t[0]!==s||t[1]!==e?(a=["comments",e,s],n=_=>{const{pageParam:R}=_;return Ne(e,R,10,s)},t[0]=s,t[1]=e,t[2]=a,t[3]=n):(a=t[2],n=t[3]);let y;t[4]!==i?(y=i?{pages:[i],pageParams:[null]}:void 0,t[4]=i,t[5]=y):y=t[5];const m=!!e;let f;t[6]!==a||t[7]!==n||t[8]!==y||t[9]!==m?(f={queryKey:a,queryFn:n,initialPageParam:null,getNextPageParam:ct,initialData:y,enabled:m},t[6]=a,t[7]=n,t[8]=y,t[9]=m,t[10]=f):f=t[10];const{data:u,fetchNextPage:l,hasNextPage:v,isFetchingNextPage:w,isLoading:p,refetch:r}=Z(f);let h;t[11]!==u?.pages?(h=u?.pages.flatMap(ut)||[],t[11]=u?.pages,t[12]=h):h=t[12];const g=h;let M;t[13]!==e?(M=_=>{const{userId:R,content:S,media:T,replyToId:N}=_;return be(e,R,S,T,N)},t[13]=e,t[14]=M):M=t[14];let b;t[15]!==s||t[16]!==e||t[17]!==o?(b=()=>{o.invalidateQueries({queryKey:["comments",e]}),s&&o.invalidateQueries({queryKey:["comments",e,s]})},t[15]=s,t[16]=e,t[17]=o,t[18]=b):b=t[18];let c;t[19]!==M||t[20]!==b?(c={mutationFn:M,onSuccess:b},t[19]=M,t[20]=b,t[21]=c):c=t[21];const d=ae(c);let P;return t[22]!==d.isPending||t[23]!==d.mutateAsync||t[24]!==g||t[25]!==l||t[26]!==v||t[27]!==w||t[28]!==p||t[29]!==r?(P={comments:g,fetchNextPage:l,hasNextPage:v,isFetchingNextPage:w,isLoading:p,refetch:r,addComment:d.mutateAsync,isSubmitting:d.isPending},t[22]=d.isPending,t[23]=d.mutateAsync,t[24]=g,t[25]=l,t[26]=v,t[27]=w,t[28]=p,t[29]=r,t[30]=P):P=t[30],P};function ct(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function ut(e){return e}var dt=X();const Xt=()=>{const e=(0,dt.c)(53),{handle:i}=oe(),s=ee(),{currentUser:t}=se(),{addToast:o}=ne();let a,n;e[0]!==i?(a=["profile",i],n=()=>Qe(i),e[0]=i,e[1]=a,e[2]=n):(a=e[1],n=e[2]);const y=!!i;let m;e[3]!==a||e[4]!==n||e[5]!==y?(m={queryKey:a,queryFn:n,enabled:y,staleTime:3e5},e[3]=a,e[4]=n,e[5]=y,e[6]=m):m=e[6];const{data:f,isLoading:u}=ie(m),[l,v]=(0,C.useState)("feed"),w=f?.id;let p;e[7]!==w?(p=["posts","user",w],e[7]=w,e[8]=p):p=e[8];let r;e[9]!==f?.id?(r=$=>{const{pageParam:J}=$;return Te(f?.id,J,10)},e[9]=f?.id,e[10]=r):r=e[10];const h=!!f?.id;let g;e[11]!==p||e[12]!==r||e[13]!==h?(g={queryKey:p,queryFn:r,enabled:h,initialPageParam:null,getNextPageParam:ft},e[11]=p,e[12]=r,e[13]=h,e[14]=g):g=e[14];const{data:M,fetchNextPage:b,hasNextPage:c,isFetchingNextPage:d,isLoading:P}=Z(g);let _;e[15]!==M?.pages?(_=M?.pages.flatMap(mt)||[],e[15]=M?.pages,e[16]=_):_=e[16];const R=_,[S,T]=(0,C.useState)(!1),[N,O]=(0,C.useState)("Followers"),{followList:F,fetchNextPage:E,hasNextPage:x,isFetchingNextPage:q,isLoading:B}=We(f?.id,N,S);let k;e[17]===Symbol.for("react.memo_cache_sentinel")?(k=$=>{O($),T(!0)},e[17]=k):k=e[17];const Q=k;let K;e:{if(l==="feed"){let $;e[18]!==R?($=R.filter(gt),e[18]=R,e[19]=$):$=e[19],K=$;break e}if(l==="media"){let $;e[20]!==R?($=R.filter(ht),e[20]=R,e[21]=$):$=e[21],K=$;break e}if(l==="collections"){let $;e[22]===Symbol.for("react.memo_cache_sentinel")?($=[],e[22]=$):$=e[22],K=$;break e}K=R}const z=K;let H;e[23]!==s?(H=$=>{s(`/post/${$}`)},e[23]=s,e[24]=H):H=e[24];const A=H;let L;e[25]!==i||e[26]!==s?(L=$=>{$!==i&&s(`/u/${$}`)},e[25]=i,e[26]=s,e[27]=L):L=e[27];const V=L;let G;e[28]!==b?(G=$=>{b()},e[28]=b,e[29]=G):G=e[29];const D=G;let j;return e[30]!==l||e[31]!==o||e[32]!==t||e[33]!==E||e[34]!==z||e[35]!==F||e[36]!==N||e[37]!==i||e[38]!==A||e[39]!==V||e[40]!==x||e[41]!==c||e[42]!==q||e[43]!==d||e[44]!==S||e[45]!==B||e[46]!==D||e[47]!==P||e[48]!==u||e[49]!==s||e[50]!==f||e[51]!==R?(j={handle:i,profile:f,loading:u,userPosts:R,setUserPosts:yt,activeProfileTab:l,setActiveProfileTab:v,loadingPosts:P,isFetchingMorePosts:d,hasMorePosts:c,filteredPosts:z,isFollowModalOpen:S,setIsFollowModalOpen:T,followModalType:N,followListData:F,isListLoading:B,isFetchingMoreFollows:q,hasMoreFollows:x,openFollowModal:Q,fetchNextFollows:E,handlePostClick:A,handleUserClick:V,loadUserPosts:D,currentUser:t,addToast:o,navigate:s},e[30]=l,e[31]=o,e[32]=t,e[33]=E,e[34]=z,e[35]=F,e[36]=N,e[37]=i,e[38]=A,e[39]=V,e[40]=x,e[41]=c,e[42]=q,e[43]=d,e[44]=S,e[45]=B,e[46]=D,e[47]=P,e[48]=u,e[49]=s,e[50]=f,e[51]=R,e[52]=j):j=e[52],j};function ft(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function mt(e){return e}function gt(e){return e.community_id===null&&e.parent_id===null}function ht(e){return e.community_id===null&&e.parent_id===null&&(e.type==="video"||e.type==="image"||e.media&&e.media.length>0)}function yt(){return console.warn("setUserPosts is deprecated")}var pt=X();const Yt=()=>{const e=(0,pt.c)(75),{handle:i}=oe(),s=ee(),{currentUser:t}=se(),{addToast:o}=ne(),a=te();let n,y;e[0]!==i?(n=["community",i],y=()=>ge(i),e[0]=i,e[1]=n,e[2]=y):(n=e[1],y=e[2]);const m=!!i;let f;e[3]!==n||e[4]!==y||e[5]!==m?(f={queryKey:n,queryFn:y,enabled:m,staleTime:6e5},e[3]=n,e[4]=y,e[5]=m,e[6]=f):f=e[6];const{data:u,isLoading:l,refetch:v}=ie(f),w=u?.id,p=t?.id;let r;e[7]!==w||e[8]!==p?(r=["community",w,"membership",p],e[7]=w,e[8]=p,e[9]=r):r=e[9];let h;e[10]!==u?.id||e[11]!==t?.id?(h=()=>He(u?.id,t?.id),e[10]=u?.id,e[11]=t?.id,e[12]=h):h=e[12];const g=!!u?.id&&!!t?.id;let M;e[13]!==r||e[14]!==h||e[15]!==g?(M={queryKey:r,queryFn:h,enabled:g,staleTime:3e5},e[13]=r,e[14]=h,e[15]=g,e[16]=M):M=e[16];const{data:b}=ie(M),c=!!b,d=b?.role||null,P=u?.id;let _;e[17]!==P?(_=["posts","community",P],e[17]=P,e[18]=_):_=e[18];let R;e[19]!==u?.id?(R=j=>{const{pageParam:$}=j;return ze(u?.id,$,10)},e[19]=u?.id,e[20]=R):R=e[20];const S=!!u?.id;let T;e[21]!==_||e[22]!==R||e[23]!==S?(T={queryKey:_,queryFn:R,enabled:S,initialPageParam:null,getNextPageParam:Pt},e[21]=_,e[22]=R,e[23]=S,e[24]=T):T=e[24];const{data:N,fetchNextPage:O,hasNextPage:F,isFetchingNextPage:E,isLoading:x}=Z(T);let q;e[25]!==N?.pages?(q=N?.pages.flatMap(vt)||[],e[25]=N?.pages,e[26]=q):q=e[26];const B=q;let k;e[27]!==u?.id||e[28]!==t?.id?(k=()=>ke(u?.id,t?.id),e[27]=u?.id,e[28]=t?.id,e[29]=k):k=e[29];let Q;e[30]!==u?.id||e[31]!==t?.id||e[32]!==i||e[33]!==a?(Q=async()=>{await a.cancelQueries({queryKey:["community",u?.id,"membership",t?.id]}),await a.cancelQueries({queryKey:["community",i]});const j=a.getQueryData(["community",u?.id,"membership",t?.id]),$=a.getQueryData(["community",i]);return a.setQueryData(["community",u?.id,"membership",t?.id],j?null:{role:"member"}),a.setQueryData(["community",i],J=>J&&{...J,membersCount:j?J.membersCount-1:J.membersCount+1}),{previousMembership:j,previousCommunity:$}},e[30]=u?.id,e[31]=t?.id,e[32]=i,e[33]=a,e[34]=Q):Q=e[34];let K;e[35]!==o||e[36]!==u?.id||e[37]!==t?.id||e[38]!==i||e[39]!==a?(K=(j,$,J)=>{J?.previousMembership!==void 0&&a.setQueryData(["community",u?.id,"membership",t?.id],J.previousMembership),J?.previousCommunity&&a.setQueryData(["community",i],J.previousCommunity),o("Failed to update membership","error")},e[35]=o,e[36]=u?.id,e[37]=t?.id,e[38]=i,e[39]=a,e[40]=K):K=e[40];let z;e[41]!==u?.id||e[42]!==t?.id||e[43]!==i||e[44]!==a?(z=()=>{a.invalidateQueries({queryKey:["community",u?.id,"membership",t?.id]}),a.invalidateQueries({queryKey:["community",i]})},e[41]=u?.id,e[42]=t?.id,e[43]=i,e[44]=a,e[45]=z):z=e[45];let H;e[46]!==o||e[47]!==u?(H=j=>{u&&o(j?`Joined ${u.name}`:`Left ${u.name}`)},e[46]=o,e[47]=u,e[48]=H):H=e[48];let A;e[49]!==k||e[50]!==Q||e[51]!==K||e[52]!==z||e[53]!==H?(A={mutationFn:k,onMutate:Q,onError:K,onSettled:z,onSuccess:H},e[49]=k,e[50]=Q,e[51]=K,e[52]=z,e[53]=H,e[54]=A):A=e[54];const L=ae(A);let V;e[55]!==o||e[56]!==t||e[57]!==L?(V=async()=>{if(!t)return o("Please login to join communities","error");L.mutate()},e[55]=o,e[56]=t,e[57]=L,e[58]=V):V=e[58];const G=V;let D;return e[59]!==o||e[60]!==u||e[61]!==B||e[62]!==t||e[63]!==O||e[64]!==G||e[65]!==F||e[66]!==E||e[67]!==c||e[68]!==L.isPending||e[69]!==l||e[70]!==x||e[71]!==s||e[72]!==v||e[73]!==d?(D={community:u,loading:l,isMember:c,userRole:d,isJoining:L.isPending,communityPosts:B,loadingPosts:x,isFetchingMorePosts:E,hasMorePosts:F,handleJoinToggle:G,loadCommunityPosts:O,refetchCommunity:v,currentUser:t,addToast:o,navigate:s},e[59]=o,e[60]=u,e[61]=B,e[62]=t,e[63]=O,e[64]=G,e[65]=F,e[66]=E,e[67]=c,e[68]=L.isPending,e[69]=l,e[70]=x,e[71]=s,e[72]=v,e[73]=d,e[74]=D):D=e[74],D};function Pt(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function vt(e){return e}var wt=X();const Zt=()=>{const e=(0,wt.c)(48),{currentUser:i}=se(),s=ee(),[t,o]=ue();let a;e[0]!==t?(a=t.get("q")||"",e[0]=t,e[1]=a):a=e[1];const n=a;let y;e[2]!==t||e[3]!==n?(y=t.get("tab")||(n?"posts":"communities"),e[2]=t,e[3]=n,e[4]=y):y=e[4];const m=y,[f,u]=(0,C.useState)(!1);let l;e[5]===Symbol.for("react.memo_cache_sentinel")?(l=["explore","communities"],e[5]=l):l=e[5];let v;e[6]===Symbol.for("react.memo_cache_sentinel")?(v={queryKey:l,queryFn:_t,initialPageParam:null,getNextPageParam:bt},e[6]=v):v=e[6];const{data:w,fetchNextPage:p,hasNextPage:r,isFetchingNextPage:h,isLoading:g}=Z(v);let M;e[7]!==w?.pages?(M=w?.pages.flatMap(Mt)||[],e[7]=w?.pages,e[8]=M):M=e[8];const b=M;let c,d;e[9]!==n?(c=["explore","posts",n],d=A=>{const{pageParam:L}=A;return n?Oe(n,L,10,!0):ve(L,10)},e[9]=n,e[10]=c,e[11]=d):(c=e[10],d=e[11]);let P;e[12]!==c||e[13]!==d?(P={queryKey:c,queryFn:d,initialPageParam:null,getNextPageParam:Rt},e[12]=c,e[13]=d,e[14]=P):P=e[14];const{data:_,fetchNextPage:R,hasNextPage:S,isFetchingNextPage:T,isLoading:N}=Z(P);let O;e[15]!==_?.pages?(O=_?.pages.flatMap(St)||[],e[15]=_?.pages,e[16]=O):O=e[16];const F=O;let E=b;if(n){let A;if(e[17]!==E||e[18]!==n){let L;e[20]!==n?(L=V=>V.name?.toLowerCase().includes(n.toLowerCase())||V.handle?.toLowerCase().includes(n.toLowerCase()),e[20]=n,e[21]=L):L=e[21],A=E.filter(L),e[17]=E,e[18]=n,e[19]=A}else A=e[19];E=A}const x=E;let q;e[22]!==s?(q=A=>{s(`/c/${A}`)},e[22]=s,e[23]=q):q=e[23];const B=q;let k;e[24]!==o?(k=A=>{o(L=>(A?L.set("q",A):L.delete("q"),L),{replace:!0})},e[24]=o,e[25]=k):k=e[25];const Q=k;let K;e[26]!==o?(K=A=>{o(L=>(L.set("tab",A),L),{replace:!0})},e[26]=o,e[27]=K):K=e[27];const z=K;let H;return e[28]!==m||e[29]!==b||e[30]!==i||e[31]!==p||e[32]!==R||e[33]!==x||e[34]!==B||e[35]!==Q||e[36]!==z||e[37]!==r||e[38]!==S||e[39]!==g||e[40]!==f||e[41]!==h||e[42]!==T||e[43]!==N||e[44]!==s||e[45]!==F||e[46]!==n?(H={currentUser:i,searchQuery:n,setSearchQuery:Q,activeTab:m,setActiveTab:z,isCreateModalOpen:f,setIsCreateModalOpen:u,communitiesData:b,isCommunitiesLoading:g,isFetchingMoreCommunities:h,hasMoreCommunities:r,postsData:F,isPostsLoading:N,isFetchingMorePosts:T,hasMorePosts:S,filteredCommunities:x,handleCommunityClick:B,loadCommunities:p,loadPosts:R,navigate:s},e[28]=m,e[29]=b,e[30]=i,e[31]=p,e[32]=R,e[33]=x,e[34]=B,e[35]=Q,e[36]=z,e[37]=r,e[38]=S,e[39]=g,e[40]=f,e[41]=h,e[42]=T,e[43]=N,e[44]=s,e[45]=F,e[46]=n,e[47]=H):H=e[47],H};function _t(e){const{pageParam:i}=e;return Fe(i,10)}function bt(e){if(!(!e||e.length<10))return e[e.length-1].createdAt}function Mt(e){return e}function Rt(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function St(e){return e}var $t=X();const It=()=>{const e=(0,$t.c)(21),{currentUser:i}=se(),{posts:s,loading:t,hasMore:o,isFetchingNextPage:a,fetchNextPage:n,refreshPosts:y}=Ke(),{addToast:m}=ne(),f=ee();let u;e[0]===Symbol.for("react.memo_cache_sentinel")?(u=["stories"],e[0]=u):u=e[0];let l;e[1]===Symbol.for("react.memo_cache_sentinel")?(l={queryKey:u,queryFn:qt,initialPageParam:null,getNextPageParam:Ct,refetchInterval:6e4},e[1]=l):l=e[1];const{data:v,isLoading:w}=Z(l);let p;if(e[2]!==v?.pages){const d=v?.pages.flatMap(Ft)||[],P=JSON.parse(localStorage.getItem("seenStories")||"[]");p=d.reduce(kt,[]).map(_=>({..._,isSeen:P.includes(_.user.id)})),e[2]=v?.pages,e[3]=p}else p=e[3];const r=p;let h;e[4]!==f?(h=d=>{f(`/post/${d}`)},e[4]=f,e[5]=h):h=e[5];const g=h;let M;e[6]!==f?(M=d=>{f(`/u/${d}`)},e[6]=f,e[7]=M):M=e[7];const b=M;let c;return e[8]!==m||e[9]!==i||e[10]!==n||e[11]!==r||e[12]!==g||e[13]!==b||e[14]!==o||e[15]!==s||e[16]!==a||e[17]!==t||e[18]!==w||e[19]!==y?(c={currentUser:i,homePosts:s,groupedStories:r,isPostsLoading:t,isStoriesLoading:w,hasMore:o,isFetchingNextPage:a,fetchNextPage:n,refreshPosts:y,addToast:m,handlePostClick:g,handleUserClick:b},e[8]=m,e[9]=i,e[10]=n,e[11]=r,e[12]=g,e[13]=b,e[14]=o,e[15]=s,e[16]=a,e[17]=t,e[18]=w,e[19]=y,e[20]=c):c=e[20],c};function qt(e){const{pageParam:i}=e;return ye(i,10)}function Ct(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Ft(e){return e}function kt(e,i){const s=e.find(t=>t.user.id===i.user_id);return s?s.stories.push(i):e.push({user:i.user,stories:[i],isSeen:!1}),e}var Lt=X();const Ut=()=>{const e=(0,Lt.c)(60),{id:i}=oe(),s=ee(),{currentUser:t}=se(),{onlineUsers:o}=Je(),a=te(),[n,y]=(0,C.useState)("");let m;e[0]===Symbol.for("react.memo_cache_sentinel")?(m=[],e[0]=m):m=e[0];const[f,u]=(0,C.useState)(m),{conversations:l,isConvLoading:v,refetchConversations:w,refetchMessages:p,sendMessage:r,sendTypingStatus:h,onToggleReaction:g,typingStatus:M,markAsRead:b,formatMessages:c,onDeleteMessage:d,conversationReactions:P,messages:_,isMsgLoading:R,fetchNextMessages:S,hasMoreMessages:T,isFetchingMoreMessages:N}=et(t,i);let O;e:{if(!i||l.length===0){O=null;break e}let W;e[1]!==l||e[2]!==i?(W=l.find(Y=>Y.id===i)||null,e[1]=l,e[2]=i,e[3]=W):W=e[3],O=W}const F=O;let E,x;e[4]!==i||e[5]!==b?(E=()=>{i&&b(i)},x=[i,b],e[4]=i,e[5]=b,e[6]=E,e[7]=x):(E=e[6],x=e[7]),(0,C.useEffect)(E,x);let q;e[8]!==l||e[9]!==t?.id||e[10]!==n?(q=()=>{const W=setTimeout(async()=>{if(n.length>1){const Y=await je(n),le=l.map(Nt);u(Y.filter(ce=>ce.id!==t?.id&&!le.includes(ce.id)))}else u([])},300);return()=>clearTimeout(W)},e[8]=l,e[9]=t?.id,e[10]=n,e[11]=q):q=e[11];const B=t?.id;let k;e[12]!==l||e[13]!==n||e[14]!==B?(k=[n,l,B],e[12]=l,e[13]=n,e[14]=B,e[15]=k):k=e[15],(0,C.useEffect)(q,k);let Q;e[16]!==t||e[17]!==s||e[18]!==a?(Q=async W=>{if(t)try{const Y=await Re(t.id,W.id);a.invalidateQueries({queryKey:["conversations",t.id]}),y(""),s(`/messages/${Y}`)}catch(Y){console.error("Failed to start conversation:",Y)}},e[16]=t,e[17]=s,e[18]=a,e[19]=Q):Q=e[19];const K=Q;let z;e[20]!==s?(z=W=>{s(`/messages/${W.id}`)},e[20]=s,e[21]=z):z=e[21];const H=z;let A;e[22]!==P||e[23]!==c||e[24]!==_?(A=c(_,P),e[22]=P,e[23]=c,e[24]=_,e[25]=A):A=e[25];const L=A;let V;if(e[26]!==l||e[27]!==n){let W;e[29]!==n?(W=Y=>Y.user?.name?.toLowerCase().includes(n.toLowerCase())||Y.user?.handle?.toLowerCase().includes(n.toLowerCase())||Y.lastMessage?.toLowerCase().includes(n.toLowerCase()),e[29]=n,e[30]=W):W=e[30],V=l.filter(W),e[26]=l,e[27]=n,e[28]=V}else V=e[28];const G=V,D=F&&M[F.id];let j;e[31]!==o||e[32]!==F?(j=F&&F.user?.id&&o.has(F.user.id),e[31]=o,e[32]=F,e[33]=j):j=e[33];const $=j;let J;return e[34]!==l||e[35]!==D||e[36]!==t||e[37]!==S||e[38]!==G||e[39]!==H||e[40]!==K||e[41]!==T||e[42]!==i||e[43]!==v||e[44]!==N||e[45]!==R||e[46]!==L||e[47]!==n||e[48]!==s||e[49]!==d||e[50]!==g||e[51]!==o||e[52]!==$||e[53]!==w||e[54]!==p||e[55]!==F||e[56]!==r||e[57]!==h||e[58]!==f?(J={id:i,currentUser:t,onlineUsers:o,msgSearchQuery:n,setMsgSearchQuery:y,userSearchResults:f,conversations:l,filteredConversations:G,selectedConversation:F,localMessages:L,isConvLoading:v,isMsgLoading:R,currentIsTyping:D,otherUserIsOnline:$,handleStartConversation:K,handleSelectConversation:H,refetchConversations:w,refetchMessages:p,sendMessage:r,onDeleteMessage:d,sendTypingStatus:h,onToggleReaction:g,navigate:s,fetchNextMessages:S,hasMoreMessages:T,isFetchingMoreMessages:N},e[34]=l,e[35]=D,e[36]=t,e[37]=S,e[38]=G,e[39]=H,e[40]=K,e[41]=T,e[42]=i,e[43]=v,e[44]=N,e[45]=R,e[46]=L,e[47]=n,e[48]=s,e[49]=d,e[50]=g,e[51]=o,e[52]=$,e[53]=w,e[54]=p,e[55]=F,e[56]=r,e[57]=h,e[58]=f,e[59]=J):J=e[59],J};function Nt(e){return e.user?.id}var Tt=X();const es=()=>{const e=(0,Tt.c)(48),{currentUser:i}=se(),s=ee(),t=te(),o=i?.id;let a;e[0]!==o?(a=["notifications",o],e[0]=o,e[1]=a):a=e[1];let n;e[2]!==i?.id?(n=q=>{const{pageParam:B}=q;return he(i?.id,B,10)},e[2]=i?.id,e[3]=n):n=e[3];const y=!!i?.id;let m;e[4]!==a||e[5]!==n||e[6]!==y?(m={queryKey:a,queryFn:n,enabled:y,initialPageParam:null,getNextPageParam:xt},e[4]=a,e[5]=n,e[6]=y,e[7]=m):m=e[7];const{data:f,fetchNextPage:u,hasNextPage:l,isFetchingNextPage:v,isLoading:w,refetch:p}=Z(m);let r;e[8]!==f?.pages?(r=f?.pages.flatMap(Dt)||[],e[8]=f?.pages,e[9]=r):r=e[9];const h=r;let g;e[10]!==i||e[11]!==t?(g=()=>{if(!i?.id)return;const q=U.channel(`user_notifications:${i.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${i.id}`},()=>{t.invalidateQueries({queryKey:["notifications",i.id]})}).subscribe();return()=>{U.removeChannel(q)}},e[10]=i,e[11]=t,e[12]=g):g=e[12];const M=i?.id;let b;e[13]!==t||e[14]!==M?(b=[M,t],e[13]=t,e[14]=M,e[15]=b):b=e[15],(0,C.useEffect)(g,b);let c;e[16]!==i?(c=()=>i?Se(i.id):Promise.resolve(),e[16]=i,e[17]=c):c=e[17];let d,P,_;e[18]!==i?.id||e[19]!==t?(d=async()=>{await t.cancelQueries({queryKey:["notifications",i?.id]});const q=t.getQueryData(["notifications",i?.id]);return t.setQueryData(["notifications",i?.id],Et),{previousNotifications:q}},P=(q,B,k)=>{k?.previousNotifications&&t.setQueryData(["notifications",i?.id],k.previousNotifications)},_=()=>{t.invalidateQueries({queryKey:["notifications",i?.id]})},e[18]=i?.id,e[19]=t,e[20]=d,e[21]=P,e[22]=_):(d=e[20],P=e[21],_=e[22]);let R;e[23]!==d||e[24]!==P||e[25]!==_||e[26]!==c?(R={mutationFn:c,onMutate:d,onError:P,onSettled:_},e[23]=d,e[24]=P,e[25]=_,e[26]=c,e[27]=R):R=e[27];const S=ae(R);let T;e[28]!==s?(T=q=>{q.type==="follow"?s(`/u/${q.user}`):q.post_id&&s(`/post/${q.post_id}`)},e[28]=s,e[29]=T):T=e[29];const N=T;let O;e[30]!==i?.id||e[31]!==S||e[32]!==h?(O=()=>{i?.id&&h.some(At)&&S.mutate()},e[30]=i?.id,e[31]=S,e[32]=h,e[33]=O):O=e[33];const F=i?.id;let E;e[34]!==S||e[35]!==h.length||e[36]!==F?(E=[F,h.length,S],e[34]=S,e[35]=h.length,e[36]=F,e[37]=E):E=e[37],(0,C.useEffect)(O,E);let x;return e[38]!==i||e[39]!==u||e[40]!==N||e[41]!==l||e[42]!==v||e[43]!==w||e[44]!==s||e[45]!==h||e[46]!==p?(x={currentUser:i,notifications:h,isLoading:w,isFetchingMore:v,hasMore:l,loadNotifications:u,refreshNotifications:p,handleNotificationClick:N,navigate:s},e[38]=i,e[39]=u,e[40]=N,e[41]=l,e[42]=v,e[43]=w,e[44]=s,e[45]=h,e[46]=p,e[47]=x):x=e[47],x};function xt(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Dt(e){return e}function Qt(e){return{...e,is_read:!0}}function Kt(e){return e.map(Qt)}function Et(e){return e&&{...e,pages:e.pages.map(Kt)}}function At(e){return!e.is_read}var Ot=X();const ts=()=>{const e=(0,Ot.c)(23),{id:i}=oe(),s=ee(),{currentUser:t}=se(),{addToast:o}=ne(),a=te();let n,y;e[0]!==i?(n=["post",i],y=async()=>{if(!i||!I(i))throw new Error("Invalid post ID");return Le(i)},e[0]=i,e[1]=n,e[2]=y):(n=e[1],y=e[2]);const m=!!i;let f;e[3]!==n||e[4]!==y||e[5]!==m?(f={queryKey:n,queryFn:y,enabled:m,retry:!1},e[3]=n,e[4]=y,e[5]=m,e[6]=f):f=e[6];const{data:u,isLoading:l,isError:v}=ie(f);let w;e[7]!==s?(w=c=>{s(`/u/${c}`)},e[7]=s,e[8]=w):w=e[8];const p=w;let r;e[9]!==s?(r=()=>{s(-1)},e[9]=s,e[10]=r):r=e[10];const h=r;let g;e[11]!==a?(g=(c,d,P)=>{a.setQueryData(["post",c],_=>_&&{..._,content:d,media:P})},e[11]=a,e[12]=g):g=e[12];const M=g;let b;return e[13]!==o||e[14]!==t||e[15]!==h||e[16]!==M||e[17]!==p||e[18]!==v||e[19]!==l||e[20]!==s||e[21]!==u?(b={post:u,isLoading:l,isError:v,currentUser:t,addToast:o,navigate:s,handleUserClick:p,handleDelete:h,handleUpdate:M},e[13]=o,e[14]=t,e[15]=h,e[16]=M,e[17]=p,e[18]=v,e[19]=l,e[20]=s,e[21]=u,e[22]=b):b=e[22],b},ss=()=>{const e=ee(),{id:i}=oe(),[s]=ue(),t=i||s.get("id"),o=(0,C.useRef)(null),a=(0,C.useRef)(new Map),[n,y]=(0,C.useState)(null),[m,f]=(0,C.useState)(!0),{data:u,fetchNextPage:l,hasNextPage:v,isFetchingNextPage:w,isLoading:p}=Z({queryKey:["reels"],queryFn:({pageParam:c})=>Pe(c,10),initialPageParam:null,getNextPageParam:c=>{if(!(!c||c.length<10))return c[c.length-1].sort_timestamp||c[c.length-1].created_at}}),r=(0,C.useMemo)(()=>u?.pages.flatMap(c=>c)||[],[u]);(0,C.useEffect)(()=>{if(r.length>0)if(t)if(r.find(c=>c.id===t)){y(t);const c=a.current.get(t);c&&c.scrollIntoView({behavior:"instant"})}else n||y(r[0].id);else n||y(r[0].id)},[r,t,n]),(0,C.useEffect)(()=>{if(r.length===0)return;const c={root:o.current,threshold:.6},d=_=>{_.forEach(R=>{if(R.isIntersecting){const S=R.target.getAttribute("data-id");S&&y(S)}})},P=new IntersectionObserver(d,c);return a.current.forEach(_=>P.observe(_)),()=>P.disconnect()},[r.length]);const h=()=>{f(!m)};(0,C.useEffect)(()=>{const c=d=>{const P=d.target;if(!(P.tagName==="INPUT"||P.tagName==="TEXTAREA"||P.isContentEditable)&&!(d.ctrlKey||d.altKey||d.metaKey))switch(d.key){case"ArrowUp":d.preventDefault(),M();break;case"ArrowDown":d.preventDefault(),g();break;case"m":case"M":h();break;case" ":d.preventDefault();const _=a.current.get(n||"");if(_){const R=_.querySelector(".reel-item");R&&R.click()}break}};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[n,r,m]);const g=()=>{if(r.length===0)return;const c=r.findIndex(d=>d.id===n);if(c<r.length-1){const d=r[c+1];a.current.get(d.id)?.scrollIntoView({behavior:"smooth"})}},M=()=>{if(r.length===0)return;const c=r.findIndex(d=>d.id===n);if(c>0){const d=r[c-1];a.current.get(d.id)?.scrollIntoView({behavior:"smooth"})}},b=(c,d)=>{d?a.current.set(c,d):a.current.delete(c)};return(0,C.useEffect)(()=>{const c=()=>{if(!o.current||w||!v)return;const{scrollTop:P,scrollHeight:_,clientHeight:R}=o.current;P+R>=_-800&&l()},d=o.current;if(d)return d.addEventListener("scroll",c),()=>d.removeEventListener("scroll",c)},[w,v,l]),{reels:r,loading:p,loadingMore:w,activeReelId:n,hasMore:v,isMuted:m,containerRef:o,setReelRef:b,navigate:e,toggleMute:h,scrollToNext:g,scrollToPrev:M,loadReels:l}},is=()=>{const{currentUser:e,logout:i}=se(),{darkMode:s,toggleDarkMode:t,fontSize:o,setFontSize:a,dataSaver:n,setDataSaver:y}=De(),{addToast:m}=ne(),[f,u]=(0,C.useState)(!1),[l,v]=(0,C.useState)({newPassword:"",confirmPassword:""}),[w,p]=(0,C.useState)(!1),r=async()=>{try{await i(),m("Logged out successfully")}catch(P){console.error("Logout error:",P),m("Failed to logout")}};return{currentUser:e,darkMode:s,toggleDarkMode:t,fontSize:o,setFontSize:a,dataSaver:n,setDataSaver:y,isChangingPassword:f,setIsChangingPassword:u,passwordData:l,setPasswordData:v,loading:w,handleLogout:r,handlePasswordChange:async P=>{if(P.preventDefault(),l.newPassword!==l.confirmPassword){m("Passwords do not match","error");return}if(l.newPassword.length<6){m("Password must be at least 6 characters","error");return}p(!0);try{const{error:_}=await U.auth.updateUser({password:l.newPassword});if(_)throw _;m("Password updated successfully!"),u(!1),v({newPassword:"",confirmPassword:""})}catch(_){console.error("Password update error:",_),m(_.message||"Failed to update password","error")}finally{p(!1)}},handlePasswordReset:async()=>{if(e?.email){p(!0);try{const{error:P}=await U.auth.resetPasswordForEmail(e.email,{redirectTo:`${window.location.origin}/settings?type=recovery`});if(P)throw P;m("Password reset email sent!")}catch(P){console.error("Reset password error:",P),m(P.message||"Failed to send reset email","error")}finally{p(!1)}}},handleClearCache:()=>{["seenStories","font-size","data-saver","theme"].forEach(P=>localStorage.removeItem(P)),m("Cache cleared! Reloading..."),setTimeout(()=>window.location.reload(),1500)},handleDownloadData:async()=>{if(e){p(!0);try{const P={user:{id:e.id,handle:e.handle,name:e.name,email:e.email},exportDate:new Date().toISOString(),note:"This is a mock export of your Sysm data."},_=new Blob([JSON.stringify(P,null,2)],{type:"application/json"}),R=URL.createObjectURL(_),S=document.createElement("a");S.href=R,S.download=`sysm-data-${e.handle}.json`,S.click(),URL.revokeObjectURL(R),m("Data export started!")}catch{m("Failed to export data","error")}finally{p(!1)}}},handleDeleteAccount:()=>{window.confirm("Are you absolutely sure? This will permanently delete your account and all associated data. This action is irreversible.")&&(m("Account deletion request submitted. Logging out..."),setTimeout(r,2e3))},handleReportBug:()=>{window.prompt("Please describe the bug you found:")&&m("Bug reported! Thank you for your feedback.")}}};export{Ut as a,Yt as c,Gt as d,Vt as f,es as i,Xt as l,ss as n,It as o,Ht as p,ts as r,Zt as s,is as t,Wt as u};
