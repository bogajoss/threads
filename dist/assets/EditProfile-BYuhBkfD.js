import{a as _}from"./rolldown-runtime-BaZ8gS7u.js";import{l as O,v as M,w as T}from"./framework-3lkjbTvb.js";import"./database-COznt_u0.js";import{En as B,Hn as G,Ln as q,Pt as J,ar as $,en as H,lr as L,xn as K}from"./ui-libs-oBja7Jpd.js";import"./media-libs-C98UjHPF.js";import{In as Q,Pn as I,a as V,dn as X,in as Y,ln as Z,nn as ee,rn as te,vt as C}from"./index-ZH7yetGe.js";import{t as re}from"./useAutoResizeTextArea-Cy81bKnl.js";import{t as se}from"./CircularProgress-D6LSDhdS.js";var s=_(T(),1),e=_(O(),1),ae=()=>{const d=M(),{currentUser:a,updateProfile:E}=X(),{addToast:h}=Z(),i=a?.id?`edit-profile-draft:${a.id}`:null,[u,P]=(0,s.useState)(!1),[r,f]=(0,s.useState)(a||{}),[m,R]=(0,s.useState)(null),[l,z]=(0,s.useState)(null),g=(0,s.useRef)(null),S=(0,s.useRef)(null),v=(0,s.useRef)(!1),j=(0,s.useRef)(!1),D=re(r?.bio||"",80,300),p=(0,s.useMemo)(()=>l?URL.createObjectURL(l):null,[l]),b=(0,s.useMemo)(()=>m?URL.createObjectURL(m):null,[m]);(0,s.useEffect)(()=>()=>{p&&URL.revokeObjectURL(p)},[p]),(0,s.useEffect)(()=>()=>{b&&URL.revokeObjectURL(b)},[b]);const x=t=>{j.current=!0,f(t)};(0,s.useEffect)(()=>{if(!(!a||v.current)){if(i){const t=sessionStorage.getItem(i);if(t)try{const o=JSON.parse(t);f({...a,...o}),j.current=!0}catch(o){console.error("Failed to restore edit profile draft",o),sessionStorage.removeItem(i),f(a)}else f(a)}else f(a);v.current=!0}},[a,i]),(0,s.useEffect)(()=>{if(!i||!v.current)return;const t={name:r?.name||"",bio:r?.bio||"",location:r?.location||"",website:r?.website||""};if(!t.name?.trim()&&!t.bio?.trim()&&!t.location?.trim()&&!t.website?.trim()){sessionStorage.removeItem(i);return}sessionStorage.setItem(i,JSON.stringify(t))},[i,r?.bio,r?.location,r?.name,r?.website]);const U=(t,o)=>{const n=t.target.files?.[0];if(n){if(n.type==="image/gif"&&!a?.isPro){h("GIF profile pictures are only available for PRO users!","error");return}o==="avatar"?R(n):z(n)}},W=async()=>{P(!0);try{let t=r.avatar,o=r.cover;m&&(t=(await I(m)).url),l&&(o=(await I(l)).url);const w=(y=>{if(!y)return y;const c=y.trim();if(!c)return c;try{const k=new URL(/^https?:\/\//i.test(c)?c:`https://${c}`);return k.hostname.replace(/^www\./i,"")+(k.pathname==="/"?"":k.pathname)}catch{return c.replace(/^https?:\/\//i,"").replace(/^www\./i,"")}})(r?.website),N={name:r.name,bio:r.bio,location:r.location,website:w};t&&t!=="/default-avatar.webp"&&(N.avatar=t),o&&o!=="/welcome-banner.webp"&&(N.cover=o),await E(N),i&&sessionStorage.removeItem(i),j.current=!1,R(null),z(null),h("Profile updated!"),d(-1)}catch(t){console.error("Failed to update profile:",t),h("Failed to update profile.","error")}finally{P(!1)}},F=(t=>(t||"").trim().split(/\s+/).filter(Boolean).length)(r?.bio),A=F>=50;return(0,s.useEffect)(()=>{a||d("/login")},[a,d]),a?(0,e.jsx)(V,{children:(0,e.jsxs)("div",{className:"flex min-h-screen flex-col bg-muted/30 md:rounded-2xl md:border md:border-border",children:[(0,e.jsxs)("div",{className:"sticky top-0 z-20 flex items-center justify-between border-b border-border bg-background/80 px-6 py-4 backdrop-blur-xl",children:[(0,e.jsxs)("div",{className:"flex items-center gap-4",children:[(0,e.jsx)("button",{onClick:()=>d(-1),className:"flex size-9 items-center justify-center rounded-full transition-all active:scale-90 active:bg-accent",children:(0,e.jsx)($,{size:24,strokeWidth:2.5,className:"text-foreground"})}),(0,e.jsx)("h2",{className:"text-[20px] font-black tracking-tight text-foreground",children:"Edit Profile"})]}),(0,e.jsx)("button",{onClick:W,disabled:u,className:Q("text-[16px] font-bold text-primary transition-all active:scale-95 disabled:opacity-50",u&&"animate-pulse"),children:u?"Saving...":"Done"})]}),(0,e.jsxs)("div",{className:"mx-auto w-full max-w-2xl space-y-8 p-4 pb-32",children:[(0,e.jsx)("input",{type:"file",ref:S,className:"hidden",accept:"image/*",onChange:t=>U(t,"cover")}),(0,e.jsx)("input",{type:"file",ref:g,className:"hidden",accept:"image/*",onChange:t=>U(t,"avatar")}),(0,e.jsxs)("section",{className:"space-y-2",children:[(0,e.jsx)("h3",{className:"px-4 text-[12px] font-bold uppercase tracking-widest text-muted-foreground",children:"Profile Media"}),(0,e.jsxs)("div",{className:"overflow-hidden rounded-[20px] border border-border bg-card shadow-sm",children:[(0,e.jsxs)("div",{className:"group relative h-44 cursor-pointer overflow-hidden bg-muted/50 transition-colors hover:bg-muted",onClick:()=>S.current?.click(),children:[(l||r?.cover)&&(0,e.jsx)("img",{src:p??r.cover,className:"h-full w-full object-cover transition-opacity group-hover:opacity-90",alt:""}),(0,e.jsx)("div",{className:"absolute bottom-3 right-3 z-10",children:(0,e.jsx)("div",{className:"rounded-full bg-black/20 p-2 text-white/90 backdrop-blur-md transition-all active:scale-90 active:bg-black/40 shadow-sm border border-white/10",children:(0,e.jsx)(L,{size:18,strokeWidth:2})})})]}),(0,e.jsxs)("div",{className:"flex items-center gap-4 border-t border-border p-4",children:[(0,e.jsxs)("div",{className:"group relative size-20 shrink-0 cursor-pointer overflow-hidden rounded-full ring-2 ring-background shadow-md",onClick:()=>g.current?.click(),children:[(0,e.jsxs)(ee,{className:"size-full rounded-none",children:[(0,e.jsx)(Y,{src:b??r.avatar,className:"object-cover transition-opacity group-hover:opacity-80"}),(0,e.jsx)(te,{className:"bg-muted text-xl font-bold text-muted-foreground",children:r?.handle?.[0]?.toUpperCase()})]}),(0,e.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 opacity-0 transition-opacity group-hover:opacity-100",children:(0,e.jsx)(L,{size:18,className:"text-white"})})]}),(0,e.jsxs)("div",{className:"flex-1",children:[(0,e.jsx)("h4",{className:"text-[15px] font-bold text-foreground",children:"Profile Picture"}),(0,e.jsx)("p",{className:"text-[12px] font-medium text-muted-foreground",children:"GIFs enabled for PRO users"}),(0,e.jsx)("button",{onClick:()=>g.current?.click(),className:"mt-1 text-[13px] font-bold text-primary active:opacity-60",children:"Change Photo"})]})]})]})]}),(0,e.jsxs)("section",{className:"space-y-2",children:[(0,e.jsx)("h3",{className:"px-4 text-[12px] font-bold uppercase tracking-widest text-muted-foreground",children:"Personal Information"}),(0,e.jsxs)("div",{className:"divide-y divide-border overflow-hidden rounded-[20px] border border-border bg-card shadow-sm",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-1 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,e.jsx)(J,{size:14,strokeWidth:2.5,className:"text-muted-foreground/70"}),(0,e.jsx)("label",{className:"text-[11px] font-bold uppercase tracking-widest",children:"Name"})]}),(0,e.jsx)(C,{value:r?.name||"",className:"h-auto border-none bg-transparent p-0 text-[16px] font-medium text-foreground shadow-none focus-visible:ring-0",onChange:t=>x({...r,name:t.target.value})})]}),(0,e.jsxs)("div",{className:"flex flex-col gap-1 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,e.jsx)(G,{size:14,strokeWidth:2.5,className:"text-muted-foreground/70"}),(0,e.jsx)("label",{className:"text-[11px] font-bold uppercase tracking-widest",children:"Bio"})]}),(0,e.jsx)(se,{current:F,max:60,size:16,strokeWidth:3,isWarning:A})]}),(0,e.jsx)("textarea",{ref:D,value:r?.bio||"",className:"min-h-[60px] max-h-[400px] w-full resize-none border-none bg-transparent p-0 text-[16px] font-medium text-foreground outline-none shadow-none focus-visible:ring-0",placeholder:"Bio...",onChange:t=>{const o=t.target.value,n=o.trim().split(/\s+/).filter(Boolean);if(n.length>60){const w=n.slice(0,60).join(" ");x({...r,bio:w})}else x({...r,bio:o})}})]})]})]}),(0,e.jsxs)("section",{className:"space-y-2",children:[(0,e.jsx)("h3",{className:"px-4 text-[12px] font-bold uppercase tracking-widest text-muted-foreground",children:"Public Details"}),(0,e.jsxs)("div",{className:"divide-y divide-border overflow-hidden rounded-[20px] border border-border bg-card shadow-sm",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-1 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,e.jsx)(K,{size:14,strokeWidth:2.5,className:"text-muted-foreground/70"}),(0,e.jsx)("label",{className:"text-[11px] font-bold uppercase tracking-widest",children:"Location"})]}),(0,e.jsx)(C,{placeholder:"Based in...",value:r?.location||"",className:"h-auto border-none bg-transparent p-0 text-[16px] font-medium text-foreground shadow-none focus-visible:ring-0",onChange:t=>x({...r,location:t.target.value})})]}),(0,e.jsxs)("div",{className:"flex flex-col gap-1 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,e.jsx)(q,{size:14,strokeWidth:2.5,className:"text-muted-foreground/70"}),(0,e.jsx)("label",{className:"text-[11px] font-bold uppercase tracking-widest",children:"Website"})]}),(0,e.jsx)(C,{placeholder:"yoursite.com",value:r?.website||"",className:"h-auto border-none bg-transparent p-0 text-[16px] font-medium text-foreground shadow-none focus-visible:ring-0",onChange:t=>x({...r,website:t.target.value})})]})]})]}),(0,e.jsxs)("div",{className:"flex flex-col gap-3 pt-4",children:[(0,e.jsx)("button",{onClick:W,disabled:u,className:"flex h-14 w-full items-center justify-center gap-2 rounded-2xl bg-primary font-bold text-primary-foreground shadow-lg shadow-primary/20 transition-all active:scale-[0.98] disabled:opacity-50",children:u?(0,e.jsx)(B,{size:20,className:"animate-spin"}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(H,{size:20}),"Save Changes"]})}),(0,e.jsx)("button",{onClick:()=>d(-1),className:"flex h-14 w-full items-center justify-center font-bold text-muted-foreground transition-all active:scale-95 active:text-foreground",children:"Discard Changes"})]}),(0,e.jsx)("div",{className:"pt-10 text-center",children:(0,e.jsx)("p",{className:"text-[12px] font-bold text-muted-foreground/60 uppercase tracking-widest",children:"MySys Profile Management"})})]})]})}):null},xe=ae;export{xe as default};
