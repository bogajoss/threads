import{a as le}from"./rolldown-runtime-BaZ8gS7u.js";import{E as ce,S as re,b as Z,c as W,x as se}from"./framework-CsA6nn9m.js";import{a as ee,n as te,r as I,t as Y}from"./query-QyXblnmD.js";import{At as ue,Bt as fe,Ct as me,Dt as de,Et as ge,Ht as he,It as pe,Jt as ye,Lt as Pe,Mt as _e,Nt as ve,Ot as be,Pt as we,Rt as $e,St as Se,Tt as Ce,Ut as Me,Wt as Re,Xt as Le,Yt as Fe,_t as qe,gt as ie,ht as Ne,in as ne,qt as ke,rn as X,s as xe,tn as oe,vt as De,wt as Qe,xt as Te,yt as U,zt as Ee}from"./index-BMiJjDLa.js";var Ke=W();const Ae=(e,i,n)=>{const s=(0,Ke.c)(16);let t,o;s[0]!==i||s[1]!==e?(t=["follows",i,e],o=_=>{const{pageParam:v}=_;return(i==="Followers"?ke:ye)(e,v,10)},s[0]=i,s[1]=e,s[2]=t,s[3]=o):(t=s[2],o=s[3]);const a=!!e&&n;let d;s[4]!==t||s[5]!==o||s[6]!==a?(d={queryKey:t,queryFn:o,initialPageParam:null,getNextPageParam:Oe,enabled:a},s[4]=t,s[5]=o,s[6]=a,s[7]=d):d=s[7];const{data:c,fetchNextPage:u,hasNextPage:l,isFetchingNextPage:r,isLoading:S}=Y(d);let p;s[8]!==c?.pages?(p=c?.pages.flatMap(Be)||[],s[8]=c?.pages,s[9]=p):p=s[9];const g=p;let f;return s[10]!==u||s[11]!==g||s[12]!==l||s[13]!==r||s[14]!==S?(f={followList:g,fetchNextPage:u,hasNextPage:l,isFetchingNextPage:r,isLoading:S},s[10]=u,s[11]=g,s[12]=l,s[13]=r,s[14]=S,s[15]=f):f=s[15],f};function Oe(e){if(!(!e||e.length<10))return e[e.length-1].followed_at}function Be(e){return e}var je=W(),O=le(ce(),1);const Qt=(e,i,n,s)=>{const t=(0,je.c)(92),o=ee();let a;t[0]!==i?(a=i||{comments:0,likes:0,mirrors:0,reposts:0},t[0]=i,t[1]=a):a=t[1];const[d,c]=(0,O.useState)(a);let u,l;t[2]!==i?(u=()=>{i&&c(E=>({...E,...i}))},l=[i],t[2]=i,t[3]=u,t[4]=l):(u=t[3],l=t[4]),(0,O.useEffect)(u,l);const r=n?.id;let S;t[5]!==e||t[6]!==r?(S=["post",e,"liked",r],t[5]=e,t[6]=r,t[7]=S):S=t[7];let p;t[8]!==n?.id||t[9]!==e?(p=()=>ve(e,n?.id),t[8]=n?.id,t[9]=e,t[10]=p):p=t[10];let g;t[11]!==n||t[12]!==e?(g=!!n&&X(e)&&X(n.id),t[11]=n,t[12]=e,t[13]=g):g=t[13];let f;t[14]!==S||t[15]!==p||t[16]!==g?(f={queryKey:S,queryFn:p,enabled:g,staleTime:6e5},t[14]=S,t[15]=p,t[16]=g,t[17]=f):f=t[17];const{data:_}=I(f),v=_===void 0?!1:_,b=n?.id;let y;t[18]!==e||t[19]!==b?(y=["post",e,"reposted",b],t[18]=e,t[19]=b,t[20]=y):y=t[20];let P;t[21]!==n?.id||t[22]!==e?(P=()=>we(e,n?.id),t[21]=n?.id,t[22]=e,t[23]=P):P=t[23];let m;t[24]!==n||t[25]!==e?(m=!!n&&X(e)&&X(n.id),t[24]=n,t[25]=e,t[26]=m):m=t[26];let h;t[27]!==y||t[28]!==P||t[29]!==m?(h={queryKey:y,queryFn:P,enabled:m,staleTime:6e5},t[27]=y,t[28]=P,t[29]=m,t[30]=h):h=t[30];const{data:w}=I(h),$=w===void 0?!1:w;let L;t[31]!==n?.id||t[32]!==e?(L=()=>Me(e,n?.id),t[31]=n?.id,t[32]=e,t[33]=L):L=t[33];let F;t[34]!==n?.id||t[35]!==e||t[36]!==o?(F=async()=>{await o.cancelQueries({queryKey:["post",e,"liked",n?.id]});const E=o.getQueryData(["post",e,"liked",n?.id]);return o.setQueryData(["post",e,"liked",n?.id],!E),c(N=>({...N,likes:E?(N.likes||0)-1:(N.likes||0)+1})),{previousLiked:E}},t[34]=n?.id,t[35]=e,t[36]=o,t[37]=F):F=t[37];let k;t[38]!==n?.id||t[39]!==e||t[40]!==o||t[41]!==s?(k=(E,N,C)=>{C?.previousLiked!==void 0&&(o.setQueryData(["post",e,"liked",n?.id],C.previousLiked),c(H=>({...H,likes:C.previousLiked?(H.likes||0)+1:(H.likes||0)-1}))),s("Failed to update like","error")},t[38]=n?.id,t[39]=e,t[40]=o,t[41]=s,t[42]=k):k=t[42];let D;t[43]!==n?.id||t[44]!==e||t[45]!==o?(D=()=>{o.invalidateQueries({queryKey:["post",e,"liked",n?.id]})},t[43]=n?.id,t[44]=e,t[45]=o,t[46]=D):D=t[46];let K;t[47]!==L||t[48]!==F||t[49]!==k||t[50]!==D?(K={mutationFn:L,onMutate:F,onError:k,onSettled:D},t[47]=L,t[48]=F,t[49]=k,t[50]=D,t[51]=K):K=t[51];const Q=te(K);let R;t[52]!==n?.id||t[53]!==e?(R=()=>Re(e,n?.id),t[52]=n?.id,t[53]=e,t[54]=R):R=t[54];let x;t[55]!==n?.id||t[56]!==e||t[57]!==o?(x=async()=>{await o.cancelQueries({queryKey:["post",e,"reposted",n?.id]});const E=o.getQueryData(["post",e,"reposted",n?.id]);return o.setQueryData(["post",e,"reposted",n?.id],!E),c(N=>({...N,reposts:E?(N.reposts||0)-1:(N.reposts||0)+1,mirrors:E?(N.mirrors||0)-1:(N.mirrors||0)+1})),{previousReposted:E}},t[55]=n?.id,t[56]=e,t[57]=o,t[58]=x):x=t[58];let M;t[59]!==n?.id||t[60]!==e||t[61]!==o||t[62]!==s?(M=(E,N,C)=>{C?.previousReposted!==void 0&&(o.setQueryData(["post",e,"reposted",n?.id],C.previousReposted),c(H=>({...H,reposts:C.previousReposted?(H.reposts||0)+1:(H.reposts||0)-1,mirrors:C.previousReposted?(H.mirrors||0)+1:(H.mirrors||0)-1}))),s("Failed to update repost","error")},t[59]=n?.id,t[60]=e,t[61]=o,t[62]=s,t[63]=M):M=t[63];let q;t[64]!==n?.id||t[65]!==e||t[66]!==o?(q=()=>{o.invalidateQueries({queryKey:["post",e,"reposted",n?.id]})},t[64]=n?.id,t[65]=e,t[66]=o,t[67]=q):q=t[67];let B;t[68]!==s?(B=E=>{s(E?"Reposted!":"Removed repost")},t[68]=s,t[69]=B):B=t[69];let A;t[70]!==R||t[71]!==x||t[72]!==M||t[73]!==q||t[74]!==B?(A={mutationFn:R,onMutate:x,onError:M,onSettled:q,onSuccess:B},t[70]=R,t[71]=x,t[72]=M,t[73]=q,t[74]=B,t[75]=A):A=t[75];const z=te(A);let J;t[76]!==n||t[77]!==Q||t[78]!==e||t[79]!==s?(J=async E=>{if(E&&E.stopPropagation(),!n)return s("Please login to like!","error");!X(e)||!X(n.id)||Q.mutate()},t[76]=n,t[77]=Q,t[78]=e,t[79]=s,t[80]=J):J=t[80];const j=J;let T;t[81]!==n||t[82]!==e||t[83]!==z||t[84]!==s?(T=async E=>{if(E&&E.stopPropagation(),!n)return s("Please login to repost!","error");!X(e)||!X(n.id)||z.mutate()},t[81]=n,t[82]=e,t[83]=z,t[84]=s,t[85]=T):T=t[85];const V=T;let G;return t[86]!==j||t[87]!==V||t[88]!==v||t[89]!==$||t[90]!==d?(G={liked:v,reposted:$,localStats:d,setLocalStats:c,handleLike:j,handleRepost:V},t[86]=j,t[87]=V,t[88]=v,t[89]=$,t[90]=d,t[91]=G):G=t[91],G};var Je=W();const Tt=e=>{const i=(0,Je.c)(5);let n;i[0]!==e?(n=()=>oe(e),i[0]=e,i[1]=n):n=i[1];const[s,t]=(0,O.useState)(n);let o,a;return i[2]!==e?(o=()=>{if(!e)return;const d=setTimeout(()=>{t(oe(e))},0),c=setInterval(()=>{t(oe(e))},6e4);return()=>{clearTimeout(d),clearInterval(c)}},a=[e],i[2]=e,i[3]=o,i[4]=a):(o=i[3],a=i[4]),(0,O.useEffect)(o,a),s};var ze=W();const Et=()=>{const e=(0,ze.c)(27),[i,n]=(0,O.useState)(!1),[s,t]=(0,O.useState)(!1),[o,a]=(0,O.useState)(0),[d,c]=(0,O.useState)(null),[u,l]=(0,O.useState)(null),r=(0,O.useRef)(null),S=(0,O.useRef)(null);let p;e[0]===Symbol.for("react.memo_cache_sentinel")?(p=[],e[0]=p):p=e[0];const g=(0,O.useRef)(p);let f;e[1]===Symbol.for("react.memo_cache_sentinel")?(f=()=>{S.current=window.setInterval(()=>{a(He)},1e3)},e[1]=f):f=e[1];const _=f;let v;e[2]===Symbol.for("react.memo_cache_sentinel")?(v=()=>{S.current&&(clearInterval(S.current),S.current=null)},e[2]=v):v=e[2];const b=v;let y;e[3]===Symbol.for("react.memo_cache_sentinel")?(y=async()=>{try{const x=await navigator.mediaDevices.getUserMedia({audio:!0}),M=new MediaRecorder(x);r.current=M,g.current=[],M.ondataavailable=q=>{q.data.size>0&&g.current.push(q.data)},M.onstop=()=>{const q=new Blob(g.current,{type:"audio/webm;codecs=opus"}),B=URL.createObjectURL(q);c(q),l(B),x.getTracks().forEach(Ve)},M.start(),n(!0),t(!1),a(0),_()}catch(x){const M=x;throw console.error("Error accessing microphone:",M),M}},e[3]=y):y=e[3];const P=y;let m;e[4]!==i?(m=()=>{r.current&&i&&(r.current.stop(),n(!1),t(!1),b())},e[4]=i,e[5]=m):m=e[5];const h=m;let w;e[6]!==s||e[7]!==i?(w=()=>{r.current&&i&&!s&&(r.current.pause(),t(!0),b())},e[6]=s,e[7]=i,e[8]=w):w=e[8];const $=w;let L;e[9]!==s||e[10]!==i?(L=()=>{r.current&&i&&s&&(r.current.resume(),t(!1),_())},e[9]=s,e[10]=i,e[11]=L):L=e[11];const F=L;let k;e[12]!==i?(k=()=>{r.current&&i&&(r.current.stop(),r.current.onstop=null,n(!1),t(!1),b(),a(0),r.current.stream&&r.current.stream.getTracks().forEach(Ge))},e[12]=i,e[13]=k):k=e[13];const D=k;let K;e[14]!==u?(K=()=>{u&&URL.revokeObjectURL(u),c(null),l(null),a(0)},e[14]=u,e[15]=K):K=e[15];const Q=K;let R;return e[16]!==d||e[17]!==u||e[18]!==D||e[19]!==Q||e[20]!==s||e[21]!==i||e[22]!==$||e[23]!==o||e[24]!==F||e[25]!==h?(R={isRecording:i,isPaused:s,recordingTime:o,startRecording:P,stopRecording:h,pauseRecording:$,resumeRecording:F,cancelRecording:D,audioBlob:d,audioUrl:u,clearAudio:Q},e[16]=d,e[17]=u,e[18]=D,e[19]=Q,e[20]=s,e[21]=i,e[22]=$,e[23]=o,e[24]=F,e[25]=h,e[26]=R):R=e[26],R};function He(e){return e+1}function Ve(e){return e.stop()}function Ge(e){return e.stop()}var We=W();const Kt=(e,i,n)=>{const s=(0,We.c)(31),t=ee();let o,a;s[0]!==n||s[1]!==e?(o=["comments",e,n],a=w=>{const{pageParam:$}=w;return pe(e,$,10,n)},s[0]=n,s[1]=e,s[2]=o,s[3]=a):(o=s[2],a=s[3]);let d;s[4]!==i?(d=i?{pages:[i],pageParams:[null]}:void 0,s[4]=i,s[5]=d):d=s[5];const c=!!e;let u;s[6]!==o||s[7]!==a||s[8]!==d||s[9]!==c?(u={queryKey:o,queryFn:a,initialPageParam:null,getNextPageParam:Xe,initialData:d,enabled:c},s[6]=o,s[7]=a,s[8]=d,s[9]=c,s[10]=u):u=s[10];const{data:l,fetchNextPage:r,hasNextPage:S,isFetchingNextPage:p,isLoading:g,refetch:f}=Y(u);let _;s[11]!==l?.pages?(_=l?.pages.flatMap(Ye)||[],s[11]=l?.pages,s[12]=_):_=s[12];const v=_;let b;s[13]!==e?(b=w=>{const{userId:$,content:L,media:F,replyToId:k}=w;return _e(e,$,L,F,k)},s[13]=e,s[14]=b):b=s[14];let y;s[15]!==n||s[16]!==e||s[17]!==t?(y=()=>{t.invalidateQueries({queryKey:["comments",e]}),n&&t.invalidateQueries({queryKey:["comments",e,n]})},s[15]=n,s[16]=e,s[17]=t,s[18]=y):y=s[18];let P;s[19]!==b||s[20]!==y?(P={mutationFn:b,onSuccess:y},s[19]=b,s[20]=y,s[21]=P):P=s[21];const m=te(P);let h;return s[22]!==m.isPending||s[23]!==m.mutateAsync||s[24]!==v||s[25]!==r||s[26]!==S||s[27]!==p||s[28]!==g||s[29]!==f?(h={comments:v,fetchNextPage:r,hasNextPage:S,isFetchingNextPage:p,isLoading:g,refetch:f,addComment:m.mutateAsync,isSubmitting:m.isPending},s[22]=m.isPending,s[23]=m.mutateAsync,s[24]=v,s[25]=r,s[26]=S,s[27]=p,s[28]=g,s[29]=f,s[30]=h):h=s[30],h};function Xe(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Ye(e){return e}var Ze=W();const At=()=>{const e=(0,Ze.c)(53),{handle:i}=se(),n=Z(),{currentUser:s}=U(),{addToast:t}=ie();let o,a;e[0]!==i?(o=["profile",i],a=()=>Fe(i),e[0]=i,e[1]=o,e[2]=a):(o=e[1],a=e[2]);const d=!!i;let c;e[3]!==o||e[4]!==a||e[5]!==d?(c={queryKey:o,queryFn:a,enabled:d,staleTime:3e5},e[3]=o,e[4]=a,e[5]=d,e[6]=c):c=e[6];const{data:u,isLoading:l}=I(c),[r,S]=(0,O.useState)("feed"),p=u?.id;let g;e[7]!==p?(g=["posts","user",p],e[7]=p,e[8]=g):g=e[8];let f;e[9]!==u?.id?(f=C=>{const{pageParam:H}=C;return Ee(u?.id,H,10)},e[9]=u?.id,e[10]=f):f=e[10];const _=!!u?.id;let v;e[11]!==g||e[12]!==f||e[13]!==_?(v={queryKey:g,queryFn:f,enabled:_,initialPageParam:null,getNextPageParam:Ue},e[11]=g,e[12]=f,e[13]=_,e[14]=v):v=e[14];const{data:b,fetchNextPage:y,hasNextPage:P,isFetchingNextPage:m,isLoading:h}=Y(v);let w;e[15]!==b?.pages?(w=b?.pages.flatMap(Ie)||[],e[15]=b?.pages,e[16]=w):w=e[16];const $=w,[L,F]=(0,O.useState)(!1),[k,D]=(0,O.useState)("Followers"),{followList:K,fetchNextPage:Q,hasNextPage:R,isFetchingNextPage:x,isLoading:M}=Ae(u?.id,k,L);let q;e[17]===Symbol.for("react.memo_cache_sentinel")?(q=C=>{D(C),F(!0)},e[17]=q):q=e[17];const B=q;let A;e:{if(r==="feed"){let C;e[18]!==$?(C=$.filter(et),e[18]=$,e[19]=C):C=e[19],A=C;break e}if(r==="media"){let C;e[20]!==$?(C=$.filter(tt),e[20]=$,e[21]=C):C=e[21],A=C;break e}if(r==="collections"){let C;e[22]===Symbol.for("react.memo_cache_sentinel")?(C=[],e[22]=C):C=e[22],A=C;break e}A=$}const z=A;let J;e[23]!==n?(J=C=>{n(`/post/${C}`)},e[23]=n,e[24]=J):J=e[24];const j=J;let T;e[25]!==i||e[26]!==n?(T=C=>{C!==i&&n(`/u/${C}`)},e[25]=i,e[26]=n,e[27]=T):T=e[27];const V=T;let G;e[28]!==y?(G=C=>{y()},e[28]=y,e[29]=G):G=e[29];const E=G;let N;return e[30]!==r||e[31]!==t||e[32]!==s||e[33]!==Q||e[34]!==z||e[35]!==K||e[36]!==k||e[37]!==i||e[38]!==j||e[39]!==V||e[40]!==R||e[41]!==P||e[42]!==x||e[43]!==m||e[44]!==L||e[45]!==M||e[46]!==E||e[47]!==h||e[48]!==l||e[49]!==n||e[50]!==u||e[51]!==$?(N={handle:i,profile:u,loading:l,userPosts:$,setUserPosts:st,activeProfileTab:r,setActiveProfileTab:S,loadingPosts:h,isFetchingMorePosts:m,hasMorePosts:P,filteredPosts:z,isFollowModalOpen:L,setIsFollowModalOpen:F,followModalType:k,followListData:K,isListLoading:M,isFetchingMoreFollows:x,hasMoreFollows:R,openFollowModal:B,fetchNextFollows:Q,handlePostClick:j,handleUserClick:V,loadUserPosts:E,currentUser:s,addToast:t,navigate:n},e[30]=r,e[31]=t,e[32]=s,e[33]=Q,e[34]=z,e[35]=K,e[36]=k,e[37]=i,e[38]=j,e[39]=V,e[40]=R,e[41]=P,e[42]=x,e[43]=m,e[44]=L,e[45]=M,e[46]=E,e[47]=h,e[48]=l,e[49]=n,e[50]=u,e[51]=$,e[52]=N):N=e[52],N};function Ue(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function Ie(e){return e}function et(e){return e.community_id===null&&e.parent_id===null}function tt(e){return e.community_id===null&&e.parent_id===null&&(e.type==="video"||e.type==="image"||e.media&&e.media.length>0)}function st(){return console.warn("setUserPosts is deprecated")}var it=W();const Ot=()=>{const e=(0,it.c)(75),{handle:i}=se(),n=Z(),{currentUser:s}=U(),{addToast:t}=ie(),o=ee();let a,d;e[0]!==i?(a=["community",i],d=()=>me(i),e[0]=i,e[1]=a,e[2]=d):(a=e[1],d=e[2]);const c=!!i;let u;e[3]!==a||e[4]!==d||e[5]!==c?(u={queryKey:a,queryFn:d,enabled:c,staleTime:6e5},e[3]=a,e[4]=d,e[5]=c,e[6]=u):u=e[6];const{data:l,isLoading:r,refetch:S}=I(u),p=l?.id,g=s?.id;let f;e[7]!==p||e[8]!==g?(f=["community",p,"membership",g],e[7]=p,e[8]=g,e[9]=f):f=e[9];let _;e[10]!==l?.id||e[11]!==s?.id?(_=()=>Te(l?.id,s?.id),e[10]=l?.id,e[11]=s?.id,e[12]=_):_=e[12];const v=!!l?.id&&!!s?.id;let b;e[13]!==f||e[14]!==_||e[15]!==v?(b={queryKey:f,queryFn:_,enabled:v,staleTime:3e5},e[13]=f,e[14]=_,e[15]=v,e[16]=b):b=e[16];const{data:y}=I(b),P=!!y,m=y?.role||null,h=l?.id;let w;e[17]!==h?(w=["posts","community",h],e[17]=h,e[18]=w):w=e[18];let $;e[19]!==l?.id?($=N=>{const{pageParam:C}=N;return Qe(l?.id,C,10)},e[19]=l?.id,e[20]=$):$=e[20];const L=!!l?.id;let F;e[21]!==w||e[22]!==$||e[23]!==L?(F={queryKey:w,queryFn:$,enabled:L,initialPageParam:null,getNextPageParam:nt},e[21]=w,e[22]=$,e[23]=L,e[24]=F):F=e[24];const{data:k,fetchNextPage:D,hasNextPage:K,isFetchingNextPage:Q,isLoading:R}=Y(F);let x;e[25]!==k?.pages?(x=k?.pages.flatMap(ot)||[],e[25]=k?.pages,e[26]=x):x=e[26];const M=x;let q;e[27]!==l?.id||e[28]!==s?.id?(q=()=>Ce(l?.id,s?.id),e[27]=l?.id,e[28]=s?.id,e[29]=q):q=e[29];let B;e[30]!==l?.id||e[31]!==s?.id||e[32]!==i||e[33]!==o?(B=async()=>{await o.cancelQueries({queryKey:["community",l?.id,"membership",s?.id]}),await o.cancelQueries({queryKey:["community",i]});const N=o.getQueryData(["community",l?.id,"membership",s?.id]),C=o.getQueryData(["community",i]);return o.setQueryData(["community",l?.id,"membership",s?.id],N?null:{role:"member"}),o.setQueryData(["community",i],H=>H&&{...H,membersCount:N?H.membersCount-1:H.membersCount+1}),{previousMembership:N,previousCommunity:C}},e[30]=l?.id,e[31]=s?.id,e[32]=i,e[33]=o,e[34]=B):B=e[34];let A;e[35]!==t||e[36]!==l?.id||e[37]!==s?.id||e[38]!==i||e[39]!==o?(A=(N,C,H)=>{H?.previousMembership!==void 0&&o.setQueryData(["community",l?.id,"membership",s?.id],H.previousMembership),H?.previousCommunity&&o.setQueryData(["community",i],H.previousCommunity),t("Failed to update membership","error")},e[35]=t,e[36]=l?.id,e[37]=s?.id,e[38]=i,e[39]=o,e[40]=A):A=e[40];let z;e[41]!==l?.id||e[42]!==s?.id||e[43]!==i||e[44]!==o?(z=()=>{o.invalidateQueries({queryKey:["community",l?.id,"membership",s?.id]}),o.invalidateQueries({queryKey:["community",i]})},e[41]=l?.id,e[42]=s?.id,e[43]=i,e[44]=o,e[45]=z):z=e[45];let J;e[46]!==t||e[47]!==l?(J=N=>{l&&t(N?`Joined ${l.name}`:`Left ${l.name}`)},e[46]=t,e[47]=l,e[48]=J):J=e[48];let j;e[49]!==q||e[50]!==B||e[51]!==A||e[52]!==z||e[53]!==J?(j={mutationFn:q,onMutate:B,onError:A,onSettled:z,onSuccess:J},e[49]=q,e[50]=B,e[51]=A,e[52]=z,e[53]=J,e[54]=j):j=e[54];const T=te(j);let V;e[55]!==t||e[56]!==s||e[57]!==T?(V=async()=>{if(!s)return t("Please login to join communities","error");T.mutate()},e[55]=t,e[56]=s,e[57]=T,e[58]=V):V=e[58];const G=V;let E;return e[59]!==t||e[60]!==l||e[61]!==M||e[62]!==s||e[63]!==D||e[64]!==G||e[65]!==K||e[66]!==Q||e[67]!==P||e[68]!==T.isPending||e[69]!==r||e[70]!==R||e[71]!==n||e[72]!==S||e[73]!==m?(E={community:l,loading:r,isMember:P,userRole:m,isJoining:T.isPending,communityPosts:M,loadingPosts:R,isFetchingMorePosts:Q,hasMorePosts:K,handleJoinToggle:G,loadCommunityPosts:D,refetchCommunity:S,currentUser:s,addToast:t,navigate:n},e[59]=t,e[60]=l,e[61]=M,e[62]=s,e[63]=D,e[64]=G,e[65]=K,e[66]=Q,e[67]=P,e[68]=T.isPending,e[69]=r,e[70]=R,e[71]=n,e[72]=S,e[73]=m,e[74]=E):E=e[74],E};function nt(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function ot(e){return e}var at=W();const Bt=()=>{const e=(0,at.c)(48),{currentUser:i}=U(),n=Z(),[s,t]=re();let o;e[0]!==s?(o=s.get("q")||"",e[0]=s,e[1]=o):o=e[1];const a=o;let d;e[2]!==s||e[3]!==a?(d=s.get("tab")||(a?"posts":"communities"),e[2]=s,e[3]=a,e[4]=d):d=e[4];const c=d,[u,l]=(0,O.useState)(!1);let r;e[5]===Symbol.for("react.memo_cache_sentinel")?(r=["explore","communities"],e[5]=r):r=e[5];let S;e[6]===Symbol.for("react.memo_cache_sentinel")?(S={queryKey:r,queryFn:rt,initialPageParam:null,getNextPageParam:lt},e[6]=S):S=e[6];const{data:p,fetchNextPage:g,hasNextPage:f,isFetchingNextPage:_,isLoading:v}=Y(S);let b;e[7]!==p?.pages?(b=p?.pages.flatMap(ct)||[],e[7]=p?.pages,e[8]=b):b=e[8];const y=b;let P,m;e[9]!==a?(P=["explore","posts",a],m=j=>{const{pageParam:T}=j;return a?he(a,T,10,!0):Pe(T,10)},e[9]=a,e[10]=P,e[11]=m):(P=e[10],m=e[11]);let h;e[12]!==P||e[13]!==m?(h={queryKey:P,queryFn:m,initialPageParam:null,getNextPageParam:ut},e[12]=P,e[13]=m,e[14]=h):h=e[14];const{data:w,fetchNextPage:$,hasNextPage:L,isFetchingNextPage:F,isLoading:k}=Y(h);let D;e[15]!==w?.pages?(D=w?.pages.flatMap(ft)||[],e[15]=w?.pages,e[16]=D):D=e[16];const K=D;let Q=y;if(a){let j;if(e[17]!==Q||e[18]!==a){let T;e[20]!==a?(T=V=>V.name?.toLowerCase().includes(a.toLowerCase())||V.handle?.toLowerCase().includes(a.toLowerCase()),e[20]=a,e[21]=T):T=e[21],j=Q.filter(T),e[17]=Q,e[18]=a,e[19]=j}else j=e[19];Q=j}const R=Q;let x;e[22]!==n?(x=j=>{n(`/c/${j}`)},e[22]=n,e[23]=x):x=e[23];const M=x;let q;e[24]!==t?(q=j=>{t(T=>(j?T.set("q",j):T.delete("q"),T),{replace:!0})},e[24]=t,e[25]=q):q=e[25];const B=q;let A;e[26]!==t?(A=j=>{t(T=>(T.set("tab",j),T),{replace:!0})},e[26]=t,e[27]=A):A=e[27];const z=A;let J;return e[28]!==c||e[29]!==y||e[30]!==i||e[31]!==g||e[32]!==$||e[33]!==R||e[34]!==M||e[35]!==B||e[36]!==z||e[37]!==f||e[38]!==L||e[39]!==v||e[40]!==u||e[41]!==_||e[42]!==F||e[43]!==k||e[44]!==n||e[45]!==K||e[46]!==a?(J={currentUser:i,searchQuery:a,setSearchQuery:B,activeTab:c,setActiveTab:z,isCreateModalOpen:u,setIsCreateModalOpen:l,communitiesData:y,isCommunitiesLoading:v,isFetchingMoreCommunities:_,hasMoreCommunities:f,postsData:K,isPostsLoading:k,isFetchingMorePosts:F,hasMorePosts:L,filteredCommunities:R,handleCommunityClick:M,loadCommunities:g,loadPosts:$,navigate:n},e[28]=c,e[29]=y,e[30]=i,e[31]=g,e[32]=$,e[33]=R,e[34]=M,e[35]=B,e[36]=z,e[37]=f,e[38]=L,e[39]=v,e[40]=u,e[41]=_,e[42]=F,e[43]=k,e[44]=n,e[45]=K,e[46]=a,e[47]=J):J=e[47],J};function rt(e){const{pageParam:i}=e;return Se(i,10)}function lt(e){if(!(!e||e.length<10))return e[e.length-1].createdAt}function ct(e){return e}function ut(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].sortTimestamp}function ft(e){return e}var mt=W();const jt=()=>{const e=(0,mt.c)(20),{currentUser:i}=U(),{posts:n,loading:s,hasMore:t,isFetchingNextPage:o,fetchNextPage:a}=Ne(),{addToast:d}=ie(),c=Z();let u;e[0]===Symbol.for("react.memo_cache_sentinel")?(u=["stories"],e[0]=u):u=e[0];let l;e[1]===Symbol.for("react.memo_cache_sentinel")?(l={queryKey:u,queryFn:dt,initialPageParam:null,getNextPageParam:gt,refetchInterval:6e4},e[1]=l):l=e[1];const{data:r,isLoading:S}=Y(l);let p;if(e[2]!==r?.pages){const P=r?.pages.flatMap(ht)||[],m=JSON.parse(localStorage.getItem("seenStories")||"[]");p=P.reduce(pt,[]).map(h=>({...h,isSeen:m.includes(h.user.id)})),e[2]=r?.pages,e[3]=p}else p=e[3];const g=p;let f;e[4]!==c?(f=P=>{c(`/post/${P}`)},e[4]=c,e[5]=f):f=e[5];const _=f;let v;e[6]!==c?(v=P=>{c(`/u/${P}`)},e[6]=c,e[7]=v):v=e[7];const b=v;let y;return e[8]!==d||e[9]!==i||e[10]!==a||e[11]!==g||e[12]!==_||e[13]!==b||e[14]!==t||e[15]!==n||e[16]!==o||e[17]!==s||e[18]!==S?(y={currentUser:i,homePosts:n,groupedStories:g,isPostsLoading:s,isStoriesLoading:S,hasMore:t,isFetchingNextPage:o,fetchNextPage:a,addToast:d,handlePostClick:_,handleUserClick:b},e[8]=d,e[9]=i,e[10]=a,e[11]=g,e[12]=_,e[13]=b,e[14]=t,e[15]=n,e[16]=o,e[17]=s,e[18]=S,e[19]=y):y=e[19],y};function dt(e){const{pageParam:i}=e;return ge(i,10)}function gt(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function ht(e){return e}function pt(e,i){const n=e.find(s=>s.user.id===i.user_id);return n?n.stories.push(i):e.push({user:i.user,stories:[i],isSeen:!1}),e}var yt=W();const Jt=()=>{const e=(0,yt.c)(57),{id:i}=se(),n=Z(),{currentUser:s}=U(),{onlineUsers:t}=De(),o=ee(),[a,d]=(0,O.useState)("");let c;e[0]===Symbol.for("react.memo_cache_sentinel")?(c=[],e[0]=c):c=e[0];const[u,l]=(0,O.useState)(c),{conversations:r,isConvLoading:S,sendMessage:p,sendTypingStatus:g,typingStatus:f,markAsRead:_,formatMessages:v,onDeleteMessage:b,conversationReactions:y,messages:P,isMsgLoading:m,fetchNextMessages:h,hasMoreMessages:w,isFetchingMoreMessages:$}=xe(s,i);let L;e:{if(!i||r.length===0){L=null;break e}let N;e[1]!==r||e[2]!==i?(N=r.find(C=>C.id===i)||null,e[1]=r,e[2]=i,e[3]=N):N=e[3],L=N}const F=L;let k,D;e[4]!==i||e[5]!==_?(k=()=>{i&&_(i)},D=[i,_],e[4]=i,e[5]=_,e[6]=k,e[7]=D):(k=e[6],D=e[7]),(0,O.useEffect)(k,D);let K;e[8]!==r||e[9]!==s?.id||e[10]!==a?(K=()=>{const N=setTimeout(async()=>{if(a.length>1){const C=await Le(a),H=r.map(Pt);l(C.filter(ae=>ae.id!==s?.id&&!H.includes(ae.id)))}else l([])},300);return()=>clearTimeout(N)},e[8]=r,e[9]=s?.id,e[10]=a,e[11]=K):K=e[11];const Q=s?.id;let R;e[12]!==r||e[13]!==a||e[14]!==Q?(R=[a,r,Q],e[12]=r,e[13]=a,e[14]=Q,e[15]=R):R=e[15],(0,O.useEffect)(K,R);let x;e[16]!==s||e[17]!==n||e[18]!==o?(x=async N=>{if(s)try{const C=await ue(s.id,N.id);o.invalidateQueries({queryKey:["conversations",s.id]}),d(""),n(`/messages/${C}`)}catch(C){console.error("Failed to start conversation:",C)}},e[16]=s,e[17]=n,e[18]=o,e[19]=x):x=e[19];const M=x;let q;e[20]!==n?(q=N=>{n(`/messages/${N.id}`)},e[20]=n,e[21]=q):q=e[21];const B=q;let A;e[22]!==y||e[23]!==v||e[24]!==P?(A=v(P,y),e[22]=y,e[23]=v,e[24]=P,e[25]=A):A=e[25];const z=A;let J;if(e[26]!==r||e[27]!==a){let N;e[29]!==a?(N=C=>C.user?.name?.toLowerCase().includes(a.toLowerCase())||C.user?.handle?.toLowerCase().includes(a.toLowerCase())||C.lastMessage?.toLowerCase().includes(a.toLowerCase()),e[29]=a,e[30]=N):N=e[30],J=r.filter(N),e[26]=r,e[27]=a,e[28]=J}else J=e[28];const j=J,T=F&&f[F.id];let V;e[31]!==t||e[32]!==F?(V=F&&F.user?.id&&t.has(F.user.id),e[31]=t,e[32]=F,e[33]=V):V=e[33];const G=V;let E;return e[34]!==r||e[35]!==T||e[36]!==s||e[37]!==h||e[38]!==j||e[39]!==B||e[40]!==M||e[41]!==w||e[42]!==i||e[43]!==S||e[44]!==$||e[45]!==m||e[46]!==z||e[47]!==a||e[48]!==n||e[49]!==b||e[50]!==t||e[51]!==G||e[52]!==F||e[53]!==p||e[54]!==g||e[55]!==u?(E={id:i,currentUser:s,onlineUsers:t,msgSearchQuery:a,setMsgSearchQuery:d,userSearchResults:u,conversations:r,filteredConversations:j,selectedConversation:F,localMessages:z,isConvLoading:S,isMsgLoading:m,currentIsTyping:T,otherUserIsOnline:G,handleStartConversation:M,handleSelectConversation:B,sendMessage:p,onDeleteMessage:b,sendTypingStatus:g,navigate:n,fetchNextMessages:h,hasMoreMessages:w,isFetchingMoreMessages:$},e[34]=r,e[35]=T,e[36]=s,e[37]=h,e[38]=j,e[39]=B,e[40]=M,e[41]=w,e[42]=i,e[43]=S,e[44]=$,e[45]=m,e[46]=z,e[47]=a,e[48]=n,e[49]=b,e[50]=t,e[51]=G,e[52]=F,e[53]=p,e[54]=g,e[55]=u,e[56]=E):E=e[56],E};function Pt(e){return e.user?.id}var _t=W();const zt=()=>{const e=(0,_t.c)(47),{currentUser:i}=U(),n=Z(),s=ee(),t=i?.id;let o;e[0]!==t?(o=["notifications",t],e[0]=t,e[1]=o):o=e[1];let a;e[2]!==i?.id?(a=R=>{const{pageParam:x}=R;return de(i?.id,x,10)},e[2]=i?.id,e[3]=a):a=e[3];const d=!!i?.id;let c;e[4]!==o||e[5]!==a||e[6]!==d?(c={queryKey:o,queryFn:a,enabled:d,initialPageParam:null,getNextPageParam:vt},e[4]=o,e[5]=a,e[6]=d,e[7]=c):c=e[7];const{data:u,fetchNextPage:l,hasNextPage:r,isFetchingNextPage:S,isLoading:p}=Y(c);let g;e[8]!==u?.pages?(g=u?.pages.flatMap(bt)||[],e[8]=u?.pages,e[9]=g):g=e[9];const f=g;let _;e[10]!==i||e[11]!==s?(_=()=>{if(!i?.id)return;const R=ne.channel(`user_notifications:${i.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${i.id}`},()=>{s.invalidateQueries({queryKey:["notifications",i.id]})}).subscribe();return()=>{ne.removeChannel(R)}},e[10]=i,e[11]=s,e[12]=_):_=e[12];const v=i?.id;let b;e[13]!==s||e[14]!==v?(b=[v,s],e[13]=s,e[14]=v,e[15]=b):b=e[15],(0,O.useEffect)(_,b);let y;e[16]!==i?(y=()=>i?be(i.id):Promise.resolve(),e[16]=i,e[17]=y):y=e[17];let P,m,h;e[18]!==i?.id||e[19]!==s?(P=async()=>{await s.cancelQueries({queryKey:["notifications",i?.id]});const R=s.getQueryData(["notifications",i?.id]);return s.setQueryData(["notifications",i?.id],St),{previousNotifications:R}},m=(R,x,M)=>{M?.previousNotifications&&s.setQueryData(["notifications",i?.id],M.previousNotifications)},h=()=>{s.invalidateQueries({queryKey:["notifications",i?.id]})},e[18]=i?.id,e[19]=s,e[20]=P,e[21]=m,e[22]=h):(P=e[20],m=e[21],h=e[22]);let w;e[23]!==P||e[24]!==m||e[25]!==h||e[26]!==y?(w={mutationFn:y,onMutate:P,onError:m,onSettled:h},e[23]=P,e[24]=m,e[25]=h,e[26]=y,e[27]=w):w=e[27];const $=te(w);let L;e[28]!==n?(L=R=>{R.type==="follow"?n(`/u/${R.user}`):R.post_id&&n(`/post/${R.post_id}`)},e[28]=n,e[29]=L):L=e[29];const F=L;let k;e[30]!==i?.id||e[31]!==$||e[32]!==f?(k=()=>{i?.id&&f.some(Ct)&&$.mutate()},e[30]=i?.id,e[31]=$,e[32]=f,e[33]=k):k=e[33];const D=i?.id;let K;e[34]!==$||e[35]!==f.length||e[36]!==D?(K=[D,f.length,$],e[34]=$,e[35]=f.length,e[36]=D,e[37]=K):K=e[37],(0,O.useEffect)(k,K);let Q;return e[38]!==i||e[39]!==l||e[40]!==F||e[41]!==r||e[42]!==S||e[43]!==p||e[44]!==n||e[45]!==f?(Q={currentUser:i,notifications:f,isLoading:p,isFetchingMore:S,hasMore:r,loadNotifications:l,handleNotificationClick:F,navigate:n},e[38]=i,e[39]=l,e[40]=F,e[41]=r,e[42]=S,e[43]=p,e[44]=n,e[45]=f,e[46]=Q):Q=e[46],Q};function vt(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function bt(e){return e}function wt(e){return{...e,is_read:!0}}function $t(e){return e.map(wt)}function St(e){return e&&{...e,pages:e.pages.map($t)}}function Ct(e){return!e.is_read}var Mt=W();const Ht=()=>{const e=(0,Mt.c)(23),{id:i}=se(),n=Z(),{currentUser:s}=U(),{addToast:t}=ie(),o=ee();let a,d;e[0]!==i?(a=["post",i],d=async()=>{if(!i||!X(i))throw new Error("Invalid post ID");return $e(i)},e[0]=i,e[1]=a,e[2]=d):(a=e[1],d=e[2]);const c=!!i;let u;e[3]!==a||e[4]!==d||e[5]!==c?(u={queryKey:a,queryFn:d,enabled:c,retry:!1},e[3]=a,e[4]=d,e[5]=c,e[6]=u):u=e[6];const{data:l,isLoading:r,isError:S}=I(u);let p;e[7]!==n?(p=P=>{n(`/u/${P}`)},e[7]=n,e[8]=p):p=e[8];const g=p;let f;e[9]!==n?(f=()=>{n(-1)},e[9]=n,e[10]=f):f=e[10];const _=f;let v;e[11]!==o?(v=(P,m,h)=>{o.setQueryData(["post",P],w=>w&&{...w,content:m,media:h})},e[11]=o,e[12]=v):v=e[12];const b=v;let y;return e[13]!==t||e[14]!==s||e[15]!==_||e[16]!==b||e[17]!==g||e[18]!==S||e[19]!==r||e[20]!==n||e[21]!==l?(y={post:l,isLoading:r,isError:S,currentUser:s,addToast:t,navigate:n,handleUserClick:g,handleDelete:_,handleUpdate:b},e[13]=t,e[14]=s,e[15]=_,e[16]=b,e[17]=g,e[18]=S,e[19]=r,e[20]=n,e[21]=l,e[22]=y):y=e[22],y};var Rt=W();const Vt=()=>{const e=(0,Rt.c)(34),i=Z(),{id:n}=se(),[s]=re();let t;e[0]!==n||e[1]!==s?(t=n||s.get("id"),e[0]=n,e[1]=s,e[2]=t):t=e[2];const o=t,a=(0,O.useRef)(null);let d;e[3]===Symbol.for("react.memo_cache_sentinel")?(d=new Map,e[3]=d):d=e[3];const c=(0,O.useRef)(d),[u,l]=(0,O.useState)(null),[r,S]=(0,O.useState)(!0);let p;e[4]===Symbol.for("react.memo_cache_sentinel")?(p=["reels"],e[4]=p):p=e[4];let g;e[5]===Symbol.for("react.memo_cache_sentinel")?(g={queryKey:p,queryFn:Lt,initialPageParam:null,getNextPageParam:Ft},e[5]=g):g=e[5];const{data:f,fetchNextPage:_,hasNextPage:v,isFetchingNextPage:b,isLoading:y}=Y(g);let P;e[6]!==f?.pages?(P=f?.pages.flatMap(qt)||[],e[6]=f?.pages,e[7]=P):P=e[7];const m=P;let h,w;e[8]!==u||e[9]!==m||e[10]!==o?(h=()=>{if(m.length>0)if(o)if(m.find(M=>M.id===o)){l(o);const M=c.current.get(o);M&&M.scrollIntoView({behavior:"instant"})}else u||l(m[0].id);else u||l(m[0].id)},w=[m,o,u],e[8]=u,e[9]=m,e[10]=o,e[11]=h,e[12]=w):(h=e[11],w=e[12]),(0,O.useEffect)(h,w);let $,L;e[13]!==m.length?($=()=>{if(m.length===0)return;const M={root:a.current,threshold:.6},q=A=>{A.forEach(z=>{if(z.isIntersecting){const J=z.target.getAttribute("data-id");J&&l(J)}})},B=new IntersectionObserver(q,M);return c.current.forEach(A=>B.observe(A)),()=>B.disconnect()},L=[m.length],e[13]=m.length,e[14]=$,e[15]=L):($=e[14],L=e[15]),(0,O.useEffect)($,L);let F;e[16]!==r?(F=()=>{S(!r)},e[16]=r,e[17]=F):F=e[17];const k=F;let D;e[18]===Symbol.for("react.memo_cache_sentinel")?(D=(M,q)=>{q?c.current.set(M,q):c.current.delete(M)},e[18]=D):D=e[18];const K=D;let Q,R;e[19]!==_||e[20]!==v||e[21]!==b?(Q=()=>{const M=()=>{if(!a.current||b||!v)return;const{scrollTop:B,scrollHeight:A,clientHeight:z}=a.current;B+z>=A-800&&_()},q=a.current;if(q)return q.addEventListener("scroll",M),()=>q.removeEventListener("scroll",M)},R=[b,v,_],e[19]=_,e[20]=v,e[21]=b,e[22]=Q,e[23]=R):(Q=e[22],R=e[23]),(0,O.useEffect)(Q,R);let x;return e[24]!==u||e[25]!==_||e[26]!==v||e[27]!==b||e[28]!==y||e[29]!==r||e[30]!==i||e[31]!==m||e[32]!==k?(x={reels:m,loading:y,loadingMore:b,activeReelId:u,hasMore:v,isMuted:r,containerRef:a,setReelRef:K,navigate:i,toggleMute:k,loadReels:_},e[24]=u,e[25]=_,e[26]=v,e[27]=b,e[28]=y,e[29]=r,e[30]=i,e[31]=m,e[32]=k,e[33]=x):x=e[33],x};function Lt(e){const{pageParam:i}=e;return fe(i,10)}function Ft(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function qt(e){return e}const Gt=()=>{const{currentUser:e,logout:i}=U(),{darkMode:n,toggleDarkMode:s,fontSize:t,setFontSize:o,dataSaver:a,setDataSaver:d}=qe(),{addToast:c}=ie(),[u,l]=(0,O.useState)(!1),[r,S]=(0,O.useState)({newPassword:"",confirmPassword:""}),[p,g]=(0,O.useState)(!1),f=async()=>{try{await i(),c("Logged out successfully")}catch(h){console.error("Logout error:",h),c("Failed to logout")}};return{currentUser:e,darkMode:n,toggleDarkMode:s,fontSize:t,setFontSize:o,dataSaver:a,setDataSaver:d,isChangingPassword:u,setIsChangingPassword:l,passwordData:r,setPasswordData:S,loading:p,handleLogout:f,handlePasswordChange:async h=>{if(h.preventDefault(),r.newPassword!==r.confirmPassword){c("Passwords do not match","error");return}if(r.newPassword.length<6){c("Password must be at least 6 characters","error");return}g(!0);try{const{error:w}=await ne.auth.updateUser({password:r.newPassword});if(w)throw w;c("Password updated successfully!"),l(!1),S({newPassword:"",confirmPassword:""})}catch(w){console.error("Password update error:",w),c(w.message||"Failed to update password","error")}finally{g(!1)}},handlePasswordReset:async()=>{if(e?.email){g(!0);try{const{error:h}=await ne.auth.resetPasswordForEmail(e.email,{redirectTo:`${window.location.origin}/settings?type=recovery`});if(h)throw h;c("Password reset email sent!")}catch(h){console.error("Reset password error:",h),c(h.message||"Failed to send reset email","error")}finally{g(!1)}}},handleClearCache:()=>{["seenStories","font-size","data-saver","theme"].forEach(h=>localStorage.removeItem(h)),c("Cache cleared! Reloading..."),setTimeout(()=>window.location.reload(),1500)},handleDownloadData:async()=>{if(e){g(!0);try{const h={user:{id:e.id,handle:e.handle,name:e.name,email:e.email},exportDate:new Date().toISOString(),note:"This is a mock export of your Sysm data."},w=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),$=URL.createObjectURL(w),L=document.createElement("a");L.href=$,L.download=`sysm-data-${e.handle}.json`,L.click(),URL.revokeObjectURL($),c("Data export started!")}catch{c("Failed to export data","error")}finally{g(!1)}}},handleDeleteAccount:()=>{window.confirm("Are you absolutely sure? This will permanently delete your account and all associated data. This action is irreversible.")&&(c("Account deletion request submitted. Logging out..."),setTimeout(f,2e3))},handleReportBug:()=>{window.prompt("Please describe the bug you found:")&&c("Bug reported! Thank you for your feedback.")}}};export{Jt as a,Ot as c,Et as d,Tt as f,zt as i,At as l,Vt as n,jt as o,Qt as p,Ht as r,Bt as s,Gt as t,Kt as u};
