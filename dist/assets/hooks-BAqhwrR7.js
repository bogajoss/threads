import{a as re}from"./rolldown-runtime-BaZ8gS7u.js";import{E as le,S as ce,b as G,c as X,x as oe,y as ue}from"./framework-CsA6nn9m.js";import{a as ee,n as se,r as I,t as U}from"./query-QyXblnmD.js";import{At as de,Bt as fe,Ct as me,Dt as ge,Et as he,Ht as ye,Jt as pe,Lt as Pe,Nt as ve,Ot as we,Pt as Ce,Rt as Me,St as be,Tt as Se,Ut as Fe,Wt as Le,Yt as _e,_t as qe,en as ae,gt as te,ht as ke,nn as Y,qt as De,rn as ie,s as $e,vt as Ne,wt as Re,xt as Qe,yt as Z,zt as xe}from"./index-ygfBiQz8.js";var Ee=X(),L=re(le(),1);const nt=(e,s,i,o)=>{const t=(0,Ee.c)(92),a=ee();let n;t[0]!==s?(n=s||{comments:0,likes:0,mirrors:0,reposts:0},t[0]=s,t[1]=n):n=t[1];const[h,l]=(0,L.useState)(n);let S,r;t[2]!==s?(S=()=>{s&&l(D=>({...D,...s}))},r=[s],t[2]=s,t[3]=S,t[4]=r):(S=t[3],r=t[4]),(0,L.useEffect)(S,r);const m=i?.id;let C;t[5]!==e||t[6]!==m?(C=["post",e,"liked",m],t[5]=e,t[6]=m,t[7]=C):C=t[7];let v;t[8]!==i?.id||t[9]!==e?(v=()=>ve(e,i?.id),t[8]=i?.id,t[9]=e,t[10]=v):v=t[10];let f;t[11]!==i||t[12]!==e?(f=!!i&&Y(e)&&Y(i.id),t[11]=i,t[12]=e,t[13]=f):f=t[13];let g;t[14]!==C||t[15]!==v||t[16]!==f?(g={queryKey:C,queryFn:v,enabled:f,staleTime:6e5},t[14]=C,t[15]=v,t[16]=f,t[17]=g):g=t[17];const{data:_}=I(g),M=_===void 0?!1:_,y=i?.id;let p;t[18]!==e||t[19]!==y?(p=["post",e,"reposted",y],t[18]=e,t[19]=y,t[20]=p):p=t[20];let w;t[21]!==i?.id||t[22]!==e?(w=()=>Ce(e,i?.id),t[21]=i?.id,t[22]=e,t[23]=w):w=t[23];let b;t[24]!==i||t[25]!==e?(b=!!i&&Y(e)&&Y(i.id),t[24]=i,t[25]=e,t[26]=b):b=t[26];let c;t[27]!==p||t[28]!==w||t[29]!==b?(c={queryKey:p,queryFn:w,enabled:b,staleTime:6e5},t[27]=p,t[28]=w,t[29]=b,t[30]=c):c=t[30];const{data:P}=I(c),q=P===void 0?!1:P;let $;t[31]!==i?.id||t[32]!==e?($=()=>Fe(e,i?.id),t[31]=i?.id,t[32]=e,t[33]=$):$=t[33];let k;t[34]!==i?.id||t[35]!==e||t[36]!==a?(k=async()=>{await a.cancelQueries({queryKey:["post",e,"liked",i?.id]});const D=a.getQueryData(["post",e,"liked",i?.id]);return a.setQueryData(["post",e,"liked",i?.id],!D),l(N=>({...N,likes:D?(N.likes||0)-1:(N.likes||0)+1})),{previousLiked:D}},t[34]=i?.id,t[35]=e,t[36]=a,t[37]=k):k=t[37];let u;t[38]!==i?.id||t[39]!==e||t[40]!==a||t[41]!==o?(u=(D,N,Q)=>{Q?.previousLiked!==void 0&&(a.setQueryData(["post",e,"liked",i?.id],Q.previousLiked),l(W=>({...W,likes:Q.previousLiked?(W.likes||0)+1:(W.likes||0)-1}))),o("Failed to update like","error")},t[38]=i?.id,t[39]=e,t[40]=a,t[41]=o,t[42]=u):u=t[42];let R;t[43]!==i?.id||t[44]!==e||t[45]!==a?(R=()=>{a.invalidateQueries({queryKey:["post",e,"liked",i?.id]})},t[43]=i?.id,t[44]=e,t[45]=a,t[46]=R):R=t[46];let x;t[47]!==$||t[48]!==k||t[49]!==u||t[50]!==R?(x={mutationFn:$,onMutate:k,onError:u,onSettled:R},t[47]=$,t[48]=k,t[49]=u,t[50]=R,t[51]=x):x=t[51];const T=se(x);let F;t[52]!==i?.id||t[53]!==e?(F=()=>Le(e,i?.id),t[52]=i?.id,t[53]=e,t[54]=F):F=t[54];let d;t[55]!==i?.id||t[56]!==e||t[57]!==a?(d=async()=>{await a.cancelQueries({queryKey:["post",e,"reposted",i?.id]});const D=a.getQueryData(["post",e,"reposted",i?.id]);return a.setQueryData(["post",e,"reposted",i?.id],!D),l(N=>({...N,reposts:D?(N.reposts||0)-1:(N.reposts||0)+1,mirrors:D?(N.mirrors||0)-1:(N.mirrors||0)+1})),{previousReposted:D}},t[55]=i?.id,t[56]=e,t[57]=a,t[58]=d):d=t[58];let E;t[59]!==i?.id||t[60]!==e||t[61]!==a||t[62]!==o?(E=(D,N,Q)=>{Q?.previousReposted!==void 0&&(a.setQueryData(["post",e,"reposted",i?.id],Q.previousReposted),l(W=>({...W,reposts:Q.previousReposted?(W.reposts||0)+1:(W.reposts||0)-1,mirrors:Q.previousReposted?(W.mirrors||0)+1:(W.mirrors||0)-1}))),o("Failed to update repost","error")},t[59]=i?.id,t[60]=e,t[61]=a,t[62]=o,t[63]=E):E=t[63];let K;t[64]!==i?.id||t[65]!==e||t[66]!==a?(K=()=>{a.invalidateQueries({queryKey:["post",e,"reposted",i?.id]})},t[64]=i?.id,t[65]=e,t[66]=a,t[67]=K):K=t[67];let A;t[68]!==o?(A=D=>{o(D?"Reposted!":"Removed repost")},t[68]=o,t[69]=A):A=t[69];let O;t[70]!==F||t[71]!==d||t[72]!==E||t[73]!==K||t[74]!==A?(O={mutationFn:F,onMutate:d,onError:E,onSettled:K,onSuccess:A},t[70]=F,t[71]=d,t[72]=E,t[73]=K,t[74]=A,t[75]=O):O=t[75];const B=se(O);let j;t[76]!==i||t[77]!==T||t[78]!==e||t[79]!==o?(j=async D=>{if(D&&D.stopPropagation(),!i)return o("Please login to like!","error");!Y(e)||!Y(i.id)||T.mutate()},t[76]=i,t[77]=T,t[78]=e,t[79]=o,t[80]=j):j=t[80];const H=j;let J;t[81]!==i||t[82]!==e||t[83]!==B||t[84]!==o?(J=async D=>{if(D&&D.stopPropagation(),!i)return o("Please login to repost!","error");!Y(e)||!Y(i.id)||B.mutate()},t[81]=i,t[82]=e,t[83]=B,t[84]=o,t[85]=J):J=t[85];const V=J;let z;return t[86]!==H||t[87]!==V||t[88]!==M||t[89]!==q||t[90]!==h?(z={liked:M,reposted:q,localStats:h,setLocalStats:l,handleLike:H,handleRepost:V},t[86]=H,t[87]=V,t[88]=M,t[89]=q,t[90]=h,t[91]=z):z=t[91],z};var Te=X();const rt=e=>{const s=(0,Te.c)(5);let i;s[0]!==e?(i=()=>ae(e),s[0]=e,s[1]=i):i=s[1];const[o,t]=(0,L.useState)(i);let a,n;return s[2]!==e?(a=()=>{if(!e)return;const h=setTimeout(()=>{t(ae(e))},0),l=setInterval(()=>{t(ae(e))},6e4);return()=>{clearTimeout(h),clearInterval(l)}},n=[e],s[2]=e,s[3]=a,s[4]=n):(a=s[3],n=s[4]),(0,L.useEffect)(a,n),o},lt=()=>{const{handle:e}=oe(),s=G(),{currentUser:i,getProfileByHandle:o}=Z(),{addToast:t}=te(),{data:a,isLoading:n}=I({queryKey:["profile",e],queryFn:()=>o(e),enabled:!!e,staleTime:1e3*60*5}),[h,l]=(0,L.useState)("feed"),{data:S,fetchNextPage:r,hasNextPage:m,isFetchingNextPage:C,isLoading:v}=U({queryKey:["posts","user",a?.id],queryFn:({pageParam:d})=>xe(a?.id,d,10),enabled:!!a?.id,initialPageParam:null,getNextPageParam:d=>{if(!(!d||d.length<10))return d[d.length-1].sort_timestamp||d[d.length-1].created_at}}),f=(0,L.useMemo)(()=>S?.pages.flatMap(d=>d)||[],[S]),[g,_]=(0,L.useState)(!1),[M,y]=(0,L.useState)("Followers"),[p,w]=(0,L.useState)([]),[b,c]=(0,L.useState)(!1),[P,q]=(0,L.useState)(!1),[$,k]=(0,L.useState)(!0),u=async(d,E=!1)=>{const K=a?.id;if(K){E?q(!0):(y(d),_(!0),c(!0),w([]));try{const A=E&&p.length>0?p[p.length-1].followed_at:null,O=d==="Followers"?await De(K,A,10):await pe(K,A,10);O.length<10?k(!1):k(!0),w(E?B=>[...B,...O]:O)}catch(A){console.error(`Failed to fetch ${d}:`,A),t(`Failed to load ${d}`)}finally{c(!1),q(!1)}}},R=(0,L.useMemo)(()=>h==="feed"?f.filter(d=>d.community_id===null&&d.parent_id===null):h==="media"?f.filter(d=>d.community_id===null&&d.parent_id===null&&(d.type==="video"||d.type==="image"||d.media&&d.media.length>0)):h==="collections"?[]:f,[f,h]);return{handle:e,profile:a,loading:n,userPosts:f,setUserPosts:()=>console.warn("setUserPosts is deprecated"),activeProfileTab:h,setActiveProfileTab:l,loadingPosts:v,isFetchingMorePosts:C,hasMorePosts:m,filteredPosts:R,isFollowModalOpen:g,setIsFollowModalOpen:_,followModalType:M,followListData:p,isListLoading:b,isFetchingMoreFollows:P,hasMoreFollows:$,openFollowModal:u,handlePostClick:d=>{s(`/post/${d}`)},handleUserClick:d=>{d!==e&&s(`/u/${d}`)},loadUserPosts:(d=!1)=>{r()},currentUser:i,addToast:t,navigate:s}};var Ke=X();const ct=()=>{const e=(0,Ke.c)(74),{handle:s}=oe(),i=G(),{currentUser:o}=Z(),{addToast:t}=te(),a=ee();let n,h;e[0]!==s?(n=["community",s],h=()=>me(s),e[0]=s,e[1]=n,e[2]=h):(n=e[1],h=e[2]);const l=!!s;let S;e[3]!==n||e[4]!==h||e[5]!==l?(S={queryKey:n,queryFn:h,enabled:l,staleTime:6e5},e[3]=n,e[4]=h,e[5]=l,e[6]=S):S=e[6];const{data:r,isLoading:m}=I(S),C=r?.id,v=o?.id;let f;e[7]!==C||e[8]!==v?(f=["community",C,"membership",v],e[7]=C,e[8]=v,e[9]=f):f=e[9];let g;e[10]!==r?.id||e[11]!==o?.id?(g=()=>Qe(r?.id,o?.id),e[10]=r?.id,e[11]=o?.id,e[12]=g):g=e[12];const _=!!r?.id&&!!o?.id;let M;e[13]!==f||e[14]!==g||e[15]!==_?(M={queryKey:f,queryFn:g,enabled:_,staleTime:3e5},e[13]=f,e[14]=g,e[15]=_,e[16]=M):M=e[16];const{data:y}=I(M),p=!!y,w=y?.role||null,b=r?.id;let c;e[17]!==b?(c=["posts","community",b],e[17]=b,e[18]=c):c=e[18];let P;e[19]!==r?.id?(P=D=>{const{pageParam:N}=D;return Re(r?.id,N,10)},e[19]=r?.id,e[20]=P):P=e[20];const q=!!r?.id;let $;e[21]!==c||e[22]!==P||e[23]!==q?($={queryKey:c,queryFn:P,enabled:q,initialPageParam:null,getNextPageParam:Ae},e[21]=c,e[22]=P,e[23]=q,e[24]=$):$=e[24];const{data:k,fetchNextPage:u,hasNextPage:R,isFetchingNextPage:x,isLoading:T}=U($);let F;e[25]!==k?.pages?(F=k?.pages.flatMap(Oe)||[],e[25]=k?.pages,e[26]=F):F=e[26];const d=F;let E;e[27]!==r?.id||e[28]!==o?.id?(E=()=>Se(r?.id,o?.id),e[27]=r?.id,e[28]=o?.id,e[29]=E):E=e[29];let K;e[30]!==r?.id||e[31]!==o?.id||e[32]!==s||e[33]!==a?(K=async()=>{await a.cancelQueries({queryKey:["community",r?.id,"membership",o?.id]}),await a.cancelQueries({queryKey:["community",s]});const D=a.getQueryData(["community",r?.id,"membership",o?.id]),N=a.getQueryData(["community",s]);return a.setQueryData(["community",r?.id,"membership",o?.id],D?null:{role:"member"}),a.setQueryData(["community",s],Q=>Q&&{...Q,membersCount:D?Q.membersCount-1:Q.membersCount+1}),{previousMembership:D,previousCommunity:N}},e[30]=r?.id,e[31]=o?.id,e[32]=s,e[33]=a,e[34]=K):K=e[34];let A;e[35]!==t||e[36]!==r?.id||e[37]!==o?.id||e[38]!==s||e[39]!==a?(A=(D,N,Q)=>{Q?.previousMembership!==void 0&&a.setQueryData(["community",r?.id,"membership",o?.id],Q.previousMembership),Q?.previousCommunity&&a.setQueryData(["community",s],Q.previousCommunity),t("Failed to update membership","error")},e[35]=t,e[36]=r?.id,e[37]=o?.id,e[38]=s,e[39]=a,e[40]=A):A=e[40];let O;e[41]!==r?.id||e[42]!==o?.id||e[43]!==s||e[44]!==a?(O=()=>{a.invalidateQueries({queryKey:["community",r?.id,"membership",o?.id]}),a.invalidateQueries({queryKey:["community",s]})},e[41]=r?.id,e[42]=o?.id,e[43]=s,e[44]=a,e[45]=O):O=e[45];let B;e[46]!==t||e[47]!==r?(B=D=>{r&&t(D?`Joined ${r.name}`:`Left ${r.name}`)},e[46]=t,e[47]=r,e[48]=B):B=e[48];let j;e[49]!==E||e[50]!==K||e[51]!==A||e[52]!==O||e[53]!==B?(j={mutationFn:E,onMutate:K,onError:A,onSettled:O,onSuccess:B},e[49]=E,e[50]=K,e[51]=A,e[52]=O,e[53]=B,e[54]=j):j=e[54];const H=se(j);let J;e[55]!==t||e[56]!==o||e[57]!==H?(J=async()=>{if(!o)return t("Please login to join communities","error");H.mutate()},e[55]=t,e[56]=o,e[57]=H,e[58]=J):J=e[58];const V=J;let z;return e[59]!==t||e[60]!==r||e[61]!==d||e[62]!==o||e[63]!==u||e[64]!==V||e[65]!==R||e[66]!==x||e[67]!==p||e[68]!==H.isPending||e[69]!==m||e[70]!==T||e[71]!==i||e[72]!==w?(z={community:r,loading:m,isMember:p,userRole:w,isJoining:H.isPending,communityPosts:d,loadingPosts:T,isFetchingMorePosts:x,hasMorePosts:R,handleJoinToggle:V,loadCommunityPosts:u,currentUser:o,addToast:t,navigate:i},e[59]=t,e[60]=r,e[61]=d,e[62]=o,e[63]=u,e[64]=V,e[65]=R,e[66]=x,e[67]=p,e[68]=H.isPending,e[69]=m,e[70]=T,e[71]=i,e[72]=w,e[73]=z):z=e[73],z};function Ae(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function Oe(e){return e}const ut=()=>{const{currentUser:e}=Z(),s=G(),i=ue(),o=new URLSearchParams(i.search),t=o.get("q")||"",a=o.get("tab")||(t?"posts":"communities"),[n,h]=(0,L.useState)(t),[l,S]=(0,L.useState)(a),[r,m]=(0,L.useState)(!1);(0,L.useEffect)(()=>{t!==n&&(h(t),t&&S("posts"))},[t]);const{data:C,fetchNextPage:v,hasNextPage:f,isFetchingNextPage:g,isLoading:_}=U({queryKey:["explore","communities"],queryFn:({pageParam:u})=>be(u,10),initialPageParam:null,getNextPageParam:u=>{if(!(!u||u.length<10))return u[u.length-1].createdAt}}),M=(0,L.useMemo)(()=>C?.pages.flatMap(u=>u)||[],[C]),{data:y,fetchNextPage:p,hasNextPage:w,isFetchingNextPage:b,isLoading:c}=U({queryKey:["explore","posts",n],queryFn:({pageParam:u})=>n?ye(n,u,10,!0):Pe(u,10),initialPageParam:null,getNextPageParam:u=>{if(!(!u||u.length<10))return u[u.length-1].sort_timestamp||u[u.length-1].sortTimestamp}}),P=(0,L.useMemo)(()=>y?.pages.flatMap(u=>u)||[],[y]),q=(0,L.useMemo)(()=>{let u=M;return n&&(u=u.filter(R=>R.name?.toLowerCase().includes(n.toLowerCase())||R.handle?.toLowerCase().includes(n.toLowerCase()))),u},[M,n]);return{currentUser:e,searchQuery:n,setSearchQuery:u=>{h(u)},activeTab:l,setActiveTab:S,isCreateModalOpen:r,setIsCreateModalOpen:m,communitiesData:M,isCommunitiesLoading:_,isFetchingMoreCommunities:g,hasMoreCommunities:f,postsData:P,isPostsLoading:c,isFetchingMorePosts:b,hasMorePosts:w,filteredCommunities:q,handleCommunityClick:u=>{s(`/c/${u}`)},loadCommunities:v,loadPosts:p,navigate:s}};var Be=X();const dt=()=>{const e=(0,Be.c)(21),{currentUser:s}=Z(),{posts:i,loading:o,hasMore:t,isFetchingNextPage:a,fetchNextPage:n}=ke(),{addToast:h}=te(),l=G();let S;e[0]===Symbol.for("react.memo_cache_sentinel")?(S={queryKey:["stories"],queryFn:he},e[0]=S):S=e[0];const{data:r,isLoading:m}=I(S);let C;e[1]!==r?(C=r===void 0?[]:r,e[1]=r,e[2]=C):C=e[2];const v=C;let f;if(e[3]!==v){const c={};v.forEach(P=>{if(!P.user)return;const q=P.user.id;c[q]||(c[q]={user:P.user,stories:[]}),c[q].stories.push(P)}),f=Object.values(c),e[3]=v,e[4]=f}else f=e[4];const g=f,_=i;let M;e[5]!==l?(M=c=>{l(`/post/${c}`)},e[5]=l,e[6]=M):M=e[6];const y=M;let p;e[7]!==l?(p=c=>{l(`/u/${c}`)},e[7]=l,e[8]=p):p=e[8];const w=p;let b;return e[9]!==h||e[10]!==s||e[11]!==n||e[12]!==g||e[13]!==y||e[14]!==w||e[15]!==t||e[16]!==_||e[17]!==a||e[18]!==o||e[19]!==m?(b={currentUser:s,homePosts:_,groupedStories:g,isPostsLoading:o,isStoriesLoading:m,hasMore:t,isFetchingNextPage:a,fetchNextPage:n,addToast:h,handlePostClick:y,handleUserClick:w},e[9]=h,e[10]=s,e[11]=n,e[12]=g,e[13]=y,e[14]=w,e[15]=t,e[16]=_,e[17]=a,e[18]=o,e[19]=m,e[20]=b):b=e[20],b};var je=X();const ft=()=>{const e=(0,je.c)(57),{id:s}=oe(),i=G(),{currentUser:o}=Z(),{onlineUsers:t}=Ne(),a=ee(),[n,h]=(0,L.useState)("");let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=[],e[0]=l):l=e[0];const[S,r]=(0,L.useState)(l),{conversations:m,isConvLoading:C,sendMessage:v,sendTypingStatus:f,typingStatus:g,markAsRead:_,formatMessages:M,onDeleteMessage:y,conversationReactions:p,messages:w,isMsgLoading:b,fetchNextMessages:c,hasMoreMessages:P,isFetchingMoreMessages:q}=$e(o,s);let $;e:{if(!s||m.length===0){$=null;break e}let N;e[1]!==m||e[2]!==s?(N=m.find(Q=>Q.id===s)||null,e[1]=m,e[2]=s,e[3]=N):N=e[3],$=N}const k=$;let u,R;e[4]!==s||e[5]!==_?(u=()=>{s&&_(s)},R=[s,_],e[4]=s,e[5]=_,e[6]=u,e[7]=R):(u=e[6],R=e[7]),(0,L.useEffect)(u,R);let x;e[8]!==m||e[9]!==o?.id||e[10]!==n?(x=()=>{const N=setTimeout(async()=>{if(n.length>1){const Q=await _e(n),W=m.map(He);r(Q.filter(ne=>ne.id!==o?.id&&!W.includes(ne.id)))}else r([])},300);return()=>clearTimeout(N)},e[8]=m,e[9]=o?.id,e[10]=n,e[11]=x):x=e[11];const T=o?.id;let F;e[12]!==m||e[13]!==n||e[14]!==T?(F=[n,m,T],e[12]=m,e[13]=n,e[14]=T,e[15]=F):F=e[15],(0,L.useEffect)(x,F);let d;e[16]!==o||e[17]!==i||e[18]!==a?(d=async N=>{if(o)try{const Q=await de(o.id,N.id);a.invalidateQueries({queryKey:["conversations",o.id]}),h(""),i(`/messages/${Q}`)}catch(Q){console.error("Failed to start conversation:",Q)}},e[16]=o,e[17]=i,e[18]=a,e[19]=d):d=e[19];const E=d;let K;e[20]!==i?(K=N=>{i(`/messages/${N.id}`)},e[20]=i,e[21]=K):K=e[21];const A=K;let O;e[22]!==p||e[23]!==M||e[24]!==w?(O=M(w,p),e[22]=p,e[23]=M,e[24]=w,e[25]=O):O=e[25];const B=O;let j;if(e[26]!==m||e[27]!==n){let N;e[29]!==n?(N=Q=>Q.user?.name?.toLowerCase().includes(n.toLowerCase())||Q.user?.handle?.toLowerCase().includes(n.toLowerCase())||Q.lastMessage?.toLowerCase().includes(n.toLowerCase()),e[29]=n,e[30]=N):N=e[30],j=m.filter(N),e[26]=m,e[27]=n,e[28]=j}else j=e[28];const H=j,J=k&&g[k.id];let V;e[31]!==t||e[32]!==k?(V=k&&k.user?.id&&t.has(k.user.id),e[31]=t,e[32]=k,e[33]=V):V=e[33];const z=V;let D;return e[34]!==m||e[35]!==J||e[36]!==o||e[37]!==c||e[38]!==H||e[39]!==A||e[40]!==E||e[41]!==P||e[42]!==s||e[43]!==C||e[44]!==q||e[45]!==b||e[46]!==B||e[47]!==n||e[48]!==i||e[49]!==y||e[50]!==t||e[51]!==z||e[52]!==k||e[53]!==v||e[54]!==f||e[55]!==S?(D={id:s,currentUser:o,onlineUsers:t,msgSearchQuery:n,setMsgSearchQuery:h,userSearchResults:S,conversations:m,filteredConversations:H,selectedConversation:k,localMessages:B,isConvLoading:C,isMsgLoading:b,currentIsTyping:J,otherUserIsOnline:z,handleStartConversation:E,handleSelectConversation:A,sendMessage:v,onDeleteMessage:y,sendTypingStatus:f,navigate:i,fetchNextMessages:c,hasMoreMessages:P,isFetchingMoreMessages:q},e[34]=m,e[35]=J,e[36]=o,e[37]=c,e[38]=H,e[39]=A,e[40]=E,e[41]=P,e[42]=s,e[43]=C,e[44]=q,e[45]=b,e[46]=B,e[47]=n,e[48]=i,e[49]=y,e[50]=t,e[51]=z,e[52]=k,e[53]=v,e[54]=f,e[55]=S,e[56]=D):D=e[56],D};function He(e){return e.user?.id}var Je=X();const mt=()=>{const e=(0,Je.c)(47),{currentUser:s}=Z(),i=G(),o=ee(),t=s?.id;let a;e[0]!==t?(a=["notifications",t],e[0]=t,e[1]=a):a=e[1];let n;e[2]!==s?.id?(n=F=>{const{pageParam:d}=F;return ge(s?.id,d,10)},e[2]=s?.id,e[3]=n):n=e[3];const h=!!s?.id;let l;e[4]!==a||e[5]!==n||e[6]!==h?(l={queryKey:a,queryFn:n,enabled:h,initialPageParam:null,getNextPageParam:ze},e[4]=a,e[5]=n,e[6]=h,e[7]=l):l=e[7];const{data:S,fetchNextPage:r,hasNextPage:m,isFetchingNextPage:C,isLoading:v}=U(l);let f;e[8]!==S?.pages?(f=S?.pages.flatMap(Ve)||[],e[8]=S?.pages,e[9]=f):f=e[9];const g=f;let _;e[10]!==s||e[11]!==o?(_=()=>{if(!s?.id)return;const F=ie.channel(`user_notifications:${s.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${s.id}`},()=>{o.invalidateQueries({queryKey:["notifications",s.id]})}).subscribe();return()=>{ie.removeChannel(F)}},e[10]=s,e[11]=o,e[12]=_):_=e[12];const M=s?.id;let y;e[13]!==o||e[14]!==M?(y=[M,o],e[13]=o,e[14]=M,e[15]=y):y=e[15],(0,L.useEffect)(_,y);let p;e[16]!==s?(p=()=>s?we(s.id):Promise.resolve(),e[16]=s,e[17]=p):p=e[17];let w,b,c;e[18]!==s?.id||e[19]!==o?(w=async()=>{await o.cancelQueries({queryKey:["notifications",s?.id]});const F=o.getQueryData(["notifications",s?.id]);return o.setQueryData(["notifications",s?.id],Ge),{previousNotifications:F}},b=(F,d,E)=>{E?.previousNotifications&&o.setQueryData(["notifications",s?.id],E.previousNotifications)},c=()=>{o.invalidateQueries({queryKey:["notifications",s?.id]})},e[18]=s?.id,e[19]=o,e[20]=w,e[21]=b,e[22]=c):(w=e[20],b=e[21],c=e[22]);let P;e[23]!==w||e[24]!==b||e[25]!==c||e[26]!==p?(P={mutationFn:p,onMutate:w,onError:b,onSettled:c},e[23]=w,e[24]=b,e[25]=c,e[26]=p,e[27]=P):P=e[27];const q=se(P);let $;e[28]!==i?($=F=>{F.type==="follow"?i(`/u/${F.user}`):F.post_id&&i(`/post/${F.post_id}`)},e[28]=i,e[29]=$):$=e[29];const k=$;let u;e[30]!==s?.id||e[31]!==q||e[32]!==g?(u=()=>{s?.id&&g.some(Xe)&&q.mutate()},e[30]=s?.id,e[31]=q,e[32]=g,e[33]=u):u=e[33];const R=s?.id;let x;e[34]!==q||e[35]!==g.length||e[36]!==R?(x=[R,g.length,q],e[34]=q,e[35]=g.length,e[36]=R,e[37]=x):x=e[37],(0,L.useEffect)(u,x);let T;return e[38]!==s||e[39]!==r||e[40]!==k||e[41]!==m||e[42]!==C||e[43]!==v||e[44]!==i||e[45]!==g?(T={currentUser:s,notifications:g,isLoading:v,isFetchingMore:C,hasMore:m,loadNotifications:r,handleNotificationClick:k,navigate:i},e[38]=s,e[39]=r,e[40]=k,e[41]=m,e[42]=C,e[43]=v,e[44]=i,e[45]=g,e[46]=T):T=e[46],T};function ze(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Ve(e){return e}function We(e){return{...e,is_read:!0}}function Ye(e){return e.map(We)}function Ge(e){return e&&{...e,pages:e.pages.map(Ye)}}function Xe(e){return!e.is_read}var Ze=X();const gt=()=>{const e=(0,Ze.c)(23),{id:s}=oe(),i=G(),{currentUser:o}=Z(),{addToast:t}=te(),a=ee();let n,h;e[0]!==s?(n=["post",s],h=async()=>{if(!s||!Y(s))throw new Error("Invalid post ID");return Me(s)},e[0]=s,e[1]=n,e[2]=h):(n=e[1],h=e[2]);const l=!!s;let S;e[3]!==n||e[4]!==h||e[5]!==l?(S={queryKey:n,queryFn:h,enabled:l,retry:!1},e[3]=n,e[4]=h,e[5]=l,e[6]=S):S=e[6];const{data:r,isLoading:m,isError:C}=I(S);let v;e[7]!==i?(v=w=>{i(`/u/${w}`)},e[7]=i,e[8]=v):v=e[8];const f=v;let g;e[9]!==i?(g=()=>{i(-1)},e[9]=i,e[10]=g):g=e[10];const _=g;let M;e[11]!==a?(M=(w,b,c)=>{a.setQueryData(["post",w],P=>P&&{...P,content:b,media:c})},e[11]=a,e[12]=M):M=e[12];const y=M;let p;return e[13]!==t||e[14]!==o||e[15]!==_||e[16]!==y||e[17]!==f||e[18]!==C||e[19]!==m||e[20]!==i||e[21]!==r?(p={post:r,isLoading:m,isError:C,currentUser:o,addToast:t,navigate:i,handleUserClick:f,handleDelete:_,handleUpdate:y},e[13]=t,e[14]=o,e[15]=_,e[16]=y,e[17]=f,e[18]=C,e[19]=m,e[20]=i,e[21]=r,e[22]=p):p=e[22],p};var Ie=X();const ht=()=>{const e=(0,Ie.c)(31),s=G(),[i]=ce();let o;e[0]!==i?(o=i.get("id"),e[0]=i,e[1]=o):o=e[1];const t=o,a=(0,L.useRef)(null),[n,h]=(0,L.useState)(null),[l,S]=(0,L.useState)(!0);let r;e[2]===Symbol.for("react.memo_cache_sentinel")?(r=["reels"],e[2]=r):r=e[2];let m;e[3]===Symbol.for("react.memo_cache_sentinel")?(m={queryKey:r,queryFn:Ue,initialPageParam:null,getNextPageParam:et},e[3]=m):m=e[3];const{data:C,fetchNextPage:v,hasNextPage:f,isFetchingNextPage:g,isLoading:_}=U(m);let M;e[4]!==C?.pages?(M=C?.pages.flatMap(tt)||[],e[4]=C?.pages,e[5]=M):M=e[5];const y=M;let p,w;e[6]!==n||e[7]!==y||e[8]!==t?(p=()=>{y.length>0&&(t&&y.find(R=>R.id===t)?(h(t),setTimeout(()=>{document.querySelector(`[data-id="${t}"]`)?.scrollIntoView({behavior:"instant"})},100)):n||h(y[0].id))},w=[y,t,n],e[6]=n,e[7]=y,e[8]=t,e[9]=p,e[10]=w):(p=e[9],w=e[10]),(0,L.useEffect)(p,w);let b,c;e[11]!==y.length?(b=()=>{if(y.length===0)return;const R={root:a.current,threshold:.6},x=F=>{F.forEach(d=>{d.isIntersecting&&h(d.target.dataset.id)})},T=new IntersectionObserver(x,R);return setTimeout(()=>{document.querySelectorAll(".reel-item").forEach(F=>T.observe(F))},100),()=>T.disconnect()},c=[y.length],e[11]=y.length,e[12]=b,e[13]=c):(b=e[12],c=e[13]),(0,L.useEffect)(b,c);let P;e[14]!==l?(P=()=>{S(!l)},e[14]=l,e[15]=P):P=e[15];const q=P;let $,k;e[16]!==v||e[17]!==f||e[18]!==g?(k=()=>{const R=()=>{if(!a.current||g||!f)return;const{scrollTop:T,scrollHeight:F,clientHeight:d}=a.current;T+d>=F-800&&v()},x=a.current;if(x)return x.addEventListener("scroll",R),()=>x.removeEventListener("scroll",R)},$=[g,f,v],e[16]=v,e[17]=f,e[18]=g,e[19]=$,e[20]=k):($=e[19],k=e[20]),(0,L.useEffect)(k,$);let u;return e[21]!==n||e[22]!==v||e[23]!==f||e[24]!==g||e[25]!==_||e[26]!==l||e[27]!==s||e[28]!==y||e[29]!==q?(u={reels:y,loading:_,loadingMore:g,activeReelId:n,hasMore:f,isMuted:l,containerRef:a,navigate:s,toggleMute:q,loadReels:v},e[21]=n,e[22]=v,e[23]=f,e[24]=g,e[25]=_,e[26]=l,e[27]=s,e[28]=y,e[29]=q,e[30]=u):u=e[30],u};function Ue(e){const{pageParam:s}=e;return fe(s,10)}function et(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function tt(e){return e}const yt=()=>{const{currentUser:e,logout:s}=Z(),{darkMode:i,toggleDarkMode:o,fontSize:t,setFontSize:a,dataSaver:n,setDataSaver:h}=qe(),{addToast:l}=te(),[S,r]=(0,L.useState)(!1),[m,C]=(0,L.useState)({newPassword:"",confirmPassword:""}),[v,f]=(0,L.useState)(!1),g=async()=>{try{await s(),l("Logged out successfully")}catch(c){console.error("Logout error:",c),l("Failed to logout")}};return{currentUser:e,darkMode:i,toggleDarkMode:o,fontSize:t,setFontSize:a,dataSaver:n,setDataSaver:h,isChangingPassword:S,setIsChangingPassword:r,passwordData:m,setPasswordData:C,loading:v,handleLogout:g,handlePasswordChange:async c=>{if(c.preventDefault(),m.newPassword!==m.confirmPassword){l("Passwords do not match","error");return}if(m.newPassword.length<6){l("Password must be at least 6 characters","error");return}f(!0);try{const{error:P}=await ie.auth.updateUser({password:m.newPassword});if(P)throw P;l("Password updated successfully!"),r(!1),C({newPassword:"",confirmPassword:""})}catch(P){console.error("Password update error:",P),l(P.message||"Failed to update password","error")}finally{f(!1)}},handlePasswordReset:async()=>{if(e?.email){f(!0);try{const{error:c}=await ie.auth.resetPasswordForEmail(e.email,{redirectTo:`${window.location.origin}/settings?type=recovery`});if(c)throw c;l("Password reset email sent!")}catch(c){console.error("Reset password error:",c),l(c.message||"Failed to send reset email","error")}finally{f(!1)}}},handleClearCache:()=>{["seenStories","font-size","data-saver","theme"].forEach(c=>localStorage.removeItem(c)),l("Cache cleared! Reloading..."),setTimeout(()=>window.location.reload(),1500)},handleDownloadData:async()=>{if(e){f(!0);try{const c={user:{id:e.id,handle:e.handle,name:e.name,email:e.email},exportDate:new Date().toISOString(),note:"This is a mock export of your Sysm data."},P=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),q=URL.createObjectURL(P),$=document.createElement("a");$.href=q,$.download=`sysm-data-${e.handle}.json`,$.click(),URL.revokeObjectURL(q),l("Data export started!")}catch{l("Failed to export data","error")}finally{f(!1)}}},handleDeleteAccount:()=>{window.confirm("Are you absolutely sure? This will permanently delete your account and all associated data. This action is irreversible.")&&(l("Account deletion request submitted. Logging out..."),setTimeout(g,2e3))},handleReportBug:()=>{window.prompt("Please describe the bug you found:")&&l("Bug reported! Thank you for your feedback.")}}};export{ft as a,ct as c,nt as d,mt as i,lt as l,ht as n,dt as o,gt as r,ut as s,yt as t,rt as u};
