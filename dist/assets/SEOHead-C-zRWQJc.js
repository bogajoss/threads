import{n as et}from"./rolldown-runtime-2JzG8er9.js";import{E as ft,f as ut,l as V,m as ht,s as gt,x as he}from"./framework-BpvJHMsq.js";import{n as bt}from"./query-PpD2gxIA.js";import{$t as De,At as pe,Bt as ce,Ft as jt,Gt as ee,Kt as vt,Lt as zt,Mt as kt,Nt,Pt as yt,Yt as wt,Zt as de,an as We,en as Ct,gt as _t,in as St,jt as Pt,ln as $t,lt as fe,rn as Ft,sn as Mt,t as tt,tn as Oe,wt as Rt,yt as It}from"./ui-libs-ydju28Yg.js";import{$ as T,C as Ue,Ct as st,F as Et,Ft as Lt,G as Ve,H as At,It as oe,J as He,K as Be,M as Dt,N as Z,O as Wt,P as Ot,Q as G,Rt as Ut,U as qe,W as Te,X as Ge,Y as Qe,Z as Q,a as Vt,at as Ht,bt as it,ct as ue,it as Bt,j as qt,jt as Tt,kt as Je,lt as Gt,nt as Qt,q as Ke,rt as Jt,st as Kt,tt as Xt,xt as Yt}from"./index-B0P19RxL.js";import{n as ge,t as be}from"./linkify-CvGdyZEF.js";import{d as Zt}from"./hooks-DfWcb2bF.js";var es=V(),g=et(ft(),1),t=et(ut(),1),ts=s=>{const e=(0,es.c)(21),{icon:i,count:o,label:l,onClick:f,active:r,activeColorClass:d}=s,p=d===void 0?"text-violet-600":d,u=i;let a;e[0]!==f?(a=C=>{C.stopPropagation(),f&&f(C)},e[0]=f,e[1]=a):a=e[1];const c=`${l} ${o!==void 0?`(${o})`:""}`,n=`group flex items-center gap-x-1 sm:gap-x-1.5 text-[12px] sm:text-[13px] font-bold transition-all py-1.5 px-2 -ml-2 rounded-xl active:scale-95 ${r?p:"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"}`,m=`rounded-full p-2 transition-colors ${r?"":"group-hover:bg-zinc-100 dark:group-hover:bg-zinc-800"}`,x=r?2.5:2,v=r?"fill-current":"";let k;e[2]!==u||e[3]!==x||e[4]!==v?(k=(0,t.jsx)(u,{size:18,strokeWidth:x,className:v}),e[2]=u,e[3]=x,e[4]=v,e[5]=k):k=e[5];let j;e[6]!==m||e[7]!==k?(j=(0,t.jsx)("div",{className:m,children:k}),e[6]=m,e[7]=k,e[8]=j):j=e[8];let N;e[9]!==l?(N=l&&(0,t.jsx)("span",{className:"hidden xs:inline",children:l}),e[9]=l,e[10]=N):N=e[10];let h;e[11]!==r||e[12]!==o?(h=o!=null&&(0,t.jsx)("span",{className:r?"font-bold":"",children:o||0}),e[11]=r,e[12]=o,e[13]=h):h=e[13];let _;return e[14]!==N||e[15]!==h||e[16]!==a||e[17]!==c||e[18]!==n||e[19]!==j?(_=(0,t.jsxs)("button",{onClick:a,"aria-label":c,className:n,children:[j,N,h]}),e[14]=N,e[15]=h,e[16]=a,e[17]=c,e[18]=n,e[19]=j,e[20]=_):_=e[20],_},X=ts,ss=V(),is=s=>{const e=(0,ss.c)(51),{currentUser:i,newComment:o,setNewComment:l,handleSubmitComment:f,loading:r,selectedFiles:d,setSelectedFiles:p,isUploading:u}=s;let a;e[0]!==d?(a=d===void 0?[]:d,e[0]=d,e[1]=a):a=e[1];const c=a,n=(0,g.useRef)(null);let m;e[2]!==p?(m=A=>{const O=Array.from(A.target.files);p&&p(H=>[...H,...O])},e[2]=p,e[3]=m):m=e[3];const x=m;let v;e[4]!==p?(v=A=>{p&&p(O=>O.filter((H,te)=>te!==A))},e[4]=p,e[5]=v):v=e[5];const k=v;if(!i){let A;return e[6]===Symbol.for("react.memo_cache_sentinel")?(A=(0,t.jsx)("div",{className:"p-6 text-center border-y border-zinc-100 dark:border-zinc-800 bg-zinc-50/30 dark:bg-zinc-900/10",children:(0,t.jsx)("p",{className:"text-zinc-500 text-sm",children:"Please login to join the conversation."})}),e[6]=A):A=e[6],A}let j;e[7]!==i.avatar||e[8]!==i.handle?(j=(0,t.jsx)(T,{src:i.avatar,alt:i.handle,className:"object-cover"}),e[7]=i.avatar,e[8]=i.handle,e[9]=j):j=e[9];let N;e[10]!==i.handle?.[0]?(N=i.handle?.[0]?.toUpperCase(),e[10]=i.handle?.[0],e[11]=N):N=e[11];let h;e[12]!==N?(h=(0,t.jsx)(G,{children:N}),e[12]=N,e[13]=h):h=e[13];let _;e[14]!==j||e[15]!==h?(_=(0,t.jsxs)(Q,{className:"size-9 border border-zinc-200 dark:border-zinc-700",children:[j,h]}),e[14]=j,e[15]=h,e[16]=_):_=e[16];let C;e[17]!==l?(C=A=>l(A.target.value),e[17]=l,e[18]=C):C=e[18];let S;e[19]!==o||e[20]!==C?(S=(0,t.jsx)("textarea",{id:"comment-input",className:"w-full bg-transparent outline-none text-base min-h-[60px] resize-none dark:text-white placeholder:text-zinc-500",placeholder:"Post your reply...",value:o,onChange:C}),e[19]=o,e[20]=C,e[21]=S):S=e[21];let M;e[22]!==k||e[23]!==c?(M=c.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-2 mb-2",children:c.map((A,O)=>(0,t.jsxs)("div",{className:"relative size-20 rounded-xl overflow-hidden border border-zinc-200 dark:border-zinc-800",children:[A.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(A),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"size-full flex items-center justify-center bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)(jt,{size:20,className:"text-zinc-500"})}),(0,t.jsx)("button",{onClick:()=>k(O),className:"absolute top-1 right-1 bg-black/60 text-white rounded-full p-1 hover:bg-black transition-colors",children:(0,t.jsx)(fe,{size:12})})]},O))}),e[22]=k,e[23]=c,e[24]=M):M=e[24];let R;e[25]===Symbol.for("react.memo_cache_sentinel")?(R=()=>n.current?.click(),e[25]=R):R=e[25];let P;e[26]===Symbol.for("react.memo_cache_sentinel")?(P=(0,t.jsx)("button",{type:"button",onClick:R,className:"text-violet-600 hover:bg-violet-50 dark:hover:bg-zinc-800 rounded-full p-2 transition-colors",title:"Attach media",children:(0,t.jsx)(wt,{size:20})}),e[26]=P):P=e[26];let I;e[27]!==x?(I=(0,t.jsxs)("div",{className:"flex text-violet-600 gap-1",children:[P,(0,t.jsx)("input",{type:"file",ref:n,onChange:x,multiple:!0,className:"hidden",accept:"image/*,video/*,application/pdf"})]}),e[27]=x,e[28]=I):I=e[28];let L;e[29]!==u||e[30]!==r||e[31]!==o||e[32]!==c.length?(L=!o.trim()&&c.length===0||r||u,e[29]=u,e[30]=r,e[31]=o,e[32]=c.length,e[33]=L):L=e[33];let U;e[34]!==u||e[35]!==r?(U=r||u?(0,t.jsx)(ee,{size:16,className:"animate-spin text-white mx-auto"}):"Reply",e[34]=u,e[35]=r,e[36]=U):U=e[36];let D;e[37]!==f||e[38]!==L||e[39]!==U?(D=(0,t.jsx)(At,{className:"!w-auto px-5 py-1.5 text-sm font-bold min-w-[70px]",onClick:f,disabled:L,children:U}),e[37]=f,e[38]=L,e[39]=U,e[40]=D):D=e[40];let z;e[41]!==I||e[42]!==D?(z=(0,t.jsxs)("div",{className:"flex justify-between items-center mt-2 pt-3 border-t border-zinc-100 dark:border-zinc-800",children:[I,D]}),e[41]=I,e[42]=D,e[43]=z):z=e[43];let w;e[44]!==S||e[45]!==M||e[46]!==z?(w=(0,t.jsxs)("div",{className:"flex-1",children:[S,M,z]}),e[44]=S,e[45]=M,e[46]=z,e[47]=w):w=e[47];let F;return e[48]!==w||e[49]!==_?(F=(0,t.jsx)("div",{className:"p-4 border-y border-zinc-100 dark:border-zinc-800 bg-zinc-50/30 dark:bg-zinc-900/10",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[_,w]})}),e[48]=w,e[49]=_,e[50]=F):F=e[50],F},nt=is,ns=V(),as=s=>{const e=(0,ns.c)(17),{file:i}=s;let o;e[0]===Symbol.for("react.memo_cache_sentinel")?(o=(0,t.jsx)("div",{className:"size-10 rounded-xl bg-violet-100 dark:bg-violet-900/30 flex items-center justify-center text-violet-600",children:(0,t.jsx)(Ft,{size:20})}),e[0]=o):o=e[0];let l;e[1]!==i.name?(l=(0,t.jsx)("div",{className:"text-sm font-bold truncate dark:text-white",children:i.name}),e[1]=i.name,e[2]=l):l=e[2];const f=i.size/1024/1024;let r;e[3]!==f?(r=f.toFixed(2),e[3]=f,e[4]=r):r=e[4];let d;e[5]!==r?(d=(0,t.jsxs)("div",{className:"text-xs text-zinc-500 uppercase",children:[r," MB"]}),e[5]=r,e[6]=d):d=e[6];let p;e[7]!==l||e[8]!==d?(p=(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[l,d]}),e[7]=l,e[8]=d,e[9]=p):p=e[9];let u;e[10]===Symbol.for("react.memo_cache_sentinel")?(u=(0,t.jsx)(Mt,{size:18}),e[10]=u):u=e[10];let a;e[11]!==i.name||e[12]!==i.url?(a=(0,t.jsx)("a",{href:i.url,download:i.name,className:"p-2 text-zinc-400 hover:text-violet-600 transition-colors",onClick:rs,children:u}),e[11]=i.name,e[12]=i.url,e[13]=a):a=e[13];let c;return e[14]!==p||e[15]!==a?(c=(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-3 p-3 rounded-2xl border border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/10 group hover:border-violet-500/30 transition-colors",children:[o,p,a]}),e[14]=p,e[15]=a,e[16]=c):c=e[16],c},ls=as;function rs(s){return s.stopPropagation()}var Bs=V(),os=V(),cs=s=>{const e=(0,os.c)(30),{url:i}=s;let o,l;e[0]!==i?(o=["link-preview",i],l=()=>Gt(i),e[0]=i,e[1]=o,e[2]=l):(o=e[1],l=e[2]);const f=!!i;let r;e[3]!==o||e[4]!==l||e[5]!==f?(r={queryKey:o,queryFn:l,staleTime:864e5,enabled:f},e[3]=o,e[4]=l,e[5]=f,e[6]=r):r=e[6];const{data:d,isLoading:p,isError:u}=bt(r);if(p){let h;return e[7]===Symbol.for("react.memo_cache_sentinel")?(h=(0,t.jsx)("div",{className:"mt-3 rounded-2xl border border-zinc-100 dark:border-zinc-800 overflow-hidden animate-pulse bg-zinc-50 dark:bg-zinc-900/50 h-24 flex items-center justify-center",children:(0,t.jsx)(De,{className:"text-zinc-300 dark:text-zinc-700 animate-spin",size:24})}),e[7]=h):h=e[7],h}if(u||!d||!d.title&&!d.image)return null;let a;e[8]!==d.image||e[9]!==d.title?(a=d.image&&(0,t.jsx)("div",{className:"w-full aspect-[1.91/1] overflow-hidden bg-zinc-100 dark:bg-zinc-900 border-b border-zinc-100 dark:border-zinc-800",children:(0,t.jsx)("img",{src:d.image,alt:d.title,className:"w-full h-full object-cover group-hover:scale-[1.02] transition-transform duration-500",onError:ms})}),e[8]=d.image,e[9]=d.title,e[10]=a):a=e[10];let c;e[11]===Symbol.for("react.memo_cache_sentinel")?(c=(0,t.jsx)(De,{size:12}),e[11]=c):c=e[11];let n;e[12]!==d.siteName?(n=(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-zinc-600 font-bold uppercase tracking-wider",children:[c,(0,t.jsx)("span",{children:d.siteName})]}),e[12]=d.siteName,e[13]=n):n=e[13];let m;e[14]!==d.title?(m=(0,t.jsx)("div",{className:"font-bold text-[15px] line-clamp-2 dark:text-white leading-snug group-hover:text-violet-700 transition-colors",children:d.title}),e[14]=d.title,e[15]=m):m=e[15];let x;e[16]!==d.description?(x=d.description&&(0,t.jsx)("p",{className:"text-xs text-zinc-600 dark:text-zinc-400 line-clamp-2 leading-relaxed",children:d.description}),e[16]=d.description,e[17]=x):x=e[17];let v;e[18]===Symbol.for("react.memo_cache_sentinel")?(v=(0,t.jsx)(St,{size:10}),e[18]=v):v=e[18];let k;e[19]!==i?(k=(0,t.jsxs)("div",{className:"pt-1 flex items-center gap-1 text-[11px] text-zinc-500 font-medium",children:[v,(0,t.jsx)("span",{className:"truncate",children:i})]}),e[19]=i,e[20]=k):k=e[20];let j;e[21]!==k||e[22]!==n||e[23]!==m||e[24]!==x?(j=(0,t.jsxs)("div",{className:"p-3.5 space-y-1",children:[n,m,x,k]}),e[21]=k,e[22]=n,e[23]=m,e[24]=x,e[25]=j):j=e[25];let N;return e[26]!==j||e[27]!==a||e[28]!==i?(N=(0,t.jsxs)("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"mt-3 flex flex-col rounded-2xl border border-zinc-100 dark:border-zinc-800 overflow-hidden bg-white dark:bg-zinc-950 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-all group shadow-sm",onClick:ds,children:[a,j]}),e[26]=j,e[27]=a,e[28]=i,e[29]=N):N=e[29],N},Xe=cs;function ds(s){return s.stopPropagation()}function ms(s){return s.target.style.display="none"}var xs=V(),ps=s=>{const e=(0,xs.c)(17),{src:i,poster:o}=s,l=(0,g.useRef)(null),{reportVisibility:f,unregister:r}=Xt(),{dataSaver:d}=Ht(),p=(0,g.useId)();let u;e[0]===Symbol.for("react.memo_cache_sentinel")?(u={play:()=>{const h=l.current?.plyr;h&&(h.muted=!0,h.play().catch(us))},pause:()=>{l.current?.plyr?.pause()}},e[0]=u):u=e[0];const a=u;let c,n;e[1]!==d||e[2]!==p||e[3]!==f||e[4]!==r?(c=()=>{const h=new IntersectionObserver(C=>{const[S]=C;f(p,d?0:S.intersectionRatio,a)},{threshold:[0,.6]}),_=l.current?.elements?.container;return _&&h.observe(_),()=>{r(p),_&&h.unobserve(_)}},n=[p,f,r,a,d],e[1]=d,e[2]=p,e[3]=f,e[4]=r,e[5]=c,e[6]=n):(c=e[5],n=e[6]),(0,g.useEffect)(c,n);let m;e[7]!==i?(m=[{src:i,type:"video/mp4"}],e[7]=i,e[8]=m):m=e[8];let x;e[9]!==o||e[10]!==m?(x={type:"video",sources:m,poster:o},e[9]=o,e[10]=m,e[11]=x):x=e[11];let v;e[12]===Symbol.for("react.memo_cache_sentinel")?(v={controls:["play-large","play","progress","current-time","mute","volume","fullscreen"],settings:["quality","speed"],ratio:"16:9",clickToPlay:!0,hideControls:!0,resetOnEnd:!0},e[12]=v):v=e[12];let k;e[13]!==x?(k={source:x,options:v},e[13]=x,e[14]=k):k=e[14];const j=k;let N;return e[15]!==j?(N=(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl shadow-sm border border-zinc-100 dark:border-zinc-800 bg-black",onClick:hs,children:(0,t.jsx)(tt,{ref:l,...j})}),e[15]=j,e[16]=N):N=e[16],N},fs=ps;function us(){}function hs(s){return s.stopPropagation()}var gs=V(),bs=s=>{const e=(0,gs.c)(3),{items:i}=s,o=i===void 0?[]:i,{openLightbox:l}=Qt();if(!o||o.length===0)return null;const f=Array.isArray(o)?o:[o],r=f.filter(vs),d=f.filter(zs),p=m=>{const x=r.filter(ks).map(Ns),v=r[m];l(x,x.indexOf(v.url||v.src))},u="mt-3 space-y-2",a=r.length>0&&(0,t.jsx)("div",{className:`grid gap-2 rounded-2xl overflow-hidden border border-zinc-100 dark:border-zinc-800 ${r.length===1?"grid-cols-1":r.length===2?"grid-cols-2 aspect-[16/9]":(r.length===3,"grid-cols-2 grid-rows-2 aspect-[16/9]")}`,children:r.map((m,x)=>(0,t.jsx)("div",{className:`relative overflow-hidden bg-zinc-100 dark:bg-zinc-900 cursor-pointer ${r.length===3&&x===0?"row-span-2":""}`,onClick:v=>{m.type==="image"&&(v.stopPropagation(),p(x))},children:m.type==="video"?(0,t.jsx)(fs,{src:m.url,poster:m.poster}):(0,t.jsx)("img",{src:m.url||m.src,className:"size-full object-cover hover:scale-[1.02] transition-transform duration-500",alt:"",loading:"lazy"})},x))}),c=d.map(ys);let n;return e[0]!==a||e[1]!==c?(n=(0,t.jsxs)("div",{className:u,children:[a,c]}),e[0]=a,e[1]=c,e[2]=n):n=e[2],n},js=bs;function vs(s){return s.type==="image"||s.type==="video"}function zs(s){return s.type==="file"}function ks(s){return s.type==="image"}function Ns(s){return s.url||s.src}function ys(s,e){return(0,t.jsx)(ls,{file:s},e)}var ws=V(),Cs=s=>{const e=(0,ws.c)(18),{poll:i,onVote:o}=s,l=i.options.reduce(_s,0),[f,r]=(0,g.useState)(null);let d;e[0]!==o||e[1]!==f?(d=x=>{f||(r(x),o&&o(x))},e[0]=o,e[1]=f,e[2]=d):d=e[2];const p=d;let u;if(e[3]!==p||e[4]!==i.options||e[5]!==l||e[6]!==f){let x;e[8]!==p||e[9]!==l||e[10]!==f?(x=(v,k)=>{const j=l>0?Math.round((v.votes+(f===v.id?1:0))/(l+(f?1:0))*100):0,N=f===v.id;return(0,t.jsxs)("div",{onClick:h=>{h.stopPropagation(),p(v.id)},className:`relative h-10 w-full rounded-xl overflow-hidden cursor-pointer border ${N?"border-violet-500 dark:border-violet-500":"border-zinc-200 dark:border-zinc-700"}`,children:[f&&(0,t.jsx)("div",{className:"absolute top-0 left-0 h-full bg-zinc-200 dark:bg-zinc-800 transition-all duration-500",style:{width:`${j}%`}}),(0,t.jsxs)("div",{className:"absolute inset-0 flex items-center justify-between px-4 z-10",children:[(0,t.jsxs)("span",{className:`font-medium text-sm ${N?"text-violet-600 font-bold":"text-zinc-700 dark:text-zinc-200"}`,children:[v.text," ",N&&(0,t.jsx)($t,{size:14,className:"inline ml-1 mb-0.5"})]}),f&&(0,t.jsxs)("span",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:[j,"%"]})]})]},v.id||k)},e[8]=p,e[9]=l,e[10]=f,e[11]=x):x=e[11],u=i.options.map(x),e[3]=p,e[4]=i.options,e[5]=l,e[6]=f,e[7]=u}else u=e[7];const a=l+(f?1:0),c=f?"6 days left":"Click to vote";let n;e[12]!==a||e[13]!==c?(n=(0,t.jsxs)("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 pl-1",children:[a," votes â€¢"," ",c]}),e[12]=a,e[13]=c,e[14]=n):n=e[14];let m;return e[15]!==u||e[16]!==n?(m=(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[u,n]}),e[15]=u,e[16]=n,e[17]=m):m=e[17],m},Ye=Cs;function _s(s,e){return s+e.votes}var at=({id:s,user:e,timeAgo:i,content:o,contentClass:l,media:f,quotedPost:r,stats:d,onClick:p,repostedBy:u,onUserClick:a,currentUser:c,showToast:n,poll:m,isDetail:x,initialComments:v,onDelete:k,isComment:j,onReply:N,community:h})=>{const _=he(),{liked:C,reposted:S,localStats:M,setLocalStats:R,handleLike:P,handleRepost:I}=Zt(s,d,c,n),{deletePost:L,updatePost:U}=Jt(),[D,z]=(0,g.useState)(v||[]),[w,F]=(0,g.useState)(""),[A,O]=(0,g.useState)(!1),[H,te]=(0,g.useState)(!1),[je,ve]=(0,g.useState)(!1),[lt,ze]=(0,g.useState)(!0),[me,ke]=(0,g.useState)([]),[rt,Ne]=(0,g.useState)(!1),[ye,se]=(0,g.useState)(!1),[xe,ie]=(0,g.useState)(!1),[J,we]=(0,g.useState)(o),[Y,Ce]=(0,g.useState)(f||[]),[ne,ae]=(0,g.useState)([]),[_e,Se]=(0,g.useState)(!1),[le,ot]=(0,g.useState)(!1),Pe=(0,g.useRef)(null),$e=(0,g.useRef)(D);(0,g.useEffect)(()=>{$e.current=D},[D]);const ct=async()=>{const b=JSON.stringify(Y)!==JSON.stringify(f||[])||ne.length>0;if(!J.trim()||J===o&&!b){ie(!1);return}Se(!0);try{const y=[];for(const $ of ne){const E=await ue($);y.push(E)}await U(s,{content:J,media:[...Y,...y]}),ae([]),ie(!1),n&&n("Post updated")}catch(y){console.error("Failed to update post:",y),n&&n("Failed to update post")}finally{Se(!1)}},Fe=async b=>{b&&b.stopPropagation();try{await L(s),n&&n("Post deleted successfully"),k&&k(s)}catch(y){console.error("Failed to delete post:",y),n&&n("Failed to delete post")}finally{se(!1)}},re=(0,g.useCallback)(async(b=!1)=>{if(s){b?ve(!0):O(!0);try{const y=$e.current,$=await st(s,b&&y.length>0?y[y.length-1].created_at:null,10);$.length<10?ze(!1):ze(!0),z(b?E=>[...E,...$]:$)}catch(y){console.error("Failed to load comments:",y)}finally{O(!1),ve(!1)}}},[s]);(0,g.useEffect)(()=>{x&&s&&re()},[x,s,re]);const dt=async b=>{if(b.preventDefault(),!(!w.trim()&&me.length===0||!c)){te(!0),Ne(!0);try{const y=[];for(const $ of me){const E=await ue($);y.push(E)}await it(s,c.id,w,y),F(""),ke([]),R($=>({...$,comments:($.comments||0)+1})),n&&n("Reply posted!"),re()}catch(y){console.error("Failed to post comment:",y),n&&n("Failed to post reply.")}finally{te(!1),Ne(!1)}}},mt=b=>{b.stopPropagation();const y=`${window.location.origin}/post/${s}`;navigator.clipboard.writeText(y),n&&n("Link copied to clipboard!")},Me=({trigger:b})=>(0,t.jsxs)(qt,{children:[(0,t.jsx)(Et,{asChild:!0,onClick:y=>y.stopPropagation(),children:b}),(0,t.jsxs)(Dt,{align:"end",className:"w-48 rounded-xl bg-white dark:bg-zinc-900 border-zinc-100 dark:border-zinc-800",children:[(0,t.jsxs)(Z,{className:"gap-2 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-800 py-2.5",onClick:mt,children:[(0,t.jsx)(vt,{size:16}),(0,t.jsx)("span",{children:"Copy link to post"})]}),!j&&(0,t.jsxs)(Z,{className:"gap-2 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-800 py-2.5",onClick:y=>{y.stopPropagation(),n&&n("Post reported")},children:[(0,t.jsx)(Ct,{size:16}),(0,t.jsx)("span",{children:"Report post"})]}),!Re&&(0,t.jsxs)(Z,{className:"gap-2 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-800 py-2.5 text-rose-500 focus:text-rose-500",onClick:y=>{y.stopPropagation(),n&&n("User blocked")},children:[(0,t.jsx)(_t,{size:16}),(0,t.jsxs)("span",{children:["Block @",e.handle]})]}),Re&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Ot,{className:"bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsxs)(Z,{className:"gap-2 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-900 py-2.5",onClick:y=>{y.stopPropagation(),ie(!0)},children:[(0,t.jsx)(Nt,{size:16}),(0,t.jsx)("span",{children:"Edit post"})]}),(0,t.jsxs)(Z,{className:"gap-2 cursor-pointer focus:bg-rose-50 dark:focus:bg-rose-900/20 py-2.5 text-rose-500 focus:text-rose-500",onClick:y=>{y.stopPropagation(),se(!0)},children:[(0,t.jsx)(It,{size:16}),(0,t.jsx)("span",{children:"Delete post"})]})]})]})]}),Re=c?.handle===e.handle,Ie=b=>{if(!b)return null;const y=xe?Y:b;return!y||Array.isArray(y)&&y.length===0?null:xe?(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,t.jsxs)("div",{className:"grid gap-2 grid-cols-2 sm:grid-cols-3",children:[Y.map(($,E)=>(0,t.jsxs)("div",{className:"relative aspect-square rounded-xl overflow-hidden border border-zinc-200 dark:border-zinc-800 group",children:[$.type==="video"?(0,t.jsx)("div",{className:"size-full bg-zinc-100 dark:bg-zinc-900 flex items-center justify-center",children:(0,t.jsx)(Oe,{size:24,className:"text-zinc-400"})}):(0,t.jsx)("img",{src:$.url||$.src,className:"size-full object-cover",alt:""}),(0,t.jsx)("button",{onClick:B=>{B.stopPropagation(),Ce(q=>q.filter((K,W)=>W!==E))},className:"absolute top-1.5 right-1.5 size-7 rounded-full bg-black/60 text-white flex items-center justify-center hover:bg-black transition-colors",children:(0,t.jsx)(fe,{size:16})})]},`old-${E}`)),ne.map(($,E)=>(0,t.jsxs)("div",{className:"relative aspect-square rounded-xl overflow-hidden border-2 border-dashed border-violet-500 bg-violet-50/10 group",children:[$.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL($),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"size-full flex items-center justify-center",children:(0,t.jsx)(Oe,{size:24,className:"text-violet-500 animate-pulse"})}),(0,t.jsx)("button",{onClick:B=>{B.stopPropagation(),ae(q=>q.filter((K,W)=>W!==E))},className:"absolute top-1.5 right-1.5 size-7 rounded-full bg-black/60 text-white flex items-center justify-center hover:bg-black transition-colors",children:(0,t.jsx)(fe,{size:16})}),(0,t.jsx)("div",{className:"absolute bottom-1 left-1 bg-violet-600 text-white text-[8px] font-bold px-1 rounded",children:"NEW"})]},`new-${E}`)),Y.length+ne.length<4&&(0,t.jsxs)("button",{onClick:$=>{$.stopPropagation(),Pe.current?.click()},className:"relative aspect-square rounded-xl border-2 border-dashed border-zinc-200 dark:border-zinc-800 flex flex-col items-center justify-center gap-1 text-zinc-400 hover:text-violet-500 hover:border-violet-500 hover:bg-violet-50/5 transition-all",children:[(0,t.jsx)(Pt,{size:20}),(0,t.jsx)("span",{className:"text-[10px] font-bold",children:"Add Media"})]})]}),(0,t.jsx)("input",{type:"file",ref:Pe,onChange:$=>{const E=Array.from($.target.files);ae(B=>[...B,...E])},multiple:!0,className:"hidden",accept:"image/*,video/*"})]}):g.isValidElement(y)?y:(0,t.jsx)(js,{items:y})},Ee=(b,y)=>{const $=typeof b=="string"&&Ut(b);if(xe)return(0,t.jsxs)("div",{className:"flex flex-col gap-2 mt-2",onClick:E=>E.stopPropagation(),children:[(0,t.jsx)(Vt,{value:J,onChange:E=>we(E.target.value),className:`min-h-[100px] w-full bg-zinc-50 dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800 rounded-xl focus:ring-violet-500 ${$?"font-bangla text-lg":"font-english"}`,autoFocus:!0}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)("button",{onClick:()=>{ie(!1),we(o),Ce(f||[]),ae([])},className:"px-4 py-1.5 text-sm font-bold text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300 transition-colors",children:"Cancel"}),(0,t.jsx)("button",{onClick:ct,disabled:_e||!J.trim()||J===o,className:"px-4 py-1.5 text-sm font-bold bg-violet-600 text-white rounded-full hover:bg-violet-700 disabled:opacity-50 transition-all active:scale-95",children:_e?"Saving...":"Save"})]})]});if(typeof b=="string"){const E=!x&&b.length>280,B=E&&!le?b.substring(0,280):b;return(0,t.jsxs)("div",{className:`whitespace-pre-line ${y||""} ${$?"font-bangla text-[1.15em] leading-relaxed":"font-english text-[1.05em]"}`,children:[(0,t.jsx)(ge,{options:{...be,render:({attributes:q,content:K})=>{const{href:W,...Le}=q,Ae=!W.startsWith("/")&&(W.startsWith("http")||W.startsWith("www"));return W.startsWith("/u/")||W.startsWith("/tags/")||W.startsWith("/c/")||W.startsWith("/explore")?(0,t.jsx)("span",{...Le,onClick:pt=>{pt.stopPropagation(),_(W)},children:K},K):(0,t.jsx)("a",{href:W,...Le,target:Ae?"_blank":void 0,rel:Ae?"noopener noreferrer":void 0,children:K},K)}},children:B}),E&&!le&&"...",E&&(0,t.jsx)("button",{onClick:q=>{q.stopPropagation(),ot(!le)},className:"ml-1 text-rose-600 dark:text-rose-400 font-bold hover:underline cursor-pointer",children:le?"Show less":"See more"})]})}return b},xt=b=>{F(y=>{const $=`@${b} `;return y.includes($)?y:y+$}),document.getElementById("comment-input")?.focus()};return x?(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("article",{className:"p-5 dark:bg-black",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsx)("button",{className:"shrink-0",onClick:()=>a&&a(e.handle),children:(0,t.jsxs)(Q,{className:"size-12 border border-zinc-200 dark:border-zinc-700",children:[(0,t.jsx)(T,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(G,{children:e.handle[0]?.toUpperCase()})]})}),(0,t.jsxs)("div",{className:"flex flex-col min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 min-w-0 max-w-full",children:[(0,t.jsxs)("button",{className:"font-bold text-base sm:text-lg hover:underline text-zinc-900 dark:text-white flex items-center gap-1 shrink-0",onClick:()=>a&&a(e.handle),children:[(0,t.jsx)("span",{className:"max-w-[200px] sm:max-w-none truncate",children:e.handle}),e.verified&&(0,t.jsx)(Ue,{})]}),h&&(0,t.jsxs)("div",{className:"flex items-center gap-1 min-w-0 text-zinc-500",children:[(0,t.jsx)("span",{className:"text-zinc-400 font-medium shrink-0 text-xs sm:text-sm",children:">"}),(0,t.jsxs)("button",{className:"flex items-center gap-1 font-bold text-zinc-900 dark:text-zinc-100 hover:underline text-[14px] sm:text-[15px]",onClick:b=>{b.stopPropagation(),_(`/c/${h.handle}`)},children:[(0,t.jsxs)(Q,{className:"size-4 bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shrink-0",children:[(0,t.jsx)(T,{src:h.avatar,alt:h.name,className:"object-cover"}),(0,t.jsx)(G,{className:"text-[8px] font-bold text-zinc-500",children:h.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"truncate max-w-[200px] sm:max-w-none",children:h.name})]})]})]})}),(0,t.jsxs)("span",{className:"text-xs sm:text-sm text-zinc-500 dark:text-zinc-400 font-medium",children:["@",e.handle]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 -mt-1",children:[(0,t.jsx)("span",{className:"text-zinc-500 dark:text-zinc-400 text-[13px] sm:text-sm whitespace-nowrap",children:i||"Recent"}),(0,t.jsx)(Me,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"text-zinc-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full p-2 transition-colors",children:(0,t.jsx)(We,{size:20})})})]})]}),(0,t.jsx)("div",{className:"break-words text-zinc-900 dark:text-zinc-100 mt-4 text-lg sm:text-xl leading-relaxed sm:leading-8 whitespace-pre-line",children:Ee(o,l)}),oe(o)&&(0,t.jsx)(Xe,{url:oe(o)}),Ie(f),m&&(0,t.jsx)(Ye,{poll:m}),r&&(0,t.jsx)("div",{className:"mt-4 border border-zinc-200 dark:border-zinc-700 rounded-2xl overflow-hidden shadow-sm",children:(0,t.jsx)(Ze,{...r})}),(0,t.jsxs)("div",{className:"border-b border-zinc-100 dark:border-zinc-800 pb-4 mt-4 flex items-center gap-x-6 text-zinc-500 dark:text-zinc-400 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:M.likes||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Likes"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:M.comments||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Comments"})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex w-full items-center justify-around py-1",children:[(0,t.jsx)(X,{icon:de,label:"Like",onClick:P,active:C,activeColorClass:"text-rose-500"}),!j&&(0,t.jsx)(X,{icon:pe,label:"Repost",onClick:I,active:S,activeColorClass:"text-emerald-500"}),(0,t.jsx)(X,{icon:ce,label:"Comment",onClick:()=>document.getElementById("comment-input")?.focus()})]})]}),(0,t.jsx)(nt,{currentUser:c,newComment:w,setNewComment:F,handleSubmitComment:dt,loading:H,selectedFiles:me,setSelectedFiles:ke,isUploading:rt}),(0,t.jsx)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:A?(0,t.jsx)("div",{className:"p-8 flex justify-center",children:(0,t.jsx)(ee,{className:"animate-spin text-violet-500"})}):(0,t.jsxs)(t.Fragment,{children:[lt&&D.length>0&&(0,t.jsxs)("button",{onClick:()=>re(!0),disabled:je,className:"w-full py-3 text-sm font-bold text-violet-600 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-colors flex items-center justify-center gap-2",children:[je&&(0,t.jsx)(ee,{size:14,className:"animate-spin"}),"View more replies"]}),D.map(b=>(0,t.jsx)(at,{...b,isComment:!0,onReply:xt,onUserClick:a,currentUser:c,showToast:n,onDelete:y=>z($=>$.filter(E=>E.id!==y))},b.id))]})}),(0,t.jsx)(qe,{open:ye,onOpenChange:se,children:(0,t.jsxs)(Be,{onClick:b=>b.stopPropagation(),children:[(0,t.jsxs)(Qe,{children:[(0,t.jsx)(Ge,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ke,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(He,{children:[(0,t.jsx)(Ve,{onClick:b=>b.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Te,{onClick:Fe,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]}):(0,t.jsxs)("article",{onClick:p,className:`p-4 transition-all ${j?"bg-transparent border-b border-zinc-100/50 dark:border-zinc-800/50 hover:bg-zinc-50/50 dark:hover:bg-zinc-800/30 last:border-0":"mb-4 bg-white dark:bg-black rounded-xl hover:shadow-md"} ${p?"cursor-pointer":""}`,children:[u&&(0,t.jsxs)("div",{className:"mb-2 flex items-center space-x-1.5 text-[13px] text-zinc-600 font-semibold ml-1",children:[(0,t.jsx)(pe,{size:14,className:"text-zinc-500"}),(0,t.jsx)("span",{className:"hover:underline cursor-pointer flex items-center text-zinc-700 dark:text-zinc-300",onClick:b=>{b.stopPropagation(),a&&a(u.handle)},children:(0,t.jsx)("span",{className:"truncate max-w-[150px]",children:typeof u=="object"?u.name:u})}),(0,t.jsx)("span",{className:"text-zinc-500",children:"reposted"})]}),(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsx)("button",{className:"shrink-0 group",onClick:b=>{b.stopPropagation(),a&&a(e.handle)},children:(0,t.jsxs)(Q,{className:"size-11 border border-zinc-200 dark:border-zinc-700 group-hover:brightness-95 transition-all",children:[(0,t.jsx)(T,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(G,{children:e.handle[0]?.toUpperCase()})]})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex w-full items-start justify-between",children:[(0,t.jsx)("div",{className:"flex flex-col min-w-0 flex-1",children:(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 min-w-0 max-w-full",children:[(0,t.jsxs)("button",{className:"font-bold text-[15px] hover:underline text-zinc-900 dark:text-white flex items-center gap-1 shrink-0",onClick:b=>{b.stopPropagation(),a&&a(e.handle)},children:[(0,t.jsx)("span",{className:"truncate max-w-[160px] sm:max-w-none",children:e.handle}),e.verified&&(0,t.jsx)(Ue,{})]}),h&&(0,t.jsxs)("div",{className:"flex items-center gap-1 min-w-0 text-zinc-500",children:[(0,t.jsx)("span",{className:"text-zinc-400 font-medium shrink-0 text-xs sm:text-sm",children:">"}),(0,t.jsxs)("button",{className:"flex items-center gap-1 font-bold text-zinc-900 dark:text-zinc-100 hover:underline text-[14px] sm:text-[15px] min-w-0",onClick:b=>{b.stopPropagation(),_(`/c/${h.handle}`)},children:[(0,t.jsxs)(Q,{className:"size-4 bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shrink-0",children:[(0,t.jsx)(T,{src:h.avatar,alt:h.name,className:"object-cover"}),(0,t.jsx)(G,{className:"text-[8px] font-bold text-zinc-500",children:h.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"truncate max-w-[160px] md:max-w-none",children:h.name})]})]})]})})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 -mt-1",children:[(0,t.jsx)("span",{className:"text-zinc-500 dark:text-zinc-400 text-[13px] sm:text-sm whitespace-nowrap",children:i||"Recent"}),(0,t.jsx)(Me,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"text-zinc-500 hover:bg-zinc-100 hover:text-zinc-700 dark:hover:bg-zinc-800 dark:hover:text-zinc-200 rounded-full p-2 -mr-2 transition-colors",children:(0,t.jsx)(We,{size:18})})})]})]}),(0,t.jsxs)("div",{className:"break-words text-zinc-900 dark:text-zinc-100 mt-1 whitespace-pre-line text-sm sm:text-[15px] leading-relaxed",children:[Ee(o,l),oe(o)&&(0,t.jsx)(Xe,{url:oe(o)}),Ie(f),m&&(0,t.jsx)(Ye,{poll:m,onVote:()=>n&&n("Voted!")}),r&&(0,t.jsx)("div",{className:"mt-3 border border-zinc-200 dark:border-zinc-700 rounded-2xl overflow-hidden bg-white dark:bg-zinc-900 hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors cursor-pointer",onClick:b=>b.stopPropagation(),children:(0,t.jsx)(Ze,{...r})})]}),(0,t.jsx)("div",{className:"mt-3 flex w-full flex-wrap items-center justify-between gap-3 pr-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-x-6 sm:gap-x-8",children:[(0,t.jsx)(X,{icon:de,label:"Like",count:M.likes,active:C,onClick:P,activeColorClass:"text-rose-500"}),!j&&(0,t.jsx)(X,{icon:pe,label:"Repost",count:M.mirrors,active:S,onClick:I,activeColorClass:"text-emerald-500"}),(0,t.jsx)(X,{icon:ce,label:"Comment",count:M.comments,onClick:b=>{j&&N?(b.stopPropagation(),N(e.handle)):p&&p(b)}})]})})]})]}),(0,t.jsx)(qe,{open:ye,onOpenChange:se,children:(0,t.jsxs)(Be,{onClick:b=>b.stopPropagation(),children:[(0,t.jsxs)(Qe,{children:[(0,t.jsx)(Ge,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ke,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(He,{children:[(0,t.jsx)(Ve,{onClick:b=>b.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Te,{onClick:Fe,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})},Ss=at,Ps=V(),$s=s=>{const e=(0,Ps.c)(30),{user:i,time:o,content:l}=s,f=he();let r;e[0]!==i.avatar||e[1]!==i.handle?(r=(0,t.jsx)(T,{src:i.avatar,alt:i.handle}),e[0]=i.avatar,e[1]=i.handle,e[2]=r):r=e[2];let d;e[3]!==i.handle[0]?(d=i.handle[0]?.toUpperCase(),e[3]=i.handle[0],e[4]=d):d=e[4];let p;e[5]!==d?(p=(0,t.jsx)(G,{children:d}),e[5]=d,e[6]=p):p=e[6];let u;e[7]!==r||e[8]!==p?(u=(0,t.jsxs)(Q,{className:"size-6",children:[r,p]}),e[7]=r,e[8]=p,e[9]=u):u=e[9];let a;e[10]!==i.handle?(a=(0,t.jsx)("span",{className:"font-semibold text-sm",children:i.handle}),e[10]=i.handle,e[11]=a):a=e[11];let c;e[12]!==u||e[13]!==a?(c=(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[u,a]}),e[12]=u,e[13]=a,e[14]=c):c=e[14];let n;e[15]!==o?(n=(0,t.jsx)("span",{className:"text-zinc-500 text-xs sm:text-sm",children:o}),e[15]=o,e[16]=n):n=e[16];let m;e[17]!==c||e[18]!==n?(m=(0,t.jsxs)("div",{className:"flex items-center justify-between gap-x-2 mb-2",children:[c,n]}),e[17]=c,e[18]=n,e[19]=m):m=e[19];let x;e[20]!==f?(x={...be,render:N=>{const{attributes:h,content:_}=N,{href:C,...S}=h,M=!C.startsWith("/")&&(C.startsWith("http")||C.startsWith("www"));return C.startsWith("/u/")||C.startsWith("/tags/")||C.startsWith("/c/")||C.startsWith("/explore")?(0,t.jsx)("span",{...S,onClick:R=>{R.stopPropagation(),f(C)},children:_},_):(0,t.jsx)("a",{href:C,...S,target:M?"_blank":void 0,rel:M?"noopener noreferrer":void 0,onClick:Fs,children:_},_)}},e[20]=f,e[21]=x):x=e[21];let v;e[22]!==l?(v=(0,t.jsx)("p",{className:"text-sm text-zinc-800 dark:text-zinc-300 whitespace-pre-line",children:l}),e[22]=l,e[23]=v):v=e[23];let k;e[24]!==v||e[25]!==x?(k=(0,t.jsx)(ge,{options:x,children:v}),e[24]=v,e[25]=x,e[26]=k):k=e[26];let j;return e[27]!==k||e[28]!==m?(j=(0,t.jsxs)("div",{className:"p-4",children:[m,k]}),e[27]=k,e[28]=m,e[29]=j):j=e[29],j},Ze=$s;function Fs(s){return s.stopPropagation()}var Ms=g.memo(({reel:s,isActive:e,isMuted:i})=>{const o=he(),{currentUser:l}=Kt(),{addToast:f}=Bt(),r=(0,g.useRef)(null),[d,p]=(0,g.useState)(!1),[u,a]=(0,g.useState)(!1),[c,n]=(0,g.useState)(null),[m,x]=(0,g.useState)(!1),[v,k]=(0,g.useState)(s.stats?.likes||0),[j,N]=(0,g.useState)(!1),[h,_]=(0,g.useState)(0),C=(0,g.useRef)(null),S=(0,g.useMemo)(()=>Array.isArray(s.media)?s.media[0]?.src||s.media[0]?.url:s.media?.src||s.media?.url||s.url,[s.media,s.url]);(0,g.useEffect)(()=>{let z;const w=r.current?.plyr;return w&&(e?z=setTimeout(()=>{typeof w.play=="function"&&w.play().catch(()=>{w&&(w.muted=!0,w.play().catch(()=>{}))})},100):typeof w.pause=="function"&&w.pause()),()=>{z&&clearTimeout(z)}},[e]),(0,g.useEffect)(()=>{if(!l?.id||!e)return;(async()=>{try{const[w,F]=await Promise.all([Yt(s.id,l.id),Tt(l.id,s.user?.id)]);x(w),N(F)}catch(w){console.error("Failed to check interaction status:",w)}})()},[s.id,l?.id,e,s.user?.id]),(0,g.useEffect)(()=>{const z=r.current?.plyr;z&&(z.muted=i)},[i]),(0,g.useEffect)(()=>{const z=r.current?.plyr;if(!z||!e)return;const w=()=>{const F=z.currentTime,A=z.duration;A>0&&_(F/A*100)};if(typeof z.on=="function")return z.on("timeupdate",w),()=>{typeof z.off=="function"&&z.off("timeupdate",w)}},[e]);const M=z=>{z.target.closest("button")||z.target.closest("a")||(C.current?(clearTimeout(C.current),C.current=null,P()):C.current=setTimeout(()=>{C.current=null,R()},200))},R=()=>{const z=r.current?.plyr;z&&(z.paused?(z.play().catch(()=>{}),n("play")):(z.pause(),n("pause")),setTimeout(()=>n(null),500))},P=async()=>{if(l&&(p(!0),setTimeout(()=>p(!1),800),!m)){x(!0),k(z=>z+1);try{await Je(s.id,l.id)}catch{x(!1),k(z=>z-1)}}},I=async z=>{if(z.stopPropagation(),!l)return;const w=!m;x(w),k(F=>w?F+1:F-1);try{await Je(s.id,l.id)}catch{x(!w),k(F=>w?F-1:F+1)}},L=async z=>{if(z.stopPropagation(),!l)return;const w=!j;N(w);try{await Lt(l.id,s.user?.id)}catch{N(!w)}},U=z=>{z.stopPropagation();const w=`${window.location.origin}/reels?id=${s.id}`;navigator.clipboard.writeText(w),f("Link copied to clipboard!")},D=(0,g.useMemo)(()=>({source:{type:"video",sources:[{src:S,type:"video/mp4"}]},options:{controls:[],loop:{active:!0},clickToPlay:!0,ratio:"9:16"}}),[S]);return(0,t.jsxs)("div",{"data-id":s.id,className:"reel-item relative h-screen w-full bg-black snap-start flex items-center justify-center overflow-hidden cursor-pointer",onClick:M,children:[(0,t.jsx)("div",{className:"w-full h-full max-w-[450px]",children:(0,t.jsx)(tt,{ref:r,...D})}),d&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-50",children:(0,t.jsx)("div",{className:"animate-in zoom-in-50 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)(de,{size:120,fill:"white",className:"text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.4)] scale-125"})})}),c&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-50",children:(0,t.jsx)("div",{className:"animate-in fade-in zoom-in-90 scale-100 animate-out zoom-out-110 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)("div",{className:"p-8 bg-white/10 backdrop-blur-md rounded-full border border-white/20 shadow-2xl",children:c==="play"?(0,t.jsx)(kt,{size:50,fill:"white",className:"text-white ml-1.5"}):(0,t.jsx)(yt,{size:50,fill:"white",className:"text-white"})})})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/60 pointer-events-none"}),(0,t.jsxs)("div",{className:"absolute bottom-20 left-4 right-16 text-white pointer-events-none",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3 pointer-events-auto",children:[(0,t.jsxs)(ht,{to:`/u/${s.user?.handle}`,className:"flex items-center gap-2 hover:opacity-80 transition-opacity",onClick:z=>z.stopPropagation(),children:[(0,t.jsxs)(Q,{className:"size-10 border-2 border-white",children:[(0,t.jsx)(T,{src:s.user?.avatar,alt:s.user?.handle,className:"object-cover"}),(0,t.jsx)(G,{children:s.user?.handle?.[0]?.toUpperCase()})]}),(0,t.jsxs)("span",{className:"font-bold",children:["@",s.user?.handle]})]}),l?.id!==s.user?.id&&(0,t.jsx)("button",{className:`text-xs font-bold px-4 py-1.5 rounded-full ml-2 transition-all active:scale-95 ${j?"bg-transparent border border-white/50 text-white":"bg-white text-black hover:bg-zinc-200"}`,onClick:L,children:j?"Following":"Follow"})]}),(0,t.jsx)(ge,{options:{...be,render:({attributes:z,content:w})=>{const{href:F,...A}=z,O=!F.startsWith("/")&&(F.startsWith("http")||F.startsWith("www"));return F.startsWith("/u/")||F.startsWith("/tags/")||F.startsWith("/c/")||F.startsWith("/explore")?(0,t.jsx)("span",{...A,className:"text-white font-bold hover:underline cursor-pointer",onClick:H=>{H.stopPropagation(),o(F)},children:w},w):(0,t.jsx)("a",{href:F,...A,className:"text-white hover:underline",target:O?"_blank":void 0,rel:O?"noopener noreferrer":void 0,onClick:H=>H.stopPropagation(),children:w},w)}},children:(0,t.jsx)("p",{className:"text-sm mb-3 line-clamp-2",children:s.content})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[(0,t.jsx)(zt,{size:14,className:"animate-spin-slow"}),(0,t.jsxs)("span",{children:["Original Audio - ",s.user?.handle]})]})]}),(0,t.jsxs)("div",{className:"absolute bottom-20 right-2 flex flex-col items-center gap-6 z-10",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1 pointer-events-auto",children:[(0,t.jsx)("button",{className:`p-3 rounded-full backdrop-blur-md transition-all active:scale-90 ${m?"bg-rose-500/20 text-rose-500":"bg-zinc-800/50 text-white hover:bg-zinc-700"}`,onClick:I,children:(0,t.jsx)(de,{size:28,fill:m?"currentColor":"none"})}),(0,t.jsx)("span",{className:"text-white text-xs font-bold",children:v})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1 pointer-events-auto",children:[(0,t.jsx)("button",{className:"p-3 bg-zinc-800/50 rounded-full text-white backdrop-blur-md hover:bg-zinc-700 transition-colors active:scale-90",onClick:z=>{z.stopPropagation(),a(!0)},children:(0,t.jsx)(ce,{size:28})}),(0,t.jsx)("span",{className:"text-white text-xs font-bold",children:s.stats?.comments||0})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1 pointer-events-auto",children:[(0,t.jsx)("button",{className:"p-3 bg-zinc-800/50 rounded-full text-white backdrop-blur-md hover:bg-zinc-700 transition-colors active:scale-90",onClick:U,children:(0,t.jsx)(Rt,{size:28})}),(0,t.jsx)("span",{className:"text-white text-xs font-bold",children:s.stats?.shares||0})]})]}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-[3px] bg-white/20 z-50",children:(0,t.jsx)("div",{className:"h-full bg-white transition-all duration-100 ease-linear shadow-[0_0_8px_rgba(255,255,255,0.8)]",style:{width:`${h}%`}})}),(0,t.jsx)(Is,{isOpen:u,onClose:()=>a(!1),reelId:s.id,currentUser:l,showToast:f})]})},(s,e)=>s.isActive===e.isActive&&s.reel.id===e.reel.id&&s.isMuted===e.isMuted),qs=Ms,Rs=({isOpen:s,onClose:e,reelId:i,currentUser:o,showToast:l})=>{const[f,r]=(0,g.useState)([]),[d,p]=(0,g.useState)(!1),[u,a]=(0,g.useState)(!1),[c,n]=(0,g.useState)(""),[m,x]=(0,g.useState)([]),[v,k]=(0,g.useState)(!1),[j,N]=(0,g.useState)(!0),[h,_]=(0,g.useState)(!1),C=(0,g.useRef)(f);(0,g.useEffect)(()=>{C.current=f},[f]);const S=(0,g.useCallback)(async(R=!1)=>{if(i){R?_(!0):p(!0);try{const P=C.current,I=await st(i,R&&P.length>0?P[P.length-1].created_at:null,10);I.length<10?N(!1):N(!0),r(R?L=>[...L,...I]:I)}catch(P){console.error("Failed to load comments:",P),l&&l("Failed to load comments","error")}finally{p(!1),_(!1)}}},[i,l]);(0,g.useEffect)(()=>{s&&i?S():(r([]),N(!0))},[s,i,S]);const M=async R=>{if(R.preventDefault(),!(!c.trim()&&m.length===0||!o)){a(!0),k(!0);try{const P=[];for(const I of m){const L=await ue(I);P.push(L)}await it(i,o.id,c,P),n(""),x([]),l&&l("Reply posted!"),S()}catch(P){console.error("Failed to post comment:",P),l&&l("Failed to post reply.","error")}finally{a(!1),k(!1)}}};return(0,t.jsx)(Wt,{isOpen:s,onClose:e,className:"max-sm:h-[95dvh] sm:max-w-xl h-[85vh] flex flex-col !p-0",children:(0,t.jsxs)("div",{className:"flex flex-col h-full overflow-hidden bg-white dark:bg-zinc-900",children:[(0,t.jsxs)("div",{className:"px-5 py-4 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-center shrink-0 relative bg-white dark:bg-zinc-900",children:[(0,t.jsx)("h2",{className:"text-base font-bold dark:text-white",children:"Comments"}),(0,t.jsx)("div",{className:"absolute right-5 w-8 h-1 bg-zinc-200 dark:bg-zinc-800 rounded-full sm:hidden top-2 transform -translate-y-1/2 left-1/2 -translate-x-1/2"})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800",children:d?(0,t.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,t.jsx)(ee,{className:"animate-spin text-violet-500",size:32})}):f.length>0?(0,t.jsxs)("div",{className:"flex flex-col",children:[f.map(R=>(0,t.jsx)(Ss,{...R,isComment:!0,currentUser:o,showToast:l,onDelete:P=>r(I=>I.filter(L=>L.id!==P))},R.id)),j&&(0,t.jsxs)("button",{onClick:()=>S(!0),disabled:h,className:"w-full py-6 text-sm font-bold text-violet-600 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-colors flex items-center justify-center gap-2",children:[h&&(0,t.jsx)(ee,{size:16,className:"animate-spin"}),"View more replies"]})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] text-center text-zinc-500 p-8",children:[(0,t.jsx)("div",{className:"size-16 rounded-full bg-zinc-100 dark:bg-zinc-900 flex items-center justify-center mb-4",children:(0,t.jsx)(ce,{size:32,className:"text-zinc-400"})}),(0,t.jsx)("p",{className:"font-bold text-lg dark:text-zinc-300",children:"No comments yet"}),(0,t.jsx)("p",{className:"text-sm dark:text-zinc-500",children:"Be the first to share what you think!"})]})}),(0,t.jsx)("div",{className:"bg-white dark:bg-zinc-900 shrink-0",children:(0,t.jsx)(nt,{currentUser:o,newComment:c,setNewComment:n,handleSubmitComment:M,loading:u,selectedFiles:m,setSelectedFiles:x,isUploading:v})})]})})},Is=Rs,Es=V(),Ls=s=>{const e=(0,Es.c)(41),{title:i,description:o,image:l,url:f,type:r}=s,d=r===void 0?"website":r;let p;if(l)p=l;else if(i==="Home"||i==="Home Feed")p="/welcome-banner.webp";else{let L;e[0]!==i?(L=encodeURIComponent(i?i.replace(" | Sysm",""):"Sysm"),e[0]=i,e[1]=L):L=e[1],p=`https://og-image.vercel.app/${L}.png?theme=dark&md=1&fontSize=100px&images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fvercel-triangle-white.svg`}const u=i?`${i} | Sysm`:"Sysm",a=o||"A modern social network built for community engagement and seamless communication.",c=f||window.location.href;let n;e[2]!==u?(n=(0,t.jsx)("title",{children:u}),e[2]=u,e[3]=n):n=e[3];let m;e[4]!==a?(m=(0,t.jsx)("meta",{name:"description",content:a}),e[4]=a,e[5]=m):m=e[5];let x;e[6]!==c?(x=(0,t.jsx)("link",{rel:"canonical",href:c}),e[6]=c,e[7]=x):x=e[7];let v;e[8]!==d?(v=(0,t.jsx)("meta",{property:"og:type",content:d}),e[8]=d,e[9]=v):v=e[9];let k;e[10]===Symbol.for("react.memo_cache_sentinel")?(k=(0,t.jsx)("meta",{property:"og:site_name",content:"Sysm"}),e[10]=k):k=e[10];let j;e[11]!==c?(j=(0,t.jsx)("meta",{property:"og:url",content:c}),e[11]=c,e[12]=j):j=e[12];let N;e[13]!==u?(N=(0,t.jsx)("meta",{property:"og:title",content:u}),e[13]=u,e[14]=N):N=e[14];let h;e[15]!==a?(h=(0,t.jsx)("meta",{property:"og:description",content:a}),e[15]=a,e[16]=h):h=e[16];let _;e[17]!==p?(_=(0,t.jsx)("meta",{property:"og:image",content:p}),e[17]=p,e[18]=_):_=e[18];let C;e[19]===Symbol.for("react.memo_cache_sentinel")?(C=(0,t.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),e[19]=C):C=e[19];let S;e[20]!==c?(S=(0,t.jsx)("meta",{name:"twitter:url",content:c}),e[20]=c,e[21]=S):S=e[21];let M;e[22]!==u?(M=(0,t.jsx)("meta",{name:"twitter:title",content:u}),e[22]=u,e[23]=M):M=e[23];let R;e[24]!==a?(R=(0,t.jsx)("meta",{name:"twitter:description",content:a}),e[24]=a,e[25]=R):R=e[25];let P;e[26]!==p?(P=(0,t.jsx)("meta",{name:"twitter:image",content:p}),e[26]=p,e[27]=P):P=e[27];let I;return e[28]!==_||e[29]!==S||e[30]!==M||e[31]!==R||e[32]!==P||e[33]!==n||e[34]!==m||e[35]!==x||e[36]!==v||e[37]!==j||e[38]!==N||e[39]!==h?(I=(0,t.jsxs)(gt,{children:[n,m,x,v,k,j,N,h,_,C,S,M,R,P]}),e[28]=_,e[29]=S,e[30]=M,e[31]=R,e[32]=P,e[33]=n,e[34]=m,e[35]=x,e[36]=v,e[37]=j,e[38]=N,e[39]=h,e[40]=I):I=e[40],I},Ts=Ls;export{qs as n,Ss as r,Ts as t};
