const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/VoiceMessage-CkAi9LTP.js","assets/framework-CsA6nn9m.js","assets/rolldown-runtime-BaZ8gS7u.js","assets/framework-sg0yWRLc.css","assets/ui-libs-CLcIz2nO.js","assets/media-libs-Btb8RX-I.js","assets/media-libs-CqCaMccn.css","assets/VoiceMessage-CZ72DinE.js","assets/index-1GGj2WM6.js","assets/database-t9niRmCR.js","assets/query-QyXblnmD.js","assets/animations-CBDjnIoS.js","assets/index-DEDxQeU6.css"])))=>i.map(i=>d[i]);
import{a as oe}from"./rolldown-runtime-BaZ8gS7u.js";import{C as ue,E as he,b as pe,c as q,d as fe}from"./framework-CsA6nn9m.js";import"./database-t9niRmCR.js";import{Bt as be,Ft as ie,Hn as ge,Ht as ve,Mt as je,Ot as ze,Pn as Ne,Qt as le,Un as ke,Ut as we,Wt as ye,Xt as ae,Yn as Ce,Yt as Se,bn as Me,cn as _e,gn as de,in as Ge,kt as ne,un as Te,xn as Re,zt as Ae}from"./ui-libs-CLcIz2nO.js";import"./media-libs-Btb8RX-I.js";import{a as $e,i as se}from"./animations-CBDjnIoS.js";import{$ as te,B as Ie,P as Oe,Q as Pe,R as Ue,W as Le,Z as Ee,an as E,et as De,ht as Fe,in as ce,it as K,mt as He,n as qe,nt as X,r as Ye,rt as Z,t as Be,tt as Ve,v as xe,y as We,z as Ke}from"./index-1GGj2WM6.js";import"./VoiceMessage-CZ72DinE.js";import{t as Xe}from"./text-processing-BM2dfEqu.js";import{t as Ze}from"./linkify-ChB3A6R2.js";import{a as Je,d as Qe,f as et}from"./hooks-BDx8Fx3T.js";var tt=q(),A=oe(he(),1),t=oe(fe(),1),st=s=>{const e=(0,tt.c)(60),{conv:r,selectedId:n,onSelect:f,onlineUsers:h}=s;let d;e[0]!==r.isGroup||e[1]!==r.user||e[2]!==h?(d=!r.isGroup&&r.user?h.has(r.user.id):!1,e[0]=r.isGroup,e[1]=r.user,e[2]=h,e[3]=d):d=e[3];const k=d,p=n===r.id,x=r.unread>0,z=r.isGroup?r.name:r.user?.name,N=r.isGroup?r.avatar:r.user?.avatar;let l;e[4]!==r||e[5]!==f?(l=()=>f(r),e[4]=r,e[5]=f,e[6]=l):l=e[6];const R=p?"bg-violet-500/10 dark:bg-violet-500/20":"hover:bg-zinc-100 dark:hover:bg-zinc-800/50";let g;e[7]!==R?(g=E("group relative flex cursor-pointer items-center gap-4 p-3 mx-1 md:mx-2 rounded-2xl transition-all duration-200",R),e[7]=R,e[8]=g):g=e[8];const y=p?"border-violet-500/30":"border-transparent group-hover:border-zinc-200 dark:group-hover:border-zinc-700";let m;e[9]!==y?(m=E("size-[52px] border-2 transition-all",y),e[9]=y,e[10]=m):m=e[10];const w=z||"";let C;e[11]!==N||e[12]!==w?(C=(0,t.jsx)(K,{src:N,alt:w,className:"object-cover"}),e[11]=N,e[12]=w,e[13]=C):C=e[13];let S;e[14]!==z?.[0]?(S=z?.[0]?.toUpperCase(),e[14]=z?.[0],e[15]=S):S=e[15];let M;e[16]!==S?(M=(0,t.jsx)(Z,{className:"bg-zinc-100 text-zinc-500 font-bold text-lg dark:bg-zinc-800 dark:text-zinc-400",children:S}),e[16]=S,e[17]=M):M=e[17];let b;e[18]!==M||e[19]!==m||e[20]!==C?(b=(0,t.jsxs)(X,{className:m,children:[C,M]}),e[18]=M,e[19]=m,e[20]=C,e[21]=b):b=e[21];let _;e[22]!==k?(_=k&&(0,t.jsx)("span",{className:"absolute bottom-0.5 right-0.5 size-3.5 rounded-full border-[2.5px] border-white bg-emerald-500 ring-0 dark:border-black"}),e[22]=k,e[23]=_):_=e[23];let G;e[24]!==b||e[25]!==_?(G=(0,t.jsxs)("div",{className:"relative",children:[b,_]}),e[24]=b,e[25]=_,e[26]=G):G=e[26];const i=x?"text-zinc-900 dark:text-white":"text-zinc-700 dark:text-zinc-200";let c;e[27]!==i?(c=E("truncate text-[15px] font-semibold",i),e[27]=i,e[28]=c):c=e[28];let a;e[29]!==z||e[30]!==c?(a=(0,t.jsx)("span",{className:c,children:z}),e[29]=z,e[30]=c,e[31]=a):a=e[31];const u=x?"text-violet-600 dark:text-violet-400":"text-zinc-400";let o;e[32]!==u?(o=E("ml-2 whitespace-nowrap text-[11px] font-medium",u),e[32]=u,e[33]=o):o=e[33];let v;e[34]!==r.time||e[35]!==o?(v=(0,t.jsx)("span",{className:o,children:r.time}),e[34]=r.time,e[35]=o,e[36]=v):v=e[36];let j;e[37]!==a||e[38]!==v?(j=(0,t.jsxs)("div",{className:"flex items-center justify-between mb-0.5",children:[a,v]}),e[37]=a,e[38]=v,e[39]=j):j=e[39];const D=x?"font-semibold text-zinc-900 dark:text-zinc-100":"text-zinc-500 dark:text-zinc-400 group-hover:text-zinc-600 dark:group-hover:text-zinc-300";let U;e[40]!==D?(U=E("truncate whitespace-nowrap text-[13px] leading-relaxed flex-1",D),e[40]=D,e[41]=U):U=e[41];const J=r.currentUserSent?"You: ":"",F=r.lastMessage?.length>27?r.lastMessage.substring(0,27)+"...":r.lastMessage;let $;e[42]!==U||e[43]!==J||e[44]!==F?($=(0,t.jsxs)("p",{className:U,children:[J,F]}),e[42]=U,e[43]=J,e[44]=F,e[45]=$):$=e[45];let I;e[46]!==r.unread||e[47]!==x?(I=x&&(0,t.jsx)("span",{className:"flex size-5 shrink-0 items-center justify-center rounded-full bg-violet-600 text-[10px] font-bold text-white shadow-sm shadow-violet-500/30",children:r.unread}),e[46]=r.unread,e[47]=x,e[48]=I):I=e[48];let H;e[49]!==$||e[50]!==I?(H=(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2 min-w-0",children:[$,I]}),e[49]=$,e[50]=I,e[51]=H):H=e[51];let O;e[52]!==j||e[53]!==H?(O=(0,t.jsxs)("div",{className:"min-w-0 flex-1 py-1",children:[j,H]}),e[52]=j,e[53]=H,e[54]=O):O=e[54];let L;return e[55]!==G||e[56]!==l||e[57]!==O||e[58]!==g?(L=(0,t.jsxs)("div",{onClick:l,className:g,children:[G,O]}),e[55]=G,e[56]=l,e[57]=O,e[58]=g,e[59]=L):L=e[59],L},rt=({conversations:s,userResults:e=[],onSelect:r,onStartNew:n,selectedId:f,searchQuery:h,onSearchChange:d,onlineUsers:k=new Set,onRefresh:p})=>{const[x,z]=(0,A.useState)(!1),N=s.filter(l=>k.has(l.user?.id));return(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col overflow-hidden bg-white dark:bg-black h-full",children:[(0,t.jsxs)("div",{className:"px-4 md:px-5 pt-5 pb-2 shrink-0 w-full overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-5 min-w-0",children:[(0,t.jsx)("h2",{className:"text-2xl font-black tracking-tight text-zinc-900 dark:text-white truncate",children:"Chats"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>z(!0),className:"rounded-full bg-zinc-100 p-2.5 text-zinc-600 transition-colors hover:bg-zinc-200 dark:bg-zinc-900 dark:text-zinc-400 dark:hover:bg-zinc-800",title:"New Group",children:(0,t.jsx)(je,{size:20})}),(0,t.jsx)("button",{className:"rounded-full bg-zinc-100 p-2.5 text-zinc-600 transition-colors hover:bg-zinc-200 dark:bg-zinc-900 dark:text-zinc-400 dark:hover:bg-zinc-800",children:(0,t.jsx)(we,{size:20})})]})]}),(0,t.jsxs)("div",{className:"relative group min-w-0",children:[(0,t.jsx)(ae,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-violet-500 transition-colors",size:18}),(0,t.jsx)("input",{type:"text",value:h,onChange:l=>d(l.target.value),placeholder:"Search Messenger",className:"w-full rounded-2xl border-none bg-zinc-100 py-3 pl-12 pr-4 text-base font-medium text-zinc-900 placeholder:text-zinc-500 transition-all focus:bg-white focus:ring-2 focus:ring-violet-500/20 focus:shadow-md dark:bg-zinc-900 dark:text-white dark:focus:bg-black"})]})]}),(0,t.jsx)("div",{className:"flex-1 min-h-0 overflow-hidden",children:(0,t.jsx)(xe,{onRefresh:p||(async()=>{}),disabled:!p,className:"h-full",children:(0,t.jsx)(Oe,{className:"h-full min-w-0",children:(0,t.jsxs)("div",{className:"flex flex-col pb-4 min-w-0",children:[!h&&N.length>0&&(0,t.jsx)("div",{className:"mb-4 mt-2 min-w-0 w-full overflow-hidden",children:(0,t.jsxs)("div",{className:"flex gap-4 overflow-x-auto px-4 md:px-5 pb-4 pt-2 no-scrollbar w-full",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2 min-w-[64px] cursor-pointer group",children:[(0,t.jsxs)("div",{className:"relative flex size-[60px] items-center justify-center rounded-full bg-zinc-50 border border-zinc-200 dark:bg-zinc-900 dark:border-zinc-800 group-hover:bg-zinc-100 dark:group-hover:bg-zinc-800 transition-colors",children:[(0,t.jsx)(ie,{size:24,className:"text-zinc-400"}),(0,t.jsx)("div",{className:"absolute bottom-0 right-0 size-5 bg-white dark:bg-black rounded-full flex items-center justify-center",children:(0,t.jsx)("div",{className:"size-4 bg-zinc-200 dark:bg-zinc-700 rounded-full flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-[10px] text-zinc-500 font-bold",children:"+"})})})]}),(0,t.jsx)("span",{className:"text-[11px] font-medium text-zinc-500",children:"Your Story"})]}),N.map(l=>(0,t.jsxs)("div",{onClick:()=>r(l),className:"flex flex-col items-center gap-2 cursor-pointer group min-w-[64px] transition-transform active:scale-95",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute -inset-[3px] rounded-full bg-gradient-to-tr from-violet-500 via-fuchsia-500 to-orange-500 opacity-90 p-[2px]"}),(0,t.jsx)("div",{className:"relative rounded-full border-[3px] border-white dark:border-black p-[2px] bg-white dark:bg-black",children:(0,t.jsxs)(X,{className:"size-[50px]",children:[(0,t.jsx)(K,{src:l.user?.avatar,className:"object-cover"}),(0,t.jsx)(Z,{children:l.user?.name?.[0]})]})}),(0,t.jsx)("span",{className:"absolute bottom-1 right-1 size-3.5 rounded-full border-[2.5px] border-white bg-emerald-500 dark:border-black"})]}),(0,t.jsx)("span",{className:"w-full truncate text-center text-[11px] font-medium text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white transition-colors",children:l.user?.name.split(" ")[0]})]},l.id))]})}),(0,t.jsx)("div",{className:"px-2 space-y-1",children:s.length>0&&s.filter(l=>l.lastMessage!=="No messages yet"||l.id===f||h).map(l=>(0,t.jsx)(st,{conv:l,selectedId:f,onSelect:r,onlineUsers:k},l.id))}),e.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"px-6 py-3 mt-2 text-xs font-bold uppercase tracking-wider text-zinc-400",children:"More People"}),(0,t.jsx)("div",{className:"px-2 space-y-1",children:e.map(l=>(0,t.jsxs)("div",{onClick:()=>n(l),className:"flex cursor-pointer items-center gap-4 px-3 py-2 rounded-2xl transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800/50",children:[(0,t.jsxs)(X,{className:"size-10",children:[(0,t.jsx)(K,{src:l.avatar,className:"object-cover"}),(0,t.jsx)(Z,{children:l.name?.[0]?.toUpperCase()})]}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"truncate text-sm font-bold text-zinc-900 dark:text-white",children:l.name}),(0,t.jsxs)("div",{className:"truncate text-xs text-zinc-500",children:["@",l.handle]})]}),(0,t.jsx)("button",{className:"flex size-8 items-center justify-center rounded-full bg-violet-50 text-violet-600 dark:bg-violet-900/20 dark:text-violet-400",children:(0,t.jsx)(ie,{size:16})})]},l.id))})]}),s.length===0&&e.length===0&&h&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center px-6",children:[(0,t.jsx)("div",{className:"mb-4 rounded-full bg-zinc-100 p-4 dark:bg-zinc-900",children:(0,t.jsx)(ae,{className:"text-zinc-400",size:24})}),(0,t.jsxs)("p",{className:"text-zinc-500",children:['No results found for "',h,'"']})]})]})})})}),(0,t.jsx)(Ye,{isOpen:x,onClose:()=>z(!1),onCreated:l=>{r({id:l,isGroup:!0})}})]})},it=rt,lt=q(),at=s=>{const e=(0,lt.c)(51),{conversation:r,isOnline:n,onBack:f,onOpenSettings:h}=s,d=pe(),k=et(r.user?.lastSeen),p=r.isGroup?r.name:r.user?.name,x=r.isGroup?r.avatar:r.user?.avatar;let z;e[0]===Symbol.for("react.memo_cache_sentinel")?(z=(0,t.jsx)(Ce,{size:24}),e[0]=z):z=e[0];let N;e[1]!==f?(N=(0,t.jsx)("button",{onClick:f,className:"mr-1 -ml-2.5 rounded-full p-2.5 text-zinc-600 transition-colors hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-zinc-800 md:hidden",children:z}),e[1]=f,e[2]=N):N=e[2];let l;e[3]!==r.isGroup||e[4]!==r.user||e[5]!==d?(l=()=>!r.isGroup&&r.user&&d(`/u/${r.user.handle}`),e[3]=r.isGroup,e[4]=r.user,e[5]=d,e[6]=l):l=e[6];const R=p||"";let g;e[7]!==x||e[8]!==R?(g=(0,t.jsx)(K,{src:x,alt:R,className:"object-cover"}),e[7]=x,e[8]=R,e[9]=g):g=e[9];let y;e[10]!==p?.[0]?(y=p?.[0]?.toUpperCase(),e[10]=p?.[0],e[11]=y):y=e[11];let m;e[12]!==y?(m=(0,t.jsx)(Z,{children:y}),e[12]=y,e[13]=m):m=e[13];let w;e[14]!==g||e[15]!==m?(w=(0,t.jsxs)(X,{className:"size-10 border-2 border-white shadow-sm dark:border-zinc-800",children:[g,m]}),e[14]=g,e[15]=m,e[16]=w):w=e[16];let C;e[17]!==r.isGroup||e[18]!==n?(C=n&&!r.isGroup&&(0,t.jsx)("span",{className:"absolute bottom-0 right-0 size-3 rounded-full border-2 border-white bg-emerald-500 dark:border-black"}),e[17]=r.isGroup,e[18]=n,e[19]=C):C=e[19];let S;e[20]!==l||e[21]!==w||e[22]!==C?(S=(0,t.jsxs)("div",{className:"relative cursor-pointer",onClick:l,children:[w,C]}),e[20]=l,e[21]=w,e[22]=C,e[23]=S):S=e[23];let M;e[24]!==r.isGroup||e[25]!==r.user||e[26]!==d?(M=()=>!r.isGroup&&r.user&&d(`/u/${r.user.handle}`),e[24]=r.isGroup,e[25]=r.user,e[26]=d,e[27]=M):M=e[27];let b;e[28]!==p?(b=(0,t.jsx)("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:p}),e[28]=p,e[29]=b):b=e[29];let _;e[30]!==r.isGroup||e[31]!==r.user?.lastSeen||e[32]!==n||e[33]!==k?(_=r.isGroup?"Group Chat":n?(0,t.jsx)("span",{className:"text-emerald-500",children:"Active now"}):r.user?.lastSeen?`Last seen ${k}`:"Offline",e[30]=r.isGroup,e[31]=r.user?.lastSeen,e[32]=n,e[33]=k,e[34]=_):_=e[34];let G;e[35]!==_?(G=(0,t.jsx)("span",{className:"text-[11px] font-medium text-zinc-500",children:_}),e[35]=_,e[36]=G):G=e[36];let i;e[37]!==M||e[38]!==b||e[39]!==G?(i=(0,t.jsxs)("div",{className:"flex flex-col cursor-pointer",onClick:M,children:[b,G]}),e[37]=M,e[38]=b,e[39]=G,e[40]=i):i=e[40];let c;e[41]!==S||e[42]!==i||e[43]!==N?(c=(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[N,S,i]}),e[41]=S,e[42]=i,e[43]=N,e[44]=c):c=e[44];let a;e[45]===Symbol.for("react.memo_cache_sentinel")?(a=(0,t.jsx)(Me,{size:20}),e[45]=a):a=e[45];let u;e[46]!==h?(u=(0,t.jsx)("div",{className:"flex items-center gap-1",children:(0,t.jsx)("button",{onClick:h,className:"rounded-full p-2.5 text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:a})}),e[46]=h,e[47]=u):u=e[47];let o;return e[48]!==c||e[49]!==u?(o=(0,t.jsxs)("div",{className:"sticky top-0 z-30 flex shrink-0 items-center justify-between border-b border-zinc-100 bg-white/75 px-4 py-3 backdrop-blur-xl dark:border-zinc-800 dark:bg-black/75",children:[c,u]}),e[48]=c,e[49]=u,e[50]=o):o=e[50],o},nt=at,ct=q();const ot=(s,e,r)=>{const n=(0,ct.c)(7),f=e===void 0?40:e,h=r===void 0?120:r,d=(0,A.useRef)(null);let k;n[0]!==h||n[1]!==f?(k=()=>{const x=d.current;if(x){x.style.height="auto";const z=x.scrollHeight;x.style.height=`${Math.min(Math.max(z,f),h)}px`}},n[0]=h,n[1]=f,n[2]=k):k=n[2];let p;return n[3]!==h||n[4]!==f||n[5]!==s?(p=[s,f,h],n[3]=h,n[4]=f,n[5]=s,n[6]=p):p=n[6],(0,A.useEffect)(k,p),d};var dt=q(),xt=s=>{const e=(0,dt.c)(57),{onSendMessage:r,onTyping:n,replyingTo:f,setReplyingTo:h}=s,[d,k]=(0,A.useState)("");let p;e[0]===Symbol.for("react.memo_cache_sentinel")?(p=[],e[0]=p):p=e[0];const[x,z]=(0,A.useState)(p),[N,l]=(0,A.useState)(!1),R=(0,A.useRef)(null),g=(0,A.useRef)(null),y=ot(d),{isRecording:m,recordingTime:w,startRecording:C,stopRecording:S,cancelRecording:M,audioBlob:b,clearAudio:_}=Qe(),G=ut;let i;e[1]!==n?(i=T=>{const P=T.target.value;k(P),n&&(n(!0),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{n(!1)},2e3))},e[1]=n,e[2]=i):i=e[2];const c=i;let a;e[3]!==x||e[4]!==b||e[5]!==r||e[6]!==n||e[7]!==h||e[8]!==d?(a=T=>{T&&T.preventDefault(),!(!d.trim()&&x.length===0&&!b)&&(n&&(g.current&&clearTimeout(g.current),n(!1)),r(d,x),k(""),z([]),h(null))},e[3]=x,e[4]=b,e[5]=r,e[6]=n,e[7]=h,e[8]=d,e[9]=a):a=e[9];const u=a;let o;e[10]!==b||e[11]!==_||e[12]!==m||e[13]!==r||e[14]!==w?(o=()=>{b&&!m&&(r("",[],b,w),_())},e[10]=b,e[11]=_,e[12]=m,e[13]=r,e[14]=w,e[15]=o):o=e[15];let v;e[16]!==b||e[17]!==m?(v=[b,m],e[16]=b,e[17]=m,e[18]=v):v=e[18],A.useEffect(o,v);let j;e[19]===Symbol.for("react.memo_cache_sentinel")?(j=T=>{if(!T.target.files)return;const P=Array.from(T.target.files);z(W=>[...W,...P])},e[19]=j):j=e[19];const D=j;let U;e[20]===Symbol.for("react.memo_cache_sentinel")?(U=T=>{const P=T.clipboardData.files;if(P&&P.length>0){const W=Array.from(P).filter(ht);W.length>0&&(T.preventDefault(),z(re=>[...re,...W]))}},e[20]=U):U=e[20];const J=U;let F;e[21]!==f||e[22]!==h?(F=f&&(0,t.jsxs)(se.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"flex items-center justify-between mb-2 px-4 py-2 bg-zinc-50 dark:bg-zinc-900 rounded-xl border border-zinc-100 dark:border-zinc-800",children:[(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsxs)("span",{className:"text-xs font-bold text-violet-500 block mb-0.5",children:["Replying to ",f.sender==="me"?"yourself":f.senderName]}),(0,t.jsx)("p",{className:"line-clamp-1 text-zinc-500",children:f.text})]}),(0,t.jsx)("button",{onClick:()=>h(null),children:(0,t.jsx)(ne,{size:16,className:"text-zinc-400"})})]}),e[21]=f,e[22]=h,e[23]=F):F=e[23];let $;e[24]!==F?($=(0,t.jsx)($e,{children:F}),e[24]=F,e[25]=$):$=e[25];let I;e[26]!==x?(I=x.length>0&&(0,t.jsx)("div",{className:"flex gap-2 mb-2 px-1",children:x.map((T,P)=>(0,t.jsxs)("div",{className:"relative size-16 rounded-lg overflow-hidden border border-zinc-200",children:[(0,t.jsx)("img",{src:URL.createObjectURL(T),className:"size-full object-cover"}),(0,t.jsx)("button",{onClick:()=>z(W=>W.filter((re,me)=>me!==P)),className:"absolute top-0 right-0 bg-black/50 text-white p-0.5",children:(0,t.jsx)(ne,{size:12})})]},P))}),e[26]=x,e[27]=I):I=e[27];const H=m?"bg-zinc-900 border-zinc-800 shadow-2xl scale-[1.02] ring-4 ring-red-500/10":"bg-zinc-100 dark:bg-zinc-900 border-transparent focus-within:ring-2 focus-within:ring-violet-500/20 focus-within:bg-white dark:focus-within:bg-zinc-900 focus-within:border-violet-200 dark:focus-within:border-violet-900";let O;e[28]!==H?(O=E("flex-1 flex items-center gap-2 rounded-[28px] px-2 py-2 transition-all duration-300 overflow-hidden border",H),e[28]=H,e[29]=O):O=e[29];let L;e[30]!==M||e[31]!==u||e[32]!==c||e[33]!==N||e[34]!==m||e[35]!==w||e[36]!==d||e[37]!==y?(L=m?(0,t.jsxs)("div",{className:"flex-1 flex items-center gap-4 px-3 py-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2.5 bg-red-500/10 px-3 py-1.5 rounded-full border border-red-500/20",children:[(0,t.jsx)(se.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:1.5},className:"size-2.5 rounded-full bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.5)]"}),(0,t.jsx)("span",{className:"text-sm font-bold tabular-nums text-red-500",children:G(w)})]}),(0,t.jsx)("div",{className:"flex-1 h-6 flex items-center justify-center gap-1 opacity-80",children:(0,t.jsx)("div",{className:"w-full h-1 bg-white/20 rounded-full"})}),(0,t.jsx)("button",{type:"button",onClick:M,className:"p-2 text-zinc-400 hover:text-white transition-colors hover:bg-white/10 rounded-full",children:(0,t.jsx)(be,{size:20})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-0.5 ml-1",children:[(0,t.jsxs)(Ue,{open:N,onOpenChange:l,children:[(0,t.jsx)(Ie,{asChild:!0,children:(0,t.jsx)("button",{type:"button",className:"p-2 text-zinc-400 hover:text-yellow-500 transition-colors",children:(0,t.jsx)(ye,{size:22})})}),(0,t.jsx)(Ke,{className:"w-full p-0 border-none bg-transparent shadow-none",side:"top",align:"start",children:(0,t.jsx)(Le,{onEmojiSelect:T=>k(P=>P+T.emoji)})})]}),(0,t.jsx)("button",{type:"button",className:"p-2 text-zinc-400 hover:text-violet-600 transition-colors rounded-full hover:bg-zinc-200/50 dark:hover:bg-zinc-800",onClick:()=>R.current?.click(),children:(0,t.jsx)(Re,{size:22})}),(0,t.jsx)("button",{type:"button",className:"hidden sm:block p-2 text-zinc-400 hover:text-violet-600 transition-colors rounded-full hover:bg-zinc-200/50 dark:hover:bg-zinc-800",children:(0,t.jsx)(Ge,{size:20})})]}),(0,t.jsx)("textarea",{ref:y,value:d,onChange:c,onKeyDown:T=>{T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),u())},onPaste:J,placeholder:"Message...",className:"flex-1 bg-transparent border-none outline-none text-base resize-none py-2.5 min-h-[40px] text-zinc-900 dark:text-white placeholder:text-zinc-500",rows:1})]}),e[30]=M,e[31]=u,e[32]=c,e[33]=N,e[34]=m,e[35]=w,e[36]=d,e[37]=y,e[38]=L):L=e[38];let Y;e[39]!==x.length||e[40]!==m||e[41]!==C||e[42]!==S||e[43]!==d?(Y=d.trim()||x.length>0?(0,t.jsx)("button",{type:"submit",className:"p-2 mr-1 rounded-full bg-violet-600 text-white hover:bg-violet-700 hover:scale-105 transition-all shadow-sm",children:(0,t.jsx)(Se,{size:18,className:"translate-x-0.5 translate-y-0.5"})}):m?(0,t.jsx)("button",{type:"button",onClick:S,className:"p-2.5 mr-1 rounded-full bg-red-500 text-white hover:bg-red-600 transition-all shadow-[0_0_15px_rgba(239,68,68,0.4)] hover:scale-110 active:scale-95",children:(0,t.jsx)(ve,{size:16,fill:"currentColor"})}):(0,t.jsx)("button",{type:"button",onClick:C,className:"p-2 mr-1 text-zinc-400 hover:text-violet-600 dark:hover:text-violet-400 transition-colors",children:(0,t.jsx)(_e,{size:22})}),e[39]=x.length,e[40]=m,e[41]=C,e[42]=S,e[43]=d,e[44]=Y):Y=e[44];let B;e[45]!==u||e[46]!==O||e[47]!==L||e[48]!==Y?(B=(0,t.jsxs)("form",{className:O,onSubmit:u,children:[L,Y]}),e[45]=u,e[46]=O,e[47]=L,e[48]=Y,e[49]=B):B=e[49];let Q;e[50]===Symbol.for("react.memo_cache_sentinel")?(Q=(0,t.jsx)("input",{type:"file",ref:R,onChange:D,className:"hidden",multiple:!0,accept:"image/*"}),e[50]=Q):Q=e[50];let V;e[51]!==B?(V=(0,t.jsxs)("div",{className:"flex items-end gap-2",children:[B,Q]}),e[51]=B,e[52]=V):V=e[52];let ee;return e[53]!==I||e[54]!==V||e[55]!==$?(ee=(0,t.jsxs)("div",{className:"shrink-0 p-3 md:p-4 bg-white dark:bg-black border-t border-zinc-100 dark:border-zinc-800",children:[$,I,V]}),e[53]=I,e[54]=V,e[55]=$,e[56]=ee):ee=e[56],ee},mt=xt;function ut(s){return`${Math.floor(s/60)}:${(s%60).toString().padStart(2,"0")}`}function ht(s){return s.type.startsWith("image/")}var Tt=q(),Rt=q(),pt=A.lazy(()=>ue(()=>import("./VoiceMessage-CkAi9LTP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),ft=({conversation:s,messages:e,onBack:r,onSendMessage:n,onDeleteMessage:f,onTyping:h,onRefresh:d,isLoading:k,isTyping:p,isOnline:x})=>{const{openLightbox:z}=Fe(),[N,l]=(0,A.useState)(null),[R,g]=(0,A.useState)(!1),y=(0,A.useRef)(null),m=s.isGroup?s.name:s.user?.name,w=s.isGroup?s.avatar:s.user?.avatar;(0,A.useEffect)(()=>{y.current&&(y.current.scrollTop=y.current.scrollHeight)},[e,p,N]);const C=async(i,c,a,u)=>{if(a&&u){try{const v=await ce(new File([a],`voice-message-${Date.now()}.webm`,{type:a.type}));n(s.id,"Voice message","voice",[{url:v.url,duration:u}],N?.id)}catch(v){console.error("Failed to send voice message:",v)}return}let o=[];if(c.length>0)try{o=await Promise.all(c.map(v=>ce(v)))}catch(v){console.error("Upload failed:",v);return}n(s.id,i,o.length>0?"image":"text",o,N?.id),l(null)},S=i=>{!i.media||i.media.length===0||z(i.media.map(c=>c.url),0)},M=(0,A.useMemo)(()=>{const i=e.filter(c=>c.sender==="me");return i.length>0?i[i.length-1].id:null},[e]),b=i=>e.find(c=>c.id===i),_=(i,c)=>i===0?!1:e[i-1].sender===c.sender,G=(i,c)=>i===e.length-1?!1:e[i+1].sender===c.sender;return(0,t.jsxs)("div",{className:"relative flex h-full w-full flex-col overflow-hidden bg-white/50 dark:bg-black/50 md:border-l md:border-zinc-200/50 dark:md:border-zinc-800/50",children:[(0,t.jsx)(nt,{conversation:s,isOnline:x,onBack:r,onOpenSettings:()=>g(!0)}),(0,t.jsx)("div",{className:"flex-1 min-h-0 overflow-hidden",children:(0,t.jsx)(xe,{onRefresh:d||(async()=>{}),disabled:!d,className:"h-full",children:(0,t.jsx)("div",{className:"h-full overflow-y-auto px-3 md:px-4 py-4",ref:y,children:(0,t.jsxs)("div",{className:"flex flex-col min-h-full justify-end",children:[e.length<5&&(0,t.jsxs)("div",{className:"py-12 flex flex-col items-center justify-center opacity-80 mb-auto",children:[(0,t.jsxs)(X,{className:"size-24 border-4 border-zinc-100 dark:border-zinc-800 mb-4 bg-zinc-50 dark:bg-zinc-900",children:[(0,t.jsx)(K,{src:w,className:"object-cover"}),(0,t.jsx)(Z,{className:"text-4xl",children:m?.[0]})]}),(0,t.jsx)("h2",{className:"text-xl font-bold dark:text-white",children:m}),(0,t.jsx)("p",{className:"text-zinc-500 text-sm mb-4",children:s.isGroup?"Group chat on Sysm":"You're friends on Sysm"}),!s.isGroup&&(0,t.jsx)(He,{variant:"outline",className:"rounded-full h-8 text-xs",children:"View Profile"})]}),k&&e.length===0?(0,t.jsx)("div",{className:"flex justify-center p-8",children:(0,t.jsx)(de,{className:"animate-spin text-violet-500",size:32})}):(0,t.jsx)("div",{className:"space-y-[2px]",children:e.map((i,c)=>{const a=i.sender==="me",u=_(c,i),o=G(c,i);return(0,t.jsx)(se.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},className:E("flex w-full",a?"justify-end":"justify-start",!o&&"mb-4"),children:(0,t.jsxs)("div",{className:E("flex max-w-[75%] md:max-w-[65%] items-end gap-2 group",a?"flex-row-reverse":"flex-row"),children:[!a&&(0,t.jsx)("div",{className:"w-7 shrink-0",children:o?null:(0,t.jsxs)(X,{className:"size-7 border border-zinc-100 shadow-sm dark:border-zinc-800",children:[(0,t.jsx)(K,{src:i.senderAvatar||w}),(0,t.jsx)(Z,{children:(i.senderName||m)?.[0]})]})}),(0,t.jsxs)(Ee,{children:[(0,t.jsx)(Ve,{children:(0,t.jsxs)("div",{className:E("relative px-4 py-2.5 shadow-sm text-[15px] leading-[1.4]",a?"bg-gradient-to-br from-violet-600 to-indigo-600 text-white":"bg-white text-zinc-900 dark:bg-zinc-800 dark:text-white border border-zinc-200/50 dark:border-zinc-700/50",!o&&!u&&"rounded-[22px]",a&&!o&&u&&"rounded-[22px] rounded-tr-md",a&&o&&!u&&"rounded-[22px] rounded-br-md",a&&o&&u&&"rounded-[22px] rounded-r-md",!a&&!o&&u&&"rounded-[22px] rounded-tl-md",!a&&o&&!u&&"rounded-[22px] rounded-bl-md",!a&&o&&u&&"rounded-[22px] rounded-l-md"),children:[i.replyToId&&(0,t.jsxs)("div",{className:E("mb-1.5 -mx-1 px-3 py-1.5 rounded-xl text-xs border-l-2 cursor-pointer",a?"bg-black/10 border-white/40 text-white/90":"bg-zinc-100 border-zinc-300 text-zinc-600 dark:bg-zinc-700 dark:border-zinc-500 dark:text-zinc-300"),onClick:v=>{v.stopPropagation();const j=document.getElementById(`msg-${i.replyToId}`);j&&j.scrollIntoView({behavior:"smooth",block:"center"})},children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 mb-0.5 opacity-75",children:[(0,t.jsx)(le,{size:10}),(0,t.jsx)("span",{className:"font-bold",children:"Reply"})]}),(0,t.jsx)("div",{className:"truncate opacity-90",children:b(i.replyToId)?.text||"Attachment"})]}),i.media?.length>0&&i.type!=="voice"&&(0,t.jsx)("div",{className:"grid gap-1 mb-1 overflow-hidden rounded-lg",children:i.media.map((v,j)=>(0,t.jsx)("img",{src:v.url,className:"max-h-64 object-cover w-full rounded-md cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>S(i)},j))}),i.type==="voice"?(0,t.jsx)(A.Suspense,{fallback:(0,t.jsxs)("div",{className:"flex h-[36px] w-[220px] items-center gap-3 py-1.5 opacity-50",children:[(0,t.jsx)("div",{className:"size-11 shrink-0 rounded-full bg-zinc-200 animate-pulse dark:bg-zinc-700"}),(0,t.jsx)("div",{className:"flex-1 h-2 bg-zinc-200 animate-pulse dark:bg-zinc-700 rounded"})]}),children:(0,t.jsx)(pt,{url:i.media?.[0]?.url||i.text,duration:i.media?.[0]?.duration,isMe:a})}):(0,t.jsx)("div",{className:"whitespace-pre-wrap break-words",children:(0,t.jsx)(Xe,{options:{...Ze,className:a?"text-white underline":"text-violet-600 dark:text-violet-400 underline"},children:i.text})}),(0,t.jsxs)("div",{className:E("flex justify-end items-center gap-1 mt-0.5 select-none",a?"text-white/70":"text-zinc-400"),children:[(0,t.jsx)("span",{className:"text-[9px] font-medium",children:i.time}),a&&i.id===M&&(i.isRead?(0,t.jsx)(ke,{size:12,className:"text-white"}):(0,t.jsx)(ge,{size:12,className:"text-white/60"}))]})]})}),(0,t.jsxs)(Pe,{className:"w-48",children:[(0,t.jsxs)(te,{onClick:()=>{navigator.clipboard.writeText(i.text)},children:[(0,t.jsx)(Ne,{size:14,className:"mr-2"})," Copy"]}),(0,t.jsxs)(te,{onClick:()=>l(i),children:[(0,t.jsx)(le,{size:14,className:"mr-2"})," Reply"]}),(0,t.jsx)(De,{}),(0,t.jsxs)(te,{className:"text-red-500",onClick:()=>f&&f(i.id),children:[(0,t.jsx)(Ae,{size:14,className:"mr-2"})," Delete"]})]})]})]})},i.id)})}),p&&(0,t.jsx)("div",{className:"flex items-center gap-2 mt-2 ml-9",children:(0,t.jsx)("div",{className:"bg-zinc-100 dark:bg-zinc-800 px-4 py-2.5 rounded-[22px] rounded-tl-md",children:(0,t.jsx)(We,{})})})]})})})}),(0,t.jsx)(mt,{onSendMessage:C,onTyping:h,replyingTo:N,setReplyingTo:l}),s.isGroup?(0,t.jsx)(qe,{isOpen:R,onClose:()=>g(!1),conversation:s,onUpdate:i=>{g(!1)}}):(0,t.jsx)(Be,{isOpen:R,onClose:()=>g(!1),user:s.user,conversationId:s.id})]})},bt=ft,gt=q(),vt=()=>{const s=(0,gt.c)(33),{id:e,currentUser:r,onlineUsers:n,msgSearchQuery:f,setMsgSearchQuery:h,userSearchResults:d,filteredConversations:k,selectedConversation:p,localMessages:x,isConvLoading:z,isMsgLoading:N,currentIsTyping:l,otherUserIsOnline:R,handleStartConversation:g,handleSelectConversation:y,refetchConversations:m,refetchMessages:w,sendMessage:C,onDeleteMessage:S,sendTypingStatus:M,navigate:b}=Je();if(!r){let j;s[0]===Symbol.for("react.memo_cache_sentinel")?(j=(0,t.jsx)("div",{className:"rounded-3xl bg-zinc-50 p-6 dark:bg-zinc-900",children:(0,t.jsx)(ze,{size:48,className:"text-zinc-300 dark:text-zinc-600"})}),s[0]=j):j=s[0];let D;return s[1]===Symbol.for("react.memo_cache_sentinel")?(D=(0,t.jsxs)("div",{className:"flex h-[100dvh] flex-col items-center justify-center gap-6 border-zinc-100 bg-white p-8 text-center dark:border-zinc-800 dark:bg-black md:h-[calc(100vh-1.5rem)] md:rounded-2xl md:border",children:[j,(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h3",{className:"text-2xl font-black tracking-tight dark:text-white",children:"Sign in to message"}),(0,t.jsx)("p",{className:"max-w-xs text-zinc-500 font-medium",children:"Join the conversation. Sign up or log in to start chatting."})]})]}),s[1]=D):D=s[1],D}if(z){let j;return s[2]===Symbol.for("react.memo_cache_sentinel")?(j=(0,t.jsx)("div",{className:"flex h-[100dvh] items-center justify-center border-zinc-100 bg-white dark:border-zinc-800 dark:bg-black md:h-[calc(100vh-1.5rem)] md:rounded-2xl md:border",children:(0,t.jsx)(de,{className:"animate-spin text-violet-500",size:32})}),s[2]=j):j=s[2],j}const _=`flex ${e?"h-[100dvh]":"h-[calc(100dvh-4rem)]"} w-full max-w-full box-border overscroll-none overflow-x-hidden overflow-y-hidden bg-white shadow-2xl shadow-zinc-200/50 dark:border-zinc-800 dark:bg-black dark:shadow-none md:h-[calc(100vh-1.5rem)] md:rounded-3xl md:border md:border-zinc-200/50`,G=`flex-col md:flex md:w-[400px] ${p?"hidden":"flex"} h-full min-h-0 min-w-0 flex-1 md:flex-none bg-white dark:bg-black border-r border-zinc-100 dark:border-zinc-800 z-10`,i=e??null;let c;s[3]!==m?(c=async()=>await m(),s[3]=m,s[4]=c):c=s[4];let a;s[5]!==k||s[6]!==y||s[7]!==g||s[8]!==f||s[9]!==n||s[10]!==h||s[11]!==i||s[12]!==c||s[13]!==d?(a=(0,t.jsx)(it,{conversations:k,userResults:d,onSelect:y,onStartNew:g,selectedId:i,searchQuery:f,onSearchChange:h,onlineUsers:n,onRefresh:c}),s[5]=k,s[6]=y,s[7]=g,s[8]=f,s[9]=n,s[10]=h,s[11]=i,s[12]=c,s[13]=d,s[14]=a):a=s[14];let u;s[15]!==G||s[16]!==a?(u=(0,t.jsx)("div",{className:G,children:a}),s[15]=G,s[16]=a,s[17]=u):u=s[17];let o;s[18]!==l||s[19]!==N||s[20]!==x||s[21]!==b||s[22]!==S||s[23]!==R||s[24]!==w||s[25]!==p||s[26]!==C||s[27]!==M?(o=p?(0,t.jsx)(bt,{conversation:p,messages:x,onBack:()=>b("/messages"),onSendMessage:C,onDeleteMessage:S,onTyping:j=>M(p.id,j),onRefresh:async()=>await w(),isLoading:N,isTyping:!!l,isOnline:!!R}):(0,t.jsxs)("div",{className:"hidden flex-1 flex-col items-center justify-center gap-6 text-zinc-500 md:flex bg-zinc-50/30 dark:bg-zinc-900/10",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute -inset-10 rounded-full bg-violet-500/5 blur-3xl dark:bg-violet-500/10"}),(0,t.jsx)("div",{className:"relative rounded-[2.5rem] bg-white p-10 shadow-xl shadow-zinc-200/50 dark:bg-zinc-900/50 dark:shadow-none ring-1 ring-zinc-100 dark:ring-zinc-800",children:(0,t.jsx)(Te,{size:80,className:"text-violet-500 stroke-[1.5]"})})]}),(0,t.jsxs)("div",{className:"text-center max-w-sm px-4 space-y-3",children:[(0,t.jsx)("h3",{className:"text-3xl font-black tracking-tighter text-zinc-900 dark:text-white",children:"Your Messages"}),(0,t.jsx)("p",{className:"text-zinc-500 font-medium text-lg",children:"Send private photos and messages to a friend or group."})]})]}),s[18]=l,s[19]=N,s[20]=x,s[21]=b,s[22]=S,s[23]=R,s[24]=w,s[25]=p,s[26]=C,s[27]=M,s[28]=o):o=s[28];let v;return s[29]!==_||s[30]!==u||s[31]!==o?(v=(0,t.jsxs)("div",{className:_,children:[u,o]}),s[29]=_,s[30]=u,s[31]=o,s[32]=v):v=s[32],v},At=vt;export{At as default};
