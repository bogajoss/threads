import{a as re}from"./rolldown-runtime-BaZ8gS7u.js";import{E as le,S as ce,b as X,c as G,x as ee,y as ue}from"./framework-CsA6nn9m.js";import{a as te,n as ie,r as I,t as U}from"./query-QyXblnmD.js";import{At as de,Bt as fe,Ct as me,Dt as ge,Et as he,Ht as ye,Jt as pe,Lt as Pe,Nt as ve,Ot as we,Pt as be,Rt as Me,St as Ce,Tt as Se,Ut as _e,Wt as Re,Yt as Le,_t as Fe,en as ne,gt as se,ht as ke,nn as Y,qt as qe,rn as oe,s as $e,vt as De,wt as Ne,xt as Qe,yt as Z,zt as Te}from"./index-RC_HQZbb.js";var xe=G(),M=re(le(),1);const ut=(e,s,i,o)=>{const t=(0,xe.c)(92),n=te();let a;t[0]!==s?(a=s||{comments:0,likes:0,mirrors:0,reposts:0},t[0]=s,t[1]=a):a=t[1];const[h,f]=(0,M.useState)(a);let p,r;t[2]!==s?(p=()=>{s&&f(D=>({...D,...s}))},r=[s],t[2]=s,t[3]=p,t[4]=r):(p=t[3],r=t[4]),(0,M.useEffect)(p,r);const l=i?.id;let v;t[5]!==e||t[6]!==l?(v=["post",e,"liked",l],t[5]=e,t[6]=l,t[7]=v):v=t[7];let C;t[8]!==i?.id||t[9]!==e?(C=()=>ve(e,i?.id),t[8]=i?.id,t[9]=e,t[10]=C):C=t[10];let g;t[11]!==i||t[12]!==e?(g=!!i&&Y(e)&&Y(i.id),t[11]=i,t[12]=e,t[13]=g):g=t[13];let y;t[14]!==v||t[15]!==C||t[16]!==g?(y={queryKey:v,queryFn:C,enabled:g,staleTime:6e5},t[14]=v,t[15]=C,t[16]=g,t[17]=y):y=t[17];const{data:_}=I(y),S=_===void 0?!1:_,F=i?.id;let m;t[18]!==e||t[19]!==F?(m=["post",e,"reposted",F],t[18]=e,t[19]=F,t[20]=m):m=t[20];let w;t[21]!==i?.id||t[22]!==e?(w=()=>be(e,i?.id),t[21]=i?.id,t[22]=e,t[23]=w):w=t[23];let b;t[24]!==i||t[25]!==e?(b=!!i&&Y(e)&&Y(i.id),t[24]=i,t[25]=e,t[26]=b):b=t[26];let c;t[27]!==m||t[28]!==w||t[29]!==b?(c={queryKey:m,queryFn:w,enabled:b,staleTime:6e5},t[27]=m,t[28]=w,t[29]=b,t[30]=c):c=t[30];const{data:P}=I(c),R=P===void 0?!1:P;let $;t[31]!==i?.id||t[32]!==e?($=()=>_e(e,i?.id),t[31]=i?.id,t[32]=e,t[33]=$):$=t[33];let k;t[34]!==i?.id||t[35]!==e||t[36]!==n?(k=async()=>{await n.cancelQueries({queryKey:["post",e,"liked",i?.id]});const D=n.getQueryData(["post",e,"liked",i?.id]);return n.setQueryData(["post",e,"liked",i?.id],!D),f(Q=>({...Q,likes:D?(Q.likes||0)-1:(Q.likes||0)+1})),{previousLiked:D}},t[34]=i?.id,t[35]=e,t[36]=n,t[37]=k):k=t[37];let u;t[38]!==i?.id||t[39]!==e||t[40]!==n||t[41]!==o?(u=(D,Q,x)=>{x?.previousLiked!==void 0&&(n.setQueryData(["post",e,"liked",i?.id],x.previousLiked),f(W=>({...W,likes:x.previousLiked?(W.likes||0)+1:(W.likes||0)-1}))),o("Failed to update like","error")},t[38]=i?.id,t[39]=e,t[40]=n,t[41]=o,t[42]=u):u=t[42];let N;t[43]!==i?.id||t[44]!==e||t[45]!==n?(N=()=>{n.invalidateQueries({queryKey:["post",e,"liked",i?.id]})},t[43]=i?.id,t[44]=e,t[45]=n,t[46]=N):N=t[46];let T;t[47]!==$||t[48]!==k||t[49]!==u||t[50]!==N?(T={mutationFn:$,onMutate:k,onError:u,onSettled:N},t[47]=$,t[48]=k,t[49]=u,t[50]=N,t[51]=T):T=t[51];const K=ie(T);let L;t[52]!==i?.id||t[53]!==e?(L=()=>Re(e,i?.id),t[52]=i?.id,t[53]=e,t[54]=L):L=t[54];let d;t[55]!==i?.id||t[56]!==e||t[57]!==n?(d=async()=>{await n.cancelQueries({queryKey:["post",e,"reposted",i?.id]});const D=n.getQueryData(["post",e,"reposted",i?.id]);return n.setQueryData(["post",e,"reposted",i?.id],!D),f(Q=>({...Q,reposts:D?(Q.reposts||0)-1:(Q.reposts||0)+1,mirrors:D?(Q.mirrors||0)-1:(Q.mirrors||0)+1})),{previousReposted:D}},t[55]=i?.id,t[56]=e,t[57]=n,t[58]=d):d=t[58];let q;t[59]!==i?.id||t[60]!==e||t[61]!==n||t[62]!==o?(q=(D,Q,x)=>{x?.previousReposted!==void 0&&(n.setQueryData(["post",e,"reposted",i?.id],x.previousReposted),f(W=>({...W,reposts:x.previousReposted?(W.reposts||0)+1:(W.reposts||0)-1,mirrors:x.previousReposted?(W.mirrors||0)+1:(W.mirrors||0)-1}))),o("Failed to update repost","error")},t[59]=i?.id,t[60]=e,t[61]=n,t[62]=o,t[63]=q):q=t[63];let E;t[64]!==i?.id||t[65]!==e||t[66]!==n?(E=()=>{n.invalidateQueries({queryKey:["post",e,"reposted",i?.id]})},t[64]=i?.id,t[65]=e,t[66]=n,t[67]=E):E=t[67];let A;t[68]!==o?(A=D=>{o(D?"Reposted!":"Removed repost")},t[68]=o,t[69]=A):A=t[69];let O;t[70]!==L||t[71]!==d||t[72]!==q||t[73]!==E||t[74]!==A?(O={mutationFn:L,onMutate:d,onError:q,onSettled:E,onSuccess:A},t[70]=L,t[71]=d,t[72]=q,t[73]=E,t[74]=A,t[75]=O):O=t[75];const B=ie(O);let j;t[76]!==i||t[77]!==K||t[78]!==e||t[79]!==o?(j=async D=>{if(D&&D.stopPropagation(),!i)return o("Please login to like!","error");!Y(e)||!Y(i.id)||K.mutate()},t[76]=i,t[77]=K,t[78]=e,t[79]=o,t[80]=j):j=t[80];const H=j;let z;t[81]!==i||t[82]!==e||t[83]!==B||t[84]!==o?(z=async D=>{if(D&&D.stopPropagation(),!i)return o("Please login to repost!","error");!Y(e)||!Y(i.id)||B.mutate()},t[81]=i,t[82]=e,t[83]=B,t[84]=o,t[85]=z):z=t[85];const V=z;let J;return t[86]!==H||t[87]!==V||t[88]!==S||t[89]!==R||t[90]!==h?(J={liked:S,reposted:R,localStats:h,setLocalStats:f,handleLike:H,handleRepost:V},t[86]=H,t[87]=V,t[88]=S,t[89]=R,t[90]=h,t[91]=J):J=t[91],J};var Ee=G();const dt=e=>{const s=(0,Ee.c)(5);let i;s[0]!==e?(i=()=>ne(e),s[0]=e,s[1]=i):i=s[1];const[o,t]=(0,M.useState)(i);let n,a;return s[2]!==e?(n=()=>{if(!e)return;const h=setTimeout(()=>{t(ne(e))},0),f=setInterval(()=>{t(ne(e))},6e4);return()=>{clearTimeout(h),clearInterval(f)}},a=[e],s[2]=e,s[3]=n,s[4]=a):(n=s[3],a=s[4]),(0,M.useEffect)(n,a),o};var Ke=G();const ft=()=>{const e=(0,Ke.c)(27),[s,i]=(0,M.useState)(!1),[o,t]=(0,M.useState)(!1),[n,a]=(0,M.useState)(0),[h,f]=(0,M.useState)(null),[p,r]=(0,M.useState)(null),l=(0,M.useRef)(null),v=(0,M.useRef)(null);let C;e[0]===Symbol.for("react.memo_cache_sentinel")?(C=[],e[0]=C):C=e[0];const g=(0,M.useRef)(C);let y;e[1]===Symbol.for("react.memo_cache_sentinel")?(y=()=>{v.current=window.setInterval(()=>{a(Ae)},1e3)},e[1]=y):y=e[1];const _=y;let S;e[2]===Symbol.for("react.memo_cache_sentinel")?(S=()=>{v.current&&(clearInterval(v.current),v.current=null)},e[2]=S):S=e[2];const F=S;let m;e[3]===Symbol.for("react.memo_cache_sentinel")?(m=async()=>{try{const d=await navigator.mediaDevices.getUserMedia({audio:!0}),q=new MediaRecorder(d);l.current=q,g.current=[],q.ondataavailable=E=>{E.data.size>0&&g.current.push(E.data)},q.onstop=()=>{const E=new Blob(g.current,{type:"audio/webm;codecs=opus"}),A=URL.createObjectURL(E);f(E),r(A),d.getTracks().forEach(Oe)},q.start(),i(!0),t(!1),a(0),_()}catch(d){const q=d;throw console.error("Error accessing microphone:",q),q}},e[3]=m):m=e[3];const w=m;let b;e[4]!==s?(b=()=>{l.current&&s&&(l.current.stop(),i(!1),t(!1),F())},e[4]=s,e[5]=b):b=e[5];const c=b;let P;e[6]!==o||e[7]!==s?(P=()=>{l.current&&s&&!o&&(l.current.pause(),t(!0),F())},e[6]=o,e[7]=s,e[8]=P):P=e[8];const R=P;let $;e[9]!==o||e[10]!==s?($=()=>{l.current&&s&&o&&(l.current.resume(),t(!1),_())},e[9]=o,e[10]=s,e[11]=$):$=e[11];const k=$;let u;e[12]!==s?(u=()=>{l.current&&s&&(l.current.stop(),l.current.onstop=null,i(!1),t(!1),F(),a(0),l.current.stream&&l.current.stream.getTracks().forEach(Be))},e[12]=s,e[13]=u):u=e[13];const N=u;let T;e[14]!==p?(T=()=>{p&&URL.revokeObjectURL(p),f(null),r(null),a(0)},e[14]=p,e[15]=T):T=e[15];const K=T;let L;return e[16]!==h||e[17]!==p||e[18]!==N||e[19]!==K||e[20]!==o||e[21]!==s||e[22]!==R||e[23]!==n||e[24]!==k||e[25]!==c?(L={isRecording:s,isPaused:o,recordingTime:n,startRecording:w,stopRecording:c,pauseRecording:R,resumeRecording:k,cancelRecording:N,audioBlob:h,audioUrl:p,clearAudio:K},e[16]=h,e[17]=p,e[18]=N,e[19]=K,e[20]=o,e[21]=s,e[22]=R,e[23]=n,e[24]=k,e[25]=c,e[26]=L):L=e[26],L};function Ae(e){return e+1}function Oe(e){return e.stop()}function Be(e){return e.stop()}const mt=()=>{const{handle:e}=ee(),s=X(),{currentUser:i,getProfileByHandle:o}=Z(),{addToast:t}=se(),{data:n,isLoading:a}=I({queryKey:["profile",e],queryFn:()=>o(e),enabled:!!e,staleTime:1e3*60*5}),[h,f]=(0,M.useState)("feed"),{data:p,fetchNextPage:r,hasNextPage:l,isFetchingNextPage:v,isLoading:C}=U({queryKey:["posts","user",n?.id],queryFn:({pageParam:d})=>Te(n?.id,d,10),enabled:!!n?.id,initialPageParam:null,getNextPageParam:d=>{if(!(!d||d.length<10))return d[d.length-1].sort_timestamp||d[d.length-1].created_at}}),g=(0,M.useMemo)(()=>p?.pages.flatMap(d=>d)||[],[p]),[y,_]=(0,M.useState)(!1),[S,F]=(0,M.useState)("Followers"),[m,w]=(0,M.useState)([]),[b,c]=(0,M.useState)(!1),[P,R]=(0,M.useState)(!1),[$,k]=(0,M.useState)(!0),u=async(d,q=!1)=>{const E=n?.id;if(E){q?R(!0):(F(d),_(!0),c(!0),w([]));try{const A=q&&m.length>0?m[m.length-1].followed_at:null,O=d==="Followers"?await qe(E,A,10):await pe(E,A,10);O.length<10?k(!1):k(!0),w(q?B=>[...B,...O]:O)}catch(A){console.error(`Failed to fetch ${d}:`,A),t(`Failed to load ${d}`)}finally{c(!1),R(!1)}}},N=(0,M.useMemo)(()=>h==="feed"?g.filter(d=>d.community_id===null&&d.parent_id===null):h==="media"?g.filter(d=>d.community_id===null&&d.parent_id===null&&(d.type==="video"||d.type==="image"||d.media&&d.media.length>0)):h==="collections"?[]:g,[g,h]);return{handle:e,profile:n,loading:a,userPosts:g,setUserPosts:()=>console.warn("setUserPosts is deprecated"),activeProfileTab:h,setActiveProfileTab:f,loadingPosts:C,isFetchingMorePosts:v,hasMorePosts:l,filteredPosts:N,isFollowModalOpen:y,setIsFollowModalOpen:_,followModalType:S,followListData:m,isListLoading:b,isFetchingMoreFollows:P,hasMoreFollows:$,openFollowModal:u,handlePostClick:d=>{s(`/post/${d}`)},handleUserClick:d=>{d!==e&&s(`/u/${d}`)},loadUserPosts:(d=!1)=>{r()},currentUser:i,addToast:t,navigate:s}};var je=G();const gt=()=>{const e=(0,je.c)(74),{handle:s}=ee(),i=X(),{currentUser:o}=Z(),{addToast:t}=se(),n=te();let a,h;e[0]!==s?(a=["community",s],h=()=>me(s),e[0]=s,e[1]=a,e[2]=h):(a=e[1],h=e[2]);const f=!!s;let p;e[3]!==a||e[4]!==h||e[5]!==f?(p={queryKey:a,queryFn:h,enabled:f,staleTime:6e5},e[3]=a,e[4]=h,e[5]=f,e[6]=p):p=e[6];const{data:r,isLoading:l}=I(p),v=r?.id,C=o?.id;let g;e[7]!==v||e[8]!==C?(g=["community",v,"membership",C],e[7]=v,e[8]=C,e[9]=g):g=e[9];let y;e[10]!==r?.id||e[11]!==o?.id?(y=()=>Qe(r?.id,o?.id),e[10]=r?.id,e[11]=o?.id,e[12]=y):y=e[12];const _=!!r?.id&&!!o?.id;let S;e[13]!==g||e[14]!==y||e[15]!==_?(S={queryKey:g,queryFn:y,enabled:_,staleTime:3e5},e[13]=g,e[14]=y,e[15]=_,e[16]=S):S=e[16];const{data:F}=I(S),m=!!F,w=F?.role||null,b=r?.id;let c;e[17]!==b?(c=["posts","community",b],e[17]=b,e[18]=c):c=e[18];let P;e[19]!==r?.id?(P=D=>{const{pageParam:Q}=D;return Ne(r?.id,Q,10)},e[19]=r?.id,e[20]=P):P=e[20];const R=!!r?.id;let $;e[21]!==c||e[22]!==P||e[23]!==R?($={queryKey:c,queryFn:P,enabled:R,initialPageParam:null,getNextPageParam:He},e[21]=c,e[22]=P,e[23]=R,e[24]=$):$=e[24];const{data:k,fetchNextPage:u,hasNextPage:N,isFetchingNextPage:T,isLoading:K}=U($);let L;e[25]!==k?.pages?(L=k?.pages.flatMap(ze)||[],e[25]=k?.pages,e[26]=L):L=e[26];const d=L;let q;e[27]!==r?.id||e[28]!==o?.id?(q=()=>Se(r?.id,o?.id),e[27]=r?.id,e[28]=o?.id,e[29]=q):q=e[29];let E;e[30]!==r?.id||e[31]!==o?.id||e[32]!==s||e[33]!==n?(E=async()=>{await n.cancelQueries({queryKey:["community",r?.id,"membership",o?.id]}),await n.cancelQueries({queryKey:["community",s]});const D=n.getQueryData(["community",r?.id,"membership",o?.id]),Q=n.getQueryData(["community",s]);return n.setQueryData(["community",r?.id,"membership",o?.id],D?null:{role:"member"}),n.setQueryData(["community",s],x=>x&&{...x,membersCount:D?x.membersCount-1:x.membersCount+1}),{previousMembership:D,previousCommunity:Q}},e[30]=r?.id,e[31]=o?.id,e[32]=s,e[33]=n,e[34]=E):E=e[34];let A;e[35]!==t||e[36]!==r?.id||e[37]!==o?.id||e[38]!==s||e[39]!==n?(A=(D,Q,x)=>{x?.previousMembership!==void 0&&n.setQueryData(["community",r?.id,"membership",o?.id],x.previousMembership),x?.previousCommunity&&n.setQueryData(["community",s],x.previousCommunity),t("Failed to update membership","error")},e[35]=t,e[36]=r?.id,e[37]=o?.id,e[38]=s,e[39]=n,e[40]=A):A=e[40];let O;e[41]!==r?.id||e[42]!==o?.id||e[43]!==s||e[44]!==n?(O=()=>{n.invalidateQueries({queryKey:["community",r?.id,"membership",o?.id]}),n.invalidateQueries({queryKey:["community",s]})},e[41]=r?.id,e[42]=o?.id,e[43]=s,e[44]=n,e[45]=O):O=e[45];let B;e[46]!==t||e[47]!==r?(B=D=>{r&&t(D?`Joined ${r.name}`:`Left ${r.name}`)},e[46]=t,e[47]=r,e[48]=B):B=e[48];let j;e[49]!==q||e[50]!==E||e[51]!==A||e[52]!==O||e[53]!==B?(j={mutationFn:q,onMutate:E,onError:A,onSettled:O,onSuccess:B},e[49]=q,e[50]=E,e[51]=A,e[52]=O,e[53]=B,e[54]=j):j=e[54];const H=ie(j);let z;e[55]!==t||e[56]!==o||e[57]!==H?(z=async()=>{if(!o)return t("Please login to join communities","error");H.mutate()},e[55]=t,e[56]=o,e[57]=H,e[58]=z):z=e[58];const V=z;let J;return e[59]!==t||e[60]!==r||e[61]!==d||e[62]!==o||e[63]!==u||e[64]!==V||e[65]!==N||e[66]!==T||e[67]!==m||e[68]!==H.isPending||e[69]!==l||e[70]!==K||e[71]!==i||e[72]!==w?(J={community:r,loading:l,isMember:m,userRole:w,isJoining:H.isPending,communityPosts:d,loadingPosts:K,isFetchingMorePosts:T,hasMorePosts:N,handleJoinToggle:V,loadCommunityPosts:u,currentUser:o,addToast:t,navigate:i},e[59]=t,e[60]=r,e[61]=d,e[62]=o,e[63]=u,e[64]=V,e[65]=N,e[66]=T,e[67]=m,e[68]=H.isPending,e[69]=l,e[70]=K,e[71]=i,e[72]=w,e[73]=J):J=e[73],J};function He(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function ze(e){return e}const ht=()=>{const{currentUser:e}=Z(),s=X(),i=ue(),o=new URLSearchParams(i.search),t=o.get("q")||"",n=o.get("tab")||(t?"posts":"communities"),[a,h]=(0,M.useState)(t),[f,p]=(0,M.useState)(n),[r,l]=(0,M.useState)(!1);(0,M.useEffect)(()=>{t!==a&&(h(t),t&&p("posts"))},[t]);const{data:v,fetchNextPage:C,hasNextPage:g,isFetchingNextPage:y,isLoading:_}=U({queryKey:["explore","communities"],queryFn:({pageParam:u})=>Ce(u,10),initialPageParam:null,getNextPageParam:u=>{if(!(!u||u.length<10))return u[u.length-1].createdAt}}),S=(0,M.useMemo)(()=>v?.pages.flatMap(u=>u)||[],[v]),{data:F,fetchNextPage:m,hasNextPage:w,isFetchingNextPage:b,isLoading:c}=U({queryKey:["explore","posts",a],queryFn:({pageParam:u})=>a?ye(a,u,10,!0):Pe(u,10),initialPageParam:null,getNextPageParam:u=>{if(!(!u||u.length<10))return u[u.length-1].sort_timestamp||u[u.length-1].sortTimestamp}}),P=(0,M.useMemo)(()=>F?.pages.flatMap(u=>u)||[],[F]),R=(0,M.useMemo)(()=>{let u=S;return a&&(u=u.filter(N=>N.name?.toLowerCase().includes(a.toLowerCase())||N.handle?.toLowerCase().includes(a.toLowerCase()))),u},[S,a]);return{currentUser:e,searchQuery:a,setSearchQuery:u=>{h(u)},activeTab:f,setActiveTab:p,isCreateModalOpen:r,setIsCreateModalOpen:l,communitiesData:S,isCommunitiesLoading:_,isFetchingMoreCommunities:y,hasMoreCommunities:g,postsData:P,isPostsLoading:c,isFetchingMorePosts:b,hasMorePosts:w,filteredCommunities:R,handleCommunityClick:u=>{s(`/c/${u}`)},loadCommunities:C,loadPosts:m,navigate:s}};var Je=G();const yt=()=>{const e=(0,Je.c)(21),{currentUser:s}=Z(),{posts:i,loading:o,hasMore:t,isFetchingNextPage:n,fetchNextPage:a}=ke(),{addToast:h}=se(),f=X();let p;e[0]===Symbol.for("react.memo_cache_sentinel")?(p={queryKey:["stories"],queryFn:he},e[0]=p):p=e[0];const{data:r,isLoading:l}=I(p);let v;e[1]!==r?(v=r===void 0?[]:r,e[1]=r,e[2]=v):v=e[2];const C=v;let g;if(e[3]!==C){const c={};C.forEach(P=>{if(!P.user)return;const R=P.user.id;c[R]||(c[R]={user:P.user,stories:[]}),c[R].stories.push(P)}),g=Object.values(c),e[3]=C,e[4]=g}else g=e[4];const y=g,_=i;let S;e[5]!==f?(S=c=>{f(`/post/${c}`)},e[5]=f,e[6]=S):S=e[6];const F=S;let m;e[7]!==f?(m=c=>{f(`/u/${c}`)},e[7]=f,e[8]=m):m=e[8];const w=m;let b;return e[9]!==h||e[10]!==s||e[11]!==a||e[12]!==y||e[13]!==F||e[14]!==w||e[15]!==t||e[16]!==_||e[17]!==n||e[18]!==o||e[19]!==l?(b={currentUser:s,homePosts:_,groupedStories:y,isPostsLoading:o,isStoriesLoading:l,hasMore:t,isFetchingNextPage:n,fetchNextPage:a,addToast:h,handlePostClick:F,handleUserClick:w},e[9]=h,e[10]=s,e[11]=a,e[12]=y,e[13]=F,e[14]=w,e[15]=t,e[16]=_,e[17]=n,e[18]=o,e[19]=l,e[20]=b):b=e[20],b};var Ve=G();const pt=()=>{const e=(0,Ve.c)(57),{id:s}=ee(),i=X(),{currentUser:o}=Z(),{onlineUsers:t}=De(),n=te(),[a,h]=(0,M.useState)("");let f;e[0]===Symbol.for("react.memo_cache_sentinel")?(f=[],e[0]=f):f=e[0];const[p,r]=(0,M.useState)(f),{conversations:l,isConvLoading:v,sendMessage:C,sendTypingStatus:g,typingStatus:y,markAsRead:_,formatMessages:S,onDeleteMessage:F,conversationReactions:m,messages:w,isMsgLoading:b,fetchNextMessages:c,hasMoreMessages:P,isFetchingMoreMessages:R}=$e(o,s);let $;e:{if(!s||l.length===0){$=null;break e}let Q;e[1]!==l||e[2]!==s?(Q=l.find(x=>x.id===s)||null,e[1]=l,e[2]=s,e[3]=Q):Q=e[3],$=Q}const k=$;let u,N;e[4]!==s||e[5]!==_?(u=()=>{s&&_(s)},N=[s,_],e[4]=s,e[5]=_,e[6]=u,e[7]=N):(u=e[6],N=e[7]),(0,M.useEffect)(u,N);let T;e[8]!==l||e[9]!==o?.id||e[10]!==a?(T=()=>{const Q=setTimeout(async()=>{if(a.length>1){const x=await Le(a),W=l.map(We);r(x.filter(ae=>ae.id!==o?.id&&!W.includes(ae.id)))}else r([])},300);return()=>clearTimeout(Q)},e[8]=l,e[9]=o?.id,e[10]=a,e[11]=T):T=e[11];const K=o?.id;let L;e[12]!==l||e[13]!==a||e[14]!==K?(L=[a,l,K],e[12]=l,e[13]=a,e[14]=K,e[15]=L):L=e[15],(0,M.useEffect)(T,L);let d;e[16]!==o||e[17]!==i||e[18]!==n?(d=async Q=>{if(o)try{const x=await de(o.id,Q.id);n.invalidateQueries({queryKey:["conversations",o.id]}),h(""),i(`/messages/${x}`)}catch(x){console.error("Failed to start conversation:",x)}},e[16]=o,e[17]=i,e[18]=n,e[19]=d):d=e[19];const q=d;let E;e[20]!==i?(E=Q=>{i(`/messages/${Q.id}`)},e[20]=i,e[21]=E):E=e[21];const A=E;let O;e[22]!==m||e[23]!==S||e[24]!==w?(O=S(w,m),e[22]=m,e[23]=S,e[24]=w,e[25]=O):O=e[25];const B=O;let j;if(e[26]!==l||e[27]!==a){let Q;e[29]!==a?(Q=x=>x.user?.name?.toLowerCase().includes(a.toLowerCase())||x.user?.handle?.toLowerCase().includes(a.toLowerCase())||x.lastMessage?.toLowerCase().includes(a.toLowerCase()),e[29]=a,e[30]=Q):Q=e[30],j=l.filter(Q),e[26]=l,e[27]=a,e[28]=j}else j=e[28];const H=j,z=k&&y[k.id];let V;e[31]!==t||e[32]!==k?(V=k&&k.user?.id&&t.has(k.user.id),e[31]=t,e[32]=k,e[33]=V):V=e[33];const J=V;let D;return e[34]!==l||e[35]!==z||e[36]!==o||e[37]!==c||e[38]!==H||e[39]!==A||e[40]!==q||e[41]!==P||e[42]!==s||e[43]!==v||e[44]!==R||e[45]!==b||e[46]!==B||e[47]!==a||e[48]!==i||e[49]!==F||e[50]!==t||e[51]!==J||e[52]!==k||e[53]!==C||e[54]!==g||e[55]!==p?(D={id:s,currentUser:o,onlineUsers:t,msgSearchQuery:a,setMsgSearchQuery:h,userSearchResults:p,conversations:l,filteredConversations:H,selectedConversation:k,localMessages:B,isConvLoading:v,isMsgLoading:b,currentIsTyping:z,otherUserIsOnline:J,handleStartConversation:q,handleSelectConversation:A,sendMessage:C,onDeleteMessage:F,sendTypingStatus:g,navigate:i,fetchNextMessages:c,hasMoreMessages:P,isFetchingMoreMessages:R},e[34]=l,e[35]=z,e[36]=o,e[37]=c,e[38]=H,e[39]=A,e[40]=q,e[41]=P,e[42]=s,e[43]=v,e[44]=R,e[45]=b,e[46]=B,e[47]=a,e[48]=i,e[49]=F,e[50]=t,e[51]=J,e[52]=k,e[53]=C,e[54]=g,e[55]=p,e[56]=D):D=e[56],D};function We(e){return e.user?.id}var Ye=G();const Pt=()=>{const e=(0,Ye.c)(47),{currentUser:s}=Z(),i=X(),o=te(),t=s?.id;let n;e[0]!==t?(n=["notifications",t],e[0]=t,e[1]=n):n=e[1];let a;e[2]!==s?.id?(a=L=>{const{pageParam:d}=L;return ge(s?.id,d,10)},e[2]=s?.id,e[3]=a):a=e[3];const h=!!s?.id;let f;e[4]!==n||e[5]!==a||e[6]!==h?(f={queryKey:n,queryFn:a,enabled:h,initialPageParam:null,getNextPageParam:Ge},e[4]=n,e[5]=a,e[6]=h,e[7]=f):f=e[7];const{data:p,fetchNextPage:r,hasNextPage:l,isFetchingNextPage:v,isLoading:C}=U(f);let g;e[8]!==p?.pages?(g=p?.pages.flatMap(Xe)||[],e[8]=p?.pages,e[9]=g):g=e[9];const y=g;let _;e[10]!==s||e[11]!==o?(_=()=>{if(!s?.id)return;const L=oe.channel(`user_notifications:${s.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${s.id}`},()=>{o.invalidateQueries({queryKey:["notifications",s.id]})}).subscribe();return()=>{oe.removeChannel(L)}},e[10]=s,e[11]=o,e[12]=_):_=e[12];const S=s?.id;let F;e[13]!==o||e[14]!==S?(F=[S,o],e[13]=o,e[14]=S,e[15]=F):F=e[15],(0,M.useEffect)(_,F);let m;e[16]!==s?(m=()=>s?we(s.id):Promise.resolve(),e[16]=s,e[17]=m):m=e[17];let w,b,c;e[18]!==s?.id||e[19]!==o?(w=async()=>{await o.cancelQueries({queryKey:["notifications",s?.id]});const L=o.getQueryData(["notifications",s?.id]);return o.setQueryData(["notifications",s?.id],Ue),{previousNotifications:L}},b=(L,d,q)=>{q?.previousNotifications&&o.setQueryData(["notifications",s?.id],q.previousNotifications)},c=()=>{o.invalidateQueries({queryKey:["notifications",s?.id]})},e[18]=s?.id,e[19]=o,e[20]=w,e[21]=b,e[22]=c):(w=e[20],b=e[21],c=e[22]);let P;e[23]!==w||e[24]!==b||e[25]!==c||e[26]!==m?(P={mutationFn:m,onMutate:w,onError:b,onSettled:c},e[23]=w,e[24]=b,e[25]=c,e[26]=m,e[27]=P):P=e[27];const R=ie(P);let $;e[28]!==i?($=L=>{L.type==="follow"?i(`/u/${L.user}`):L.post_id&&i(`/post/${L.post_id}`)},e[28]=i,e[29]=$):$=e[29];const k=$;let u;e[30]!==s?.id||e[31]!==R||e[32]!==y?(u=()=>{s?.id&&y.some(et)&&R.mutate()},e[30]=s?.id,e[31]=R,e[32]=y,e[33]=u):u=e[33];const N=s?.id;let T;e[34]!==R||e[35]!==y.length||e[36]!==N?(T=[N,y.length,R],e[34]=R,e[35]=y.length,e[36]=N,e[37]=T):T=e[37],(0,M.useEffect)(u,T);let K;return e[38]!==s||e[39]!==r||e[40]!==k||e[41]!==l||e[42]!==v||e[43]!==C||e[44]!==i||e[45]!==y?(K={currentUser:s,notifications:y,isLoading:C,isFetchingMore:v,hasMore:l,loadNotifications:r,handleNotificationClick:k,navigate:i},e[38]=s,e[39]=r,e[40]=k,e[41]=l,e[42]=v,e[43]=C,e[44]=i,e[45]=y,e[46]=K):K=e[46],K};function Ge(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Xe(e){return e}function Ze(e){return{...e,is_read:!0}}function Ie(e){return e.map(Ze)}function Ue(e){return e&&{...e,pages:e.pages.map(Ie)}}function et(e){return!e.is_read}var tt=G();const vt=()=>{const e=(0,tt.c)(23),{id:s}=ee(),i=X(),{currentUser:o}=Z(),{addToast:t}=se(),n=te();let a,h;e[0]!==s?(a=["post",s],h=async()=>{if(!s||!Y(s))throw new Error("Invalid post ID");return Me(s)},e[0]=s,e[1]=a,e[2]=h):(a=e[1],h=e[2]);const f=!!s;let p;e[3]!==a||e[4]!==h||e[5]!==f?(p={queryKey:a,queryFn:h,enabled:f,retry:!1},e[3]=a,e[4]=h,e[5]=f,e[6]=p):p=e[6];const{data:r,isLoading:l,isError:v}=I(p);let C;e[7]!==i?(C=w=>{i(`/u/${w}`)},e[7]=i,e[8]=C):C=e[8];const g=C;let y;e[9]!==i?(y=()=>{i(-1)},e[9]=i,e[10]=y):y=e[10];const _=y;let S;e[11]!==n?(S=(w,b,c)=>{n.setQueryData(["post",w],P=>P&&{...P,content:b,media:c})},e[11]=n,e[12]=S):S=e[12];const F=S;let m;return e[13]!==t||e[14]!==o||e[15]!==_||e[16]!==F||e[17]!==g||e[18]!==v||e[19]!==l||e[20]!==i||e[21]!==r?(m={post:r,isLoading:l,isError:v,currentUser:o,addToast:t,navigate:i,handleUserClick:g,handleDelete:_,handleUpdate:F},e[13]=t,e[14]=o,e[15]=_,e[16]=F,e[17]=g,e[18]=v,e[19]=l,e[20]=i,e[21]=r,e[22]=m):m=e[22],m};var st=G();const wt=()=>{const e=(0,st.c)(32),s=X(),{id:i}=ee(),[o]=ce();let t;e[0]!==i||e[1]!==o?(t=i||o.get("id"),e[0]=i,e[1]=o,e[2]=t):t=e[2];const n=t,a=(0,M.useRef)(null),[h,f]=(0,M.useState)(null),[p,r]=(0,M.useState)(!0);let l;e[3]===Symbol.for("react.memo_cache_sentinel")?(l=["reels"],e[3]=l):l=e[3];let v;e[4]===Symbol.for("react.memo_cache_sentinel")?(v={queryKey:l,queryFn:it,initialPageParam:null,getNextPageParam:ot},e[4]=v):v=e[4];const{data:C,fetchNextPage:g,hasNextPage:y,isFetchingNextPage:_,isLoading:S}=U(v);let F;e[5]!==C?.pages?(F=C?.pages.flatMap(nt)||[],e[5]=C?.pages,e[6]=F):F=e[6];const m=F;let w,b;e[7]!==h||e[8]!==m||e[9]!==n?(w=()=>{m.length>0&&(n&&m.find(T=>T.id===n)?(f(n),setTimeout(()=>{document.querySelector(`[data-id="${n}"]`)?.scrollIntoView({behavior:"instant"})},100)):h||f(m[0].id))},b=[m,n,h],e[7]=h,e[8]=m,e[9]=n,e[10]=w,e[11]=b):(w=e[10],b=e[11]),(0,M.useEffect)(w,b);let c,P;e[12]!==m.length?(c=()=>{if(m.length===0)return;const T={root:a.current,threshold:.6},K=d=>{d.forEach(q=>{q.isIntersecting&&f(q.target.dataset.id)})},L=new IntersectionObserver(K,T);return setTimeout(()=>{document.querySelectorAll(".reel-item").forEach(d=>L.observe(d))},100),()=>L.disconnect()},P=[m.length],e[12]=m.length,e[13]=c,e[14]=P):(c=e[13],P=e[14]),(0,M.useEffect)(c,P);let R;e[15]!==p?(R=()=>{r(!p)},e[15]=p,e[16]=R):R=e[16];const $=R;let k,u;e[17]!==g||e[18]!==y||e[19]!==_?(u=()=>{const T=()=>{if(!a.current||_||!y)return;const{scrollTop:L,scrollHeight:d,clientHeight:q}=a.current;L+q>=d-800&&g()},K=a.current;if(K)return K.addEventListener("scroll",T),()=>K.removeEventListener("scroll",T)},k=[_,y,g],e[17]=g,e[18]=y,e[19]=_,e[20]=k,e[21]=u):(k=e[20],u=e[21]),(0,M.useEffect)(u,k);let N;return e[22]!==h||e[23]!==g||e[24]!==y||e[25]!==_||e[26]!==S||e[27]!==p||e[28]!==s||e[29]!==m||e[30]!==$?(N={reels:m,loading:S,loadingMore:_,activeReelId:h,hasMore:y,isMuted:p,containerRef:a,navigate:s,toggleMute:$,loadReels:g},e[22]=h,e[23]=g,e[24]=y,e[25]=_,e[26]=S,e[27]=p,e[28]=s,e[29]=m,e[30]=$,e[31]=N):N=e[31],N};function it(e){const{pageParam:s}=e;return fe(s,10)}function ot(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function nt(e){return e}const bt=()=>{const{currentUser:e,logout:s}=Z(),{darkMode:i,toggleDarkMode:o,fontSize:t,setFontSize:n,dataSaver:a,setDataSaver:h}=Fe(),{addToast:f}=se(),[p,r]=(0,M.useState)(!1),[l,v]=(0,M.useState)({newPassword:"",confirmPassword:""}),[C,g]=(0,M.useState)(!1),y=async()=>{try{await s(),f("Logged out successfully")}catch(c){console.error("Logout error:",c),f("Failed to logout")}};return{currentUser:e,darkMode:i,toggleDarkMode:o,fontSize:t,setFontSize:n,dataSaver:a,setDataSaver:h,isChangingPassword:p,setIsChangingPassword:r,passwordData:l,setPasswordData:v,loading:C,handleLogout:y,handlePasswordChange:async c=>{if(c.preventDefault(),l.newPassword!==l.confirmPassword){f("Passwords do not match","error");return}if(l.newPassword.length<6){f("Password must be at least 6 characters","error");return}g(!0);try{const{error:P}=await oe.auth.updateUser({password:l.newPassword});if(P)throw P;f("Password updated successfully!"),r(!1),v({newPassword:"",confirmPassword:""})}catch(P){console.error("Password update error:",P),f(P.message||"Failed to update password","error")}finally{g(!1)}},handlePasswordReset:async()=>{if(e?.email){g(!0);try{const{error:c}=await oe.auth.resetPasswordForEmail(e.email,{redirectTo:`${window.location.origin}/settings?type=recovery`});if(c)throw c;f("Password reset email sent!")}catch(c){console.error("Reset password error:",c),f(c.message||"Failed to send reset email","error")}finally{g(!1)}}},handleClearCache:()=>{["seenStories","font-size","data-saver","theme"].forEach(c=>localStorage.removeItem(c)),f("Cache cleared! Reloading..."),setTimeout(()=>window.location.reload(),1500)},handleDownloadData:async()=>{if(e){g(!0);try{const c={user:{id:e.id,handle:e.handle,name:e.name,email:e.email},exportDate:new Date().toISOString(),note:"This is a mock export of your Sysm data."},P=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),R=URL.createObjectURL(P),$=document.createElement("a");$.href=R,$.download=`sysm-data-${e.handle}.json`,$.click(),URL.revokeObjectURL(R),f("Data export started!")}catch{f("Failed to export data","error")}finally{g(!1)}}},handleDeleteAccount:()=>{window.confirm("Are you absolutely sure? This will permanently delete your account and all associated data. This action is irreversible.")&&(f("Account deletion request submitted. Logging out..."),setTimeout(y,2e3))},handleReportBug:()=>{window.prompt("Please describe the bug you found:")&&f("Bug reported! Thank you for your feedback.")}}};export{pt as a,gt as c,dt as d,ut as f,Pt as i,mt as l,wt as n,yt as o,vt as r,ht as s,bt as t,ft as u};
