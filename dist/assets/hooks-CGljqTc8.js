import{a as re}from"./rolldown-runtime-BaZ8gS7u.js";import{b as ie,s as G,v as le,w as ce,y as W}from"./framework-C-7_uJf4.js";import{a as oe,n as te,r as I,t as U}from"./query-RUmkip9n.js";import{At as ue,Ct as de,Dt as fe,Et as me,Ft as ge,Ht as he,It as ye,Lt as pe,Nt as Pe,Pt as ve,Rt as we,St as Ce,Tt as Me,Ut as be,Vt as Fe,Xt as se,Yt as Y,bt as Se,ft as Le,gt as Z,ht as _e,i as ke,jt as qe,mt as De,pt as ee,qt as ae,wt as Ne,xt as $e,yt as Re,zt as Qe}from"./index-zVfS_0kr.js";var xe=G(),_=re(ce(),1);const at=(e,s,i,o)=>{const t=(0,xe.c)(94),a=oe();let n;t[0]!==s?(n=s||{comments:0,likes:0,mirrors:0,reposts:0},t[0]=s,t[1]=n):n=t[1];const[y,l]=(0,_.useState)(n);let C,r;t[2]!==s?(C=()=>{s&&l(Q=>({...Q,...s}))},r=[s],t[2]=s,t[3]=C,t[4]=r):(C=t[3],r=t[4]),(0,_.useEffect)(C,r);const f=i?.id;let h;t[5]!==e||t[6]!==f?(h=["post",e,"liked",f],t[5]=e,t[6]=f,t[7]=h):h=t[7];let b;t[8]!==i?.id||t[9]!==e?(b=()=>ue(e,i?.id),t[8]=i?.id,t[9]=e,t[10]=b):b=t[10];let m;t[11]!==i||t[12]!==e?(m=!!i&&Y(e)&&Y(i.id),t[11]=i,t[12]=e,t[13]=m):m=t[13];let u;t[14]!==h||t[15]!==b||t[16]!==m?(u={queryKey:h,queryFn:b,enabled:m,initialData:!1,staleTime:1/0},t[14]=h,t[15]=b,t[16]=m,t[17]=u):u=t[17];const{data:F}=I(u),v=F===void 0?!1:F,N=i?.id;let w;t[18]!==e||t[19]!==N?(w=["post",e,"reposted",N],t[18]=e,t[19]=N,t[20]=w):w=t[20];let M;t[21]!==i?.id||t[22]!==e?(M=()=>qe(e,i?.id),t[21]=i?.id,t[22]=e,t[23]=M):M=t[23];let S;t[24]!==i||t[25]!==e?(S=!!i&&Y(e)&&Y(i.id),t[24]=i,t[25]=e,t[26]=S):S=t[26];let d;t[27]!==w||t[28]!==M||t[29]!==S?(d={queryKey:w,queryFn:M,enabled:S,initialData:!1,staleTime:1/0},t[27]=w,t[28]=M,t[29]=S,t[30]=d):d=t[30];const{data:p}=I(d),P=p===void 0?!1:p;let k;t[31]!==i?.id||t[32]!==e?(k=()=>we(e,i?.id),t[31]=i?.id,t[32]=e,t[33]=k):k=t[33];let L;t[34]!==i?.id||t[35]!==v||t[36]!==e||t[37]!==a?(L=async()=>{await a.cancelQueries({queryKey:["post",e,"liked",i?.id]});const Q=a.getQueryData(["post",e,"liked",i?.id]);return a.setQueryData(["post",e,"liked",i?.id],!v),l(q=>({...q,likes:v?(q.likes||0)-1:(q.likes||0)+1})),{previousLiked:Q}},t[34]=i?.id,t[35]=v,t[36]=e,t[37]=a,t[38]=L):L=t[38];let c;t[39]!==i?.id||t[40]!==e||t[41]!==a||t[42]!==o?(c=(Q,q,D)=>{D?.previousLiked!==void 0&&(a.setQueryData(["post",e,"liked",i?.id],D.previousLiked),l(X=>({...X,likes:D.previousLiked?(X.likes||0)+1:(X.likes||0)-1}))),o("Failed to update like","error")},t[39]=i?.id,t[40]=e,t[41]=a,t[42]=o,t[43]=c):c=t[43];let $;t[44]!==i?.id||t[45]!==e||t[46]!==a?($=()=>{a.invalidateQueries({queryKey:["post",e,"liked",i?.id]})},t[44]=i?.id,t[45]=e,t[46]=a,t[47]=$):$=t[47];let x;t[48]!==k||t[49]!==L||t[50]!==c||t[51]!==$?(x={mutationFn:k,onMutate:L,onError:c,onSettled:$},t[48]=k,t[49]=L,t[50]=c,t[51]=$,t[52]=x):x=t[52];const O=te(x);let R;t[53]!==i?.id||t[54]!==e?(R=()=>Qe(e,i?.id),t[53]=i?.id,t[54]=e,t[55]=R):R=t[55];let g;t[56]!==i?.id||t[57]!==P||t[58]!==e||t[59]!==a?(g=async()=>{await a.cancelQueries({queryKey:["post",e,"reposted",i?.id]});const Q=a.getQueryData(["post",e,"reposted",i?.id]);return a.setQueryData(["post",e,"reposted",i?.id],!P),l(q=>({...q,mirrors:P?(q.mirrors||0)-1:(q.mirrors||0)+1,reposts:P?(q.reposts||0)-1:(q.reposts||0)+1})),{previousReposted:Q}},t[56]=i?.id,t[57]=P,t[58]=e,t[59]=a,t[60]=g):g=t[60];let E;t[61]!==i?.id||t[62]!==e||t[63]!==a||t[64]!==o?(E=(Q,q,D)=>{D?.previousReposted!==void 0&&(a.setQueryData(["post",e,"reposted",i?.id],D.previousReposted),l(X=>({...X,mirrors:D.previousReposted?(X.mirrors||0)+1:(X.mirrors||0)-1,reposts:D.previousReposted?(X.reposts||0)+1:(X.reposts||0)-1}))),o("Failed to update repost","error")},t[61]=i?.id,t[62]=e,t[63]=a,t[64]=o,t[65]=E):E=t[65];let T;t[66]!==i?.id||t[67]!==e||t[68]!==a?(T=()=>{a.invalidateQueries({queryKey:["post",e,"reposted",i?.id]})},t[66]=i?.id,t[67]=e,t[68]=a,t[69]=T):T=t[69];let K;t[70]!==o?(K=Q=>{o(Q?"Reposted!":"Removed repost")},t[70]=o,t[71]=K):K=t[71];let A;t[72]!==R||t[73]!==g||t[74]!==E||t[75]!==T||t[76]!==K?(A={mutationFn:R,onMutate:g,onError:E,onSettled:T,onSuccess:K},t[72]=R,t[73]=g,t[74]=E,t[75]=T,t[76]=K,t[77]=A):A=t[77];const j=te(A);let B;t[78]!==i||t[79]!==O||t[80]!==e||t[81]!==o?(B=async Q=>{if(Q&&Q.stopPropagation(),!i)return o("Please login to like!","error");!Y(e)||!Y(i.id)||O.mutate()},t[78]=i,t[79]=O,t[80]=e,t[81]=o,t[82]=B):B=t[82];const H=B;let z;t[83]!==i||t[84]!==e||t[85]!==j||t[86]!==o?(z=async Q=>{if(Q&&Q.stopPropagation(),!i)return o("Please login to repost!","error");!Y(e)||!Y(i.id)||j.mutate()},t[83]=i,t[84]=e,t[85]=j,t[86]=o,t[87]=z):z=t[87];const V=z;let J;return t[88]!==H||t[89]!==V||t[90]!==v||t[91]!==P||t[92]!==y?(J={liked:v,reposted:P,localStats:y,setLocalStats:l,handleLike:H,handleRepost:V},t[88]=H,t[89]=V,t[90]=v,t[91]=P,t[92]=y,t[93]=J):J=t[93],J};var Ee=G();const nt=e=>{const s=(0,Ee.c)(5);let i;s[0]!==e?(i=()=>ae(e),s[0]=e,s[1]=i):i=s[1];const[o,t]=(0,_.useState)(i);let a,n;return s[2]!==e?(a=()=>{if(!e)return;const y=setTimeout(()=>{t(ae(e))},0),l=setInterval(()=>{t(ae(e))},6e4);return()=>{clearTimeout(y),clearInterval(l)}},n=[e],s[2]=e,s[3]=a,s[4]=n):(a=s[3],n=s[4]),(0,_.useEffect)(a,n),o},rt=()=>{const{handle:e}=ie(),s=W(),{currentUser:i,getProfileByHandle:o}=Z(),{addToast:t}=ee(),{data:a,isLoading:n}=I({queryKey:["profile",e],queryFn:()=>o(e),enabled:!!e,staleTime:1e3*60*5}),[y,l]=(0,_.useState)("feed"),{data:C,fetchNextPage:r,hasNextPage:f,isFetchingNextPage:h,isLoading:b}=U({queryKey:["posts","user",a?.id],queryFn:({pageParam:g})=>ge(a?.id,g,10),enabled:!!a?.id,initialPageParam:null,getNextPageParam:g=>{if(!(!g||g.length<10))return g[g.length-1].sort_timestamp||g[g.length-1].created_at}}),m=(0,_.useMemo)(()=>C?.pages.flatMap(g=>g)||[],[C]),[u,F]=(0,_.useState)(!1),[v,N]=(0,_.useState)("Followers"),[w,M]=(0,_.useState)([]),[S,d]=(0,_.useState)(!1),[p,P]=(0,_.useState)(!1),[k,L]=(0,_.useState)(!0),c=async(g,E=!1)=>{const T=a?.id;if(T){E?P(!0):(N(g),F(!0),d(!0),M([]));try{const K=E&&w.length>0?w[w.length-1].followed_at:null,A=g==="Followers"?await Fe(T,K,10):await he(T,K,10);A.length<10?L(!1):L(!0),M(E?j=>[...j,...A]:A)}catch(K){console.error(`Failed to fetch ${g}:`,K),t(`Failed to load ${g}`)}finally{d(!1),P(!1)}}},$=(0,_.useMemo)(()=>y==="feed"?m.filter(g=>g.community_id===null&&g.parent_id===null):y==="media"?m.filter(g=>g.community_id===null&&g.parent_id===null&&(g.type==="video"||g.type==="image"||g.media&&g.media.length>0)):y==="collections"?[]:m,[m,y]);return{handle:e,profile:a,loading:n,userPosts:m,setUserPosts:()=>console.warn("setUserPosts is deprecated"),activeProfileTab:y,setActiveProfileTab:l,loadingPosts:b,isFetchingMorePosts:h,hasMorePosts:f,filteredPosts:$,isFollowModalOpen:u,setIsFollowModalOpen:F,followModalType:v,followListData:w,isListLoading:S,isFetchingMoreFollows:p,hasMoreFollows:k,openFollowModal:c,handlePostClick:g=>{s(`/post/${g}`)},handleUserClick:g=>{g!==e&&s(`/u/${g}`)},loadUserPosts:(g=!1)=>{r()},currentUser:i,addToast:t,navigate:s}};var Te=G();const lt=()=>{const e=(0,Te.c)(74),{handle:s}=ie(),i=W(),{currentUser:o}=Z(),{addToast:t}=ee(),a=oe();let n,y;e[0]!==s?(n=["community",s],y=()=>$e(s),e[0]=s,e[1]=n,e[2]=y):(n=e[1],y=e[2]);const l=!!s;let C;e[3]!==n||e[4]!==y||e[5]!==l?(C={queryKey:n,queryFn:y,enabled:l,staleTime:6e5},e[3]=n,e[4]=y,e[5]=l,e[6]=C):C=e[6];const{data:r,isLoading:f}=I(C),h=r?.id,b=o?.id;let m;e[7]!==h||e[8]!==b?(m=["community",h,"membership",b],e[7]=h,e[8]=b,e[9]=m):m=e[9];let u;e[10]!==r?.id||e[11]!==o?.id?(u=()=>Re(r?.id,o?.id),e[10]=r?.id,e[11]=o?.id,e[12]=u):u=e[12];const F=!!r?.id&&!!o?.id;let v;e[13]!==m||e[14]!==u||e[15]!==F?(v={queryKey:m,queryFn:u,enabled:F,staleTime:3e5},e[13]=m,e[14]=u,e[15]=F,e[16]=v):v=e[16];const{data:N}=I(v),w=!!N,M=N?.role||null,S=r?.id;let d;e[17]!==S?(d=["posts","community",S],e[17]=S,e[18]=d):d=e[18];let p;e[19]!==r?.id?(p=Q=>{const{pageParam:q}=Q;return Ce(r?.id,q,10)},e[19]=r?.id,e[20]=p):p=e[20];const P=!!r?.id;let k;e[21]!==d||e[22]!==p||e[23]!==P?(k={queryKey:d,queryFn:p,enabled:P,initialPageParam:null,getNextPageParam:Ke},e[21]=d,e[22]=p,e[23]=P,e[24]=k):k=e[24];const{data:L,fetchNextPage:c,hasNextPage:$,isFetchingNextPage:x,isLoading:O}=U(k);let R;e[25]!==L?.pages?(R=L?.pages.flatMap(Ae)||[],e[25]=L?.pages,e[26]=R):R=e[26];const g=R;let E;e[27]!==r?.id||e[28]!==o?.id?(E=()=>de(r?.id,o?.id),e[27]=r?.id,e[28]=o?.id,e[29]=E):E=e[29];let T;e[30]!==r?.id||e[31]!==o?.id||e[32]!==s||e[33]!==a?(T=async()=>{await a.cancelQueries({queryKey:["community",r?.id,"membership",o?.id]}),await a.cancelQueries({queryKey:["community",s]});const Q=a.getQueryData(["community",r?.id,"membership",o?.id]),q=a.getQueryData(["community",s]);return a.setQueryData(["community",r?.id,"membership",o?.id],Q?null:{role:"member"}),a.setQueryData(["community",s],D=>D&&{...D,membersCount:Q?D.membersCount-1:D.membersCount+1}),{previousMembership:Q,previousCommunity:q}},e[30]=r?.id,e[31]=o?.id,e[32]=s,e[33]=a,e[34]=T):T=e[34];let K;e[35]!==t||e[36]!==r?.id||e[37]!==o?.id||e[38]!==s||e[39]!==a?(K=(Q,q,D)=>{D?.previousMembership!==void 0&&a.setQueryData(["community",r?.id,"membership",o?.id],D.previousMembership),D?.previousCommunity&&a.setQueryData(["community",s],D.previousCommunity),t("Failed to update membership","error")},e[35]=t,e[36]=r?.id,e[37]=o?.id,e[38]=s,e[39]=a,e[40]=K):K=e[40];let A;e[41]!==r?.id||e[42]!==o?.id||e[43]!==s||e[44]!==a?(A=()=>{a.invalidateQueries({queryKey:["community",r?.id,"membership",o?.id]}),a.invalidateQueries({queryKey:["community",s]})},e[41]=r?.id,e[42]=o?.id,e[43]=s,e[44]=a,e[45]=A):A=e[45];let j;e[46]!==t||e[47]!==r?(j=Q=>{r&&t(Q?`Joined ${r.name}`:`Left ${r.name}`)},e[46]=t,e[47]=r,e[48]=j):j=e[48];let B;e[49]!==E||e[50]!==T||e[51]!==K||e[52]!==A||e[53]!==j?(B={mutationFn:E,onMutate:T,onError:K,onSettled:A,onSuccess:j},e[49]=E,e[50]=T,e[51]=K,e[52]=A,e[53]=j,e[54]=B):B=e[54];const H=te(B);let z;e[55]!==t||e[56]!==o||e[57]!==H?(z=async()=>{if(!o)return t("Please login to join communities","error");H.mutate()},e[55]=t,e[56]=o,e[57]=H,e[58]=z):z=e[58];const V=z;let J;return e[59]!==t||e[60]!==r||e[61]!==g||e[62]!==o||e[63]!==c||e[64]!==V||e[65]!==$||e[66]!==x||e[67]!==w||e[68]!==H.isPending||e[69]!==f||e[70]!==O||e[71]!==i||e[72]!==M?(J={community:r,loading:f,isMember:w,userRole:M,isJoining:H.isPending,communityPosts:g,loadingPosts:O,isFetchingMorePosts:x,hasMorePosts:$,handleJoinToggle:V,loadCommunityPosts:c,currentUser:o,addToast:t,navigate:i},e[59]=t,e[60]=r,e[61]=g,e[62]=o,e[63]=c,e[64]=V,e[65]=$,e[66]=x,e[67]=w,e[68]=H.isPending,e[69]=f,e[70]=O,e[71]=i,e[72]=M,e[73]=J):J=e[73],J};function Ke(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function Ae(e){return e}const ct=()=>{const{currentUser:e}=Z(),s=W(),i=le(),o=new URLSearchParams(i.search),t=o.get("q")||"",a=o.get("tab")||(t?"posts":"communities"),[n,y]=(0,_.useState)(t),[l,C]=(0,_.useState)(a),[r,f]=(0,_.useState)(!1);(0,_.useEffect)(()=>{t!==n&&(y(t),t&&C("posts"))},[t]);const{data:h,fetchNextPage:b,hasNextPage:m,isFetchingNextPage:u,isLoading:F}=U({queryKey:["explore","communities"],queryFn:({pageParam:c})=>Se(c,10),initialPageParam:null,getNextPageParam:c=>{if(!(!c||c.length<10))return c[c.length-1].createdAt}}),v=(0,_.useMemo)(()=>h?.pages.flatMap(c=>c)||[],[h]),{data:N,fetchNextPage:w,hasNextPage:M,isFetchingNextPage:S,isLoading:d}=U({queryKey:["explore","posts",n],queryFn:({pageParam:c})=>n?pe(n,c,10,!0):Pe(c,10),initialPageParam:null,getNextPageParam:c=>{if(!(!c||c.length<10))return c[c.length-1].sort_timestamp||c[c.length-1].sortTimestamp}}),p=(0,_.useMemo)(()=>N?.pages.flatMap(c=>c)||[],[N]),P=(0,_.useMemo)(()=>{let c=v;return n&&(c=c.filter($=>$.name?.toLowerCase().includes(n.toLowerCase())||$.handle?.toLowerCase().includes(n.toLowerCase()))),c},[v,n]);return{currentUser:e,searchQuery:n,setSearchQuery:c=>{y(c)},activeTab:l,setActiveTab:C,isCreateModalOpen:r,setIsCreateModalOpen:f,communitiesData:v,isCommunitiesLoading:F,isFetchingMoreCommunities:u,hasMoreCommunities:m,postsData:p,isPostsLoading:d,isFetchingMorePosts:S,hasMorePosts:M,filteredCommunities:P,handleCommunityClick:c=>{s(`/c/${c}`)},loadCommunities:b,loadPosts:w,navigate:s}};var Oe=G();const ut=()=>{const e=(0,Oe.c)(21),{currentUser:s}=Z(),{posts:i,loading:o,hasMore:t,isFetchingNextPage:a,fetchNextPage:n}=Le(),{addToast:y}=ee(),l=W();let C;e[0]===Symbol.for("react.memo_cache_sentinel")?(C={queryKey:["stories"],queryFn:Ne},e[0]=C):C=e[0];const{data:r,isLoading:f}=I(C);let h;e[1]!==r?(h=r===void 0?[]:r,e[1]=r,e[2]=h):h=e[2];const b=h;let m;if(e[3]!==b){const d={};b.forEach(p=>{if(!p.user)return;const P=p.user.id;d[P]||(d[P]={user:p.user,stories:[]}),d[P].stories.push(p)}),m=Object.values(d),e[3]=b,e[4]=m}else m=e[4];const u=m,F=i;let v;e[5]!==l?(v=d=>{l(`/post/${d}`)},e[5]=l,e[6]=v):v=e[6];const N=v;let w;e[7]!==l?(w=d=>{l(`/u/${d}`)},e[7]=l,e[8]=w):w=e[8];const M=w;let S;return e[9]!==y||e[10]!==s||e[11]!==n||e[12]!==u||e[13]!==N||e[14]!==M||e[15]!==t||e[16]!==F||e[17]!==a||e[18]!==o||e[19]!==f?(S={currentUser:s,homePosts:F,groupedStories:u,isPostsLoading:o,isStoriesLoading:f,hasMore:t,isFetchingNextPage:a,fetchNextPage:n,addToast:y,handlePostClick:N,handleUserClick:M},e[9]=y,e[10]=s,e[11]=n,e[12]=u,e[13]=N,e[14]=M,e[15]=t,e[16]=F,e[17]=a,e[18]=o,e[19]=f,e[20]=S):S=e[20],S};var je=G();const dt=()=>{const e=(0,je.c)(57),{id:s}=ie(),i=W(),{currentUser:o}=Z(),{onlineUsers:t}=_e(),a=oe(),[n,y]=(0,_.useState)("");let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=[],e[0]=l):l=e[0];const[C,r]=(0,_.useState)(l),{conversations:f,isConvLoading:h,sendMessage:b,sendTypingStatus:m,typingStatus:u,markAsRead:F,formatMessages:v,onToggleReaction:N,conversationReactions:w,messages:M,isMsgLoading:S,fetchNextMessages:d,hasMoreMessages:p,isFetchingMoreMessages:P}=ke(o,s);let k;e:{if(!s||f.length===0){k=null;break e}let q;e[1]!==f||e[2]!==s?(q=f.find(D=>D.id===s)||null,e[1]=f,e[2]=s,e[3]=q):q=e[3],k=q}const L=k;let c,$;e[4]!==s||e[5]!==F?(c=()=>{s&&F(s)},$=[s,F],e[4]=s,e[5]=F,e[6]=c,e[7]=$):(c=e[6],$=e[7]),(0,_.useEffect)(c,$);let x;e[8]!==f||e[9]!==o?.id||e[10]!==n?(x=()=>{const q=setTimeout(async()=>{if(n.length>1){const D=await be(n),X=f.map(Be);r(D.filter(ne=>ne.id!==o?.id&&!X.includes(ne.id)))}else r([])},300);return()=>clearTimeout(q)},e[8]=f,e[9]=o?.id,e[10]=n,e[11]=x):x=e[11];const O=o?.id;let R;e[12]!==f||e[13]!==n||e[14]!==O?(R=[n,f,O],e[12]=f,e[13]=n,e[14]=O,e[15]=R):R=e[15],(0,_.useEffect)(x,R);let g;e[16]!==o||e[17]!==i||e[18]!==a?(g=async q=>{if(o)try{const D=await fe(o.id,q.id);a.invalidateQueries({queryKey:["conversations",o.id]}),y(""),i(`/messages/${D}`)}catch(D){console.error("Failed to start conversation:",D)}},e[16]=o,e[17]=i,e[18]=a,e[19]=g):g=e[19];const E=g;let T;e[20]!==i?(T=q=>{i(`/messages/${q.id}`)},e[20]=i,e[21]=T):T=e[21];const K=T;let A;e[22]!==w||e[23]!==v||e[24]!==M?(A=v(M,w),e[22]=w,e[23]=v,e[24]=M,e[25]=A):A=e[25];const j=A;let B;if(e[26]!==f||e[27]!==n){let q;e[29]!==n?(q=D=>D.user?.name?.toLowerCase().includes(n.toLowerCase())||D.user?.handle?.toLowerCase().includes(n.toLowerCase())||D.lastMessage?.toLowerCase().includes(n.toLowerCase()),e[29]=n,e[30]=q):q=e[30],B=f.filter(q),e[26]=f,e[27]=n,e[28]=B}else B=e[28];const H=B,z=L&&u[L.id];let V;e[31]!==t||e[32]!==L?(V=L&&L.user?.id&&t.has(L.user.id),e[31]=t,e[32]=L,e[33]=V):V=e[33];const J=V;let Q;return e[34]!==f||e[35]!==z||e[36]!==o||e[37]!==d||e[38]!==H||e[39]!==K||e[40]!==E||e[41]!==p||e[42]!==s||e[43]!==h||e[44]!==P||e[45]!==S||e[46]!==j||e[47]!==n||e[48]!==i||e[49]!==N||e[50]!==t||e[51]!==J||e[52]!==L||e[53]!==b||e[54]!==m||e[55]!==C?(Q={id:s,currentUser:o,onlineUsers:t,msgSearchQuery:n,setMsgSearchQuery:y,userSearchResults:C,conversations:f,filteredConversations:H,selectedConversation:L,localMessages:j,isConvLoading:h,isMsgLoading:S,currentIsTyping:z,otherUserIsOnline:J,handleStartConversation:E,handleSelectConversation:K,sendMessage:b,sendTypingStatus:m,onToggleReaction:N,navigate:i,fetchNextMessages:d,hasMoreMessages:p,isFetchingMoreMessages:P},e[34]=f,e[35]=z,e[36]=o,e[37]=d,e[38]=H,e[39]=K,e[40]=E,e[41]=p,e[42]=s,e[43]=h,e[44]=P,e[45]=S,e[46]=j,e[47]=n,e[48]=i,e[49]=N,e[50]=t,e[51]=J,e[52]=L,e[53]=b,e[54]=m,e[55]=C,e[56]=Q):Q=e[56],Q};function Be(e){return e.user?.id}var He=G();const ft=()=>{const e=(0,He.c)(47),{currentUser:s}=Z(),i=W(),o=oe(),t=s?.id;let a;e[0]!==t?(a=["notifications",t],e[0]=t,e[1]=a):a=e[1];let n;e[2]!==s?.id?(n=R=>{const{pageParam:g}=R;return Me(s?.id,g,10)},e[2]=s?.id,e[3]=n):n=e[3];const y=!!s?.id;let l;e[4]!==a||e[5]!==n||e[6]!==y?(l={queryKey:a,queryFn:n,enabled:y,initialPageParam:null,getNextPageParam:ze},e[4]=a,e[5]=n,e[6]=y,e[7]=l):l=e[7];const{data:C,fetchNextPage:r,hasNextPage:f,isFetchingNextPage:h,isLoading:b}=U(l);let m;e[8]!==C?.pages?(m=C?.pages.flatMap(Je)||[],e[8]=C?.pages,e[9]=m):m=e[9];const u=m;let F;e[10]!==s||e[11]!==o?(F=()=>{if(!s?.id)return;const R=se.channel(`user_notifications:${s.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${s.id}`},()=>{o.invalidateQueries({queryKey:["notifications",s.id]})}).subscribe();return()=>{se.removeChannel(R)}},e[10]=s,e[11]=o,e[12]=F):F=e[12];const v=s?.id;let N;e[13]!==o||e[14]!==v?(N=[v,o],e[13]=o,e[14]=v,e[15]=N):N=e[15],(0,_.useEffect)(F,N);let w;e[16]!==s?(w=()=>s?me(s.id):Promise.resolve(),e[16]=s,e[17]=w):w=e[17];let M,S,d;e[18]!==s?.id||e[19]!==o?(M=async()=>{await o.cancelQueries({queryKey:["notifications",s?.id]});const R=o.getQueryData(["notifications",s?.id]);return o.setQueryData(["notifications",s?.id],Ye),{previousNotifications:R}},S=(R,g,E)=>{E?.previousNotifications&&o.setQueryData(["notifications",s?.id],E.previousNotifications)},d=()=>{o.invalidateQueries({queryKey:["notifications",s?.id]})},e[18]=s?.id,e[19]=o,e[20]=M,e[21]=S,e[22]=d):(M=e[20],S=e[21],d=e[22]);let p;e[23]!==M||e[24]!==S||e[25]!==d||e[26]!==w?(p={mutationFn:w,onMutate:M,onError:S,onSettled:d},e[23]=M,e[24]=S,e[25]=d,e[26]=w,e[27]=p):p=e[27];const P=te(p);let k;e[28]!==i?(k=R=>{R.type==="follow"?i(`/u/${R.user}`):R.post_id&&i(`/post/${R.post_id}`)},e[28]=i,e[29]=k):k=e[29];const L=k;let c;e[30]!==s?.id||e[31]!==P||e[32]!==u?(c=()=>{s?.id&&u.some(Ge)&&P.mutate()},e[30]=s?.id,e[31]=P,e[32]=u,e[33]=c):c=e[33];const $=s?.id;let x;e[34]!==P||e[35]!==u.length||e[36]!==$?(x=[$,u.length,P],e[34]=P,e[35]=u.length,e[36]=$,e[37]=x):x=e[37],(0,_.useEffect)(c,x);let O;return e[38]!==s||e[39]!==r||e[40]!==L||e[41]!==f||e[42]!==h||e[43]!==b||e[44]!==i||e[45]!==u?(O={currentUser:s,notifications:u,isLoading:b,isFetchingMore:h,hasMore:f,loadNotifications:r,handleNotificationClick:L,navigate:i},e[38]=s,e[39]=r,e[40]=L,e[41]=f,e[42]=h,e[43]=b,e[44]=i,e[45]=u,e[46]=O):O=e[46],O};function ze(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Je(e){return e}function Ve(e){return{...e,is_read:!0}}function Xe(e){return e.map(Ve)}function Ye(e){return e&&{...e,pages:e.pages.map(Xe)}}function Ge(e){return!e.is_read}var We=G();const mt=()=>{const e=(0,We.c)(20),{id:s}=ie(),i=W(),{currentUser:o}=Z(),{addToast:t}=ee();let a,n;e[0]!==s?(a=["post",s],n=async()=>{if(!s||!Y(s))throw new Error("Invalid post ID");return ve(s)},e[0]=s,e[1]=a,e[2]=n):(a=e[1],n=e[2]);const y=!!s;let l;e[3]!==a||e[4]!==n||e[5]!==y?(l={queryKey:a,queryFn:n,enabled:y,retry:!1},e[3]=a,e[4]=n,e[5]=y,e[6]=l):l=e[6];const{data:C,isLoading:r,isError:f}=I(l);let h;e[7]!==i?(h=v=>{i(`/u/${v}`)},e[7]=i,e[8]=h):h=e[8];const b=h;let m;e[9]!==i?(m=()=>{i(-1)},e[9]=i,e[10]=m):m=e[10];const u=m;let F;return e[11]!==t||e[12]!==o||e[13]!==u||e[14]!==b||e[15]!==f||e[16]!==r||e[17]!==i||e[18]!==C?(F={post:C,isLoading:r,isError:f,currentUser:o,addToast:t,navigate:i,handleUserClick:b,handleDelete:u},e[11]=t,e[12]=o,e[13]=u,e[14]=b,e[15]=f,e[16]=r,e[17]=i,e[18]=C,e[19]=F):F=e[19],F};var Ze=G();const gt=()=>{const e=(0,Ze.c)(31),s=W(),i=(0,_.useRef)(null),[o,t]=(0,_.useState)(null),[a,n]=(0,_.useState)(!0);let y;e[0]===Symbol.for("react.memo_cache_sentinel")?(y=["reels"],e[0]=y):y=e[0];let l;e[1]===Symbol.for("react.memo_cache_sentinel")?(l={queryKey:y,queryFn:Ie,initialPageParam:null,getNextPageParam:Ue},e[1]=l):l=e[1];const{data:C,fetchNextPage:r,hasNextPage:f,isFetchingNextPage:h,isLoading:b}=U(l);let m;e[2]!==C?.pages?(m=C?.pages.flatMap(et)||[],e[2]=C?.pages,e[3]=m):m=e[3];const u=m;let F;e[4]!==o||e[5]!==u[0]||e[6]!==u.length?(F=()=>{u.length>0&&!o&&t(u[0].id)},e[4]=o,e[5]=u[0],e[6]=u.length,e[7]=F):F=e[7];let v;e[8]!==o||e[9]!==u?(v=[u,o],e[8]=o,e[9]=u,e[10]=v):v=e[10],(0,_.useEffect)(F,v);let N,w;e[11]!==u.length?(N=()=>{if(u.length===0)return;const k={root:i.current,threshold:.6},L=$=>{$.forEach(x=>{x.isIntersecting&&t(x.target.dataset.id)})},c=new IntersectionObserver(L,k);return setTimeout(()=>{document.querySelectorAll(".reel-item").forEach($=>c.observe($))},100),()=>c.disconnect()},w=[u.length],e[11]=u.length,e[12]=N,e[13]=w):(N=e[12],w=e[13]),(0,_.useEffect)(N,w);let M;e[14]!==a?(M=()=>{n(!a)},e[14]=a,e[15]=M):M=e[15];const S=M;let d,p;e[16]!==r||e[17]!==f||e[18]!==h?(d=()=>{const k=()=>{if(!i.current||h||!f)return;const{scrollTop:c,scrollHeight:$,clientHeight:x}=i.current;c+x>=$-800&&r()},L=i.current;if(L)return L.addEventListener("scroll",k),()=>L.removeEventListener("scroll",k)},p=[h,f,r],e[16]=r,e[17]=f,e[18]=h,e[19]=d,e[20]=p):(d=e[19],p=e[20]),(0,_.useEffect)(d,p);let P;return e[21]!==o||e[22]!==r||e[23]!==f||e[24]!==h||e[25]!==b||e[26]!==a||e[27]!==s||e[28]!==u||e[29]!==S?(P={reels:u,loading:b,loadingMore:h,activeReelId:o,hasMore:f,isMuted:a,containerRef:i,navigate:s,toggleMute:S,loadReels:r},e[21]=o,e[22]=r,e[23]=f,e[24]=h,e[25]=b,e[26]=a,e[27]=s,e[28]=u,e[29]=S,e[30]=P):P=e[30],P};function Ie(e){const{pageParam:s}=e;return ye(s,10)}function Ue(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function et(e){return e}const ht=()=>{const{currentUser:e,logout:s}=Z(),{darkMode:i,toggleDarkMode:o,fontSize:t,setFontSize:a,dataSaver:n,setDataSaver:y}=De(),{addToast:l}=ee(),[C,r]=(0,_.useState)(!1),[f,h]=(0,_.useState)({newPassword:"",confirmPassword:""}),[b,m]=(0,_.useState)(!1),u=async()=>{try{await s(),l("Logged out successfully")}catch(d){console.error("Logout error:",d),l("Failed to logout")}};return{currentUser:e,darkMode:i,toggleDarkMode:o,fontSize:t,setFontSize:a,dataSaver:n,setDataSaver:y,isChangingPassword:C,setIsChangingPassword:r,passwordData:f,setPasswordData:h,loading:b,handleLogout:u,handlePasswordChange:async d=>{if(d.preventDefault(),f.newPassword!==f.confirmPassword){l("Passwords do not match","error");return}if(f.newPassword.length<6){l("Password must be at least 6 characters","error");return}m(!0);try{const{error:p}=await se.auth.updateUser({password:f.newPassword});if(p)throw p;l("Password updated successfully!"),r(!1),h({newPassword:"",confirmPassword:""})}catch(p){console.error("Password update error:",p),l(p.message||"Failed to update password","error")}finally{m(!1)}},handlePasswordReset:async()=>{if(e?.email){m(!0);try{const{error:d}=await se.auth.resetPasswordForEmail(e.email,{redirectTo:`${window.location.origin}/settings?type=recovery`});if(d)throw d;l("Password reset email sent!")}catch(d){console.error("Reset password error:",d),l(d.message||"Failed to send reset email","error")}finally{m(!1)}}},handleClearCache:()=>{["seenStories","font-size","data-saver","theme"].forEach(d=>localStorage.removeItem(d)),l("Cache cleared! Reloading..."),setTimeout(()=>window.location.reload(),1500)},handleDownloadData:async()=>{if(e){m(!0);try{const d={user:{id:e.id,handle:e.handle,name:e.name,email:e.email},exportDate:new Date().toISOString(),note:"This is a mock export of your Sysm data."},p=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),P=URL.createObjectURL(p),k=document.createElement("a");k.href=P,k.download=`sysm-data-${e.handle}.json`,k.click(),URL.revokeObjectURL(P),l("Data export started!")}catch{l("Failed to export data","error")}finally{m(!1)}}},handleDeleteAccount:()=>{window.confirm("Are you absolutely sure? This will permanently delete your account and all associated data. This action is irreversible.")&&(l("Account deletion request submitted. Logging out..."),setTimeout(u,2e3))},handleReportBug:()=>{window.prompt("Please describe the bug you found:")&&l("Bug reported! Thank you for your feedback.")}}};export{dt as a,lt as c,at as d,ft as i,rt as l,gt as n,ut as o,mt as r,ct as s,ht as t,nt as u};
