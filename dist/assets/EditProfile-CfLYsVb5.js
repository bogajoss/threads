import{a as F}from"./rolldown-runtime-BaZ8gS7u.js";import{c as E,s as L}from"./animations-B6v95IQS.js";import{_ as T}from"./framework-Cd2gv6QJ.js";import"./database-Bh-Nv8Zy.js";import{Ft as B,In as O,Vn as M,ar as $,lr as P,tn as q,xn as G}from"./ui-libs-DKp_gqVx.js";import"./media-libs-CXISCoRC.js";import{$t as J,An as S,Qt as K,Zt as Q,a as V,an as Y,sn as Z,tn as _,vt as j}from"./index-CaLMzKQK.js";import{t as H}from"./useAutoResizeTextArea-BnCKoK71.js";import{t as X}from"./CircularProgress-BrhIZriJ.js";var n=F(E(),1),e=F(L(),1),ee=()=>{const f=T(),{currentUser:a,updateProfile:I}=Z(),{addToast:u}=Y(),r=a?.id?`edit-profile-draft:${a.id}`:null,[U,N]=(0,n.useState)(!1),[s,c]=(0,n.useState)(a||{}),[m,z]=(0,n.useState)(null),[d,w]=(0,n.useState)(null),y=(0,n.useRef)(null),k=(0,n.useRef)(null),p=(0,n.useRef)(!1),h=(0,n.useRef)(!1),D=H(s?.bio||"",80,300),x=t=>{h.current=!0,c(t)};(0,n.useEffect)(()=>{if(!(!a||p.current)){if(r){const t=sessionStorage.getItem(r);if(t)try{const i=JSON.parse(t);c({...a,...i}),h.current=!0}catch(i){console.error("Failed to restore edit profile draft",i),sessionStorage.removeItem(r),c(a)}else c(a)}else c(a);p.current=!0}},[a,r]),(0,n.useEffect)(()=>{if(!r||!p.current)return;const t={name:s?.name||"",bio:s?.bio||"",location:s?.location||"",website:s?.website||""};if(!t.name?.trim()&&!t.bio?.trim()&&!t.location?.trim()&&!t.website?.trim()){sessionStorage.removeItem(r);return}sessionStorage.setItem(r,JSON.stringify(t))},[r,s?.bio,s?.location,s?.name,s?.website]);const C=(t,i)=>{const l=t.target.files?.[0];if(l){if(l.type==="image/gif"&&!a?.isPro){u("GIF profile pictures are only available for PRO users!","error");return}i==="avatar"?z(l):w(l)}},W=async()=>{N(!0);try{let t=s.avatar,i=s.cover;m&&(t=(await S(m)).url),d&&(i=(await S(d)).url);const g=(v=>{if(!v)return v;const o=v.trim();if(!o)return o;try{const b=new URL(/^https?:\/\//i.test(o)?o:`https://${o}`);return b.hostname.replace(/^www\./i,"")+(b.pathname==="/"?"":b.pathname)}catch{return o.replace(/^https?:\/\//i,"").replace(/^www\./i,"")}})(s?.website);await I({...s,avatar:t,cover:i,website:g}),r&&sessionStorage.removeItem(r),h.current=!1,z(null),w(null),u("Profile updated!"),f(-1)}catch(t){console.error("Failed to update profile:",t),u("Failed to update profile.","error")}finally{N(!1)}},R=(t=>(t||"").trim().split(/\s+/).filter(Boolean).length)(s?.bio),A=R>=50;return a?(0,e.jsx)(V,{children:(0,e.jsxs)("div",{className:"flex min-h-screen flex-col border-zinc-100 bg-white dark:border-zinc-800 dark:bg-black md:rounded-xl md:border",children:[(0,e.jsx)("div",{className:"sticky top-0 z-10 border-b border-zinc-100 bg-white/80 p-4 backdrop-blur-md dark:border-zinc-800 dark:bg-black/80",children:(0,e.jsxs)("div",{className:"flex items-center gap-4",children:[(0,e.jsx)("button",{onClick:()=>f(-1),className:"rounded-full p-2 transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,e.jsx)($,{size:24})}),(0,e.jsx)("h2",{className:"text-xl font-bold dark:text-white",children:"Edit Profile"})]})}),(0,e.jsxs)("div",{className:"mx-auto mt-4 w-full max-w-2xl space-y-8 p-4 pb-24",children:[(0,e.jsx)("input",{type:"file",ref:k,className:"hidden",accept:"image/*",onChange:t=>C(t,"cover")}),(0,e.jsx)("input",{type:"file",ref:y,className:"hidden",accept:"image/*",onChange:t=>C(t,"avatar")}),(0,e.jsxs)("section",{className:"space-y-4",children:[(0,e.jsx)("h3",{className:"px-2 text-sm font-bold uppercase tracking-wider text-zinc-500",children:"Media"}),(0,e.jsxs)("div",{className:"overflow-hidden rounded-2xl bg-zinc-50 dark:bg-zinc-900",children:[(0,e.jsxs)("div",{className:"group relative h-40 cursor-pointer overflow-hidden bg-zinc-100 dark:bg-zinc-800",onClick:()=>k.current?.click(),children:[(d||s?.cover)&&(0,e.jsx)("img",{src:d?URL.createObjectURL(d):s.cover,className:"h-full w-full object-cover opacity-80 transition-opacity group-hover:opacity-60",alt:""}),(0,e.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 opacity-0 transition-opacity group-hover:opacity-100",children:(0,e.jsxs)("div",{className:"flex flex-col items-center gap-1 text-white",children:[(0,e.jsx)(P,{size:24}),(0,e.jsx)("span",{className:"text-xs font-bold uppercase",children:"Change Cover"})]})})]}),(0,e.jsxs)("div",{className:"flex items-center gap-6 p-4",children:[(0,e.jsxs)("div",{className:"group relative size-24 cursor-pointer overflow-hidden rounded-full ring-4 ring-white shadow-lg dark:ring-zinc-800",onClick:()=>y.current?.click(),children:[(0,e.jsxs)(Q,{className:"size-full rounded-none",children:[(0,e.jsx)(J,{src:m?URL.createObjectURL(m):s.avatar,className:"object-cover transition-opacity group-hover:opacity-60"}),(0,e.jsx)(K,{children:s?.handle?.[0]?.toUpperCase()})]}),(0,e.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 opacity-0 transition-opacity group-hover:opacity-100",children:(0,e.jsx)(P,{size:20,className:"text-white"})})]}),(0,e.jsxs)("div",{className:"flex-1",children:[(0,e.jsx)("p",{className:"text-sm font-bold dark:text-zinc-200",children:"Profile Picture"}),(0,e.jsx)("p",{className:"text-xs text-zinc-500",children:"Recommended size: 400x400px"})]})]})]})]}),(0,e.jsxs)("section",{className:"space-y-4",children:[(0,e.jsx)("h3",{className:"px-2 text-sm font-bold uppercase tracking-wider text-zinc-500",children:"Basic Info"}),(0,e.jsxs)("div",{className:"divide-y divide-zinc-200 overflow-hidden rounded-2xl bg-zinc-50 dark:divide-zinc-800 dark:bg-zinc-900",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-2 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-zinc-500",children:[(0,e.jsx)(B,{size:16}),(0,e.jsx)("label",{className:"text-xs font-bold uppercase tracking-tight",children:"Display Name"})]}),(0,e.jsx)(j,{value:s?.name||"",className:"h-auto bg-transparent p-0 text-base font-medium placeholder:text-zinc-400 focus-visible:ring-0 dark:text-zinc-100 shadow-none",onChange:t=>x({...s,name:t.target.value})})]}),(0,e.jsxs)("div",{className:"flex flex-col gap-2 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-zinc-500",children:[(0,e.jsx)(M,{size:16}),(0,e.jsx)("label",{className:"text-xs font-bold uppercase tracking-tight",children:"Bio"})]}),(0,e.jsx)(X,{current:R,max:60,size:20,strokeWidth:3,isWarning:A})]}),(0,e.jsx)("textarea",{ref:D,value:s?.bio||"",className:"min-h-[80px] max-h-[400px] w-full bg-transparent p-0 text-base font-medium resize-none placeholder:text-zinc-400 focus-visible:ring-0 dark:text-zinc-100 shadow-none outline-none",placeholder:"Tell others about yourself...",onChange:t=>{const i=t.target.value,l=i.trim().split(/\s+/).filter(Boolean);if(l.length>60){const g=l.slice(0,60).join(" ");x({...s,bio:g})}else x({...s,bio:i})}})]})]})]}),(0,e.jsxs)("section",{className:"space-y-4",children:[(0,e.jsx)("h3",{className:"px-2 text-sm font-bold uppercase tracking-wider text-zinc-500",children:"Public Details"}),(0,e.jsxs)("div",{className:"divide-y divide-zinc-200 overflow-hidden rounded-2xl bg-zinc-50 dark:divide-zinc-800 dark:bg-zinc-900",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-2 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-zinc-500",children:[(0,e.jsx)(G,{size:16}),(0,e.jsx)("label",{className:"text-xs font-bold uppercase tracking-tight",children:"Location"})]}),(0,e.jsx)(j,{placeholder:"Where are you based?",value:s?.location||"",className:"h-auto bg-transparent p-0 text-base font-medium placeholder:text-zinc-400 focus-visible:ring-0 dark:text-zinc-100 shadow-none",onChange:t=>x({...s,location:t.target.value})})]}),(0,e.jsxs)("div",{className:"flex flex-col gap-2 p-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-zinc-500",children:[(0,e.jsx)(O,{size:16}),(0,e.jsx)("label",{className:"text-xs font-bold uppercase tracking-tight",children:"Website"})]}),(0,e.jsx)(j,{placeholder:"yoursite.com",value:s?.website||"",className:"h-auto bg-transparent p-0 text-base font-medium placeholder:text-zinc-400 focus-visible:ring-0 dark:text-zinc-100 shadow-none",onChange:t=>x({...s,website:t.target.value})})]})]})]}),(0,e.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,e.jsx)(_,{variant:"secondary",className:"flex-1 rounded-2xl p-4 font-bold",onClick:()=>f(-1),children:"Cancel"}),(0,e.jsxs)(_,{className:"flex-1 rounded-2xl p-4 font-bold bg-violet-600 hover:bg-violet-700 text-white",onClick:W,loading:U,children:[(0,e.jsx)(q,{size:18,className:"mr-2"}),"Save Changes"]})]}),(0,e.jsx)("div",{className:"py-10 text-center text-xs text-zinc-400",children:"Your profile changes will be visible to everyone on MySys."})]})]})}):(f("/login"),null)},xe=ee;export{xe as default};
