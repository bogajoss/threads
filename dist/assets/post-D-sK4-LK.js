const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/VideoPlayer-DtVYkwZU.js","assets/framework-CsA6nn9m.js","assets/rolldown-runtime-BaZ8gS7u.js","assets/framework-sg0yWRLc.css","assets/media-libs-Btb8RX-I.js","assets/media-libs-CqCaMccn.css","assets/VideoPlayer-B-KX6L3f.js","assets/index-L0lsGwBq.js","assets/ui-libs-Px4MBmNX.js","assets/database-BiY55TQY.js","assets/query-QyXblnmD.js","assets/animations-T0TOZv2c.js","assets/index-Cy3CcCbp.css","assets/dist-CYPYLHr8.js"])))=>i.map(i=>d[i]);
import{a as ct}from"./rolldown-runtime-BaZ8gS7u.js";import{C as dt,E as Ct,b as ie,c as O,d as $t,n as _t,p as St}from"./framework-CsA6nn9m.js";import{r as Ft}from"./query-QyXblnmD.js";import{$t as je,Cn as Pt,Dn as Ue,Fn as Tt,Gn as Mt,It as Rt,Jt as It,Ln as Et,Lt as At,Mn as Dt,Nn as Lt,On as Ut,Pn as ze,Tn as xe,Xt as Ot,cn as Wt,dn as Bt,en as Vt,hn as qt,in as Ht,jn as Gt,kn as Oe,kt as se,nn as Jt,on as Xt,pn as mt,tn as Kt,vn as G,yn as Qt,zn as Zt,zt as Yt}from"./ui-libs-Px4MBmNX.js";import{$t as We,Bt as es,Ft as Be,Gt as ts,H as xt,Ht as ss,J as Ve,K as is,Kt as as,Rt as ls,St as ns,Ut as rs,X as os,Y as te,Z as cs,Zt as ds,_ as ke,_t as ms,at as X,cn as Ne,ct as qe,dt as He,f as xs,fn as Ge,ft as Je,gt as hs,ht as fs,it as K,l as ht,ln as V,lt as Xe,nn as us,ot as Ke,p as ps,pt as Qe,q as gs,rt as Q,sn as vs,st as Ze,tn as bs,u as js,un as me,ut as Ye,v as zs,vt as ye,x as ks,xt as ft}from"./index-L0lsGwBq.js";import{t as Ce}from"./text-processing-DFvQvkgt.js";import{t as $e}from"./linkify-BIniK2-v.js";import{p as Ns,u as et}from"./hooks-DJjmLuDD.js";var ws=O(),N=ct(Ct(),1),t=ct($t(),1),ys=i=>{const e=(0,ws.c)(37),{isComment:s,liked:n,reposted:a,handleLike:r,handleRepost:o,handleCommentClick:c,handleShareClick:d,isDetail:j}=i;if(j!==void 0&&j){let $;e[0]!==r||e[1]!==n?($=(0,t.jsx)(q,{icon:xe,label:"Like",type:"like",onClick:r,active:n}),e[0]=r,e[1]=n,e[2]=$):$=e[2];let v;e[3]!==o||e[4]!==s||e[5]!==a?(v=!s&&(0,t.jsx)(q,{icon:je,label:"Repost",type:"repost",onClick:o,active:a}),e[3]=o,e[4]=s,e[5]=a,e[6]=v):v=e[6];let z;e[7]!==c?(z=(0,t.jsx)(q,{icon:ht,label:"Comment",type:"comment",onClick:c}),e[7]=c,e[8]=z):z=e[8];let l;e[9]!==d||e[10]!==s?(l=!s&&(0,t.jsx)(q,{icon:ke,label:"Share",type:"share",onClick:d}),e[9]=d,e[10]=s,e[11]=l):l=e[11];let w;return e[12]!==$||e[13]!==v||e[14]!==z||e[15]!==l?(w=(0,t.jsxs)("div",{className:"mt-4 flex w-full items-center justify-around py-1",children:[$,v,z,l]}),e[12]=$,e[13]=v,e[14]=z,e[15]=l,e[16]=w):w=e[16],w}const b=`flex items-center gap-x-1 ${s?"mt-1.5":"mt-3"}`,u=s?16:18;let h;e[17]!==r||e[18]!==n||e[19]!==u?(h=(0,t.jsx)(q,{icon:xe,size:u,type:"like",onClick:r,active:n}),e[17]=r,e[18]=n,e[19]=u,e[20]=h):h=e[20];const p=s?16:18;let f;e[21]!==c||e[22]!==p?(f=(0,t.jsx)(q,{icon:mt,size:p,type:"comment",onClick:c}),e[21]=c,e[22]=p,e[23]=f):f=e[23];const m=s?16:18;let g;e[24]!==o||e[25]!==a||e[26]!==m?(g=(0,t.jsx)(q,{icon:je,size:m,type:"repost",onClick:o,active:a}),e[24]=o,e[25]=a,e[26]=m,e[27]=g):g=e[27];let x;e[28]!==d||e[29]!==s?(x=!s&&d&&(0,t.jsx)(q,{icon:ke,type:"share",onClick:d}),e[28]=d,e[29]=s,e[30]=x):x=e[30];let C;return e[31]!==b||e[32]!==h||e[33]!==f||e[34]!==g||e[35]!==x?(C=(0,t.jsxs)("div",{className:b,children:[h,f,g,x]}),e[31]=b,e[32]=h,e[33]=f,e[34]=g,e[35]=x,e[36]=C):C=e[36],C},tt=ys,Cs=O(),$s=i=>{const e=(0,Cs.c)(52),{views:s,likes:n,comments:a,commenterAvatars:r,isDetail:o,isComment:c,onRepliesClick:d}=i;let j,b,u,h;if(e[0]!==a||e[1]!==n||e[2]!==r||e[3]!==o||e[4]!==c||e[5]!==s){h=Symbol.for("react.early_return_sentinel");e:{const v=r===void 0?[]:r,z=o===void 0?!1:o;if(j=c===void 0?!1:c,z){const l=s||0;let w;e[10]!==l?(w=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:l}),e[10]=l,e[11]=w):w=e[11];let S;e[12]===Symbol.for("react.memo_cache_sentinel")?(S=(0,t.jsx)("span",{className:"opacity-70",children:"Views"}),e[12]=S):S=e[12];let I;e[13]!==w?(I=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[w," ",S]}),e[13]=w,e[14]=I):I=e[14];const M=n||0;let k;e[15]!==M?(k=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:M}),e[15]=M,e[16]=k):k=e[16];let R;e[17]===Symbol.for("react.memo_cache_sentinel")?(R=(0,t.jsx)("span",{className:"opacity-70",children:"Likes"}),e[17]=R):R=e[17];let P;e[18]!==k?(P=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[k," ",R]}),e[18]=k,e[19]=P):P=e[19];const A=a||0;let E;e[20]!==A?(E=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:A}),e[20]=A,e[21]=E):E=e[21];let _;e[22]===Symbol.for("react.memo_cache_sentinel")?(_=(0,t.jsx)("span",{className:"opacity-70",children:"Comments"}),e[22]=_):_=e[22];let y;e[23]!==E?(y=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[E," ",_]}),e[23]=E,e[24]=y):y=e[24];let T;e[25]!==I||e[26]!==P||e[27]!==y?(T=(0,t.jsxs)("div",{className:"mt-4 flex items-center gap-x-6 border-b border-zinc-100 pb-4 text-sm text-zinc-500 dark:border-zinc-800 dark:text-zinc-400",children:[I,P,y]}),e[25]=I,e[26]=P,e[27]=y,e[28]=T):T=e[28],h=T;break e}if(a===0&&n===0&&(s===0||j)){h=null;break e}b="mt-1 flex items-center gap-x-2",u=a>0&&v.length>0&&!j&&(0,t.jsx)("div",{className:"flex items-center -space-x-2 mr-1",children:v.slice(0,3).map(_s)})}e[0]=a,e[1]=n,e[2]=r,e[3]=o,e[4]=c,e[5]=s,e[6]=j,e[7]=b,e[8]=u,e[9]=h}else j=e[6],b=e[7],u=e[8],h=e[9];if(h!==Symbol.for("react.early_return_sentinel"))return h;const p=`flex items-center gap-x-1.5 px-0.5 ${j?"text-[12px]":"text-[14px]"} font-medium text-zinc-500 dark:text-zinc-400`;let f;e[29]!==a||e[30]!==j||e[31]!==n||e[32]!==s?(f=s>0&&!j&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{className:"hover:underline",children:[s," ",s===1?"view":"views"]}),(a>0||n>0)&&(0,t.jsx)("span",{className:"opacity-50",children:"·"})]}),e[29]=a,e[30]=j,e[31]=n,e[32]=s,e[33]=f):f=e[33];let m;e[34]!==a||e[35]!==d?(m=a>0&&(0,t.jsxs)("button",{className:"hover:underline",onClick:v=>{v.stopPropagation(),d&&d(v)},children:[a," ",a===1?"reply":"replies"]}),e[34]=a,e[35]=d,e[36]=m):m=e[36];let g;e[37]!==a||e[38]!==n?(g=a>0&&n>0&&(0,t.jsx)("span",{className:"opacity-50",children:"·"}),e[37]=a,e[38]=n,e[39]=g):g=e[39];let x;e[40]!==n?(x=n>0&&(0,t.jsxs)("button",{className:"hover:underline",children:[n," ",n===1?"like":"likes"]}),e[40]=n,e[41]=x):x=e[41];let C;e[42]!==g||e[43]!==x||e[44]!==p||e[45]!==f||e[46]!==m?(C=(0,t.jsxs)("div",{className:p,children:[f,m,g,x]}),e[42]=g,e[43]=x,e[44]=p,e[45]=f,e[46]=m,e[47]=C):C=e[47];let $;return e[48]!==C||e[49]!==b||e[50]!==u?($=(0,t.jsxs)("div",{className:b,children:[u,C]}),e[48]=C,e[49]=b,e[50]=u,e[51]=$):$=e[51],$},st=$s;function _s(i,e){return(0,t.jsx)("div",{className:"relative h-5 w-5 rounded-full border-2 border-white bg-zinc-100 dark:border-black dark:bg-zinc-800 overflow-hidden shadow-sm",style:{zIndex:3-e},children:(0,t.jsx)("img",{src:i,alt:"",className:"h-full w-full object-cover"})},e)}var Ss=O(),Fs=i=>{const e=(0,Ss.c)(43),{user:s,timeAgo:n,community:a,onUserClick:r,actionsMenu:o,isComment:c,isDetail:d,showAvatar:j}=i,b=j===void 0?!1:j,u=ie();let h;e[0]!==r||e[1]!==s.handle?(h=P=>{P.stopPropagation(),r&&r(s.handle)},e[0]=r,e[1]=s.handle,e[2]=h):h=e[2];const p=h;let f;e[3]!==a||e[4]!==u?(f=P=>{P.stopPropagation(),a&&u(`/c/${a.handle}`)},e[3]=a,e[4]=u,e[5]=f):f=e[5];const m=f,g=`flex items-center justify-between ${d?"pb-4":"min-h-[40px] mb-1"}`;let x;e[6]!==p||e[7]!==c||e[8]!==d||e[9]!==b||e[10]!==s.avatar||e[11]!==s.handle?(x=b&&(0,t.jsx)("button",{className:"shrink-0",onClick:p,children:(0,t.jsxs)(Q,{className:`${d?"size-12":c?"size-8":"size-10"} border-0 shadow-sm`,children:[(0,t.jsx)(X,{src:s.avatar,alt:s.handle,className:"object-cover"}),(0,t.jsx)(K,{className:"text-xs",children:s.handle[0]?.toUpperCase()})]})}),e[6]=p,e[7]=c,e[8]=d,e[9]=b,e[10]=s.avatar,e[11]=s.handle,e[12]=x):x=e[12];const C=`flex shrink-0 items-center gap-1 font-bold text-zinc-900 hover:underline dark:text-white ${d?"text-base sm:text-lg":c?"text-[14px]":"text-[15px]"}`;let $;e[13]!==s.handle?($=(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:s.handle}),e[13]=s.handle,e[14]=$):$=e[14];let v;e[15]!==c||e[16]!==d||e[17]!==s.verified?(v=s.verified&&(0,t.jsx)(zs,{size:d?16:c?12:14,className:"text-blue-500"}),e[15]=c,e[16]=d,e[17]=s.verified,e[18]=v):v=e[18];let z;e[19]!==p||e[20]!==C||e[21]!==$||e[22]!==v?(z=(0,t.jsxs)("button",{className:C,onClick:p,children:[$,v]}),e[19]=p,e[20]=C,e[21]=$,e[22]=v,e[23]=z):z=e[23];let l;e[24]!==a||e[25]!==m||e[26]!==d?(l=a&&(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-1 text-zinc-500",children:[(0,t.jsx)(js,{size:d?14:12,className:"shrink-0 text-zinc-400"}),(0,t.jsxs)("button",{className:`flex items-center gap-1 font-bold text-zinc-900 hover:underline dark:text-zinc-100 ${d?"text-[14px] sm:text-[15px]":"text-[13px]"}`,onClick:m,children:[(0,t.jsxs)(Q,{className:"size-3.5 shrink-0 border border-zinc-200 bg-zinc-100 dark:border-zinc-700 dark:bg-zinc-800",children:[(0,t.jsx)(X,{src:a.avatar,alt:a.name,className:"object-cover"}),(0,t.jsx)(K,{className:"text-[6px] font-bold text-zinc-500",children:a.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:a.name})]})]}),e[24]=a,e[25]=m,e[26]=d,e[27]=l):l=e[27];let w;e[28]!==l||e[29]!==z?(w=(0,t.jsx)("div",{className:"flex min-w-0 flex-1 flex-col",children:(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex min-w-0 max-w-full items-center gap-1.5",children:[z,l]})})}),e[28]=l,e[29]=z,e[30]=w):w=e[30];let S;e[31]!==w||e[32]!==x?(S=(0,t.jsxs)("div",{className:"flex items-center gap-x-3 flex-1 min-w-0",children:[x,w]}),e[31]=w,e[32]=x,e[33]=S):S=e[33];const I=n||"Recent";let M;e[34]!==I?(M=(0,t.jsx)("span",{className:"whitespace-nowrap text-[12px] text-zinc-500 dark:text-zinc-400",children:I}),e[34]=I,e[35]=M):M=e[35];let k;e[36]!==o||e[37]!==M?(k=(0,t.jsxs)("div",{className:"-mt-1 flex items-center gap-2",children:[M,o]}),e[36]=o,e[37]=M,e[38]=k):k=e[38];let R;return e[39]!==S||e[40]!==k||e[41]!==g?(R=(0,t.jsxs)("div",{className:g,children:[S,k]}),e[39]=S,e[40]=k,e[41]=g,e[42]=R):R=e[42],R},it=Fs,Ps=O(),Ts=i=>{const e=(0,Ps.c)(45),{content:s,isDetail:n,isEditing:a,editedContent:r,setEditedContent:o,onCancelEdit:c,onSaveEdit:d,isUpdating:j,contentClass:b}=i,u=ie(),[h,p]=(0,N.useState)(!1),f=typeof s=="string"&&Ge(s);if(a&&o){let k;e[0]!==o?(k=U=>o(U.target.value),e[0]=o,e[1]=k):k=e[1];const R=`min-h-[100px] w-full rounded-xl border-zinc-200 bg-zinc-50 focus:ring-violet-500 dark:border-zinc-800 dark:bg-zinc-900 ${Ge(r||"")?"font-bangla text-lg":"font-english"}`;let P;e[2]!==r||e[3]!==k||e[4]!==R?(P=(0,t.jsx)(ks,{value:r,onChange:k,className:R,autoFocus:!0}),e[2]=r,e[3]=k,e[4]=R,e[5]=P):P=e[5];let A;e[6]!==c?(A=(0,t.jsx)("button",{onClick:c,className:"px-4 py-1.5 text-sm font-bold text-zinc-500 transition-colors hover:text-zinc-700 dark:hover:text-zinc-300",children:"Cancel"}),e[6]=c,e[7]=A):A=e[7];let E;e[8]!==s||e[9]!==r||e[10]!==j?(E=j||!r?.trim()||r===s,e[8]=s,e[9]=r,e[10]=j,e[11]=E):E=e[11];const _=j?"Saving...":"Save";let y;e[12]!==d||e[13]!==E||e[14]!==_?(y=(0,t.jsx)("button",{onClick:d,disabled:E,className:"rounded-full bg-violet-600 px-4 py-1.5 text-sm font-bold text-white transition-all hover:bg-violet-700 disabled:opacity-50 active:scale-95",children:_}),e[12]=d,e[13]=E,e[14]=_,e[15]=y):y=e[15];let T;e[16]!==A||e[17]!==y?(T=(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[A,y]}),e[16]=A,e[17]=y,e[18]=T):T=e[18];let D;return e[19]!==P||e[20]!==T?(D=(0,t.jsxs)("div",{className:"mt-2 flex flex-col gap-2",onClick:Ms,children:[P,T]}),e[19]=P,e[20]=T,e[21]=D):D=e[21],D}const m=!n&&s.length>280;let g;e[22]!==s||e[23]!==h||e[24]!==m?(g=m&&!h?s.substring(0,280):s,e[22]=s,e[23]=h,e[24]=m,e[25]=g):g=e[25];const x=g,C=n?"text-lg leading-relaxed sm:text-xl sm:leading-8":"text-[15px] leading-relaxed",$=f?"font-bangla text-[1.15em]":"font-english";let v;e[26]!==b||e[27]!==C||e[28]!==$?(v=V("whitespace-pre-line break-words",C,$,b),e[26]=b,e[27]=C,e[28]=$,e[29]=v):v=e[29];let z;e[30]!==u?(z={...$e,render:k=>{const{attributes:R,content:P}=k,{href:A,...E}=R,_=window.location.origin;if(A.includes("internal.tag/")){const T=decodeURIComponent(A.split("internal.tag/")[1]);return(0,t.jsxs)("span",{...E,className:V("cursor-pointer font-bold text-rose-600 hover:underline dark:text-rose-400 font-bangla",E.className),onClick:D=>{D.stopPropagation(),u(`/tags/${T}`)},children:["#",T]},P)}let y=null;return A.startsWith("/")?y=A:A.startsWith(_)&&(y=A.replace(_,"")),y?(0,t.jsx)("span",{...E,className:V("cursor-pointer font-medium text-violet-600 hover:underline dark:text-violet-400",E.className),onClick:T=>{T.stopPropagation(),u(y)},children:P},P):(0,t.jsx)("a",{href:A,...E,target:"_blank",rel:"noopener noreferrer",className:V("text-violet-600 hover:underline dark:text-violet-400",E.className),onClick:Rs,children:P},P)}},e[30]=u,e[31]=z):z=e[31];let l;e[32]!==x?(l=typeof x=="string"?x.replace(/#([\u0980-\u09FF\w]+)/g,"https://internal.tag/$1"):x,e[32]=x,e[33]=l):l=e[33];let w;e[34]!==z||e[35]!==l?(w=(0,t.jsx)(Ce,{options:z,children:l}),e[34]=z,e[35]=l,e[36]=w):w=e[36];const S=m&&!h&&"...";let I;e[37]!==h||e[38]!==m?(I=m&&(0,t.jsx)("button",{onClick:k=>{k.stopPropagation(),p(!h)},className:"ml-1 cursor-pointer font-bold text-rose-600 hover:underline dark:text-rose-400",children:h?"Show less":"See more"}),e[37]=h,e[38]=m,e[39]=I):I=e[39];let M;return e[40]!==v||e[41]!==w||e[42]!==S||e[43]!==I?(M=(0,t.jsxs)("div",{className:v,children:[w,S,I]}),e[40]=v,e[41]=w,e[42]=S,e[43]=I,e[44]=M):M=e[44],M},at=Ts;function Ms(i){return i.stopPropagation()}function Rs(i){return i.stopPropagation()}var Is=O(),Es=i=>{const e=(0,Is.c)(28),{media:s,isEditing:n,editedMedia:a,setEditedMedia:r,newFiles:o,setNewFiles:c}=i;let d;e[0]!==a?(d=a===void 0?[]:a,e[0]=a,e[1]=d):d=e[1];const j=d;let b;e[2]!==o?(b=o===void 0?[]:o,e[2]=o,e[3]=b):b=e[3];const u=b,h=(0,N.useRef)(null);if(n&&r&&c){let f;if(e[4]!==j||e[5]!==r){let v;e[7]!==r?(v=(z,l)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[z.type==="video"?(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(Oe,{size:24,className:"text-zinc-400"})}):(0,t.jsx)("img",{src:z.url||z.src,className:"size-full object-cover",alt:""}),(0,t.jsx)("button",{onClick:w=>{w.stopPropagation(),r(S=>S.filter((I,M)=>M!==l))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(se,{size:16})})]},`old-${l}`),e[7]=r,e[8]=v):v=e[8],f=j.map(v),e[4]=j,e[5]=r,e[6]=f}else f=e[6];let m;if(e[9]!==u||e[10]!==c){let v;e[12]!==c?(v=(z,l)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border-2 border-dashed border-violet-500 bg-violet-50/10",children:[z.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(z),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center",children:(0,t.jsx)(Oe,{size:24,className:"animate-pulse text-violet-500"})}),(0,t.jsx)("button",{onClick:w=>{w.stopPropagation(),c(S=>S.filter((I,M)=>M!==l))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(se,{size:16})}),(0,t.jsx)("div",{className:"absolute bottom-1 left-1 rounded bg-violet-600 px-1 text-[8px] font-bold text-white",children:"NEW"})]},`new-${l}`),e[12]=c,e[13]=v):v=e[13],m=u.map(v),e[9]=u,e[10]=c,e[11]=m}else m=e[11];let g;e[14]!==j.length||e[15]!==u.length?(g=j.length+u.length<4&&(0,t.jsxs)("button",{onClick:v=>{v.stopPropagation(),h.current?.click()},className:"relative flex aspect-square flex-col items-center justify-center gap-1 rounded-xl border-2 border-dashed border-zinc-200 text-zinc-400 transition-all hover:border-violet-500 hover:bg-violet-50/5 hover:text-violet-500 dark:border-zinc-800",children:[(0,t.jsx)(Vt,{size:20}),(0,t.jsx)("span",{className:"text-[10px] font-bold",children:"Add Media"})]}),e[14]=j.length,e[15]=u.length,e[16]=g):g=e[16];let x;e[17]!==f||e[18]!==m||e[19]!==g?(x=(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:[f,m,g]}),e[17]=f,e[18]=m,e[19]=g,e[20]=x):x=e[20];let C;e[21]!==c?(C=(0,t.jsx)("input",{type:"file",ref:h,onChange:v=>{if(v.target.files){const z=Array.from(v.target.files);c(l=>[...l,...z])}},multiple:!0,className:"hidden",accept:"image/*,video/*"}),e[21]=c,e[22]=C):C=e[22];let $;return e[23]!==x||e[24]!==C?($=(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[x,C]}),e[23]=x,e[24]=C,e[25]=$):$=e[25],$}if(!s||s.length===0)return null;let p;return e[26]!==s?(p=(0,t.jsx)(li,{items:s}),e[26]=s,e[27]=p):p=e[27],p},lt=Es,As=O(),Ds=i=>{const e=(0,As.c)(35),{icon:s,count:n,label:a,onClick:r,active:o,activeColorClass:c,size:d,type:j}=i,b=d===void 0?18:d,u=j===void 0?"default":j;let h,p,f,m,g;if(e[0]!==o||e[1]!==c||e[2]!==n||e[3]!==a||e[4]!==r||e[5]!==u){const I={like:{hoverBg:"group-hover:bg-rose-500/10",hoverText:"group-hover:text-rose-500",activeText:"text-rose-500",activeFill:"fill-rose-500"},repost:{hoverBg:"group-hover:bg-emerald-500/10",hoverText:"group-hover:text-emerald-500",activeText:"text-emerald-500",activeFill:"fill-emerald-500"},comment:{hoverBg:"group-hover:bg-sky-500/10",hoverText:"group-hover:text-sky-500",activeText:"text-sky-500",activeFill:"fill-sky-500"},share:{hoverBg:"group-hover:bg-violet-500/10",hoverText:"group-hover:text-violet-500",activeText:"text-violet-500",activeFill:"fill-violet-500"},default:{hoverBg:"group-hover:bg-zinc-500/10",hoverText:"group-hover:text-zinc-500",activeText:"text-zinc-900 dark:text-white",activeFill:"fill-current"}};h=I[u]||I.default;const M=c||h.activeText;e[11]!==r?(f=k=>{k.stopPropagation(),r&&r(k)},e[11]=r,e[12]=f):f=e[12],m=`${a} ${n!==void 0?`(${n})`:""}`,g=V("group -ml-2 flex items-center gap-x-0.5 rounded-xl px-2 py-1.5 text-[12px] font-bold transition-all sm:gap-x-1 sm:text-[13px]",o?M:"text-zinc-500",!o&&h.hoverText),p=V("rounded-full p-2 transition-all duration-200",!o&&h.hoverBg),e[0]=o,e[1]=c,e[2]=n,e[3]=a,e[4]=r,e[5]=u,e[6]=h,e[7]=p,e[8]=f,e[9]=m,e[10]=g}else h=e[6],p=e[7],f=e[8],m=e[9],g=e[10];const x=o?2.5:2,C=o&&h.activeFill;let $;e[13]!==C?($=V("transition-colors duration-200",C),e[13]=C,e[14]=$):$=e[14];let v;e[15]!==s||e[16]!==b||e[17]!==x||e[18]!==$?(v=(0,t.jsx)(s,{size:b,strokeWidth:x,className:$}),e[15]=s,e[16]=b,e[17]=x,e[18]=$,e[19]=v):v=e[19];let z;e[20]!==v||e[21]!==p?(z=(0,t.jsx)("div",{className:p,children:v}),e[20]=v,e[21]=p,e[22]=z):z=e[22];let l;e[23]!==a?(l=a&&(0,t.jsx)("span",{className:"hidden xs:inline",children:a}),e[23]=a,e[24]=l):l=e[24];let w;e[25]!==o||e[26]!==n?(w=n!=null&&(0,t.jsx)("span",{className:V("transition-all",o?"font-black":"font-bold"),children:n||0}),e[25]=o,e[26]=n,e[27]=w):w=e[27];let S;return e[28]!==z||e[29]!==l||e[30]!==w||e[31]!==f||e[32]!==m||e[33]!==g?(S=(0,t.jsxs)("button",{onClick:f,"aria-label":m,className:g,children:[z,l,w]}),e[28]=z,e[29]=l,e[30]=w,e[31]=f,e[32]=m,e[33]=g,e[34]=S):S=e[34],S},q=Ds,Ls=O(),Us=i=>{const e=(0,Ls.c)(18),{poll:s,onVote:n}=i,a=s.options.reduce(Os,0),[r,o]=(0,N.useState)(null);let c;e[0]!==n||e[1]!==r?(c=f=>{r||(o(f),n&&n(f))},e[0]=n,e[1]=r,e[2]=c):c=e[2];const d=c;let j;if(e[3]!==d||e[4]!==s.options||e[5]!==a||e[6]!==r){let f;e[8]!==d||e[9]!==a||e[10]!==r?(f=(m,g)=>{const x=a>0?Math.round((m.votes+(r===m.id?1:0))/(a+(r?1:0))*100):0,C=r===m.id;return(0,t.jsxs)("div",{onClick:()=>d(m.id),className:`relative h-10 w-full overflow-hidden rounded-xl border cursor-pointer ${C?"border-violet-500 dark:border-violet-500":"border-zinc-200 dark:border-zinc-700"}`,children:[r&&(0,t.jsx)("div",{className:"absolute left-0 top-0 h-full bg-zinc-200 transition-all duration-500 dark:bg-zinc-800",style:{width:`${x}%`}}),(0,t.jsxs)("div",{className:"absolute inset-0 z-10 flex items-center justify-between px-4",children:[(0,t.jsxs)("span",{className:`text-sm font-medium ${C?"font-bold text-violet-600":"text-zinc-700 dark:text-zinc-200"}`,children:[m.text," ",C&&(0,t.jsx)(Zt,{size:14,className:"mb-0.5 inline ml-1"})]}),r&&(0,t.jsxs)("span",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:[x,"%"]})]})]},m.id||g)},e[8]=d,e[9]=a,e[10]=r,e[11]=f):f=e[11],j=s.options.map(f),e[3]=d,e[4]=s.options,e[5]=a,e[6]=r,e[7]=j}else j=e[7];const b=a+(r?1:0),u=r?"6 days left":"Click to vote";let h;e[12]!==b||e[13]!==u?(h=(0,t.jsxs)("div",{className:"pl-1 text-xs text-zinc-500 dark:text-zinc-400",children:[b," votes •"," ",u]}),e[12]=b,e[13]=u,e[14]=h):h=e[14];let p;return e[15]!==j||e[16]!==h?(p=(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[j,h]}),e[15]=j,e[16]=h,e[17]=p):p=e[17],p},nt=Us;function Os(i,e){return i+e.votes}var Ws=O(),Bs=i=>{const e=(0,Ws.c)(30),{user:s,time:n,content:a}=i,r=ie();let o;e[0]!==s.avatar||e[1]!==s.handle?(o=(0,t.jsx)(X,{src:s.avatar,alt:s.handle}),e[0]=s.avatar,e[1]=s.handle,e[2]=o):o=e[2];let c;e[3]!==s.handle[0]?(c=s.handle[0]?.toUpperCase(),e[3]=s.handle[0],e[4]=c):c=e[4];let d;e[5]!==c?(d=(0,t.jsx)(K,{children:c}),e[5]=c,e[6]=d):d=e[6];let j;e[7]!==o||e[8]!==d?(j=(0,t.jsxs)(Q,{className:"size-6",children:[o,d]}),e[7]=o,e[8]=d,e[9]=j):j=e[9];let b;e[10]!==s.handle?(b=(0,t.jsx)("span",{className:"text-sm font-semibold",children:s.handle}),e[10]=s.handle,e[11]=b):b=e[11];let u;e[12]!==j||e[13]!==b?(u=(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[j,b]}),e[12]=j,e[13]=b,e[14]=u):u=e[14];let h;e[15]!==n?(h=(0,t.jsx)("span",{className:"text-xs text-zinc-500 sm:text-sm",children:n}),e[15]=n,e[16]=h):h=e[16];let p;e[17]!==u||e[18]!==h?(p=(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between gap-x-2",children:[u,h]}),e[17]=u,e[18]=h,e[19]=p):p=e[19];let f;e[20]!==r?(f={...$e,render:C=>{const{attributes:$,content:v}=C,{href:z,...l}=$,w=window.location.origin;let S=null;return z.startsWith("/")?S=z:z.startsWith(w)&&(S=z.replace(w,"")),S?(0,t.jsx)("span",{...l,className:V("cursor-pointer font-medium text-violet-600 hover:underline dark:text-violet-400",l.className),onClick:I=>{I.stopPropagation(),r(S)},children:v},v):(0,t.jsx)("a",{href:z,...l,target:"_blank",rel:"noopener noreferrer",className:V("text-violet-600 hover:underline dark:text-violet-400",l.className),onClick:Vs,children:v},v)}},e[20]=r,e[21]=f):f=e[21];let m;e[22]!==a?(m=(0,t.jsx)("p",{className:"whitespace-pre-line text-sm text-zinc-800 dark:text-zinc-300",children:a}),e[22]=a,e[23]=m):m=e[23];let g;e[24]!==m||e[25]!==f?(g=(0,t.jsx)(Ce,{options:f,children:m}),e[24]=m,e[25]=f,e[26]=g):g=e[26];let x;return e[27]!==g||e[28]!==p?(x=(0,t.jsxs)("div",{className:"p-4",children:[p,g]}),e[27]=g,e[28]=p,e[29]=x):x=e[29],x},rt=Bs;function Vs(i){return i.stopPropagation()}var qs=O(),Hs=i=>{const e=(0,qs.c)(49),{currentUser:s,newComment:n,setNewComment:a,handleSubmitComment:r,loading:o,selectedFiles:c,setSelectedFiles:d,isUploading:j}=i;let b;e[0]!==c?(b=c===void 0?[]:c,e[0]=c,e[1]=b):b=e[1];const u=b,h=(0,N.useRef)(null);let p;e[2]!==d?(p=D=>{if(D.target.files){const U=Array.from(D.target.files);d&&d(B=>[...B,...U])}},e[2]=d,e[3]=p):p=e[3];const f=p;let m;e[4]!==d?(m=D=>{d&&d(U=>U.filter((B,Z)=>Z!==D))},e[4]=d,e[5]=m):m=e[5];const g=m;let x;e[6]!==d?(x=D=>{const U=D.clipboardData.files;if(U&&U.length>0){const B=Array.from(U).filter(Gs);B.length>0&&(D.preventDefault(),d&&d(Z=>[...Z,...B]))}},e[6]=d,e[7]=x):x=e[7];const C=x;if(!s){let D;return e[8]===Symbol.for("react.memo_cache_sentinel")?(D=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-6 text-center dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"Please login to join the conversation."})}),e[8]=D):D=e[8],D}let $;e[9]!==s.avatar||e[10]!==s.handle?($=(0,t.jsx)(X,{src:s.avatar,alt:s.handle,className:"object-cover"}),e[9]=s.avatar,e[10]=s.handle,e[11]=$):$=e[11];let v;e[12]!==s.handle?.[0]?(v=s.handle?.[0]?.toUpperCase(),e[12]=s.handle?.[0],e[13]=v):v=e[13];let z;e[14]!==v?(z=(0,t.jsx)(K,{children:v}),e[14]=v,e[15]=z):z=e[15];let l;e[16]!==$||e[17]!==z?(l=(0,t.jsxs)(Q,{className:"size-9 border border-zinc-200 dark:border-zinc-700",children:[$,z]}),e[16]=$,e[17]=z,e[18]=l):l=e[18];let w;e[19]!==a?(w=D=>a(D.target.value),e[19]=a,e[20]=w):w=e[20];let S;e[21]!==C||e[22]!==n||e[23]!==w?(S=(0,t.jsx)("textarea",{id:"comment-input",className:"min-h-[60px] w-full resize-none bg-transparent text-base outline-none placeholder:text-zinc-500 dark:text-white",placeholder:"Post your reply...",value:n,onChange:w,onPaste:C}),e[21]=C,e[22]=n,e[23]=w,e[24]=S):S=e[24];let I;e[25]!==g||e[26]!==u?(I=u.length>0&&(0,t.jsx)("div",{className:"mt-2 mb-2 flex flex-wrap gap-2",children:u.map((D,U)=>(0,t.jsxs)("div",{className:"relative size-20 overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[D.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(D),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)(Xt,{size:20,className:"text-zinc-500"})}),(0,t.jsx)("button",{onClick:()=>g(U),className:"absolute right-1 top-1 rounded-full bg-black/60 p-1 text-white transition-colors hover:bg-black",children:(0,t.jsx)(se,{size:12})})]},U))}),e[25]=g,e[26]=u,e[27]=I):I=e[27];let M;e[28]===Symbol.for("react.memo_cache_sentinel")?(M=()=>h.current?.click(),e[28]=M):M=e[28];let k;e[29]===Symbol.for("react.memo_cache_sentinel")?(k=(0,t.jsx)("button",{type:"button",onClick:M,className:"rounded-full p-2 text-violet-600 transition-colors hover:bg-violet-50 dark:hover:bg-zinc-800",title:"Attach media",children:(0,t.jsx)(Pt,{size:20})}),e[29]=k):k=e[29];let R;e[30]!==f?(R=(0,t.jsxs)("div",{className:"flex gap-1 text-violet-600",children:[k,(0,t.jsx)("input",{type:"file",ref:h,onChange:f,multiple:!0,className:"hidden",accept:"image/*,video/*,application/pdf"})]}),e[30]=f,e[31]=R):R=e[31];const P=o||j;let A;e[32]!==n||e[33]!==u.length?(A=!n.trim()&&u.length===0,e[32]=n,e[33]=u.length,e[34]=A):A=e[34];let E;e[35]!==r||e[36]!==P||e[37]!==A?(E=(0,t.jsx)(fs,{className:"min-w-[70px] !w-auto px-5 py-1.5 text-sm font-bold",onClick:r,loading:P,disabled:A,children:"Reply"}),e[35]=r,e[36]=P,e[37]=A,e[38]=E):E=e[38];let _;e[39]!==R||e[40]!==E?(_=(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between border-t border-zinc-100 pt-3 dark:border-zinc-800",children:[R,E]}),e[39]=R,e[40]=E,e[41]=_):_=e[41];let y;e[42]!==S||e[43]!==I||e[44]!==_?(y=(0,t.jsxs)("div",{className:"flex-1",children:[S,I,_]}),e[42]=S,e[43]=I,e[44]=_,e[45]=y):y=e[45];let T;return e[46]!==y||e[47]!==l?(T=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-4 dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[l,y]})}),e[46]=y,e[47]=l,e[48]=T):T=e[48],T},ut=N.memo(Hs);function Gs(i){return i.type.startsWith("image/")}var Js=O(),Xs=i=>{const e=(0,Js.c)(30),{url:s}=i;let n,a;e[0]!==s?(n=["link-preview",s],a=()=>ns(s),e[0]=s,e[1]=n,e[2]=a):(n=e[1],a=e[2]);const r=!!s;let o;e[3]!==n||e[4]!==a||e[5]!==r?(o={queryKey:n,queryFn:a,staleTime:864e5,enabled:r},e[3]=n,e[4]=a,e[5]=r,e[6]=o):o=e[6];const{data:c,isLoading:d,isError:j}=Ft(o);if(d){let $;return e[7]===Symbol.for("react.memo_cache_sentinel")?($=(0,t.jsx)("div",{className:"mt-3 flex h-24 animate-pulse items-center justify-center overflow-hidden rounded-2xl border border-zinc-100 bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-900/50",children:(0,t.jsx)(Ue,{className:"animate-spin text-zinc-300 dark:text-zinc-700",size:24})}),e[7]=$):$=e[7],$}if(j||!c||!c.title&&!c.image)return null;let b;e[8]!==c.image||e[9]!==c.title?(b=c.image&&(0,t.jsx)("div",{className:"aspect-[1.91/1] w-full overflow-hidden border-b border-zinc-100 bg-zinc-100 dark:border-zinc-800 dark:bg-zinc-900",children:(0,t.jsx)("img",{src:c.image,alt:c.title??void 0,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-[1.02]",onError:Qs})}),e[8]=c.image,e[9]=c.title,e[10]=b):b=e[10];let u;e[11]===Symbol.for("react.memo_cache_sentinel")?(u=(0,t.jsx)(Ue,{size:12}),e[11]=u):u=e[11];let h;e[12]!==c.siteName?(h=(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs font-bold uppercase tracking-wider text-zinc-600",children:[u,(0,t.jsx)("span",{children:c.siteName})]}),e[12]=c.siteName,e[13]=h):h=e[13];let p;e[14]!==c.title?(p=(0,t.jsx)("div",{className:"line-clamp-2 text-[15px] font-bold leading-snug transition-colors group-hover:text-violet-700 dark:text-white",children:c.title}),e[14]=c.title,e[15]=p):p=e[15];let f;e[16]!==c.description?(f=c.description&&(0,t.jsx)("p",{className:"line-clamp-2 text-xs leading-relaxed text-zinc-600 dark:text-zinc-400",children:c.description}),e[16]=c.description,e[17]=f):f=e[17];let m;e[18]===Symbol.for("react.memo_cache_sentinel")?(m=(0,t.jsx)(Lt,{size:10}),e[18]=m):m=e[18];let g;e[19]!==s?(g=(0,t.jsxs)("div",{className:"flex items-center gap-1 pt-1 text-[11px] font-medium text-zinc-500",children:[m,(0,t.jsx)("span",{className:"truncate",children:s})]}),e[19]=s,e[20]=g):g=e[20];let x;e[21]!==g||e[22]!==h||e[23]!==p||e[24]!==f?(x=(0,t.jsxs)("div",{className:"space-y-1 p-3.5",children:[h,p,f,g]}),e[21]=g,e[22]=h,e[23]=p,e[24]=f,e[25]=x):x=e[25];let C;return e[26]!==x||e[27]!==b||e[28]!==s?(C=(0,t.jsxs)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"group mt-3 flex flex-col overflow-hidden rounded-2xl border border-zinc-100 bg-white shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-900",onClick:Ks,children:[b,x]}),e[26]=x,e[27]=b,e[28]=s,e[29]=C):C=e[29],C},ot=Xs;function Ks(i){return i.stopPropagation()}function Qs(i){return i.target.style.display="none"}var Zs=O(),Ys=i=>{const e=(0,Zs.c)(15),{file:s}=i;let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,t.jsx)("div",{className:"flex size-10 items-center justify-center rounded-xl bg-violet-100 text-violet-600 dark:bg-violet-900/30",children:(0,t.jsx)(Gt,{size:20})}),e[0]=n):n=e[0];let a;e[1]!==s.name?(a=(0,t.jsx)("div",{className:"truncate text-sm font-bold dark:text-white",children:s.name}),e[1]=s.name,e[2]=a):a=e[2];let r;e[3]!==s.size?(r=s.size!==void 0&&(0,t.jsxs)("div",{className:"text-xs uppercase text-zinc-500",children:[(s.size/1024/1024).toFixed(2)," MB"]}),e[3]=s.size,e[4]=r):r=e[4];let o;e[5]!==a||e[6]!==r?(o=(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[a,r]}),e[5]=a,e[6]=r,e[7]=o):o=e[7];let c;e[8]===Symbol.for("react.memo_cache_sentinel")?(c=(0,t.jsx)(Tt,{size:18}),e[8]=c):c=e[8];let d;e[9]!==s.name||e[10]!==s.url?(d=(0,t.jsx)("a",{href:s.url,download:s.name,className:"p-2 text-zinc-400 transition-colors hover:text-violet-600",onClick:ti,children:c}),e[9]=s.name,e[10]=s.url,e[11]=d):d=e[11];let j;return e[12]!==o||e[13]!==d?(j=(0,t.jsxs)("div",{className:"group mt-3 flex items-center gap-3 rounded-2xl border border-zinc-100 bg-zinc-50/50 p-3 transition-colors hover:border-violet-500/30 dark:border-zinc-800 dark:bg-zinc-900/10",children:[n,o,d]}),e[12]=o,e[13]=d,e[14]=j):j=e[14],j},ei=Ys;function ti(i){return i.stopPropagation()}var si=O(),ii=N.lazy(()=>dt(()=>import("./VideoPlayer-DtVYkwZU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),ai=i=>{const e=(0,si.c)(3),{items:s}=i,n=s===void 0?[]:s,{openLightbox:a}=hs();if(!n||Array.isArray(n)&&n.length===0)return null;const r=Array.isArray(n)?n:[n],o=r.filter(ni),c=r.filter(ri),d=p=>{const f=o.filter(oi).map(ci),m=o[p];a(f,f.indexOf(m.url||m.src))},j="mt-2 space-y-2",b=o.length>0&&(0,t.jsx)("div",{className:`grid gap-2 overflow-hidden rounded-2xl border border-zinc-100 dark:border-zinc-800 ${o.length===1?"grid-cols-1":o.length===2?"aspect-[16/9] grid-cols-2":(o.length===3,"aspect-[16/9] grid-cols-2 grid-rows-2")}`,children:o.map((p,f)=>(0,t.jsx)("div",{className:`relative cursor-pointer overflow-hidden bg-zinc-100 dark:bg-zinc-900 ${o.length===3&&f===0?"row-span-2":""}
                                `,onClick:m=>{p.type==="image"&&(m.stopPropagation(),d(f))},children:p.type==="video"?(0,t.jsx)(N.Suspense,{fallback:(0,t.jsx)("div",{className:"flex aspect-video w-full items-center justify-center bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)("div",{className:"size-8 animate-spin rounded-full border-2 border-violet-500 border-t-transparent"})}),children:(0,t.jsx)(ii,{src:p.url,poster:p.poster||void 0})}):(0,t.jsx)("img",{src:p.url||p.src,className:"size-full object-cover transition-transform duration-500 hover:scale-[1.02]",alt:"",loading:"lazy"})},f))}),u=c.map(di);let h;return e[0]!==b||e[1]!==u?(h=(0,t.jsxs)("div",{className:j,children:[b,u]}),e[0]=b,e[1]=u,e[2]=h):h=e[2],h},li=ai;function ni(i){return i.type==="image"||i.type==="video"}function ri(i){return i.type==="file"}function oi(i){return i.type==="image"}function ci(i){return i.url||i.src}function di(i,e){return(0,t.jsx)(ei,{file:i},e)}var we=({id:i,user:e,timeAgo:s,content:n,contentClass:a,media:r,quotedPost:o,stats:c,onClick:d,repostedBy:j,onUserClick:b,currentUser:u,poll:h,isDetail:p,initialComments:f,onDelete:m,onUpdate:g,isComment:x,onReply:C,community:$,parent_id:v,post_id:z,commenterAvatars:l=[]})=>{const w=ie(),{addToast:S}=ye(),{liked:I,reposted:M,localStats:k,setLocalStats:R,handleLike:P,handleRepost:A}=Ns(i,c,u),{deletePost:E,updatePost:_}=ms(),{comments:y,fetchNextPage:T,hasNextPage:D,isFetchingNextPage:U,isLoading:B,addComment:Z,isSubmitting:gt}=et(i,f),[he,fe]=(0,N.useState)(""),[ue,_e]=(0,N.useState)([]),[vt,Se]=(0,N.useState)(!1),[Fe,ae]=(0,N.useState)(!1),[le,Y]=(0,N.useState)(!1),[H,ne]=(0,N.useState)(n),[re,oe]=(0,N.useState)(r||[]),[ce,ee]=(0,N.useState)([]),[Pe,Te]=(0,N.useState)(!1),[bt,pe]=(0,N.useState)(!1),[ge,de]=(0,N.useState)(null),[ve,Me]=(0,N.useState)(!1),{comments:jt,isLoading:zt,refetch:Re}=et(z||i,[],ve?i:void 0),{ref:Ie,inView:Ee}=_t({threshold:.5,triggerOnce:!0});(0,N.useEffect)(()=>{if(Ee&&!x){const F=setTimeout(()=>{ds(i).catch(console.error)},1500);return()=>clearTimeout(F)}},[Ee,i,x]);const kt=(0,N.useCallback)(async()=>{!i||!z&&!i||k.comments===0||(Me(!0),Re())},[i,z,k.comments,Re]),Ae=async()=>{const F=JSON.stringify(re)!==JSON.stringify(r||[])||ce.length>0;if(!H.trim()||H===n&&!F){Y(!1);return}Te(!0);try{const L=[];for(const J of ce){const yt=await Ne(J);L.push(yt)}const W=[...re,...L];x?await bs(i,{content:H,media:W}):await _(i,{content:H,media:W}),ee([]),Y(!1),S(`${x?"Comment":"Post"} updated`),g&&g(i,H,W)}catch(L){console.error(`Failed to update ${x?"comment":"post"}:`,L),S(`Failed to update ${x?"comment":"post"}`)}finally{Te(!1)}},De=async F=>{F&&F.stopPropagation();try{x?await ts(i):await E(i),S(`${x?"Comment":"Post"} deleted successfully`),m&&m(i)}catch(L){console.error(`Failed to delete ${x?"comment":"post"}:`,L),S(`Failed to delete ${x?"comment":"post"}`)}finally{ae(!1)}},Nt=async F=>{if(F.preventDefault(),!(!he.trim()&&ue.length===0||!u)){Se(!0);try{const L=[];for(const W of ue){const J=await Ne(W);L.push(J)}await Z({userId:u.id,content:he,media:L,replyToId:ge?.id}),fe(""),_e([]),de(null),R(W=>({...W,comments:(W.comments||0)+1})),S("Reply posted!")}catch(L){console.error("Failed to post comment:",L),S("Failed to post reply.")}finally{Se(!1)}}},Le=({trigger:F})=>(0,t.jsxs)(is,{children:[(0,t.jsx)(cs,{asChild:!0,onClick:L=>L.stopPropagation(),children:F}),(0,t.jsxs)(gs,{align:"end",className:"w-48 rounded-xl border-zinc-100 bg-white dark:border-zinc-800 dark:bg-zinc-900",children:[(0,t.jsxs)(Ve,{children:[!x&&(0,t.jsxs)(te,{className:"cursor-pointer gap-2 py-2.5",onClick:L=>{L.stopPropagation(),navigator.clipboard.writeText(`${window.location.origin}/p/${i}`),S("Link copied")},children:[(0,t.jsx)(It,{size:16}),(0,t.jsx)("span",{children:"Copy link"})]}),!x&&(0,t.jsxs)(te,{className:"cursor-pointer gap-2 py-2.5",onClick:L=>{L.stopPropagation(),S("Post reported")},children:[(0,t.jsx)(Ut,{size:16}),(0,t.jsx)("span",{children:"Report post"})]}),!be&&(0,t.jsxs)(te,{className:"cursor-pointer gap-2 py-2.5",onClick:L=>{L.stopPropagation(),S("User blocked")},children:[(0,t.jsx)(Rt,{size:16}),(0,t.jsxs)("span",{children:["Block @",e.handle]})]}),be&&(0,t.jsxs)(te,{onClick:L=>{L.stopPropagation(),Y(!0)},className:"cursor-pointer gap-2 py-2.5",children:[(0,t.jsx)(Jt,{size:16}),"Edit Post"]})]}),be&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(os,{}),(0,t.jsx)(Ve,{children:(0,t.jsxs)(te,{variant:"destructive",className:"cursor-pointer gap-2 py-2.5",onClick:L=>{L.stopPropagation(),ae(!0)},children:[(0,t.jsx)(Yt,{size:16}),(0,t.jsx)("span",{children:"Delete post"})]})})]})]})]}),be=u?.handle===e.handle,wt=(F,L)=>{de(L?{handle:F,id:x?v||i:L}:null),fe(W=>{const J=`@${F} `;return W.includes(J)?W:J+W}),document.getElementById("comment-input")?.focus()};return p?(0,t.jsxs)("div",{className:"flex flex-col",ref:Ie,children:[(0,t.jsxs)("article",{className:"p-5 dark:bg-black",children:[(0,t.jsx)(it,{user:e,timeAgo:s,community:$,onUserClick:b,isDetail:!0,showAvatar:!0,actionsMenu:(0,t.jsx)(Le,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,t.jsx)(ze,{size:20})})})}),(0,t.jsx)(at,{content:n,isDetail:!0,isEditing:le,editedContent:H,setEditedContent:ne,onCancelEdit:()=>{Y(!1),ne(n),oe(r||[]),ee([])},onSaveEdit:Ae,isUpdating:Pe,contentClass:a}),me(n)&&(0,t.jsx)(ot,{url:me(n)}),(0,t.jsx)(lt,{media:r,isEditing:le,editedMedia:re,setEditedMedia:oe,newFiles:ce,setNewFiles:ee}),h&&(0,t.jsx)(nt,{poll:h}),o&&(0,t.jsx)("div",{className:"mt-4 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm dark:border-zinc-700",children:(0,t.jsx)(rt,{...o})}),(0,t.jsx)(st,{views:k.views||0,likes:k.likes||0,comments:k.comments||0,isDetail:!0}),(0,t.jsx)(tt,{liked:I,reposted:M,handleLike:P,handleRepost:A,handleCommentClick:()=>document.getElementById("comment-input")?.focus(),handleShareClick:()=>pe(!0),isDetail:!0,isComment:x})]}),ge&&(0,t.jsxs)("div",{className:"flex items-center justify-between bg-zinc-50 px-5 py-2 dark:bg-zinc-900/50",children:[(0,t.jsxs)("span",{className:"text-sm text-zinc-500",children:["Replying to"," ",(0,t.jsxs)("span",{className:"font-bold text-violet-600",children:["@",ge.handle]})]}),(0,t.jsx)("button",{onClick:()=>de(null),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,t.jsx)(se,{size:16})})]}),(0,t.jsx)(ut,{currentUser:u,newComment:he,setNewComment:fe,handleSubmitComment:Nt,loading:gt,selectedFiles:ue,setSelectedFiles:_e,isUploading:vt}),(0,t.jsx)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:B?(0,t.jsx)("div",{className:"flex justify-center p-8",children:(0,t.jsx)(G,{className:"animate-spin text-violet-500"})}):(0,t.jsxs)(t.Fragment,{children:[D&&y.length>0&&(0,t.jsxs)("button",{onClick:()=>T(),disabled:U,className:"flex w-full items-center justify-center gap-2 py-3 text-sm font-bold text-violet-600 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[U&&(0,t.jsx)(G,{size:14,className:"animate-spin"}),"View more replies"]}),y.map(F=>(0,t.jsx)(we,{...F,isComment:!0,post_id:i,onReply:wt,onUserClick:b,currentUser:u,stats:{likes:F.stats?.likes||0,comments:F.stats?.comments||0,reposts:F.stats?.reposts||0},timeAgo:F.timeAgo||F.created_at},F.id))]})}),(0,t.jsx)(Ke,{open:Fe,onOpenChange:ae,children:(0,t.jsxs)(Xe,{onClick:F=>F.stopPropagation(),children:[(0,t.jsxs)(Je,{children:[(0,t.jsx)(Qe,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ye,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(He,{children:[(0,t.jsx)(qe,{onClick:F=>F.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Ze,{onClick:De,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]}):(0,t.jsxs)("article",{ref:Ie,onClick:d,className:`px-4 transition-all ${x?"py-2 bg-transparent hover:bg-zinc-50/30 dark:hover:bg-zinc-800/20":"py-4 border-b border-zinc-100 bg-white hover:bg-zinc-50/30 dark:border-zinc-800 dark:bg-black dark:hover:bg-white/[0.02]"} ${d?"cursor-pointer":""}`,children:[j&&(0,t.jsxs)("div",{className:"mb-2 ml-1 flex items-center space-x-1.5 text-[13px] font-semibold text-zinc-600",children:[(0,t.jsx)(je,{size:14,className:"text-zinc-500"}),(0,t.jsxs)("span",{className:"flex cursor-pointer items-center text-zinc-700 hover:underline dark:text-zinc-300",onClick:F=>{F.stopPropagation(),b&&b(j.handle)},children:[j.handle," Reposted"]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsxs)("div",{className:"flex shrink-0 flex-col items-center self-stretch pt-0.5",children:[(0,t.jsx)("div",{className:"cursor-pointer",onClick:F=>{F.stopPropagation(),b&&b(e.handle)},children:(0,t.jsxs)(Q,{className:`${x?"size-8":"size-10"} border-0 shadow-sm`,children:[(0,t.jsx)(X,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(K,{className:"text-xs",children:e.handle[0]?.toUpperCase()})]})}),(!x&&k.comments>0||x&&!v&&k.comments>0)&&(0,t.jsx)("div",{className:"mt-2 w-0.5 flex-1 rounded-full bg-zinc-100 dark:bg-zinc-800"})]}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,t.jsx)(it,{user:e,timeAgo:s,community:$,onUserClick:b,isComment:x,actionsMenu:(0,t.jsx)(Le,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 group-hover:bg-zinc-100 dark:hover:bg-zinc-800 dark:group-hover:bg-zinc-800/50",children:(0,t.jsx)(ze,{size:18})})})}),(0,t.jsx)(at,{content:n,isEditing:le,editedContent:H,setEditedContent:ne,onCancelEdit:()=>{Y(!1),ne(n),oe(r||[]),ee([])},onSaveEdit:Ae,isUpdating:Pe,contentClass:a}),me(n)&&(0,t.jsx)(ot,{url:me(n)}),(0,t.jsx)(lt,{media:r,isEditing:le,editedMedia:re,setEditedMedia:oe,newFiles:ce,setNewFiles:ee}),h&&(0,t.jsx)(nt,{poll:h}),o&&(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-900",onClick:F=>{F.stopPropagation(),w(`/p/${o.id}`)},children:(0,t.jsx)(rt,{...o})}),(0,t.jsx)(tt,{liked:I,reposted:M,handleLike:P,handleRepost:A,handleCommentClick:F=>{F?.stopPropagation(),C?C(e.handle,i):d&&d()},handleShareClick:F=>{F?.stopPropagation(),pe(!0)},isComment:x}),(0,t.jsx)(st,{views:k.views||0,likes:k.likes||0,comments:k.comments||0,commenterAvatars:l.length>0?l:y.slice(0,3).map(F=>F.user.avatar),isComment:x,onRepliesClick:()=>{ve?Me(!1):kt()}}),ve&&(0,t.jsxs)("div",{className:"relative mt-2 space-y-0",children:[(0,t.jsx)("div",{className:"absolute left-[19px] top-0 bottom-4 w-0.5 bg-zinc-100 dark:bg-zinc-800"}),zt?(0,t.jsx)("div",{className:"flex py-4 pl-12",children:(0,t.jsx)(G,{size:18,className:"animate-spin text-violet-500"})}):(0,t.jsx)("div",{className:"flex flex-col",children:jt.map(F=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute left-[19px] top-5 h-0.5 w-4 bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsx)("div",{className:"pl-6",children:(0,t.jsx)(we,{...F,isComment:!0,post_id:z||i,onReply:C,onUserClick:b,currentUser:u,stats:{likes:F.stats?.likes||0,comments:F.stats?.comments||0,reposts:F.stats?.reposts||0},timeAgo:F.timeAgo||F.created_at})})]},F.id))})]})]})]}),(0,t.jsx)(pt,{isOpen:bt,onClose:()=>pe(!1),url:`${window.location.origin}/p/${i}`,title:"Share Post"}),(0,t.jsx)(Ke,{open:Fe,onOpenChange:ae,children:(0,t.jsxs)(Xe,{onClick:F=>F.stopPropagation(),children:[(0,t.jsxs)(Je,{children:[(0,t.jsx)(Qe,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ye,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(He,{children:[(0,t.jsx)(qe,{onClick:F=>F.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Ze,{onClick:De,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})};function mi(i,e){const s=!i.media&&!e.media||i.media?.length===e.media?.length&&i.media?.every((a,r)=>a.url===e.media?.[r].url),n=i.repostedBy?.handle===e.repostedBy?.handle;return i.id===e.id&&i.content===e.content&&i.timeAgo===e.timeAgo&&i.user.id===e.user.id&&i.user.avatar===e.user.avatar&&i.stats.likes===e.stats.likes&&i.stats.comments===e.stats.comments&&i.stats.reposts===e.stats.reposts&&i.currentUser?.id===e.currentUser?.id&&!!s&&!!n}var xi=N.memo(we,mi),hi=({isOpen:i,onClose:e,url:s,title:n="Share"})=>{const[a,r]=(0,N.useState)(!1),[o,c]=(0,N.useState)(""),[d,j]=(0,N.useState)([]),[b,u]=(0,N.useState)(!1),[h,p]=(0,N.useState)(null),{addToast:f}=ye(),{currentUser:m}=ft(),g=(0,N.useCallback)(async()=>{if(m){u(!0);try{j((await Be(m.id)).map(l=>l.user).filter(l=>l!==null).slice(0,5))}catch(l){console.error("Failed to fetch conversations:",l)}finally{u(!1)}}},[m?.id]);(0,N.useEffect)(()=>{i&&m?g():(c(""),j([]))},[i,m,g]);const x=(0,N.useCallback)(async()=>{if(m){u(!0);try{j((await Be(m.id)).map(l=>l.user).filter(l=>l!==null&&(l.name?.toLowerCase().includes(o.toLowerCase())||l.handle.toLowerCase().includes(o.toLowerCase()))))}catch(l){console.error("Search failed:",l)}finally{u(!1)}}},[o,m?.id]);(0,N.useEffect)(()=>{const l=setTimeout(()=>{o.trim()&&i?x():!o.trim()&&i&&g()},300);return()=>clearTimeout(l)},[o,i,x,g]);const C=async l=>{l&&l.stopPropagation();try{await navigator.clipboard.writeText(s),r(!0),f("Link copied to clipboard!","success"),setTimeout(()=>r(!1),2e3)}catch(w){console.error("Failed to copy:",w),f("Failed to copy link","error")}},$=async l=>{if(m){p(l.id);try{await es(await ls(m.id,l.id),m.id,s,"text"),f(`Sent to ${l.name||l.handle}!`,"success")}catch(w){console.error("Failed to send message:",w),f("Failed to send message","error")}finally{p(null)}}},v=[{name:"X",icon:At,color:"bg-black text-white",href:`https://twitter.com/intent/tweet?url=${encodeURIComponent(s)}`},{name:"Facebook",icon:Dt,color:"bg-[#1877F2] text-white",href:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(s)}`},{name:"LinkedIn",icon:Qt,color:"bg-[#0A66C2] text-white",href:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(s)}`},{name:"WhatsApp",icon:Bt,color:"bg-[#25D366] text-white",href:`https://wa.me/?text=${encodeURIComponent(s)}`},{name:"Email",icon:qt,color:"bg-zinc-600 text-white",href:`mailto:?body=${encodeURIComponent(s)}`}],z=async()=>{if(navigator.share)try{await navigator.share({title:n,url:s})}catch(l){l.name!=="AbortError"&&console.error("Native share failed:",l)}else C()};return(0,t.jsx)(xt,{isOpen:i,onClose:e,title:n,className:"max-w-[420px] !p-0 overflow-hidden",children:(0,t.jsxs)("div",{className:"flex h-full flex-col bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"px-5 pb-2 pt-4",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)(Ot,{className:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-zinc-400 transition-colors group-focus-within:text-violet-500"}),(0,t.jsx)("input",{type:"text",placeholder:"Search people...",value:o,onChange:l=>c(l.target.value),className:"w-full rounded-xl border-none bg-zinc-100 py-2.5 pl-10 pr-4 text-sm transition-all focus:ring-2 focus:ring-violet-500/20 outline-none dark:bg-zinc-800/50"})]})}),(0,t.jsx)("div",{className:"no-scrollbar flex min-h-[100px] items-center gap-4 overflow-x-auto px-5 py-4",children:b?(0,t.jsx)("div",{className:"flex flex-1 justify-center",children:(0,t.jsx)(G,{size:24,className:"animate-spin text-zinc-400"})}):d.length>0?d.map(l=>(0,t.jsxs)("button",{onClick:()=>$(l),disabled:h!==null,className:"group flex shrink-0 flex-col items-center gap-1.5 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"size-14 overflow-hidden rounded-full border-2 border-white shadow-sm transition-transform group-hover:scale-105 bg-zinc-100 dark:bg-zinc-800 dark:border-zinc-900",children:(0,t.jsx)("img",{src:l.avatar||`https://i.pravatar.cc/150?u=${l.id}`,alt:l.handle,className:"size-full object-cover"})}),h===l.id&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-full bg-black/40",children:(0,t.jsx)(G,{size:16,className:"animate-spin text-white"})})]}),(0,t.jsx)("span",{className:"max-w-[60px] truncate text-[10px] font-medium text-zinc-500 dark:text-zinc-400",children:l.name?.split(" ")[0]||l.handle})]},l.id)):(0,t.jsx)("div",{className:"flex-1 py-2 text-center",children:(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"No people found"})})}),(0,t.jsx)("div",{className:"mx-5 h-px bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsxs)("div",{className:"grid grid-cols-5 gap-2 px-5 py-6",children:[v.map(l=>(0,t.jsxs)("a",{href:l.href,target:"_blank",rel:"noopener noreferrer",className:"group flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:`size-12 ${l.color} flex items-center justify-center rounded-2xl shadow-md transition-all group-hover:-translate-y-1 group-hover:scale-110 group-hover:shadow-lg`,children:(0,t.jsx)(l.icon,{size:20,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-tighter text-zinc-500 dark:text-zinc-400",children:l.name})]},l.name)),(0,t.jsxs)("button",{onClick:z,className:"group flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:"flex size-12 items-center justify-center rounded-2xl border border-zinc-200 bg-zinc-100 text-zinc-600 shadow-sm transition-all group-hover:-translate-y-1 group-hover:scale-110 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-300",children:(0,t.jsx)(ze,{size:20,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-tighter text-zinc-500 dark:text-zinc-400",children:"More"})]})]}),(0,t.jsx)("div",{className:"px-5 pb-6",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)("input",{type:"text",readOnly:!0,value:s,className:"w-full rounded-2xl border border-zinc-200 bg-zinc-50 py-3.5 pl-4 pr-14 text-sm font-medium transition-colors focus:outline-none group-hover:border-zinc-300 dark:border-zinc-800 dark:bg-zinc-950 dark:group-hover:border-zinc-700"}),(0,t.jsx)("button",{onClick:C,className:`absolute right-1.5 top-1/2 flex -translate-y-1/2 items-center gap-2 rounded-xl h-10 px-4 text-xs font-bold shadow-sm transition-all active:scale-95 ${a?"bg-emerald-500 text-white":"bg-zinc-900 text-white hover:opacity-90 dark:bg-white dark:text-zinc-900"}`,children:a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Mt,{size:14,strokeWidth:3}),(0,t.jsx)("span",{children:"Copied"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Et,{size:14,strokeWidth:3}),(0,t.jsx)("span",{children:"Copy"})]})})]})}),(0,t.jsx)("div",{className:"px-5 pb-5",children:(0,t.jsxs)("button",{onClick:e,className:"group relative flex w-full items-center justify-center overflow-hidden rounded-2xl bg-zinc-900 py-4 font-bold text-white transition-all hover:shadow-xl hover:shadow-zinc-900/10 active:scale-[0.98] dark:bg-white dark:text-zinc-900 dark:hover:shadow-white/10",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-zinc-500 to-zinc-600 opacity-0 transition-opacity duration-300 group-hover:opacity-100"}),(0,t.jsx)("div",{className:"relative flex items-center gap-2",children:(0,t.jsx)("span",{children:"Close"})})]})})]})})},pt=hi,fi=N.lazy(()=>dt(()=>import("./dist-CYPYLHr8.js"),__vite__mapDeps([13,1,2,3,4,5])).then(i=>({default:i.Plyr}))),ui=N.memo(({reel:i,isActive:e,isMuted:s})=>{const n=ie(),{currentUser:a}=ft(),{addToast:r}=ye(),o=(0,N.useRef)(null),[c,d]=(0,N.useState)(!1),[j,b]=(0,N.useState)(!1),[u,h]=(0,N.useState)(!1),[p,f]=(0,N.useState)(null),[m,g]=(0,N.useState)(!1),[x,C]=(0,N.useState)(i.stats?.likes||0),[$,v]=(0,N.useState)(!1),[z,l]=(0,N.useState)(0),w=(0,N.useRef)(null),S=(0,N.useMemo)(()=>Array.isArray(i.media)?i.media[0]?.src||i.media[0]?.url:i.media?.src||i.media?.url||i.url,[i.media,i.url]);(0,N.useEffect)(()=>{let _;const y=o.current?.plyr;return y&&(e?_=setTimeout(()=>{typeof y.play=="function"&&y.play().catch(()=>{y&&(y.muted=!0,y.play().catch(()=>{}))})},100):typeof y.pause=="function"&&y.pause()),()=>{_&&clearTimeout(_)}},[e]),(0,N.useEffect)(()=>{if(!a?.id||!e)return;(async()=>{try{const[y,T]=await Promise.all([rs(i.id,a.id),us(a.id,i.user?.id)]);g(y),v(T)}catch(y){console.error("Failed to check interaction status:",y)}})()},[i.id,a?.id,e,i.user?.id]),(0,N.useEffect)(()=>{const _=o.current?.plyr;_&&(_.muted=s)},[s]),(0,N.useEffect)(()=>{const _=o.current?.plyr;if(!_||!e)return;const y=()=>{const T=_.currentTime,D=_.duration;D>0&&l(T/D*100)};if(typeof _.on=="function")return _.on("timeupdate",y),()=>{typeof _.off=="function"&&_.off("timeupdate",y)}},[e]),(0,N.useEffect)(()=>()=>{w.current&&clearTimeout(w.current)},[]);const I=_=>{const y=_.target;y.closest("button")||y.closest("a")||y.closest(".plyr__controls")||(w.current?(clearTimeout(w.current),w.current=null,k()):w.current=setTimeout(()=>{w.current=null,M()},250))},M=()=>{const _=o.current?.plyr;_&&(_.paused?(_.play().catch(()=>{}),f("play")):(_.pause(),f("pause")),setTimeout(()=>f(null),800))},k=async()=>{if(a&&(d(!0),setTimeout(()=>d(!1),1e3),!m)){g(!0),C(_=>_+1);try{await We(i.id,a.id)}catch{g(!1),C(_=>_-1)}}},R=async _=>{if(_.stopPropagation(),!a)return;const y=!m;g(y),C(T=>y?T+1:T-1);try{await We(i.id,a.id)}catch{g(!y),C(T=>y?T-1:T+1)}},P=async _=>{if(_.stopPropagation(),!a)return;const y=!$;v(y);try{await vs(a.id,i.user?.id)}catch{v(!y)}},A=_=>{_.stopPropagation(),h(!0)},E=(0,N.useMemo)(()=>({source:{type:"video",sources:[{src:S,type:"video/mp4"}]},options:{controls:[],loop:{active:!0},clickToPlay:!1,ratio:"9:16"}}),[S]);return(0,t.jsxs)("div",{"data-id":i.id,className:"reel-item relative flex h-[100dvh] w-full snap-start items-center justify-center overflow-hidden bg-black cursor-pointer",onClick:I,children:[(0,t.jsxs)("div",{className:"relative flex h-full w-full max-w-[450px] items-center justify-center",children:[(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(N.Suspense,{fallback:(0,t.jsx)("div",{className:"aspect-[9/16] w-full bg-zinc-900 animate-pulse"}),children:(0,t.jsx)(fi,{ref:o,...E})})}),c&&(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-in zoom-in-50 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)(xe,{size:120,fill:"white",className:"scale-125 text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.4)]"})})}),p&&(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-in fade-in zoom-in-90 scale-100 animate-out zoom-out-110 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)("div",{className:"rounded-full border border-white/20 bg-white/10 p-8 shadow-2xl backdrop-blur-md",children:p==="play"?(0,t.jsx)(Kt,{size:50,fill:"white",className:"ml-1.5 text-white"}):(0,t.jsx)(Ht,{size:50,fill:"white",className:"text-white"})})})}),(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/60"}),(0,t.jsxs)("div",{className:"pointer-events-none absolute bottom-6 left-4 right-16 text-white",children:[(0,t.jsxs)("div",{className:"pointer-events-auto mb-3 flex items-center gap-2",children:[(0,t.jsxs)(St,{to:`/u/${i.user?.handle}`,className:"flex items-center gap-2 transition-opacity hover:opacity-80",onClick:_=>_.stopPropagation(),children:[(0,t.jsxs)(Q,{className:"size-10 border-2 border-white",children:[(0,t.jsx)(X,{src:i.user?.avatar,alt:i.user?.handle,className:"object-cover"}),(0,t.jsx)(K,{children:i.user?.handle?.[0]?.toUpperCase()})]}),(0,t.jsxs)("span",{className:"font-bold",children:["@",i.user?.handle]})]}),a?.id!==i.user?.id&&(0,t.jsx)("button",{className:`ml-2 flex items-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-bold transition-all active:scale-95 ${$?"border border-white/50 bg-transparent text-white":"bg-white text-black hover:bg-zinc-200"}`,onClick:P,children:$?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ps,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Following"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(xs,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Follow"})]})})]}),(0,t.jsx)(Ce,{options:{...$e,render:({attributes:_,content:y})=>{const{href:T,...D}=_,U=!T.startsWith("/")&&(T.startsWith("http")||T.startsWith("www"));return T.startsWith("/u/")||T.startsWith("/tags/")||T.startsWith("/c/")||T.startsWith("/explore")?(0,t.jsx)("span",{...D,className:"cursor-pointer font-bold text-white hover:underline",onClick:B=>{B.stopPropagation(),n(T)},children:y},y):(0,t.jsx)("a",{href:T,...D,className:"text-white hover:underline",target:U?"_blank":void 0,rel:U?"noopener noreferrer":void 0,onClick:B=>B.stopPropagation(),children:y},y)}},children:(0,t.jsx)("p",{className:"mb-3 line-clamp-2 text-sm",children:i.content})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[(0,t.jsx)(Wt,{size:14,className:"animate-spin-slow"}),(0,t.jsxs)("span",{children:["Original Audio - ",i.user?.handle]})]})]}),(0,t.jsxs)("div",{className:"absolute bottom-6 right-2 z-10 flex flex-col items-center gap-6",children:[(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:`rounded-full p-3 backdrop-blur-md transition-all active:scale-90 ${m?"bg-rose-500/20 text-rose-500":"bg-zinc-800/50 text-white hover:bg-zinc-700"}`,onClick:R,children:(0,t.jsx)(xe,{size:28,fill:m?"currentColor":"none"})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:x})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700 active:scale-90",onClick:_=>{_.stopPropagation(),b(!0)},children:(0,t.jsx)(ht,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:i.stats?.comments||0})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700 active:scale-90",onClick:A,children:(0,t.jsx)(ke,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:i.stats?.shares||0})]})]}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 z-50 h-[3px] w-full bg-white/20",children:(0,t.jsx)("div",{className:"h-full bg-white shadow-[0_0_8px_rgba(255,255,255,0.8)] transition-all duration-100 ease-linear",style:{width:`${z}%`}})})]}),(0,t.jsx)(gi,{isOpen:j,onClose:()=>b(!1),reelId:i.id,currentUser:a,showToast:r}),(0,t.jsx)(pt,{isOpen:u,onClose:()=>h(!1),url:`${window.location.origin}/r/${i.id}`,title:"Share Reel"})]})},(i,e)=>i.isActive===e.isActive&&i.reel.id===e.reel.id&&i.isMuted===e.isMuted),Ci=ui,pi=({isOpen:i,onClose:e,reelId:s,currentUser:n,showToast:a})=>{const[r,o]=(0,N.useState)([]),[c,d]=(0,N.useState)(!1),[j,b]=(0,N.useState)(!1),[u,h]=(0,N.useState)(""),[p,f]=(0,N.useState)([]),[m,g]=(0,N.useState)(!1),[x,C]=(0,N.useState)(!0),[$,v]=(0,N.useState)(!1),[z,l]=(0,N.useState)(null),w=(0,N.useRef)(r);(0,N.useEffect)(()=>{w.current=r},[r]);const S=(0,N.useCallback)(async(M=!1)=>{if(s){M?v(!0):d(!0);try{const k=w.current,R=await as(s,M&&k.length>0?k[k.length-1].created_at:null,10);R.length<10?C(!1):C(!0),o(M?P=>[...P,...R]:R)}catch(k){console.error("Failed to load comments:",k),a&&a("Failed to load comments","error")}finally{d(!1),v(!1)}}},[s,a]);(0,N.useEffect)(()=>{i&&s?S():(o([]),C(!0))},[i,s,S]);const I=async M=>{if(M.preventDefault(),!(!u.trim()&&p.length===0||!n)){b(!0),g(!0);try{const k=[];for(const R of p){const P=await Ne(R);k.push(P)}await ss(s,n.id,u,k,z?.id),h(""),f([]),l(null),a&&a("Reply posted!"),S()}catch(k){console.error("Failed to post comment:",k),a&&a("Failed to post reply.","error")}finally{b(!1),g(!1)}}};return(0,t.jsx)(xt,{isOpen:i,onClose:e,title:"Comments",className:"max-sm:h-[95dvh] h-[85vh] overflow-hidden !p-0 sm:max-w-xl",children:(0,t.jsxs)("div",{className:"flex h-full flex-col overflow-hidden bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"mx-auto my-3 h-1.5 w-12 shrink-0 rounded-full bg-zinc-200 dark:bg-zinc-800 sm:hidden"}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto scroll-smooth scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800",children:c?(0,t.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,t.jsx)(G,{className:"animate-spin text-violet-500",size:32})}):r.length>0?(0,t.jsxs)("div",{className:"flex flex-col",children:[r.map(M=>(0,t.jsx)(xi,{...M,isComment:!0,post_id:s,currentUser:n,showToast:a,onReply:(k,R)=>{l(R?{handle:k,id:R}:null),h(P=>P.includes(`@${k}`)?P:P+`@${k} `)},onDelete:k=>o(R=>R.filter(P=>P.id!==k)),onUpdate:(k,R,P)=>o(A=>A.map(E=>E.id===k?{...E,content:R,media:P}:E))},M.id)),x&&(0,t.jsxs)("button",{onClick:()=>S(!0),disabled:$,className:"flex w-full items-center justify-center gap-2 py-6 text-sm font-bold text-violet-600 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[$&&(0,t.jsx)(G,{size:16,className:"animate-spin"}),"View more replies"]})]}):(0,t.jsxs)("div",{className:"flex h-full min-h-[300px] flex-col items-center justify-center p-8 text-center text-zinc-500",children:[(0,t.jsx)("div",{className:"mb-4 flex size-16 items-center justify-center rounded-full bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(mt,{size:32,className:"text-zinc-400"})}),(0,t.jsx)("p",{className:"text-lg font-bold dark:text-zinc-300",children:"No comments yet"}),(0,t.jsx)("p",{className:"text-sm dark:text-zinc-500",children:"Be the first to share what you think!"})]})}),(0,t.jsxs)("div",{className:"shrink-0 border-t border-zinc-100 bg-white pb-safe dark:border-zinc-800 dark:bg-zinc-900",children:[z&&(0,t.jsxs)("div",{className:"flex items-center justify-between border-b border-zinc-50 bg-zinc-50/50 px-4 py-2 dark:border-zinc-800/50 dark:bg-zinc-900/50",children:[(0,t.jsxs)("span",{className:"text-xs text-zinc-500",children:["Replying to"," ",(0,t.jsxs)("span",{className:"font-bold text-violet-600",children:["@",z.handle]})]}),(0,t.jsx)("button",{onClick:()=>l(null),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,t.jsx)(se,{size:14})})]}),(0,t.jsx)(ut,{currentUser:n,newComment:u,setNewComment:h,handleSubmitComment:I,loading:j,selectedFiles:p,setSelectedFiles:f,isUploading:m})]})]})})},gi=pi,$i=O();export{xi as n,Ci as t};
