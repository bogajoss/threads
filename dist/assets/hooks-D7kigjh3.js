import{a as re}from"./rolldown-runtime-BaZ8gS7u.js";import{T as le,b as ie,s as Y,v as ce,x as ue,y as Z}from"./framework-DIDnLsp9.js";import{a as oe,n as te,r as I,t as U}from"./query-DNidMcz3.js";import{Bt as de,Ct as fe,Dt as me,Et as ge,Ft as he,Gt as ye,It as pe,Lt as Pe,Mt as ve,Nt as we,Qt as se,Rt as Ce,St as Me,Tt as be,Ut as Se,Vt as Fe,Wt as Le,Yt as ae,Zt as W,_t as X,bt as _e,gt as ke,ht as qe,i as De,kt as $e,mt as ee,pt as Ne,wt as Re,xt as Qe,zt as xe}from"./index-DyT3K11Y.js";var Te=Y(),_=re(le(),1);const nt=(e,s,i,o)=>{const t=(0,Te.c)(92),a=oe();let n;t[0]!==s?(n=s||{comments:0,likes:0,mirrors:0,reposts:0},t[0]=s,t[1]=n):n=t[1];const[h,l]=(0,_.useState)(n);let M,r;t[2]!==s?(M=()=>{s&&l(D=>({...D,...s}))},r=[s],t[2]=s,t[3]=M,t[4]=r):(M=t[3],r=t[4]),(0,_.useEffect)(M,r);const m=i?.id;let y;t[5]!==e||t[6]!==m?(y=["post",e,"liked",m],t[5]=e,t[6]=m,t[7]=y):y=t[7];let p;t[8]!==i?.id||t[9]!==e?(p=()=>ve(e,i?.id),t[8]=i?.id,t[9]=e,t[10]=p):p=t[10];let u;t[11]!==i||t[12]!==e?(u=!!i&&W(e)&&W(i.id),t[11]=i,t[12]=e,t[13]=u):u=t[13];let g;t[14]!==y||t[15]!==p||t[16]!==u?(g={queryKey:y,queryFn:p,enabled:u,staleTime:6e5},t[14]=y,t[15]=p,t[16]=u,t[17]=g):g=t[17];const{data:S}=I(g),F=S===void 0?!1:S,P=i?.id;let w;t[18]!==e||t[19]!==P?(w=["post",e,"reposted",P],t[18]=e,t[19]=P,t[20]=w):w=t[20];let C;t[21]!==i?.id||t[22]!==e?(C=()=>we(e,i?.id),t[21]=i?.id,t[22]=e,t[23]=C):C=t[23];let b;t[24]!==i||t[25]!==e?(b=!!i&&W(e)&&W(i.id),t[24]=i,t[25]=e,t[26]=b):b=t[26];let d;t[27]!==w||t[28]!==C||t[29]!==b?(d={queryKey:w,queryFn:C,enabled:b,staleTime:6e5},t[27]=w,t[28]=C,t[29]=b,t[30]=d):d=t[30];const{data:v}=I(d),k=v===void 0?!1:v;let $;t[31]!==i?.id||t[32]!==e?($=()=>de(e,i?.id),t[31]=i?.id,t[32]=e,t[33]=$):$=t[33];let q;t[34]!==i?.id||t[35]!==e||t[36]!==a?(q=async()=>{await a.cancelQueries({queryKey:["post",e,"liked",i?.id]});const D=a.getQueryData(["post",e,"liked",i?.id]);return a.setQueryData(["post",e,"liked",i?.id],!D),l(N=>({...N,likes:D?(N.likes||0)-1:(N.likes||0)+1})),{previousLiked:D}},t[34]=i?.id,t[35]=e,t[36]=a,t[37]=q):q=t[37];let c;t[38]!==i?.id||t[39]!==e||t[40]!==a||t[41]!==o?(c=(D,N,Q)=>{Q?.previousLiked!==void 0&&(a.setQueryData(["post",e,"liked",i?.id],Q.previousLiked),l(G=>({...G,likes:Q.previousLiked?(G.likes||0)+1:(G.likes||0)-1}))),o("Failed to update like","error")},t[38]=i?.id,t[39]=e,t[40]=a,t[41]=o,t[42]=c):c=t[42];let R;t[43]!==i?.id||t[44]!==e||t[45]!==a?(R=()=>{a.invalidateQueries({queryKey:["post",e,"liked",i?.id]})},t[43]=i?.id,t[44]=e,t[45]=a,t[46]=R):R=t[46];let x;t[47]!==$||t[48]!==q||t[49]!==c||t[50]!==R?(x={mutationFn:$,onMutate:q,onError:c,onSettled:R},t[47]=$,t[48]=q,t[49]=c,t[50]=R,t[51]=x):x=t[51];const E=te(x);let L;t[52]!==i?.id||t[53]!==e?(L=()=>Fe(e,i?.id),t[52]=i?.id,t[53]=e,t[54]=L):L=t[54];let f;t[55]!==i?.id||t[56]!==e||t[57]!==a?(f=async()=>{await a.cancelQueries({queryKey:["post",e,"reposted",i?.id]});const D=a.getQueryData(["post",e,"reposted",i?.id]);return a.setQueryData(["post",e,"reposted",i?.id],!D),l(N=>({...N,reposts:D?(N.reposts||0)-1:(N.reposts||0)+1,mirrors:D?(N.mirrors||0)-1:(N.mirrors||0)+1})),{previousReposted:D}},t[55]=i?.id,t[56]=e,t[57]=a,t[58]=f):f=t[58];let T;t[59]!==i?.id||t[60]!==e||t[61]!==a||t[62]!==o?(T=(D,N,Q)=>{Q?.previousReposted!==void 0&&(a.setQueryData(["post",e,"reposted",i?.id],Q.previousReposted),l(G=>({...G,reposts:Q.previousReposted?(G.reposts||0)+1:(G.reposts||0)-1,mirrors:Q.previousReposted?(G.mirrors||0)+1:(G.mirrors||0)-1}))),o("Failed to update repost","error")},t[59]=i?.id,t[60]=e,t[61]=a,t[62]=o,t[63]=T):T=t[63];let K;t[64]!==i?.id||t[65]!==e||t[66]!==a?(K=()=>{a.invalidateQueries({queryKey:["post",e,"reposted",i?.id]})},t[64]=i?.id,t[65]=e,t[66]=a,t[67]=K):K=t[67];let A;t[68]!==o?(A=D=>{o(D?"Reposted!":"Removed repost")},t[68]=o,t[69]=A):A=t[69];let O;t[70]!==L||t[71]!==f||t[72]!==T||t[73]!==K||t[74]!==A?(O={mutationFn:L,onMutate:f,onError:T,onSettled:K,onSuccess:A},t[70]=L,t[71]=f,t[72]=T,t[73]=K,t[74]=A,t[75]=O):O=t[75];const B=te(O);let j;t[76]!==i||t[77]!==E||t[78]!==e||t[79]!==o?(j=async D=>{if(D&&D.stopPropagation(),!i)return o("Please login to like!","error");!W(e)||!W(i.id)||E.mutate()},t[76]=i,t[77]=E,t[78]=e,t[79]=o,t[80]=j):j=t[80];const H=j;let z;t[81]!==i||t[82]!==e||t[83]!==B||t[84]!==o?(z=async D=>{if(D&&D.stopPropagation(),!i)return o("Please login to repost!","error");!W(e)||!W(i.id)||B.mutate()},t[81]=i,t[82]=e,t[83]=B,t[84]=o,t[85]=z):z=t[85];const V=z;let J;return t[86]!==H||t[87]!==V||t[88]!==F||t[89]!==k||t[90]!==h?(J={liked:F,reposted:k,localStats:h,setLocalStats:l,handleLike:H,handleRepost:V},t[86]=H,t[87]=V,t[88]=F,t[89]=k,t[90]=h,t[91]=J):J=t[91],J};var Ee=Y();const rt=e=>{const s=(0,Ee.c)(5);let i;s[0]!==e?(i=()=>ae(e),s[0]=e,s[1]=i):i=s[1];const[o,t]=(0,_.useState)(i);let a,n;return s[2]!==e?(a=()=>{if(!e)return;const h=setTimeout(()=>{t(ae(e))},0),l=setInterval(()=>{t(ae(e))},6e4);return()=>{clearTimeout(h),clearInterval(l)}},n=[e],s[2]=e,s[3]=a,s[4]=n):(a=s[3],n=s[4]),(0,_.useEffect)(a,n),o},lt=()=>{const{handle:e}=ie(),s=Z(),{currentUser:i,getProfileByHandle:o}=X(),{addToast:t}=ee(),{data:a,isLoading:n}=I({queryKey:["profile",e],queryFn:()=>o(e),enabled:!!e,staleTime:1e3*60*5}),[h,l]=(0,_.useState)("feed"),{data:M,fetchNextPage:r,hasNextPage:m,isFetchingNextPage:y,isLoading:p}=U({queryKey:["posts","user",a?.id],queryFn:({pageParam:f})=>Pe(a?.id,f,10),enabled:!!a?.id,initialPageParam:null,getNextPageParam:f=>{if(!(!f||f.length<10))return f[f.length-1].sort_timestamp||f[f.length-1].created_at}}),u=(0,_.useMemo)(()=>M?.pages.flatMap(f=>f)||[],[M]),[g,S]=(0,_.useState)(!1),[F,P]=(0,_.useState)("Followers"),[w,C]=(0,_.useState)([]),[b,d]=(0,_.useState)(!1),[v,k]=(0,_.useState)(!1),[$,q]=(0,_.useState)(!0),c=async(f,T=!1)=>{const K=a?.id;if(K){T?k(!0):(P(f),S(!0),d(!0),C([]));try{const A=T&&w.length>0?w[w.length-1].followed_at:null,O=f==="Followers"?await Se(K,A,10):await Le(K,A,10);O.length<10?q(!1):q(!0),C(T?B=>[...B,...O]:O)}catch(A){console.error(`Failed to fetch ${f}:`,A),t(`Failed to load ${f}`)}finally{d(!1),k(!1)}}},R=(0,_.useMemo)(()=>h==="feed"?u.filter(f=>f.community_id===null&&f.parent_id===null):h==="media"?u.filter(f=>f.community_id===null&&f.parent_id===null&&(f.type==="video"||f.type==="image"||f.media&&f.media.length>0)):h==="collections"?[]:u,[u,h]);return{handle:e,profile:a,loading:n,userPosts:u,setUserPosts:()=>console.warn("setUserPosts is deprecated"),activeProfileTab:h,setActiveProfileTab:l,loadingPosts:p,isFetchingMorePosts:y,hasMorePosts:m,filteredPosts:R,isFollowModalOpen:g,setIsFollowModalOpen:S,followModalType:F,followListData:w,isListLoading:b,isFetchingMoreFollows:v,hasMoreFollows:$,openFollowModal:c,handlePostClick:f=>{s(`/post/${f}`)},handleUserClick:f=>{f!==e&&s(`/u/${f}`)},loadUserPosts:(f=!1)=>{r()},currentUser:i,addToast:t,navigate:s}};var Ke=Y();const ct=()=>{const e=(0,Ke.c)(74),{handle:s}=ie(),i=Z(),{currentUser:o}=X(),{addToast:t}=ee(),a=oe();let n,h;e[0]!==s?(n=["community",s],h=()=>Me(s),e[0]=s,e[1]=n,e[2]=h):(n=e[1],h=e[2]);const l=!!s;let M;e[3]!==n||e[4]!==h||e[5]!==l?(M={queryKey:n,queryFn:h,enabled:l,staleTime:6e5},e[3]=n,e[4]=h,e[5]=l,e[6]=M):M=e[6];const{data:r,isLoading:m}=I(M),y=r?.id,p=o?.id;let u;e[7]!==y||e[8]!==p?(u=["community",y,"membership",p],e[7]=y,e[8]=p,e[9]=u):u=e[9];let g;e[10]!==r?.id||e[11]!==o?.id?(g=()=>_e(r?.id,o?.id),e[10]=r?.id,e[11]=o?.id,e[12]=g):g=e[12];const S=!!r?.id&&!!o?.id;let F;e[13]!==u||e[14]!==g||e[15]!==S?(F={queryKey:u,queryFn:g,enabled:S,staleTime:3e5},e[13]=u,e[14]=g,e[15]=S,e[16]=F):F=e[16];const{data:P}=I(F),w=!!P,C=P?.role||null,b=r?.id;let d;e[17]!==b?(d=["posts","community",b],e[17]=b,e[18]=d):d=e[18];let v;e[19]!==r?.id?(v=D=>{const{pageParam:N}=D;return fe(r?.id,N,10)},e[19]=r?.id,e[20]=v):v=e[20];const k=!!r?.id;let $;e[21]!==d||e[22]!==v||e[23]!==k?($={queryKey:d,queryFn:v,enabled:k,initialPageParam:null,getNextPageParam:Ae},e[21]=d,e[22]=v,e[23]=k,e[24]=$):$=e[24];const{data:q,fetchNextPage:c,hasNextPage:R,isFetchingNextPage:x,isLoading:E}=U($);let L;e[25]!==q?.pages?(L=q?.pages.flatMap(Oe)||[],e[25]=q?.pages,e[26]=L):L=e[26];const f=L;let T;e[27]!==r?.id||e[28]!==o?.id?(T=()=>Re(r?.id,o?.id),e[27]=r?.id,e[28]=o?.id,e[29]=T):T=e[29];let K;e[30]!==r?.id||e[31]!==o?.id||e[32]!==s||e[33]!==a?(K=async()=>{await a.cancelQueries({queryKey:["community",r?.id,"membership",o?.id]}),await a.cancelQueries({queryKey:["community",s]});const D=a.getQueryData(["community",r?.id,"membership",o?.id]),N=a.getQueryData(["community",s]);return a.setQueryData(["community",r?.id,"membership",o?.id],D?null:{role:"member"}),a.setQueryData(["community",s],Q=>Q&&{...Q,membersCount:D?Q.membersCount-1:Q.membersCount+1}),{previousMembership:D,previousCommunity:N}},e[30]=r?.id,e[31]=o?.id,e[32]=s,e[33]=a,e[34]=K):K=e[34];let A;e[35]!==t||e[36]!==r?.id||e[37]!==o?.id||e[38]!==s||e[39]!==a?(A=(D,N,Q)=>{Q?.previousMembership!==void 0&&a.setQueryData(["community",r?.id,"membership",o?.id],Q.previousMembership),Q?.previousCommunity&&a.setQueryData(["community",s],Q.previousCommunity),t("Failed to update membership","error")},e[35]=t,e[36]=r?.id,e[37]=o?.id,e[38]=s,e[39]=a,e[40]=A):A=e[40];let O;e[41]!==r?.id||e[42]!==o?.id||e[43]!==s||e[44]!==a?(O=()=>{a.invalidateQueries({queryKey:["community",r?.id,"membership",o?.id]}),a.invalidateQueries({queryKey:["community",s]})},e[41]=r?.id,e[42]=o?.id,e[43]=s,e[44]=a,e[45]=O):O=e[45];let B;e[46]!==t||e[47]!==r?(B=D=>{r&&t(D?`Joined ${r.name}`:`Left ${r.name}`)},e[46]=t,e[47]=r,e[48]=B):B=e[48];let j;e[49]!==T||e[50]!==K||e[51]!==A||e[52]!==O||e[53]!==B?(j={mutationFn:T,onMutate:K,onError:A,onSettled:O,onSuccess:B},e[49]=T,e[50]=K,e[51]=A,e[52]=O,e[53]=B,e[54]=j):j=e[54];const H=te(j);let z;e[55]!==t||e[56]!==o||e[57]!==H?(z=async()=>{if(!o)return t("Please login to join communities","error");H.mutate()},e[55]=t,e[56]=o,e[57]=H,e[58]=z):z=e[58];const V=z;let J;return e[59]!==t||e[60]!==r||e[61]!==f||e[62]!==o||e[63]!==c||e[64]!==V||e[65]!==R||e[66]!==x||e[67]!==w||e[68]!==H.isPending||e[69]!==m||e[70]!==E||e[71]!==i||e[72]!==C?(J={community:r,loading:m,isMember:w,userRole:C,isJoining:H.isPending,communityPosts:f,loadingPosts:E,isFetchingMorePosts:x,hasMorePosts:R,handleJoinToggle:V,loadCommunityPosts:c,currentUser:o,addToast:t,navigate:i},e[59]=t,e[60]=r,e[61]=f,e[62]=o,e[63]=c,e[64]=V,e[65]=R,e[66]=x,e[67]=w,e[68]=H.isPending,e[69]=m,e[70]=E,e[71]=i,e[72]=C,e[73]=J):J=e[73],J};function Ae(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function Oe(e){return e}const ut=()=>{const{currentUser:e}=X(),s=Z(),i=ce(),o=new URLSearchParams(i.search),t=o.get("q")||"",a=o.get("tab")||(t?"posts":"communities"),[n,h]=(0,_.useState)(t),[l,M]=(0,_.useState)(a),[r,m]=(0,_.useState)(!1);(0,_.useEffect)(()=>{t!==n&&(h(t),t&&M("posts"))},[t]);const{data:y,fetchNextPage:p,hasNextPage:u,isFetchingNextPage:g,isLoading:S}=U({queryKey:["explore","communities"],queryFn:({pageParam:c})=>Qe(c,10),initialPageParam:null,getNextPageParam:c=>{if(!(!c||c.length<10))return c[c.length-1].createdAt}}),F=(0,_.useMemo)(()=>y?.pages.flatMap(c=>c)||[],[y]),{data:P,fetchNextPage:w,hasNextPage:C,isFetchingNextPage:b,isLoading:d}=U({queryKey:["explore","posts",n],queryFn:({pageParam:c})=>n?xe(n,c,10,!0):he(c,10),initialPageParam:null,getNextPageParam:c=>{if(!(!c||c.length<10))return c[c.length-1].sort_timestamp||c[c.length-1].sortTimestamp}}),v=(0,_.useMemo)(()=>P?.pages.flatMap(c=>c)||[],[P]),k=(0,_.useMemo)(()=>{let c=F;return n&&(c=c.filter(R=>R.name?.toLowerCase().includes(n.toLowerCase())||R.handle?.toLowerCase().includes(n.toLowerCase()))),c},[F,n]);return{currentUser:e,searchQuery:n,setSearchQuery:c=>{h(c)},activeTab:l,setActiveTab:M,isCreateModalOpen:r,setIsCreateModalOpen:m,communitiesData:F,isCommunitiesLoading:S,isFetchingMoreCommunities:g,hasMoreCommunities:u,postsData:v,isPostsLoading:d,isFetchingMorePosts:b,hasMorePosts:C,filteredCommunities:k,handleCommunityClick:c=>{s(`/c/${c}`)},loadCommunities:p,loadPosts:w,navigate:s}};var Be=Y();const dt=()=>{const e=(0,Be.c)(21),{currentUser:s}=X(),{posts:i,loading:o,hasMore:t,isFetchingNextPage:a,fetchNextPage:n}=Ne(),{addToast:h}=ee(),l=Z();let M;e[0]===Symbol.for("react.memo_cache_sentinel")?(M={queryKey:["stories"],queryFn:be},e[0]=M):M=e[0];const{data:r,isLoading:m}=I(M);let y;e[1]!==r?(y=r===void 0?[]:r,e[1]=r,e[2]=y):y=e[2];const p=y;let u;if(e[3]!==p){const d={};p.forEach(v=>{if(!v.user)return;const k=v.user.id;d[k]||(d[k]={user:v.user,stories:[]}),d[k].stories.push(v)}),u=Object.values(d),e[3]=p,e[4]=u}else u=e[4];const g=u,S=i;let F;e[5]!==l?(F=d=>{l(`/post/${d}`)},e[5]=l,e[6]=F):F=e[6];const P=F;let w;e[7]!==l?(w=d=>{l(`/u/${d}`)},e[7]=l,e[8]=w):w=e[8];const C=w;let b;return e[9]!==h||e[10]!==s||e[11]!==n||e[12]!==g||e[13]!==P||e[14]!==C||e[15]!==t||e[16]!==S||e[17]!==a||e[18]!==o||e[19]!==m?(b={currentUser:s,homePosts:S,groupedStories:g,isPostsLoading:o,isStoriesLoading:m,hasMore:t,isFetchingNextPage:a,fetchNextPage:n,addToast:h,handlePostClick:P,handleUserClick:C},e[9]=h,e[10]=s,e[11]=n,e[12]=g,e[13]=P,e[14]=C,e[15]=t,e[16]=S,e[17]=a,e[18]=o,e[19]=m,e[20]=b):b=e[20],b};var je=Y();const ft=()=>{const e=(0,je.c)(57),{id:s}=ie(),i=Z(),{currentUser:o}=X(),{onlineUsers:t}=ke(),a=oe(),[n,h]=(0,_.useState)("");let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=[],e[0]=l):l=e[0];const[M,r]=(0,_.useState)(l),{conversations:m,isConvLoading:y,sendMessage:p,sendTypingStatus:u,typingStatus:g,markAsRead:S,formatMessages:F,onToggleReaction:P,conversationReactions:w,messages:C,isMsgLoading:b,fetchNextMessages:d,hasMoreMessages:v,isFetchingMoreMessages:k}=De(o,s);let $;e:{if(!s||m.length===0){$=null;break e}let N;e[1]!==m||e[2]!==s?(N=m.find(Q=>Q.id===s)||null,e[1]=m,e[2]=s,e[3]=N):N=e[3],$=N}const q=$;let c,R;e[4]!==s||e[5]!==S?(c=()=>{s&&S(s)},R=[s,S],e[4]=s,e[5]=S,e[6]=c,e[7]=R):(c=e[6],R=e[7]),(0,_.useEffect)(c,R);let x;e[8]!==m||e[9]!==o?.id||e[10]!==n?(x=()=>{const N=setTimeout(async()=>{if(n.length>1){const Q=await ye(n),G=m.map(He);r(Q.filter(ne=>ne.id!==o?.id&&!G.includes(ne.id)))}else r([])},300);return()=>clearTimeout(N)},e[8]=m,e[9]=o?.id,e[10]=n,e[11]=x):x=e[11];const E=o?.id;let L;e[12]!==m||e[13]!==n||e[14]!==E?(L=[n,m,E],e[12]=m,e[13]=n,e[14]=E,e[15]=L):L=e[15],(0,_.useEffect)(x,L);let f;e[16]!==o||e[17]!==i||e[18]!==a?(f=async N=>{if(o)try{const Q=await $e(o.id,N.id);a.invalidateQueries({queryKey:["conversations",o.id]}),h(""),i(`/messages/${Q}`)}catch(Q){console.error("Failed to start conversation:",Q)}},e[16]=o,e[17]=i,e[18]=a,e[19]=f):f=e[19];const T=f;let K;e[20]!==i?(K=N=>{i(`/messages/${N.id}`)},e[20]=i,e[21]=K):K=e[21];const A=K;let O;e[22]!==w||e[23]!==F||e[24]!==C?(O=F(C,w),e[22]=w,e[23]=F,e[24]=C,e[25]=O):O=e[25];const B=O;let j;if(e[26]!==m||e[27]!==n){let N;e[29]!==n?(N=Q=>Q.user?.name?.toLowerCase().includes(n.toLowerCase())||Q.user?.handle?.toLowerCase().includes(n.toLowerCase())||Q.lastMessage?.toLowerCase().includes(n.toLowerCase()),e[29]=n,e[30]=N):N=e[30],j=m.filter(N),e[26]=m,e[27]=n,e[28]=j}else j=e[28];const H=j,z=q&&g[q.id];let V;e[31]!==t||e[32]!==q?(V=q&&q.user?.id&&t.has(q.user.id),e[31]=t,e[32]=q,e[33]=V):V=e[33];const J=V;let D;return e[34]!==m||e[35]!==z||e[36]!==o||e[37]!==d||e[38]!==H||e[39]!==A||e[40]!==T||e[41]!==v||e[42]!==s||e[43]!==y||e[44]!==k||e[45]!==b||e[46]!==B||e[47]!==n||e[48]!==i||e[49]!==P||e[50]!==t||e[51]!==J||e[52]!==q||e[53]!==p||e[54]!==u||e[55]!==M?(D={id:s,currentUser:o,onlineUsers:t,msgSearchQuery:n,setMsgSearchQuery:h,userSearchResults:M,conversations:m,filteredConversations:H,selectedConversation:q,localMessages:B,isConvLoading:y,isMsgLoading:b,currentIsTyping:z,otherUserIsOnline:J,handleStartConversation:T,handleSelectConversation:A,sendMessage:p,sendTypingStatus:u,onToggleReaction:P,navigate:i,fetchNextMessages:d,hasMoreMessages:v,isFetchingMoreMessages:k},e[34]=m,e[35]=z,e[36]=o,e[37]=d,e[38]=H,e[39]=A,e[40]=T,e[41]=v,e[42]=s,e[43]=y,e[44]=k,e[45]=b,e[46]=B,e[47]=n,e[48]=i,e[49]=P,e[50]=t,e[51]=J,e[52]=q,e[53]=p,e[54]=u,e[55]=M,e[56]=D):D=e[56],D};function He(e){return e.user?.id}var ze=Y();const mt=()=>{const e=(0,ze.c)(47),{currentUser:s}=X(),i=Z(),o=oe(),t=s?.id;let a;e[0]!==t?(a=["notifications",t],e[0]=t,e[1]=a):a=e[1];let n;e[2]!==s?.id?(n=L=>{const{pageParam:f}=L;return ge(s?.id,f,10)},e[2]=s?.id,e[3]=n):n=e[3];const h=!!s?.id;let l;e[4]!==a||e[5]!==n||e[6]!==h?(l={queryKey:a,queryFn:n,enabled:h,initialPageParam:null,getNextPageParam:Je},e[4]=a,e[5]=n,e[6]=h,e[7]=l):l=e[7];const{data:M,fetchNextPage:r,hasNextPage:m,isFetchingNextPage:y,isLoading:p}=U(l);let u;e[8]!==M?.pages?(u=M?.pages.flatMap(Ve)||[],e[8]=M?.pages,e[9]=u):u=e[9];const g=u;let S;e[10]!==s||e[11]!==o?(S=()=>{if(!s?.id)return;const L=se.channel(`user_notifications:${s.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${s.id}`},()=>{o.invalidateQueries({queryKey:["notifications",s.id]})}).subscribe();return()=>{se.removeChannel(L)}},e[10]=s,e[11]=o,e[12]=S):S=e[12];const F=s?.id;let P;e[13]!==o||e[14]!==F?(P=[F,o],e[13]=o,e[14]=F,e[15]=P):P=e[15],(0,_.useEffect)(S,P);let w;e[16]!==s?(w=()=>s?me(s.id):Promise.resolve(),e[16]=s,e[17]=w):w=e[17];let C,b,d;e[18]!==s?.id||e[19]!==o?(C=async()=>{await o.cancelQueries({queryKey:["notifications",s?.id]});const L=o.getQueryData(["notifications",s?.id]);return o.setQueryData(["notifications",s?.id],Ye),{previousNotifications:L}},b=(L,f,T)=>{T?.previousNotifications&&o.setQueryData(["notifications",s?.id],T.previousNotifications)},d=()=>{o.invalidateQueries({queryKey:["notifications",s?.id]})},e[18]=s?.id,e[19]=o,e[20]=C,e[21]=b,e[22]=d):(C=e[20],b=e[21],d=e[22]);let v;e[23]!==C||e[24]!==b||e[25]!==d||e[26]!==w?(v={mutationFn:w,onMutate:C,onError:b,onSettled:d},e[23]=C,e[24]=b,e[25]=d,e[26]=w,e[27]=v):v=e[27];const k=te(v);let $;e[28]!==i?($=L=>{L.type==="follow"?i(`/u/${L.user}`):L.post_id&&i(`/post/${L.post_id}`)},e[28]=i,e[29]=$):$=e[29];const q=$;let c;e[30]!==s?.id||e[31]!==k||e[32]!==g?(c=()=>{s?.id&&g.some(Ze)&&k.mutate()},e[30]=s?.id,e[31]=k,e[32]=g,e[33]=c):c=e[33];const R=s?.id;let x;e[34]!==k||e[35]!==g.length||e[36]!==R?(x=[R,g.length,k],e[34]=k,e[35]=g.length,e[36]=R,e[37]=x):x=e[37],(0,_.useEffect)(c,x);let E;return e[38]!==s||e[39]!==r||e[40]!==q||e[41]!==m||e[42]!==y||e[43]!==p||e[44]!==i||e[45]!==g?(E={currentUser:s,notifications:g,isLoading:p,isFetchingMore:y,hasMore:m,loadNotifications:r,handleNotificationClick:q,navigate:i},e[38]=s,e[39]=r,e[40]=q,e[41]=m,e[42]=y,e[43]=p,e[44]=i,e[45]=g,e[46]=E):E=e[46],E};function Je(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Ve(e){return e}function Ge(e){return{...e,is_read:!0}}function We(e){return e.map(Ge)}function Ye(e){return e&&{...e,pages:e.pages.map(We)}}function Ze(e){return!e.is_read}var Xe=Y();const gt=()=>{const e=(0,Xe.c)(20),{id:s}=ie(),i=Z(),{currentUser:o}=X(),{addToast:t}=ee();let a,n;e[0]!==s?(a=["post",s],n=async()=>{if(!s||!W(s))throw new Error("Invalid post ID");return pe(s)},e[0]=s,e[1]=a,e[2]=n):(a=e[1],n=e[2]);const h=!!s;let l;e[3]!==a||e[4]!==n||e[5]!==h?(l={queryKey:a,queryFn:n,enabled:h,retry:!1},e[3]=a,e[4]=n,e[5]=h,e[6]=l):l=e[6];const{data:M,isLoading:r,isError:m}=I(l);let y;e[7]!==i?(y=F=>{i(`/u/${F}`)},e[7]=i,e[8]=y):y=e[8];const p=y;let u;e[9]!==i?(u=()=>{i(-1)},e[9]=i,e[10]=u):u=e[10];const g=u;let S;return e[11]!==t||e[12]!==o||e[13]!==g||e[14]!==p||e[15]!==m||e[16]!==r||e[17]!==i||e[18]!==M?(S={post:M,isLoading:r,isError:m,currentUser:o,addToast:t,navigate:i,handleUserClick:p,handleDelete:g},e[11]=t,e[12]=o,e[13]=g,e[14]=p,e[15]=m,e[16]=r,e[17]=i,e[18]=M,e[19]=S):S=e[19],S};var Ie=Y();const ht=()=>{const e=(0,Ie.c)(31),s=Z(),[i]=ue();let o;e[0]!==i?(o=i.get("id"),e[0]=i,e[1]=o):o=e[1];const t=o,a=(0,_.useRef)(null),[n,h]=(0,_.useState)(null),[l,M]=(0,_.useState)(!0);let r;e[2]===Symbol.for("react.memo_cache_sentinel")?(r=["reels"],e[2]=r):r=e[2];let m;e[3]===Symbol.for("react.memo_cache_sentinel")?(m={queryKey:r,queryFn:Ue,initialPageParam:null,getNextPageParam:et},e[3]=m):m=e[3];const{data:y,fetchNextPage:p,hasNextPage:u,isFetchingNextPage:g,isLoading:S}=U(m);let F;e[4]!==y?.pages?(F=y?.pages.flatMap(tt)||[],e[4]=y?.pages,e[5]=F):F=e[5];const P=F;let w,C;e[6]!==n||e[7]!==P||e[8]!==t?(w=()=>{P.length>0&&(t&&P.find(R=>R.id===t)?(h(t),setTimeout(()=>{document.querySelector(`[data-id="${t}"]`)?.scrollIntoView({behavior:"instant"})},100)):n||h(P[0].id))},C=[P,t,n],e[6]=n,e[7]=P,e[8]=t,e[9]=w,e[10]=C):(w=e[9],C=e[10]),(0,_.useEffect)(w,C);let b,d;e[11]!==P.length?(b=()=>{if(P.length===0)return;const R={root:a.current,threshold:.6},x=L=>{L.forEach(f=>{f.isIntersecting&&h(f.target.dataset.id)})},E=new IntersectionObserver(x,R);return setTimeout(()=>{document.querySelectorAll(".reel-item").forEach(L=>E.observe(L))},100),()=>E.disconnect()},d=[P.length],e[11]=P.length,e[12]=b,e[13]=d):(b=e[12],d=e[13]),(0,_.useEffect)(b,d);let v;e[14]!==l?(v=()=>{M(!l)},e[14]=l,e[15]=v):v=e[15];const k=v;let $,q;e[16]!==p||e[17]!==u||e[18]!==g?(q=()=>{const R=()=>{if(!a.current||g||!u)return;const{scrollTop:E,scrollHeight:L,clientHeight:f}=a.current;E+f>=L-800&&p()},x=a.current;if(x)return x.addEventListener("scroll",R),()=>x.removeEventListener("scroll",R)},$=[g,u,p],e[16]=p,e[17]=u,e[18]=g,e[19]=$,e[20]=q):($=e[19],q=e[20]),(0,_.useEffect)(q,$);let c;return e[21]!==n||e[22]!==p||e[23]!==u||e[24]!==g||e[25]!==S||e[26]!==l||e[27]!==s||e[28]!==P||e[29]!==k?(c={reels:P,loading:S,loadingMore:g,activeReelId:n,hasMore:u,isMuted:l,containerRef:a,navigate:s,toggleMute:k,loadReels:p},e[21]=n,e[22]=p,e[23]=u,e[24]=g,e[25]=S,e[26]=l,e[27]=s,e[28]=P,e[29]=k,e[30]=c):c=e[30],c};function Ue(e){const{pageParam:s}=e;return Ce(s,10)}function et(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function tt(e){return e}const yt=()=>{const{currentUser:e,logout:s}=X(),{darkMode:i,toggleDarkMode:o,fontSize:t,setFontSize:a,dataSaver:n,setDataSaver:h}=qe(),{addToast:l}=ee(),[M,r]=(0,_.useState)(!1),[m,y]=(0,_.useState)({newPassword:"",confirmPassword:""}),[p,u]=(0,_.useState)(!1),g=async()=>{try{await s(),l("Logged out successfully")}catch(d){console.error("Logout error:",d),l("Failed to logout")}};return{currentUser:e,darkMode:i,toggleDarkMode:o,fontSize:t,setFontSize:a,dataSaver:n,setDataSaver:h,isChangingPassword:M,setIsChangingPassword:r,passwordData:m,setPasswordData:y,loading:p,handleLogout:g,handlePasswordChange:async d=>{if(d.preventDefault(),m.newPassword!==m.confirmPassword){l("Passwords do not match","error");return}if(m.newPassword.length<6){l("Password must be at least 6 characters","error");return}u(!0);try{const{error:v}=await se.auth.updateUser({password:m.newPassword});if(v)throw v;l("Password updated successfully!"),r(!1),y({newPassword:"",confirmPassword:""})}catch(v){console.error("Password update error:",v),l(v.message||"Failed to update password","error")}finally{u(!1)}},handlePasswordReset:async()=>{if(e?.email){u(!0);try{const{error:d}=await se.auth.resetPasswordForEmail(e.email,{redirectTo:`${window.location.origin}/settings?type=recovery`});if(d)throw d;l("Password reset email sent!")}catch(d){console.error("Reset password error:",d),l(d.message||"Failed to send reset email","error")}finally{u(!1)}}},handleClearCache:()=>{["seenStories","font-size","data-saver","theme"].forEach(d=>localStorage.removeItem(d)),l("Cache cleared! Reloading..."),setTimeout(()=>window.location.reload(),1500)},handleDownloadData:async()=>{if(e){u(!0);try{const d={user:{id:e.id,handle:e.handle,name:e.name,email:e.email},exportDate:new Date().toISOString(),note:"This is a mock export of your Sysm data."},v=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),k=URL.createObjectURL(v),$=document.createElement("a");$.href=k,$.download=`sysm-data-${e.handle}.json`,$.click(),URL.revokeObjectURL(k),l("Data export started!")}catch{l("Failed to export data","error")}finally{u(!1)}}},handleDeleteAccount:()=>{window.confirm("Are you absolutely sure? This will permanently delete your account and all associated data. This action is irreversible.")&&(l("Account deletion request submitted. Logging out..."),setTimeout(g,2e3))},handleReportBug:()=>{window.prompt("Please describe the bug you found:")&&l("Bug reported! Thank you for your feedback.")}}};export{ft as a,ct as c,nt as d,mt as i,lt as l,ht as n,dt as o,gt as r,ut as s,yt as t,rt as u};
