import{a as rt}from"./rolldown-runtime-BaZ8gS7u.js";import{T as wt,f as Ct,s as V,u as St,y as ye}from"./framework-DIDnLsp9.js";import{r as _t}from"./query-DNidMcz3.js";import{Cn as Ve,Dn as Ft,Hn as $t,Ht as Pt,In as It,Nn as Mt,On as Rt,Pn as At,Pt as je,Qt as Et,Tn as Be,Vt as Dt,Wt as Lt,Xt as Ot,an as Wt,cn as Tt,dn as lt,fn as Ut,gn as Vt,hn as X,in as Bt,jn as ze,kn as Ht,nn as qt,on as Gt,rn as Jt,t as ot,tn as ve,un as Qt,wn as Kt,xn as xe,yn as Xt}from"./ui-libs-NviTY6uf.js";import{$ as J,At as ct,G as Yt,Gt as Zt,H as es,K as ts,Kt as ue,Nt as dt,Ot as ss,R as mt,U as He,Ut as as,V as is,Vt as ns,W as se,Wt as rs,Yt as ls,_t as xt,a as ut,at as qe,c as os,ct as Ge,dt as cs,et as Q,ft as ds,g as ms,ht as xs,it as Je,jt as us,kt as hs,l as ps,lt as Qe,m as Ke,mt as ht,nt as Xe,o as Ye,ot as Ze,p as Ne,pt as fs,qt as me,rt as et,st as tt,tt as K,ut as gs,vt as ke,yt as bs,zt as st}from"./index-B0vM2eEQ.js";import{n as we,t as Ce}from"./linkify-DSSf-wBZ.js";import{d as vs}from"./hooks-C5icFmhq.js";var js=V(),r=rt(wt(),1),t=rt(St(),1),zs=s=>{const e=(0,js.c)(21),{icon:a,count:l,label:n,onClick:c,active:i,activeColorClass:d}=s,f=d===void 0?"text-violet-600":d;let b;e[0]!==c?(b=S=>{S.stopPropagation(),c&&c(S)},e[0]=c,e[1]=b):b=e[1];const v=`${n} ${l!==void 0?`(${l})`:""}`,g=`group -ml-2 flex items-center gap-x-1 rounded-xl px-2 py-1.5 text-[12px] font-bold transition-all active:scale-95 sm:gap-x-1.5 sm:text-[13px] ${i?f:"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"}`,o=`rounded-full p-2 transition-colors ${i?"":"group-hover:bg-zinc-100 dark:group-hover:bg-zinc-800"}`,h=i?2.5:2,x=i?"fill-current":"";let m;e[2]!==a||e[3]!==h||e[4]!==x?(m=(0,t.jsx)(a,{size:18,strokeWidth:h,className:x}),e[2]=a,e[3]=h,e[4]=x,e[5]=m):m=e[5];let N;e[6]!==o||e[7]!==m?(N=(0,t.jsx)("div",{className:o,children:m}),e[6]=o,e[7]=m,e[8]=N):N=e[8];let y;e[9]!==n?(y=n&&(0,t.jsx)("span",{className:"hidden xs:inline",children:n}),e[9]=n,e[10]=y):y=e[10];let w;e[11]!==i||e[12]!==l?(w=l!=null&&(0,t.jsx)("span",{className:i?"font-bold":"",children:l||0}),e[11]=i,e[12]=l,e[13]=w):w=e[13];let j;return e[14]!==y||e[15]!==w||e[16]!==b||e[17]!==v||e[18]!==g||e[19]!==N?(j=(0,t.jsxs)("button",{onClick:b,"aria-label":v,className:g,children:[N,y,w]}),e[14]=y,e[15]=w,e[16]=b,e[17]=v,e[18]=g,e[19]=N,e[20]=j):j=e[20],j},B=zs,Ns=V(),ks=s=>{const e=(0,Ns.c)(51),{currentUser:a,newComment:l,setNewComment:n,handleSubmitComment:c,loading:i,selectedFiles:d,setSelectedFiles:f,isUploading:b}=s;let v;e[0]!==d?(v=d===void 0?[]:d,e[0]=d,e[1]=v):v=e[1];const g=v,o=(0,r.useRef)(null);let h;e[2]!==f?(h=z=>{if(z.target.files){const $=Array.from(z.target.files);f&&f(T=>[...T,...$])}},e[2]=f,e[3]=h):h=e[3];const x=h;let m;e[4]!==f?(m=z=>{f&&f($=>$.filter((T,H)=>H!==z))},e[4]=f,e[5]=m):m=e[5];const N=m;if(!a){let z;return e[6]===Symbol.for("react.memo_cache_sentinel")?(z=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-6 text-center dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"Please login to join the conversation."})}),e[6]=z):z=e[6],z}let y;e[7]!==a.avatar||e[8]!==a.handle?(y=(0,t.jsx)(K,{src:a.avatar,alt:a.handle,className:"object-cover"}),e[7]=a.avatar,e[8]=a.handle,e[9]=y):y=e[9];let w;e[10]!==a.handle?.[0]?(w=a.handle?.[0]?.toUpperCase(),e[10]=a.handle?.[0],e[11]=w):w=e[11];let j;e[12]!==w?(j=(0,t.jsx)(Q,{children:w}),e[12]=w,e[13]=j):j=e[13];let S;e[14]!==y||e[15]!==j?(S=(0,t.jsxs)(J,{className:"size-9 border border-zinc-200 dark:border-zinc-700",children:[y,j]}),e[14]=y,e[15]=j,e[16]=S):S=e[16];let P;e[17]!==n?(P=z=>n(z.target.value),e[17]=n,e[18]=P):P=e[18];let u;e[19]!==l||e[20]!==P?(u=(0,t.jsx)("textarea",{id:"comment-input",className:"min-h-[60px] w-full resize-none bg-transparent text-base outline-none placeholder:text-zinc-500 dark:text-white",placeholder:"Post your reply...",value:l,onChange:P}),e[19]=l,e[20]=P,e[21]=u):u=e[21];let F;e[22]!==N||e[23]!==g?(F=g.length>0&&(0,t.jsx)("div",{className:"mt-2 mb-2 flex flex-wrap gap-2",children:g.map((z,$)=>(0,t.jsxs)("div",{className:"relative size-20 overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[z.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(z),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)(Gt,{size:20,className:"text-zinc-500"})}),(0,t.jsx)("button",{onClick:()=>N($),className:"absolute right-1 top-1 rounded-full bg-black/60 p-1 text-white transition-colors hover:bg-black",children:(0,t.jsx)(je,{size:12})})]},$))}),e[22]=N,e[23]=g,e[24]=F):F=e[24];let M;e[25]===Symbol.for("react.memo_cache_sentinel")?(M=()=>o.current?.click(),e[25]=M):M=e[25];let I;e[26]===Symbol.for("react.memo_cache_sentinel")?(I=(0,t.jsx)("button",{type:"button",onClick:M,className:"rounded-full p-2 text-violet-600 transition-colors hover:bg-violet-50 dark:hover:bg-zinc-800",title:"Attach media",children:(0,t.jsx)(Xt,{size:20})}),e[26]=I):I=e[26];let A;e[27]!==x?(A=(0,t.jsxs)("div",{className:"flex gap-1 text-violet-600",children:[I,(0,t.jsx)("input",{type:"file",ref:o,onChange:x,multiple:!0,className:"hidden",accept:"image/*,video/*,application/pdf"})]}),e[27]=x,e[28]=A):A=e[28];let E;e[29]!==b||e[30]!==i||e[31]!==l||e[32]!==g.length?(E=!l.trim()&&g.length===0||i||b,e[29]=b,e[30]=i,e[31]=l,e[32]=g.length,e[33]=E):E=e[33];let W;e[34]!==b||e[35]!==i?(W=i||b?(0,t.jsx)(X,{size:16,className:"mx-auto animate-spin text-white"}):"Reply",e[34]=b,e[35]=i,e[36]=W):W=e[36];let D;e[37]!==c||e[38]!==E||e[39]!==W?(D=(0,t.jsx)(cs,{className:"min-w-[70px] !w-auto px-5 py-1.5 text-sm font-bold",onClick:c,disabled:E,children:W}),e[37]=c,e[38]=E,e[39]=W,e[40]=D):D=e[40];let L;e[41]!==A||e[42]!==D?(L=(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between border-t border-zinc-100 pt-3 dark:border-zinc-800",children:[A,D]}),e[41]=A,e[42]=D,e[43]=L):L=e[43];let O;e[44]!==u||e[45]!==F||e[46]!==L?(O=(0,t.jsxs)("div",{className:"flex-1",children:[u,F,L]}),e[44]=u,e[45]=F,e[46]=L,e[47]=O):O=e[47];let k;return e[48]!==O||e[49]!==S?(k=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-4 dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[S,O]})}),e[48]=O,e[49]=S,e[50]=k):k=e[50],k},pt=r.memo(ks),ys=V(),ws=s=>{const e=(0,ys.c)(15),{file:a}=s;let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=(0,t.jsx)("div",{className:"flex size-10 items-center justify-center rounded-xl bg-violet-100 text-violet-600 dark:bg-violet-900/30",children:(0,t.jsx)(Ft,{size:20})}),e[0]=l):l=e[0];let n;e[1]!==a.name?(n=(0,t.jsx)("div",{className:"truncate text-sm font-bold dark:text-white",children:a.name}),e[1]=a.name,e[2]=n):n=e[2];let c;e[3]!==a.size?(c=a.size!==void 0&&(0,t.jsxs)("div",{className:"text-xs uppercase text-zinc-500",children:[(a.size/1024/1024).toFixed(2)," MB"]}),e[3]=a.size,e[4]=c):c=e[4];let i;e[5]!==n||e[6]!==c?(i=(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[n,c]}),e[5]=n,e[6]=c,e[7]=i):i=e[7];let d;e[8]===Symbol.for("react.memo_cache_sentinel")?(d=(0,t.jsx)(Mt,{size:18}),e[8]=d):d=e[8];let f;e[9]!==a.name||e[10]!==a.url?(f=(0,t.jsx)("a",{href:a.url,download:a.name,className:"p-2 text-zinc-400 transition-colors hover:text-violet-600",onClick:Ss,children:d}),e[9]=a.name,e[10]=a.url,e[11]=f):f=e[11];let b;return e[12]!==i||e[13]!==f?(b=(0,t.jsxs)("div",{className:"group mt-3 flex items-center gap-3 rounded-2xl border border-zinc-100 bg-zinc-50/50 p-3 transition-colors hover:border-violet-500/30 dark:border-zinc-800 dark:bg-zinc-900/10",children:[l,i,f]}),e[12]=i,e[13]=f,e[14]=b):b=e[14],b},Cs=ws;function Ss(s){return s.stopPropagation()}var da=V(),_s=V(),Fs=s=>{const e=(0,_s.c)(30),{url:a}=s;let l,n;e[0]!==a?(l=["link-preview",a],n=()=>bs(a),e[0]=a,e[1]=l,e[2]=n):(l=e[1],n=e[2]);const c=!!a;let i;e[3]!==l||e[4]!==n||e[5]!==c?(i={queryKey:l,queryFn:n,staleTime:864e5,enabled:c},e[3]=l,e[4]=n,e[5]=c,e[6]=i):i=e[6];const{data:d,isLoading:f,isError:b}=_t(i);if(f){let j;return e[7]===Symbol.for("react.memo_cache_sentinel")?(j=(0,t.jsx)("div",{className:"mt-3 flex h-24 animate-pulse items-center justify-center overflow-hidden rounded-2xl border border-zinc-100 bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-900/50",children:(0,t.jsx)(Ve,{className:"animate-spin text-zinc-300 dark:text-zinc-700",size:24})}),e[7]=j):j=e[7],j}if(b||!d||!d.title&&!d.image)return null;let v;e[8]!==d.image||e[9]!==d.title?(v=d.image&&(0,t.jsx)("div",{className:"aspect-[1.91/1] w-full overflow-hidden border-b border-zinc-100 bg-zinc-100 dark:border-zinc-800 dark:bg-zinc-900",children:(0,t.jsx)("img",{src:d.image,alt:d.title??void 0,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-[1.02]",onError:Ps})}),e[8]=d.image,e[9]=d.title,e[10]=v):v=e[10];let g;e[11]===Symbol.for("react.memo_cache_sentinel")?(g=(0,t.jsx)(Ve,{size:12}),e[11]=g):g=e[11];let o;e[12]!==d.siteName?(o=(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs font-bold uppercase tracking-wider text-zinc-600",children:[g,(0,t.jsx)("span",{children:d.siteName})]}),e[12]=d.siteName,e[13]=o):o=e[13];let h;e[14]!==d.title?(h=(0,t.jsx)("div",{className:"line-clamp-2 text-[15px] font-bold leading-snug transition-colors group-hover:text-violet-700 dark:text-white",children:d.title}),e[14]=d.title,e[15]=h):h=e[15];let x;e[16]!==d.description?(x=d.description&&(0,t.jsx)("p",{className:"line-clamp-2 text-xs leading-relaxed text-zinc-600 dark:text-zinc-400",children:d.description}),e[16]=d.description,e[17]=x):x=e[17];let m;e[18]===Symbol.for("react.memo_cache_sentinel")?(m=(0,t.jsx)(Ht,{size:10}),e[18]=m):m=e[18];let N;e[19]!==a?(N=(0,t.jsxs)("div",{className:"flex items-center gap-1 pt-1 text-[11px] font-medium text-zinc-500",children:[m,(0,t.jsx)("span",{className:"truncate",children:a})]}),e[19]=a,e[20]=N):N=e[20];let y;e[21]!==N||e[22]!==o||e[23]!==h||e[24]!==x?(y=(0,t.jsxs)("div",{className:"space-y-1 p-3.5",children:[o,h,x,N]}),e[21]=N,e[22]=o,e[23]=h,e[24]=x,e[25]=y):y=e[25];let w;return e[26]!==y||e[27]!==v||e[28]!==a?(w=(0,t.jsxs)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"group mt-3 flex flex-col overflow-hidden rounded-2xl border border-zinc-100 bg-white shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-900",onClick:$s,children:[v,y]}),e[26]=y,e[27]=v,e[28]=a,e[29]=w):w=e[29],w},at=Fs;function $s(s){return s.stopPropagation()}function Ps(s){return s.target.style.display="none"}var Is=V(),Ms=s=>{const e=(0,Is.c)(17),{src:a,poster:l}=s,n=(0,r.useRef)(null),{reportVisibility:c,unregister:i}=gs(),{dataSaver:d}=xs(),f=(0,r.useId)();let b;e[0]===Symbol.for("react.memo_cache_sentinel")?(b={play:()=>{const j=n.current?.plyr;j&&(j.muted=!0,j.play().catch(As))},pause:()=>{n.current?.plyr?.pause()}},e[0]=b):b=e[0];const v=b;let g,o;e[1]!==d||e[2]!==f||e[3]!==c||e[4]!==i?(g=()=>{const j=new IntersectionObserver(P=>{const[u]=P;c(f,d?0:u.intersectionRatio,v)},{threshold:[0,.6]}),S=n.current?.elements?.container;return S&&j.observe(S),()=>{i(f),S&&j.unobserve(S)}},o=[f,c,i,v,d],e[1]=d,e[2]=f,e[3]=c,e[4]=i,e[5]=g,e[6]=o):(g=e[5],o=e[6]),(0,r.useEffect)(g,o);let h;e[7]!==a?(h=[{src:a,type:"video/mp4"}],e[7]=a,e[8]=h):h=e[8];let x;e[9]!==l||e[10]!==h?(x={type:"video",sources:h,poster:l},e[9]=l,e[10]=h,e[11]=x):x=e[11];let m;e[12]===Symbol.for("react.memo_cache_sentinel")?(m={controls:["play-large","play","progress","current-time","mute","volume","fullscreen"],settings:["quality","speed"],ratio:"16:9",clickToPlay:!0,hideControls:!0,resetOnEnd:!0},e[12]=m):m=e[12];let N;e[13]!==x?(N={source:x,options:m},e[13]=x,e[14]=N):N=e[14];const y=N;let w;return e[15]!==y?(w=(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl border border-zinc-100 bg-black shadow-sm dark:border-zinc-800",onClick:Es,children:(0,t.jsx)(ot,{ref:n,...y})}),e[15]=y,e[16]=w):w=e[16],w},Rs=Ms;function As(){}function Es(s){return s.stopPropagation()}var Ds=V(),Ls=s=>{const e=(0,Ds.c)(3),{items:a}=s,l=a===void 0?[]:a,{openLightbox:n}=ds();if(!l||Array.isArray(l)&&l.length===0)return null;const c=Array.isArray(l)?l:[l],i=c.filter(Ws),d=c.filter(Ts),f=h=>{const x=i.filter(Us).map(Vs),m=i[h];n(x,x.indexOf(m.url||m.src))},b="mt-3 space-y-2",v=i.length>0&&(0,t.jsx)("div",{className:`grid gap-2 overflow-hidden rounded-2xl border border-zinc-100 dark:border-zinc-800 ${i.length===1?"grid-cols-1":i.length===2?"aspect-[16/9] grid-cols-2":(i.length===3,"aspect-[16/9] grid-cols-2 grid-rows-2")}`,children:i.map((h,x)=>(0,t.jsx)("div",{className:`relative cursor-pointer overflow-hidden bg-zinc-100 dark:bg-zinc-900 ${i.length===3&&x===0?"row-span-2":""}
                                `,onClick:m=>{h.type==="image"&&(m.stopPropagation(),f(x))},children:h.type==="video"?(0,t.jsx)(Rs,{src:h.url,poster:h.poster||void 0}):(0,t.jsx)("img",{src:h.url||h.src,className:"size-full object-cover transition-transform duration-500 hover:scale-[1.02]",alt:"",loading:"lazy"})},x))}),g=d.map(Bs);let o;return e[0]!==v||e[1]!==g?(o=(0,t.jsxs)("div",{className:b,children:[v,g]}),e[0]=v,e[1]=g,e[2]=o):o=e[2],o},Os=Ls;function Ws(s){return s.type==="image"||s.type==="video"}function Ts(s){return s.type==="file"}function Us(s){return s.type==="image"}function Vs(s){return s.url||s.src}function Bs(s,e){return(0,t.jsx)(Cs,{file:s},e)}var Hs=V(),qs=s=>{const e=(0,Hs.c)(18),{poll:a,onVote:l}=s,n=a.options.reduce(Gs,0),[c,i]=(0,r.useState)(null);let d;e[0]!==l||e[1]!==c?(d=x=>{c||(i(x),l&&l(x))},e[0]=l,e[1]=c,e[2]=d):d=e[2];const f=d;let b;if(e[3]!==f||e[4]!==a.options||e[5]!==n||e[6]!==c){let x;e[8]!==f||e[9]!==n||e[10]!==c?(x=(m,N)=>{const y=n>0?Math.round((m.votes+(c===m.id?1:0))/(n+(c?1:0))*100):0,w=c===m.id;return(0,t.jsxs)("div",{onClick:j=>{j.stopPropagation(),f(m.id)},className:`relative h-10 w-full overflow-hidden rounded-xl border cursor-pointer ${w?"border-violet-500 dark:border-violet-500":"border-zinc-200 dark:border-zinc-700"}`,children:[c&&(0,t.jsx)("div",{className:"absolute left-0 top-0 h-full bg-zinc-200 transition-all duration-500 dark:bg-zinc-800",style:{width:`${y}%`}}),(0,t.jsxs)("div",{className:"absolute inset-0 z-10 flex items-center justify-between px-4",children:[(0,t.jsxs)("span",{className:`text-sm font-medium ${w?"font-bold text-violet-600":"text-zinc-700 dark:text-zinc-200"}`,children:[m.text," ",w&&(0,t.jsx)(It,{size:14,className:"mb-0.5 inline ml-1"})]}),c&&(0,t.jsxs)("span",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:[y,"%"]})]})]},m.id||N)},e[8]=f,e[9]=n,e[10]=c,e[11]=x):x=e[11],b=a.options.map(x),e[3]=f,e[4]=a.options,e[5]=n,e[6]=c,e[7]=b}else b=e[7];const v=n+(c?1:0),g=c?"6 days left":"Click to vote";let o;e[12]!==v||e[13]!==g?(o=(0,t.jsxs)("div",{className:"pl-1 text-xs text-zinc-500 dark:text-zinc-400",children:[v," votes •"," ",g]}),e[12]=v,e[13]=g,e[14]=o):o=e[14];let h;return e[15]!==b||e[16]!==o?(h=(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[b,o]}),e[15]=b,e[16]=o,e[17]=h):h=e[17],h},it=qs;function Gs(s,e){return s+e.votes}var ft=({id:s,user:e,timeAgo:a,content:l,contentClass:n,media:c,quotedPost:i,stats:d,onClick:f,repostedBy:b,onUserClick:v,currentUser:g,showToast:o,poll:h,isDetail:x,initialComments:m,onDelete:N,isComment:y,onReply:w,community:j})=>{const S=ye(),{liked:P,reposted:u,localStats:F,setLocalStats:M,handleLike:I,handleRepost:A}=vs(s,d,g,o||(()=>{})),{deletePost:E,updatePost:W}=fs(),[D,L]=(0,r.useState)(m||[]),[O,k]=(0,r.useState)(""),[z,$]=(0,r.useState)(!1),[T,H]=(0,r.useState)(!1),[Y,Se]=(0,r.useState)(!1),[bt,_e]=(0,r.useState)(!0),[he,Fe]=(0,r.useState)([]),[vt,$e]=(0,r.useState)(!1),[Pe,ae]=(0,r.useState)(!1),[pe,ie]=(0,r.useState)(!1),[Z,Ie]=(0,r.useState)(l),[te,Me]=(0,r.useState)(c||[]),[ne,re]=(0,r.useState)([]),[Re,Ae]=(0,r.useState)(!1),[le,jt]=(0,r.useState)(!1),[zt,fe]=(0,r.useState)(!1),Ee=(0,r.useRef)(null),De=(0,r.useRef)(D);(0,r.useEffect)(()=>{De.current=D},[D]);const Nt=async()=>{const p=JSON.stringify(te)!==JSON.stringify(c||[])||ne.length>0;if(!Z.trim()||Z===l&&!p){ie(!1);return}Ae(!0);try{const C=[];for(const _ of ne){const R=await ke(_);C.push(R)}await W(s,{content:Z,media:[...te,...C]}),re([]),ie(!1),o&&o("Post updated")}catch(C){console.error("Failed to update post:",C),o&&o("Failed to update post")}finally{Ae(!1)}},Le=async p=>{p&&p.stopPropagation();try{await E(s),o&&o("Post deleted successfully"),N&&N(s)}catch(C){console.error("Failed to delete post:",C),o&&o("Failed to delete post")}finally{ae(!1)}},oe=(0,r.useCallback)(async(p=!1)=>{if(s){p?Se(!0):$(!0);try{const C=De.current,_=await dt(s,p&&C.length>0?C[C.length-1].created_at:null,10);_.length<10?_e(!1):_e(!0),L(p?R=>[...R,..._]:_)}catch(C){console.error("Failed to load comments:",C)}finally{$(!1),Se(!1)}}},[s]);(0,r.useEffect)(()=>{x&&s&&oe()},[x,s,oe]);const kt=async p=>{if(p.preventDefault(),!(!O.trim()&&he.length===0||!g)){H(!0),$e(!0);try{const C=[];for(const _ of he){const R=await ke(_);C.push(R)}await ct(s,g.id,O,C),k(""),Fe([]),M(_=>({..._,comments:(_.comments||0)+1})),o&&o("Reply posted!"),oe()}catch(C){console.error("Failed to post comment:",C),o&&o("Failed to post reply.")}finally{H(!1),$e(!1)}}},Oe=({trigger:p})=>(0,t.jsxs)(is,{children:[(0,t.jsx)(ts,{asChild:!0,onClick:C=>C.stopPropagation(),children:p}),(0,t.jsxs)(es,{align:"end",className:"w-48 rounded-xl border-zinc-100 bg-white dark:border-zinc-800 dark:bg-zinc-900",children:[(0,t.jsxs)(He,{children:[!y&&(0,t.jsxs)(se,{className:"cursor-pointer gap-2 py-2.5",onClick:C=>{C.stopPropagation(),navigator.clipboard.writeText(`${window.location.origin}/post/${s}`),o&&o("Link copied")},children:[(0,t.jsx)(Ot,{size:16}),(0,t.jsx)("span",{children:"Copy link"})]}),!y&&(0,t.jsxs)(se,{className:"cursor-pointer gap-2 py-2.5",onClick:C=>{C.stopPropagation(),o&&o("Post reported")},children:[(0,t.jsx)(Kt,{size:16}),(0,t.jsx)("span",{children:"Report post"})]}),!ge&&(0,t.jsxs)(se,{className:"cursor-pointer gap-2 py-2.5",onClick:C=>{C.stopPropagation(),o&&o("User blocked")},children:[(0,t.jsx)(Dt,{size:16}),(0,t.jsxs)("span",{children:["Block @",e.handle]})]}),ge&&(0,t.jsxs)(se,{onClick:C=>{C.stopPropagation(),ie(!0)},className:"cursor-pointer gap-2 py-2.5",children:[(0,t.jsx)(Bt,{size:16}),"Edit Post"]})]}),ge&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Yt,{}),(0,t.jsx)(He,{children:(0,t.jsxs)(se,{variant:"destructive",className:"cursor-pointer gap-2 py-2.5",onClick:C=>{C.stopPropagation(),ae(!0)},children:[(0,t.jsx)(Lt,{size:16}),(0,t.jsx)("span",{children:"Delete post"})]})})]})]})]}),ge=g?.handle===e.handle,We=p=>{if(!p)return null;const C=pe?te:p;return!C||Array.isArray(C)&&C.length===0?null:pe?(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:[te.map((_,R)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[_.type==="video"?(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(Be,{size:24,className:"text-zinc-400"})}):(0,t.jsx)("img",{src:_.url||_.src,className:"size-full object-cover",alt:""}),(0,t.jsx)("button",{onClick:q=>{q.stopPropagation(),Me(G=>G.filter((ee,U)=>U!==R))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(je,{size:16})})]},`old-${R}`)),ne.map((_,R)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border-2 border-dashed border-violet-500 bg-violet-50/10",children:[_.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(_),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center",children:(0,t.jsx)(Be,{size:24,className:"animate-pulse text-violet-500"})}),(0,t.jsx)("button",{onClick:q=>{q.stopPropagation(),re(G=>G.filter((ee,U)=>U!==R))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(je,{size:16})}),(0,t.jsx)("div",{className:"absolute bottom-1 left-1 rounded bg-violet-600 px-1 text-[8px] font-bold text-white",children:"NEW"})]},`new-${R}`)),te.length+ne.length<4&&(0,t.jsxs)("button",{onClick:_=>{_.stopPropagation(),Ee.current?.click()},className:"relative flex aspect-square flex-col items-center justify-center gap-1 rounded-xl border-2 border-dashed border-zinc-200 text-zinc-400 transition-all hover:border-violet-500 hover:bg-violet-50/5 hover:text-violet-500 dark:border-zinc-800",children:[(0,t.jsx)(qt,{size:20}),(0,t.jsx)("span",{className:"text-[10px] font-bold",children:"Add Media"})]})]}),(0,t.jsx)("input",{type:"file",ref:Ee,onChange:_=>{if(_.target.files){const R=Array.from(_.target.files);re(q=>[...q,...R])}},multiple:!0,className:"hidden",accept:"image/*,video/*"})]}):r.isValidElement(C)?C:(0,t.jsx)(Os,{items:C})},Te=(p,C)=>{const _=typeof p=="string"&&ls(p);if(pe)return(0,t.jsxs)("div",{className:"mt-2 flex flex-col gap-2",onClick:R=>R.stopPropagation(),children:[(0,t.jsx)(ms,{value:Z,onChange:R=>Ie(R.target.value),className:`min-h-[100px] w-full rounded-xl border-zinc-200 bg-zinc-50 focus:ring-violet-500 dark:border-zinc-800 dark:bg-zinc-900 ${_?"font-bangla text-lg":"font-english"}`,autoFocus:!0}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)("button",{onClick:()=>{ie(!1),Ie(l),Me(c||[]),re([])},className:"px-4 py-1.5 text-sm font-bold text-zinc-500 transition-colors hover:text-zinc-700 dark:hover:text-zinc-300",children:"Cancel"}),(0,t.jsx)("button",{onClick:Nt,disabled:Re||!Z.trim()||Z===l,className:"rounded-full bg-violet-600 px-4 py-1.5 text-sm font-bold text-white transition-all hover:bg-violet-700 disabled:opacity-50 active:scale-95",children:Re?"Saving...":"Save"})]})]});if(typeof p=="string"){const R=!x&&p.length>280,q=R&&!le?p.substring(0,280):p;return(0,t.jsxs)("div",{className:`whitespace-pre-line ${C||""} ${_?"font-bangla text-[1.15em] leading-relaxed":"font-english text-[1.05em]"}`,children:[(0,t.jsx)(we,{options:{...Ce,render:({attributes:G,content:ee})=>{const{href:U,...ce}=G,Ue=window.location.origin;let de=null;return U.startsWith("/")?de=U:U.startsWith(Ue)&&(de=U.replace(Ue,"")),de?(0,t.jsx)("span",{...ce,className:ue("cursor-pointer font-medium text-violet-600 hover:underline dark:text-violet-400",ce.className),onClick:be=>{be.stopPropagation(),S(de)},children:ee},ee):(0,t.jsx)("a",{href:U,...ce,target:"_blank",rel:"noopener noreferrer",className:ue("text-violet-600 hover:underline dark:text-violet-400",ce.className),onClick:be=>be.stopPropagation(),children:ee},ee)}},children:q}),R&&!le&&"...",R&&(0,t.jsx)("button",{onClick:G=>{G.stopPropagation(),jt(!le)},className:"ml-1 cursor-pointer font-bold text-rose-600 hover:underline dark:text-rose-400",children:le?"Show less":"See more"})]})}return p},yt=p=>{k(C=>{const _=`@${p} `;return C.includes(_)?C:C+_}),document.getElementById("comment-input")?.focus()};return x?(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("article",{className:"p-5 dark:bg-black",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsx)("button",{className:"shrink-0",onClick:()=>v&&v(e.handle),children:(0,t.jsxs)(J,{className:"size-12 border border-zinc-200 dark:border-zinc-700",children:[(0,t.jsx)(K,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(Q,{children:e.handle[0]?.toUpperCase()})]})}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex min-w-0 max-w-full items-center gap-1.5",children:[(0,t.jsxs)("button",{className:"flex shrink-0 items-center gap-1 text-base font-bold text-zinc-900 hover:underline sm:text-lg dark:text-white",onClick:()=>v&&v(e.handle),children:[(0,t.jsx)("span",{className:"max-w-[200px] truncate sm:max-w-none",children:e.handle}),e.verified&&(0,t.jsx)(Ke,{size:16,className:"text-blue-500"})]}),j&&(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-1 text-zinc-500",children:[(0,t.jsx)(Ye,{size:14,className:"shrink-0 text-zinc-400"}),(0,t.jsxs)("button",{className:"flex items-center gap-1 text-[14px] font-bold text-zinc-900 hover:underline sm:text-[15px] dark:text-zinc-100",onClick:p=>{p.stopPropagation(),S(`/c/${j.handle}`)},children:[(0,t.jsxs)(J,{className:"size-4 shrink-0 border border-zinc-200 bg-zinc-100 dark:border-zinc-700 dark:bg-zinc-800",children:[(0,t.jsx)(K,{src:j.avatar,alt:j.name,className:"object-cover"}),(0,t.jsx)(Q,{className:"text-[8px] font-bold text-zinc-500",children:j.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"max-w-[200px] truncate sm:max-w-none",children:j.name})]})]})]})}),(0,t.jsxs)("span",{className:"text-xs font-medium text-zinc-500 sm:text-sm dark:text-zinc-400",children:["@",e.handle]})]})]}),(0,t.jsxs)("div",{className:"-mt-1 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"whitespace-nowrap text-[13px] text-zinc-500 sm:text-sm dark:text-zinc-400",children:a||"Recent"}),(0,t.jsx)(Oe,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,t.jsx)(ze,{size:20})})})]})]}),(0,t.jsx)("div",{className:"mt-4 whitespace-pre-line break-words text-lg leading-relaxed text-zinc-900 sm:text-xl sm:leading-8 dark:text-zinc-100",children:Te(l,n)}),me(l)&&(0,t.jsx)(at,{url:me(l)}),We(c),h&&(0,t.jsx)(it,{poll:h}),i&&(0,t.jsx)("div",{className:"mt-4 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm dark:border-zinc-700",children:(0,t.jsx)(nt,{...i})}),(0,t.jsxs)("div",{className:"mt-4 flex items-center gap-x-6 border-b border-zinc-100 pb-4 text-sm text-zinc-500 dark:border-zinc-800 dark:text-zinc-400",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:F.likes||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Likes"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:F.comments||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Comments"})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex w-full items-center justify-around py-1",children:[(0,t.jsx)(B,{icon:xe,label:"Like",onClick:I,active:P,activeColorClass:"text-rose-500"}),!y&&(0,t.jsx)(B,{icon:ve,label:"Repost",onClick:A,active:u,activeColorClass:"text-emerald-500"}),(0,t.jsx)(B,{icon:ut,label:"Comment",onClick:()=>document.getElementById("comment-input")?.focus()}),!y&&(0,t.jsx)(B,{icon:Ne,label:"Share",onClick:()=>fe(!0)})]})]}),(0,t.jsx)(pt,{currentUser:g,newComment:O,setNewComment:k,handleSubmitComment:kt,loading:T,selectedFiles:he,setSelectedFiles:Fe,isUploading:vt}),(0,t.jsx)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:z?(0,t.jsx)("div",{className:"flex justify-center p-8",children:(0,t.jsx)(X,{className:"animate-spin text-violet-500"})}):(0,t.jsxs)(t.Fragment,{children:[bt&&D.length>0&&(0,t.jsxs)("button",{onClick:()=>oe(!0),disabled:Y,className:"flex w-full items-center justify-center gap-2 py-3 text-sm font-bold text-violet-600 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[Y&&(0,t.jsx)(X,{size:14,className:"animate-spin"}),"View more replies"]}),D.map(p=>(0,t.jsx)(ft,{...p,isComment:!0,onReply:yt,onUserClick:v,currentUser:g,showToast:o,onDelete:C=>L(_=>_.filter(R=>R.id!==C)),stats:{likes:p.stats?.likes||0,comments:p.stats?.comments||0,reposts:p.stats?.reposts||0},timeAgo:p.timeAgo||p.created_at},p.id))]})}),(0,t.jsx)(Xe,{open:Pe,onOpenChange:ae,children:(0,t.jsxs)(qe,{onClick:p=>p.stopPropagation(),children:[(0,t.jsxs)(Ge,{children:[(0,t.jsx)(Qe,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ze,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(tt,{children:[(0,t.jsx)(Je,{onClick:p=>p.stopPropagation(),children:"Cancel"}),(0,t.jsx)(et,{onClick:Le,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]}):(0,t.jsxs)("article",{onClick:f,className:`p-4 transition-all ${y?"border-b border-zinc-100/50 bg-transparent last:border-0 hover:bg-zinc-50/50 dark:border-zinc-800/50 dark:hover:bg-zinc-800/30":"mb-4 rounded-xl bg-white hover:shadow-md dark:bg-black"} ${f?"cursor-pointer":""}`,children:[b&&(0,t.jsxs)("div",{className:"mb-2 ml-1 flex items-center space-x-1.5 text-[13px] font-semibold text-zinc-600",children:[(0,t.jsx)(ve,{size:14,className:"text-zinc-500"}),(0,t.jsxs)("span",{className:"flex cursor-pointer items-center text-zinc-700 hover:underline dark:text-zinc-300",onClick:p=>{p.stopPropagation(),v&&v(b.handle)},children:[b.handle," Reposted"]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsx)("div",{className:"shrink-0 cursor-pointer",onClick:p=>{p.stopPropagation(),v&&v(e.handle)},children:(0,t.jsxs)(J,{className:"size-10 border border-zinc-200 dark:border-zinc-700",children:[(0,t.jsx)(K,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(Q,{children:e.handle[0]?.toUpperCase()})]})}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex min-w-0 max-w-full items-center gap-1.5",children:[(0,t.jsxs)("button",{className:"flex shrink-0 items-center gap-1 text-[15px] font-bold text-zinc-900 hover:underline dark:text-white",onClick:p=>{p.stopPropagation(),v&&v(e.handle)},children:[(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:e.handle}),e.verified&&(0,t.jsx)(Ke,{size:14,className:"text-blue-500"})]}),j&&(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-1 text-zinc-500",children:[(0,t.jsx)(Ye,{size:12,className:"shrink-0 text-zinc-400"}),(0,t.jsxs)("button",{className:"flex items-center gap-1 text-[13px] font-bold text-zinc-900 hover:underline dark:text-zinc-100",onClick:p=>{p.stopPropagation(),S(`/c/${j.handle}`)},children:[(0,t.jsxs)(J,{className:"size-3.5 shrink-0 border border-zinc-200 bg-zinc-100 dark:border-zinc-700 dark:bg-zinc-800",children:[(0,t.jsx)(K,{src:j.avatar,alt:j.name,className:"object-cover"}),(0,t.jsx)(Q,{className:"text-[6px] font-bold text-zinc-500",children:j.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:j.name})]})]}),(0,t.jsxs)("span",{className:"text-[13px] text-zinc-500 dark:text-zinc-400",children:["· ",a||"Recent"]})]})}),(0,t.jsx)("div",{className:"-mt-1 flex items-center",children:(0,t.jsx)(Oe,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 group-hover:bg-zinc-100 dark:hover:bg-zinc-800 dark:group-hover:bg-zinc-800/50",children:(0,t.jsx)(ze,{size:18})})})})]}),(0,t.jsx)("div",{className:"mt-0.5 whitespace-pre-line break-words text-[15px] leading-relaxed text-zinc-900 dark:text-zinc-100",children:Te(l,n)}),me(l)&&(0,t.jsx)(at,{url:me(l)}),We(c),h&&(0,t.jsx)(it,{poll:h}),i&&(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-900",onClick:p=>{p.stopPropagation(),S(`/post/${i.id}`)},children:(0,t.jsx)(nt,{...i})}),(0,t.jsxs)("div",{className:"mt-3 flex items-center justify-between pr-4",children:[(0,t.jsx)(B,{icon:xe,count:F.likes,onClick:I,active:P,activeColorClass:"text-rose-500",label:""}),(0,t.jsx)(B,{icon:ve,count:F.reposts,onClick:A,active:u,activeColorClass:"text-emerald-500",label:""}),(0,t.jsx)(B,{icon:lt,count:F.comments,onClick:p=>{p?.stopPropagation(),w?w(e.handle):f&&f()},label:""}),!y&&(0,t.jsx)(B,{icon:Ne,onClick:p=>{p?.stopPropagation(),fe(!0)},label:""})]})]})]}),(0,t.jsx)(gt,{isOpen:zt,onClose:()=>fe(!1),url:`${window.location.origin}/post/${s}`,title:"Share Post"}),(0,t.jsx)(Xe,{open:Pe,onOpenChange:ae,children:(0,t.jsxs)(qe,{onClick:p=>p.stopPropagation(),children:[(0,t.jsxs)(Ge,{children:[(0,t.jsx)(Qe,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ze,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(tt,{children:[(0,t.jsx)(Je,{onClick:p=>p.stopPropagation(),children:"Cancel"}),(0,t.jsx)(et,{onClick:Le,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})};function Js(s,e){return s.id===e.id&&s.content===e.content&&s.timeAgo===e.timeAgo&&s.user.id===e.user.id&&s.user.avatar===e.user.avatar&&s.stats.likes===e.stats.likes&&s.stats.comments===e.stats.comments&&s.stats.reposts===e.stats.reposts&&s.currentUser?.id===e.currentUser?.id&&JSON.stringify(s.media)===JSON.stringify(e.media)&&JSON.stringify(s.repostedBy)===JSON.stringify(e.repostedBy)}var Qs=r.memo(ft,Js),Ks=V(),Xs=s=>{const e=(0,Ks.c)(30),{user:a,time:l,content:n}=s,c=ye();let i;e[0]!==a.avatar||e[1]!==a.handle?(i=(0,t.jsx)(K,{src:a.avatar,alt:a.handle}),e[0]=a.avatar,e[1]=a.handle,e[2]=i):i=e[2];let d;e[3]!==a.handle[0]?(d=a.handle[0]?.toUpperCase(),e[3]=a.handle[0],e[4]=d):d=e[4];let f;e[5]!==d?(f=(0,t.jsx)(Q,{children:d}),e[5]=d,e[6]=f):f=e[6];let b;e[7]!==i||e[8]!==f?(b=(0,t.jsxs)(J,{className:"size-6",children:[i,f]}),e[7]=i,e[8]=f,e[9]=b):b=e[9];let v;e[10]!==a.handle?(v=(0,t.jsx)("span",{className:"text-sm font-semibold",children:a.handle}),e[10]=a.handle,e[11]=v):v=e[11];let g;e[12]!==b||e[13]!==v?(g=(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[b,v]}),e[12]=b,e[13]=v,e[14]=g):g=e[14];let o;e[15]!==l?(o=(0,t.jsx)("span",{className:"text-xs text-zinc-500 sm:text-sm",children:l}),e[15]=l,e[16]=o):o=e[16];let h;e[17]!==g||e[18]!==o?(h=(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between gap-x-2",children:[g,o]}),e[17]=g,e[18]=o,e[19]=h):h=e[19];let x;e[20]!==c?(x={...Ce,render:w=>{const{attributes:j,content:S}=w,{href:P,...u}=j,F=window.location.origin;let M=null;return P.startsWith("/")?M=P:P.startsWith(F)&&(M=P.replace(F,"")),M?(0,t.jsx)("span",{...u,className:ue("cursor-pointer font-medium text-violet-600 hover:underline dark:text-violet-400",u.className),onClick:I=>{I.stopPropagation(),c(M)},children:S},S):(0,t.jsx)("a",{href:P,...u,target:"_blank",rel:"noopener noreferrer",className:ue("text-violet-600 hover:underline dark:text-violet-400",u.className),onClick:Ys,children:S},S)}},e[20]=c,e[21]=x):x=e[21];let m;e[22]!==n?(m=(0,t.jsx)("p",{className:"whitespace-pre-line text-sm text-zinc-800 dark:text-zinc-300",children:n}),e[22]=n,e[23]=m):m=e[23];let N;e[24]!==m||e[25]!==x?(N=(0,t.jsx)(we,{options:x,children:m}),e[24]=m,e[25]=x,e[26]=N):N=e[26];let y;return e[27]!==N||e[28]!==h?(y=(0,t.jsxs)("div",{className:"p-4",children:[h,N]}),e[27]=N,e[28]=h,e[29]=y):y=e[29],y},nt=Xs;function Ys(s){return s.stopPropagation()}var Zs=r.memo(({reel:s,isActive:e,isMuted:a})=>{const l=ye(),{currentUser:n}=xt(),{addToast:c}=ht(),i=(0,r.useRef)(null),[d,f]=(0,r.useState)(!1),[b,v]=(0,r.useState)(!1),[g,o]=(0,r.useState)(!1),[h,x]=(0,r.useState)(null),[m,N]=(0,r.useState)(!1),[y,w]=(0,r.useState)(s.stats?.likes||0),[j,S]=(0,r.useState)(!1),[P,u]=(0,r.useState)(0),F=(0,r.useRef)(null),M=(0,r.useMemo)(()=>Array.isArray(s.media)?s.media[0]?.src||s.media[0]?.url:s.media?.src||s.media?.url||s.url,[s.media,s.url]);(0,r.useEffect)(()=>{let k;const z=i.current?.plyr;return z&&(e?k=setTimeout(()=>{typeof z.play=="function"&&z.play().catch(()=>{z&&(z.muted=!0,z.play().catch(()=>{}))})},100):typeof z.pause=="function"&&z.pause()),()=>{k&&clearTimeout(k)}},[e]),(0,r.useEffect)(()=>{if(!n?.id||!e)return;(async()=>{try{const[z,$]=await Promise.all([us(s.id,n.id),ns(n.id,s.user?.id)]);N(z),S($)}catch(z){console.error("Failed to check interaction status:",z)}})()},[s.id,n?.id,e,s.user?.id]),(0,r.useEffect)(()=>{const k=i.current?.plyr;k&&(k.muted=a)},[a]),(0,r.useEffect)(()=>{const k=i.current?.plyr;if(!k||!e)return;const z=()=>{const $=k.currentTime,T=k.duration;T>0&&u($/T*100)};if(typeof k.on=="function")return k.on("timeupdate",z),()=>{typeof k.off=="function"&&k.off("timeupdate",z)}},[e]),(0,r.useEffect)(()=>()=>{F.current&&clearTimeout(F.current)},[]);const I=k=>{const z=k.target;z.closest("button")||z.closest("a")||z.closest(".plyr__controls")||(F.current?(clearTimeout(F.current),F.current=null,E()):F.current=setTimeout(()=>{F.current=null,A()},250))},A=()=>{const k=i.current?.plyr;k&&(k.paused?(k.play().catch(()=>{}),x("play")):(k.pause(),x("pause")),setTimeout(()=>x(null),800))},E=async()=>{if(n&&(f(!0),setTimeout(()=>f(!1),1e3),!m)){N(!0),w(k=>k+1);try{await st(s.id,n.id)}catch{N(!1),w(k=>k-1)}}},W=async k=>{if(k.stopPropagation(),!n)return;const z=!m;N(z),w($=>z?$+1:$-1);try{await st(s.id,n.id)}catch{N(!z),w($=>z?$-1:$+1)}},D=async k=>{if(k.stopPropagation(),!n)return;const z=!j;S(z);try{await Zt(n.id,s.user?.id)}catch{S(!z)}},L=k=>{k.stopPropagation(),o(!0)},O=(0,r.useMemo)(()=>({source:{type:"video",sources:[{src:M,type:"video/mp4"}]},options:{controls:[],loop:{active:!0},clickToPlay:!1,ratio:"9:16"}}),[M]);return(0,t.jsxs)("div",{"data-id":s.id,className:"reel-item relative flex h-[100dvh] w-full snap-start items-center justify-center overflow-hidden bg-black cursor-pointer",onClick:I,children:[(0,t.jsx)("div",{className:"flex h-full w-full max-w-[450px] items-center justify-center",children:(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(ot,{ref:i,...O})})}),d&&(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-in zoom-in-50 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)(xe,{size:120,fill:"white",className:"scale-125 text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.4)]"})})}),h&&(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-in fade-in zoom-in-90 scale-100 animate-out zoom-out-110 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)("div",{className:"rounded-full border border-white/20 bg-white/10 p-8 shadow-2xl backdrop-blur-md",children:h==="play"?(0,t.jsx)(Jt,{size:50,fill:"white",className:"ml-1.5 text-white"}):(0,t.jsx)(Wt,{size:50,fill:"white",className:"text-white"})})})}),(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/60"}),(0,t.jsxs)("div",{className:"pointer-events-none absolute bottom-6 left-4 right-16 text-white",children:[(0,t.jsxs)("div",{className:"pointer-events-auto mb-3 flex items-center gap-2",children:[(0,t.jsxs)(Ct,{to:`/u/${s.user?.handle}`,className:"flex items-center gap-2 transition-opacity hover:opacity-80",onClick:k=>k.stopPropagation(),children:[(0,t.jsxs)(J,{className:"size-10 border-2 border-white",children:[(0,t.jsx)(K,{src:s.user?.avatar,alt:s.user?.handle,className:"object-cover"}),(0,t.jsx)(Q,{children:s.user?.handle?.[0]?.toUpperCase()})]}),(0,t.jsxs)("span",{className:"font-bold",children:["@",s.user?.handle]})]}),n?.id!==s.user?.id&&(0,t.jsx)("button",{className:`ml-2 flex items-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-bold transition-all active:scale-95 ${j?"border border-white/50 bg-transparent text-white":"bg-white text-black hover:bg-zinc-200"}`,onClick:D,children:j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ps,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Following"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(os,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Follow"})]})})]}),(0,t.jsx)(we,{options:{...Ce,render:({attributes:k,content:z})=>{const{href:$,...T}=k,H=!$.startsWith("/")&&($.startsWith("http")||$.startsWith("www"));return $.startsWith("/u/")||$.startsWith("/tags/")||$.startsWith("/c/")||$.startsWith("/explore")?(0,t.jsx)("span",{...T,className:"cursor-pointer font-bold text-white hover:underline",onClick:Y=>{Y.stopPropagation(),l($)},children:z},z):(0,t.jsx)("a",{href:$,...T,className:"text-white hover:underline",target:H?"_blank":void 0,rel:H?"noopener noreferrer":void 0,onClick:Y=>Y.stopPropagation(),children:z},z)}},children:(0,t.jsx)("p",{className:"mb-3 line-clamp-2 text-sm",children:s.content})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[(0,t.jsx)(Tt,{size:14,className:"animate-spin-slow"}),(0,t.jsxs)("span",{children:["Original Audio - ",s.user?.handle]})]})]}),(0,t.jsxs)("div",{className:"absolute bottom-6 right-2 z-10 flex flex-col items-center gap-6",children:[(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:`rounded-full p-3 backdrop-blur-md transition-all active:scale-90 ${m?"bg-rose-500/20 text-rose-500":"bg-zinc-800/50 text-white hover:bg-zinc-700"}`,onClick:W,children:(0,t.jsx)(xe,{size:28,fill:m?"currentColor":"none"})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:y})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700 active:scale-90",onClick:k=>{k.stopPropagation(),v(!0)},children:(0,t.jsx)(ut,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:s.stats?.comments||0})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700 active:scale-90",onClick:L,children:(0,t.jsx)(Ne,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:s.stats?.shares||0})]})]}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 z-50 h-[3px] w-full bg-white/20",children:(0,t.jsx)("div",{className:"h-full bg-white shadow-[0_0_8px_rgba(255,255,255,0.8)] transition-all duration-100 ease-linear",style:{width:`${P}%`}})}),(0,t.jsx)(ta,{isOpen:b,onClose:()=>v(!1),reelId:s.id,currentUser:n,showToast:c}),(0,t.jsx)(gt,{isOpen:g,onClose:()=>o(!1),url:`${window.location.origin}/reels?id=${s.id}`,title:"Share Reel"})]})},(s,e)=>s.isActive===e.isActive&&s.reel.id===e.reel.id&&s.isMuted===e.isMuted),ma=Zs,ea=({isOpen:s,onClose:e,reelId:a,currentUser:l,showToast:n})=>{const[c,i]=(0,r.useState)([]),[d,f]=(0,r.useState)(!1),[b,v]=(0,r.useState)(!1),[g,o]=(0,r.useState)(""),[h,x]=(0,r.useState)([]),[m,N]=(0,r.useState)(!1),[y,w]=(0,r.useState)(!0),[j,S]=(0,r.useState)(!1),P=(0,r.useRef)(c);(0,r.useEffect)(()=>{P.current=c},[c]);const u=(0,r.useCallback)(async(M=!1)=>{if(a){M?S(!0):f(!0);try{const I=P.current,A=await dt(a,M&&I.length>0?I[I.length-1].created_at:null,10);A.length<10?w(!1):w(!0),i(M?E=>[...E,...A]:A)}catch(I){console.error("Failed to load comments:",I),n&&n("Failed to load comments","error")}finally{f(!1),S(!1)}}},[a,n]);(0,r.useEffect)(()=>{s&&a?u():(i([]),w(!0))},[s,a,u]);const F=async M=>{if(M.preventDefault(),!(!g.trim()&&h.length===0||!l)){v(!0),N(!0);try{const I=[];for(const A of h){const E=await ke(A);I.push(E)}await ct(a,l.id,g,I),o(""),x([]),n&&n("Reply posted!"),u()}catch(I){console.error("Failed to post comment:",I),n&&n("Failed to post reply.","error")}finally{v(!1),N(!1)}}};return(0,t.jsx)(mt,{isOpen:s,onClose:e,title:"Comments",className:"max-sm:h-[95dvh] h-[85vh] overflow-hidden !p-0 sm:max-w-xl",children:(0,t.jsxs)("div",{className:"flex h-full flex-col overflow-hidden bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"mx-auto my-3 h-1.5 w-12 shrink-0 rounded-full bg-zinc-200 dark:bg-zinc-800 sm:hidden"}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto scroll-smooth scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800",children:d?(0,t.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,t.jsx)(X,{className:"animate-spin text-violet-500",size:32})}):c.length>0?(0,t.jsxs)("div",{className:"flex flex-col",children:[c.map(M=>(0,t.jsx)(Qs,{...M,isComment:!0,currentUser:l,showToast:n,onDelete:I=>i(A=>A.filter(E=>E.id!==I))},M.id)),y&&(0,t.jsxs)("button",{onClick:()=>u(!0),disabled:j,className:"flex w-full items-center justify-center gap-2 py-6 text-sm font-bold text-violet-600 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[j&&(0,t.jsx)(X,{size:16,className:"animate-spin"}),"View more replies"]})]}):(0,t.jsxs)("div",{className:"flex h-full min-h-[300px] flex-col items-center justify-center p-8 text-center text-zinc-500",children:[(0,t.jsx)("div",{className:"mb-4 flex size-16 items-center justify-center rounded-full bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(lt,{size:32,className:"text-zinc-400"})}),(0,t.jsx)("p",{className:"text-lg font-bold dark:text-zinc-300",children:"No comments yet"}),(0,t.jsx)("p",{className:"text-sm dark:text-zinc-500",children:"Be the first to share what you think!"})]})}),(0,t.jsx)("div",{className:"shrink-0 border-t border-zinc-100 bg-white pb-safe dark:border-zinc-800 dark:bg-zinc-900",children:(0,t.jsx)(pt,{currentUser:l,newComment:g,setNewComment:o,handleSubmitComment:F,loading:b,selectedFiles:h,setSelectedFiles:x,isUploading:m})})]})})},ta=ea,sa=({isOpen:s,onClose:e,url:a,title:l="Share"})=>{const[n,c]=(0,r.useState)(!1),[i,d]=(0,r.useState)(""),[f,b]=(0,r.useState)([]),[v,g]=(0,r.useState)(!1),[o,h]=(0,r.useState)(null),{addToast:x}=ht(),{currentUser:m}=xt(),N=(0,r.useCallback)(async()=>{if(m){g(!0);try{b(await as(m.id,null,10))}catch(u){console.error("Failed to fetch following:",u)}finally{g(!1)}}},[m?.id]);(0,r.useEffect)(()=>{s&&m?N():(d(""),b([]))},[s,m,N]);const y=(0,r.useCallback)(async()=>{if(m){g(!0);try{b((await rs(i)).filter(u=>u.id!==m.id))}catch(u){console.error("Search failed:",u)}finally{g(!1)}}},[i,m?.id]);(0,r.useEffect)(()=>{const u=setTimeout(()=>{i.trim()&&s?y():!i.trim()&&s&&N()},300);return()=>clearTimeout(u)},[i,s,y,N]);const w=async u=>{u&&u.stopPropagation();try{await navigator.clipboard.writeText(a),c(!0),x("Link copied to clipboard!","success"),setTimeout(()=>c(!1),2e3)}catch(F){console.error("Failed to copy:",F),x("Failed to copy link","error")}},j=async u=>{if(m){h(u.id);try{await hs(await ss(m.id,u.id),m.id,a,"text"),x(`Sent to ${u.name||u.handle}!`,"success")}catch(F){console.error("Failed to send message:",F),x("Failed to send message","error")}finally{h(null)}}},S=[{name:"X",icon:Pt,color:"bg-black text-white",href:`https://twitter.com/intent/tweet?url=${encodeURIComponent(a)}`},{name:"Facebook",icon:Rt,color:"bg-[#1877F2] text-white",href:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(a)}`},{name:"LinkedIn",icon:Vt,color:"bg-[#0A66C2] text-white",href:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(a)}`},{name:"WhatsApp",icon:Qt,color:"bg-[#25D366] text-white",href:`https://wa.me/?text=${encodeURIComponent(a)}`},{name:"Email",icon:Ut,color:"bg-zinc-600 text-white",href:`mailto:?body=${encodeURIComponent(a)}`}],P=async()=>{if(navigator.share)try{await navigator.share({title:l,url:a})}catch(u){u.name!=="AbortError"&&console.error("Native share failed:",u)}else w()};return(0,t.jsx)(mt,{isOpen:s,onClose:e,title:l,className:"max-w-[420px] !p-0 overflow-hidden",children:(0,t.jsxs)("div",{className:"flex h-full flex-col bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"px-5 pb-2 pt-4",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)(Et,{className:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-zinc-400 transition-colors group-focus-within:text-violet-500"}),(0,t.jsx)("input",{type:"text",placeholder:"Search people...",value:i,onChange:u=>d(u.target.value),className:"w-full rounded-xl border-none bg-zinc-100 py-2.5 pl-10 pr-4 text-sm transition-all focus:ring-2 focus:ring-violet-500/20 outline-none dark:bg-zinc-800/50"})]})}),(0,t.jsx)("div",{className:"no-scrollbar flex min-h-[100px] items-center gap-4 overflow-x-auto px-5 py-4",children:v?(0,t.jsx)("div",{className:"flex flex-1 justify-center",children:(0,t.jsx)(X,{size:24,className:"animate-spin text-zinc-400"})}):f.length>0?f.map(u=>(0,t.jsxs)("button",{onClick:()=>j(u),disabled:o!==null,className:"group flex shrink-0 flex-col items-center gap-1.5 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"size-14 overflow-hidden rounded-full border-2 border-white shadow-sm transition-transform group-hover:scale-105 bg-zinc-100 dark:bg-zinc-800 dark:border-zinc-900",children:(0,t.jsx)("img",{src:u.avatar||`https://i.pravatar.cc/150?u=${u.id}`,alt:u.handle,className:"size-full object-cover"})}),o===u.id?(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-full bg-black/40",children:(0,t.jsx)(X,{size:16,className:"animate-spin text-white"})}):(0,t.jsx)("div",{className:"absolute bottom-0 right-0 size-3.5 rounded-full border-2 border-white bg-emerald-500 dark:border-zinc-900"})]}),(0,t.jsx)("span",{className:"max-w-[60px] truncate text-[10px] font-medium text-zinc-500 dark:text-zinc-400",children:u.name?.split(" ")[0]||u.handle})]},u.id)):(0,t.jsx)("div",{className:"flex-1 py-2 text-center",children:(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"No people found"})})}),(0,t.jsx)("div",{className:"mx-5 h-px bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsxs)("div",{className:"grid grid-cols-5 gap-2 px-5 py-6",children:[S.map(u=>(0,t.jsxs)("a",{href:u.href,target:"_blank",rel:"noopener noreferrer",className:"group flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:`size-12 ${u.color} flex items-center justify-center rounded-2xl shadow-md transition-all group-hover:-translate-y-1 group-hover:scale-110 group-hover:shadow-lg`,children:(0,t.jsx)(u.icon,{size:20,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-tighter text-zinc-500 dark:text-zinc-400",children:u.name})]},u.name)),(0,t.jsxs)("button",{onClick:P,className:"group flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:"flex size-12 items-center justify-center rounded-2xl border border-zinc-200 bg-zinc-100 text-zinc-600 shadow-sm transition-all group-hover:-translate-y-1 group-hover:scale-110 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-300",children:(0,t.jsx)(ze,{size:20,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-tighter text-zinc-500 dark:text-zinc-400",children:"More"})]})]}),(0,t.jsx)("div",{className:"px-5 pb-6",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)("input",{type:"text",readOnly:!0,value:a,className:"w-full rounded-2xl border border-zinc-200 bg-zinc-50 py-3.5 pl-4 pr-14 text-sm font-medium transition-colors focus:outline-none group-hover:border-zinc-300 dark:border-zinc-800 dark:bg-zinc-950 dark:group-hover:border-zinc-700"}),(0,t.jsx)("button",{onClick:w,className:`absolute right-1.5 top-1/2 flex -translate-y-1/2 items-center gap-2 rounded-xl h-10 px-4 text-xs font-bold shadow-sm transition-all active:scale-95 ${n?"bg-emerald-500 text-white":"bg-zinc-900 text-white hover:opacity-90 dark:bg-white dark:text-zinc-900"}`,children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)($t,{size:14,strokeWidth:3}),(0,t.jsx)("span",{children:"Copied"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(At,{size:14,strokeWidth:3}),(0,t.jsx)("span",{children:"Copy"})]})})]})}),(0,t.jsx)("div",{className:"px-5 pb-5",children:(0,t.jsxs)("button",{onClick:e,className:"group relative flex w-full items-center justify-center overflow-hidden rounded-2xl bg-zinc-900 py-4 font-bold text-white transition-all hover:shadow-xl hover:shadow-zinc-900/10 active:scale-[0.98] dark:bg-white dark:text-zinc-900 dark:hover:shadow-white/10",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-zinc-500 to-zinc-600 opacity-0 transition-opacity duration-300 group-hover:opacity-100"}),(0,t.jsx)("div",{className:"relative flex items-center gap-2",children:(0,t.jsx)("span",{children:"Close"})})]})})]})})},gt=sa;export{Qs as n,ma as t};
