import{a as oe}from"./rolldown-runtime-BaZ8gS7u.js";import{T as me,s as ce,u as he,y as de}from"./framework-DIDnLsp9.js";import"./database-DlIwwAmc.js";import{Ft as ae,Gn as ue,Gt as ie,In as pe,Jt as be,Mn as fe,Pn as ge,Pt as je,Qn as ve,Qt as ke,Vt as Z,Wn as ze,X as le,Y as K,Yn as Ne,_n as se,dn as we,mn as ye,tn as Q,xn as Ce,zt as Me}from"./ui-libs-BbdIqPKe.js";import{$ as H,A as Se,B as $e,F as Ie,G as Pe,H as Te,I as Ee,J as Ae,K as Ue,P as Le,Q as O,U as ne,V as Re,W as _,X as Ve,Y as ee,Z as Be,_t as De,dt as He,et as W,h as Oe,k as We,q as Fe,ut as Ye}from"./index-DONeHNx1.js";import{n as qe,t as Ge}from"./linkify-DBRQwEj8.js";import{a as Ke,u as Xe}from"./hooks-CqpOLrQP.js";var Je=ce(),U=oe(me(),1),e=oe(he(),1),Ze=t=>{const s=(0,Je.c)(54),{conv:a,selectedId:v,onSelect:k,onlineUsers:h}=t,x=de();let z;s[0]!==a.user?.id||s[1]!==h?(z=h.has(a.user?.id),s[0]=a.user?.id,s[1]=h,s[2]=z):z=s[2];const m=z;let i;s[3]!==a.user||s[4]!==x?(i=X=>{X.stopPropagation(),a.user?.handle&&x(`/u/${a.user.handle}`)},s[3]=a.user,s[4]=x,s[5]=i):i=s[5];const I=i;let w;s[6]!==a||s[7]!==k?(w=()=>k(a),s[6]=a,s[7]=k,s[8]=w):w=s[8];const b=`group relative flex cursor-pointer items-center gap-3 p-3 mx-2 rounded-xl transition-all duration-200 
                ${v===a.id?"bg-violet-50 dark:bg-violet-900/10 shadow-sm":"hover:bg-zinc-50 dark:hover:bg-zinc-900"}`;let f;s[9]!==a.id||s[10]!==v?(f=v===a.id&&(0,e.jsx)("div",{className:"absolute left-0 top-1/2 h-8 w-1 -translate-y-1/2 rounded-r-full bg-violet-600"}),s[9]=a.id,s[10]=v,s[11]=f):f=s[11];const M=a.user?.avatar,P=a.user?.name;let c;s[12]!==M||s[13]!==P?(c=(0,e.jsx)(W,{src:M,alt:P,className:"object-cover"}),s[12]=M,s[13]=P,s[14]=c):c=s[14];let g;s[15]!==a.user?.name?.[0]?(g=a.user?.name?.[0]?.toUpperCase(),s[15]=a.user?.name?.[0],s[16]=g):g=s[16];let y;s[17]!==g?(y=(0,e.jsx)(H,{children:g}),s[17]=g,s[18]=y):y=s[18];let C;s[19]!==y||s[20]!==c?(C=(0,e.jsxs)(O,{className:"size-12 border-2 border-transparent transition-all group-hover:border-zinc-200 dark:group-hover:border-zinc-800",children:[c,y]}),s[19]=y,s[20]=c,s[21]=C):C=s[21];let u;s[22]!==m?(u=m&&(0,e.jsx)("span",{className:"absolute bottom-0 right-0 size-3.5 rounded-full border-2 border-white bg-emerald-500 ring-1 ring-emerald-500/20 dark:border-black"}),s[22]=m,s[23]=u):u=s[23];let j;s[24]!==I||s[25]!==C||s[26]!==u?(j=(0,e.jsxs)("div",{className:"relative cursor-pointer",onClick:I,children:[C,u]}),s[24]=I,s[25]=C,s[26]=u,s[27]=j):j=s[27];const N=`truncate font-bold ${v===a.id?"text-violet-900 dark:text-violet-100":"text-zinc-900 dark:text-zinc-100"}`,p=a.user?.name;let d;s[28]!==N||s[29]!==p?(d=(0,e.jsx)("span",{className:N,children:p}),s[28]=N,s[29]=p,s[30]=d):d=s[30];const T=`ml-2 whitespace-nowrap text-[10px] font-medium ${a.unread>0?"text-violet-600":"text-zinc-400"}`;let o;s[31]!==a.time||s[32]!==T?(o=(0,e.jsx)("span",{className:T,children:a.time}),s[31]=a.time,s[32]=T,s[33]=o):o=s[33];let L;s[34]!==d||s[35]!==o?(L=(0,e.jsxs)("div",{className:"mb-0.5 flex items-center justify-between",children:[d,o]}),s[34]=d,s[35]=o,s[36]=L):L=s[36];const F=`truncate text-sm ${a.unread>0?"font-semibold text-zinc-900 dark:text-white":"text-zinc-500"}`;let R;s[37]!==a.lastMessage||s[38]!==F?(R=(0,e.jsx)("p",{className:F,children:a.lastMessage}),s[37]=a.lastMessage,s[38]=F,s[39]=R):R=s[39];let V;s[40]!==a.unread?(V=a.unread>0&&(0,e.jsx)("span",{className:"flex size-5 shrink-0 items-center justify-center rounded-full bg-violet-600 text-[10px] font-bold text-white shadow-sm shadow-violet-200 dark:shadow-none",children:a.unread}),s[40]=a.unread,s[41]=V):V=s[41];let B;s[42]!==R||s[43]!==V?(B=(0,e.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[R,V]}),s[42]=R,s[43]=V,s[44]=B):B=s[44];let D;s[45]!==L||s[46]!==B?(D=(0,e.jsxs)("div",{className:"min-w-0 flex-1",children:[L,B]}),s[45]=L,s[46]=B,s[47]=D):D=s[47];let Y;return s[48]!==j||s[49]!==D||s[50]!==w||s[51]!==b||s[52]!==f?(Y=(0,e.jsxs)("div",{onClick:w,className:b,children:[f,j,D]}),s[48]=j,s[49]=D,s[50]=w,s[51]=b,s[52]=f,s[53]=Y):Y=s[53],Y},Qe=({conversations:t,userResults:s=[],onSelect:a,onStartNew:v,selectedId:k,searchQuery:h,onSearchChange:x,onlineUsers:z=new Set})=>{const m=t.filter(i=>z.has(i.user?.id));return(0,e.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col bg-white dark:bg-black",children:[(0,e.jsxs)("div",{className:"border-b border-zinc-100/50 p-4 dark:border-zinc-800/50",children:[(0,e.jsx)("h2",{className:"mb-4 text-2xl font-black tracking-tight dark:text-white",children:"Messages"}),(0,e.jsx)(We,{value:h,onChange:x,onClear:()=>x(""),placeholder:"Search messages...",className:"shadow-sm"})]}),(0,e.jsx)("div",{className:"flex-1 min-h-0 relative",children:(0,e.jsx)(Se,{className:"absolute inset-0 h-full",children:(0,e.jsxs)("div",{className:"flex flex-col min-h-full pb-4",children:[!h&&m.length>0&&(0,e.jsx)("div",{className:"mt-2 mb-4 pl-4",children:(0,e.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2 pr-4 no-scrollbar",children:m.map(i=>(0,e.jsxs)("div",{onClick:()=>a(i),className:"flex flex-col items-center gap-1.5 cursor-pointer group min-w-[72px]",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-violet-500 to-fuchsia-500 opacity-0 transition-opacity duration-300 group-hover:opacity-100 p-[2px]",children:(0,e.jsx)("div",{className:"h-full w-full rounded-full bg-white dark:bg-black"})}),(0,e.jsxs)(O,{className:"size-[56px] border-[2px] border-transparent group-hover:border-transparent group-hover:p-[1.5px] transition-all",children:[(0,e.jsx)(W,{src:i.user?.avatar,className:"object-cover rounded-full"}),(0,e.jsx)(H,{children:i.user?.name?.[0]})]}),(0,e.jsx)("span",{className:"absolute bottom-1 right-1 size-3.5 rounded-full border-2 border-white bg-emerald-500 ring-2 ring-white dark:border-black dark:ring-black"})]}),(0,e.jsx)("span",{className:"w-full truncate text-center text-[10px] font-medium text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white transition-colors",children:i.user?.name.split(" ")[0]})]},i.id))})}),!h&&(0,e.jsx)("div",{className:"px-5 py-2 text-xs font-bold text-zinc-900 dark:text-white",children:"Messages"}),t.length>0&&(0,e.jsx)("div",{className:"space-y-0.5 px-2",children:t.filter(i=>i.lastMessage!=="No messages yet"||i.id===k).map(i=>(0,e.jsx)(Ze,{conv:i,selectedId:k,onSelect:a,onlineUsers:z},i.id))}),s.length>0&&(0,e.jsxs)("div",{className:"mt-4 border-t border-zinc-100 pt-4 dark:border-zinc-800",children:[(0,e.jsx)("div",{className:"px-4 py-2 text-xs font-bold uppercase tracking-wider text-zinc-500",children:"People"}),s.map(i=>(0,e.jsxs)("div",{onClick:()=>v(i),className:"flex cursor-pointer items-center gap-3 px-4 py-3 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[(0,e.jsxs)(O,{className:"size-10",children:[(0,e.jsx)(W,{src:i.avatar,alt:i.name,className:"object-cover"}),(0,e.jsx)(H,{children:i.name?.[0]?.toUpperCase()})]}),(0,e.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,e.jsx)("div",{className:"truncate font-bold dark:text-white",children:i.name}),(0,e.jsxs)("div",{className:"truncate text-sm text-zinc-500",children:["@",i.handle]})]}),(0,e.jsx)(Z,{size:18,className:"text-violet-500"})]},i.id))]}),t.length===0&&s.length===0&&h&&(0,e.jsxs)("div",{className:"p-8 text-center",children:[(0,e.jsx)("div",{className:"mx-auto mb-3 flex size-12 items-center justify-center rounded-full bg-zinc-100 dark:bg-zinc-900",children:(0,e.jsx)(Z,{className:"text-zinc-400"})}),(0,e.jsxs)("p",{className:"text-sm text-zinc-500",children:['No conversations or people found for "',h,'"']})]}),t.length===0&&!h&&(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center px-6",children:[(0,e.jsx)("div",{className:"mb-4 rounded-2xl bg-violet-50 p-6 dark:bg-violet-900/20",children:(0,e.jsx)(Z,{size:32,className:"text-violet-500"})}),(0,e.jsx)("h3",{className:"text-lg font-bold text-zinc-900 dark:text-white",children:"No messages yet"}),(0,e.jsx)("p",{className:"mt-1 text-sm text-zinc-500",children:"Connect with others to start chatting!"})]})]})})})]})},_e=Qe,es=({conversation:t,messages:s,onBack:a,onSendMessage:v,onDeleteMessage:k,currentUser:h,onTyping:x,isLoading:z,isTyping:m,isOnline:i})=>{const I=de(),{openLightbox:w}=He(),[b,f]=(0,U.useState)(""),[M,P]=(0,U.useState)(!1),[c,g]=(0,U.useState)([]),[y,C]=(0,U.useState)(!1),[u,j]=(0,U.useState)(null),N=(0,U.useRef)(null),p=(0,U.useRef)(null),d=(0,U.useRef)(null),T=Xe(t.user?.lastSeen);(0,U.useEffect)(()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)},[s,m]);const o=r=>{const n=r.target.value;f(n),r.target.style.height="auto",r.target.style.height=`${Math.min(r.target.scrollHeight,128)}px`,x&&(x(!0),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{x(!1)},2e3))},L=r=>{f(n=>n+r.emoji)},F=r=>{r&&r.preventDefault(),!(!b.trim()&&c.length===0)&&(x&&(d.current&&clearTimeout(d.current),x(!1)),v(t.id,b,c.length>0?"image":"text",c,u?.id),f(""),g([]),j(null))},R=async r=>{if(!r.target.files)return;const n=Array.from(r.target.files);if(n.length!==0){P(!0);try{const l=await Promise.all(n.map(S=>De(S)));g(S=>[...S,...l])}catch(l){console.error("Upload failed:",l)}finally{P(!1)}}},V=r=>{g(n=>n.filter(l=>l.url!==r))},B=r=>{!r.media||r.media.length===0||w(r.media.map(n=>n.url),0)},D=(0,U.useMemo)(()=>{const r=s.filter(n=>n.sender==="me");return r.length>0?r[r.length-1].id:null},[s]),Y=r=>s.find(n=>n.id===r),X=(r,n)=>r===0?!1:s[r-1].sender===n.sender,xe=(r,n)=>r===s.length-1?!1:s[r+1].sender===n.sender;return(0,e.jsxs)("div",{className:"relative flex h-full w-full flex-col overflow-hidden bg-zinc-50/50 dark:bg-black/50 md:border-l md:border-zinc-100 dark:md:border-zinc-800",children:[(0,e.jsx)("div",{className:"absolute inset-0 z-0 opacity-[0.03] pointer-events-none",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),(0,e.jsxs)("div",{className:"sticky top-0 z-30 flex shrink-0 items-center justify-between border-b border-zinc-200/50 bg-white/80 px-4 py-3 backdrop-blur-xl dark:border-zinc-800/50 dark:bg-black/80 supports-[backdrop-filter]:bg-white/60",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("button",{onClick:a,className:"mr-1 -ml-2 rounded-full p-2 text-zinc-600 transition-colors hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-zinc-800 md:hidden","aria-label":"Back",children:(0,e.jsx)(ve,{size:24})}),(0,e.jsxs)("div",{className:"relative cursor-pointer",onClick:()=>I(`/u/${t.user.handle}`),children:[(0,e.jsxs)(O,{className:"size-9 border-2 border-white shadow-sm dark:border-zinc-800",children:[(0,e.jsx)(W,{src:t.user.avatar,alt:t.user.name,className:"object-cover"}),(0,e.jsx)(H,{children:t.user.name?.[0]?.toUpperCase()})]}),i&&(0,e.jsx)("span",{className:"absolute bottom-0 right-0 size-2.5 rounded-full border-2 border-white bg-emerald-500 ring-1 ring-white/50 dark:border-black dark:ring-black/50"})]}),(0,e.jsxs)("div",{className:"flex flex-col cursor-pointer",onClick:()=>I(`/u/${t.user.handle}`),children:[(0,e.jsx)("span",{className:"text-sm font-bold leading-none dark:text-white",children:t.user.name}),i?(0,e.jsx)("span",{className:"text-[10px] font-medium text-emerald-500",children:"Active now"}):(0,e.jsx)("span",{className:"text-[10px] font-medium text-zinc-500",children:t.user.lastSeen?`Last seen ${T}`:"Offline"})]})]}),(0,e.jsxs)(Re,{children:[(0,e.jsx)(Ue,{asChild:!0,children:(0,e.jsx)("button",{className:"rounded-full p-2 hover:bg-zinc-100 dark:text-zinc-400 dark:hover:bg-zinc-800 transition-colors","aria-label":"More options",children:(0,e.jsx)(ge,{size:20})})}),(0,e.jsxs)(Te,{align:"end",className:"w-56 rounded-xl border-zinc-100 dark:border-zinc-800 shadow-xl bg-white/90 dark:bg-black/90 backdrop-blur-xl",children:[(0,e.jsxs)(ne,{children:[(0,e.jsxs)("button",{onClick:()=>I(`/u/${t.user.handle}`),className:"flex w-full items-center gap-3 rounded-lg px-3 py-2 text-sm transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800",children:[(0,e.jsx)(Me,{size:16}),(0,e.jsx)("span",{children:"View Profile"})]}),(0,e.jsxs)(_,{className:"cursor-pointer gap-2",children:[(0,e.jsx)(Ne,{size:16}),"Mute Notifications"]})]}),(0,e.jsx)(Pe,{}),(0,e.jsxs)(ne,{children:[(0,e.jsxs)(_,{className:"cursor-pointer gap-2",children:[(0,e.jsx)(fe,{size:16}),"Clear Chat"]}),(0,e.jsxs)(_,{variant:"destructive",className:"cursor-pointer gap-2 text-rose-500 focus:text-rose-500 focus:bg-rose-50 dark:focus:bg-rose-900/10",children:[(0,e.jsx)(ie,{size:16}),"Delete Conversation"]})]})]})]})]}),(0,e.jsxs)("div",{className:"flex-1 min-h-0 space-y-2 overflow-y-auto p-4 z-10",ref:p,children:[(0,e.jsxs)("div",{className:"py-12 text-center",children:[(0,e.jsxs)("div",{className:"relative mx-auto w-fit",children:[(0,e.jsxs)(O,{className:"mx-auto mb-4 size-24 border-4 border-white shadow-xl dark:border-zinc-900",children:[(0,e.jsx)(W,{src:t.user.avatar,alt:t.user.name,className:"object-cover"}),(0,e.jsx)(H,{className:"text-3xl font-bold",children:t.user.name?.[0]?.toUpperCase()})]}),i&&(0,e.jsx)("span",{className:"absolute bottom-1 right-1 size-6 animate-in zoom-in rounded-full border-4 border-white bg-emerald-500 duration-300 dark:border-black"})]}),(0,e.jsx)("h4",{className:"text-xl font-bold dark:text-white",children:t.user.name}),(0,e.jsxs)("p",{className:"text-sm text-zinc-500",children:["@",t.user.handle]}),(0,e.jsx)("div",{className:"mt-4 inline-flex items-center gap-2 rounded-full border border-zinc-200 bg-white px-4 py-1.5 text-xs text-zinc-500 shadow-sm dark:border-zinc-800 dark:bg-zinc-900",children:(0,e.jsx)("span",{children:"Synced with blockchain"})})]}),z&&s.length===0?(0,e.jsx)("div",{className:"flex justify-center p-8",children:(0,e.jsx)(se,{className:"animate-spin text-violet-500",size:32})}):(0,e.jsx)("div",{className:"flex flex-col justify-end min-h-0",children:(0,e.jsx)(le,{initial:!1,mode:"popLayout",children:s.map((r,n)=>{const l=r.sender==="me",S=X(n,r),E=xe(n,r);return(0,e.jsx)(K.div,{layout:!0,initial:{opacity:0,scale:.8,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,transition:{duration:.1}},transition:{type:"spring",stiffness:400,damping:25,mass:.8},className:`flex w-full origin-bottom ${l?"justify-end":"justify-start"} ${E?"mb-[2px]":"mb-4"}`,children:(0,e.jsxs)(Fe,{children:[(0,e.jsx)(Be,{asChild:!0,children:(0,e.jsxs)("div",{id:`msg-${r.id}`,className:`group flex max-w-[75%] items-end gap-2 ${l?"flex-row-reverse":"flex-row"}`,children:[!l&&!E&&(0,e.jsxs)(O,{className:"size-8 shrink-0 border border-zinc-100 dark:border-zinc-800 transition-transform duration-300 hover:scale-110",children:[(0,e.jsx)(W,{src:t.user.avatar,className:"object-cover"}),(0,e.jsx)(H,{children:t.user.name?.[0]})]}),!l&&E&&(0,e.jsx)("div",{className:"w-8 shrink-0"}),(0,e.jsxs)(K.div,{layout:!0,className:`relative p-3.5 text-[15px] shadow-sm
                                                            ${l?"bg-gradient-to-tr from-violet-600 to-indigo-600 text-white":"bg-white text-zinc-900 shadow-zinc-200/50 dark:bg-zinc-800 dark:text-zinc-100 dark:shadow-none"}
                                                            ${!E&&!S?"rounded-[20px]":""}
                                                            ${l&&!E&&S?"rounded-[20px] rounded-tr-md":""}
                                                            ${l&&E&&!S?"rounded-[20px] rounded-br-md":""}
                                                            ${l&&E&&S?"rounded-[20px] rounded-r-md":""}
                                                            
                                                            ${!l&&!E&&S?"rounded-[20px] rounded-tl-md":""}
                                                            ${!l&&E&&!S?"rounded-[20px] rounded-bl-md":""}
                                                            ${!l&&E&&S?"rounded-[20px] rounded-l-md":""}
                                                        `,children:[r.replyToId&&(0,e.jsx)("div",{className:`mb-2 cursor-pointer truncate rounded-xl p-2.5 text-xs backdrop-blur-sm transition-all hover:opacity-80 active:scale-95 ${l?"bg-black/20 text-white/90":"bg-zinc-100 text-zinc-600 dark:bg-zinc-700/50 dark:text-zinc-300"}`,onClick:A=>{A.stopPropagation();const $=document.getElementById(`msg-${r.replyToId}`);$&&($.scrollIntoView({behavior:"smooth",block:"center"}),$.animate&&$.animate([{transform:"scale(1)"},{transform:"scale(1.05)"},{transform:"scale(1)"}],{duration:300,easing:"ease-out"}))},children:(()=>{const A=Y(r.replyToId);return A?(0,e.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,e.jsxs)("div",{className:"flex items-center gap-1.5 opacity-70",children:[(0,e.jsx)(Q,{size:12}),(0,e.jsx)("span",{className:"font-bold",children:A.sender==="me"?"You":t.user.name})]}),(0,e.jsx)("span",{className:"truncate block",children:A.text||(A.media?.length?"ðŸ“· Photo":"Attachment")})]}):(0,e.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,e.jsxs)("div",{className:"flex items-center gap-1.5 opacity-70",children:[(0,e.jsx)(Q,{size:12}),(0,e.jsx)("span",{className:"font-bold",children:"Original Message"})]}),(0,e.jsx)("span",{className:"italic opacity-60",children:"Message unavailable"})]})})()}),r.media?.length>0&&(0,e.jsx)("div",{className:"mb-2 grid cursor-pointer grid-cols-1 gap-1 overflow-hidden rounded-2xl",onClick:()=>B(r),children:r.media.map((A,$)=>(0,e.jsx)("img",{src:A.url,alt:"",className:"max-h-80 w-full rounded-lg object-cover transition-all hover:scale-[1.02]"},$))}),r.text&&(0,e.jsx)("div",{className:"m-0 break-words whitespace-pre-line leading-relaxed tracking-wide",children:(0,e.jsx)(qe,{options:{...Ge,render:({attributes:A,content:$})=>{const{href:q,...te}=A,re=window.location.origin;let G=null;return q.startsWith("/")?G=q:q.startsWith(re)&&(G=q.replace(re,"")),G?(0,e.jsx)("span",{...te,className:`cursor-pointer break-all font-semibold underline decoration-1 underline-offset-2 transition-opacity hover:opacity-80 ${l?"text-white":"text-violet-600 dark:text-violet-400"}`,onClick:J=>{J.stopPropagation(),I(G)},children:$},$):(0,e.jsx)("a",{href:q,...te,className:`break-all underline decoration-1 underline-offset-2 transition-opacity hover:opacity-80 ${l?"text-white":"text-violet-600 dark:text-violet-400"}`,target:"_blank",rel:"noopener noreferrer",onClick:J=>J.stopPropagation(),children:$},$)}},children:r.text})}),(0,e.jsxs)("div",{className:`mt-1 flex items-center justify-end gap-1 text-[10px] ${l?"text-white/70":"text-zinc-400"}`,children:[r.time,l&&r.id===D&&(0,e.jsx)("span",{className:"ml-0.5",children:r.isRead?(0,e.jsx)(ue,{size:14,className:"text-white"}):(0,e.jsx)(ze,{size:14,className:"text-white/70"})})]})]})]})}),(0,e.jsxs)(Ae,{className:"w-64 rounded-2xl border-zinc-100 bg-white/90 backdrop-blur-xl shadow-2xl dark:border-zinc-800 dark:bg-black/90",children:[(0,e.jsxs)(ee,{className:"cursor-pointer gap-3 px-3 py-2.5 focus:bg-zinc-50 dark:focus:bg-zinc-900",onClick:()=>{navigator.clipboard.writeText(r.text)},children:[(0,e.jsx)(pe,{size:16,className:"text-zinc-500"}),(0,e.jsx)("span",{className:"font-medium",children:"Copy Text"})]}),(0,e.jsxs)(ee,{className:"cursor-pointer gap-3 px-3 py-2.5 focus:bg-zinc-50 dark:focus:bg-zinc-900",onClick:()=>j(r),children:[(0,e.jsx)(Q,{size:16,className:"text-zinc-500"}),(0,e.jsx)("span",{className:"font-medium",children:"Reply"})]}),(0,e.jsx)(Ve,{className:"bg-zinc-100 dark:bg-zinc-800"}),(0,e.jsxs)(ee,{className:"cursor-pointer gap-3 px-3 py-2.5 text-rose-500 focus:bg-rose-50 focus:text-rose-500 dark:focus:bg-rose-900/20",onClick:()=>k&&k(r.id),children:[(0,e.jsx)(ie,{size:16}),(0,e.jsx)("span",{className:"font-medium",children:"Delete message"})]})]})]})},r.id)})})}),m&&(0,e.jsx)(K.div,{initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},className:"flex justify-start pb-4 pl-1",children:(0,e.jsxs)("div",{className:"flex items-end gap-2",children:[(0,e.jsxs)(O,{className:"size-8 shrink-0 border border-zinc-100 dark:border-zinc-800",children:[(0,e.jsx)(W,{src:t.user.avatar,className:"object-cover"}),(0,e.jsx)(H,{children:t.user.name?.[0]})]}),(0,e.jsx)("div",{className:"rounded-[20px] rounded-bl-none border border-zinc-100 bg-white px-4 py-3 shadow-md shadow-zinc-200/50 dark:border-zinc-800 dark:bg-zinc-900 dark:shadow-none",children:(0,e.jsx)(Oe,{})})]})})]}),(0,e.jsxs)("div",{className:"shrink-0 z-30 border-t border-zinc-200/50 bg-white/80 p-3 pb-safe backdrop-blur-xl dark:border-zinc-800/50 dark:bg-black/80 md:p-4",children:[(0,e.jsx)(le,{children:u&&(0,e.jsxs)(K.div,{initial:{height:0,opacity:0,marginBottom:0},animate:{height:"auto",opacity:1,marginBottom:12},exit:{height:0,opacity:0,marginBottom:0},className:"flex items-center justify-between rounded-xl border border-violet-100 bg-violet-50/50 p-2 backdrop-blur-sm dark:border-violet-900/30 dark:bg-violet-900/10 mb-2",children:[(0,e.jsxs)("div",{className:"min-w-0 flex-1 border-l-4 border-violet-500 pl-3",children:[(0,e.jsxs)("span",{className:"mb-0.5 block text-xs font-bold text-violet-600 dark:text-violet-400",children:["Replying to"," ",u.sender==="me"?"yourself":t.user.name]}),(0,e.jsx)("p",{className:"truncate text-sm text-zinc-600 dark:text-zinc-400",children:u.text||"Media Attachment"})]}),(0,e.jsx)("button",{onClick:()=>j(null),className:"rounded-full p-2 text-zinc-400 transition-colors hover:bg-violet-100 dark:hover:bg-violet-900/30","aria-label":"Cancel reply",children:(0,e.jsx)(ae,{size:18})})]})}),c.length>0&&(0,e.jsxs)("div",{className:"mb-3 flex flex-wrap gap-2",children:[c.map(r=>(0,e.jsxs)("div",{className:"relative size-20 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm dark:border-zinc-800",children:[(0,e.jsx)("img",{src:r.url,className:"size-full object-cover",alt:""}),(0,e.jsx)("button",{type:"button",onClick:()=>V(r.url),className:"absolute right-1 top-1 rounded-full bg-black/60 p-1 text-white backdrop-blur-md transition-colors hover:bg-black",children:(0,e.jsx)(ae,{size:12})})]},r.url)),M&&(0,e.jsx)("div",{className:"flex size-20 items-center justify-center rounded-2xl bg-zinc-100 dark:bg-zinc-900",children:(0,e.jsx)(se,{className:"animate-spin text-violet-500",size:24})})]}),(0,e.jsxs)("form",{onSubmit:F,className:"flex items-end gap-2 rounded-[26px] border border-zinc-200 bg-zinc-50/50 p-1.5 shadow-sm transition-all focus-within:border-violet-500/50 focus-within:bg-white focus-within:ring-4 focus-within:ring-violet-500/10 dark:border-zinc-800 dark:bg-zinc-900/50 dark:focus-within:bg-black",children:[(0,e.jsxs)("div",{className:"flex items-center gap-0.5 pb-0.5 pl-1",children:[(0,e.jsxs)(Le,{open:y,onOpenChange:C,children:[(0,e.jsx)(Ee,{asChild:!0,children:(0,e.jsx)("button",{type:"button",className:"rounded-full p-2.5 text-zinc-500 transition-colors hover:bg-zinc-200 hover:text-violet-600 active:scale-95 dark:hover:bg-zinc-800",children:(0,e.jsx)(be,{size:24})})}),(0,e.jsx)(Ie,{className:"w-fit border-none bg-transparent p-0 shadow-none",side:"top",align:"start",sideOffset:10,children:(0,e.jsx)($e,{onEmojiSelect:r=>{L(r)}})})]}),(0,e.jsx)("button",{type:"button",onClick:()=>N.current?.click(),className:"rounded-full p-2.5 text-zinc-500 transition-colors hover:bg-zinc-200 hover:text-violet-600 active:scale-95 dark:hover:bg-zinc-800",disabled:M,children:(0,e.jsx)(Ce,{size:24})})]}),(0,e.jsx)("textarea",{className:"max-h-32 min-h-[44px] w-full flex-1 resize-none bg-transparent px-2 py-3 text-[16px] outline-none placeholder:text-zinc-400 dark:text-white",placeholder:"Message...",value:b,onChange:r=>o(r),rows:1,onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),F(r))}}),(0,e.jsx)("input",{type:"file",ref:N,onChange:R,className:"hidden",multiple:!0,accept:"image/*"}),(0,e.jsx)("div",{className:"pb-1 pr-1",children:(0,e.jsx)(Ye,{type:"submit",className:`size-11 rounded-full !p-0 transition-all active:scale-95 ${b.trim()||c.length>0?"bg-violet-600 hover:bg-violet-700 hover:scale-105 shadow-md shadow-violet-500/20":"bg-zinc-200 text-zinc-400 dark:bg-zinc-800"}`,disabled:!b.trim()&&c.length===0||M,children:b.trim()||c.length>0?(0,e.jsx)(ke,{size:20,className:"translate-x-0.5 translate-y-0.5"}):(0,e.jsx)(we,{size:22})})})]})]})]})},ss=es,ts=ce(),rs=()=>{const t=(0,ts.c)(28),{id:s,currentUser:a,onlineUsers:v,msgSearchQuery:k,setMsgSearchQuery:h,userSearchResults:x,filteredConversations:z,selectedConversation:m,localMessages:i,isConvLoading:I,isMsgLoading:w,currentIsTyping:b,otherUserIsOnline:f,handleStartConversation:M,handleSelectConversation:P,sendMessage:c,sendTypingStatus:g,navigate:y}=Ke();if(!a){let o;return t[0]===Symbol.for("react.memo_cache_sentinel")?(o=(0,e.jsxs)("div",{className:"flex h-screen flex-col items-center justify-center gap-4 border-zinc-100 bg-white p-8 text-center dark:border-zinc-800 dark:bg-black md:rounded-xl md:border",children:[(0,e.jsx)("div",{className:"rounded-full bg-zinc-100 p-4 dark:bg-zinc-900",children:(0,e.jsx)(je,{size:40,className:"text-zinc-400"})}),(0,e.jsx)("h3",{className:"text-xl font-bold dark:text-white",children:"Sign in to message others"}),(0,e.jsx)("p",{className:"max-w-xs text-zinc-500",children:"Start decentralized conversations with anyone on the network."})]}),t[0]=o):o=t[0],o}if(I){let o;return t[1]===Symbol.for("react.memo_cache_sentinel")?(o=(0,e.jsx)("div",{className:"flex h-screen items-center justify-center border-zinc-100 bg-white dark:border-zinc-800 dark:bg-black md:rounded-xl md:border",children:(0,e.jsx)(se,{className:"animate-spin text-violet-500",size:32})}),t[1]=o):o=t[1],o}const C=`flex ${s?"h-[100dvh]":"h-[calc(100dvh-4rem)]"} overflow-hidden border-zinc-100 bg-white shadow-2xl dark:border-zinc-800 dark:bg-black md:h-[calc(100vh-1.5rem)] md:rounded-2xl md:border`,u=`flex-col border-r border-zinc-100 dark:border-zinc-800 md:flex md:w-[380px] ${m?"hidden":"flex"} h-full min-h-0 shrink-0 w-full bg-white dark:bg-black`,j=s??null;let N;t[2]!==z||t[3]!==P||t[4]!==M||t[5]!==k||t[6]!==v||t[7]!==h||t[8]!==j||t[9]!==x?(N=(0,e.jsx)("div",{className:"flex-1 min-h-0 flex flex-col overflow-y-auto",children:(0,e.jsx)(_e,{conversations:z,userResults:x,onSelect:P,onStartNew:M,selectedId:j,searchQuery:k,onSearchChange:h,onlineUsers:v})}),t[2]=z,t[3]=P,t[4]=M,t[5]=k,t[6]=v,t[7]=h,t[8]=j,t[9]=x,t[10]=N):N=t[10];let p;t[11]!==u||t[12]!==N?(p=(0,e.jsx)("div",{className:u,children:N}),t[11]=u,t[12]=N,t[13]=p):p=t[13];let d;t[14]!==b||t[15]!==a||t[16]!==w||t[17]!==i||t[18]!==y||t[19]!==f||t[20]!==m||t[21]!==c||t[22]!==g?(d=m?(0,e.jsx)(ss,{conversation:m,messages:i,onBack:()=>y("/messages"),onSendMessage:c,currentUser:a,onTyping:o=>g(m.id,o),isLoading:w,isTyping:!!b,isOnline:!!f}):(0,e.jsxs)("div",{className:"hidden flex-1 flex-col items-center justify-center gap-6 text-zinc-500 md:flex bg-zinc-50/50 dark:bg-zinc-900/10",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute -inset-4 rounded-full bg-violet-500/10 blur-xl dark:bg-violet-500/20"}),(0,e.jsx)("div",{className:"relative rounded-[2rem] bg-white p-8 shadow-2xl dark:bg-zinc-900 ring-1 ring-black/5 dark:ring-white/10",children:(0,e.jsx)(ye,{size:64,className:"text-violet-500"})})]}),(0,e.jsxs)("div",{className:"text-center max-w-sm px-4",children:[(0,e.jsx)("h3",{className:"mb-2 text-2xl font-black text-zinc-900 dark:text-white",children:"Your Messages"}),(0,e.jsx)("p",{className:"text-zinc-500 leading-relaxed",children:"Send private photos and messages to a friend or group. Start a new chat to get started!"})]})]}),t[14]=b,t[15]=a,t[16]=w,t[17]=i,t[18]=y,t[19]=f,t[20]=m,t[21]=c,t[22]=g,t[23]=d):d=t[23];let T;return t[24]!==C||t[25]!==p||t[26]!==d?(T=(0,e.jsxs)("div",{className:C,children:[p,d]}),t[24]=C,t[25]=p,t[26]=d,t[27]=T):T=t[27],T},xs=rs;export{xs as default};
