import{a as te}from"./rolldown-runtime-BaZ8gS7u.js";import{T as oe,s as W,u as de,y as re}from"./framework-DIDnLsp9.js";import"./database-DlIwwAmc.js";import{An as xe,Bt as me,Hn as he,Mn as ue,Nt as pe,Pn as be,Pt as Z,Rt as fe,Un as je,Wt as Y,Xn as ge,Zt as ve,en as ze,fn as Ne,hn as G,on as ke,qn as we,qt as ae}from"./ui-libs-NviTY6uf.js";import{$ as _,A as ye,B as Ce,F as ie,G as Se,H as Me,I as ne,J as $e,K as Ie,P as le,Q as Te,U as ee,V as Pe,W as Q,X as Re,Y as V,Z as se,dt as Ue,et as q,ft as Ae,h as Oe,k as Ee,q as Le,tt as B,vt as De}from"./index-B0vM2eEQ.js";import{n as _e,t as qe}from"./linkify-DSSf-wBZ.js";import{a as Be,u as ce}from"./hooks-C5icFmhq.js";var We=W(),R=te(oe(),1),e=te(de(),1),Fe=t=>{const s=(0,We.c)(55),{conv:a,selectedId:b,onSelect:o,onlineUsers:c}=t,d=re(),l=ce(a.user?.lastSeen);let i;s[0]!==a.user?.id||s[1]!==c?(i=c.has(a.user?.id),s[0]=a.user?.id,s[1]=c,s[2]=i):i=s[2];const m=i;let v;s[3]!==a.user||s[4]!==d?(v=F=>{F.stopPropagation(),a.user?.handle&&d(`/u/${a.user.handle}`)},s[3]=a.user,s[4]=d,s[5]=v):v=s[5];const x=v;let j;s[6]!==a||s[7]!==o?(j=()=>o(a),s[6]=a,s[7]=o,s[8]=j):j=s[8];const g=`flex cursor-pointer items-center gap-3 p-4 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900 ${b===a.id?"border-r-2 border-violet-500 bg-zinc-50 dark:bg-zinc-900":""}`,w=a.user?.avatar,P=a.user?.name;let y;s[9]!==w||s[10]!==P?(y=(0,e.jsx)(B,{src:w,alt:P,className:"object-cover"}),s[9]=w,s[10]=P,s[11]=y):y=s[11];let f;s[12]!==a.user?.name?.[0]?(f=a.user?.name?.[0]?.toUpperCase(),s[12]=a.user?.name?.[0],s[13]=f):f=s[13];let k;s[14]!==f?(k=(0,e.jsx)(q,{children:f}),s[14]=f,s[15]=k):k=s[15];let M;s[16]!==y||s[17]!==k?(M=(0,e.jsxs)(_,{className:"size-12 transition-all group-hover:brightness-90",children:[y,k]}),s[16]=y,s[17]=k,s[18]=M):M=s[18];let $;s[19]!==m?($=m&&(0,e.jsx)("span",{className:"absolute bottom-0 right-0 size-3 rounded-full border-2 border-white bg-emerald-500 dark:border-black"}),s[19]=m,s[20]=$):$=s[20];let z;s[21]!==x||s[22]!==M||s[23]!==$?(z=(0,e.jsxs)("div",{className:"group relative",onClick:x,children:[M,$]}),s[21]=x,s[22]=M,s[23]=$,s[24]=z):z=s[24];const I=a.user?.name;let C;s[25]!==x||s[26]!==I?(C=(0,e.jsx)("span",{onClick:x,className:"mt-1 cursor-pointer truncate font-bold dark:text-white",children:I}),s[25]=x,s[26]=I,s[27]=C):C=s[27];let p;s[28]!==a.user?.lastSeen||s[29]!==m||s[30]!==l?(p=m?(0,e.jsx)("span",{className:"mb-1 text-[10px] font-medium leading-none text-emerald-500",children:"Online"}):a.user?.lastSeen&&(0,e.jsx)("span",{className:"mb-1 text-[10px] font-medium leading-none text-zinc-500",children:l}),s[28]=a.user?.lastSeen,s[29]=m,s[30]=l,s[31]=p):p=s[31];let u;s[32]!==C||s[33]!==p?(u=(0,e.jsxs)("div",{className:"flex min-w-0 flex-col",children:[C,p]}),s[32]=C,s[33]=p,s[34]=u):u=s[34];let N;s[35]!==a.time?(N=(0,e.jsx)("span",{className:"ml-2 whitespace-nowrap text-xs text-zinc-500",children:a.time}),s[35]=a.time,s[36]=N):N=s[36];let S;s[37]!==u||s[38]!==N?(S=(0,e.jsxs)("div",{className:"mb-0.5 flex items-center justify-between",children:[u,N]}),s[37]=u,s[38]=N,s[39]=S):S=s[39];let h;s[40]!==a.lastMessage?(h=(0,e.jsx)("p",{className:"truncate pr-2 text-sm text-zinc-500",children:a.lastMessage}),s[40]=a.lastMessage,s[41]=h):h=s[41];let A;s[42]!==a.unread?(A=a.unread>0&&(0,e.jsx)("span",{className:"flex size-5 shrink-0 items-center justify-center rounded-full bg-violet-600 text-[10px] font-bold text-white",children:a.unread}),s[42]=a.unread,s[43]=A):A=s[43];let O;s[44]!==h||s[45]!==A?(O=(0,e.jsxs)("div",{className:"flex flex-1 items-center justify-between",children:[h,A]}),s[44]=h,s[45]=A,s[46]=O):O=s[46];let E;s[47]!==S||s[48]!==O?(E=(0,e.jsxs)("div",{className:"min-w-0 flex-1",children:[S,O]}),s[47]=S,s[48]=O,s[49]=E):E=s[49];let L;return s[50]!==z||s[51]!==E||s[52]!==j||s[53]!==g?(L=(0,e.jsxs)("div",{onClick:j,className:g,children:[z,E]}),s[50]=z,s[51]=E,s[52]=j,s[53]=g,s[54]=L):L=s[54],L},Ke=({conversations:t,userResults:s=[],onSelect:a,onStartNew:b,selectedId:o,searchQuery:c,onSearchChange:d,onlineUsers:l=new Set})=>(0,e.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col bg-white dark:bg-black",children:[(0,e.jsx)("div",{className:"border-b border-zinc-100 p-4 dark:border-zinc-800",children:(0,e.jsx)(Ee,{value:c,onChange:d,onClear:()=>d(""),placeholder:"Search people or messages..."})}),(0,e.jsx)("div",{className:"flex-1 min-h-0 relative",children:(0,e.jsx)(ye,{className:"absolute inset-0 h-full",children:(0,e.jsxs)("div",{className:"flex flex-col min-h-full",children:[t.length>0&&(0,e.jsx)("div",{className:"py-2",children:t.filter(i=>i.lastMessage!=="No messages yet"||i.id===o).map(i=>(0,e.jsx)(Fe,{conv:i,selectedId:o,onSelect:a,onlineUsers:l},i.id))}),s.length>0&&(0,e.jsxs)("div",{className:"border-t border-zinc-100 dark:border-zinc-800",children:[(0,e.jsx)("div",{className:"px-4 py-3 text-xs font-bold uppercase tracking-wider text-zinc-500",children:"People"}),s.map(i=>(0,e.jsxs)("div",{onClick:()=>b(i),className:"flex cursor-pointer items-center gap-3 p-4 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[(0,e.jsxs)(_,{className:"size-12",children:[(0,e.jsx)(B,{src:i.avatar,alt:i.name,className:"object-cover"}),(0,e.jsx)(q,{children:i.name?.[0]?.toUpperCase()})]}),(0,e.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,e.jsx)("div",{className:"truncate font-bold dark:text-white",children:i.name}),(0,e.jsxs)("div",{className:"truncate text-sm text-zinc-500",children:["@",i.handle]})]}),(0,e.jsx)(me,{size:18,className:"text-violet-500"})]},i.id))]}),t.length===0&&s.length===0&&c&&(0,e.jsx)("div",{className:"p-8 text-center",children:(0,e.jsxs)("p",{className:"text-sm text-zinc-500",children:['No conversations or people found for "',c,'"']})}),t.length===0&&!c&&(0,e.jsx)("div",{className:"p-8 text-center",children:(0,e.jsx)("p",{className:"text-sm text-zinc-500",children:"No messages yet. Search for people to start a chat!"})})]})})})]}),Qe=Ke,Ve=W(),Ge=["â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ‘"],He=t=>{const s=(0,Ve.c)(6),{onSelect:a,currentReaction:b}=t;let o;s[0]===Symbol.for("react.memo_cache_sentinel")?(o=(0,e.jsx)(ne,{asChild:!0,children:(0,e.jsx)("button",{className:"rounded-full p-1.5 text-zinc-400 transition-all hover:bg-zinc-100 hover:text-zinc-600 active:scale-90 dark:hover:bg-zinc-800 dark:hover:text-zinc-300",onClick:Xe,children:(0,e.jsx)(ae,{size:16})})}),s[0]=o):o=s[0];let c;s[1]!==b||s[2]!==a?(c=Ge.map(l=>(0,e.jsx)("button",{onClick:()=>a(l),className:`rounded-full p-2 text-xl transition-all hover:bg-zinc-100 active:scale-125 dark:hover:bg-zinc-800 ${b===l?"bg-zinc-100 dark:bg-zinc-800":""}`,children:l},l)),s[1]=b,s[2]=a,s[3]=c):c=s[3];let d;return s[4]!==c?(d=(0,e.jsxs)(le,{children:[o,(0,e.jsx)(ie,{side:"top",align:"center",className:"w-fit border border-zinc-100 bg-white p-1 shadow-xl dark:border-zinc-800 dark:bg-zinc-900 rounded-full",onClick:Ze,children:(0,e.jsx)("div",{className:"flex items-center gap-1",children:c})})]}),s[4]=c,s[5]=d):d=s[5],d},Je=He;function Xe(t){return t.stopPropagation()}function Ze(t){return t.stopPropagation()}var Ye=W(),es=t=>{const s=(0,Ye.c)(10),{reactions:a,currentUser:b,onToggle:o}=t;let c;s[0]!==a?(c=a===void 0?[]:a,s[0]=a,s[1]=c):c=s[1];const d=c;let l;s[2]!==b?.id||s[3]!==d?(l={},d.forEach(x=>{l[x.emoji]||(l[x.emoji]={count:0,me:!1}),l[x.emoji].count=l[x.emoji].count+1,x.user_id===b?.id&&(l[x.emoji].me=!0)}),s[2]=b?.id,s[3]=d,s[4]=l):l=s[4];const i=l;if(d.length===0)return null;let m;s[5]!==i?(m=Object.entries(i),s[5]=i,s[6]=m):m=s[6];let v;return s[7]!==o||s[8]!==m?(v=(0,e.jsx)("div",{className:"mt-1 flex flex-wrap gap-1 px-2",children:m.map(x=>{const[j,g]=x;return(0,e.jsxs)("button",{onClick:w=>{w.stopPropagation(),o(j)},className:`flex items-center gap-1.5 rounded-full border px-2 py-0.5 text-xs font-medium transition-all active:scale-90 ${g.me?"border-violet-200 bg-violet-50 text-violet-600 dark:border-violet-800 dark:bg-violet-900/30 dark:text-violet-400":"border-zinc-100 bg-white text-zinc-600 dark:border-zinc-800 dark:bg-zinc-900 dark:text-zinc-400"}`,children:[(0,e.jsx)("span",{children:j}),g.count>1&&(0,e.jsx)("span",{children:g.count})]},j)})}),s[7]=o,s[8]=m,s[9]=v):v=s[9],v},ss=es,ts=["â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ‘"],rs=({conversation:t,messages:s,onBack:a,onSendMessage:b,onToggleReaction:o,onDeleteMessage:c,currentUser:d,onTyping:l,isLoading:i,isTyping:m,isOnline:v})=>{const x=re(),{openLightbox:j}=Ae(),[g,w]=(0,R.useState)(""),[P,y]=(0,R.useState)(!1),[f,k]=(0,R.useState)([]),[M,$]=(0,R.useState)(!1),[z,I]=(0,R.useState)(null),C=(0,R.useRef)(null),p=(0,R.useRef)(null),u=(0,R.useRef)(null),N=ce(t.user?.lastSeen);(0,R.useEffect)(()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)},[s,m]);const S=r=>{const n=r.target.value;w(n),l&&(l(!0),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{l(!1)},2e3))},h=r=>{w(n=>n+r.emoji)},A=r=>{r.preventDefault(),!(!g.trim()&&f.length===0)&&(l&&(u.current&&clearTimeout(u.current),l(!1)),b(t.id,g,f.length>0?"image":"text",f,z?.id),w(""),k([]),I(null))},O=async r=>{if(!r.target.files)return;const n=Array.from(r.target.files);if(n.length!==0){y(!0);try{const T=await Promise.all(n.map(U=>De(U)));k(U=>[...U,...T])}catch(T){console.error("Upload failed:",T)}finally{y(!1)}}},E=r=>{k(n=>n.filter(T=>T.url!==r))},L=r=>{!r.media||r.media.length===0||j(r.media.map(n=>n.url),0)},F=(0,R.useMemo)(()=>{const r=s.filter(n=>n.sender==="me");return r.length>0?r[r.length-1].id:null},[s]),H=r=>s.find(n=>n.id===r);return(0,e.jsxs)("div",{className:"flex h-full min-w-0 flex-1 flex-col bg-white dark:bg-black md:border-l md:border-zinc-100 dark:md:border-zinc-800",children:[(0,e.jsxs)("div",{className:"sticky top-0 z-10 flex shrink-0 items-center justify-between border-b border-zinc-100 bg-white/80 p-4 backdrop-blur-md dark:border-zinc-800 dark:bg-black/80",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)("button",{onClick:a,className:"rounded-full p-1 transition-colors hover:bg-zinc-100 dark:text-white dark:hover:bg-zinc-800 md:hidden","aria-label":"Back",children:(0,e.jsx)(ge,{size:20})}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsxs)(_,{className:"size-10 border border-zinc-200 dark:border-zinc-700",children:[(0,e.jsx)(B,{src:t.user.avatar,alt:t.user.name,className:"object-cover"}),(0,e.jsx)(q,{children:t.user.name?.[0]?.toUpperCase()})]}),v&&(0,e.jsx)("span",{className:"absolute bottom-0 right-0 size-3 rounded-full border-2 border-white bg-emerald-500 dark:border-black"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"font-bold dark:text-white",children:t.user.name}),v?(0,e.jsxs)("div",{className:"flex items-center gap-1 text-xs font-medium text-emerald-500",children:[(0,e.jsx)("span",{className:"size-1.5 animate-pulse rounded-full bg-emerald-500"}),"Online"]}):(0,e.jsx)("div",{className:"text-xs font-medium text-zinc-500",children:t.user.lastSeen?`Last seen ${N}`:"Offline"})]})]}),(0,e.jsxs)(Pe,{children:[(0,e.jsx)(Ie,{asChild:!0,children:(0,e.jsx)("button",{className:"rounded-full p-2 hover:bg-zinc-100 dark:text-zinc-400 dark:hover:bg-zinc-800","aria-label":"More options",children:(0,e.jsx)(ue,{size:20})})}),(0,e.jsxs)(Me,{align:"end",className:"w-56",children:[(0,e.jsxs)(ee,{children:[(0,e.jsxs)("button",{onClick:()=>x(`/u/${t.user.handle}`),className:"flex w-full items-center gap-3 rounded-lg px-3 py-2 text-sm transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800",children:[(0,e.jsx)(fe,{size:16}),(0,e.jsx)("span",{children:"View Profile"})]}),(0,e.jsxs)(Q,{className:"cursor-pointer gap-2",children:[(0,e.jsx)(we,{size:16}),"Mute Notifications"]})]}),(0,e.jsx)(Se,{}),(0,e.jsxs)(ee,{children:[(0,e.jsxs)(Q,{className:"cursor-pointer gap-2",children:[(0,e.jsx)(xe,{size:16}),"Clear Chat"]}),(0,e.jsxs)(Q,{variant:"destructive",className:"cursor-pointer gap-2",children:[(0,e.jsx)(Y,{size:16}),"Delete Conversation"]})]})]})]})]}),(0,e.jsxs)("div",{className:"flex-1 min-h-0 space-y-4 overflow-y-auto p-4",ref:p,children:[(0,e.jsxs)("div",{className:"py-8 text-center",children:[(0,e.jsxs)("div",{className:"relative mx-auto w-fit",children:[(0,e.jsxs)(_,{className:"mx-auto mb-3 size-20 border-4 border-zinc-50 shadow-sm dark:border-zinc-900",children:[(0,e.jsx)(B,{src:t.user.avatar,alt:t.user.name,className:"object-cover"}),(0,e.jsx)(q,{className:"text-2xl font-bold",children:t.user.name?.[0]?.toUpperCase()})]}),v&&(0,e.jsx)("span",{className:"absolute bottom-4 right-1 size-5 animate-in zoom-in rounded-full border-4 border-white bg-emerald-500 duration-300 dark:border-black"})]}),(0,e.jsx)("h4",{className:"text-lg font-bold dark:text-white",children:t.user.name}),(0,e.jsxs)("p",{className:"text-sm text-zinc-500",children:["@",t.user.handle]}),(0,e.jsxs)("p",{className:"mx-auto mt-4 max-w-xs text-xs text-zinc-400",children:["This is the beginning of your direct message history with"," ",(0,e.jsxs)("span",{className:"font-bold",children:["@",t.user.handle]})]})]}),i&&s.length===0?(0,e.jsx)("div",{className:"flex justify-center p-8",children:(0,e.jsx)(G,{className:"animate-spin text-violet-500",size:32})}):s.map(r=>(0,e.jsxs)(Le,{children:[(0,e.jsx)(Te,{asChild:!0,children:(0,e.jsxs)("div",{id:`msg-${r.id}`,className:`group flex items-end gap-2 ${r.sender==="me"?"flex-row-reverse":"flex-row"}`,children:[(0,e.jsxs)("div",{className:`relative max-w-[75%] rounded-2xl p-1 text-[15px] shadow-sm ${r.sender==="me"?"rounded-tr-none bg-violet-600 text-white":"rounded-tl-none bg-zinc-100 dark:bg-zinc-800 dark:text-white"}`,children:[r.replyToId&&(0,e.jsxs)("div",{className:`mb-2 cursor-pointer truncate rounded-lg border-l-4 p-2 text-xs ${r.sender==="me"?"border-violet-300 bg-violet-500/50 text-violet-100":"border-zinc-400 bg-zinc-200/50 text-zinc-600 dark:border-zinc-500 dark:bg-zinc-700/50 dark:text-zinc-300"}`,onClick:n=>{n.stopPropagation(),document.getElementById(`msg-${r.replyToId}`)?.scrollIntoView({behavior:"smooth",block:"center"})},children:[(0,e.jsx)("span",{className:"mb-0.5 block font-bold",children:H(r.replyToId)?.sender==="me"?"You":t.user.name}),H(r.replyToId)?.text||"Media"]}),r.media?.length>0&&(0,e.jsx)("div",{className:"mb-2 grid cursor-pointer grid-cols-1 gap-1 overflow-hidden rounded-lg",onClick:()=>L(r),children:r.media.map((n,T)=>(0,e.jsx)("img",{src:n.url,alt:"",className:"max-h-60 w-full rounded-md object-cover transition-all hover:brightness-90"},T))}),r.text&&(0,e.jsx)("div",{className:"m-0 break-words whitespace-pre-line px-3 py-1 leading-tight",children:(0,e.jsx)(_e,{options:{...qe,render:({attributes:n,content:T})=>{const{href:U,...J}=n,X=window.location.origin;let D=null;return U.startsWith("/")?D=U:U.startsWith(X)&&(D=U.replace(X,"")),D?(0,e.jsx)("span",{...J,className:`cursor-pointer break-all font-semibold underline decoration-1 underline-offset-4 transition-opacity ${r.sender==="me"?"text-white":"text-violet-600 dark:text-violet-400"}`,onClick:K=>{K.stopPropagation(),x(D)},children:T},T):(0,e.jsx)("a",{href:U,...J,className:`break-all underline decoration-1 underline-offset-4 transition-opacity hover:opacity-80 ${r.sender==="me"?"text-white":"text-violet-600 dark:text-violet-400"}`,target:"_blank",rel:"noopener noreferrer",onClick:K=>K.stopPropagation(),children:T},T)}},children:r.text})}),r.reactions?.length>0&&(0,e.jsx)(ss,{reactions:r.reactions,currentUser:d,onToggle:n=>o(r.id,n)}),(0,e.jsxs)("div",{className:`flex items-center justify-end gap-1 px-3 pb-1 text-[10px] ${r.sender==="me"?"text-violet-200":"text-zinc-400"}`,children:[r.time,r.sender==="me"&&r.id===F&&(0,e.jsx)("span",{className:"ml-0.5",children:r.isRead?(0,e.jsx)(je,{size:14,className:"text-white"}):(0,e.jsx)(he,{size:14,className:"text-violet-200"})})]})]}),(0,e.jsx)("div",{className:"opacity-0 transition-opacity group-hover:opacity-100",children:(0,e.jsx)(Je,{onSelect:n=>o(r.id,n),currentReaction:r.reactions?.find(n=>n.user_id===d?.id)?.emoji})})]})}),(0,e.jsxs)($e,{className:"w-64 rounded-xl border-zinc-100 bg-white shadow-xl dark:border-zinc-800 dark:bg-zinc-950",children:[(0,e.jsx)(Re,{className:"px-3 py-2 text-xs font-bold text-zinc-500",children:"QUICK REACTION"}),(0,e.jsx)("div",{className:"flex items-center justify-between px-2 pb-2",children:ts.map(n=>(0,e.jsx)("button",{onClick:()=>o(r.id,n),className:"rounded-full p-2 text-xl transition-all hover:bg-zinc-100 active:scale-125 dark:hover:bg-zinc-800","aria-label":`React with ${n}`,children:n},n))}),(0,e.jsx)(se,{className:"bg-zinc-100 dark:bg-zinc-800"}),(0,e.jsxs)(V,{className:"cursor-pointer gap-3 px-3 py-2.5 focus:bg-zinc-50 dark:focus:bg-zinc-900",onClick:()=>{navigator.clipboard.writeText(r.text)},children:[(0,e.jsx)(be,{size:16,className:"text-zinc-500"}),(0,e.jsx)("span",{className:"font-medium",children:"Copy Text"})]}),(0,e.jsxs)(V,{className:"cursor-pointer gap-3 px-3 py-2.5 focus:bg-zinc-50 dark:focus:bg-zinc-900",onClick:()=>I(r),children:[(0,e.jsx)(ze,{size:16,className:"text-zinc-500"}),(0,e.jsx)("span",{className:"font-medium",children:"Reply"})]}),(0,e.jsx)(se,{className:"bg-zinc-100 dark:bg-zinc-800"}),(0,e.jsxs)(V,{className:"cursor-pointer gap-3 px-3 py-2.5 text-rose-500 focus:bg-rose-50 focus:text-rose-500 dark:focus:bg-rose-900/20",onClick:()=>c&&c(r.id),children:[(0,e.jsx)(Y,{size:16}),(0,e.jsx)("span",{className:"font-medium",children:"Delete message"})]})]})]},r.id)),m&&(0,e.jsx)("div",{className:"flex animate-in fade-in slide-in-from-bottom-2 justify-start duration-300",children:(0,e.jsx)("div",{className:"rounded-2xl rounded-tl-none border border-zinc-200/50 bg-zinc-100 px-3 py-2 shadow-sm dark:border-zinc-700/30 dark:bg-zinc-800/50",children:(0,e.jsx)(Oe,{})})})]}),(0,e.jsxs)("div",{className:"shrink-0 border-t border-zinc-100 bg-white p-4 dark:border-zinc-800 dark:bg-black",children:[z&&(0,e.jsxs)("div",{className:"mb-3 flex animate-in slide-in-from-bottom-2 items-center justify-between rounded-xl border border-zinc-100 bg-zinc-50 p-3 duration-200 dark:border-zinc-800 dark:bg-zinc-900",children:[(0,e.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,e.jsxs)("span",{className:"mb-1 block text-xs font-bold text-violet-600 dark:text-violet-400",children:["Replying to"," ",z.sender==="me"?"yourself":t.user.name]}),(0,e.jsx)("p",{className:"truncate text-sm text-zinc-500",children:z.text||"Media"})]}),(0,e.jsx)("button",{onClick:()=>I(null),className:"rounded-full p-1 text-zinc-400 transition-colors hover:bg-zinc-200 dark:hover:bg-zinc-800","aria-label":"Cancel reply",children:(0,e.jsx)(Z,{size:18})})]}),f.length>0&&(0,e.jsxs)("div",{className:"mb-3 flex flex-wrap gap-2",children:[f.map(r=>(0,e.jsxs)("div",{className:"relative size-16 overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[(0,e.jsx)("img",{src:r.url,className:"size-full object-cover",alt:""}),(0,e.jsx)("button",{type:"button",onClick:()=>E(r.url),className:"absolute right-1 top-1 rounded-full bg-black/50 p-0.5 text-white transition-colors hover:bg-black","aria-label":"Remove attachment",children:(0,e.jsx)(Z,{size:12})})]},r.url)),P&&(0,e.jsx)("div",{className:"flex size-16 items-center justify-center rounded-xl bg-zinc-100 dark:bg-zinc-900",children:(0,e.jsx)(G,{className:"animate-spin text-violet-500",size:20})})]}),(0,e.jsxs)("form",{onSubmit:A,className:"flex items-center gap-2 rounded-2xl border border-transparent bg-zinc-100 p-2 transition-all focus-within:border-violet-500 dark:bg-zinc-900",children:[(0,e.jsxs)(le,{open:M,onOpenChange:$,children:[(0,e.jsx)(ne,{asChild:!0,children:(0,e.jsx)("button",{type:"button",className:"p-2 text-zinc-500 transition-colors hover:text-violet-600","aria-label":"Add emoji",children:(0,e.jsx)(ae,{size:20})})}),(0,e.jsx)(ie,{className:"w-fit border-none bg-transparent p-0 shadow-none",side:"top",align:"start",sideOffset:10,children:(0,e.jsx)(Ce,{onEmojiSelect:r=>{h(r)}})})]}),(0,e.jsx)("input",{type:"text",className:"min-w-0 flex-1 border-none bg-transparent px-1 py-1 outline-none dark:text-white",placeholder:"Start a new message",value:g,onChange:S,"aria-label":"Message text"}),(0,e.jsx)("input",{type:"file",ref:C,onChange:O,className:"hidden",multiple:!0,accept:"image/*"}),(0,e.jsx)("button",{type:"button",onClick:()=>C.current?.click(),className:"p-2 text-zinc-500 transition-colors hover:text-violet-600",disabled:P,"aria-label":"Attach file",children:(0,e.jsx)(ke,{size:20})}),(0,e.jsx)(Ue,{type:"submit",className:"size-10 rounded-xl !p-0",disabled:!g.trim()&&f.length===0||P,"aria-label":"Send message",children:(0,e.jsx)(ve,{size:18})})]})]})]})},as=rs,is=W(),ns=()=>{const t=(0,is.c)(30),{id:s,currentUser:a,onlineUsers:b,msgSearchQuery:o,setMsgSearchQuery:c,userSearchResults:d,filteredConversations:l,selectedConversation:i,localMessages:m,isConvLoading:v,isMsgLoading:x,currentIsTyping:j,otherUserIsOnline:g,handleStartConversation:w,handleSelectConversation:P,sendMessage:y,sendTypingStatus:f,onToggleReaction:k,navigate:M}=Be();if(!a){let h;return t[0]===Symbol.for("react.memo_cache_sentinel")?(h=(0,e.jsxs)("div",{className:"flex h-screen flex-col items-center justify-center gap-4 border-zinc-100 bg-white p-8 text-center dark:border-zinc-800 dark:bg-black md:rounded-xl md:border",children:[(0,e.jsx)("div",{className:"rounded-full bg-zinc-100 p-4 dark:bg-zinc-900",children:(0,e.jsx)(pe,{size:40,className:"text-zinc-400"})}),(0,e.jsx)("h3",{className:"text-xl font-bold dark:text-white",children:"Sign in to message others"}),(0,e.jsx)("p",{className:"max-w-xs text-zinc-500",children:"Start decentralized conversations with anyone on the network."})]}),t[0]=h):h=t[0],h}if(v){let h;return t[1]===Symbol.for("react.memo_cache_sentinel")?(h=(0,e.jsx)("div",{className:"flex h-screen items-center justify-center border-zinc-100 bg-white dark:border-zinc-800 dark:bg-black md:rounded-xl md:border",children:(0,e.jsx)(G,{className:"animate-spin text-violet-500",size:32})}),t[1]=h):h=t[1],h}const $=`flex ${s?"h-[100dvh]":"h-[calc(100dvh-4rem)]"} overflow-hidden border-zinc-100 bg-white dark:border-zinc-800 dark:bg-black md:h-[calc(100vh-1.5rem)] md:rounded-xl md:border`,z=`flex-col border-r border-zinc-100 dark:border-zinc-800 md:flex md:w-[380px] ${i?"hidden":"flex"} h-full min-h-0 shrink-0 w-full`;let I;t[2]===Symbol.for("react.memo_cache_sentinel")?(I=(0,e.jsx)("div",{className:"shrink-0 border-b border-zinc-100 p-4 dark:border-zinc-800",children:(0,e.jsx)("h2",{className:"text-xl font-bold dark:text-white",children:"Messages"})}),t[2]=I):I=t[2];const C=s??null;let p;t[3]!==l||t[4]!==P||t[5]!==w||t[6]!==o||t[7]!==b||t[8]!==c||t[9]!==C||t[10]!==d?(p=(0,e.jsx)("div",{className:"flex-1 min-h-0 flex flex-col overflow-y-auto",children:(0,e.jsx)(Qe,{conversations:l,userResults:d,onSelect:P,onStartNew:w,selectedId:C,searchQuery:o,onSearchChange:c,onlineUsers:b})}),t[3]=l,t[4]=P,t[5]=w,t[6]=o,t[7]=b,t[8]=c,t[9]=C,t[10]=d,t[11]=p):p=t[11];let u;t[12]!==z||t[13]!==p?(u=(0,e.jsxs)("div",{className:z,children:[I,p]}),t[12]=z,t[13]=p,t[14]=u):u=t[14];let N;t[15]!==j||t[16]!==a||t[17]!==x||t[18]!==m||t[19]!==M||t[20]!==k||t[21]!==g||t[22]!==i||t[23]!==y||t[24]!==f?(N=i?(0,e.jsx)(as,{conversation:i,messages:m,onBack:()=>M("/messages"),onSendMessage:y,onToggleReaction:k,currentUser:a,onTyping:h=>f(i.id,h),isLoading:x,isTyping:!!j,isOnline:!!g}):(0,e.jsxs)("div",{className:"hidden flex-1 flex-col items-center justify-center gap-4 text-zinc-500 md:flex",children:[(0,e.jsx)("div",{className:"rounded-full bg-zinc-50 p-6 dark:bg-zinc-900",children:(0,e.jsx)(Ne,{size:48,className:"text-zinc-300"})}),(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:"Select a message"}),(0,e.jsx)("p",{children:"Choose from your existing conversations or start a new one."})]})]}),t[15]=j,t[16]=a,t[17]=x,t[18]=m,t[19]=M,t[20]=k,t[21]=g,t[22]=i,t[23]=y,t[24]=f,t[25]=N):N=t[25];let S;return t[26]!==$||t[27]!==u||t[28]!==N?(S=(0,e.jsxs)("div",{className:$,children:[u,N]}),t[26]=$,t[27]=u,t[28]=N,t[29]=S):S=t[29],S},us=ns;export{us as default};
