import{n as et}from"./rolldown-runtime-2JzG8er9.js";import{f as ut,s as U,u as ft,w as ht,y as he}from"./framework-pMVb9Z5_.js";import{n as gt}from"./query-CYcBlx0y.js";import{$t as De,At as pe,Bt as ce,Ft as bt,Gt as ee,Kt as jt,Lt as vt,Mt as zt,Nt,Pt as kt,Yt as yt,Zt as de,an as We,en as wt,gt as Ct,in as _t,jt as Pt,ln as St,lt as ue,rn as $t,sn as Ft,t as tt,tn as Oe,wt as Mt,yt as Rt}from"./ui-libs-Dldhg1Ot.js";import{$ as G,C as Ve,Ct as st,F as It,Ft as Et,G as Ue,H as Lt,It as oe,J as Be,K as qe,M as At,N as Z,O as Dt,P as Wt,Q as T,Rt as Ot,U as He,W as Ge,X as Te,Y as Qe,Z as Q,a as Vt,at as Ut,bt as it,ct as fe,it as Bt,j as qt,jt as Ht,kt as Je,lt as Gt,nt as Tt,q as Ke,rt as Qt,st as Jt,tt as Kt,xt as Xt}from"./index-NMDSp0RP.js";import{n as ge,t as be}from"./linkify-BesW0poa.js";import{u as Yt}from"./hooks-Cl4snLUw.js";var Zt=U(),u=et(ht(),1),t=et(ft(),1),es=s=>{const e=(0,Zt.c)(20),{icon:i,count:r,label:n,onClick:d,active:l,activeColorClass:c}=s,h=c===void 0?"text-violet-600":c,b=i;let o;e[0]!==d?(o=P=>{P.stopPropagation(),d&&d(P)},e[0]=d,e[1]=o):o=e[1];const p=`group flex items-center gap-x-1 sm:gap-x-1.5 text-[12px] sm:text-[13px] font-bold transition-all py-1.5 px-2 -ml-2 rounded-xl active:scale-95 ${l?h:"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"}`,a=`rounded-full p-2 transition-colors ${l?"":"group-hover:bg-zinc-100 dark:group-hover:bg-zinc-800"}`,m=l?2.5:2,x=l?"fill-current":"";let j;e[2]!==b||e[3]!==m||e[4]!==x?(j=(0,t.jsx)(b,{size:18,strokeWidth:m,className:x}),e[2]=b,e[3]=m,e[4]=x,e[5]=j):j=e[5];let k;e[6]!==a||e[7]!==j?(k=(0,t.jsx)("div",{className:a,children:j}),e[6]=a,e[7]=j,e[8]=k):k=e[8];let z;e[9]!==n?(z=n&&(0,t.jsx)("span",{className:"hidden xs:inline",children:n}),e[9]=n,e[10]=z):z=e[10];let w;e[11]!==l||e[12]!==r?(w=r!=null&&(0,t.jsx)("span",{className:l?"font-bold":"",children:r||0}),e[11]=l,e[12]=r,e[13]=w):w=e[13];let v;return e[14]!==w||e[15]!==o||e[16]!==p||e[17]!==k||e[18]!==z?(v=(0,t.jsxs)("button",{onClick:o,className:p,children:[k,z,w]}),e[14]=w,e[15]=o,e[16]=p,e[17]=k,e[18]=z,e[19]=v):v=e[19],v},X=es,ts=U(),ss=s=>{const e=(0,ts.c)(51),{currentUser:i,newComment:r,setNewComment:n,handleSubmitComment:d,loading:l,selectedFiles:c,setSelectedFiles:h,isUploading:b}=s;let o;e[0]!==c?(o=c===void 0?[]:c,e[0]=c,e[1]=o):o=e[1];const p=o,a=(0,u.useRef)(null);let m;e[2]!==h?(m=R=>{const O=Array.from(R.target.files);h&&h(B=>[...B,...O])},e[2]=h,e[3]=m):m=e[3];const x=m;let j;e[4]!==h?(j=R=>{h&&h(O=>O.filter((B,te)=>te!==R))},e[4]=h,e[5]=j):j=e[5];const k=j;if(!i){let R;return e[6]===Symbol.for("react.memo_cache_sentinel")?(R=(0,t.jsx)("div",{className:"p-6 text-center border-y border-zinc-100 dark:border-zinc-800 bg-zinc-50/30 dark:bg-zinc-900/10",children:(0,t.jsx)("p",{className:"text-zinc-500 text-sm",children:"Please login to join the conversation."})}),e[6]=R):R=e[6],R}let z;e[7]!==i.avatar||e[8]!==i.handle?(z=(0,t.jsx)(G,{src:i.avatar,alt:i.handle,className:"object-cover"}),e[7]=i.avatar,e[8]=i.handle,e[9]=z):z=e[9];let w;e[10]!==i.handle?.[0]?(w=i.handle?.[0]?.toUpperCase(),e[10]=i.handle?.[0],e[11]=w):w=e[11];let v;e[12]!==w?(v=(0,t.jsx)(T,{children:w}),e[12]=w,e[13]=v):v=e[13];let P;e[14]!==z||e[15]!==v?(P=(0,t.jsxs)(Q,{className:"size-9 border border-zinc-200 dark:border-zinc-700",children:[z,v]}),e[14]=z,e[15]=v,e[16]=P):P=e[16];let C;e[17]!==n?(C=R=>n(R.target.value),e[17]=n,e[18]=C):C=e[18];let F;e[19]!==r||e[20]!==C?(F=(0,t.jsx)("textarea",{id:"comment-input",className:"w-full bg-transparent outline-none text-base min-h-[60px] resize-none dark:text-white placeholder:text-zinc-500",placeholder:"Post your reply...",value:r,onChange:C}),e[19]=r,e[20]=C,e[21]=F):F=e[21];let I;e[22]!==k||e[23]!==p?(I=p.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-2 mb-2",children:p.map((R,O)=>(0,t.jsxs)("div",{className:"relative size-20 rounded-xl overflow-hidden border border-zinc-200 dark:border-zinc-800",children:[R.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(R),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"size-full flex items-center justify-center bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)(bt,{size:20,className:"text-zinc-500"})}),(0,t.jsx)("button",{onClick:()=>k(O),className:"absolute top-1 right-1 bg-black/60 text-white rounded-full p-1 hover:bg-black transition-colors",children:(0,t.jsx)(ue,{size:12})})]},O))}),e[22]=k,e[23]=p,e[24]=I):I=e[24];let E;e[25]===Symbol.for("react.memo_cache_sentinel")?(E=()=>a.current?.click(),e[25]=E):E=e[25];let M;e[26]===Symbol.for("react.memo_cache_sentinel")?(M=(0,t.jsx)("button",{type:"button",onClick:E,className:"text-violet-600 hover:bg-violet-50 dark:hover:bg-zinc-800 rounded-full p-2 transition-colors",title:"Attach media",children:(0,t.jsx)(yt,{size:20})}),e[26]=M):M=e[26];let L;e[27]!==x?(L=(0,t.jsxs)("div",{className:"flex text-violet-600 gap-1",children:[M,(0,t.jsx)("input",{type:"file",ref:a,onChange:x,multiple:!0,className:"hidden",accept:"image/*,video/*,application/pdf"})]}),e[27]=x,e[28]=L):L=e[28];let A;e[29]!==b||e[30]!==l||e[31]!==r||e[32]!==p.length?(A=!r.trim()&&p.length===0||l||b,e[29]=b,e[30]=l,e[31]=r,e[32]=p.length,e[33]=A):A=e[33];let V;e[34]!==b||e[35]!==l?(V=l||b?(0,t.jsx)(ee,{size:16,className:"animate-spin text-white mx-auto"}):"Reply",e[34]=b,e[35]=l,e[36]=V):V=e[36];let D;e[37]!==d||e[38]!==A||e[39]!==V?(D=(0,t.jsx)(Lt,{className:"!w-auto px-5 py-1.5 text-sm font-bold min-w-[70px]",onClick:d,disabled:A,children:V}),e[37]=d,e[38]=A,e[39]=V,e[40]=D):D=e[40];let g;e[41]!==L||e[42]!==D?(g=(0,t.jsxs)("div",{className:"flex justify-between items-center mt-2 pt-3 border-t border-zinc-100 dark:border-zinc-800",children:[L,D]}),e[41]=L,e[42]=D,e[43]=g):g=e[43];let y;e[44]!==F||e[45]!==I||e[46]!==g?(y=(0,t.jsxs)("div",{className:"flex-1",children:[F,I,g]}),e[44]=F,e[45]=I,e[46]=g,e[47]=y):y=e[47];let S;return e[48]!==y||e[49]!==P?(S=(0,t.jsx)("div",{className:"p-4 border-y border-zinc-100 dark:border-zinc-800 bg-zinc-50/30 dark:bg-zinc-900/10",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[P,y]})}),e[48]=y,e[49]=P,e[50]=S):S=e[50],S},at=ss,is=U(),as=s=>{const e=(0,is.c)(17),{file:i}=s;let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=(0,t.jsx)("div",{className:"size-10 rounded-xl bg-violet-100 dark:bg-violet-900/30 flex items-center justify-center text-violet-600",children:(0,t.jsx)($t,{size:20})}),e[0]=r):r=e[0];let n;e[1]!==i.name?(n=(0,t.jsx)("div",{className:"text-sm font-bold truncate dark:text-white",children:i.name}),e[1]=i.name,e[2]=n):n=e[2];const d=i.size/1024/1024;let l;e[3]!==d?(l=d.toFixed(2),e[3]=d,e[4]=l):l=e[4];let c;e[5]!==l?(c=(0,t.jsxs)("div",{className:"text-xs text-zinc-500 uppercase",children:[l," MB"]}),e[5]=l,e[6]=c):c=e[6];let h;e[7]!==n||e[8]!==c?(h=(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[n,c]}),e[7]=n,e[8]=c,e[9]=h):h=e[9];let b;e[10]===Symbol.for("react.memo_cache_sentinel")?(b=(0,t.jsx)(Ft,{size:18}),e[10]=b):b=e[10];let o;e[11]!==i.name||e[12]!==i.url?(o=(0,t.jsx)("a",{href:i.url,download:i.name,className:"p-2 text-zinc-400 hover:text-violet-600 transition-colors",onClick:ls,children:b}),e[11]=i.name,e[12]=i.url,e[13]=o):o=e[13];let p;return e[14]!==h||e[15]!==o?(p=(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-3 p-3 rounded-2xl border border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/10 group hover:border-violet-500/30 transition-colors",children:[r,h,o]}),e[14]=h,e[15]=o,e[16]=p):p=e[16],p},ns=as;function ls(s){return s.stopPropagation()}var Vs=U(),rs=U(),os=s=>{const e=(0,rs.c)(30),{url:i}=s;let r,n;e[0]!==i?(r=["link-preview",i],n=()=>Gt(i),e[0]=i,e[1]=r,e[2]=n):(r=e[1],n=e[2]);const d=!!i;let l;e[3]!==r||e[4]!==n||e[5]!==d?(l={queryKey:r,queryFn:n,staleTime:864e5,enabled:d},e[3]=r,e[4]=n,e[5]=d,e[6]=l):l=e[6];const{data:c,isLoading:h,isError:b}=gt(l);if(h){let v;return e[7]===Symbol.for("react.memo_cache_sentinel")?(v=(0,t.jsx)("div",{className:"mt-3 rounded-2xl border border-zinc-100 dark:border-zinc-800 overflow-hidden animate-pulse bg-zinc-50 dark:bg-zinc-900/50 h-24 flex items-center justify-center",children:(0,t.jsx)(De,{className:"text-zinc-300 dark:text-zinc-700 animate-spin",size:24})}),e[7]=v):v=e[7],v}if(b||!c||!c.title&&!c.image)return null;let o;e[8]!==c.image||e[9]!==c.title?(o=c.image&&(0,t.jsx)("div",{className:"w-full aspect-[1.91/1] overflow-hidden bg-zinc-100 dark:bg-zinc-900 border-b border-zinc-100 dark:border-zinc-800",children:(0,t.jsx)("img",{src:c.image,alt:c.title,className:"w-full h-full object-cover group-hover:scale-[1.02] transition-transform duration-500",onError:ds})}),e[8]=c.image,e[9]=c.title,e[10]=o):o=e[10];let p;e[11]===Symbol.for("react.memo_cache_sentinel")?(p=(0,t.jsx)(De,{size:12}),e[11]=p):p=e[11];let a;e[12]!==c.siteName?(a=(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-zinc-500 font-bold uppercase tracking-wider",children:[p,(0,t.jsx)("span",{children:c.siteName})]}),e[12]=c.siteName,e[13]=a):a=e[13];let m;e[14]!==c.title?(m=(0,t.jsx)("h4",{className:"font-bold text-[15px] line-clamp-2 dark:text-white leading-snug group-hover:text-violet-600 transition-colors",children:c.title}),e[14]=c.title,e[15]=m):m=e[15];let x;e[16]!==c.description?(x=c.description&&(0,t.jsx)("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 line-clamp-2 leading-relaxed",children:c.description}),e[16]=c.description,e[17]=x):x=e[17];let j;e[18]===Symbol.for("react.memo_cache_sentinel")?(j=(0,t.jsx)(_t,{size:10}),e[18]=j):j=e[18];let k;e[19]!==i?(k=(0,t.jsxs)("div",{className:"pt-1 flex items-center gap-1 text-[11px] text-zinc-400 font-medium",children:[j,(0,t.jsx)("span",{className:"truncate",children:i})]}),e[19]=i,e[20]=k):k=e[20];let z;e[21]!==k||e[22]!==a||e[23]!==m||e[24]!==x?(z=(0,t.jsxs)("div",{className:"p-3.5 space-y-1",children:[a,m,x,k]}),e[21]=k,e[22]=a,e[23]=m,e[24]=x,e[25]=z):z=e[25];let w;return e[26]!==z||e[27]!==o||e[28]!==i?(w=(0,t.jsxs)("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"mt-3 flex flex-col rounded-2xl border border-zinc-100 dark:border-zinc-800 overflow-hidden bg-white dark:bg-zinc-950 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-all group shadow-sm",onClick:cs,children:[o,z]}),e[26]=z,e[27]=o,e[28]=i,e[29]=w):w=e[29],w},Xe=os;function cs(s){return s.stopPropagation()}function ds(s){return s.target.style.display="none"}var ms=U(),xs=s=>{const e=(0,ms.c)(17),{src:i,poster:r}=s,n=(0,u.useRef)(null),{reportVisibility:d,unregister:l}=Kt(),{dataSaver:c}=Ut(),h=(0,u.useId)();let b;e[0]===Symbol.for("react.memo_cache_sentinel")?(b={play:()=>{const v=n.current?.plyr;v&&(v.muted=!0,v.play().catch(us))},pause:()=>{n.current?.plyr?.pause()}},e[0]=b):b=e[0];const o=b;let p,a;e[1]!==c||e[2]!==h||e[3]!==d||e[4]!==l?(p=()=>{const v=new IntersectionObserver(C=>{const[F]=C;d(h,c?0:F.intersectionRatio,o)},{threshold:[0,.6]}),P=n.current?.elements?.container;return P&&v.observe(P),()=>{l(h),P&&v.unobserve(P)}},a=[h,d,l,o,c],e[1]=c,e[2]=h,e[3]=d,e[4]=l,e[5]=p,e[6]=a):(p=e[5],a=e[6]),(0,u.useEffect)(p,a);let m;e[7]!==i?(m=[{src:i,type:"video/mp4"}],e[7]=i,e[8]=m):m=e[8];let x;e[9]!==r||e[10]!==m?(x={type:"video",sources:m,poster:r},e[9]=r,e[10]=m,e[11]=x):x=e[11];let j;e[12]===Symbol.for("react.memo_cache_sentinel")?(j={controls:["play-large","play","progress","current-time","mute","volume","fullscreen"],settings:["quality","speed"],ratio:"16:9",clickToPlay:!0,hideControls:!0,resetOnEnd:!0},e[12]=j):j=e[12];let k;e[13]!==x?(k={source:x,options:j},e[13]=x,e[14]=k):k=e[14];const z=k;let w;return e[15]!==z?(w=(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl shadow-sm border border-zinc-100 dark:border-zinc-800 bg-black",onClick:fs,children:(0,t.jsx)(tt,{ref:n,...z})}),e[15]=z,e[16]=w):w=e[16],w},ps=xs;function us(){}function fs(s){return s.stopPropagation()}var hs=U(),gs=s=>{const e=(0,hs.c)(3),{items:i}=s,r=i===void 0?[]:i,{openLightbox:n}=Tt();if(!r||r.length===0)return null;const d=Array.isArray(r)?r:[r],l=d.filter(js),c=d.filter(vs),h=m=>{const x=l.filter(zs).map(Ns),j=l[m];n(x,x.indexOf(j.url||j.src))},b="mt-3 space-y-2",o=l.length>0&&(0,t.jsx)("div",{className:`grid gap-2 rounded-2xl overflow-hidden border border-zinc-100 dark:border-zinc-800 ${l.length===1?"grid-cols-1":l.length===2?"grid-cols-2 aspect-[16/9]":(l.length===3,"grid-cols-2 grid-rows-2 aspect-[16/9]")}`,children:l.map((m,x)=>(0,t.jsx)("div",{className:`relative overflow-hidden bg-zinc-100 dark:bg-zinc-900 cursor-pointer ${l.length===3&&x===0?"row-span-2":""}`,onClick:j=>{m.type==="image"&&(j.stopPropagation(),h(x))},children:m.type==="video"?(0,t.jsx)(ps,{src:m.url,poster:m.poster}):(0,t.jsx)("img",{src:m.url||m.src,className:"size-full object-cover hover:scale-[1.02] transition-transform duration-500",alt:"",loading:"lazy"})},x))}),p=c.map(ks);let a;return e[0]!==o||e[1]!==p?(a=(0,t.jsxs)("div",{className:b,children:[o,p]}),e[0]=o,e[1]=p,e[2]=a):a=e[2],a},bs=gs;function js(s){return s.type==="image"||s.type==="video"}function vs(s){return s.type==="file"}function zs(s){return s.type==="image"}function Ns(s){return s.url||s.src}function ks(s,e){return(0,t.jsx)(ns,{file:s},e)}var ys=U(),ws=s=>{const e=(0,ys.c)(18),{poll:i,onVote:r}=s,n=i.options.reduce(Cs,0),[d,l]=(0,u.useState)(null);let c;e[0]!==r||e[1]!==d?(c=x=>{d||(l(x),r&&r(x))},e[0]=r,e[1]=d,e[2]=c):c=e[2];const h=c;let b;if(e[3]!==h||e[4]!==i.options||e[5]!==n||e[6]!==d){let x;e[8]!==h||e[9]!==n||e[10]!==d?(x=(j,k)=>{const z=n>0?Math.round((j.votes+(d===j.id?1:0))/(n+(d?1:0))*100):0,w=d===j.id;return(0,t.jsxs)("div",{onClick:v=>{v.stopPropagation(),h(j.id)},className:`relative h-10 w-full rounded-xl overflow-hidden cursor-pointer border ${w?"border-violet-500 dark:border-violet-500":"border-zinc-200 dark:border-zinc-700"}`,children:[d&&(0,t.jsx)("div",{className:"absolute top-0 left-0 h-full bg-zinc-200 dark:bg-zinc-800 transition-all duration-500",style:{width:`${z}%`}}),(0,t.jsxs)("div",{className:"absolute inset-0 flex items-center justify-between px-4 z-10",children:[(0,t.jsxs)("span",{className:`font-medium text-sm ${w?"text-violet-600 font-bold":"text-zinc-700 dark:text-zinc-200"}`,children:[j.text," ",w&&(0,t.jsx)(St,{size:14,className:"inline ml-1 mb-0.5"})]}),d&&(0,t.jsxs)("span",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:[z,"%"]})]})]},j.id||k)},e[8]=h,e[9]=n,e[10]=d,e[11]=x):x=e[11],b=i.options.map(x),e[3]=h,e[4]=i.options,e[5]=n,e[6]=d,e[7]=b}else b=e[7];const o=n+(d?1:0),p=d?"6 days left":"Click to vote";let a;e[12]!==o||e[13]!==p?(a=(0,t.jsxs)("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 pl-1",children:[o," votes â€¢"," ",p]}),e[12]=o,e[13]=p,e[14]=a):a=e[14];let m;return e[15]!==b||e[16]!==a?(m=(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[b,a]}),e[15]=b,e[16]=a,e[17]=m):m=e[17],m},Ye=ws;function Cs(s,e){return s+e.votes}var nt=({id:s,user:e,timeAgo:i,content:r,contentClass:n,media:d,quotedPost:l,stats:c,onClick:h,repostedBy:b,onUserClick:o,currentUser:p,showToast:a,poll:m,isDetail:x,initialComments:j,onDelete:k,isComment:z,onReply:w,community:v})=>{const P=he(),{liked:C,reposted:F,localStats:I,setLocalStats:E,handleLike:M,handleRepost:L}=Yt(s,c,p,a),{deletePost:A,updatePost:V}=Qt(),[D,g]=(0,u.useState)(j||[]),[y,S]=(0,u.useState)(""),[R,O]=(0,u.useState)(!1),[B,te]=(0,u.useState)(!1),[je,ve]=(0,u.useState)(!1),[lt,ze]=(0,u.useState)(!0),[me,Ne]=(0,u.useState)([]),[rt,ke]=(0,u.useState)(!1),[ye,se]=(0,u.useState)(!1),[xe,ie]=(0,u.useState)(!1),[J,we]=(0,u.useState)(r),[Y,Ce]=(0,u.useState)(d||[]),[ae,ne]=(0,u.useState)([]),[_e,Pe]=(0,u.useState)(!1),[le,ot]=(0,u.useState)(!1),Se=(0,u.useRef)(null),$e=(0,u.useRef)(D);(0,u.useEffect)(()=>{$e.current=D},[D]);const ct=async()=>{const f=JSON.stringify(Y)!==JSON.stringify(d||[])||ae.length>0;if(!J.trim()||J===r&&!f){ie(!1);return}Pe(!0);try{const N=[];for(const _ of ae){const $=await fe(_);N.push($)}await V(s,{content:J,media:[...Y,...N]}),ne([]),ie(!1),a&&a("Post updated")}catch(N){console.error("Failed to update post:",N),a&&a("Failed to update post")}finally{Pe(!1)}},Fe=async f=>{f&&f.stopPropagation();try{await A(s),a&&a("Post deleted successfully"),k&&k(s)}catch(N){console.error("Failed to delete post:",N),a&&a("Failed to delete post")}finally{se(!1)}},re=(0,u.useCallback)(async(f=!1)=>{if(s){f?ve(!0):O(!0);try{const N=$e.current,_=await st(s,f&&N.length>0?N[N.length-1].created_at:null,10);_.length<10?ze(!1):ze(!0),g(f?$=>[...$,..._]:_)}catch(N){console.error("Failed to load comments:",N)}finally{O(!1),ve(!1)}}},[s]);(0,u.useEffect)(()=>{x&&s&&re()},[x,s,re]);const dt=async f=>{if(f.preventDefault(),!(!y.trim()&&me.length===0||!p)){te(!0),ke(!0);try{const N=[];for(const _ of me){const $=await fe(_);N.push($)}await it(s,p.id,y,N),S(""),Ne([]),E(_=>({..._,comments:(_.comments||0)+1})),a&&a("Reply posted!"),re()}catch(N){console.error("Failed to post comment:",N),a&&a("Failed to post reply.")}finally{te(!1),ke(!1)}}},mt=f=>{f.stopPropagation();const N=`${window.location.origin}/post/${s}`;navigator.clipboard.writeText(N),a&&a("Link copied to clipboard!")},Me=({trigger:f})=>(0,t.jsxs)(qt,{children:[(0,t.jsx)(It,{asChild:!0,onClick:N=>N.stopPropagation(),children:f}),(0,t.jsxs)(At,{align:"end",className:"w-48 rounded-xl bg-white dark:bg-zinc-900 border-zinc-100 dark:border-zinc-800",children:[(0,t.jsxs)(Z,{className:"gap-2 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-800 py-2.5",onClick:mt,children:[(0,t.jsx)(jt,{size:16}),(0,t.jsx)("span",{children:"Copy link to post"})]}),!z&&(0,t.jsxs)(Z,{className:"gap-2 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-800 py-2.5",onClick:N=>{N.stopPropagation(),a&&a("Post reported")},children:[(0,t.jsx)(wt,{size:16}),(0,t.jsx)("span",{children:"Report post"})]}),!Re&&(0,t.jsxs)(Z,{className:"gap-2 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-800 py-2.5 text-rose-500 focus:text-rose-500",onClick:N=>{N.stopPropagation(),a&&a("User blocked")},children:[(0,t.jsx)(Ct,{size:16}),(0,t.jsxs)("span",{children:["Block @",e.handle]})]}),Re&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Wt,{className:"bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsxs)(Z,{className:"gap-2 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-900 py-2.5",onClick:N=>{N.stopPropagation(),ie(!0)},children:[(0,t.jsx)(Nt,{size:16}),(0,t.jsx)("span",{children:"Edit post"})]}),(0,t.jsxs)(Z,{className:"gap-2 cursor-pointer focus:bg-rose-50 dark:focus:bg-rose-900/20 py-2.5 text-rose-500 focus:text-rose-500",onClick:N=>{N.stopPropagation(),se(!0)},children:[(0,t.jsx)(Rt,{size:16}),(0,t.jsx)("span",{children:"Delete post"})]})]})]})]}),Re=p?.handle===e.handle,Ie=f=>{if(!f)return null;const N=xe?Y:f;return!N||Array.isArray(N)&&N.length===0?null:xe?(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,t.jsxs)("div",{className:"grid gap-2 grid-cols-2 sm:grid-cols-3",children:[Y.map((_,$)=>(0,t.jsxs)("div",{className:"relative aspect-square rounded-xl overflow-hidden border border-zinc-200 dark:border-zinc-800 group",children:[_.type==="video"?(0,t.jsx)("div",{className:"size-full bg-zinc-100 dark:bg-zinc-900 flex items-center justify-center",children:(0,t.jsx)(Oe,{size:24,className:"text-zinc-400"})}):(0,t.jsx)("img",{src:_.url||_.src,className:"size-full object-cover",alt:""}),(0,t.jsx)("button",{onClick:q=>{q.stopPropagation(),Ce(H=>H.filter((K,W)=>W!==$))},className:"absolute top-1.5 right-1.5 size-7 rounded-full bg-black/60 text-white flex items-center justify-center hover:bg-black transition-colors",children:(0,t.jsx)(ue,{size:16})})]},`old-${$}`)),ae.map((_,$)=>(0,t.jsxs)("div",{className:"relative aspect-square rounded-xl overflow-hidden border-2 border-dashed border-violet-500 bg-violet-50/10 group",children:[_.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(_),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"size-full flex items-center justify-center",children:(0,t.jsx)(Oe,{size:24,className:"text-violet-500 animate-pulse"})}),(0,t.jsx)("button",{onClick:q=>{q.stopPropagation(),ne(H=>H.filter((K,W)=>W!==$))},className:"absolute top-1.5 right-1.5 size-7 rounded-full bg-black/60 text-white flex items-center justify-center hover:bg-black transition-colors",children:(0,t.jsx)(ue,{size:16})}),(0,t.jsx)("div",{className:"absolute bottom-1 left-1 bg-violet-600 text-white text-[8px] font-bold px-1 rounded",children:"NEW"})]},`new-${$}`)),Y.length+ae.length<4&&(0,t.jsxs)("button",{onClick:_=>{_.stopPropagation(),Se.current?.click()},className:"relative aspect-square rounded-xl border-2 border-dashed border-zinc-200 dark:border-zinc-800 flex flex-col items-center justify-center gap-1 text-zinc-400 hover:text-violet-500 hover:border-violet-500 hover:bg-violet-50/5 transition-all",children:[(0,t.jsx)(Pt,{size:20}),(0,t.jsx)("span",{className:"text-[10px] font-bold",children:"Add Media"})]})]}),(0,t.jsx)("input",{type:"file",ref:Se,onChange:_=>{const $=Array.from(_.target.files);ne(q=>[...q,...$])},multiple:!0,className:"hidden",accept:"image/*,video/*"})]}):u.isValidElement(N)?N:(0,t.jsx)(bs,{items:N})},Ee=(f,N)=>{const _=typeof f=="string"&&Ot(f);if(xe)return(0,t.jsxs)("div",{className:"flex flex-col gap-2 mt-2",onClick:$=>$.stopPropagation(),children:[(0,t.jsx)(Vt,{value:J,onChange:$=>we($.target.value),className:`min-h-[100px] w-full bg-zinc-50 dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800 rounded-xl focus:ring-violet-500 ${_?"font-bangla text-lg":"font-english"}`,autoFocus:!0}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)("button",{onClick:()=>{ie(!1),we(r),Ce(d||[]),ne([])},className:"px-4 py-1.5 text-sm font-bold text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300 transition-colors",children:"Cancel"}),(0,t.jsx)("button",{onClick:ct,disabled:_e||!J.trim()||J===r,className:"px-4 py-1.5 text-sm font-bold bg-violet-600 text-white rounded-full hover:bg-violet-700 disabled:opacity-50 transition-all active:scale-95",children:_e?"Saving...":"Save"})]})]});if(typeof f=="string"){const $=!x&&f.length>280,q=$&&!le?f.substring(0,280):f;return(0,t.jsxs)("div",{className:`whitespace-pre-line ${N||""} ${_?"font-bangla text-[1.15em] leading-relaxed":"font-english text-[1.05em]"}`,children:[(0,t.jsx)(ge,{options:{...be,render:({attributes:H,content:K})=>{const{href:W,...Le}=H,Ae=!W.startsWith("/")&&(W.startsWith("http")||W.startsWith("www"));return W.startsWith("/u/")||W.startsWith("/tags/")||W.startsWith("/c/")||W.startsWith("/explore")?(0,t.jsx)("span",{...Le,onClick:pt=>{pt.stopPropagation(),P(W)},children:K},K):(0,t.jsx)("a",{href:W,...Le,target:Ae?"_blank":void 0,rel:Ae?"noopener noreferrer":void 0,children:K},K)}},children:q}),$&&!le&&"...",$&&(0,t.jsx)("button",{onClick:H=>{H.stopPropagation(),ot(!le)},className:"ml-1 text-rose-500 dark:text-rose-400 font-bold hover:underline cursor-pointer",children:le?"Show less":"See more"})]})}return f},xt=f=>{S(N=>{const _=`@${f} `;return N.includes(_)?N:N+_}),document.getElementById("comment-input")?.focus()};return x?(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("article",{className:"p-5 dark:bg-black",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsx)("button",{className:"shrink-0",onClick:()=>o&&o(e.handle),children:(0,t.jsxs)(Q,{className:"size-12 border border-zinc-200 dark:border-zinc-700",children:[(0,t.jsx)(G,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(T,{children:e.handle[0]?.toUpperCase()})]})}),(0,t.jsxs)("div",{className:"flex flex-col min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 min-w-0 max-w-full",children:[(0,t.jsxs)("button",{className:"font-bold text-base sm:text-lg hover:underline text-zinc-900 dark:text-white flex items-center gap-1 shrink-0",onClick:()=>o&&o(e.handle),children:[(0,t.jsx)("span",{className:"max-w-[200px] sm:max-w-none truncate",children:e.handle}),e.verified&&(0,t.jsx)(Ve,{})]}),v&&(0,t.jsxs)("div",{className:"flex items-center gap-1 min-w-0 text-zinc-500",children:[(0,t.jsx)("span",{className:"text-zinc-400 font-medium shrink-0 text-xs sm:text-sm",children:">"}),(0,t.jsxs)("button",{className:"flex items-center gap-1 font-bold text-zinc-900 dark:text-zinc-100 hover:underline text-[14px] sm:text-[15px]",onClick:f=>{f.stopPropagation(),P(`/c/${v.handle}`)},children:[(0,t.jsxs)(Q,{className:"size-4 bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shrink-0",children:[(0,t.jsx)(G,{src:v.avatar,alt:v.name,className:"object-cover"}),(0,t.jsx)(T,{className:"text-[8px] font-bold text-zinc-500",children:v.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"truncate max-w-[200px] sm:max-w-none",children:v.name})]})]})]})}),(0,t.jsxs)("span",{className:"text-xs sm:text-sm text-zinc-500 dark:text-zinc-400 font-medium",children:["@",e.handle]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 -mt-1",children:[(0,t.jsx)("span",{className:"text-zinc-500 dark:text-zinc-400 text-[13px] sm:text-sm whitespace-nowrap",children:i||"Recent"}),(0,t.jsx)(Me,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"text-zinc-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full p-2 transition-colors",children:(0,t.jsx)(We,{size:20})})})]})]}),(0,t.jsx)("div",{className:"break-words text-zinc-900 dark:text-zinc-100 mt-4 text-lg sm:text-xl leading-relaxed sm:leading-8 whitespace-pre-line",children:Ee(r,n)}),oe(r)&&(0,t.jsx)(Xe,{url:oe(r)}),Ie(d),m&&(0,t.jsx)(Ye,{poll:m}),l&&(0,t.jsx)("div",{className:"mt-4 border border-zinc-200 dark:border-zinc-700 rounded-2xl overflow-hidden shadow-sm",children:(0,t.jsx)(Ze,{...l})}),(0,t.jsxs)("div",{className:"border-b border-zinc-100 dark:border-zinc-800 pb-4 mt-4 flex items-center gap-x-6 text-zinc-500 dark:text-zinc-400 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:I.likes||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Likes"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:I.comments||0})," ",(0,t.jsx)("span",{className:"opacity-70",children:"Comments"})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex w-full items-center justify-around py-1",children:[(0,t.jsx)(X,{icon:de,label:"Like",onClick:M,active:C,activeColorClass:"text-rose-500"}),!z&&(0,t.jsx)(X,{icon:pe,label:"Repost",onClick:L,active:F,activeColorClass:"text-emerald-500"}),(0,t.jsx)(X,{icon:ce,label:"Comment",onClick:()=>document.getElementById("comment-input")?.focus()})]})]}),(0,t.jsx)(at,{currentUser:p,newComment:y,setNewComment:S,handleSubmitComment:dt,loading:B,selectedFiles:me,setSelectedFiles:Ne,isUploading:rt}),(0,t.jsx)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:R?(0,t.jsx)("div",{className:"p-8 flex justify-center",children:(0,t.jsx)(ee,{className:"animate-spin text-violet-500"})}):(0,t.jsxs)(t.Fragment,{children:[lt&&D.length>0&&(0,t.jsxs)("button",{onClick:()=>re(!0),disabled:je,className:"w-full py-3 text-sm font-bold text-violet-600 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-colors flex items-center justify-center gap-2",children:[je&&(0,t.jsx)(ee,{size:14,className:"animate-spin"}),"View more replies"]}),D.map(f=>(0,t.jsx)(nt,{...f,isComment:!0,onReply:xt,onUserClick:o,currentUser:p,showToast:a,onDelete:N=>g(_=>_.filter($=>$.id!==N))},f.id))]})}),(0,t.jsx)(He,{open:ye,onOpenChange:se,children:(0,t.jsxs)(qe,{onClick:f=>f.stopPropagation(),children:[(0,t.jsxs)(Qe,{children:[(0,t.jsx)(Te,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ke,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(Be,{children:[(0,t.jsx)(Ue,{onClick:f=>f.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Ge,{onClick:Fe,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]}):(0,t.jsxs)("article",{onClick:h,className:`p-4 transition-all ${z?"bg-transparent border-b border-zinc-100/50 dark:border-zinc-800/50 hover:bg-zinc-50/50 dark:hover:bg-zinc-800/30 last:border-0":"mb-4 bg-white dark:bg-black rounded-xl hover:shadow-md"} ${h?"cursor-pointer":""}`,children:[b&&(0,t.jsxs)("div",{className:"mb-2 flex items-center space-x-1.5 text-[13px] text-zinc-500 font-semibold ml-1",children:[(0,t.jsx)(pe,{size:14,className:"text-zinc-400"}),(0,t.jsx)("span",{className:"hover:underline cursor-pointer flex items-center text-zinc-600 dark:text-zinc-400",onClick:f=>{f.stopPropagation(),o&&o(b.handle)},children:(0,t.jsx)("span",{className:"truncate max-w-[150px]",children:typeof b=="object"?b.name:b})}),(0,t.jsx)("span",{className:"text-zinc-400",children:"reposted"})]}),(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsx)("button",{className:"shrink-0 group",onClick:f=>{f.stopPropagation(),o&&o(e.handle)},children:(0,t.jsxs)(Q,{className:"size-11 border border-zinc-200 dark:border-zinc-700 group-hover:brightness-95 transition-all",children:[(0,t.jsx)(G,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(T,{children:e.handle[0]?.toUpperCase()})]})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex w-full items-start justify-between",children:[(0,t.jsx)("div",{className:"flex flex-col min-w-0 flex-1",children:(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 min-w-0 max-w-full",children:[(0,t.jsxs)("button",{className:"font-bold text-[15px] hover:underline text-zinc-900 dark:text-white flex items-center gap-1 shrink-0",onClick:f=>{f.stopPropagation(),o&&o(e.handle)},children:[(0,t.jsx)("span",{className:"truncate max-w-[160px] sm:max-w-none",children:e.handle}),e.verified&&(0,t.jsx)(Ve,{})]}),v&&(0,t.jsxs)("div",{className:"flex items-center gap-1 min-w-0 text-zinc-500",children:[(0,t.jsx)("span",{className:"text-zinc-400 font-medium shrink-0 text-xs sm:text-sm",children:">"}),(0,t.jsxs)("button",{className:"flex items-center gap-1 font-bold text-zinc-900 dark:text-zinc-100 hover:underline text-[14px] sm:text-[15px] min-w-0",onClick:f=>{f.stopPropagation(),P(`/c/${v.handle}`)},children:[(0,t.jsxs)(Q,{className:"size-4 bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shrink-0",children:[(0,t.jsx)(G,{src:v.avatar,alt:v.name,className:"object-cover"}),(0,t.jsx)(T,{className:"text-[8px] font-bold text-zinc-500",children:v.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"truncate max-w-[160px] md:max-w-none",children:v.name})]})]})]})})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 -mt-1",children:[(0,t.jsx)("span",{className:"text-zinc-400 text-[13px] sm:text-sm whitespace-nowrap",children:i||"Recent"}),(0,t.jsx)(Me,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"text-zinc-500 hover:bg-zinc-100 hover:text-zinc-700 dark:hover:bg-zinc-800 dark:hover:text-zinc-200 rounded-full p-2 -mr-2 transition-colors",children:(0,t.jsx)(We,{size:18})})})]})]}),(0,t.jsxs)("div",{className:"break-words text-zinc-900 dark:text-zinc-100 mt-1 whitespace-pre-line text-sm sm:text-[15px] leading-relaxed",children:[Ee(r,n),oe(r)&&(0,t.jsx)(Xe,{url:oe(r)}),Ie(d),m&&(0,t.jsx)(Ye,{poll:m,onVote:()=>a&&a("Voted!")}),l&&(0,t.jsx)("div",{className:"mt-3 border border-zinc-200 dark:border-zinc-700 rounded-2xl overflow-hidden bg-white dark:bg-zinc-900 hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors cursor-pointer",onClick:f=>f.stopPropagation(),children:(0,t.jsx)(Ze,{...l})})]}),(0,t.jsx)("div",{className:"mt-3 flex w-full flex-wrap items-center justify-between gap-3 pr-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-x-6 sm:gap-x-8",children:[(0,t.jsx)(X,{icon:de,label:"Like",count:I.likes,active:C,onClick:M,activeColorClass:"text-rose-500"}),!z&&(0,t.jsx)(X,{icon:pe,label:"Repost",count:I.mirrors,active:F,onClick:L,activeColorClass:"text-emerald-500"}),(0,t.jsx)(X,{icon:ce,label:"Comment",count:I.comments,onClick:f=>{z&&w?(f.stopPropagation(),w(e.handle)):h&&h(f)}})]})})]})]}),(0,t.jsx)(He,{open:ye,onOpenChange:se,children:(0,t.jsxs)(qe,{onClick:f=>f.stopPropagation(),children:[(0,t.jsxs)(Qe,{children:[(0,t.jsx)(Te,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ke,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(Be,{children:[(0,t.jsx)(Ue,{onClick:f=>f.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Ge,{onClick:Fe,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})},_s=nt,Ps=U(),Ss=s=>{const e=(0,Ps.c)(30),{user:i,time:r,content:n}=s,d=he();let l;e[0]!==i.avatar||e[1]!==i.handle?(l=(0,t.jsx)(G,{src:i.avatar,alt:i.handle}),e[0]=i.avatar,e[1]=i.handle,e[2]=l):l=e[2];let c;e[3]!==i.handle[0]?(c=i.handle[0]?.toUpperCase(),e[3]=i.handle[0],e[4]=c):c=e[4];let h;e[5]!==c?(h=(0,t.jsx)(T,{children:c}),e[5]=c,e[6]=h):h=e[6];let b;e[7]!==l||e[8]!==h?(b=(0,t.jsxs)(Q,{className:"size-6",children:[l,h]}),e[7]=l,e[8]=h,e[9]=b):b=e[9];let o;e[10]!==i.handle?(o=(0,t.jsx)("span",{className:"font-semibold text-sm",children:i.handle}),e[10]=i.handle,e[11]=o):o=e[11];let p;e[12]!==b||e[13]!==o?(p=(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[b,o]}),e[12]=b,e[13]=o,e[14]=p):p=e[14];let a;e[15]!==r?(a=(0,t.jsx)("span",{className:"text-zinc-500 text-xs sm:text-sm",children:r}),e[15]=r,e[16]=a):a=e[16];let m;e[17]!==p||e[18]!==a?(m=(0,t.jsxs)("div",{className:"flex items-center justify-between gap-x-2 mb-2",children:[p,a]}),e[17]=p,e[18]=a,e[19]=m):m=e[19];let x;e[20]!==d?(x={...be,render:w=>{const{attributes:v,content:P}=w,{href:C,...F}=v,I=!C.startsWith("/")&&(C.startsWith("http")||C.startsWith("www"));return C.startsWith("/u/")||C.startsWith("/tags/")||C.startsWith("/c/")||C.startsWith("/explore")?(0,t.jsx)("span",{...F,onClick:E=>{E.stopPropagation(),d(C)},children:P},P):(0,t.jsx)("a",{href:C,...F,target:I?"_blank":void 0,rel:I?"noopener noreferrer":void 0,onClick:$s,children:P},P)}},e[20]=d,e[21]=x):x=e[21];let j;e[22]!==n?(j=(0,t.jsx)("p",{className:"text-sm text-zinc-800 dark:text-zinc-300 whitespace-pre-line",children:n}),e[22]=n,e[23]=j):j=e[23];let k;e[24]!==j||e[25]!==x?(k=(0,t.jsx)(ge,{options:x,children:j}),e[24]=j,e[25]=x,e[26]=k):k=e[26];let z;return e[27]!==k||e[28]!==m?(z=(0,t.jsxs)("div",{className:"p-4",children:[m,k]}),e[27]=k,e[28]=m,e[29]=z):z=e[29],z},Ze=Ss;function $s(s){return s.stopPropagation()}var Fs=u.memo(({reel:s,isActive:e,isMuted:i})=>{const r=he(),{currentUser:n}=Jt(),{addToast:d}=Bt(),l=(0,u.useRef)(null),[c,h]=(0,u.useState)(!1),[b,o]=(0,u.useState)(!1),[p,a]=(0,u.useState)(null),[m,x]=(0,u.useState)(!1),[j,k]=(0,u.useState)(s.stats?.likes||0),[z,w]=(0,u.useState)(!1),[v,P]=(0,u.useState)(0),C=(0,u.useRef)(null),F=(0,u.useMemo)(()=>Array.isArray(s.media)?s.media[0]?.src||s.media[0]?.url:s.media?.src||s.media?.url||s.url,[s.media,s.url]);(0,u.useEffect)(()=>{let g;const y=l.current?.plyr;return y&&(e?g=setTimeout(()=>{typeof y.play=="function"&&y.play().catch(()=>{y&&(y.muted=!0,y.play().catch(()=>{}))})},100):typeof y.pause=="function"&&y.pause()),()=>{g&&clearTimeout(g)}},[e]),(0,u.useEffect)(()=>{if(!n?.id||!e)return;(async()=>{try{const[y,S]=await Promise.all([Xt(s.id,n.id),Ht(n.id,s.user?.id)]);x(y),w(S)}catch(y){console.error("Failed to check interaction status:",y)}})()},[s.id,n?.id,e,s.user?.id]),(0,u.useEffect)(()=>{const g=l.current?.plyr;g&&(g.muted=i)},[i]),(0,u.useEffect)(()=>{const g=l.current?.plyr;if(!g||!e)return;const y=()=>{const S=g.currentTime,R=g.duration;R>0&&P(S/R*100)};if(typeof g.on=="function")return g.on("timeupdate",y),()=>{typeof g.off=="function"&&g.off("timeupdate",y)}},[e]);const I=g=>{g.target.closest("button")||g.target.closest("a")||(C.current?(clearTimeout(C.current),C.current=null,M()):C.current=setTimeout(()=>{C.current=null,E()},200))},E=()=>{const g=l.current?.plyr;g&&(g.paused?(g.play().catch(()=>{}),a("play")):(g.pause(),a("pause")),setTimeout(()=>a(null),500))},M=async()=>{if(n&&(h(!0),setTimeout(()=>h(!1),800),!m)){x(!0),k(g=>g+1);try{await Je(s.id,n.id)}catch{x(!1),k(g=>g-1)}}},L=async g=>{if(g.stopPropagation(),!n)return;const y=!m;x(y),k(S=>y?S+1:S-1);try{await Je(s.id,n.id)}catch{x(!y),k(S=>y?S-1:S+1)}},A=async g=>{if(g.stopPropagation(),!n)return;const y=!z;w(y);try{await Et(n.id,s.user?.id)}catch{w(!y)}},V=g=>{g.stopPropagation();const y=`${window.location.origin}/reels?id=${s.id}`;navigator.clipboard.writeText(y),d("Link copied to clipboard!")},D=(0,u.useMemo)(()=>({source:{type:"video",sources:[{src:F,type:"video/mp4"}]},options:{controls:[],loop:{active:!0},clickToPlay:!0,ratio:"9:16"}}),[F]);return(0,t.jsxs)("div",{"data-id":s.id,className:"reel-item relative h-screen w-full bg-black snap-start flex items-center justify-center overflow-hidden cursor-pointer",onClick:I,children:[(0,t.jsx)("div",{className:"w-full h-full max-w-[450px]",children:(0,t.jsx)(tt,{ref:l,...D})}),c&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-50",children:(0,t.jsx)("div",{className:"animate-in zoom-in-50 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)(de,{size:120,fill:"white",className:"text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.4)] scale-125"})})}),p&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-50",children:(0,t.jsx)("div",{className:"animate-in fade-in zoom-in-90 scale-100 animate-out zoom-out-110 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)("div",{className:"p-8 bg-white/10 backdrop-blur-md rounded-full border border-white/20 shadow-2xl",children:p==="play"?(0,t.jsx)(zt,{size:50,fill:"white",className:"text-white ml-1.5"}):(0,t.jsx)(kt,{size:50,fill:"white",className:"text-white"})})})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/60 pointer-events-none"}),(0,t.jsxs)("div",{className:"absolute bottom-20 left-4 right-16 text-white pointer-events-none",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3 pointer-events-auto",children:[(0,t.jsxs)(ut,{to:`/u/${s.user?.handle}`,className:"flex items-center gap-2 hover:opacity-80 transition-opacity",onClick:g=>g.stopPropagation(),children:[(0,t.jsxs)(Q,{className:"size-10 border-2 border-white",children:[(0,t.jsx)(G,{src:s.user?.avatar,alt:s.user?.handle,className:"object-cover"}),(0,t.jsx)(T,{children:s.user?.handle?.[0]?.toUpperCase()})]}),(0,t.jsxs)("span",{className:"font-bold",children:["@",s.user?.handle]})]}),n?.id!==s.user?.id&&(0,t.jsx)("button",{className:`text-xs font-bold px-4 py-1.5 rounded-full ml-2 transition-all active:scale-95 ${z?"bg-transparent border border-white/50 text-white":"bg-white text-black hover:bg-zinc-200"}`,onClick:A,children:z?"Following":"Follow"})]}),(0,t.jsx)(ge,{options:{...be,render:({attributes:g,content:y})=>{const{href:S,...R}=g,O=!S.startsWith("/")&&(S.startsWith("http")||S.startsWith("www"));return S.startsWith("/u/")||S.startsWith("/tags/")||S.startsWith("/c/")||S.startsWith("/explore")?(0,t.jsx)("span",{...R,className:"text-white font-bold hover:underline cursor-pointer",onClick:B=>{B.stopPropagation(),r(S)},children:y},y):(0,t.jsx)("a",{href:S,...R,className:"text-white hover:underline",target:O?"_blank":void 0,rel:O?"noopener noreferrer":void 0,onClick:B=>B.stopPropagation(),children:y},y)}},children:(0,t.jsx)("p",{className:"text-sm mb-3 line-clamp-2",children:s.content})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[(0,t.jsx)(vt,{size:14,className:"animate-spin-slow"}),(0,t.jsxs)("span",{children:["Original Audio - ",s.user?.handle]})]})]}),(0,t.jsxs)("div",{className:"absolute bottom-20 right-2 flex flex-col items-center gap-6 z-10",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1 pointer-events-auto",children:[(0,t.jsx)("button",{className:`p-3 rounded-full backdrop-blur-md transition-all active:scale-90 ${m?"bg-rose-500/20 text-rose-500":"bg-zinc-800/50 text-white hover:bg-zinc-700"}`,onClick:L,children:(0,t.jsx)(de,{size:28,fill:m?"currentColor":"none"})}),(0,t.jsx)("span",{className:"text-white text-xs font-bold",children:j})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1 pointer-events-auto",children:[(0,t.jsx)("button",{className:"p-3 bg-zinc-800/50 rounded-full text-white backdrop-blur-md hover:bg-zinc-700 transition-colors active:scale-90",onClick:g=>{g.stopPropagation(),o(!0)},children:(0,t.jsx)(ce,{size:28})}),(0,t.jsx)("span",{className:"text-white text-xs font-bold",children:s.stats?.comments||0})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1 pointer-events-auto",children:[(0,t.jsx)("button",{className:"p-3 bg-zinc-800/50 rounded-full text-white backdrop-blur-md hover:bg-zinc-700 transition-colors active:scale-90",onClick:V,children:(0,t.jsx)(Mt,{size:28})}),(0,t.jsx)("span",{className:"text-white text-xs font-bold",children:s.stats?.shares||0})]})]}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-[3px] bg-white/20 z-50",children:(0,t.jsx)("div",{className:"h-full bg-white transition-all duration-100 ease-linear shadow-[0_0_8px_rgba(255,255,255,0.8)]",style:{width:`${v}%`}})}),(0,t.jsx)(Rs,{isOpen:b,onClose:()=>o(!1),reelId:s.id,currentUser:n,showToast:d})]})},(s,e)=>s.isActive===e.isActive&&s.reel.id===e.reel.id&&s.isMuted===e.isMuted),Us=Fs,Ms=({isOpen:s,onClose:e,reelId:i,currentUser:r,showToast:n})=>{const[d,l]=(0,u.useState)([]),[c,h]=(0,u.useState)(!1),[b,o]=(0,u.useState)(!1),[p,a]=(0,u.useState)(""),[m,x]=(0,u.useState)([]),[j,k]=(0,u.useState)(!1),[z,w]=(0,u.useState)(!0),[v,P]=(0,u.useState)(!1),C=(0,u.useRef)(d);(0,u.useEffect)(()=>{C.current=d},[d]);const F=(0,u.useCallback)(async(E=!1)=>{if(i){E?P(!0):h(!0);try{const M=C.current,L=await st(i,E&&M.length>0?M[M.length-1].created_at:null,10);L.length<10?w(!1):w(!0),l(E?A=>[...A,...L]:L)}catch(M){console.error("Failed to load comments:",M),n&&n("Failed to load comments","error")}finally{h(!1),P(!1)}}},[i,n]);(0,u.useEffect)(()=>{s&&i?F():(l([]),w(!0))},[s,i,F]);const I=async E=>{if(E.preventDefault(),!(!p.trim()&&m.length===0||!r)){o(!0),k(!0);try{const M=[];for(const L of m){const A=await fe(L);M.push(A)}await it(i,r.id,p,M),a(""),x([]),n&&n("Reply posted!"),F()}catch(M){console.error("Failed to post comment:",M),n&&n("Failed to post reply.","error")}finally{o(!1),k(!1)}}};return(0,t.jsx)(Dt,{isOpen:s,onClose:e,className:"max-sm:h-[95dvh] sm:max-w-xl h-[85vh] flex flex-col !p-0",children:(0,t.jsxs)("div",{className:"flex flex-col h-full overflow-hidden bg-white dark:bg-zinc-900",children:[(0,t.jsxs)("div",{className:"px-5 py-4 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-center shrink-0 relative bg-white dark:bg-zinc-900",children:[(0,t.jsx)("h2",{className:"text-base font-bold dark:text-white",children:"Comments"}),(0,t.jsx)("div",{className:"absolute right-5 w-8 h-1 bg-zinc-200 dark:bg-zinc-800 rounded-full sm:hidden top-2 transform -translate-y-1/2 left-1/2 -translate-x-1/2"})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800",children:c?(0,t.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,t.jsx)(ee,{className:"animate-spin text-violet-500",size:32})}):d.length>0?(0,t.jsxs)("div",{className:"flex flex-col",children:[d.map(E=>(0,t.jsx)(_s,{...E,isComment:!0,currentUser:r,showToast:n,onDelete:M=>l(L=>L.filter(A=>A.id!==M))},E.id)),z&&(0,t.jsxs)("button",{onClick:()=>F(!0),disabled:v,className:"w-full py-6 text-sm font-bold text-violet-600 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-colors flex items-center justify-center gap-2",children:[v&&(0,t.jsx)(ee,{size:16,className:"animate-spin"}),"View more replies"]})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] text-center text-zinc-500 p-8",children:[(0,t.jsx)("div",{className:"size-16 rounded-full bg-zinc-100 dark:bg-zinc-900 flex items-center justify-center mb-4",children:(0,t.jsx)(ce,{size:32,className:"text-zinc-400"})}),(0,t.jsx)("p",{className:"font-bold text-lg dark:text-zinc-300",children:"No comments yet"}),(0,t.jsx)("p",{className:"text-sm dark:text-zinc-500",children:"Be the first to share what you think!"})]})}),(0,t.jsx)("div",{className:"bg-white dark:bg-zinc-900 shrink-0",children:(0,t.jsx)(at,{currentUser:r,newComment:p,setNewComment:a,handleSubmitComment:I,loading:b,selectedFiles:m,setSelectedFiles:x,isUploading:j})})]})})},Rs=Ms;export{_s as n,Us as t};
