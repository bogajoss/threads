import{a as fe}from"./rolldown-runtime-BaZ8gS7u.js";import{E as me,S as de,b as ee,c as G,x as re}from"./framework-CsA6nn9m.js";import{a as te,n as ie,r as ne,t as Z}from"./query-QyXblnmD.js";import{$t as ge,At as he,Bt as ye,Ct as pe,Et as _e,Ht as Pe,It as we,Jt as be,Kt as Me,Lt as ve,Mt as Se,Nt as $e,Ot as Re,Pt as qe,Qt as Fe,Rt as Le,Tt as Te,Ut as ke,Vt as Ne,Wt as xe,Xt as Ce,Yt as De,_t as Qe,an as Ke,bt as Ee,c as Ae,dn as le,en as Oe,in as Be,jt as je,mn as U,on as Je,pn as I,qt as ze,rn as He,vt as ae,wt as Ve,xt as se,yt as We,zt as Xe}from"./index-C0xYWOHr.js";var Ge=G(),C=fe(me(),1);const Ye=(e,i,s)=>{const t=(0,Ge.c)(16);let o,a;t[0]!==i||t[1]!==e?(o=["follows",i,e],a=l=>{const{pageParam:g}=l;return(i==="Followers"?He:Be)(e,g,10)},t[0]=i,t[1]=e,t[2]=o,t[3]=a):(o=t[2],a=t[3]);const n=!!e&&s;let _;t[4]!==o||t[5]!==a||t[6]!==n?(_={queryKey:o,queryFn:a,initialPageParam:null,getNextPageParam:Ze,enabled:n},t[4]=o,t[5]=a,t[6]=n,t[7]=_):_=t[7];const{data:m,fetchNextPage:d,hasNextPage:f,isFetchingNextPage:r,isLoading:M}=Z(_);let w;t[8]!==m?.pages?(w=m?.pages.flatMap(Ie)||[],t[8]=m?.pages,t[9]=w):w=t[9];const y=w;let P;return t[10]!==d||t[11]!==y||t[12]!==f||t[13]!==r||t[14]!==M?(P={followList:y,fetchNextPage:d,hasNextPage:f,isFetchingNextPage:r,isLoading:M},t[10]=d,t[11]=y,t[12]=f,t[13]=r,t[14]=M,t[15]=P):P=t[15],P};function Ze(e){if(!(!e||e.length<10))return e[e.length-1].followed_at}function Ie(e){return e}const Ue=(e,i)=>{const s=te(),{addToast:t}=ae(),o=(0,C.useCallback)((l=[],g=[])=>l.map(c=>({id:c.id,sender:c.sender_id===e?.id?"me":"them",senderAvatar:c.sender?.avatar,senderName:c.sender?.name,text:c.content||"",type:c.type||"text",media:c.media?Array.isArray(c.media)?c.media:[c.media]:[],isRead:c.is_read||!1,replyToId:c.reply_to_id,reactions:g.filter(h=>h.message_id===c.id),time:c.created_at?new Date(c.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Just now",updatedAt:c.updated_at,isOptimistic:c.isOptimistic})),[e?.id]),{data:a,fetchNextPage:n,hasNextPage:_,isFetchingNextPage:m,isLoading:d,refetch:f}=Z({queryKey:["messages",i],queryFn:({pageParam:l})=>we(i,l,20),initialPageParam:null,getNextPageParam:l=>{if(!(!l||l.length<20))return l[l.length-1].created_at},enabled:!!i,refetchOnWindowFocus:!1}),{data:r=[]}=ne({queryKey:["reactions",i],queryFn:()=>ve(i),enabled:!!i,staleTime:1e3*60*5}),M=ie({mutationFn:({convId:l,text:g,type:c="text",media:h=[],replyToId:p=null})=>ye(l,e.id,g,c,h,p),onMutate:async l=>{await s.cancelQueries({queryKey:["messages",i]});const g=s.getQueryData(["messages",i]),c={id:`temp-${Date.now()}`,conversation_id:i,sender_id:e.id,content:l.text,type:l.type||"text",media:l.media||[],reply_to_id:l.replyToId,is_read:!1,created_at:new Date().toISOString(),isOptimistic:!0,sender:{id:e.id,username:e.handle,display_name:e.name,avatar_url:e.avatar}};return s.setQueryData(["messages",i],h=>{if(!h)return{pages:[[c]],pageParams:[null]};const p=[...h.pages];return p[0]=[c,...p[0]],{...h,pages:p}}),{previousMessages:g}},onError:(l,g,c)=>{s.setQueryData(["messages",i],c?.previousMessages),t("Failed to send message","error")},onSettled:()=>{s.invalidateQueries({queryKey:["messages",i]}),s.invalidateQueries({queryKey:["conversations",e.id]})}}),w=ie({mutationFn:({messageId:l,content:g})=>qe(l,g),onSuccess:l=>{l&&(s.invalidateQueries({queryKey:["messages",i]}),s.invalidateQueries({queryKey:["conversations",e?.id]}))},onError:()=>{t("Failed to edit message","error")}}),y=async(l,g)=>{if(e?.id)try{await Ne(l,e.id,g),s.invalidateQueries({queryKey:["reactions",i]})}catch(c){console.error("Failed to toggle reaction:",c),t("Failed to update reaction","error")}},P=async l=>{try{await $e(l),s.invalidateQueries({queryKey:["messages",i]}),s.invalidateQueries({queryKey:["conversations",e?.id]})}catch(g){console.error("Failed to delete message:",g),t("Failed to delete message","error")}};return{messages:(0,C.useMemo)(()=>[...a?.pages.flatMap(l=>l)||[]].reverse(),[a]),isMsgLoading:d,refetchMessages:f,fetchNextMessages:n,hasMoreMessages:_,isFetchingMoreMessages:m,sendMessage:(l,g,c,h,p)=>M.mutate({convId:l,text:g,type:c,media:h,replyToId:p}),editMessage:(l,g)=>w.mutate({messageId:l,content:g}),isSending:M.isPending,isEditing:w.isPending,onToggleReaction:y,onDeleteMessage:P,conversationReactions:r,formatMessages:o}};var et=G();const tt=(e,i)=>{const s=(0,et.c)(21),t=te();let o;s[0]===Symbol.for("react.memo_cache_sentinel")?(o={},s[0]=o):o=s[0];const[a,n]=(0,C.useState)(o),_=(0,C.useRef)(null);let m;s[1]===Symbol.for("react.memo_cache_sentinel")?(m={},s[1]=m):m=s[1];const d=(0,C.useRef)(m);let f;s[2]!==e||s[3]!==t?(f=async c=>{if(!(!e?.id||!c))try{await Xe(c),t.invalidateQueries({queryKey:["unread_messages_count",e.id]}),t.invalidateQueries({queryKey:["conversations",e.id]})}catch(h){console.error("Failed to mark as read:",h)}},s[2]=e,s[3]=t,s[4]=f):f=s[4];const r=f;let M;s[5]!==i||s[6]!==e||s[7]!==r||s[8]!==t?(M=()=>{if(!e?.id)return;const c=U.channel(`messages_realtime:${i||"global"}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},p=>{const u=p.new;i&&u.conversation_id===i&&(t.invalidateQueries({queryKey:["messages",i]}),u.sender_id!==e.id&&r(i)),t.invalidateQueries({queryKey:["conversations",e.id]}),u.sender_id!==e.id&&t.invalidateQueries({queryKey:["unread_messages_count",e.id]}),n(b=>({...b,[u.conversation_id]:!1}))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"messages"},()=>{t.invalidateQueries({queryKey:["messages"]}),t.invalidateQueries({queryKey:["conversations",e.id]})}).on("postgres_changes",{event:"*",schema:"public",table:"message_reactions"},()=>{i&&t.invalidateQueries({queryKey:["reactions",i]})}).subscribe(),h=U.channel("chat_typing_shared").on("broadcast",{event:"typing"},p=>{const{payload:u}=p,{conversationId:b,isTyping:v,userId:$}=u;$!==e.id&&(n(R=>({...R,[b]:v})),d.current[b]&&window.clearTimeout(d.current[b]),v&&(d.current[b]=window.setTimeout(()=>{n(R=>({...R,[b]:!1}))},5e3)))}).subscribe();return _.current=h,()=>{U.removeChannel(c),U.removeChannel(h),Object.values(d.current).forEach(window.clearTimeout)}},s[5]=i,s[6]=e,s[7]=r,s[8]=t,s[9]=M):M=s[9];const w=e?.id;let y;s[10]!==i||s[11]!==r||s[12]!==t||s[13]!==w?(y=[w,t,i,r],s[10]=i,s[11]=r,s[12]=t,s[13]=w,s[14]=y):y=s[14],(0,C.useEffect)(M,y);let P;s[15]!==e?(P=(c,h)=>{_.current&&e&&_.current.send({type:"broadcast",event:"typing",payload:{conversationId:c,isTyping:h,userId:e.id}})},s[15]=e,s[16]=P):P=s[16];const l=P;let g;return s[17]!==r||s[18]!==l||s[19]!==a?(g={typingStatus:a,sendTypingStatus:l,markAsRead:r},s[17]=r,s[18]=l,s[19]=a,s[20]=g):g=s[20],g};var st=G();const it=(e,i)=>{const s=(0,st.c)(22),{conversations:t,unreadCount:o,isConvLoading:a,refetchConversations:n}=Ae(e),{messages:_,isMsgLoading:m,refetchMessages:d,fetchNextMessages:f,hasMoreMessages:r,isFetchingMoreMessages:M,sendMessage:w,editMessage:y,isSending:P,isEditing:l,onToggleReaction:g,onDeleteMessage:c,conversationReactions:h,formatMessages:p}=Ue(e,i),{typingStatus:u,sendTypingStatus:b,markAsRead:v}=tt(e,i);let $;return s[0]!==h||s[1]!==t||s[2]!==y||s[3]!==f||s[4]!==p||s[5]!==r||s[6]!==a||s[7]!==l||s[8]!==M||s[9]!==m||s[10]!==P||s[11]!==v||s[12]!==_||s[13]!==c||s[14]!==g||s[15]!==n||s[16]!==d||s[17]!==w||s[18]!==b||s[19]!==u||s[20]!==o?($={conversations:t,unreadCount:o,isConvLoading:a,refetchConversations:n,refetchMessages:d,sendMessage:w,editMessage:y,sendTypingStatus:b,typingStatus:u,markAsRead:v,formatMessages:p,onToggleReaction:g,onDeleteMessage:c,conversationReactions:h,isSending:P,isEditing:l,messages:_,isMsgLoading:m,fetchNextMessages:f,hasMoreMessages:r,isFetchingMoreMessages:M},s[0]=h,s[1]=t,s[2]=y,s[3]=f,s[4]=p,s[5]=r,s[6]=a,s[7]=l,s[8]=M,s[9]=m,s[10]=P,s[11]=v,s[12]=_,s[13]=c,s[14]=g,s[15]=n,s[16]=d,s[17]=w,s[18]=b,s[19]=u,s[20]=o,s[21]=$):$=s[21],$};var nt=G();const Ut=(e,i,s)=>{const t=(0,nt.c)(85),o=te(),{addToast:a}=ae();let n;t[0]!==i?(n=i||{comments:0,likes:0,mirrors:0,reposts:0},t[0]=i,t[1]=n):n=t[1];const[_,m]=(0,C.useState)(n),[d,f]=(0,C.useState)(i);i!==d&&(f(i),m(x=>({...x,...i})));const r=s?.id;let M;t[2]!==e||t[3]!==r?(M=["post",e,"liked",r],t[2]=e,t[3]=r,t[4]=M):M=t[4];let w,y;t[5]!==s||t[6]!==e?(w=()=>ke(e,s.id),y=!!s&&I(e)&&I(s.id),t[5]=s,t[6]=e,t[7]=w,t[8]=y):(w=t[7],y=t[8]);let P;t[9]!==M||t[10]!==w||t[11]!==y?(P={queryKey:M,queryFn:w,enabled:y,staleTime:6e5},t[9]=M,t[10]=w,t[11]=y,t[12]=P):P=t[12];const{data:l}=ne(P),g=l===void 0?!1:l,c=s?.id;let h;t[13]!==e||t[14]!==c?(h=["post",e,"reposted",c],t[13]=e,t[14]=c,t[15]=h):h=t[15];let p,u;t[16]!==s||t[17]!==e?(u=()=>xe(e,s.id),p=!!s&&I(e)&&I(s.id),t[16]=s,t[17]=e,t[18]=p,t[19]=u):(p=t[18],u=t[19]);let b;t[20]!==p||t[21]!==h||t[22]!==u?(b={queryKey:h,queryFn:u,enabled:p,staleTime:6e5},t[20]=p,t[21]=h,t[22]=u,t[23]=b):b=t[23];const{data:v}=ne(b),$=v===void 0?!1:v;let R;t[24]!==s||t[25]!==e?(R=()=>ge(e,s.id),t[24]=s,t[25]=e,t[26]=R):R=t[26];let K;t[27]!==s||t[28]!==e||t[29]!==o?(K=async()=>{const x=s.id;await o.cancelQueries({queryKey:["post",e,"liked",x]});const j=o.getQueryData(["post",e,"liked",x]);return o.setQueryData(["post",e,"liked",x],!j),m(S=>({...S,likes:j?(S.likes||0)-1:(S.likes||0)+1})),{previousLiked:j}},t[27]=s,t[28]=e,t[29]=o,t[30]=K):K=t[30];let E;t[31]!==a||t[32]!==s||t[33]!==e||t[34]!==o?(E=(x,j,S)=>{S?.previousLiked!==void 0&&(o.setQueryData(["post",e,"liked",s.id],S.previousLiked),m(V=>({...V,likes:S.previousLiked?(V.likes||0)+1:(V.likes||0)-1}))),a("Failed to update like","error")},t[31]=a,t[32]=s,t[33]=e,t[34]=o,t[35]=E):E=t[35];let J;t[36]!==s?.id||t[37]!==e||t[38]!==o?(J=()=>{o.invalidateQueries({queryKey:["post",e,"liked",s?.id]})},t[36]=s?.id,t[37]=e,t[38]=o,t[39]=J):J=t[39];let O;t[40]!==R||t[41]!==K||t[42]!==E||t[43]!==J?(O={mutationFn:R,onMutate:K,onError:E,onSettled:J},t[40]=R,t[41]=K,t[42]=E,t[43]=J,t[44]=O):O=t[44];const L=ie(O);let T;t[45]!==s||t[46]!==e?(T=()=>Oe(e,s.id),t[45]=s,t[46]=e,t[47]=T):T=t[47];let q;t[48]!==s||t[49]!==e||t[50]!==o?(q=async()=>{const x=s.id;await o.cancelQueries({queryKey:["post",e,"reposted",x]});const j=o.getQueryData(["post",e,"reposted",x]);return o.setQueryData(["post",e,"reposted",x],!j),m(S=>({...S,reposts:j?(S.reposts||0)-1:(S.reposts||0)+1,mirrors:j?(S.mirrors||0)-1:(S.mirrors||0)+1})),{previousReposted:j}},t[48]=s,t[49]=e,t[50]=o,t[51]=q):q=t[51];let D;t[52]!==a||t[53]!==s||t[54]!==e||t[55]!==o?(D=(x,j,S)=>{S?.previousReposted!==void 0&&(o.setQueryData(["post",e,"reposted",s.id],S.previousReposted),m(V=>({...V,reposts:S.previousReposted?(V.reposts||0)+1:(V.reposts||0)-1,mirrors:S.previousReposted?(V.mirrors||0)+1:(V.mirrors||0)-1}))),a("Failed to update repost","error")},t[52]=a,t[53]=s,t[54]=e,t[55]=o,t[56]=D):D=t[56];let Q;t[57]!==s?.id||t[58]!==e||t[59]!==o?(Q=()=>{o.invalidateQueries({queryKey:["post",e,"reposted",s?.id]})},t[57]=s?.id,t[58]=e,t[59]=o,t[60]=Q):Q=t[60];let B;t[61]!==a?(B=x=>{a(x?"Reposted!":"Removed repost")},t[61]=a,t[62]=B):B=t[62];let A;t[63]!==T||t[64]!==q||t[65]!==D||t[66]!==Q||t[67]!==B?(A={mutationFn:T,onMutate:q,onError:D,onSettled:Q,onSuccess:B},t[63]=T,t[64]=q,t[65]=D,t[66]=Q,t[67]=B,t[68]=A):A=t[68];const W=ie(A);let H;t[69]!==a||t[70]!==s||t[71]!==L||t[72]!==e?(H=async x=>{if(x&&x.stopPropagation(),!s)return a("Please login to like!","error");!I(e)||!I(s.id)||L.mutate()},t[69]=a,t[70]=s,t[71]=L,t[72]=e,t[73]=H):H=t[73];const z=H;let k;t[74]!==a||t[75]!==s||t[76]!==e||t[77]!==W?(k=async x=>{if(x&&x.stopPropagation(),!s)return a("Please login to repost!","error");!I(e)||!I(s.id)||W.mutate()},t[74]=a,t[75]=s,t[76]=e,t[77]=W,t[78]=k):k=t[78];const N=k;let F;return t[79]!==z||t[80]!==N||t[81]!==g||t[82]!==$||t[83]!==_?(F={liked:g,reposted:$,localStats:_,setLocalStats:m,handleLike:z,handleRepost:N},t[79]=z,t[80]=N,t[81]=g,t[82]=$,t[83]=_,t[84]=F):F=t[84],F};var at=G();const es=e=>{const i=(0,at.c)(5);let s;i[0]!==e?(s=()=>le(e),i[0]=e,i[1]=s):s=i[1];const[t,o]=(0,C.useState)(s);let a,n;return i[2]!==e?(a=()=>{if(!e)return;const _=setTimeout(()=>{o(le(e))},0),m=setInterval(()=>{o(le(e))},6e4);return()=>{clearTimeout(_),clearInterval(m)}},n=[e],i[2]=e,i[3]=a,i[4]=n):(a=i[3],n=i[4]),(0,C.useEffect)(a,n),t};var ot=G();const ts=()=>{const e=(0,ot.c)(30),[i,s]=(0,C.useState)(!1),[t,o]=(0,C.useState)(!1),[a,n]=(0,C.useState)(0),[_,m]=(0,C.useState)(null),[d,f]=(0,C.useState)(null),r=(0,C.useRef)(null),M=(0,C.useRef)(null);let w;e[0]===Symbol.for("react.memo_cache_sentinel")?(w=[],e[0]=w):w=e[0];const y=(0,C.useRef)(w);let P,l;e[1]!==d?(P=()=>()=>{M.current&&clearInterval(M.current),r.current&&r.current.state!=="inactive"&&(r.current.stop(),r.current.stream.getTracks().forEach(rt)),d&&URL.revokeObjectURL(d)},l=[d],e[1]=d,e[2]=P,e[3]=l):(P=e[2],l=e[3]),(0,C.useEffect)(P,l);let g;e[4]===Symbol.for("react.memo_cache_sentinel")?(g=()=>{M.current=window.setInterval(()=>{n(lt)},1e3)},e[4]=g):g=e[4];const c=g;let h;e[5]===Symbol.for("react.memo_cache_sentinel")?(h=()=>{M.current&&(clearInterval(M.current),M.current=null)},e[5]=h):h=e[5];const p=h;let u;e[6]===Symbol.for("react.memo_cache_sentinel")?(u=async()=>{try{const Q=await navigator.mediaDevices.getUserMedia({audio:!0}),B=new MediaRecorder(Q);r.current=B,y.current=[],B.ondataavailable=A=>{A.data.size>0&&y.current.push(A.data)},B.onstop=()=>{const A=new Blob(y.current,{type:"audio/webm;codecs=opus"}),W=URL.createObjectURL(A);m(A),f(W),Q.getTracks().forEach(ct)},B.start(),s(!0),o(!1),n(0),c()}catch(Q){const B=Q;throw console.error("Error accessing microphone:",B),B}},e[6]=u):u=e[6];const b=u;let v;e[7]!==i?(v=()=>{r.current&&i&&(r.current.stop(),s(!1),o(!1),p())},e[7]=i,e[8]=v):v=e[8];const $=v;let R;e[9]!==t||e[10]!==i?(R=()=>{r.current&&i&&!t&&(r.current.pause(),o(!0),p())},e[9]=t,e[10]=i,e[11]=R):R=e[11];const K=R;let E;e[12]!==t||e[13]!==i?(E=()=>{r.current&&i&&t&&(r.current.resume(),o(!1),c())},e[12]=t,e[13]=i,e[14]=E):E=e[14];const J=E;let O;e[15]!==i?(O=()=>{r.current&&i&&(r.current.stop(),r.current.onstop=null,s(!1),o(!1),p(),n(0),r.current.stream&&r.current.stream.getTracks().forEach(ut))},e[15]=i,e[16]=O):O=e[16];const L=O;let T;e[17]!==d?(T=()=>{d&&URL.revokeObjectURL(d),m(null),f(null),n(0)},e[17]=d,e[18]=T):T=e[18];const q=T;let D;return e[19]!==_||e[20]!==d||e[21]!==L||e[22]!==q||e[23]!==t||e[24]!==i||e[25]!==K||e[26]!==a||e[27]!==J||e[28]!==$?(D={isRecording:i,isPaused:t,recordingTime:a,startRecording:b,stopRecording:$,pauseRecording:K,resumeRecording:J,cancelRecording:L,audioBlob:_,audioUrl:d,clearAudio:q},e[19]=_,e[20]=d,e[21]=L,e[22]=q,e[23]=t,e[24]=i,e[25]=K,e[26]=a,e[27]=J,e[28]=$,e[29]=D):D=e[29],D};function rt(e){return e.stop()}function lt(e){return e+1}function ct(e){return e.stop()}function ut(e){return e.stop()}var dt=G();const ss=(e,i,s)=>{const t=(0,dt.c)(31),o=te();let a,n;t[0]!==s||t[1]!==e?(a=["comments",e,s],n=v=>{const{pageParam:$}=v;return Me(e,$,10,s)},t[0]=s,t[1]=e,t[2]=a,t[3]=n):(a=t[2],n=t[3]);let _;t[4]!==i?(_=i?{pages:[i],pageParams:[null]}:void 0,t[4]=i,t[5]=_):_=t[5];const m=!!e;let d;t[6]!==a||t[7]!==n||t[8]!==_||t[9]!==m?(d={queryKey:a,queryFn:n,initialPageParam:null,getNextPageParam:ft,initialData:_,enabled:m},t[6]=a,t[7]=n,t[8]=_,t[9]=m,t[10]=d):d=t[10];const{data:f,fetchNextPage:r,hasNextPage:M,isFetchingNextPage:w,isLoading:y,refetch:P}=Z(d);let l;t[11]!==f?.pages?(l=f?.pages.flatMap(mt)||[],t[11]=f?.pages,t[12]=l):l=t[12];const g=l;let c;t[13]!==e?(c=v=>{const{userId:$,content:R,media:K,replyToId:E}=v;return Pe(e,$,R,K,E)},t[13]=e,t[14]=c):c=t[14];let h;t[15]!==s||t[16]!==e||t[17]!==o?(h=()=>{o.invalidateQueries({queryKey:["comments",e]}),s&&o.invalidateQueries({queryKey:["comments",e,s]})},t[15]=s,t[16]=e,t[17]=o,t[18]=h):h=t[18];let p;t[19]!==c||t[20]!==h?(p={mutationFn:c,onSuccess:h},t[19]=c,t[20]=h,t[21]=p):p=t[21];const u=ie(p);let b;return t[22]!==u.isPending||t[23]!==u.mutateAsync||t[24]!==g||t[25]!==r||t[26]!==M||t[27]!==w||t[28]!==y||t[29]!==P?(b={comments:g,fetchNextPage:r,hasNextPage:M,isFetchingNextPage:w,isLoading:y,refetch:P,addComment:u.mutateAsync,isSubmitting:u.isPending},t[22]=u.isPending,t[23]=u.mutateAsync,t[24]=g,t[25]=r,t[26]=M,t[27]=w,t[28]=y,t[29]=P,t[30]=b):b=t[30],b};function ft(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function mt(e){return e}var gt=G();const is=()=>{const e=(0,gt.c)(53),{handle:i}=re(),s=ee(),{currentUser:t}=se(),{addToast:o}=ae();let a,n;e[0]!==i?(a=["profile",i],n=()=>Ke(i),e[0]=i,e[1]=a,e[2]=n):(a=e[1],n=e[2]);const _=!!i;let m;e[3]!==a||e[4]!==n||e[5]!==_?(m={queryKey:a,queryFn:n,enabled:_,staleTime:3e5},e[3]=a,e[4]=n,e[5]=_,e[6]=m):m=e[6];const{data:d,isLoading:f}=ne(m),[r,M]=(0,C.useState)("feed"),w=d?.id;let y;e[7]!==w?(y=["posts","user",w],e[7]=w,e[8]=y):y=e[8];let P;e[9]!==d?(P=S=>{const{pageParam:V}=S;return De(d.id,V,10)},e[9]=d,e[10]=P):P=e[10];const l=!!d?.id;let g;e[11]!==y||e[12]!==P||e[13]!==l?(g={queryKey:y,queryFn:P,enabled:l,initialPageParam:null,getNextPageParam:ht},e[11]=y,e[12]=P,e[13]=l,e[14]=g):g=e[14];const{data:c,fetchNextPage:h,hasNextPage:p,isFetchingNextPage:u,isLoading:b}=Z(g);let v;e[15]!==c?.pages?(v=c?.pages.flatMap(yt)||[],e[15]=c?.pages,e[16]=v):v=e[16];const $=v,[R,K]=(0,C.useState)(!1),[E,J]=(0,C.useState)("Followers"),{followList:O,fetchNextPage:L,hasNextPage:T,isFetchingNextPage:q,isLoading:D}=Ye(d?.id,E,R);let Q;e[17]===Symbol.for("react.memo_cache_sentinel")?(Q=S=>{J(S),K(!0)},e[17]=Q):Q=e[17];const B=Q;let A;e:{if(r==="feed"){let S;e[18]!==$?(S=$.filter(pt),e[18]=$,e[19]=S):S=e[19],A=S;break e}if(r==="media"){let S;e[20]!==$?(S=$.filter(_t),e[20]=$,e[21]=S):S=e[21],A=S;break e}if(r==="collections"){let S;e[22]===Symbol.for("react.memo_cache_sentinel")?(S=[],e[22]=S):S=e[22],A=S;break e}A=$}const W=A;let H;e[23]!==s?(H=S=>{s(`/p/${S}`)},e[23]=s,e[24]=H):H=e[24];const z=H;let k;e[25]!==i||e[26]!==s?(k=S=>{S!==i&&s(`/u/${S}`)},e[25]=i,e[26]=s,e[27]=k):k=e[27];const N=k;let F;e[28]!==h?(F=()=>{h()},e[28]=h,e[29]=F):F=e[29];const x=F;let j;return e[30]!==r||e[31]!==o||e[32]!==t||e[33]!==L||e[34]!==W||e[35]!==O||e[36]!==E||e[37]!==i||e[38]!==z||e[39]!==N||e[40]!==T||e[41]!==p||e[42]!==q||e[43]!==u||e[44]!==R||e[45]!==D||e[46]!==x||e[47]!==b||e[48]!==f||e[49]!==s||e[50]!==d||e[51]!==$?(j={handle:i,profile:d,loading:f,userPosts:$,setUserPosts:Pt,activeProfileTab:r,setActiveProfileTab:M,loadingPosts:b,isFetchingMorePosts:u,hasMorePosts:p,filteredPosts:W,isFollowModalOpen:R,setIsFollowModalOpen:K,followModalType:E,followListData:O,isListLoading:D,isFetchingMoreFollows:q,hasMoreFollows:T,openFollowModal:B,fetchNextFollows:L,handlePostClick:z,handleUserClick:N,loadUserPosts:x,currentUser:t,addToast:o,navigate:s},e[30]=r,e[31]=o,e[32]=t,e[33]=L,e[34]=W,e[35]=O,e[36]=E,e[37]=i,e[38]=z,e[39]=N,e[40]=T,e[41]=p,e[42]=q,e[43]=u,e[44]=R,e[45]=D,e[46]=x,e[47]=b,e[48]=f,e[49]=s,e[50]=d,e[51]=$,e[52]=j):j=e[52],j};function ht(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function yt(e){return e}function pt(e){return e.community_id===null&&e.parent_id===null}function _t(e){return e.community_id===null&&e.parent_id===null&&(e.type==="video"||e.type==="image"||e.media&&e.media.length>0)}function Pt(){return console.warn("setUserPosts is deprecated")}var wt=G();const ns=()=>{const e=(0,wt.c)(75),{handle:i}=re(),s=ee(),{currentUser:t}=se(),{addToast:o}=ae(),a=te();let n,_;e[0]!==i?(n=["community",i],_=()=>Te(i),e[0]=i,e[1]=n,e[2]=_):(n=e[1],_=e[2]);const m=!!i;let d;e[3]!==n||e[4]!==_||e[5]!==m?(d={queryKey:n,queryFn:_,enabled:m,staleTime:6e5},e[3]=n,e[4]=_,e[5]=m,e[6]=d):d=e[6];const{data:f,isLoading:r,refetch:M}=ne(d),w=f?.id,y=t?.id;let P;e[7]!==w||e[8]!==y?(P=["community",w,"membership",y],e[7]=w,e[8]=y,e[9]=P):P=e[9];let l;e[10]!==f||e[11]!==t?(l=()=>pe(f.id,t.id),e[10]=f,e[11]=t,e[12]=l):l=e[12];const g=!!f?.id&&!!t?.id;let c;e[13]!==P||e[14]!==l||e[15]!==g?(c={queryKey:P,queryFn:l,enabled:g,staleTime:3e5},e[13]=P,e[14]=l,e[15]=g,e[16]=c):c=e[16];const{data:h}=ne(c),p=!!h,u=h?.role||null,b=f?.id;let v;e[17]!==b?(v=["posts","community",b],e[17]=b,e[18]=v):v=e[18];let $;e[19]!==f?($=j=>{const{pageParam:S}=j;return _e(f.id,S,10)},e[19]=f,e[20]=$):$=e[20];const R=!!f?.id;let K;e[21]!==v||e[22]!==$||e[23]!==R?(K={queryKey:v,queryFn:$,enabled:R,initialPageParam:null,getNextPageParam:bt},e[21]=v,e[22]=$,e[23]=R,e[24]=K):K=e[24];const{data:E,fetchNextPage:J,hasNextPage:O,isFetchingNextPage:L,isLoading:T}=Z(K);let q;e[25]!==E?.pages?(q=E?.pages.flatMap(Mt)||[],e[25]=E?.pages,e[26]=q):q=e[26];const D=q;let Q;e[27]!==f||e[28]!==t?(Q=()=>Re(f.id,t.id),e[27]=f,e[28]=t,e[29]=Q):Q=e[29];let B;e[30]!==f||e[31]!==t||e[32]!==i||e[33]!==a?(B=async()=>{const j=f.id,S=t.id;await a.cancelQueries({queryKey:["community",j,"membership",S]}),await a.cancelQueries({queryKey:["community",i]});const V=a.getQueryData(["community",j,"membership",S]),oe=a.getQueryData(["community",i]);return a.setQueryData(["community",j,"membership",S],V?null:{role:"member"}),a.setQueryData(["community",i],X=>X&&{...X,membersCount:V?X.membersCount-1:X.membersCount+1}),{previousMembership:V,previousCommunity:oe}},e[30]=f,e[31]=t,e[32]=i,e[33]=a,e[34]=B):B=e[34];let A;e[35]!==o||e[36]!==f||e[37]!==t||e[38]!==i||e[39]!==a?(A=(j,S,V)=>{V?.previousMembership!==void 0&&a.setQueryData(["community",f.id,"membership",t.id],V.previousMembership),V?.previousCommunity&&a.setQueryData(["community",i],V.previousCommunity),o("Failed to update membership","error")},e[35]=o,e[36]=f,e[37]=t,e[38]=i,e[39]=a,e[40]=A):A=e[40];let W;e[41]!==f?.id||e[42]!==t?.id||e[43]!==i||e[44]!==a?(W=()=>{a.invalidateQueries({queryKey:["community",f?.id,"membership",t?.id]}),a.invalidateQueries({queryKey:["community",i]})},e[41]=f?.id,e[42]=t?.id,e[43]=i,e[44]=a,e[45]=W):W=e[45];let H;e[46]!==o||e[47]!==f?(H=j=>{f&&o(j?`Joined ${f.name}`:`Left ${f.name}`)},e[46]=o,e[47]=f,e[48]=H):H=e[48];let z;e[49]!==Q||e[50]!==B||e[51]!==A||e[52]!==W||e[53]!==H?(z={mutationFn:Q,onMutate:B,onError:A,onSettled:W,onSuccess:H},e[49]=Q,e[50]=B,e[51]=A,e[52]=W,e[53]=H,e[54]=z):z=e[54];const k=ie(z);let N;e[55]!==o||e[56]!==t||e[57]!==k?(N=async()=>{if(!t)return o("Please login to join communities","error");k.mutate()},e[55]=o,e[56]=t,e[57]=k,e[58]=N):N=e[58];const F=N;let x;return e[59]!==o||e[60]!==f||e[61]!==D||e[62]!==t||e[63]!==J||e[64]!==F||e[65]!==O||e[66]!==L||e[67]!==p||e[68]!==k.isPending||e[69]!==r||e[70]!==T||e[71]!==s||e[72]!==M||e[73]!==u?(x={community:f,loading:r,isMember:p,userRole:u,isJoining:k.isPending,communityPosts:D,loadingPosts:T,isFetchingMorePosts:L,hasMorePosts:O,handleJoinToggle:F,loadCommunityPosts:J,refetchCommunity:M,currentUser:t,addToast:o,navigate:s},e[59]=o,e[60]=f,e[61]=D,e[62]=t,e[63]=J,e[64]=F,e[65]=O,e[66]=L,e[67]=p,e[68]=k.isPending,e[69]=r,e[70]=T,e[71]=s,e[72]=M,e[73]=u,e[74]=x):x=e[74],x};function bt(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function Mt(e){return e}var vt=G();const as=()=>{const e=(0,vt.c)(48),{currentUser:i}=se(),s=ee(),[t,o]=de();let a;e[0]!==t?(a=t.get("q")||"",e[0]=t,e[1]=a):a=e[1];const n=a;let _;e[2]!==t||e[3]!==n?(_=t.get("tab")||(n?"posts":"communities"),e[2]=t,e[3]=n,e[4]=_):_=e[4];const m=_,[d,f]=(0,C.useState)(!1);let r;e[5]===Symbol.for("react.memo_cache_sentinel")?(r=["explore","communities"],e[5]=r):r=e[5];let M;e[6]===Symbol.for("react.memo_cache_sentinel")?(M={queryKey:r,queryFn:St,initialPageParam:null,getNextPageParam:$t},e[6]=M):M=e[6];const{data:w,fetchNextPage:y,hasNextPage:P,isFetchingNextPage:l,isLoading:g}=Z(M);let c;e[7]!==w?.pages?(c=w?.pages.flatMap(Rt)||[],e[7]=w?.pages,e[8]=c):c=e[8];const h=c;let p,u;e[9]!==n?(p=["explore","posts",n],u=z=>{const{pageParam:k}=z;return n?Fe(n,k,10,!0):ze(k,10)},e[9]=n,e[10]=p,e[11]=u):(p=e[10],u=e[11]);let b;e[12]!==p||e[13]!==u?(b={queryKey:p,queryFn:u,initialPageParam:null,getNextPageParam:qt},e[12]=p,e[13]=u,e[14]=b):b=e[14];const{data:v,fetchNextPage:$,hasNextPage:R,isFetchingNextPage:K,isLoading:E}=Z(b);let J;e[15]!==v?.pages?(J=v?.pages.flatMap(Ft)||[],e[15]=v?.pages,e[16]=J):J=e[16];const O=J;let L=h;if(n){let z;if(e[17]!==L||e[18]!==n){let k;e[20]!==n?(k=N=>N.name?.toLowerCase().includes(n.toLowerCase())||N.handle?.toLowerCase().includes(n.toLowerCase()),e[20]=n,e[21]=k):k=e[21],z=L.filter(k),e[17]=L,e[18]=n,e[19]=z}else z=e[19];L=z}const T=L;let q;e[22]!==s?(q=z=>{s(`/c/${z}`)},e[22]=s,e[23]=q):q=e[23];const D=q;let Q;e[24]!==o?(Q=z=>{o(k=>(z?k.set("q",z):k.delete("q"),k),{replace:!0})},e[24]=o,e[25]=Q):Q=e[25];const B=Q;let A;e[26]!==o?(A=z=>{o(k=>(k.set("tab",z),k),{replace:!0})},e[26]=o,e[27]=A):A=e[27];const W=A;let H;return e[28]!==m||e[29]!==h||e[30]!==i||e[31]!==y||e[32]!==$||e[33]!==T||e[34]!==D||e[35]!==B||e[36]!==W||e[37]!==P||e[38]!==R||e[39]!==g||e[40]!==d||e[41]!==l||e[42]!==K||e[43]!==E||e[44]!==s||e[45]!==O||e[46]!==n?(H={currentUser:i,searchQuery:n,setSearchQuery:B,activeTab:m,setActiveTab:W,isCreateModalOpen:d,setIsCreateModalOpen:f,communitiesData:h,isCommunitiesLoading:g,isFetchingMoreCommunities:l,hasMoreCommunities:P,postsData:O,isPostsLoading:E,isFetchingMorePosts:K,hasMorePosts:R,filteredCommunities:T,handleCommunityClick:D,loadCommunities:y,loadPosts:$,navigate:s},e[28]=m,e[29]=h,e[30]=i,e[31]=y,e[32]=$,e[33]=T,e[34]=D,e[35]=B,e[36]=W,e[37]=P,e[38]=R,e[39]=g,e[40]=d,e[41]=l,e[42]=K,e[43]=E,e[44]=s,e[45]=O,e[46]=n,e[47]=H):H=e[47],H};function St(e){const{pageParam:i}=e;return Ve(i,10)}function $t(e){if(!(!e||e.length<10))return e[e.length-1].createdAt}function Rt(e){return e}function qt(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function Ft(e){return e}var Lt=G();const os=()=>{const e=(0,Lt.c)(21),{currentUser:i}=se(),{posts:s,loading:t,hasMore:o,isFetchingNextPage:a,fetchNextPage:n,refreshPosts:_}=Qe(),{addToast:m}=ae(),d=ee();let f;e[0]===Symbol.for("react.memo_cache_sentinel")?(f=["stories"],e[0]=f):f=e[0];let r;e[1]===Symbol.for("react.memo_cache_sentinel")?(r={queryKey:f,queryFn:Tt,initialPageParam:null,getNextPageParam:kt,refetchInterval:6e4},e[1]=r):r=e[1];const{data:M,isLoading:w}=Z(r);let y;if(e[2]!==M?.pages){const u=M?.pages.flatMap(Nt)||[],b=JSON.parse(localStorage.getItem("seenStories")||"[]");y=u.reduce(xt,[]).map(v=>({...v,isSeen:b.includes(v.user.id)})),e[2]=M?.pages,e[3]=y}else y=e[3];const P=y;let l;e[4]!==d?(l=u=>{d(`/p/${u}`)},e[4]=d,e[5]=l):l=e[5];const g=l;let c;e[6]!==d?(c=u=>{d(`/u/${u}`)},e[6]=d,e[7]=c):c=e[7];const h=c;let p;return e[8]!==m||e[9]!==i||e[10]!==n||e[11]!==P||e[12]!==g||e[13]!==h||e[14]!==o||e[15]!==s||e[16]!==a||e[17]!==t||e[18]!==w||e[19]!==_?(p={currentUser:i,homePosts:s,groupedStories:P,isPostsLoading:t,isStoriesLoading:w,hasMore:o,isFetchingNextPage:a,fetchNextPage:n,refreshPosts:_,addToast:m,handlePostClick:g,handleUserClick:h},e[8]=m,e[9]=i,e[10]=n,e[11]=P,e[12]=g,e[13]=h,e[14]=o,e[15]=s,e[16]=a,e[17]=t,e[18]=w,e[19]=_,e[20]=p):p=e[20],p};function Tt(e){const{pageParam:i}=e;return he(i,10)}function kt(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Nt(e){return e}function xt(e,i){const s=e.find(t=>t.user.id===i.user_id);return s?s.stories.push(i):e.push({user:i.user,stories:[i],isSeen:!1}),e}var Ct=G();const rs=()=>{const e=(0,Ct.c)(62),{id:i}=re(),s=ee(),{currentUser:t}=se(),{onlineUsers:o}=Ee(),a=te(),[n,_]=(0,C.useState)("");let m;e[0]===Symbol.for("react.memo_cache_sentinel")?(m=[],e[0]=m):m=e[0];const[d,f]=(0,C.useState)(m),{conversations:r,isConvLoading:M,refetchConversations:w,refetchMessages:y,sendMessage:P,editMessage:l,sendTypingStatus:g,typingStatus:c,markAsRead:h,formatMessages:p,onDeleteMessage:u,onToggleReaction:b,conversationReactions:v,messages:$,isMsgLoading:R,fetchNextMessages:K,hasMoreMessages:E,isFetchingMoreMessages:J}=it(t,i);let O;e:{if(!i||r.length===0){O=null;break e}let X;e[1]!==r||e[2]!==i?(X=r.find(Y=>Y.id===i)||null,e[1]=r,e[2]=i,e[3]=X):X=e[3],O=X}const L=O;let T,q;e[4]!==i||e[5]!==h?(T=()=>{i&&h(i)},q=[i,h],e[4]=i,e[5]=h,e[6]=T,e[7]=q):(T=e[6],q=e[7]),(0,C.useEffect)(T,q);let D;e[8]!==r||e[9]!==t?.id||e[10]!==n?(D=()=>{const X=setTimeout(async()=>{if(n.length>1){const Y=await Je(n),ce=r.map(Dt);f(Y.filter(ue=>ue.id!==t?.id&&!ce.includes(ue.id)))}else f([])},300);return()=>clearTimeout(X)},e[8]=r,e[9]=t?.id,e[10]=n,e[11]=D):D=e[11];const Q=t?.id;let B;e[12]!==r||e[13]!==n||e[14]!==Q?(B=[n,r,Q],e[12]=r,e[13]=n,e[14]=Q,e[15]=B):B=e[15],(0,C.useEffect)(D,B);let A;e[16]!==t||e[17]!==s||e[18]!==a?(A=async X=>{if(t)try{const Y=await Le(t.id,X.id);a.invalidateQueries({queryKey:["conversations",t.id]}),_(""),s(`/m/${Y}`)}catch(Y){console.error("Failed to start conversation:",Y)}},e[16]=t,e[17]=s,e[18]=a,e[19]=A):A=e[19];const W=A;let H;e[20]!==s?(H=X=>{s(`/m/${X.id}`)},e[20]=s,e[21]=H):H=e[21];const z=H;let k;e[22]!==v||e[23]!==p||e[24]!==$?(k=p($,v),e[22]=v,e[23]=p,e[24]=$,e[25]=k):k=e[25];const N=k;let F;if(e[26]!==r||e[27]!==n){let X;e[29]!==n?(X=Y=>Y.user?.name?.toLowerCase().includes(n.toLowerCase())||Y.user?.handle?.toLowerCase().includes(n.toLowerCase())||Y.lastMessage?.toLowerCase().includes(n.toLowerCase()),e[29]=n,e[30]=X):X=e[30],F=r.filter(X),e[26]=r,e[27]=n,e[28]=F}else F=e[28];const x=F,j=L&&c[L.id];let S;e[31]!==o||e[32]!==L?(S=L&&L.user?.id&&o.has(L.user.id),e[31]=o,e[32]=L,e[33]=S):S=e[33];const V=S;let oe;return e[34]!==r||e[35]!==j||e[36]!==t||e[37]!==l||e[38]!==K||e[39]!==x||e[40]!==z||e[41]!==W||e[42]!==E||e[43]!==i||e[44]!==M||e[45]!==J||e[46]!==R||e[47]!==N||e[48]!==n||e[49]!==s||e[50]!==u||e[51]!==b||e[52]!==o||e[53]!==V||e[54]!==w||e[55]!==y||e[56]!==L||e[57]!==P||e[58]!==g||e[59]!==c||e[60]!==d?(oe={id:i,currentUser:t,onlineUsers:o,msgSearchQuery:n,setMsgSearchQuery:_,userSearchResults:d,conversations:r,filteredConversations:x,selectedConversation:L,localMessages:N,isConvLoading:M,isMsgLoading:R,currentIsTyping:j,otherUserIsOnline:V,handleStartConversation:W,handleSelectConversation:z,refetchConversations:w,refetchMessages:y,sendMessage:P,editMessage:l,onDeleteMessage:u,sendTypingStatus:g,typingStatus:c,onToggleReaction:b,navigate:s,fetchNextMessages:K,hasMoreMessages:E,isFetchingMoreMessages:J},e[34]=r,e[35]=j,e[36]=t,e[37]=l,e[38]=K,e[39]=x,e[40]=z,e[41]=W,e[42]=E,e[43]=i,e[44]=M,e[45]=J,e[46]=R,e[47]=N,e[48]=n,e[49]=s,e[50]=u,e[51]=b,e[52]=o,e[53]=V,e[54]=w,e[55]=y,e[56]=L,e[57]=P,e[58]=g,e[59]=c,e[60]=d,e[61]=oe):oe=e[61],oe};function Dt(e){return e.user?.id}var Qt=G();const ls=()=>{const e=(0,Qt.c)(48),{currentUser:i}=se(),s=ee(),t=te(),o=i?.id;let a;e[0]!==o?(a=["notifications",o],e[0]=o,e[1]=a):a=e[1];let n;e[2]!==i?(n=q=>{const{pageParam:D}=q;return je(i.id,D,10)},e[2]=i,e[3]=n):n=e[3];const _=!!i?.id;let m;e[4]!==a||e[5]!==n||e[6]!==_?(m={queryKey:a,queryFn:n,enabled:_,initialPageParam:null,getNextPageParam:Kt},e[4]=a,e[5]=n,e[6]=_,e[7]=m):m=e[7];const{data:d,fetchNextPage:f,hasNextPage:r,isFetchingNextPage:M,isLoading:w,refetch:y}=Z(m);let P;e[8]!==d?.pages?(P=d?.pages.flatMap(Et)||[],e[8]=d?.pages,e[9]=P):P=e[9];const l=P;let g;e[10]!==i||e[11]!==t?(g=()=>{if(!i?.id)return;const q=i.id,D=U.channel(`user_notifications:${q}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${q}`},()=>{t.invalidateQueries({queryKey:["notifications",q]})}).subscribe();return()=>{U.removeChannel(D)}},e[10]=i,e[11]=t,e[12]=g):g=e[12];const c=i?.id;let h;e[13]!==t||e[14]!==c?(h=[c,t],e[13]=t,e[14]=c,e[15]=h):h=e[15],(0,C.useEffect)(g,h);let p;e[16]!==i?(p=()=>i?Se(i.id):Promise.resolve(),e[16]=i,e[17]=p):p=e[17];let u,b,v;e[18]!==i?.id||e[19]!==t?(u=async()=>{const q=i?.id;await t.cancelQueries({queryKey:["notifications",q]});const D=t.getQueryData(["notifications",q]);return t.setQueryData(["notifications",q],Bt),{previousNotifications:D}},b=(q,D,Q)=>{Q?.previousNotifications&&t.setQueryData(["notifications",i?.id],Q.previousNotifications)},v=()=>{t.invalidateQueries({queryKey:["notifications",i?.id]})},e[18]=i?.id,e[19]=t,e[20]=u,e[21]=b,e[22]=v):(u=e[20],b=e[21],v=e[22]);let $;e[23]!==u||e[24]!==b||e[25]!==v||e[26]!==p?($={mutationFn:p,onMutate:u,onError:b,onSettled:v},e[23]=u,e[24]=b,e[25]=v,e[26]=p,e[27]=$):$=e[27];const R=ie($);let K;e[28]!==s?(K=q=>{q.type==="follow"?s(`/u/${q.user}`):q.post_id&&s(`/p/${q.post_id}`)},e[28]=s,e[29]=K):K=e[29];const E=K;let J;e[30]!==i?.id||e[31]!==R||e[32]!==l?(J=()=>{i?.id&&l.some(jt)&&R.mutate()},e[30]=i?.id,e[31]=R,e[32]=l,e[33]=J):J=e[33];const O=i?.id;let L;e[34]!==R||e[35]!==l||e[36]!==O?(L=[O,l,R],e[34]=R,e[35]=l,e[36]=O,e[37]=L):L=e[37],(0,C.useEffect)(J,L);let T;return e[38]!==i||e[39]!==f||e[40]!==E||e[41]!==r||e[42]!==M||e[43]!==w||e[44]!==s||e[45]!==l||e[46]!==y?(T={currentUser:i,notifications:l,isLoading:w,isFetchingMore:M,hasMore:r,loadNotifications:f,refreshNotifications:y,handleNotificationClick:E,navigate:s},e[38]=i,e[39]=f,e[40]=E,e[41]=r,e[42]=M,e[43]=w,e[44]=s,e[45]=l,e[46]=y,e[47]=T):T=e[47],T};function Kt(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Et(e){return e}function At(e){return{...e,is_read:!0}}function Ot(e){return e.map(At)}function Bt(e){return e&&{...e,pages:e.pages.map(Ot)}}function jt(e){return!e.is_read}var Jt=G();const cs=()=>{const e=(0,Jt.c)(23),{id:i}=re(),s=ee(),{currentUser:t}=se(),{addToast:o}=ae(),a=te();let n,_;e[0]!==i?(n=["post",i],_=async()=>{if(!i||!I(i))throw new Error("Invalid post ID");return be(i)},e[0]=i,e[1]=n,e[2]=_):(n=e[1],_=e[2]);const m=!!i;let d;e[3]!==n||e[4]!==_||e[5]!==m?(d={queryKey:n,queryFn:_,enabled:m,retry:!1},e[3]=n,e[4]=_,e[5]=m,e[6]=d):d=e[6];const{data:f,isLoading:r,isError:M}=ne(d);let w;e[7]!==s?(w=p=>{s(`/u/${p}`)},e[7]=s,e[8]=w):w=e[8];const y=w;let P;e[9]!==s?(P=()=>{s(-1)},e[9]=s,e[10]=P):P=e[10];const l=P;let g;e[11]!==a?(g=(p,u,b)=>{a.setQueryData(["post",p],v=>v&&{...v,content:u,media:b})},e[11]=a,e[12]=g):g=e[12];const c=g;let h;return e[13]!==o||e[14]!==t||e[15]!==l||e[16]!==c||e[17]!==y||e[18]!==M||e[19]!==r||e[20]!==s||e[21]!==f?(h={post:f,isLoading:r,isError:M,currentUser:t,addToast:o,navigate:s,handleUserClick:y,handleDelete:l,handleUpdate:c},e[13]=o,e[14]=t,e[15]=l,e[16]=c,e[17]=y,e[18]=M,e[19]=r,e[20]=s,e[21]=f,e[22]=h):h=e[22],h};var zt=G();const us=()=>{const e=(0,zt.c)(44),i=ee(),{id:s}=re(),[t]=de();let o;e[0]!==s||e[1]!==t?(o=s||t.get("id"),e[0]=s,e[1]=t,e[2]=o):o=e[2];const a=o,n=(0,C.useRef)(null);let _;e[3]===Symbol.for("react.memo_cache_sentinel")?(_=new Map,e[3]=_):_=e[3];const m=(0,C.useRef)(_),[d,f]=(0,C.useState)(null),[r,M]=(0,C.useState)(!0);let w;e[4]===Symbol.for("react.memo_cache_sentinel")?(w=["reels"],e[4]=w):w=e[4];let y;e[5]===Symbol.for("react.memo_cache_sentinel")?(y={queryKey:w,queryFn:Ht,initialPageParam:null,getNextPageParam:Vt},e[5]=y):y=e[5];const{data:P,fetchNextPage:l,hasNextPage:g,isFetchingNextPage:c,isLoading:h}=Z(y);let p;e[6]!==P?.pages?(p=P?.pages.flatMap(Wt)||[],e[6]=P?.pages,e[7]=p):p=e[7];const u=p,[b,v]=(0,C.useState)(0);u.length>0&&u.length!==b&&!d&&(v(u.length),a&&u.find(N=>N.id===a)?f(a):f(u[0].id));let $,R;e[8]!==u.length||e[9]!==a?($=()=>{if(u.length>0&&a){const N=m.current.get(a);N&&N.scrollIntoView({behavior:"instant"})}},R=[u.length,a],e[8]=u.length,e[9]=a,e[10]=$,e[11]=R):($=e[10],R=e[11]),(0,C.useEffect)($,R);let K;e[12]===Symbol.for("react.memo_cache_sentinel")?(K=()=>{M(Xt)},e[12]=K):K=e[12];const E=K;let J;e[13]!==d||e[14]!==u?(J=()=>{if(u.length===0)return;const N=u.findIndex(F=>F.id===d);if(N<u.length-1){const F=u[N+1];m.current.get(F.id)?.scrollIntoView({behavior:"smooth"})}},e[13]=d,e[14]=u,e[15]=J):J=e[15];const O=J;let L;e[16]!==d||e[17]!==u?(L=()=>{if(u.length===0)return;const N=u.findIndex(F=>F.id===d);if(N>0){const F=u[N-1];m.current.get(F.id)?.scrollIntoView({behavior:"smooth"})}},e[16]=d,e[17]=u,e[18]=L):L=e[18];const T=L;let q,D;e[19]!==u.length?(q=()=>{if(u.length===0)return;const N={root:n.current,threshold:.6},F=j=>{j.forEach(S=>{if(S.isIntersecting){const V=S.target.getAttribute("data-id");V&&f(V)}})},x=new IntersectionObserver(F,N);return m.current.forEach(j=>x.observe(j)),()=>x.disconnect()},D=[u.length],e[19]=u.length,e[20]=q,e[21]=D):(q=e[20],D=e[21]),(0,C.useEffect)(q,D);let Q,B;e[22]!==d||e[23]!==O||e[24]!==T?(Q=()=>{const N=F=>{const x=F.target;if(!(x.tagName==="INPUT"||x.tagName==="TEXTAREA"||x.isContentEditable)&&!(F.ctrlKey||F.altKey||F.metaKey))e:switch(F.key){case"ArrowUp":F.preventDefault(),T();break e;case"ArrowDown":F.preventDefault(),O();break e;case"m":case"M":E();break e;case" ":{F.preventDefault();const j=m.current.get(d||"");if(j){const S=j.querySelector(".reel-item");S&&S.click()}}}};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},B=[d,O,T,E],e[22]=d,e[23]=O,e[24]=T,e[25]=Q,e[26]=B):(Q=e[25],B=e[26]),(0,C.useEffect)(Q,B);let A;e[27]===Symbol.for("react.memo_cache_sentinel")?(A=(N,F)=>{F?m.current.set(N,F):m.current.delete(N)},e[27]=A):A=e[27];const W=A;let H,z;e[28]!==l||e[29]!==g||e[30]!==c?(H=()=>{const N=()=>{if(!n.current||c||!g)return;const{scrollTop:x,scrollHeight:j,clientHeight:S}=n.current;x+S>=j-800&&l()},F=n.current;if(F)return F.addEventListener("scroll",N),()=>F.removeEventListener("scroll",N)},z=[c,g,l],e[28]=l,e[29]=g,e[30]=c,e[31]=H,e[32]=z):(H=e[31],z=e[32]),(0,C.useEffect)(H,z);let k;return e[33]!==d||e[34]!==l||e[35]!==g||e[36]!==c||e[37]!==h||e[38]!==r||e[39]!==i||e[40]!==u||e[41]!==O||e[42]!==T?(k={reels:u,loading:h,loadingMore:c,activeReelId:d,hasMore:g,isMuted:r,containerRef:n,setReelRef:W,navigate:i,toggleMute:E,scrollToNext:O,scrollToPrev:T,loadReels:l},e[33]=d,e[34]=l,e[35]=g,e[36]=c,e[37]=h,e[38]=r,e[39]=i,e[40]=u,e[41]=O,e[42]=T,e[43]=k):k=e[43],k};function Ht(e){const{pageParam:i}=e;return Ce(i,10)}function Vt(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function Wt(e){return e}function Xt(e){return!e}const ds=()=>{const{currentUser:e,logout:i}=se(),{darkMode:s,toggleDarkMode:t,fontSize:o,setFontSize:a,dataSaver:n,setDataSaver:_}=We(),{addToast:m}=ae(),[d,f]=(0,C.useState)(!1),[r,M]=(0,C.useState)({newPassword:"",confirmPassword:""}),[w,y]=(0,C.useState)(!1),P=async()=>{try{await i(),m("Logged out successfully")}catch(b){console.error("Logout error:",b),m("Failed to logout")}};return{currentUser:e,darkMode:s,toggleDarkMode:t,fontSize:o,setFontSize:a,dataSaver:n,setDataSaver:_,isChangingPassword:d,setIsChangingPassword:f,passwordData:r,setPasswordData:M,loading:w,handleLogout:P,handlePasswordChange:async b=>{if(b.preventDefault(),r.newPassword!==r.confirmPassword){m("Passwords do not match","error");return}if(r.newPassword.length<6){m("Password must be at least 6 characters","error");return}y(!0);try{const{error:v}=await U.auth.updateUser({password:r.newPassword});if(v)throw v;m("Password updated successfully!"),f(!1),M({newPassword:"",confirmPassword:""})}catch(v){console.error("Password update error:",v),m(v.message||"Failed to update password","error")}finally{y(!1)}},handlePasswordReset:async()=>{if(e?.email){y(!0);try{const{error:b}=await U.auth.resetPasswordForEmail(e.email,{redirectTo:`${window.location.origin}/settings?type=recovery`});if(b)throw b;m("Password reset email sent!")}catch(b){console.error("Reset password error:",b),m(b.message||"Failed to send reset email","error")}finally{y(!1)}}},handleClearCache:()=>{["seenStories","font-size","data-saver","theme"].forEach(b=>localStorage.removeItem(b)),m("Cache cleared! Reloading..."),setTimeout(()=>window.location.reload(),1500)},handleDownloadData:async()=>{if(e){y(!0);try{const b={user:{id:e.id,handle:e.handle,name:e.name,email:e.email},exportDate:new Date().toISOString(),note:"This is a mock export of your Sysm data."},v=new Blob([JSON.stringify(b,null,2)],{type:"application/json"}),$=URL.createObjectURL(v),R=document.createElement("a");R.href=$,R.download=`sysm-data-${e.handle}.json`,R.click(),URL.revokeObjectURL($),m("Data export started!")}catch{m("Failed to export data","error")}finally{y(!1)}}},handleDeleteAccount:()=>{window.confirm("Are you absolutely sure? This will permanently delete your account and all associated data. This action is irreversible.")&&(m("Account deletion request submitted. Logging out..."),setTimeout(P,2e3))},handleReportBug:()=>{window.prompt("Please describe the bug you found:")&&m("Bug reported! Thank you for your feedback.")}}};export{rs as a,ns as c,ts as d,es as f,ls as i,is as l,us as n,os as o,Ut as p,cs as r,as as s,ds as t,ss as u};
