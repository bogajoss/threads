import{n as H}from"./rolldown-runtime-2JzG8er9.js";import{s as K,u as ne,w as le,y as ee}from"./framework-pMVb9Z5_.js";import"./database-ApDMvJcm.js";import{Bt as ce,Ct as te,Et as oe,Pt as de,Ut as D,an as xe,bn as me,bt as he,gt as ue,hn as be,kt as pe,lt as fe,mn as je,sn as ge,ut as Y}from"./ui-libs-C0jnt0Gl.js";import{$ as B,F as se,G as ve,J as ze,K as Ne,N as re,O as ke,P as ae,Q as q,X as we,Y as Z,Z as ye,et as F,gt as Ce,h as Se,q as J,ut as Me,z as $e}from"./index-Be8osr5q.js";import{n as Ie,t as Te}from"./linkify-fXGRsD3N.js";import{a as Pe,u as ie}from"./hooks-BkWyKt0E.js";var Re=K(),P=H(le(),1),t=H(ne(),1),Ue=s=>{const e=(0,Re.c)(55),{conv:a,selectedId:p,onSelect:o,onlineUsers:c}=s,d=ee(),n=ie(a.user?.lastSeen);let i;e[0]!==a.user?.id||e[1]!==c?(i=c.has(a.user?.id),e[0]=a.user?.id,e[1]=c,e[2]=i):i=e[2];const m=i;let z;e[3]!==a.user||e[4]!==d?(z=Q=>{Q.stopPropagation(),a.user?.handle&&d(`/u/${a.user.handle}`)},e[3]=a.user,e[4]=d,e[5]=z):z=e[5];const x=z;let j;e[6]!==a||e[7]!==o?(j=()=>o(a),e[6]=a,e[7]=o,e[8]=j):j=e[8];const g=`flex items-center gap-3 p-4 cursor-pointer transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900 ${p===a.id?"bg-zinc-50 dark:bg-zinc-900 border-r-2 border-violet-500":""}`,w=a.user?.avatar,T=a.user?.name;let y;e[9]!==w||e[10]!==T?(y=(0,t.jsx)(F,{src:w,alt:T,className:"object-cover"}),e[9]=w,e[10]=T,e[11]=y):y=e[11];let f;e[12]!==a.user?.name?.[0]?(f=a.user?.name?.[0]?.toUpperCase(),e[12]=a.user?.name?.[0],e[13]=f):f=e[13];let k;e[14]!==f?(k=(0,t.jsx)(B,{children:f}),e[14]=f,e[15]=k):k=e[15];let S;e[16]!==y||e[17]!==k?(S=(0,t.jsxs)(q,{className:"size-12 group-hover:brightness-90 transition-all",children:[y,k]}),e[16]=y,e[17]=k,e[18]=S):S=e[18];let M;e[19]!==m?(M=m&&(0,t.jsx)("span",{className:"absolute bottom-0 right-0 size-3 bg-emerald-500 border-2 border-white dark:border-black rounded-full"}),e[19]=m,e[20]=M):M=e[20];let N;e[21]!==x||e[22]!==S||e[23]!==M?(N=(0,t.jsxs)("div",{className:"relative group",onClick:x,children:[S,M]}),e[21]=x,e[22]=S,e[23]=M,e[24]=N):N=e[24];const $=a.user?.name;let v;e[25]!==x||e[26]!==$?(v=(0,t.jsx)("span",{onClick:x,className:"font-bold dark:text-white truncate cursor-pointer",children:$}),e[25]=x,e[26]=$,e[27]=v):v=e[27];let u;e[28]!==a.user?.lastSeen||e[29]!==m||e[30]!==n?(u=m?(0,t.jsx)("span",{className:"text-[10px] text-emerald-500 font-medium leading-none mb-1",children:"Online"}):a.user?.lastSeen&&(0,t.jsx)("span",{className:"text-[10px] text-zinc-500 font-medium leading-none mb-1",children:n}),e[28]=a.user?.lastSeen,e[29]=m,e[30]=n,e[31]=u):u=e[31];let b;e[32]!==v||e[33]!==u?(b=(0,t.jsxs)("div",{className:"flex flex-col min-w-0",children:[v,u]}),e[32]=v,e[33]=u,e[34]=b):b=e[34];let C;e[35]!==a.time?(C=(0,t.jsx)("span",{className:"text-xs text-zinc-500 whitespace-nowrap ml-2",children:a.time}),e[35]=a.time,e[36]=C):C=e[36];let h;e[37]!==b||e[38]!==C?(h=(0,t.jsxs)("div",{className:"flex justify-between items-center mb-0.5",children:[b,C]}),e[37]=b,e[38]=C,e[39]=h):h=e[39];let U;e[40]!==a.lastMessage?(U=(0,t.jsx)("p",{className:"text-zinc-500 text-sm truncate pr-2",children:a.lastMessage}),e[40]=a.lastMessage,e[41]=U):U=e[41];let E;e[42]!==a.unread?(E=a.unread>0&&(0,t.jsx)("span",{className:"bg-violet-600 text-white text-[10px] font-bold size-5 rounded-full flex items-center justify-center shrink-0",children:a.unread}),e[42]=a.unread,e[43]=E):E=e[43];let O;e[44]!==U||e[45]!==E?(O=(0,t.jsxs)("div",{className:"flex-1 flex justify-between items-center",children:[U,E]}),e[44]=U,e[45]=E,e[46]=O):O=e[46];let L;e[47]!==h||e[48]!==O?(L=(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[h,O]}),e[47]=h,e[48]=O,e[49]=L):L=e[49];let A;return e[50]!==N||e[51]!==L||e[52]!==j||e[53]!==g?(A=(0,t.jsxs)("div",{onClick:j,className:g,children:[N,L]}),e[50]=N,e[51]=L,e[52]=j,e[53]=g,e[54]=A):A=e[54],A},Ee=({conversations:s,userResults:e=[],onSelect:a,onStartNew:p,selectedId:o,searchQuery:c,onSearchChange:d,onlineUsers:n=new Set})=>(0,t.jsxs)("div",{className:"flex-1 flex flex-col min-w-0 bg-white dark:bg-black",children:[(0,t.jsx)("div",{className:"p-4 border-b border-zinc-100 dark:border-zinc-800",children:(0,t.jsx)(ke,{value:c,onChange:d,onClear:()=>d(""),placeholder:"Search people or messages..."})}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[s.length>0&&(0,t.jsx)("div",{className:"py-2",children:s.filter(i=>i.lastMessage!=="No messages yet"||i.id===o).map(i=>(0,t.jsx)(Ue,{conv:i,selectedId:o,onSelect:a,onlineUsers:n},i.id))}),e.length>0&&(0,t.jsxs)("div",{className:"border-t border-zinc-100 dark:border-zinc-800",children:[(0,t.jsx)("div",{className:"px-4 py-3 text-xs font-bold text-zinc-500 uppercase tracking-wider",children:"People"}),e.map(i=>(0,t.jsxs)("div",{onClick:()=>p(i),className:"flex items-center gap-3 p-4 cursor-pointer transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[(0,t.jsxs)(q,{className:"size-12",children:[(0,t.jsx)(F,{src:i.avatar,alt:i.name,className:"object-cover"}),(0,t.jsx)(B,{children:i.name?.[0]?.toUpperCase()})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"font-bold dark:text-white truncate",children:i.name}),(0,t.jsxs)("div",{className:"text-zinc-500 text-sm truncate",children:["@",i.handle]})]}),(0,t.jsx)(ue,{size:18,className:"text-violet-500"})]},i.id))]}),s.length===0&&e.length===0&&c&&(0,t.jsx)("div",{className:"p-8 text-center",children:(0,t.jsxs)("p",{className:"text-zinc-500 text-sm",children:['No conversations or people found for "',c,'"']})}),s.length===0&&!c&&(0,t.jsx)("div",{className:"p-8 text-center",children:(0,t.jsx)("p",{className:"text-zinc-500 text-sm",children:"No messages yet. Search for people to start a chat!"})})]})]}),Oe=Ee,Le=K(),Ae=["â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ‘"],_e=s=>{const e=(0,Le.c)(6),{onSelect:a,currentReaction:p}=s;let o;e[0]===Symbol.for("react.memo_cache_sentinel")?(o=(0,t.jsx)(se,{asChild:!0,children:(0,t.jsx)("button",{className:"p-1.5 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-all active:scale-90",onClick:qe,children:(0,t.jsx)(te,{size:16})})}),e[0]=o):o=e[0];let c;e[1]!==p||e[2]!==a?(c=Ae.map(n=>(0,t.jsx)("button",{onClick:()=>a(n),className:`text-xl p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-all active:scale-125 ${p===n?"bg-zinc-100 dark:bg-zinc-800":""}`,children:n},n)),e[1]=p,e[2]=a,e[3]=c):c=e[3];let d;return e[4]!==c?(d=(0,t.jsxs)(re,{children:[o,(0,t.jsx)(ae,{side:"top",align:"center",className:"w-fit p-1 rounded-full bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 shadow-xl",onClick:Fe,children:(0,t.jsx)("div",{className:"flex items-center gap-1",children:c})})]}),e[4]=c,e[5]=d):d=e[5],d},Be=_e;function qe(s){return s.stopPropagation()}function Fe(s){return s.stopPropagation()}var Ke=K(),Qe=s=>{const e=(0,Ke.c)(10),{reactions:a,currentUser:p,onToggle:o}=s;let c;e[0]!==a?(c=a===void 0?[]:a,e[0]=a,e[1]=c):c=e[1];const d=c;let n;e[2]!==p?.id||e[3]!==d?(n={},d.forEach(x=>{n[x.emoji]||(n[x.emoji]={count:0,me:!1}),n[x.emoji].count=n[x.emoji].count+1,x.user_id===p?.id&&(n[x.emoji].me=!0)}),e[2]=p?.id,e[3]=d,e[4]=n):n=e[4];const i=n;if(d.length===0)return null;let m;e[5]!==i?(m=Object.entries(i),e[5]=i,e[6]=m):m=e[6];let z;return e[7]!==o||e[8]!==m?(z=(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mt-1 px-2",children:m.map(x=>{const[j,g]=x;return(0,t.jsxs)("button",{onClick:w=>{w.stopPropagation(),o(j)},className:`flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium border transition-all active:scale-90 ${g.me?"bg-violet-50 border-violet-200 text-violet-600 dark:bg-violet-900/30 dark:border-violet-800 dark:text-violet-400":"bg-white border-zinc-100 text-zinc-600 dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-400"}`,children:[(0,t.jsx)("span",{children:j}),g.count>1&&(0,t.jsx)("span",{children:g.count})]},j)})}),e[7]=o,e[8]=m,e[9]=z):z=e[9],z},We=Qe,Je=["â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ‘"],De=({conversation:s,messages:e,onBack:a,onSendMessage:p,onToggleReaction:o,onDeleteMessage:c,currentUser:d,onTyping:n,isLoading:i,isTyping:m,isOnline:z})=>{const x=ee(),{openLightbox:j}=Me(),[g,w]=(0,P.useState)(""),[T,y]=(0,P.useState)(!1),[f,k]=(0,P.useState)([]),[S,M]=(0,P.useState)(!1),[N,$]=(0,P.useState)(null),v=(0,P.useRef)(null),u=(0,P.useRef)(null),b=(0,P.useRef)(null),C=ie(s.user?.lastSeen);(0,P.useEffect)(()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},[e,m]);const h=r=>{const l=r.target.value;w(l),n&&(n(!0),b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{n(!1)},2e3))},U=r=>{w(l=>l+r.emoji)},E=r=>{r.preventDefault(),!(!g.trim()&&f.length===0)&&(n&&(clearTimeout(b.current),n(!1)),p(s.id,g,f.length>0?"image":"text",f,N?.id),w(""),k([]),$(null))},O=async r=>{const l=Array.from(r.target.files);if(l.length!==0){y(!0);try{const I=await Promise.all(l.map(R=>Ce(R)));k(R=>[...R,...I])}catch(I){console.error("Upload failed:",I)}finally{y(!1)}}},L=r=>{k(l=>l.filter(I=>I.url!==r))},A=r=>{!r.media||r.media.length===0||j(r.media.map(l=>l.url),0)},Q=(0,P.useMemo)(()=>{const r=e.filter(l=>l.sender==="me");return r.length>0?r[r.length-1].id:null},[e]),G=r=>e.find(l=>l.id===r);return(0,t.jsxs)("div",{className:"flex-1 flex flex-col h-full min-w-0 bg-white dark:bg-black md:border-l md:border-zinc-100 dark:md:border-zinc-800",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-between shrink-0 bg-white/80 dark:bg-black/80 backdrop-blur-md sticky top-0 z-10",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{onClick:a,className:"md:hidden p-1 rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-800 dark:text-white transition-colors",children:(0,t.jsx)(me,{size:20})}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)(q,{className:"size-10 border border-zinc-200 dark:border-zinc-700",children:[(0,t.jsx)(F,{src:s.user.avatar,alt:s.user.name,className:"object-cover"}),(0,t.jsx)(B,{children:s.user.name?.[0]?.toUpperCase()})]}),z&&(0,t.jsx)("span",{className:"absolute bottom-0 right-0 size-3 bg-emerald-500 border-2 border-white dark:border-black rounded-full"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-bold dark:text-white",children:s.user.name}),z?(0,t.jsxs)("div",{className:"text-xs text-emerald-500 font-medium flex items-center gap-1",children:[(0,t.jsx)("span",{className:"size-1.5 bg-emerald-500 rounded-full animate-pulse"}),"Online"]}):(0,t.jsx)("div",{className:"text-xs text-zinc-500 font-medium",children:s.user.lastSeen?`Last seen ${C}`:"Offline"})]})]}),(0,t.jsx)("button",{className:"p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full dark:text-zinc-400",children:(0,t.jsx)(xe,{size:20})})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",ref:u,children:[(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsxs)("div",{className:"relative w-fit mx-auto",children:[(0,t.jsxs)(q,{className:"size-20 mx-auto mb-3 border-4 border-zinc-50 dark:border-zinc-900 shadow-sm",children:[(0,t.jsx)(F,{src:s.user.avatar,alt:s.user.name,className:"object-cover"}),(0,t.jsx)(B,{className:"text-2xl font-bold",children:s.user.name?.[0]?.toUpperCase()})]}),z&&(0,t.jsx)("span",{className:"absolute bottom-4 right-1 size-5 bg-emerald-500 border-4 border-white dark:border-black rounded-full animate-in zoom-in duration-300"})]}),(0,t.jsx)("h4",{className:"font-bold dark:text-white text-lg",children:s.user.name}),(0,t.jsxs)("p",{className:"text-sm text-zinc-500",children:["@",s.user.handle]}),(0,t.jsxs)("p",{className:"text-xs text-zinc-400 mt-4 max-w-xs mx-auto",children:["This is the beginning of your direct message history with"," ",(0,t.jsxs)("span",{className:"font-bold",children:["@",s.user.handle]})]})]}),i&&e.length===0?(0,t.jsx)("div",{className:"flex justify-center p-8",children:(0,t.jsx)(D,{className:"animate-spin text-violet-500",size:32})}):e.map(r=>(0,t.jsxs)(ve,{children:[(0,t.jsx)(we,{asChild:!0,children:(0,t.jsxs)("div",{id:`msg-${r.id}`,className:`flex items-end gap-2 group ${r.sender==="me"?"flex-row-reverse":"flex-row"}`,children:[(0,t.jsxs)("div",{className:`max-w-[75%] p-1 rounded-2xl text-[15px] shadow-sm relative ${r.sender==="me"?"bg-violet-600 text-white rounded-tr-none":"bg-zinc-100 dark:bg-zinc-800 dark:text-white rounded-tl-none"}`,children:[r.replyToId&&(0,t.jsxs)("div",{className:`mb-2 p-2 rounded-lg border-l-4 text-xs truncate cursor-pointer ${r.sender==="me"?"bg-violet-500/50 border-violet-300 text-violet-100":"bg-zinc-200/50 dark:bg-zinc-700/50 border-zinc-400 dark:border-zinc-500 text-zinc-600 dark:text-zinc-300"}`,onClick:l=>{l.stopPropagation(),document.getElementById(`msg-${r.replyToId}`)?.scrollIntoView({behavior:"smooth",block:"center"})},children:[(0,t.jsx)("span",{className:"font-bold block mb-0.5",children:G(r.replyToId)?.sender==="me"?"You":s.user.name}),G(r.replyToId)?.text||"Media"]}),r.media?.length>0&&(0,t.jsx)("div",{className:"mb-2 grid gap-1 grid-cols-1 overflow-hidden rounded-lg cursor-pointer",onClick:()=>A(r),children:r.media.map((l,I)=>(0,t.jsx)("img",{src:l.url,alt:"",className:"max-h-60 w-full object-cover rounded-md hover:brightness-90 transition-all"},I))}),r.text&&(0,t.jsx)("div",{className:"m-0 leading-tight px-3 py-1 whitespace-pre-line break-words",children:(0,t.jsx)(Ie,{options:{...Te,render:({attributes:l,content:I})=>{const{href:R,...V}=l,X=window.location.origin;let _=null;return R.startsWith("/")?_=R:R.startsWith(X)&&(_=R.replace(X,"")),_?(0,t.jsx)("span",{...V,className:`font-semibold underline decoration-1 underline-offset-4 cursor-pointer transition-opacity break-all ${r.sender==="me"?"text-white":"text-violet-600 dark:text-violet-400"}`,onClick:W=>{W.stopPropagation(),x(_)},children:I},I):(0,t.jsx)("a",{href:R,...V,className:`underline decoration-1 underline-offset-4 hover:opacity-80 transition-opacity break-all ${r.sender==="me"?"text-white":"text-violet-600 dark:text-violet-400"}`,target:"_blank",rel:"noopener noreferrer",onClick:W=>W.stopPropagation(),children:I},I)}},children:r.text})}),r.reactions?.length>0&&(0,t.jsx)(We,{reactions:r.reactions,currentUser:d,onToggle:l=>o(r.id,l)}),(0,t.jsxs)("div",{className:`text-[10px] flex items-center justify-end gap-1 px-3 pb-1 ${r.sender==="me"?"text-violet-200":"text-zinc-400"}`,children:[r.time,r.sender==="me"&&r.id===Q&&(0,t.jsx)("span",{className:"ml-0.5",children:r.isRead?(0,t.jsx)(be,{size:14,className:"text-white"}):(0,t.jsx)(je,{size:14,className:"text-violet-200"})})]})]}),(0,t.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(Be,{onSelect:l=>o(r.id,l),currentReaction:r.reactions?.find(l=>l.user_id===d?.id)?.emoji})})]})}),(0,t.jsxs)(Ne,{className:"w-64 rounded-xl bg-white dark:bg-zinc-950 border-zinc-100 dark:border-zinc-800 shadow-xl",children:[(0,t.jsx)(ze,{className:"text-xs text-zinc-500 font-bold px-3 py-2",children:"QUICK REACTION"}),(0,t.jsx)("div",{className:"flex items-center justify-between px-2 pb-2",children:Je.map(l=>(0,t.jsx)("button",{onClick:()=>o(r.id,l),className:"text-xl p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-all active:scale-125",children:l},l))}),(0,t.jsx)(Z,{className:"bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsxs)(J,{className:"gap-3 px-3 py-2.5 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-900",onClick:()=>{navigator.clipboard.writeText(r.text)},children:[(0,t.jsx)(ge,{size:16,className:"text-zinc-500"}),(0,t.jsx)("span",{className:"font-medium",children:"Copy Text"})]}),(0,t.jsxs)(J,{className:"gap-3 px-3 py-2.5 cursor-pointer focus:bg-zinc-50 dark:focus:bg-zinc-900",onClick:()=>$(r),children:[(0,t.jsx)(pe,{size:16,className:"text-zinc-500"}),(0,t.jsx)("span",{className:"font-medium",children:"Reply"})]}),(0,t.jsx)(Z,{className:"bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsxs)(J,{className:"gap-3 px-3 py-2.5 cursor-pointer text-rose-500 focus:text-rose-500 focus:bg-rose-50 dark:focus:bg-rose-900/20",onClick:()=>c(r.id),children:[(0,t.jsx)(he,{size:16}),(0,t.jsx)("span",{className:"font-medium",children:"Delete message"})]})]})]},r.id)),m&&(0,t.jsx)("div",{className:"flex justify-start animate-in fade-in slide-in-from-bottom-2 duration-300",children:(0,t.jsx)("div",{className:"bg-zinc-100 dark:bg-zinc-800/50 px-3 py-2 rounded-2xl rounded-tl-none border border-zinc-200/50 dark:border-zinc-700/30 shadow-sm",children:(0,t.jsx)(Se,{})})})]}),(0,t.jsxs)("div",{className:"p-4 border-t border-zinc-100 dark:border-zinc-800 bg-white dark:bg-black shrink-0",children:[N&&(0,t.jsxs)("div",{className:"mb-3 p-3 bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-xl flex items-center justify-between animate-in slide-in-from-bottom-2 duration-200",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("span",{className:"text-xs font-bold text-violet-600 dark:text-violet-400 block mb-1",children:["Replying to"," ",N.sender==="me"?"yourself":s.user.name]}),(0,t.jsx)("p",{className:"text-sm text-zinc-500 truncate",children:N.text||"Media"})]}),(0,t.jsx)("button",{onClick:()=>$(null),className:"p-1 hover:bg-zinc-200 dark:hover:bg-zinc-800 rounded-full text-zinc-400 transition-colors",children:(0,t.jsx)(Y,{size:18})})]}),f.length>0&&(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 mb-3",children:[f.map(r=>(0,t.jsxs)("div",{className:"relative size-16 rounded-xl overflow-hidden border border-zinc-200 dark:border-zinc-800",children:[(0,t.jsx)("img",{src:r.url,className:"size-full object-cover",alt:""}),(0,t.jsx)("button",{type:"button",onClick:()=>L(r.url),className:"absolute top-1 right-1 bg-black/50 text-white rounded-full p-0.5 hover:bg-black transition-colors",children:(0,t.jsx)(Y,{size:12})})]},r.url)),T&&(0,t.jsx)("div",{className:"size-16 rounded-xl bg-zinc-100 dark:bg-zinc-900 flex items-center justify-center",children:(0,t.jsx)(D,{className:"animate-spin text-violet-500",size:20})})]}),(0,t.jsxs)("form",{onSubmit:E,className:"flex items-center gap-2 bg-zinc-100 dark:bg-zinc-900 p-2 rounded-2xl border border-transparent focus-within:border-violet-500 transition-all",children:[(0,t.jsxs)(re,{open:S,onOpenChange:M,children:[(0,t.jsx)(se,{asChild:!0,children:(0,t.jsx)("button",{type:"button",className:"p-2 text-zinc-500 hover:text-violet-600 transition-colors",children:(0,t.jsx)(te,{size:20})})}),(0,t.jsx)(ae,{className:"w-fit p-0 border-none bg-transparent shadow-none",side:"top",align:"start",sideOffset:10,children:(0,t.jsx)($e,{onEmojiSelect:r=>{U(r)}})})]}),(0,t.jsx)("input",{type:"text",className:"flex-1 min-w-0 bg-transparent border-none outline-none dark:text-white py-1 px-1",placeholder:"Start a new message",value:g,onChange:h}),(0,t.jsx)("input",{type:"file",ref:v,onChange:O,className:"hidden",multiple:!0,accept:"image/*"}),(0,t.jsx)("button",{type:"button",onClick:()=>v.current?.click(),className:"p-2 text-zinc-500 hover:text-violet-600 transition-colors",disabled:T,children:(0,t.jsx)(de,{size:20})}),(0,t.jsx)(ye,{type:"submit",className:"size-10 !p-0 rounded-xl",disabled:!g.trim()&&f.length===0||T,children:(0,t.jsx)(oe,{size:18})})]})]})]})},Ge=De,Ve=K(),Xe=()=>{const s=(0,Ve.c)(30),{id:e,currentUser:a,onlineUsers:p,msgSearchQuery:o,setMsgSearchQuery:c,userSearchResults:d,filteredConversations:n,selectedConversation:i,localMessages:m,isConvLoading:z,isMsgLoading:x,currentIsTyping:j,otherUserIsOnline:g,handleStartConversation:w,handleSelectConversation:T,sendMessage:y,sendTypingStatus:f,onToggleReaction:k,navigate:S}=Pe();if(!a){let h;return s[0]===Symbol.for("react.memo_cache_sentinel")?(h=(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-screen gap-4 p-8 text-center bg-white dark:bg-black md:rounded-xl md:border border-zinc-100 dark:border-zinc-800",children:[(0,t.jsx)("div",{className:"bg-zinc-100 dark:bg-zinc-900 p-4 rounded-full",children:(0,t.jsx)(fe,{size:40,className:"text-zinc-400"})}),(0,t.jsx)("h3",{className:"text-xl font-bold dark:text-white",children:"Sign in to message others"}),(0,t.jsx)("p",{className:"text-zinc-500 max-w-xs",children:"Start decentralized conversations with anyone on the network."})]}),s[0]=h):h=s[0],h}if(z){let h;return s[1]===Symbol.for("react.memo_cache_sentinel")?(h=(0,t.jsx)("div",{className:"flex h-screen items-center justify-center bg-white dark:bg-black md:rounded-xl md:border border-zinc-100 dark:border-zinc-800",children:(0,t.jsx)(D,{className:"animate-spin text-violet-500",size:32})}),s[1]=h):h=s[1],h}const M=`flex ${e?"h-[100dvh]":"h-[calc(100dvh-4rem)]"} md:h-[calc(100vh-2rem)] bg-white dark:bg-black overflow-hidden md:rounded-xl md:border border-zinc-100 dark:border-zinc-800`,N=`w-full md:w-80 flex flex-col border-r border-zinc-100 dark:border-zinc-800 ${i?"hidden md:flex":"flex"}`;let $;s[2]===Symbol.for("react.memo_cache_sentinel")?($=(0,t.jsx)("div",{className:"p-4 border-b border-zinc-100 dark:border-zinc-800",children:(0,t.jsx)("h2",{className:"text-xl font-bold dark:text-white",children:"Messages"})}),s[2]=$):$=s[2];let v;s[3]!==n||s[4]!==T||s[5]!==w||s[6]!==e||s[7]!==o||s[8]!==p||s[9]!==c||s[10]!==d?(v=(0,t.jsx)(Oe,{conversations:n,userResults:d,onSelect:T,onStartNew:w,selectedId:e,searchQuery:o,onSearchChange:c,onlineUsers:p}),s[3]=n,s[4]=T,s[5]=w,s[6]=e,s[7]=o,s[8]=p,s[9]=c,s[10]=d,s[11]=v):v=s[11];let u;s[12]!==N||s[13]!==v?(u=(0,t.jsxs)("div",{className:N,children:[$,v]}),s[12]=N,s[13]=v,s[14]=u):u=s[14];let b;s[15]!==j||s[16]!==a||s[17]!==x||s[18]!==m||s[19]!==S||s[20]!==k||s[21]!==g||s[22]!==i||s[23]!==y||s[24]!==f?(b=i?(0,t.jsx)(Ge,{conversation:i,messages:m,onBack:()=>S("/messages"),onSendMessage:y,onToggleReaction:k,currentUser:a,onTyping:h=>f(i.id,h),isLoading:x,isTyping:j,isOnline:g}):(0,t.jsxs)("div",{className:"hidden md:flex flex-1 items-center justify-center text-zinc-500 flex-col gap-4",children:[(0,t.jsx)("div",{className:"bg-zinc-50 dark:bg-zinc-900 p-6 rounded-full",children:(0,t.jsx)(ce,{size:48,className:"text-zinc-300"})}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:"Select a message"}),(0,t.jsx)("p",{children:"Choose from your existing conversations or start a new one."})]})]}),s[15]=j,s[16]=a,s[17]=x,s[18]=m,s[19]=S,s[20]=k,s[21]=g,s[22]=i,s[23]=y,s[24]=f,s[25]=b):b=s[25];let C;return s[26]!==M||s[27]!==u||s[28]!==b?(C=(0,t.jsxs)("div",{className:M,children:[u,b]}),s[26]=M,s[27]=u,s[28]=b,s[29]=C):C=s[29],C},at=Xe;export{at as default};
