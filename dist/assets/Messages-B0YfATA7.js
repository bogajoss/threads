import{a as te}from"./rolldown-runtime-BaZ8gS7u.js";import{T as ie,s as se,u as ae,y as le}from"./framework-DIDnLsp9.js";import"./database-DlIwwAmc.js";import{$n as ne,Ft as W,Ht as Z,Kn as ce,Kt as de,Pt as oe,Rn as xe,Rt as me,Tn as he,X as ue,Xt as pe,Y as G,Yt as fe,en as be,gn as ge,mn as je,qn as ve,rn as Q,sn as ze,tn as ee,un as Ne,wn as ke,xn as re}from"./ui-libs-x7JJBDE0.js";import{$ as K,A as we,B as ye,F as Ce,I as Se,J as Me,Kt as $,P as Ie,Q as _,X as Te,Y as J,Z as Pe,_t as $e,dt as Ae,et as B,h as Re,q as Ue,ut as Le}from"./index-DWcKU9eN.js";import{n as qe,t as Ee}from"./linkify-DBRQwEj8.js";import{a as Oe,u as Ye}from"./hooks-CJsqxYV0.js";var Fe=se(),P=te(ie(),1),e=te(ae(),1),Ke=s=>{const t=(0,Fe.c)(59),{conv:a,selectedId:A,onSelect:v,onlineUsers:b}=s;let o;t[0]!==a.user?.id||t[1]!==b?(o=b.has(a.user?.id),t[0]=a.user?.id,t[1]=b,t[2]=o):o=t[2];const z=o,h=A===a.id,i=a.unread>0;let w;t[3]!==a||t[4]!==v?(w=()=>v(a),t[3]=a,t[4]=v,t[5]=w):w=t[5];const R=h?"bg-violet-500/10 dark:bg-violet-500/20":"hover:bg-zinc-100 dark:hover:bg-zinc-800/50";let u;t[6]!==R?(u=$("group relative flex cursor-pointer items-center gap-4 p-3 mx-2 rounded-2xl transition-all duration-200",R),t[6]=R,t[7]=u):u=t[7];const y=h?"border-violet-500/30":"border-transparent group-hover:border-zinc-200 dark:group-hover:border-zinc-700";let C;t[8]!==y?(C=$("size-[52px] border-2 transition-all",y),t[8]=y,t[9]=C):C=t[9];const M=a.user?.avatar,p=a.user?.name;let g;t[10]!==M||t[11]!==p?(g=(0,e.jsx)(B,{src:M,alt:p,className:"object-cover"}),t[10]=M,t[11]=p,t[12]=g):g=t[12];let N;t[13]!==a.user?.name?.[0]?(N=a.user?.name?.[0]?.toUpperCase(),t[13]=a.user?.name?.[0],t[14]=N):N=t[14];let k;t[15]!==N?(k=(0,e.jsx)(K,{className:"bg-zinc-100 text-zinc-500 font-bold text-lg dark:bg-zinc-800 dark:text-zinc-400",children:N}),t[15]=N,t[16]=k):k=t[16];let x;t[17]!==k||t[18]!==C||t[19]!==g?(x=(0,e.jsxs)(_,{className:C,children:[g,k]}),t[17]=k,t[18]=C,t[19]=g,t[20]=x):x=t[20];let j;t[21]!==z?(j=z&&(0,e.jsx)("span",{className:"absolute bottom-0.5 right-0.5 size-3.5 rounded-full border-[2.5px] border-white bg-emerald-500 ring-0 dark:border-black"}),t[21]=z,t[22]=j):j=t[22];let m;t[23]!==x||t[24]!==j?(m=(0,e.jsxs)("div",{className:"relative",children:[x,j]}),t[23]=x,t[24]=j,t[25]=m):m=t[25];const f=i?"text-zinc-900 dark:text-white":"text-zinc-700 dark:text-zinc-200";let d;t[26]!==f?(d=$("truncate text-[15px] font-semibold",f),t[26]=f,t[27]=d):d=t[27];const I=a.user?.name;let c;t[28]!==d||t[29]!==I?(c=(0,e.jsx)("span",{className:d,children:I}),t[28]=d,t[29]=I,t[30]=c):c=t[30];const T=i?"text-violet-600 dark:text-violet-400":"text-zinc-400";let U;t[31]!==T?(U=$("ml-2 whitespace-nowrap text-[11px] font-medium",T),t[31]=T,t[32]=U):U=t[32];let q;t[33]!==a.time||t[34]!==U?(q=(0,e.jsx)("span",{className:U,children:a.time}),t[33]=a.time,t[34]=U,t[35]=q):q=t[35];let E;t[36]!==c||t[37]!==q?(E=(0,e.jsxs)("div",{className:"flex items-center justify-between mb-0.5",children:[c,q]}),t[36]=c,t[37]=q,t[38]=E):E=t[38];const D=i?"font-semibold text-zinc-900 dark:text-zinc-100":"text-zinc-500 dark:text-zinc-400 group-hover:text-zinc-600 dark:group-hover:text-zinc-300";let O;t[39]!==D?(O=$("truncate text-[13px] leading-relaxed",D),t[39]=D,t[40]=O):O=t[40];const X=a.currentUserSent?"You: ":"";let Y;t[41]!==a.lastMessage||t[42]!==O||t[43]!==X?(Y=(0,e.jsxs)("p",{className:O,children:[X,a.lastMessage]}),t[41]=a.lastMessage,t[42]=O,t[43]=X,t[44]=Y):Y=t[44];let F;t[45]!==a.unread||t[46]!==i?(F=i&&(0,e.jsx)("span",{className:"flex size-5 shrink-0 items-center justify-center rounded-full bg-violet-600 text-[10px] font-bold text-white shadow-sm shadow-violet-500/30",children:a.unread}),t[45]=a.unread,t[46]=i,t[47]=F):F=t[47];let r;t[48]!==Y||t[49]!==F?(r=(0,e.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[Y,F]}),t[48]=Y,t[49]=F,t[50]=r):r=t[50];let l;t[51]!==E||t[52]!==r?(l=(0,e.jsxs)("div",{className:"min-w-0 flex-1 py-1",children:[E,r]}),t[51]=E,t[52]=r,t[53]=l):l=t[53];let n;return t[54]!==m||t[55]!==w||t[56]!==l||t[57]!==u?(n=(0,e.jsxs)("div",{onClick:w,className:u,children:[m,l]}),t[54]=m,t[55]=w,t[56]=l,t[57]=u,t[58]=n):n=t[58],n},_e=({conversations:s,userResults:t=[],onSelect:a,onStartNew:A,selectedId:v,searchQuery:b,onSearchChange:o,onlineUsers:z=new Set})=>{const h=s.filter(i=>z.has(i.user?.id));return(0,e.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col bg-white dark:bg-black h-full",children:[(0,e.jsxs)("div",{className:"px-5 pt-5 pb-2",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between mb-5",children:[(0,e.jsx)("h2",{className:"text-2xl font-black tracking-tight text-zinc-900 dark:text-white",children:"Chats"}),(0,e.jsx)("button",{className:"rounded-full bg-zinc-100 p-2.5 text-zinc-600 transition-colors hover:bg-zinc-200 dark:bg-zinc-900 dark:text-zinc-400 dark:hover:bg-zinc-800",children:(0,e.jsx)(fe,{size:20})})]}),(0,e.jsxs)("div",{className:"relative group",children:[(0,e.jsx)(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-violet-500 transition-colors",size:18}),(0,e.jsx)("input",{type:"text",value:b,onChange:i=>o(i.target.value),placeholder:"Search Messenger",className:"w-full rounded-full border-none bg-zinc-100 py-2.5 pl-10 pr-4 text-sm font-medium text-zinc-900 placeholder:text-zinc-500 transition-all focus:bg-white focus:ring-2 focus:ring-violet-500/20 focus:shadow-sm dark:bg-zinc-900 dark:text-white dark:focus:bg-black"})]})]}),(0,e.jsx)(we,{className:"flex-1",children:(0,e.jsxs)("div",{className:"flex flex-col pb-4",children:[!b&&h.length>0&&(0,e.jsx)("div",{className:"mb-4 mt-2",children:(0,e.jsxs)("div",{className:"flex gap-4 overflow-x-auto px-5 pb-4 pt-2 no-scrollbar",children:[(0,e.jsxs)("div",{className:"flex flex-col items-center gap-2 min-w-[64px] cursor-pointer group",children:[(0,e.jsxs)("div",{className:"relative flex size-[60px] items-center justify-center rounded-full bg-zinc-50 border border-zinc-200 dark:bg-zinc-900 dark:border-zinc-800 group-hover:bg-zinc-100 dark:group-hover:bg-zinc-800 transition-colors",children:[(0,e.jsx)(Z,{size:24,className:"text-zinc-400"}),(0,e.jsx)("div",{className:"absolute bottom-0 right-0 size-5 bg-white dark:bg-black rounded-full flex items-center justify-center",children:(0,e.jsx)("div",{className:"size-4 bg-zinc-200 dark:bg-zinc-700 rounded-full flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-[10px] text-zinc-500 font-bold",children:"+"})})})]}),(0,e.jsx)("span",{className:"text-[11px] font-medium text-zinc-500",children:"Your Story"})]}),h.map(i=>(0,e.jsxs)("div",{onClick:()=>a(i),className:"flex flex-col items-center gap-2 cursor-pointer group min-w-[64px] transition-transform active:scale-95",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute -inset-[3px] rounded-full bg-gradient-to-tr from-violet-500 via-fuchsia-500 to-orange-500 opacity-90 p-[2px]"}),(0,e.jsx)("div",{className:"relative rounded-full border-[3px] border-white dark:border-black p-[2px] bg-white dark:bg-black",children:(0,e.jsxs)(_,{className:"size-[50px]",children:[(0,e.jsx)(B,{src:i.user?.avatar,className:"object-cover"}),(0,e.jsx)(K,{children:i.user?.name?.[0]})]})}),(0,e.jsx)("span",{className:"absolute bottom-1 right-1 size-3.5 rounded-full border-[2.5px] border-white bg-emerald-500 dark:border-black"})]}),(0,e.jsx)("span",{className:"w-full truncate text-center text-[11px] font-medium text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white transition-colors",children:i.user?.name.split(" ")[0]})]},i.id))]})}),(0,e.jsx)("div",{className:"px-2 space-y-1",children:s.length>0&&s.filter(i=>i.lastMessage!=="No messages yet"||i.id===v||b).map(i=>(0,e.jsx)(Ke,{conv:i,selectedId:v,onSelect:a,onlineUsers:z},i.id))}),t.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"px-6 py-3 mt-2 text-xs font-bold uppercase tracking-wider text-zinc-400",children:"More People"}),(0,e.jsx)("div",{className:"px-2 space-y-1",children:t.map(i=>(0,e.jsxs)("div",{onClick:()=>A(i),className:"flex cursor-pointer items-center gap-4 px-3 py-2 rounded-2xl transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800/50",children:[(0,e.jsxs)(_,{className:"size-10",children:[(0,e.jsx)(B,{src:i.avatar,className:"object-cover"}),(0,e.jsx)(K,{children:i.name?.[0]?.toUpperCase()})]}),(0,e.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,e.jsx)("div",{className:"truncate text-sm font-bold text-zinc-900 dark:text-white",children:i.name}),(0,e.jsxs)("div",{className:"truncate text-xs text-zinc-500",children:["@",i.handle]})]}),(0,e.jsx)("button",{className:"flex size-8 items-center justify-center rounded-full bg-violet-50 text-violet-600 dark:bg-violet-900/20 dark:text-violet-400",children:(0,e.jsx)(Z,{size:16})})]},i.id))})]}),s.length===0&&t.length===0&&b&&(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center px-6",children:[(0,e.jsx)("div",{className:"mb-4 rounded-full bg-zinc-100 p-4 dark:bg-zinc-900",children:(0,e.jsx)(ee,{className:"text-zinc-400",size:24})}),(0,e.jsxs)("p",{className:"text-zinc-500",children:['No results found for "',b,'"']})]})]})})]})},Be=_e,De=({conversation:s,messages:t,onBack:a,onSendMessage:A,onDeleteMessage:v,currentUser:b,onTyping:o,isLoading:z,isTyping:h,isOnline:i})=>{const w=le(),{openLightbox:R}=Ae(),[u,y]=(0,P.useState)(""),[C,M]=(0,P.useState)(!1),[p,g]=(0,P.useState)([]),[N,k]=(0,P.useState)(!1),[x,j]=(0,P.useState)(null),m=(0,P.useRef)(null),f=(0,P.useRef)(null),d=(0,P.useRef)(null),I=Ye(s.user?.lastSeen);(0,P.useEffect)(()=>{f.current&&(f.current.scrollTop=f.current.scrollHeight)},[t,h,p,x]);const c=r=>{const l=r.target.value;y(l),r.target.style.height="auto",r.target.style.height=`${Math.min(r.target.scrollHeight,120)}px`,o&&(o(!0),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{o(!1)},2e3))},T=r=>{y(l=>l+r.emoji)},U=r=>{if(r&&r.preventDefault(),!u.trim()&&p.length===0)return;o&&(d.current&&clearTimeout(d.current),o(!1)),A(s.id,u,p.length>0?"image":"text",p,x?.id),y(""),g([]),j(null);const l=document.querySelector('textarea[name="chat-input"]');l&&(l.style.height="auto")},q=async r=>{if(!r.target.files)return;const l=Array.from(r.target.files);if(l.length!==0){M(!0);try{const n=await Promise.all(l.map(S=>$e(S)));g(S=>[...S,...n])}catch(n){console.error("Upload failed:",n)}finally{M(!1)}}},E=r=>{g(l=>l.filter(n=>n.url!==r))},D=r=>{!r.media||r.media.length===0||R(r.media.map(l=>l.url),0)},O=(0,P.useMemo)(()=>{const r=t.filter(l=>l.sender==="me");return r.length>0?r[r.length-1].id:null},[t]),X=r=>t.find(l=>l.id===r),Y=(r,l)=>r===0?!1:t[r-1].sender===l.sender,F=(r,l)=>r===t.length-1?!1:t[r+1].sender===l.sender;return(0,e.jsxs)("div",{className:"relative flex h-full w-full flex-col overflow-hidden bg-white/50 dark:bg-black/50 md:border-l md:border-zinc-200/50 dark:md:border-zinc-800/50",children:[(0,e.jsxs)("div",{className:"sticky top-0 z-30 flex shrink-0 items-center justify-between border-b border-zinc-100 bg-white/75 px-4 py-3 backdrop-blur-xl dark:border-zinc-800 dark:bg-black/75",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)("button",{onClick:a,className:"mr-1 -ml-2 rounded-full p-2 text-zinc-600 transition-colors hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-zinc-800 md:hidden",children:(0,e.jsx)(ne,{size:24})}),(0,e.jsxs)("div",{className:"relative cursor-pointer",onClick:()=>w(`/u/${s.user.handle}`),children:[(0,e.jsxs)(_,{className:"size-10 border-2 border-white shadow-sm dark:border-zinc-800",children:[(0,e.jsx)(B,{src:s.user.avatar,alt:s.user.name,className:"object-cover"}),(0,e.jsx)(K,{children:s.user.name?.[0]?.toUpperCase()})]}),i&&(0,e.jsx)("span",{className:"absolute bottom-0 right-0 size-3 rounded-full border-2 border-white bg-emerald-500 dark:border-black"})]}),(0,e.jsxs)("div",{className:"flex flex-col cursor-pointer",onClick:()=>w(`/u/${s.user.handle}`),children:[(0,e.jsx)("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:s.user.name}),(0,e.jsx)("span",{className:"text-[11px] font-medium text-zinc-500",children:i?(0,e.jsx)("span",{className:"text-emerald-500",children:"Active now"}):s.user.lastSeen?`Last seen ${I}`:"Offline"})]})]}),(0,e.jsxs)("div",{className:"flex items-center gap-1",children:[(0,e.jsx)("button",{className:"hidden sm:flex rounded-full p-2.5 text-violet-500 hover:bg-violet-50 dark:hover:bg-violet-900/20 transition-colors",children:(0,e.jsx)(ze,{size:20})}),(0,e.jsx)("button",{className:"hidden sm:flex rounded-full p-2.5 text-violet-500 hover:bg-violet-50 dark:hover:bg-violet-900/20 transition-colors",children:(0,e.jsx)(me,{size:20})}),(0,e.jsx)("button",{className:"rounded-full p-2.5 text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:(0,e.jsx)(ke,{size:20})})]})]}),(0,e.jsx)("div",{className:"flex-1 min-h-0 overflow-y-auto px-4 py-4",ref:f,children:(0,e.jsxs)("div",{className:"flex flex-col min-h-full justify-end",children:[t.length<5&&(0,e.jsxs)("div",{className:"py-12 flex flex-col items-center justify-center opacity-80 mb-auto",children:[(0,e.jsxs)(_,{className:"size-24 border-4 border-zinc-100 dark:border-zinc-800 mb-4 bg-zinc-50 dark:bg-zinc-900",children:[(0,e.jsx)(B,{src:s.user.avatar,className:"object-cover"}),(0,e.jsx)(K,{className:"text-4xl",children:s.user.name?.[0]})]}),(0,e.jsx)("h2",{className:"text-xl font-bold dark:text-white",children:s.user.name}),(0,e.jsx)("p",{className:"text-zinc-500 text-sm mb-4",children:"You're friends on AntiGravity"}),(0,e.jsx)(Le,{variant:"outline",size:"sm",className:"rounded-full h-8 text-xs",children:"View Profile"})]}),z&&t.length===0?(0,e.jsx)("div",{className:"flex justify-center p-8",children:(0,e.jsx)(re,{className:"animate-spin text-violet-500",size:32})}):(0,e.jsx)("div",{className:"space-y-[2px]",children:t.map((r,l)=>{const n=r.sender==="me",S=Y(l,r),L=F(l,r);return(0,e.jsx)(G.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},className:$("flex w-full",n?"justify-end":"justify-start",!L&&"mb-4"),children:(0,e.jsxs)("div",{className:$("flex max-w-[75%] md:max-w-[65%] items-end gap-2 group",n?"flex-row-reverse":"flex-row"),children:[!n&&(0,e.jsx)("div",{className:"w-7 shrink-0",children:L?null:(0,e.jsxs)(_,{className:"size-7 border border-zinc-100 shadow-sm dark:border-zinc-800",children:[(0,e.jsx)(B,{src:s.user.avatar}),(0,e.jsx)(K,{children:s.user.name?.[0]})]})}),(0,e.jsxs)(Ue,{children:[(0,e.jsx)(Pe,{children:(0,e.jsxs)("div",{className:$("relative px-4 py-2.5 shadow-sm text-[15px] leading-[1.4]",n?"bg-gradient-to-br from-violet-600 to-indigo-600 text-white":"bg-white text-zinc-900 dark:bg-zinc-800 dark:text-white border border-zinc-200/50 dark:border-zinc-700/50",!L&&!S&&"rounded-[22px]",n&&!L&&S&&"rounded-[22px] rounded-tr-md",n&&L&&!S&&"rounded-[22px] rounded-br-md",n&&L&&S&&"rounded-[22px] rounded-r-md",!n&&!L&&S&&"rounded-[22px] rounded-tl-md",!n&&L&&!S&&"rounded-[22px] rounded-bl-md",!n&&L&&S&&"rounded-[22px] rounded-l-md"),children:[r.replyToId&&(0,e.jsxs)("div",{className:$("mb-1.5 -mx-1 px-3 py-1.5 rounded-xl text-xs border-l-2 cursor-pointer",n?"bg-black/10 border-white/40 text-white/90":"bg-zinc-100 border-zinc-300 text-zinc-600 dark:bg-zinc-700 dark:border-zinc-500 dark:text-zinc-300"),onClick:V=>{V.stopPropagation();const H=document.getElementById(`msg-${r.replyToId}`);H&&H.scrollIntoView({behavior:"smooth",block:"center"})},children:[(0,e.jsxs)("div",{className:"flex items-center gap-1.5 mb-0.5 opacity-75",children:[(0,e.jsx)(Q,{size:10}),(0,e.jsx)("span",{className:"font-bold",children:"Reply"})]}),(0,e.jsx)("div",{className:"truncate opacity-90",children:X(r.replyToId)?.text||"Attachment"})]}),r.media?.length>0&&(0,e.jsx)("div",{className:"grid gap-1 mb-1 overflow-hidden rounded-lg",children:r.media.map((V,H)=>(0,e.jsx)("img",{src:V.url,className:"max-h-64 object-cover w-full rounded-md cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>D(r)},H))}),(0,e.jsx)("div",{className:"whitespace-pre-wrap break-words",children:(0,e.jsx)(qe,{options:{...Ee,className:n?"text-white underline":"text-violet-600 dark:text-violet-400 underline"},children:r.text})}),(0,e.jsxs)("div",{className:$("flex justify-end items-center gap-1 mt-0.5 select-none",n?"text-white/70":"text-zinc-400"),children:[(0,e.jsx)("span",{className:"text-[9px] font-medium",children:r.time}),n&&r.id===O&&(r.isRead?(0,e.jsx)(ve,{size:12,className:"text-white"}):(0,e.jsx)(ce,{size:12,className:"text-white/60"}))]})]})}),(0,e.jsxs)(Me,{className:"w-48",children:[(0,e.jsxs)(J,{onClick:()=>{navigator.clipboard.writeText(r.text)},children:[(0,e.jsx)(xe,{size:14,className:"mr-2"})," Copy"]}),(0,e.jsxs)(J,{onClick:()=>j(r),children:[(0,e.jsx)(Q,{size:14,className:"mr-2"})," Reply"]}),(0,e.jsx)(Te,{}),(0,e.jsxs)(J,{className:"text-red-500",onClick:()=>v&&v(r.id),children:[(0,e.jsx)(de,{size:14,className:"mr-2"})," Delete"]})]})]})]})},r.id)})}),h&&(0,e.jsx)("div",{className:"flex items-center gap-2 mt-2 ml-9",children:(0,e.jsx)("div",{className:"bg-zinc-100 dark:bg-zinc-800 px-4 py-2.5 rounded-[22px] rounded-tl-md",children:(0,e.jsx)(Re,{})})})]})}),(0,e.jsxs)("div",{className:"shrink-0 p-3 md:p-4 bg-white dark:bg-black border-t border-zinc-100 dark:border-zinc-800",children:[(0,e.jsx)(ue,{children:x&&(0,e.jsxs)(G.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"flex items-center justify-between mb-2 px-4 py-2 bg-zinc-50 dark:bg-zinc-900 rounded-xl border border-zinc-100 dark:border-zinc-800",children:[(0,e.jsxs)("div",{className:"text-sm",children:[(0,e.jsxs)("span",{className:"text-xs font-bold text-violet-500 block mb-0.5",children:["Replying to ",x.sender==="me"?"yourself":s.user.name]}),(0,e.jsx)("p",{className:"line-clamp-1 text-zinc-500",children:x.text})]}),(0,e.jsx)("button",{onClick:()=>j(null),children:(0,e.jsx)(W,{size:16,className:"text-zinc-400"})})]})}),p.length>0&&(0,e.jsx)("div",{className:"flex gap-2 mb-2 px-1",children:p.map(r=>(0,e.jsxs)("div",{className:"relative size-16 rounded-lg overflow-hidden border border-zinc-200",children:[(0,e.jsx)("img",{src:r.url,className:"size-full object-cover"}),(0,e.jsx)("button",{onClick:()=>E(r.url),className:"absolute top-0 right-0 bg-black/50 text-white p-0.5",children:(0,e.jsx)(W,{size:12})})]},r.url))}),(0,e.jsxs)("div",{className:"flex items-end gap-2",children:[(0,e.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,e.jsx)("button",{className:"p-2 text-zinc-400 hover:text-violet-600 transition-colors rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-800",onClick:()=>m.current?.click(),children:(0,e.jsx)(he,{size:24})}),(0,e.jsx)("button",{className:"hidden sm:block p-2 text-zinc-400 hover:text-violet-600 transition-colors rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,e.jsx)(Ne,{size:22})})]}),(0,e.jsxs)("form",{className:"flex-1 flex items-center gap-2 bg-zinc-100 dark:bg-zinc-900 rounded-[24px] px-2 py-1.5 transition-all focus-within:ring-2 focus-within:ring-violet-500/20 focus-within:bg-white dark:focus-within:bg-zinc-900 overflow-hidden border border-transparent focus-within:border-violet-200 dark:focus-within:border-violet-900",onSubmit:U,children:[(0,e.jsxs)(Ie,{open:N,onOpenChange:k,children:[(0,e.jsx)(Se,{asChild:!0,children:(0,e.jsx)("button",{type:"button",className:"p-2 text-zinc-400 hover:text-yellow-500 transition-colors",children:(0,e.jsx)(pe,{size:24})})}),(0,e.jsx)(Ce,{className:"w-full p-0 border-none bg-transparent shadow-none",side:"top",align:"start",children:(0,e.jsx)(ye,{onEmojiSelect:T})})]}),(0,e.jsx)("textarea",{name:"chat-input",value:u,onChange:c,onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),U())},placeholder:"Message...",className:"flex-1 bg-transparent border-none outline-none text-[15px] resize-none max-h-32 py-2.5 min-h-[40px] text-zinc-900 dark:text-white placeholder:text-zinc-500",rows:1}),u.trim()||p.length>0?(0,e.jsx)("button",{type:"submit",className:"p-2 mr-1 rounded-full bg-violet-600 text-white hover:bg-violet-700 hover:scale-105 transition-all shadow-sm",children:(0,e.jsx)(be,{size:18,className:"translate-x-0.5 translate-y-0.5"})}):(0,e.jsx)("button",{type:"button",className:"p-2 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,e.jsx)(je,{size:22})})]}),(0,e.jsx)("input",{type:"file",ref:m,onChange:q,className:"hidden",multiple:!0,accept:"image/*"})]})]})]})},Xe=De,He=se(),Ve=()=>{const s=(0,He.c)(29),{id:t,currentUser:a,onlineUsers:A,msgSearchQuery:v,setMsgSearchQuery:b,userSearchResults:o,filteredConversations:z,selectedConversation:h,localMessages:i,isConvLoading:w,isMsgLoading:R,currentIsTyping:u,otherUserIsOnline:y,handleStartConversation:C,handleSelectConversation:M,sendMessage:p,sendTypingStatus:g,navigate:N}=Oe();if(!a){let c;s[0]===Symbol.for("react.memo_cache_sentinel")?(c=(0,e.jsx)("div",{className:"rounded-3xl bg-zinc-50 p-6 dark:bg-zinc-900",children:(0,e.jsx)(oe,{size:48,className:"text-zinc-300 dark:text-zinc-600"})}),s[0]=c):c=s[0];let T;return s[1]===Symbol.for("react.memo_cache_sentinel")?(T=(0,e.jsxs)("div",{className:"flex h-screen flex-col items-center justify-center gap-6 border-zinc-100 bg-white p-8 text-center dark:border-zinc-800 dark:bg-black md:rounded-2xl md:border",children:[c,(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)("h3",{className:"text-2xl font-black tracking-tight dark:text-white",children:"Sign in to message"}),(0,e.jsx)("p",{className:"max-w-xs text-zinc-500 font-medium",children:"Join the conversation. Sign up or log in to start chatting."})]})]}),s[1]=T):T=s[1],T}if(w){let c;return s[2]===Symbol.for("react.memo_cache_sentinel")?(c=(0,e.jsx)("div",{className:"flex h-screen items-center justify-center border-zinc-100 bg-white dark:border-zinc-800 dark:bg-black md:rounded-2xl md:border",children:(0,e.jsx)(re,{className:"animate-spin text-violet-500",size:32})}),s[2]=c):c=s[2],c}const k=`flex ${t?"h-[100dvh]":"h-[calc(100dvh-4rem)]"} overflow-hidden bg-white shadow-2xl shadow-zinc-200/50 dark:border-zinc-800 dark:bg-black dark:shadow-none md:h-[calc(100vh-1.5rem)] md:rounded-3xl md:border md:border-zinc-200/50`,x=`flex-col md:flex md:w-[400px] ${h?"hidden":"flex"} h-full min-h-0 shrink-0 w-full bg-white dark:bg-black border-r border-zinc-100 dark:border-zinc-800 z-10`,j=t??null;let m;s[3]!==z||s[4]!==M||s[5]!==C||s[6]!==v||s[7]!==A||s[8]!==b||s[9]!==j||s[10]!==o?(m=(0,e.jsx)("div",{className:"flex-1 min-h-0 flex flex-col overflow-y-auto",children:(0,e.jsx)(Be,{conversations:z,userResults:o,onSelect:M,onStartNew:C,selectedId:j,searchQuery:v,onSearchChange:b,onlineUsers:A})}),s[3]=z,s[4]=M,s[5]=C,s[6]=v,s[7]=A,s[8]=b,s[9]=j,s[10]=o,s[11]=m):m=s[11];let f;s[12]!==x||s[13]!==m?(f=(0,e.jsx)("div",{className:x,children:m}),s[12]=x,s[13]=m,s[14]=f):f=s[14];let d;s[15]!==u||s[16]!==a||s[17]!==R||s[18]!==i||s[19]!==N||s[20]!==y||s[21]!==h||s[22]!==p||s[23]!==g?(d=h?(0,e.jsx)(Xe,{conversation:h,messages:i,onBack:()=>N("/messages"),onSendMessage:p,currentUser:a,onTyping:c=>g(h.id,c),isLoading:R,isTyping:!!u,isOnline:!!y}):(0,e.jsxs)("div",{className:"hidden flex-1 flex-col items-center justify-center gap-6 text-zinc-500 md:flex bg-zinc-50/30 dark:bg-zinc-900/10",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute -inset-10 rounded-full bg-violet-500/5 blur-3xl dark:bg-violet-500/10"}),(0,e.jsx)("div",{className:"relative rounded-[2.5rem] bg-white p-10 shadow-xl shadow-zinc-200/50 dark:bg-zinc-900/50 dark:shadow-none ring-1 ring-zinc-100 dark:ring-zinc-800",children:(0,e.jsx)(ge,{size:80,className:"text-violet-500 stroke-[1.5]"})})]}),(0,e.jsxs)("div",{className:"text-center max-w-sm px-4 space-y-3",children:[(0,e.jsx)("h3",{className:"text-3xl font-black tracking-tighter text-zinc-900 dark:text-white",children:"Your Messages"}),(0,e.jsx)("p",{className:"text-zinc-500 font-medium text-lg",children:"Send private photos and messages to a friend or group."})]})]}),s[15]=u,s[16]=a,s[17]=R,s[18]=i,s[19]=N,s[20]=y,s[21]=h,s[22]=p,s[23]=g,s[24]=d):d=s[24];let I;return s[25]!==k||s[26]!==f||s[27]!==d?(I=(0,e.jsxs)("div",{className:k,children:[f,d]}),s[25]=k,s[26]=f,s[27]=d,s[28]=I):I=s[28],I},st=Ve;export{st as default};
