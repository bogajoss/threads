import{a as w}from"./rolldown-runtime-BaZ8gS7u.js";import{c as _,s as q}from"./animations-DZuN0xpW.js";import{_ as M}from"./framework-YRQI4BOE.js";import{a as P}from"./query-O_8RQZTX.js";import"./database-Bh-Nv8Zy.js";import{At as T,en as $,lr as B,pr as D,sr as E}from"./ui-libs-dHBs5Tk6.js";import"./media-libs-CqtNZWFg.js";import{$t as o,An as K,Dn as O,Qt as d,Zt as x,an as W,jn as y,sn as X,tn as Z,un as H,vt as J}from"./index-KGIaURZD.js";var t=w(_(),1),e=w(q(),1),V=()=>{const{currentUser:i}=X(),{addToast:c}=W(),C=P(),m=M(),[n,S]=(0,t.useState)(""),[h,A]=(0,t.useState)(null),[U,F]=(0,t.useState)(""),[u,G]=(0,t.useState)(""),[p,f]=(0,t.useState)([]),[r,v]=(0,t.useState)([]),[b,g]=(0,t.useState)(!1),[j,N]=(0,t.useState)(!1),z=(0,t.useRef)(null),R=async a=>{if(G(a),a.length<2){f([]);return}N(!0);try{f((await O(a)).filter(s=>s.id!==i?.id))}catch(s){console.error("Search failed:",s)}finally{N(!1)}},k=a=>{r.find(s=>s.id===a.id)?v(s=>s.filter(l=>l.id!==a.id)):v(s=>[...s,a])},I=a=>{const s=a.target.files?.[0];s&&(A(s),F(URL.createObjectURL(s)))},Q=async()=>{if(!i||!n.trim()||r.length===0){c("Please provide a group name and select at least one member","error");return}g(!0);try{let a=null;h&&(a=(await K(h)).url);const s=r.map(L=>L.id),l=await H(i.id,n,s,a);C.invalidateQueries({queryKey:["conversations",i.id]}),c("Group created successfully!"),m(`/m/${l}`)}catch(a){console.error("Failed to create group:",a),c("Failed to create group","error")}finally{g(!1)}};return(0,e.jsxs)("div",{className:"min-h-screen bg-white pb-20 dark:bg-black md:rounded-xl",children:[(0,e.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-zinc-100 bg-white/90 px-4 py-3 backdrop-blur-md dark:border-zinc-800 dark:bg-black/90",children:[(0,e.jsxs)("div",{className:"flex items-center gap-4",children:[(0,e.jsx)("button",{onClick:()=>m(-1),className:"rounded-full p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,e.jsx)(D,{size:20})}),(0,e.jsx)("h1",{className:"text-xl font-bold",children:"New Group"})]}),(0,e.jsx)(Z,{onClick:Q,disabled:b||!n.trim()||r.length===0,className:"rounded-full px-6 py-2 text-sm font-bold shadow-none",children:b?"Creating...":"Create"})]}),(0,e.jsxs)("div",{className:"mx-auto max-w-2xl px-4 py-6 space-y-6",children:[(0,e.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,e.jsxs)("div",{className:"relative group cursor-pointer",onClick:()=>z.current?.click(),children:[(0,e.jsxs)(x,{className:"h-24 w-24 border-2 border-dashed border-zinc-300 dark:border-zinc-700",children:[(0,e.jsx)(o,{src:U,className:"object-cover"}),(0,e.jsx)(d,{className:"bg-zinc-50 dark:bg-zinc-900",children:(0,e.jsx)(B,{className:"h-8 w-8 text-zinc-400 group-hover:text-violet-500"})})]}),(0,e.jsx)("input",{type:"file",ref:z,className:"hidden",onChange:I,accept:"image/*"})]}),(0,e.jsx)("div",{className:"w-full max-w-md",children:(0,e.jsx)(J,{value:n,onChange:a=>S(a.target.value),placeholder:"Group Name",className:"text-center font-bold text-lg h-12"})})]}),r.length>0&&(0,e.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map(a=>(0,e.jsxs)("div",{className:"flex items-center gap-1 rounded-full bg-violet-100 px-3 py-1 text-sm font-bold text-violet-700 dark:bg-violet-900/30 dark:text-violet-300",children:[(0,e.jsxs)(x,{className:"h-4 w-4",children:[(0,e.jsx)(o,{src:a.avatar}),(0,e.jsx)(d,{children:a.name[0]})]}),(0,e.jsx)("span",{children:a.name}),(0,e.jsx)("button",{onClick:()=>k(a),className:"ml-1 hover:text-red-500",children:(0,e.jsx)(T,{size:14})})]},a.id))}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsx)("h3",{className:"font-bold text-zinc-900 dark:text-white",children:"Add Members"}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)($,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400",size:18}),(0,e.jsx)("input",{type:"text",value:u,onChange:a=>R(a.target.value),placeholder:"Search users...",className:"w-full rounded-xl border border-zinc-200 bg-zinc-50 py-3 pl-10 pr-4 outline-none focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20 dark:border-zinc-800 dark:bg-zinc-900 dark:text-white"})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[j&&(0,e.jsx)("div",{className:"text-center py-4 text-zinc-500",children:"Searching..."}),!j&&u&&p.length===0&&(0,e.jsx)("div",{className:"text-center py-4 text-zinc-500",children:"No users found"}),p.map(a=>{const s=r.some(l=>l.id===a.id);return(0,e.jsxs)("div",{onClick:()=>k(a),className:y("flex items-center justify-between rounded-xl p-3 cursor-pointer transition-colors",s?"bg-zinc-100 dark:bg-zinc-800":"hover:bg-zinc-50 dark:hover:bg-zinc-900"),children:[(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsxs)(x,{children:[(0,e.jsx)(o,{src:a.avatar}),(0,e.jsx)(d,{children:a.name[0]})]}),(0,e.jsxs)("div",{className:"flex flex-col",children:[(0,e.jsx)("span",{className:"font-bold text-zinc-900 dark:text-white",children:a.name}),(0,e.jsxs)("span",{className:"text-sm text-zinc-500",children:["@",a.handle]})]})]}),(0,e.jsx)("div",{className:y("flex h-6 w-6 items-center justify-center rounded-full border-2 transition-all",s?"bg-violet-600 border-violet-600 text-white":"border-zinc-300 dark:border-zinc-600"),children:s&&(0,e.jsx)(E,{size:14,strokeWidth:3})})]},a.id)})]})]})]})]})},ne=V;export{ne as default};
