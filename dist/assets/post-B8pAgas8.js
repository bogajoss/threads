import{a as ot}from"./rolldown-runtime-BaZ8gS7u.js";import{E as wt,b as ie,c as W,d as Ct,n as $t,p as St}from"./framework-CsA6nn9m.js";import{r as _t}from"./query-QyXblnmD.js";import{Bn as Ft,Cn as Pt,Dn as Mt,Fn as Rt,Ft as se,Gt as It,Hn as Et,Ht as At,In as Dt,Jn as Lt,Ln as Tt,Mn as Ut,Nn as Te,Rn as je,Sn as G,Ut as Wt,_n as ct,an as ke,cn as Ot,en as Bt,fn as Vt,hn as qt,jn as Ue,kn as xe,ln as Ht,nn as Gt,on as Jt,sn as Qt,t as dt,un as Kt,yn as Xt,zn as Yt}from"./ui-libs-iJ4uMYcB.js";import{$t as ze,At as We,G as Zt,H as mt,Ht as es,It as ts,J as te,K as ss,Kt as is,Lt as ls,Mt as as,Nt as ns,Pt as rs,Qt as os,Wt as Oe,X as cs,Y as ds,_ as ms,_t as xt,at as Be,b as xs,bt as ut,c as ft,ct as Ve,d as us,dt as qe,en as V,f as fs,ft as He,g as Ne,gt as hs,ht as ps,it as Q,jt as gs,l as vs,lt as Ge,mt as bs,nt as K,ot as Je,pt as js,q as Qe,qt as ks,rn as Ke,rt as X,st as Xe,tn as me,ut as Ye,vt as zs,xt as Ns}from"./index-BpikiQvH.js";import{n as we,t as Ce}from"./linkify-CDs92yJ8.js";import{p as ys,u as Ze}from"./hooks-CmIG0DrV.js";var ws=W(),w=ot(wt(),1),t=ot(Ct(),1),Cs=i=>{const e=(0,ws.c)(37),{isComment:s,liked:r,reposted:l,handleLike:o,handleRepost:c,handleCommentClick:d,handleShareClick:m,isDetail:N}=i;if(N!==void 0&&N){let k;e[0]!==o||e[1]!==r?(k=(0,t.jsx)(q,{icon:xe,label:"Like",type:"like",onClick:o,active:r}),e[0]=o,e[1]=r,e[2]=k):k=e[2];let v;e[3]!==c||e[4]!==s||e[5]!==l?(v=!s&&(0,t.jsx)(q,{icon:ke,label:"Repost",type:"repost",onClick:c,active:l}),e[3]=c,e[4]=s,e[5]=l,e[6]=v):v=e[6];let z;e[7]!==d?(z=(0,t.jsx)(q,{icon:ft,label:"Comment",type:"comment",onClick:d}),e[7]=d,e[8]=z):z=e[8];let a;e[9]!==m||e[10]!==s?(a=!s&&(0,t.jsx)(q,{icon:Ne,label:"Share",type:"share",onClick:m}),e[9]=m,e[10]=s,e[11]=a):a=e[11];let y;return e[12]!==k||e[13]!==v||e[14]!==z||e[15]!==a?(y=(0,t.jsxs)("div",{className:"mt-4 flex w-full items-center justify-around py-1",children:[k,v,z,a]}),e[12]=k,e[13]=v,e[14]=z,e[15]=a,e[16]=y):y=e[16],y}const b=`flex items-center gap-x-1 ${s?"mt-1.5":"mt-3"}`,h=s?16:18;let n;e[17]!==o||e[18]!==r||e[19]!==h?(n=(0,t.jsx)(q,{icon:xe,size:h,type:"like",onClick:o,active:r}),e[17]=o,e[18]=r,e[19]=h,e[20]=n):n=e[20];const f=s?16:18;let x;e[21]!==d||e[22]!==f?(x=(0,t.jsx)(q,{icon:ct,size:f,type:"comment",onClick:d}),e[21]=d,e[22]=f,e[23]=x):x=e[23];const u=s?16:18;let g;e[24]!==c||e[25]!==l||e[26]!==u?(g=(0,t.jsx)(q,{icon:ke,size:u,type:"repost",onClick:c,active:l}),e[24]=c,e[25]=l,e[26]=u,e[27]=g):g=e[27];let j;e[28]!==m||e[29]!==s?(j=!s&&m&&(0,t.jsx)(q,{icon:Ne,type:"share",onClick:m}),e[28]=m,e[29]=s,e[30]=j):j=e[30];let p;return e[31]!==b||e[32]!==n||e[33]!==x||e[34]!==g||e[35]!==j?(p=(0,t.jsxs)("div",{className:b,children:[n,x,g,j]}),e[31]=b,e[32]=n,e[33]=x,e[34]=g,e[35]=j,e[36]=p):p=e[36],p},et=Cs,$s=W(),Ss=i=>{const e=(0,$s.c)(38),{views:s,likes:r,comments:l,isDetail:o,isComment:c,onRepliesClick:d}=i,m=o===void 0?!1:o,N=c===void 0?!1:c;if(m){const g=s||0;let j;e[0]!==g?(j=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:g}),e[0]=g,e[1]=j):j=e[1];let p;e[2]===Symbol.for("react.memo_cache_sentinel")?(p=(0,t.jsx)("span",{className:"opacity-70",children:"Views"}),e[2]=p):p=e[2];let k;e[3]!==j?(k=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[j," ",p]}),e[3]=j,e[4]=k):k=e[4];const v=r||0;let z;e[5]!==v?(z=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:v}),e[5]=v,e[6]=z):z=e[6];let a;e[7]===Symbol.for("react.memo_cache_sentinel")?(a=(0,t.jsx)("span",{className:"opacity-70",children:"Likes"}),e[7]=a):a=e[7];let y;e[8]!==z?(y=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[z," ",a]}),e[8]=z,e[9]=y):y=e[9];const P=l||0;let R;e[10]!==P?(R=(0,t.jsx)("span",{className:"font-bold text-black dark:text-white",children:P}),e[10]=P,e[11]=R):R=e[11];let _;e[12]===Symbol.for("react.memo_cache_sentinel")?(_=(0,t.jsx)("span",{className:"opacity-70",children:"Comments"}),e[12]=_):_=e[12];let C;e[13]!==R?(C=(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[R," ",_]}),e[13]=R,e[14]=C):C=e[14];let M;return e[15]!==y||e[16]!==C||e[17]!==k?(M=(0,t.jsxs)("div",{className:"mt-4 flex items-center gap-x-6 border-b border-zinc-100 pb-4 text-sm text-zinc-500 dark:border-zinc-800 dark:text-zinc-400",children:[k,y,C]}),e[15]=y,e[16]=C,e[17]=k,e[18]=M):M=e[18],M}if(l===0&&r===0&&(s===0||N))return null;const b=`mt-1 flex items-center gap-x-1.5 px-0.5 ${N?"text-[12px]":"text-[14px]"} font-medium text-zinc-500 dark:text-zinc-400`;let h;e[19]!==l||e[20]!==N||e[21]!==r||e[22]!==s?(h=s>0&&!N&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{className:"hover:underline",children:[s," ",s===1?"view":"views"]}),(l>0||r>0)&&(0,t.jsx)("span",{className:"opacity-50",children:"·"})]}),e[19]=l,e[20]=N,e[21]=r,e[22]=s,e[23]=h):h=e[23];let n;e[24]!==l||e[25]!==d?(n=l>0&&(0,t.jsxs)("button",{className:"hover:underline",onClick:g=>{g.stopPropagation(),d&&d(g)},children:[l," ",l===1?"reply":"replies"]}),e[24]=l,e[25]=d,e[26]=n):n=e[26];let f;e[27]!==l||e[28]!==r?(f=l>0&&r>0&&(0,t.jsx)("span",{className:"opacity-50",children:"·"}),e[27]=l,e[28]=r,e[29]=f):f=e[29];let x;e[30]!==r?(x=r>0&&(0,t.jsxs)("button",{className:"hover:underline",children:[r," ",r===1?"like":"likes"]}),e[30]=r,e[31]=x):x=e[31];let u;return e[32]!==b||e[33]!==h||e[34]!==n||e[35]!==f||e[36]!==x?(u=(0,t.jsxs)("div",{className:b,children:[h,n,f,x]}),e[32]=b,e[33]=h,e[34]=n,e[35]=f,e[36]=x,e[37]=u):u=e[37],u},tt=Ss,_s=W(),Fs=i=>{const e=(0,_s.c)(43),{user:s,timeAgo:r,community:l,onUserClick:o,actionsMenu:c,isComment:d,isDetail:m,showAvatar:N}=i,b=N===void 0?!1:N,h=ie();let n;e[0]!==o||e[1]!==s.handle?(n=E=>{E.stopPropagation(),o&&o(s.handle)},e[0]=o,e[1]=s.handle,e[2]=n):n=e[2];const f=n;let x;e[3]!==l||e[4]!==h?(x=E=>{E.stopPropagation(),l&&h(`/c/${l.handle}`)},e[3]=l,e[4]=h,e[5]=x):x=e[5];const u=x,g=`flex items-center justify-between ${m?"pb-4":"min-h-[40px] mb-1"}`;let j;e[6]!==f||e[7]!==d||e[8]!==m||e[9]!==b||e[10]!==s.avatar||e[11]!==s.handle?(j=b&&(0,t.jsx)("button",{className:"shrink-0",onClick:f,children:(0,t.jsxs)(K,{className:`${m?"size-12":d?"size-8":"size-10"} border-0 shadow-sm`,children:[(0,t.jsx)(Q,{src:s.avatar,alt:s.handle,className:"object-cover"}),(0,t.jsx)(X,{className:"text-xs",children:s.handle[0]?.toUpperCase()})]})}),e[6]=f,e[7]=d,e[8]=m,e[9]=b,e[10]=s.avatar,e[11]=s.handle,e[12]=j):j=e[12];const p=`flex shrink-0 items-center gap-1 font-bold text-zinc-900 hover:underline dark:text-white ${m?"text-base sm:text-lg":d?"text-[14px]":"text-[15px]"}`;let k;e[13]!==s.handle?(k=(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:s.handle}),e[13]=s.handle,e[14]=k):k=e[14];let v;e[15]!==d||e[16]!==m||e[17]!==s.verified?(v=s.verified&&(0,t.jsx)(ms,{size:m?16:d?12:14,className:"text-blue-500"}),e[15]=d,e[16]=m,e[17]=s.verified,e[18]=v):v=e[18];let z;e[19]!==f||e[20]!==p||e[21]!==k||e[22]!==v?(z=(0,t.jsxs)("button",{className:p,onClick:f,children:[k,v]}),e[19]=f,e[20]=p,e[21]=k,e[22]=v,e[23]=z):z=e[23];let a;e[24]!==l||e[25]!==u||e[26]!==m?(a=l&&(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-1 text-zinc-500",children:[(0,t.jsx)(vs,{size:m?14:12,className:"shrink-0 text-zinc-400"}),(0,t.jsxs)("button",{className:`flex items-center gap-1 font-bold text-zinc-900 hover:underline dark:text-zinc-100 ${m?"text-[14px] sm:text-[15px]":"text-[13px]"}`,onClick:u,children:[(0,t.jsxs)(K,{className:"size-3.5 shrink-0 border border-zinc-200 bg-zinc-100 dark:border-zinc-700 dark:bg-zinc-800",children:[(0,t.jsx)(Q,{src:l.avatar,alt:l.name,className:"object-cover"}),(0,t.jsx)(X,{className:"text-[6px] font-bold text-zinc-500",children:l.name?.[0]?.toUpperCase()})]}),(0,t.jsx)("span",{className:"max-w-[150px] truncate sm:max-w-none",children:l.name})]})]}),e[24]=l,e[25]=u,e[26]=m,e[27]=a):a=e[27];let y;e[28]!==a||e[29]!==z?(y=(0,t.jsx)("div",{className:"flex min-w-0 flex-1 flex-col",children:(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-x-1.5 leading-none",children:(0,t.jsxs)("div",{className:"flex min-w-0 max-w-full items-center gap-1.5",children:[z,a]})})}),e[28]=a,e[29]=z,e[30]=y):y=e[30];let P;e[31]!==y||e[32]!==j?(P=(0,t.jsxs)("div",{className:"flex items-center gap-x-3 flex-1 min-w-0",children:[j,y]}),e[31]=y,e[32]=j,e[33]=P):P=e[33];const R=r||"Recent";let _;e[34]!==R?(_=(0,t.jsx)("span",{className:"whitespace-nowrap text-[12px] text-zinc-500 dark:text-zinc-400",children:R}),e[34]=R,e[35]=_):_=e[35];let C;e[36]!==c||e[37]!==_?(C=(0,t.jsxs)("div",{className:"-mt-1 flex items-center gap-2",children:[_,c]}),e[36]=c,e[37]=_,e[38]=C):C=e[38];let M;return e[39]!==P||e[40]!==C||e[41]!==g?(M=(0,t.jsxs)("div",{className:g,children:[P,C]}),e[39]=P,e[40]=C,e[41]=g,e[42]=M):M=e[42],M},st=Fs,Ps=W(),Ms=i=>{const e=(0,Ps.c)(45),{content:s,isDetail:r,isEditing:l,editedContent:o,setEditedContent:c,onCancelEdit:d,onSaveEdit:m,isUpdating:N,contentClass:b}=i,h=ie(),[n,f]=(0,w.useState)(!1),x=typeof s=="string"&&Ke(s);if(l&&c){let C;e[0]!==c?(C=U=>c(U.target.value),e[0]=c,e[1]=C):C=e[1];const M=`min-h-[100px] w-full rounded-xl border-zinc-200 bg-zinc-50 focus:ring-violet-500 dark:border-zinc-800 dark:bg-zinc-900 ${Ke(o||"")?"font-bangla text-lg":"font-english"}`;let E;e[2]!==o||e[3]!==C||e[4]!==M?(E=(0,t.jsx)(xs,{value:o,onChange:C,className:M,autoFocus:!0}),e[2]=o,e[3]=C,e[4]=M,e[5]=E):E=e[5];let L;e[6]!==d?(L=(0,t.jsx)("button",{onClick:d,className:"px-4 py-1.5 text-sm font-bold text-zinc-500 transition-colors hover:text-zinc-700 dark:hover:text-zinc-300",children:"Cancel"}),e[6]=d,e[7]=L):L=e[7];let D;e[8]!==s||e[9]!==o||e[10]!==N?(D=N||!o?.trim()||o===s,e[8]=s,e[9]=o,e[10]=N,e[11]=D):D=e[11];const $=N?"Saving...":"Save";let S;e[12]!==m||e[13]!==D||e[14]!==$?(S=(0,t.jsx)("button",{onClick:m,disabled:D,className:"rounded-full bg-violet-600 px-4 py-1.5 text-sm font-bold text-white transition-all hover:bg-violet-700 disabled:opacity-50 active:scale-95",children:$}),e[12]=m,e[13]=D,e[14]=$,e[15]=S):S=e[15];let I;e[16]!==L||e[17]!==S?(I=(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[L,S]}),e[16]=L,e[17]=S,e[18]=I):I=e[18];let A;return e[19]!==E||e[20]!==I?(A=(0,t.jsxs)("div",{className:"mt-2 flex flex-col gap-2",onClick:Rs,children:[E,I]}),e[19]=E,e[20]=I,e[21]=A):A=e[21],A}const u=!r&&s.length>280;let g;e[22]!==s||e[23]!==n||e[24]!==u?(g=u&&!n?s.substring(0,280):s,e[22]=s,e[23]=n,e[24]=u,e[25]=g):g=e[25];const j=g,p=r?"text-lg leading-relaxed sm:text-xl sm:leading-8":"text-[15px] leading-relaxed",k=x?"font-bangla text-[1.15em]":"font-english";let v;e[26]!==b||e[27]!==p||e[28]!==k?(v=V("whitespace-pre-line break-words",p,k,b),e[26]=b,e[27]=p,e[28]=k,e[29]=v):v=e[29];let z;e[30]!==h?(z={...Ce,render:C=>{const{attributes:M,content:E}=C,{href:L,...D}=M,$=window.location.origin;if(L.includes("internal.tag/")){const I=decodeURIComponent(L.split("internal.tag/")[1]);return(0,t.jsxs)("span",{...D,className:V("cursor-pointer font-bold text-rose-600 hover:underline dark:text-rose-400 font-bangla",D.className),onClick:A=>{A.stopPropagation(),h(`/tags/${I}`)},children:["#",I]},E)}let S=null;return L.startsWith("/")?S=L:L.startsWith($)&&(S=L.replace($,"")),S?(0,t.jsx)("span",{...D,className:V("cursor-pointer font-medium text-violet-600 hover:underline dark:text-violet-400",D.className),onClick:I=>{I.stopPropagation(),h(S)},children:E},E):(0,t.jsx)("a",{href:L,...D,target:"_blank",rel:"noopener noreferrer",className:V("text-violet-600 hover:underline dark:text-violet-400",D.className),onClick:Is,children:E},E)}},e[30]=h,e[31]=z):z=e[31];let a;e[32]!==j?(a=typeof j=="string"?j.replace(/#([\u0980-\u09FF\w]+)/g,"https://internal.tag/$1"):j,e[32]=j,e[33]=a):a=e[33];let y;e[34]!==z||e[35]!==a?(y=(0,t.jsx)(we,{options:z,children:a}),e[34]=z,e[35]=a,e[36]=y):y=e[36];const P=u&&!n&&"...";let R;e[37]!==n||e[38]!==u?(R=u&&(0,t.jsx)("button",{onClick:C=>{C.stopPropagation(),f(!n)},className:"ml-1 cursor-pointer font-bold text-rose-600 hover:underline dark:text-rose-400",children:n?"Show less":"See more"}),e[37]=n,e[38]=u,e[39]=R):R=e[39];let _;return e[40]!==v||e[41]!==y||e[42]!==P||e[43]!==R?(_=(0,t.jsxs)("div",{className:v,children:[y,P,R]}),e[40]=v,e[41]=y,e[42]=P,e[43]=R,e[44]=_):_=e[44],_},it=Ms;function Rs(i){return i.stopPropagation()}function Is(i){return i.stopPropagation()}var Es=W(),As=i=>{const e=(0,Es.c)(28),{media:s,isEditing:r,editedMedia:l,setEditedMedia:o,newFiles:c,setNewFiles:d}=i;let m;e[0]!==l?(m=l===void 0?[]:l,e[0]=l,e[1]=m):m=e[1];const N=m;let b;e[2]!==c?(b=c===void 0?[]:c,e[2]=c,e[3]=b):b=e[3];const h=b,n=(0,w.useRef)(null);if(r&&o&&d){let x;if(e[4]!==N||e[5]!==o){let v;e[7]!==o?(v=(z,a)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[z.type==="video"?(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(Te,{size:24,className:"text-zinc-400"})}):(0,t.jsx)("img",{src:z.url||z.src,className:"size-full object-cover",alt:""}),(0,t.jsx)("button",{onClick:y=>{y.stopPropagation(),o(P=>P.filter((R,_)=>_!==a))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(se,{size:16})})]},`old-${a}`),e[7]=o,e[8]=v):v=e[8],x=N.map(v),e[4]=N,e[5]=o,e[6]=x}else x=e[6];let u;if(e[9]!==h||e[10]!==d){let v;e[12]!==d?(v=(z,a)=>(0,t.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-xl border-2 border-dashed border-violet-500 bg-violet-50/10",children:[z.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(z),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center",children:(0,t.jsx)(Te,{size:24,className:"animate-pulse text-violet-500"})}),(0,t.jsx)("button",{onClick:y=>{y.stopPropagation(),d(P=>P.filter((R,_)=>_!==a))},className:"absolute right-1.5 top-1.5 flex size-7 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black",children:(0,t.jsx)(se,{size:16})}),(0,t.jsx)("div",{className:"absolute bottom-1 left-1 rounded bg-violet-600 px-1 text-[8px] font-bold text-white",children:"NEW"})]},`new-${a}`),e[12]=d,e[13]=v):v=e[13],u=h.map(v),e[9]=h,e[10]=d,e[11]=u}else u=e[11];let g;e[14]!==N.length||e[15]!==h.length?(g=N.length+h.length<4&&(0,t.jsxs)("button",{onClick:v=>{v.stopPropagation(),n.current?.click()},className:"relative flex aspect-square flex-col items-center justify-center gap-1 rounded-xl border-2 border-dashed border-zinc-200 text-zinc-400 transition-all hover:border-violet-500 hover:bg-violet-50/5 hover:text-violet-500 dark:border-zinc-800",children:[(0,t.jsx)(Jt,{size:20}),(0,t.jsx)("span",{className:"text-[10px] font-bold",children:"Add Media"})]}),e[14]=N.length,e[15]=h.length,e[16]=g):g=e[16];let j;e[17]!==x||e[18]!==u||e[19]!==g?(j=(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:[x,u,g]}),e[17]=x,e[18]=u,e[19]=g,e[20]=j):j=e[20];let p;e[21]!==d?(p=(0,t.jsx)("input",{type:"file",ref:n,onChange:v=>{if(v.target.files){const z=Array.from(v.target.files);d(a=>[...a,...z])}},multiple:!0,className:"hidden",accept:"image/*,video/*"}),e[21]=d,e[22]=p):p=e[22];let k;return e[23]!==j||e[24]!==p?(k=(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[j,p]}),e[23]=j,e[24]=p,e[25]=k):k=e[25],k}if(!s||s.length===0)return null;let f;return e[26]!==s?(f=(0,t.jsx)(ci,{items:s}),e[26]=s,e[27]=f):f=e[27],f},lt=As,Ds=W(),Ls=i=>{const e=(0,Ds.c)(35),{icon:s,count:r,label:l,onClick:o,active:c,activeColorClass:d,size:m,type:N}=i,b=m===void 0?18:m,h=N===void 0?"default":N;let n,f,x,u,g;if(e[0]!==c||e[1]!==d||e[2]!==r||e[3]!==l||e[4]!==o||e[5]!==h){const R={like:{hoverBg:"group-hover:bg-rose-500/10",hoverText:"group-hover:text-rose-500",activeText:"text-rose-500",activeFill:"fill-rose-500"},repost:{hoverBg:"group-hover:bg-emerald-500/10",hoverText:"group-hover:text-emerald-500",activeText:"text-emerald-500",activeFill:"fill-emerald-500"},comment:{hoverBg:"group-hover:bg-sky-500/10",hoverText:"group-hover:text-sky-500",activeText:"text-sky-500",activeFill:"fill-sky-500"},share:{hoverBg:"group-hover:bg-violet-500/10",hoverText:"group-hover:text-violet-500",activeText:"text-violet-500",activeFill:"fill-violet-500"},default:{hoverBg:"group-hover:bg-zinc-500/10",hoverText:"group-hover:text-zinc-500",activeText:"text-zinc-900 dark:text-white",activeFill:"fill-current"}};n=R[h]||R.default;const _=d||n.activeText;e[11]!==o?(x=C=>{C.stopPropagation(),o&&o(C)},e[11]=o,e[12]=x):x=e[12],u=`${l} ${r!==void 0?`(${r})`:""}`,g=V("group -ml-2 flex items-center gap-x-0.5 rounded-xl px-2 py-1.5 text-[12px] font-bold transition-all sm:gap-x-1 sm:text-[13px]",c?_:"text-zinc-500",!c&&n.hoverText),f=V("rounded-full p-2 transition-all duration-200",!c&&n.hoverBg),e[0]=c,e[1]=d,e[2]=r,e[3]=l,e[4]=o,e[5]=h,e[6]=n,e[7]=f,e[8]=x,e[9]=u,e[10]=g}else n=e[6],f=e[7],x=e[8],u=e[9],g=e[10];const j=c?2.5:2,p=c&&n.activeFill;let k;e[13]!==p?(k=V("transition-colors duration-200",p),e[13]=p,e[14]=k):k=e[14];let v;e[15]!==s||e[16]!==b||e[17]!==j||e[18]!==k?(v=(0,t.jsx)(s,{size:b,strokeWidth:j,className:k}),e[15]=s,e[16]=b,e[17]=j,e[18]=k,e[19]=v):v=e[19];let z;e[20]!==v||e[21]!==f?(z=(0,t.jsx)("div",{className:f,children:v}),e[20]=v,e[21]=f,e[22]=z):z=e[22];let a;e[23]!==l?(a=l&&(0,t.jsx)("span",{className:"hidden xs:inline",children:l}),e[23]=l,e[24]=a):a=e[24];let y;e[25]!==c||e[26]!==r?(y=r!=null&&(0,t.jsx)("span",{className:V("transition-all",c?"font-black":"font-bold"),children:r||0}),e[25]=c,e[26]=r,e[27]=y):y=e[27];let P;return e[28]!==z||e[29]!==a||e[30]!==y||e[31]!==x||e[32]!==u||e[33]!==g?(P=(0,t.jsxs)("button",{onClick:x,"aria-label":u,className:g,children:[z,a,y]}),e[28]=z,e[29]=a,e[30]=y,e[31]=x,e[32]=u,e[33]=g,e[34]=P):P=e[34],P},q=Ls,Ts=W(),Us=i=>{const e=(0,Ts.c)(18),{poll:s,onVote:r}=i,l=s.options.reduce(Ws,0),[o,c]=(0,w.useState)(null);let d;e[0]!==r||e[1]!==o?(d=x=>{o||(c(x),r&&r(x))},e[0]=r,e[1]=o,e[2]=d):d=e[2];const m=d;let N;if(e[3]!==m||e[4]!==s.options||e[5]!==l||e[6]!==o){let x;e[8]!==m||e[9]!==l||e[10]!==o?(x=(u,g)=>{const j=l>0?Math.round((u.votes+(o===u.id?1:0))/(l+(o?1:0))*100):0,p=o===u.id;return(0,t.jsxs)("div",{onClick:()=>m(u.id),className:`relative h-10 w-full overflow-hidden rounded-xl border cursor-pointer ${p?"border-violet-500 dark:border-violet-500":"border-zinc-200 dark:border-zinc-700"}`,children:[o&&(0,t.jsx)("div",{className:"absolute left-0 top-0 h-full bg-zinc-200 transition-all duration-500 dark:bg-zinc-800",style:{width:`${j}%`}}),(0,t.jsxs)("div",{className:"absolute inset-0 z-10 flex items-center justify-between px-4",children:[(0,t.jsxs)("span",{className:`text-sm font-medium ${p?"font-bold text-violet-600":"text-zinc-700 dark:text-zinc-200"}`,children:[u.text," ",p&&(0,t.jsx)(Et,{size:14,className:"mb-0.5 inline ml-1"})]}),o&&(0,t.jsxs)("span",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:[j,"%"]})]})]},u.id||g)},e[8]=m,e[9]=l,e[10]=o,e[11]=x):x=e[11],N=s.options.map(x),e[3]=m,e[4]=s.options,e[5]=l,e[6]=o,e[7]=N}else N=e[7];const b=l+(o?1:0),h=o?"6 days left":"Click to vote";let n;e[12]!==b||e[13]!==h?(n=(0,t.jsxs)("div",{className:"pl-1 text-xs text-zinc-500 dark:text-zinc-400",children:[b," votes •"," ",h]}),e[12]=b,e[13]=h,e[14]=n):n=e[14];let f;return e[15]!==N||e[16]!==n?(f=(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[N,n]}),e[15]=N,e[16]=n,e[17]=f):f=e[17],f},at=Us;function Ws(i,e){return i+e.votes}var Os=W(),Bs=i=>{const e=(0,Os.c)(30),{user:s,time:r,content:l}=i,o=ie();let c;e[0]!==s.avatar||e[1]!==s.handle?(c=(0,t.jsx)(Q,{src:s.avatar,alt:s.handle}),e[0]=s.avatar,e[1]=s.handle,e[2]=c):c=e[2];let d;e[3]!==s.handle[0]?(d=s.handle[0]?.toUpperCase(),e[3]=s.handle[0],e[4]=d):d=e[4];let m;e[5]!==d?(m=(0,t.jsx)(X,{children:d}),e[5]=d,e[6]=m):m=e[6];let N;e[7]!==c||e[8]!==m?(N=(0,t.jsxs)(K,{className:"size-6",children:[c,m]}),e[7]=c,e[8]=m,e[9]=N):N=e[9];let b;e[10]!==s.handle?(b=(0,t.jsx)("span",{className:"text-sm font-semibold",children:s.handle}),e[10]=s.handle,e[11]=b):b=e[11];let h;e[12]!==N||e[13]!==b?(h=(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[N,b]}),e[12]=N,e[13]=b,e[14]=h):h=e[14];let n;e[15]!==r?(n=(0,t.jsx)("span",{className:"text-xs text-zinc-500 sm:text-sm",children:r}),e[15]=r,e[16]=n):n=e[16];let f;e[17]!==h||e[18]!==n?(f=(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between gap-x-2",children:[h,n]}),e[17]=h,e[18]=n,e[19]=f):f=e[19];let x;e[20]!==o?(x={...Ce,render:p=>{const{attributes:k,content:v}=p,{href:z,...a}=k,y=window.location.origin;let P=null;return z.startsWith("/")?P=z:z.startsWith(y)&&(P=z.replace(y,"")),P?(0,t.jsx)("span",{...a,className:V("cursor-pointer font-medium text-violet-600 hover:underline dark:text-violet-400",a.className),onClick:R=>{R.stopPropagation(),o(P)},children:v},v):(0,t.jsx)("a",{href:z,...a,target:"_blank",rel:"noopener noreferrer",className:V("text-violet-600 hover:underline dark:text-violet-400",a.className),onClick:Vs,children:v},v)}},e[20]=o,e[21]=x):x=e[21];let u;e[22]!==l?(u=(0,t.jsx)("p",{className:"whitespace-pre-line text-sm text-zinc-800 dark:text-zinc-300",children:l}),e[22]=l,e[23]=u):u=e[23];let g;e[24]!==u||e[25]!==x?(g=(0,t.jsx)(we,{options:x,children:u}),e[24]=u,e[25]=x,e[26]=g):g=e[26];let j;return e[27]!==g||e[28]!==f?(j=(0,t.jsxs)("div",{className:"p-4",children:[f,g]}),e[27]=g,e[28]=f,e[29]=j):j=e[29],j},nt=Bs;function Vs(i){return i.stopPropagation()}var qs=W(),Hs=i=>{const e=(0,qs.c)(49),{currentUser:s,newComment:r,setNewComment:l,handleSubmitComment:o,loading:c,selectedFiles:d,setSelectedFiles:m,isUploading:N}=i;let b;e[0]!==d?(b=d===void 0?[]:d,e[0]=d,e[1]=b):b=e[1];const h=b,n=(0,w.useRef)(null);let f;e[2]!==m?(f=A=>{if(A.target.files){const U=Array.from(A.target.files);m&&m(B=>[...B,...U])}},e[2]=m,e[3]=f):f=e[3];const x=f;let u;e[4]!==m?(u=A=>{m&&m(U=>U.filter((B,Y)=>Y!==A))},e[4]=m,e[5]=u):u=e[5];const g=u;let j;e[6]!==m?(j=A=>{const U=A.clipboardData.files;if(U&&U.length>0){const B=Array.from(U).filter(Gs);B.length>0&&(A.preventDefault(),m&&m(Y=>[...Y,...B]))}},e[6]=m,e[7]=j):j=e[7];const p=j;if(!s){let A;return e[8]===Symbol.for("react.memo_cache_sentinel")?(A=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-6 text-center dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"Please login to join the conversation."})}),e[8]=A):A=e[8],A}let k;e[9]!==s.avatar||e[10]!==s.handle?(k=(0,t.jsx)(Q,{src:s.avatar,alt:s.handle,className:"object-cover"}),e[9]=s.avatar,e[10]=s.handle,e[11]=k):k=e[11];let v;e[12]!==s.handle?.[0]?(v=s.handle?.[0]?.toUpperCase(),e[12]=s.handle?.[0],e[13]=v):v=e[13];let z;e[14]!==v?(z=(0,t.jsx)(X,{children:v}),e[14]=v,e[15]=z):z=e[15];let a;e[16]!==k||e[17]!==z?(a=(0,t.jsxs)(K,{className:"size-9 border border-zinc-200 dark:border-zinc-700",children:[k,z]}),e[16]=k,e[17]=z,e[18]=a):a=e[18];let y;e[19]!==l?(y=A=>l(A.target.value),e[19]=l,e[20]=y):y=e[20];let P;e[21]!==p||e[22]!==r||e[23]!==y?(P=(0,t.jsx)("textarea",{id:"comment-input",className:"min-h-[60px] w-full resize-none bg-transparent text-base outline-none placeholder:text-zinc-500 dark:text-white",placeholder:"Post your reply...",value:r,onChange:y,onPaste:p}),e[21]=p,e[22]=r,e[23]=y,e[24]=P):P=e[24];let R;e[25]!==g||e[26]!==h?(R=h.length>0&&(0,t.jsx)("div",{className:"mt-2 mb-2 flex flex-wrap gap-2",children:h.map((A,U)=>(0,t.jsxs)("div",{className:"relative size-20 overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800",children:[A.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(A),className:"size-full object-cover",alt:""}):(0,t.jsx)("div",{className:"flex size-full items-center justify-center bg-zinc-100 dark:bg-zinc-800",children:(0,t.jsx)(Kt,{size:20,className:"text-zinc-500"})}),(0,t.jsx)("button",{onClick:()=>g(U),className:"absolute right-1 top-1 rounded-full bg-black/60 p-1 text-white transition-colors hover:bg-black",children:(0,t.jsx)(se,{size:12})})]},U))}),e[25]=g,e[26]=h,e[27]=R):R=e[27];let _;e[28]===Symbol.for("react.memo_cache_sentinel")?(_=()=>n.current?.click(),e[28]=_):_=e[28];let C;e[29]===Symbol.for("react.memo_cache_sentinel")?(C=(0,t.jsx)("button",{type:"button",onClick:_,className:"rounded-full p-2 text-violet-600 transition-colors hover:bg-violet-50 dark:hover:bg-zinc-800",title:"Attach media",children:(0,t.jsx)(Mt,{size:20})}),e[29]=C):C=e[29];let M;e[30]!==x?(M=(0,t.jsxs)("div",{className:"flex gap-1 text-violet-600",children:[C,(0,t.jsx)("input",{type:"file",ref:n,onChange:x,multiple:!0,className:"hidden",accept:"image/*,video/*,application/pdf"})]}),e[30]=x,e[31]=M):M=e[31];const E=c||N;let L;e[32]!==r||e[33]!==h.length?(L=!r.trim()&&h.length===0,e[32]=r,e[33]=h.length,e[34]=L):L=e[34];let D;e[35]!==o||e[36]!==E||e[37]!==L?(D=(0,t.jsx)(bs,{className:"min-w-[70px] !w-auto px-5 py-1.5 text-sm font-bold",onClick:o,loading:E,disabled:L,children:"Reply"}),e[35]=o,e[36]=E,e[37]=L,e[38]=D):D=e[38];let $;e[39]!==M||e[40]!==D?($=(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between border-t border-zinc-100 pt-3 dark:border-zinc-800",children:[M,D]}),e[39]=M,e[40]=D,e[41]=$):$=e[41];let S;e[42]!==P||e[43]!==R||e[44]!==$?(S=(0,t.jsxs)("div",{className:"flex-1",children:[P,R,$]}),e[42]=P,e[43]=R,e[44]=$,e[45]=S):S=e[45];let I;return e[46]!==S||e[47]!==a?(I=(0,t.jsx)("div",{className:"border-y border-zinc-100 bg-zinc-50/30 p-4 dark:border-zinc-800 dark:bg-zinc-900/10",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[a,S]})}),e[46]=S,e[47]=a,e[48]=I):I=e[48],I},ht=w.memo(Hs);function Gs(i){return i.type.startsWith("image/")}var Js=W(),Qs=i=>{const e=(0,Js.c)(30),{url:s}=i;let r,l;e[0]!==s?(r=["link-preview",s],l=()=>Ns(s),e[0]=s,e[1]=r,e[2]=l):(r=e[1],l=e[2]);const o=!!s;let c;e[3]!==r||e[4]!==l||e[5]!==o?(c={queryKey:r,queryFn:l,staleTime:864e5,enabled:o},e[3]=r,e[4]=l,e[5]=o,e[6]=c):c=e[6];const{data:d,isLoading:m,isError:N}=_t(c);if(m){let k;return e[7]===Symbol.for("react.memo_cache_sentinel")?(k=(0,t.jsx)("div",{className:"mt-3 flex h-24 animate-pulse items-center justify-center overflow-hidden rounded-2xl border border-zinc-100 bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-900/50",children:(0,t.jsx)(Ue,{className:"animate-spin text-zinc-300 dark:text-zinc-700",size:24})}),e[7]=k):k=e[7],k}if(N||!d||!d.title&&!d.image)return null;let b;e[8]!==d.image||e[9]!==d.title?(b=d.image&&(0,t.jsx)("div",{className:"aspect-[1.91/1] w-full overflow-hidden border-b border-zinc-100 bg-zinc-100 dark:border-zinc-800 dark:bg-zinc-900",children:(0,t.jsx)("img",{src:d.image,alt:d.title??void 0,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-[1.02]",onError:Xs})}),e[8]=d.image,e[9]=d.title,e[10]=b):b=e[10];let h;e[11]===Symbol.for("react.memo_cache_sentinel")?(h=(0,t.jsx)(Ue,{size:12}),e[11]=h):h=e[11];let n;e[12]!==d.siteName?(n=(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs font-bold uppercase tracking-wider text-zinc-600",children:[h,(0,t.jsx)("span",{children:d.siteName})]}),e[12]=d.siteName,e[13]=n):n=e[13];let f;e[14]!==d.title?(f=(0,t.jsx)("div",{className:"line-clamp-2 text-[15px] font-bold leading-snug transition-colors group-hover:text-violet-700 dark:text-white",children:d.title}),e[14]=d.title,e[15]=f):f=e[15];let x;e[16]!==d.description?(x=d.description&&(0,t.jsx)("p",{className:"line-clamp-2 text-xs leading-relaxed text-zinc-600 dark:text-zinc-400",children:d.description}),e[16]=d.description,e[17]=x):x=e[17];let u;e[18]===Symbol.for("react.memo_cache_sentinel")?(u=(0,t.jsx)(Tt,{size:10}),e[18]=u):u=e[18];let g;e[19]!==s?(g=(0,t.jsxs)("div",{className:"flex items-center gap-1 pt-1 text-[11px] font-medium text-zinc-500",children:[u,(0,t.jsx)("span",{className:"truncate",children:s})]}),e[19]=s,e[20]=g):g=e[20];let j;e[21]!==g||e[22]!==n||e[23]!==f||e[24]!==x?(j=(0,t.jsxs)("div",{className:"space-y-1 p-3.5",children:[n,f,x,g]}),e[21]=g,e[22]=n,e[23]=f,e[24]=x,e[25]=j):j=e[25];let p;return e[26]!==j||e[27]!==b||e[28]!==s?(p=(0,t.jsxs)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"group mt-3 flex flex-col overflow-hidden rounded-2xl border border-zinc-100 bg-white shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-900",onClick:Ks,children:[b,j]}),e[26]=j,e[27]=b,e[28]=s,e[29]=p):p=e[29],p},rt=Qs;function Ks(i){return i.stopPropagation()}function Xs(i){return i.target.style.display="none"}var Ys=W(),Zs=i=>{const e=(0,Ys.c)(17),{src:s,poster:r}=i,l=(0,w.useRef)(null),{reportVisibility:o,unregister:c}=js(),{dataSaver:d}=zs(),m=(0,w.useId)();let N;e[0]===Symbol.for("react.memo_cache_sentinel")?(N={play:()=>{const k=l.current?.plyr;k&&(k.muted=!0,k.play().catch(ti))},pause:()=>{l.current?.plyr?.pause()}},e[0]=N):N=e[0];const b=N;let h,n;e[1]!==d||e[2]!==m||e[3]!==o||e[4]!==c?(h=()=>{const k=new IntersectionObserver(z=>{const[a]=z;o(m,d?0:a.intersectionRatio,b)},{threshold:[0,.6]}),v=l.current?.elements?.container;return v&&k.observe(v),()=>{c(m),v&&k.unobserve(v)}},n=[m,o,c,b,d],e[1]=d,e[2]=m,e[3]=o,e[4]=c,e[5]=h,e[6]=n):(h=e[5],n=e[6]),(0,w.useEffect)(h,n);let f;e[7]!==s?(f=[{src:s,type:"video/mp4"}],e[7]=s,e[8]=f):f=e[8];let x;e[9]!==r||e[10]!==f?(x={type:"video",sources:f,poster:r},e[9]=r,e[10]=f,e[11]=x):x=e[11];let u;e[12]===Symbol.for("react.memo_cache_sentinel")?(u={controls:["play-large","play","progress","current-time","mute","volume","fullscreen"],settings:["quality","speed"],ratio:"16:9",clickToPlay:!0,hideControls:!0,resetOnEnd:!0},e[12]=u):u=e[12];let g;e[13]!==x?(g={source:x,options:u},e[13]=x,e[14]=g):g=e[14];const j=g;let p;return e[15]!==j?(p=(0,t.jsx)("div",{className:"w-full bg-black",onClick:si,children:(0,t.jsx)(dt,{ref:l,...j})}),e[15]=j,e[16]=p):p=e[16],p},ei=Zs;function ti(){}function si(i){return i.stopPropagation()}var ii=W(),li=i=>{const e=(0,ii.c)(15),{file:s}=i;let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=(0,t.jsx)("div",{className:"flex size-10 items-center justify-center rounded-xl bg-violet-100 text-violet-600 dark:bg-violet-900/30",children:(0,t.jsx)(Rt,{size:20})}),e[0]=r):r=e[0];let l;e[1]!==s.name?(l=(0,t.jsx)("div",{className:"truncate text-sm font-bold dark:text-white",children:s.name}),e[1]=s.name,e[2]=l):l=e[2];let o;e[3]!==s.size?(o=s.size!==void 0&&(0,t.jsxs)("div",{className:"text-xs uppercase text-zinc-500",children:[(s.size/1024/1024).toFixed(2)," MB"]}),e[3]=s.size,e[4]=o):o=e[4];let c;e[5]!==l||e[6]!==o?(c=(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[l,o]}),e[5]=l,e[6]=o,e[7]=c):c=e[7];let d;e[8]===Symbol.for("react.memo_cache_sentinel")?(d=(0,t.jsx)(Yt,{size:18}),e[8]=d):d=e[8];let m;e[9]!==s.name||e[10]!==s.url?(m=(0,t.jsx)("a",{href:s.url,download:s.name,className:"p-2 text-zinc-400 transition-colors hover:text-violet-600",onClick:ni,children:d}),e[9]=s.name,e[10]=s.url,e[11]=m):m=e[11];let N;return e[12]!==c||e[13]!==m?(N=(0,t.jsxs)("div",{className:"group mt-3 flex items-center gap-3 rounded-2xl border border-zinc-100 bg-zinc-50/50 p-3 transition-colors hover:border-violet-500/30 dark:border-zinc-800 dark:bg-zinc-900/10",children:[r,c,m]}),e[12]=c,e[13]=m,e[14]=N):N=e[14],N},ai=li;function ni(i){return i.stopPropagation()}var ri=W(),oi=i=>{const e=(0,ri.c)(3),{items:s}=i,r=s===void 0?[]:s,{openLightbox:l}=ps();if(!r||Array.isArray(r)&&r.length===0)return null;const o=Array.isArray(r)?r:[r],c=o.filter(di),d=o.filter(mi),m=f=>{const x=c.filter(xi).map(ui),u=c[f];l(x,x.indexOf(u.url||u.src))},N="mt-2 space-y-2",b=c.length>0&&(0,t.jsx)("div",{className:`grid gap-2 overflow-hidden rounded-2xl border border-zinc-100 dark:border-zinc-800 ${c.length===1?"grid-cols-1":c.length===2?"aspect-[16/9] grid-cols-2":(c.length===3,"aspect-[16/9] grid-cols-2 grid-rows-2")}`,children:c.map((f,x)=>(0,t.jsx)("div",{className:`relative cursor-pointer overflow-hidden bg-zinc-100 dark:bg-zinc-900 ${c.length===3&&x===0?"row-span-2":""}
                                `,onClick:u=>{f.type==="image"&&(u.stopPropagation(),m(x))},children:f.type==="video"?(0,t.jsx)(ei,{src:f.url,poster:f.poster||void 0}):(0,t.jsx)("img",{src:f.url||f.src,className:"size-full object-cover transition-transform duration-500 hover:scale-[1.02]",alt:"",loading:"lazy"})},x))}),h=d.map(fi);let n;return e[0]!==b||e[1]!==h?(n=(0,t.jsxs)("div",{className:N,children:[b,h]}),e[0]=b,e[1]=h,e[2]=n):n=e[2],n},ci=oi;function di(i){return i.type==="image"||i.type==="video"}function mi(i){return i.type==="file"}function xi(i){return i.type==="image"}function ui(i){return i.url||i.src}function fi(i,e){return(0,t.jsx)(ai,{file:i},e)}var ye=({id:i,user:e,timeAgo:s,content:r,contentClass:l,media:o,quotedPost:c,stats:d,onClick:m,repostedBy:N,onUserClick:b,currentUser:h,showToast:n,poll:f,isDetail:x,initialComments:u,onDelete:g,onUpdate:j,isComment:p,onReply:k,community:v,parent_id:z,post_id:a})=>{const y=ie(),{liked:P,reposted:R,localStats:_,setLocalStats:C,handleLike:M,handleRepost:E}=ys(i,d,h,n||(()=>{})),{deletePost:L,updatePost:D}=hs(),{comments:$,fetchNextPage:S,hasNextPage:I,isFetchingNextPage:A,isLoading:U,addComment:B,isSubmitting:Y}=Ze(i,u),[ue,fe]=(0,w.useState)(""),[he,$e]=(0,w.useState)([]),[gt,Se]=(0,w.useState)(!1),[_e,le]=(0,w.useState)(!1),[ae,Z]=(0,w.useState)(!1),[H,ne]=(0,w.useState)(r),[re,oe]=(0,w.useState)(o||[]),[ce,ee]=(0,w.useState)([]),[Fe,Pe]=(0,w.useState)(!1),[vt,pe]=(0,w.useState)(!1),[ge,de]=(0,w.useState)(null),[ve,Me]=(0,w.useState)(!1),{comments:bt,isLoading:jt,refetch:Re}=Ze(a||i,[],ve?i:void 0),{ref:Ie,inView:Ee}=$t({threshold:.5,triggerOnce:!0});(0,w.useEffect)(()=>{if(Ee&&!p){const F=setTimeout(()=>{es(i).catch(console.error)},1500);return()=>clearTimeout(F)}},[Ee,i,p]);const kt=(0,w.useCallback)(async()=>{!i||!a&&!i||_.comments===0||(Me(!0),Re())},[i,a,_.comments,Re]),Ae=async()=>{const F=JSON.stringify(re)!==JSON.stringify(o||[])||ce.length>0;if(!H.trim()||H===r&&!F){Z(!1);return}Pe(!0);try{const T=[];for(const J of ce){const yt=await ze(J);T.push(yt)}const O=[...re,...T];p?await is(i,{content:H,media:O}):await D(i,{content:H,media:O}),ee([]),Z(!1),n&&n(`${p?"Comment":"Post"} updated`),j&&j(i,H,O)}catch(T){console.error(`Failed to update ${p?"comment":"post"}:`,T),n&&n(`Failed to update ${p?"comment":"post"}`)}finally{Pe(!1)}},De=async F=>{F&&F.stopPropagation();try{p?await ts(i):await L(i),n&&n(`${p?"Comment":"Post"} deleted successfully`),g&&g(i)}catch(T){console.error(`Failed to delete ${p?"comment":"post"}:`,T),n&&n(`Failed to delete ${p?"comment":"post"}`)}finally{le(!1)}},zt=async F=>{if(F.preventDefault(),!(!ue.trim()&&he.length===0||!h)){Se(!0);try{const T=[];for(const O of he){const J=await ze(O);T.push(J)}await B({userId:h.id,content:ue,media:T,replyToId:ge?.id}),fe(""),$e([]),de(null),C(O=>({...O,comments:(O.comments||0)+1})),n&&n("Reply posted!")}catch(T){console.error("Failed to post comment:",T),n&&n("Failed to post reply.")}finally{Se(!1)}}},Le=({trigger:F})=>(0,t.jsxs)(Zt,{children:[(0,t.jsx)(cs,{asChild:!0,onClick:T=>T.stopPropagation(),children:F}),(0,t.jsxs)(ss,{align:"end",className:"w-48 rounded-xl border-zinc-100 bg-white dark:border-zinc-800 dark:bg-zinc-900",children:[(0,t.jsxs)(Qe,{children:[!p&&(0,t.jsxs)(te,{className:"cursor-pointer gap-2 py-2.5",onClick:T=>{T.stopPropagation(),navigator.clipboard.writeText(`${window.location.origin}/post/${i}`),n&&n("Link copied")},children:[(0,t.jsx)(Bt,{size:16}),(0,t.jsx)("span",{children:"Copy link"})]}),!p&&(0,t.jsxs)(te,{className:"cursor-pointer gap-2 py-2.5",onClick:T=>{T.stopPropagation(),n&&n("Post reported")},children:[(0,t.jsx)(Ut,{size:16}),(0,t.jsx)("span",{children:"Report post"})]}),!be&&(0,t.jsxs)(te,{className:"cursor-pointer gap-2 py-2.5",onClick:T=>{T.stopPropagation(),n&&n("User blocked")},children:[(0,t.jsx)(At,{size:16}),(0,t.jsxs)("span",{children:["Block @",e.handle]})]}),be&&(0,t.jsxs)(te,{onClick:T=>{T.stopPropagation(),Z(!0)},className:"cursor-pointer gap-2 py-2.5",children:[(0,t.jsx)(Ot,{size:16}),"Edit Post"]})]}),be&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ds,{}),(0,t.jsx)(Qe,{children:(0,t.jsxs)(te,{variant:"destructive",className:"cursor-pointer gap-2 py-2.5",onClick:T=>{T.stopPropagation(),le(!0)},children:[(0,t.jsx)(It,{size:16}),(0,t.jsx)("span",{children:"Delete post"})]})})]})]})]}),be=h?.handle===e.handle,Nt=(F,T)=>{de(T?{handle:F,id:p?z||i:T}:null),fe(O=>{const J=`@${F} `;return O.includes(J)?O:J+O}),document.getElementById("comment-input")?.focus()};return x?(0,t.jsxs)("div",{className:"flex flex-col",ref:Ie,children:[(0,t.jsxs)("article",{className:"p-5 dark:bg-black",children:[(0,t.jsx)(st,{user:e,timeAgo:s,community:v,onUserClick:b,isDetail:!0,showAvatar:!0,actionsMenu:(0,t.jsx)(Le,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,t.jsx)(je,{size:20})})})}),(0,t.jsx)(it,{content:r,isDetail:!0,isEditing:ae,editedContent:H,setEditedContent:ne,onCancelEdit:()=>{Z(!1),ne(r),oe(o||[]),ee([])},onSaveEdit:Ae,isUpdating:Fe,contentClass:l}),me(r)&&(0,t.jsx)(rt,{url:me(r)}),(0,t.jsx)(lt,{media:o,isEditing:ae,editedMedia:re,setEditedMedia:oe,newFiles:ce,setNewFiles:ee}),f&&(0,t.jsx)(at,{poll:f}),c&&(0,t.jsx)("div",{className:"mt-4 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm dark:border-zinc-700",children:(0,t.jsx)(nt,{...c})}),(0,t.jsx)(tt,{views:_.views||0,likes:_.likes||0,comments:_.comments||0,isDetail:!0}),(0,t.jsx)(et,{liked:P,reposted:R,handleLike:M,handleRepost:E,handleCommentClick:()=>document.getElementById("comment-input")?.focus(),handleShareClick:()=>pe(!0),isDetail:!0,isComment:p})]}),ge&&(0,t.jsxs)("div",{className:"flex items-center justify-between bg-zinc-50 px-5 py-2 dark:bg-zinc-900/50",children:[(0,t.jsxs)("span",{className:"text-sm text-zinc-500",children:["Replying to ",(0,t.jsxs)("span",{className:"font-bold text-violet-600",children:["@",ge.handle]})]}),(0,t.jsx)("button",{onClick:()=>de(null),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,t.jsx)(se,{size:16})})]}),(0,t.jsx)(ht,{currentUser:h,newComment:ue,setNewComment:fe,handleSubmitComment:zt,loading:Y,selectedFiles:he,setSelectedFiles:$e,isUploading:gt}),(0,t.jsx)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:U?(0,t.jsx)("div",{className:"flex justify-center p-8",children:(0,t.jsx)(G,{className:"animate-spin text-violet-500"})}):(0,t.jsxs)(t.Fragment,{children:[I&&$.length>0&&(0,t.jsxs)("button",{onClick:()=>S(),disabled:A,className:"flex w-full items-center justify-center gap-2 py-3 text-sm font-bold text-violet-600 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[A&&(0,t.jsx)(G,{size:14,className:"animate-spin"}),"View more replies"]}),$.map(F=>(0,t.jsx)(ye,{...F,isComment:!0,post_id:i,onReply:Nt,onUserClick:b,currentUser:h,showToast:n,stats:{likes:F.stats?.likes||0,comments:F.stats?.comments||0,reposts:F.stats?.reposts||0},timeAgo:F.timeAgo||F.created_at},F.id))]})}),(0,t.jsx)(Be,{open:_e,onOpenChange:le,children:(0,t.jsxs)(Ve,{onClick:F=>F.stopPropagation(),children:[(0,t.jsxs)(qe,{children:[(0,t.jsx)(He,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ge,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(Ye,{children:[(0,t.jsx)(Xe,{onClick:F=>F.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Je,{onClick:De,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]}):(0,t.jsxs)("article",{ref:Ie,onClick:m,className:`px-4 transition-all ${p?"py-2 bg-transparent hover:bg-zinc-50/30 dark:hover:bg-zinc-800/20":"py-4 border-b border-zinc-100 bg-white hover:bg-zinc-50/30 dark:border-zinc-800 dark:bg-black dark:hover:bg-white/[0.02]"} ${m?"cursor-pointer":""}`,children:[N&&(0,t.jsxs)("div",{className:"mb-2 ml-1 flex items-center space-x-1.5 text-[13px] font-semibold text-zinc-600",children:[(0,t.jsx)(ke,{size:14,className:"text-zinc-500"}),(0,t.jsxs)("span",{className:"flex cursor-pointer items-center text-zinc-700 hover:underline dark:text-zinc-300",onClick:F=>{F.stopPropagation(),b&&b(N.handle)},children:[N.handle," Reposted"]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-x-3",children:[(0,t.jsxs)("div",{className:"flex shrink-0 flex-col items-center self-stretch pt-0.5",children:[(0,t.jsx)("div",{className:"cursor-pointer",onClick:F=>{F.stopPropagation(),b&&b(e.handle)},children:(0,t.jsxs)(K,{className:`${p?"size-8":"size-10"} border-0 shadow-sm`,children:[(0,t.jsx)(Q,{src:e.avatar,alt:e.handle,className:"object-cover"}),(0,t.jsx)(X,{className:"text-xs",children:e.handle[0]?.toUpperCase()})]})}),(!p&&_.comments>0||p&&!z&&_.comments>0)&&(0,t.jsx)("div",{className:"mt-2 w-0.5 flex-1 rounded-full bg-zinc-100 dark:bg-zinc-800"})]}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,t.jsx)(st,{user:e,timeAgo:s,community:v,onUserClick:b,isComment:p,actionsMenu:(0,t.jsx)(Le,{trigger:(0,t.jsx)("button",{"aria-label":"More options",className:"rounded-full p-2 text-zinc-500 transition-colors hover:bg-zinc-100 group-hover:bg-zinc-100 dark:hover:bg-zinc-800 dark:group-hover:bg-zinc-800/50",children:(0,t.jsx)(je,{size:18})})})}),(0,t.jsx)(it,{content:r,isEditing:ae,editedContent:H,setEditedContent:ne,onCancelEdit:()=>{Z(!1),ne(r),oe(o||[]),ee([])},onSaveEdit:Ae,isUpdating:Fe,contentClass:l}),me(r)&&(0,t.jsx)(rt,{url:me(r)}),(0,t.jsx)(lt,{media:o,isEditing:ae,editedMedia:re,setEditedMedia:oe,newFiles:ce,setNewFiles:ee}),f&&(0,t.jsx)(at,{poll:f}),c&&(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl border border-zinc-200 shadow-sm transition-all hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-900",onClick:F=>{F.stopPropagation(),y(`/post/${c.id}`)},children:(0,t.jsx)(nt,{...c})}),(0,t.jsx)(et,{liked:P,reposted:R,handleLike:M,handleRepost:E,handleCommentClick:F=>{F?.stopPropagation(),k?k(e.handle,i):m&&m()},handleShareClick:F=>{F?.stopPropagation(),pe(!0)},isComment:p}),(0,t.jsx)(tt,{views:_.views||0,likes:_.likes||0,comments:_.comments||0,isComment:p,onRepliesClick:()=>{ve?Me(!1):kt()}}),ve&&(0,t.jsxs)("div",{className:"relative mt-2 space-y-0",children:[(0,t.jsx)("div",{className:"absolute left-[19px] top-0 bottom-4 w-0.5 bg-zinc-100 dark:bg-zinc-800"}),jt?(0,t.jsx)("div",{className:"flex py-4 pl-12",children:(0,t.jsx)(G,{size:18,className:"animate-spin text-violet-500"})}):(0,t.jsx)("div",{className:"flex flex-col",children:bt.map(F=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute left-[19px] top-5 h-0.5 w-4 bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsx)("div",{className:"pl-6",children:(0,t.jsx)(ye,{...F,isComment:!0,post_id:a||i,onReply:k,onUserClick:b,currentUser:h,showToast:n,stats:{likes:F.stats?.likes||0,comments:F.stats?.comments||0,reposts:F.stats?.reposts||0},timeAgo:F.timeAgo||F.created_at})})]},F.id))})]})]})]}),(0,t.jsx)(pt,{isOpen:vt,onClose:()=>pe(!1),url:`${window.location.origin}/post/${i}`,title:"Share Post"}),(0,t.jsx)(Be,{open:_e,onOpenChange:le,children:(0,t.jsxs)(Ve,{onClick:F=>F.stopPropagation(),children:[(0,t.jsxs)(qe,{children:[(0,t.jsx)(He,{children:"Are you absolutely sure?"}),(0,t.jsx)(Ge,{children:"This action cannot be undone. This will permanently delete your post and all its comments."})]}),(0,t.jsxs)(Ye,{children:[(0,t.jsx)(Xe,{onClick:F=>F.stopPropagation(),children:"Cancel"}),(0,t.jsx)(Je,{onClick:De,className:"bg-rose-500 hover:bg-rose-600",children:"Delete"})]})]})})]})};function hi(i,e){const s=!i.media&&!e.media||i.media?.length===e.media?.length&&i.media?.every((l,o)=>l.url===e.media?.[o].url),r=i.repostedBy?.handle===e.repostedBy?.handle;return i.id===e.id&&i.content===e.content&&i.timeAgo===e.timeAgo&&i.user.id===e.user.id&&i.user.avatar===e.user.avatar&&i.stats.likes===e.stats.likes&&i.stats.comments===e.stats.comments&&i.stats.reposts===e.stats.reposts&&i.currentUser?.id===e.currentUser?.id&&!!s&&!!r}var pi=w.memo(ye,hi),gi=({isOpen:i,onClose:e,url:s,title:r="Share"})=>{const[l,o]=(0,w.useState)(!1),[c,d]=(0,w.useState)(""),[m,N]=(0,w.useState)([]),[b,h]=(0,w.useState)(!1),[n,f]=(0,w.useState)(null),{addToast:x}=xt(),{currentUser:u}=ut(),g=(0,w.useCallback)(async()=>{if(u){h(!0);try{N((await We(u.id)).map(a=>a.user).filter(a=>a!==null).slice(0,5))}catch(a){console.error("Failed to fetch conversations:",a)}finally{h(!1)}}},[u?.id]);(0,w.useEffect)(()=>{i&&u?g():(d(""),N([]))},[i,u,g]);const j=(0,w.useCallback)(async()=>{if(u){h(!0);try{N((await We(u.id)).map(a=>a.user).filter(a=>a!==null&&(a.name?.toLowerCase().includes(c.toLowerCase())||a.handle.toLowerCase().includes(c.toLowerCase()))))}catch(a){console.error("Search failed:",a)}finally{h(!1)}}},[c,u?.id]);(0,w.useEffect)(()=>{const a=setTimeout(()=>{c.trim()&&i?j():!c.trim()&&i&&g()},300);return()=>clearTimeout(a)},[c,i,j,g]);const p=async a=>{a&&a.stopPropagation();try{await navigator.clipboard.writeText(s),o(!0),x("Link copied to clipboard!","success"),setTimeout(()=>o(!1),2e3)}catch(y){console.error("Failed to copy:",y),x("Failed to copy link","error")}},k=async a=>{if(u){f(a.id);try{await as(await gs(u.id,a.id),u.id,s,"text"),x(`Sent to ${a.name||a.handle}!`,"success")}catch(y){console.error("Failed to send message:",y),x("Failed to send message","error")}finally{f(null)}}},v=[{name:"X",icon:Wt,color:"bg-black text-white",href:`https://twitter.com/intent/tweet?url=${encodeURIComponent(s)}`},{name:"Facebook",icon:Dt,color:"bg-[#1877F2] text-white",href:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(s)}`},{name:"LinkedIn",icon:Pt,color:"bg-[#0A66C2] text-white",href:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(s)}`},{name:"WhatsApp",icon:qt,color:"bg-[#25D366] text-white",href:`https://wa.me/?text=${encodeURIComponent(s)}`},{name:"Email",icon:Xt,color:"bg-zinc-600 text-white",href:`mailto:?body=${encodeURIComponent(s)}`}],z=async()=>{if(navigator.share)try{await navigator.share({title:r,url:s})}catch(a){a.name!=="AbortError"&&console.error("Native share failed:",a)}else p()};return(0,t.jsx)(mt,{isOpen:i,onClose:e,title:r,className:"max-w-[420px] !p-0 overflow-hidden",children:(0,t.jsxs)("div",{className:"flex h-full flex-col bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"px-5 pb-2 pt-4",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)(Gt,{className:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-zinc-400 transition-colors group-focus-within:text-violet-500"}),(0,t.jsx)("input",{type:"text",placeholder:"Search people...",value:c,onChange:a=>d(a.target.value),className:"w-full rounded-xl border-none bg-zinc-100 py-2.5 pl-10 pr-4 text-sm transition-all focus:ring-2 focus:ring-violet-500/20 outline-none dark:bg-zinc-800/50"})]})}),(0,t.jsx)("div",{className:"no-scrollbar flex min-h-[100px] items-center gap-4 overflow-x-auto px-5 py-4",children:b?(0,t.jsx)("div",{className:"flex flex-1 justify-center",children:(0,t.jsx)(G,{size:24,className:"animate-spin text-zinc-400"})}):m.length>0?m.map(a=>(0,t.jsxs)("button",{onClick:()=>k(a),disabled:n!==null,className:"group flex shrink-0 flex-col items-center gap-1.5 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"size-14 overflow-hidden rounded-full border-2 border-white shadow-sm transition-transform group-hover:scale-105 bg-zinc-100 dark:bg-zinc-800 dark:border-zinc-900",children:(0,t.jsx)("img",{src:a.avatar||`https://i.pravatar.cc/150?u=${a.id}`,alt:a.handle,className:"size-full object-cover"})}),n===a.id&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-full bg-black/40",children:(0,t.jsx)(G,{size:16,className:"animate-spin text-white"})})]}),(0,t.jsx)("span",{className:"max-w-[60px] truncate text-[10px] font-medium text-zinc-500 dark:text-zinc-400",children:a.name?.split(" ")[0]||a.handle})]},a.id)):(0,t.jsx)("div",{className:"flex-1 py-2 text-center",children:(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"No people found"})})}),(0,t.jsx)("div",{className:"mx-5 h-px bg-zinc-100 dark:bg-zinc-800"}),(0,t.jsxs)("div",{className:"grid grid-cols-5 gap-2 px-5 py-6",children:[v.map(a=>(0,t.jsxs)("a",{href:a.href,target:"_blank",rel:"noopener noreferrer",className:"group flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:`size-12 ${a.color} flex items-center justify-center rounded-2xl shadow-md transition-all group-hover:-translate-y-1 group-hover:scale-110 group-hover:shadow-lg`,children:(0,t.jsx)(a.icon,{size:20,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-tighter text-zinc-500 dark:text-zinc-400",children:a.name})]},a.name)),(0,t.jsxs)("button",{onClick:z,className:"group flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:"flex size-12 items-center justify-center rounded-2xl border border-zinc-200 bg-zinc-100 text-zinc-600 shadow-sm transition-all group-hover:-translate-y-1 group-hover:scale-110 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-300",children:(0,t.jsx)(je,{size:20,strokeWidth:2.5})}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-tighter text-zinc-500 dark:text-zinc-400",children:"More"})]})]}),(0,t.jsx)("div",{className:"px-5 pb-6",children:(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)("input",{type:"text",readOnly:!0,value:s,className:"w-full rounded-2xl border border-zinc-200 bg-zinc-50 py-3.5 pl-4 pr-14 text-sm font-medium transition-colors focus:outline-none group-hover:border-zinc-300 dark:border-zinc-800 dark:bg-zinc-950 dark:group-hover:border-zinc-700"}),(0,t.jsx)("button",{onClick:p,className:`absolute right-1.5 top-1/2 flex -translate-y-1/2 items-center gap-2 rounded-xl h-10 px-4 text-xs font-bold shadow-sm transition-all active:scale-95 ${l?"bg-emerald-500 text-white":"bg-zinc-900 text-white hover:opacity-90 dark:bg-white dark:text-zinc-900"}`,children:l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Lt,{size:14,strokeWidth:3}),(0,t.jsx)("span",{children:"Copied"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Ft,{size:14,strokeWidth:3}),(0,t.jsx)("span",{children:"Copy"})]})})]})}),(0,t.jsx)("div",{className:"px-5 pb-5",children:(0,t.jsxs)("button",{onClick:e,className:"group relative flex w-full items-center justify-center overflow-hidden rounded-2xl bg-zinc-900 py-4 font-bold text-white transition-all hover:shadow-xl hover:shadow-zinc-900/10 active:scale-[0.98] dark:bg-white dark:text-zinc-900 dark:hover:shadow-white/10",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-zinc-500 to-zinc-600 opacity-0 transition-opacity duration-300 group-hover:opacity-100"}),(0,t.jsx)("div",{className:"relative flex items-center gap-2",children:(0,t.jsx)("span",{children:"Close"})})]})})]})})},pt=gi,vi=w.memo(({reel:i,isActive:e,isMuted:s})=>{const r=ie(),{currentUser:l}=ut(),{addToast:o}=xt(),c=(0,w.useRef)(null),[d,m]=(0,w.useState)(!1),[N,b]=(0,w.useState)(!1),[h,n]=(0,w.useState)(!1),[f,x]=(0,w.useState)(null),[u,g]=(0,w.useState)(!1),[j,p]=(0,w.useState)(i.stats?.likes||0),[k,v]=(0,w.useState)(!1),[z,a]=(0,w.useState)(0),y=(0,w.useRef)(null),P=(0,w.useMemo)(()=>Array.isArray(i.media)?i.media[0]?.src||i.media[0]?.url:i.media?.src||i.media?.url||i.url,[i.media,i.url]);(0,w.useEffect)(()=>{let $;const S=c.current?.plyr;return S&&(e?$=setTimeout(()=>{typeof S.play=="function"&&S.play().catch(()=>{S&&(S.muted=!0,S.play().catch(()=>{}))})},100):typeof S.pause=="function"&&S.pause()),()=>{$&&clearTimeout($)}},[e]),(0,w.useEffect)(()=>{if(!l?.id||!e)return;(async()=>{try{const[S,I]=await Promise.all([rs(i.id,l.id),ks(l.id,i.user?.id)]);g(S),v(I)}catch(S){console.error("Failed to check interaction status:",S)}})()},[i.id,l?.id,e,i.user?.id]),(0,w.useEffect)(()=>{const $=c.current?.plyr;$&&($.muted=s)},[s]),(0,w.useEffect)(()=>{const $=c.current?.plyr;if(!$||!e)return;const S=()=>{const I=$.currentTime,A=$.duration;A>0&&a(I/A*100)};if(typeof $.on=="function")return $.on("timeupdate",S),()=>{typeof $.off=="function"&&$.off("timeupdate",S)}},[e]),(0,w.useEffect)(()=>()=>{y.current&&clearTimeout(y.current)},[]);const R=$=>{const S=$.target;S.closest("button")||S.closest("a")||S.closest(".plyr__controls")||(y.current?(clearTimeout(y.current),y.current=null,C()):y.current=setTimeout(()=>{y.current=null,_()},250))},_=()=>{const $=c.current?.plyr;$&&($.paused?($.play().catch(()=>{}),x("play")):($.pause(),x("pause")),setTimeout(()=>x(null),800))},C=async()=>{if(l&&(m(!0),setTimeout(()=>m(!1),1e3),!u)){g(!0),p($=>$+1);try{await Oe(i.id,l.id)}catch{g(!1),p($=>$-1)}}},M=async $=>{if($.stopPropagation(),!l)return;const S=!u;g(S),p(I=>S?I+1:I-1);try{await Oe(i.id,l.id)}catch{g(!S),p(I=>S?I-1:I+1)}},E=async $=>{if($.stopPropagation(),!l)return;const S=!k;v(S);try{await os(l.id,i.user?.id)}catch{v(!S)}},L=$=>{$.stopPropagation(),n(!0)},D=(0,w.useMemo)(()=>({source:{type:"video",sources:[{src:P,type:"video/mp4"}]},options:{controls:[],loop:{active:!0},clickToPlay:!1,ratio:"9:16"}}),[P]);return(0,t.jsxs)("div",{"data-id":i.id,className:"reel-item relative flex h-[100dvh] w-full snap-start items-center justify-center overflow-hidden bg-black cursor-pointer",onClick:R,children:[(0,t.jsx)("div",{className:"flex h-full w-full max-w-[450px] items-center justify-center",children:(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(dt,{ref:c,...D})})}),d&&(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-in zoom-in-50 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)(xe,{size:120,fill:"white",className:"scale-125 text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.4)]"})})}),f&&(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-in fade-in zoom-in-90 scale-100 animate-out zoom-out-110 fade-out fill-mode-forwards duration-500",children:(0,t.jsx)("div",{className:"rounded-full border border-white/20 bg-white/10 p-8 shadow-2xl backdrop-blur-md",children:f==="play"?(0,t.jsx)(Qt,{size:50,fill:"white",className:"ml-1.5 text-white"}):(0,t.jsx)(Ht,{size:50,fill:"white",className:"text-white"})})})}),(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/60"}),(0,t.jsxs)("div",{className:"pointer-events-none absolute bottom-6 left-4 right-16 text-white",children:[(0,t.jsxs)("div",{className:"pointer-events-auto mb-3 flex items-center gap-2",children:[(0,t.jsxs)(St,{to:`/u/${i.user?.handle}`,className:"flex items-center gap-2 transition-opacity hover:opacity-80",onClick:$=>$.stopPropagation(),children:[(0,t.jsxs)(K,{className:"size-10 border-2 border-white",children:[(0,t.jsx)(Q,{src:i.user?.avatar,alt:i.user?.handle,className:"object-cover"}),(0,t.jsx)(X,{children:i.user?.handle?.[0]?.toUpperCase()})]}),(0,t.jsxs)("span",{className:"font-bold",children:["@",i.user?.handle]})]}),l?.id!==i.user?.id&&(0,t.jsx)("button",{className:`ml-2 flex items-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-bold transition-all active:scale-95 ${k?"border border-white/50 bg-transparent text-white":"bg-white text-black hover:bg-zinc-200"}`,onClick:E,children:k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(fs,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Following"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(us,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Follow"})]})})]}),(0,t.jsx)(we,{options:{...Ce,render:({attributes:$,content:S})=>{const{href:I,...A}=$,U=!I.startsWith("/")&&(I.startsWith("http")||I.startsWith("www"));return I.startsWith("/u/")||I.startsWith("/tags/")||I.startsWith("/c/")||I.startsWith("/explore")?(0,t.jsx)("span",{...A,className:"cursor-pointer font-bold text-white hover:underline",onClick:B=>{B.stopPropagation(),r(I)},children:S},S):(0,t.jsx)("a",{href:I,...A,className:"text-white hover:underline",target:U?"_blank":void 0,rel:U?"noopener noreferrer":void 0,onClick:B=>B.stopPropagation(),children:S},S)}},children:(0,t.jsx)("p",{className:"mb-3 line-clamp-2 text-sm",children:i.content})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[(0,t.jsx)(Vt,{size:14,className:"animate-spin-slow"}),(0,t.jsxs)("span",{children:["Original Audio - ",i.user?.handle]})]})]}),(0,t.jsxs)("div",{className:"absolute bottom-6 right-2 z-10 flex flex-col items-center gap-6",children:[(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:`rounded-full p-3 backdrop-blur-md transition-all active:scale-90 ${u?"bg-rose-500/20 text-rose-500":"bg-zinc-800/50 text-white hover:bg-zinc-700"}`,onClick:M,children:(0,t.jsx)(xe,{size:28,fill:u?"currentColor":"none"})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:j})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700 active:scale-90",onClick:$=>{$.stopPropagation(),b(!0)},children:(0,t.jsx)(ft,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:i.stats?.comments||0})]}),(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center gap-1",children:[(0,t.jsx)("button",{className:"rounded-full bg-zinc-800/50 p-3 text-white backdrop-blur-md transition-colors hover:bg-zinc-700 active:scale-90",onClick:L,children:(0,t.jsx)(Ne,{size:28})}),(0,t.jsx)("span",{className:"text-xs font-bold text-white",children:i.stats?.shares||0})]})]}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 z-50 h-[3px] w-full bg-white/20",children:(0,t.jsx)("div",{className:"h-full bg-white shadow-[0_0_8px_rgba(255,255,255,0.8)] transition-all duration-100 ease-linear",style:{width:`${z}%`}})}),(0,t.jsx)(ji,{isOpen:N,onClose:()=>b(!1),reelId:i.id,currentUser:l,showToast:o}),(0,t.jsx)(pt,{isOpen:h,onClose:()=>n(!1),url:`${window.location.origin}/reels/${i.id}`,title:"Share Reel"})]})},(i,e)=>i.isActive===e.isActive&&i.reel.id===e.reel.id&&i.isMuted===e.isMuted),Si=vi,bi=({isOpen:i,onClose:e,reelId:s,currentUser:r,showToast:l})=>{const[o,c]=(0,w.useState)([]),[d,m]=(0,w.useState)(!1),[N,b]=(0,w.useState)(!1),[h,n]=(0,w.useState)(""),[f,x]=(0,w.useState)([]),[u,g]=(0,w.useState)(!1),[j,p]=(0,w.useState)(!0),[k,v]=(0,w.useState)(!1),[z,a]=(0,w.useState)(null),y=(0,w.useRef)(o);(0,w.useEffect)(()=>{y.current=o},[o]);const P=(0,w.useCallback)(async(_=!1)=>{if(s){_?v(!0):m(!0);try{const C=y.current,M=await ls(s,_&&C.length>0?C[C.length-1].created_at:null,10);M.length<10?p(!1):p(!0),c(_?E=>[...E,...M]:M)}catch(C){console.error("Failed to load comments:",C),l&&l("Failed to load comments","error")}finally{m(!1),v(!1)}}},[s,l]);(0,w.useEffect)(()=>{i&&s?P():(c([]),p(!0))},[i,s,P]);const R=async _=>{if(_.preventDefault(),!(!h.trim()&&f.length===0||!r)){b(!0),g(!0);try{const C=[];for(const M of f){const E=await ze(M);C.push(E)}await ns(s,r.id,h,C,z?.id),n(""),x([]),a(null),l&&l("Reply posted!"),P()}catch(C){console.error("Failed to post comment:",C),l&&l("Failed to post reply.","error")}finally{b(!1),g(!1)}}};return(0,t.jsx)(mt,{isOpen:i,onClose:e,title:"Comments",className:"max-sm:h-[95dvh] h-[85vh] overflow-hidden !p-0 sm:max-w-xl",children:(0,t.jsxs)("div",{className:"flex h-full flex-col overflow-hidden bg-white dark:bg-zinc-900",children:[(0,t.jsx)("div",{className:"mx-auto my-3 h-1.5 w-12 shrink-0 rounded-full bg-zinc-200 dark:bg-zinc-800 sm:hidden"}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto scroll-smooth scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800",children:d?(0,t.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,t.jsx)(G,{className:"animate-spin text-violet-500",size:32})}):o.length>0?(0,t.jsxs)("div",{className:"flex flex-col",children:[o.map(_=>(0,t.jsx)(pi,{..._,isComment:!0,post_id:s,currentUser:r,showToast:l,onReply:(C,M)=>{a(M?{handle:C,id:M}:null),n(E=>E.includes(`@${C}`)?E:E+`@${C} `)},onDelete:C=>c(M=>M.filter(E=>E.id!==C)),onUpdate:(C,M,E)=>c(L=>L.map(D=>D.id===C?{...D,content:M,media:E}:D))},_.id)),j&&(0,t.jsxs)("button",{onClick:()=>P(!0),disabled:k,className:"flex w-full items-center justify-center gap-2 py-6 text-sm font-bold text-violet-600 transition-colors hover:bg-zinc-50 dark:hover:bg-zinc-900",children:[k&&(0,t.jsx)(G,{size:16,className:"animate-spin"}),"View more replies"]})]}):(0,t.jsxs)("div",{className:"flex h-full min-h-[300px] flex-col items-center justify-center p-8 text-center text-zinc-500",children:[(0,t.jsx)("div",{className:"mb-4 flex size-16 items-center justify-center rounded-full bg-zinc-100 dark:bg-zinc-900",children:(0,t.jsx)(ct,{size:32,className:"text-zinc-400"})}),(0,t.jsx)("p",{className:"text-lg font-bold dark:text-zinc-300",children:"No comments yet"}),(0,t.jsx)("p",{className:"text-sm dark:text-zinc-500",children:"Be the first to share what you think!"})]})}),(0,t.jsxs)("div",{className:"shrink-0 border-t border-zinc-100 bg-white pb-safe dark:border-zinc-800 dark:bg-zinc-900",children:[z&&(0,t.jsxs)("div",{className:"flex items-center justify-between border-b border-zinc-50 bg-zinc-50/50 px-4 py-2 dark:border-zinc-800/50 dark:bg-zinc-900/50",children:[(0,t.jsxs)("span",{className:"text-xs text-zinc-500",children:["Replying to ",(0,t.jsxs)("span",{className:"font-bold text-violet-600",children:["@",z.handle]})]}),(0,t.jsx)("button",{onClick:()=>a(null),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:(0,t.jsx)(se,{size:14})})]}),(0,t.jsx)(ht,{currentUser:r,newComment:h,setNewComment:n,handleSubmitComment:R,loading:N,selectedFiles:f,setSelectedFiles:x,isUploading:u})]})]})})},ji=bi,_i=W();export{pi as n,Si as t};
