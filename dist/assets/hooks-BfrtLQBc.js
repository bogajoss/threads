import{a as he}from"./rolldown-runtime-BaZ8gS7u.js";import{E as _e,S as ye,b as re,c as I,x as me}from"./framework-CsA6nn9m.js";import{a as le,n as oe,r as ue,t as se}from"./query-QyXblnmD.js";import{$t as Pe,At as we,Bt as Me,Ct as be,Et as Se,Ht as $e,It as Re,Jt as qe,Kt as Te,Lt as Fe,Mt as Le,Nt as Qe,Ot as De,Pt as ke,Qt as Ne,Rt as xe,Tt as ve,Ut as Ke,Vt as Ee,Wt as Ae,Xt as Ce,Yt as Oe,_t as Be,an as je,bt as Je,c as ze,cn as He,en as Ve,gn as ae,hn as ie,jt as We,on as Xe,pn as ge,qt as Ge,sn as Ye,vt as fe,wt as Ze,xt as ne,yt as Ue,zt as Ie}from"./index-GVhKdFnX.js";var et=I(),V=he(_e(),1);const tt=(e,i,s)=>{const t=(0,et.c)(16);let n,o;t[0]!==i||t[1]!==e?(n=["follows",i,e],o=p=>{const{pageParam:_}=p;return(i==="Followers"?je:Xe)(e,_,10)},t[0]=i,t[1]=e,t[2]=n,t[3]=o):(n=t[2],o=t[3]);const a=!!e&&s;let m;t[4]!==n||t[5]!==o||t[6]!==a?(m={queryKey:n,queryFn:o,initialPageParam:null,getNextPageParam:st,enabled:a},t[4]=n,t[5]=o,t[6]=a,t[7]=m):m=t[7];const{data:c,fetchNextPage:u,hasNextPage:f,isFetchingNextPage:r,isLoading:R}=se(m);let b;t[8]!==c?.pages?(b=c?.pages.flatMap(it)||[],t[8]=c?.pages,t[9]=b):b=t[9];const d=b;let g;return t[10]!==u||t[11]!==d||t[12]!==f||t[13]!==r||t[14]!==R?(g={followList:d,fetchNextPage:u,hasNextPage:f,isFetchingNextPage:r,isLoading:R},t[10]=u,t[11]=d,t[12]=f,t[13]=r,t[14]=R,t[15]=g):g=t[15],g};function st(e){if(!(!e||e.length<10))return e[e.length-1].followed_at}function it(e){return e}var nt=I();const at=(e,i)=>{const s=(0,nt.c)(95),t=le(),{addToast:n}=fe();let o;s[0]!==e?.id?(o=(D,X)=>{const Z=D===void 0?[]:D,U=X===void 0?[]:X;return Z.map(H=>({id:H.id,sender:H.sender_id===e?.id?"me":"them",senderAvatar:H.sender?.avatar,senderName:H.sender?.name,text:H.content||"",type:H.type||"text",media:H.media?Array.isArray(H.media)?H.media:[H.media]:[],isRead:H.is_read||!1,replyToId:H.reply_to_id,reactions:U.filter(te=>te.message_id===H.id),time:H.created_at?new Date(H.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Just now",updatedAt:H.updated_at,isOptimistic:H.isOptimistic}))},s[0]=e?.id,s[1]=o):o=s[1],e?.id;const a=o;let m,c;s[2]!==i?(m=["messages",i],c=D=>{const{pageParam:X}=D;return Re(i,X,20)},s[2]=i,s[3]=m,s[4]=c):(m=s[3],c=s[4]);const u=!!i;let f;s[5]!==m||s[6]!==c||s[7]!==u?(f={queryKey:m,queryFn:c,initialPageParam:null,getNextPageParam:ot,enabled:u,refetchOnWindowFocus:!1},s[5]=m,s[6]=c,s[7]=u,s[8]=f):f=s[8];const{data:r,fetchNextPage:R,hasNextPage:b,isFetchingNextPage:d,isLoading:g,refetch:p}=se(f);let _,P;s[9]!==i?(_=["reactions",i],P=()=>Fe(i),s[9]=i,s[10]=_,s[11]=P):(_=s[10],P=s[11]);const w=!!i;let h;s[12]!==_||s[13]!==P||s[14]!==w?(h={queryKey:_,queryFn:P,enabled:w,staleTime:3e5},s[12]=_,s[13]=P,s[14]=w,s[15]=h):h=s[15];const{data:l}=ue(h);let y;s[16]!==l?(y=l===void 0?[]:l,s[16]=l,s[17]=y):y=s[17];const S=y;let $;s[18]!==e?($=D=>{const{convId:X,text:Z,type:U,media:H,replyToId:te}=D,ce=U===void 0?"text":U,de=H===void 0?[]:H,pe=te===void 0?null:te;return Me(X,e.id,Z,ce,de,pe)},s[18]=e,s[19]=$):$=s[19];let q;s[20]!==i||s[21]!==e||s[22]!==t?(q=async D=>{await t.cancelQueries({queryKey:["messages",i]});const X=t.getQueryData(["messages",i]),Z={id:`temp-${Date.now()}`,conversation_id:i,sender_id:e.id,content:D.text,type:D.type||"text",media:D.media||[],reply_to_id:D.replyToId,is_read:!1,created_at:new Date().toISOString(),isOptimistic:!0,sender:{id:e.id,username:e.handle,display_name:e.name,avatar_url:e.avatar}};return t.setQueryData(["messages",i],U=>{if(!U)return{pages:[[Z]],pageParams:[null]};const H=[...U.pages];return H[0]=[Z,...H[0]],{...U,pages:H}}),{previousMessages:X}},s[20]=i,s[21]=e,s[22]=t,s[23]=q):q=s[23];let L;s[24]!==i||s[25]!==n||s[26]!==t?(L=(D,X,Z)=>{t.setQueryData(["messages",i],Z?.previousMessages),n("Failed to send message","error")},s[24]=i,s[25]=n,s[26]=t,s[27]=L):L=s[27];let Q;s[28]!==i||s[29]!==e||s[30]!==t?(Q=()=>{t.invalidateQueries({queryKey:["messages",i]}),t.invalidateQueries({queryKey:["conversations",e.id]})},s[28]=i,s[29]=e,s[30]=t,s[31]=Q):Q=s[31];let x;s[32]!==$||s[33]!==q||s[34]!==L||s[35]!==Q?(x={mutationFn:$,onMutate:q,onError:L,onSettled:Q},s[32]=$,s[33]=q,s[34]=L,s[35]=Q,s[36]=x):x=s[36];const k=oe(x);let T;s[37]!==i||s[38]!==t?(T=async D=>{const{messageId:X,content:Z}=D;await t.cancelQueries({queryKey:["messages",i]});const U=t.getQueryData(["messages",i]);return t.setQueryData(["messages",i],H=>H&&{...H,pages:H.pages.map(te=>te.map(ce=>ce.id===X?{...ce,content:Z}:ce))}),{previousMessages:U}},s[37]=i,s[38]=t,s[39]=T):T=s[39];let v;s[40]!==i||s[41]!==e?.id||s[42]!==t?(v=D=>{D&&(t.invalidateQueries({queryKey:["messages",i]}),t.invalidateQueries({queryKey:["conversations",e?.id]}))},s[40]=i,s[41]=e?.id,s[42]=t,s[43]=v):v=s[43];let F;s[44]!==i||s[45]!==n||s[46]!==t?(F=(D,X,Z)=>{t.setQueryData(["messages",i],Z?.previousMessages),n("Failed to edit message","error")},s[44]=i,s[45]=n,s[46]=t,s[47]=F):F=s[47];let A;s[48]!==T||s[49]!==v||s[50]!==F?(A={mutationFn:rt,onMutate:T,onSuccess:v,onError:F},s[48]=T,s[49]=v,s[50]=F,s[51]=A):A=s[51];const K=oe(A);let j;s[52]!==i||s[53]!==n||s[54]!==e||s[55]!==t?(j=async(D,X)=>{if(!e?.id||!i)return;await t.cancelQueries({queryKey:["reactions",i]});const Z=t.getQueryData(["reactions",i]),U=Z?.find(H=>H.message_id===D&&H.user_id===e.id&&H.emoji===X);t.setQueryData(["reactions",i],H=>{const te=H===void 0?[]:H;if(U)return te.filter(de=>de.id!==U.id);const ce={id:`temp-${Date.now()}`,message_id:D,user_id:e.id,emoji:X,created_at:new Date().toISOString()};return[...te,ce]});try{await Ee(D,e.id,X),t.invalidateQueries({queryKey:["reactions",i]})}catch(H){console.error("Failed to toggle reaction:",H),t.setQueryData(["reactions",i],Z),n("Failed to update reaction","error")}},s[52]=i,s[53]=n,s[54]=e,s[55]=t,s[56]=j):j=s[56];const J=j;let Y;s[57]!==i||s[58]!==t?(Y=async D=>{await t.cancelQueries({queryKey:["messages",i]});const X=t.getQueryData(["messages",i]);return t.setQueryData(["messages",i],Z=>Z&&{...Z,pages:Z.pages.map(U=>U.filter(H=>H.id!==D))}),{previousMessages:X}},s[57]=i,s[58]=t,s[59]=Y):Y=s[59];let W;s[60]!==i||s[61]!==e?.id||s[62]!==t?(W=()=>{t.invalidateQueries({queryKey:["messages",i]}),t.invalidateQueries({queryKey:["conversations",e?.id]})},s[60]=i,s[61]=e?.id,s[62]=t,s[63]=W):W=s[63];let z;s[64]!==i||s[65]!==n||s[66]!==t?(z=(D,X,Z)=>{t.setQueryData(["messages",i],Z?.previousMessages),n("Failed to delete message","error")},s[64]=i,s[65]=n,s[66]=t,s[67]=z):z=s[67];let E;s[68]!==Y||s[69]!==W||s[70]!==z?(E={mutationFn:lt,onMutate:Y,onSuccess:W,onError:z},s[68]=Y,s[69]=W,s[70]=z,s[71]=E):E=s[71];const C=oe(E);let N;s[72]!==r?.pages?(N=[...r?.pages.flatMap(ct)||[]].reverse(),s[72]=r?.pages,s[73]=N):N=s[73];const O=N;let B;s[74]!==k?(B=(D,X,Z,U,H)=>k.mutate({convId:D,text:X,type:Z,media:U,replyToId:H}),s[74]=k,s[75]=B):B=s[75];let M;s[76]!==K?(M=(D,X)=>K.mutate({messageId:D,content:X}),s[76]=K,s[77]=M):M=s[77];let G;s[78]!==C?(G=D=>C.mutate(D),s[78]=C,s[79]=G):G=s[79];let ee;return s[80]!==S||s[81]!==K.isPending||s[82]!==R||s[83]!==O||s[84]!==a||s[85]!==b||s[86]!==d||s[87]!==g||s[88]!==J||s[89]!==p||s[90]!==k.isPending||s[91]!==B||s[92]!==M||s[93]!==G?(ee={messages:O,isMsgLoading:g,refetchMessages:p,fetchNextMessages:R,hasMoreMessages:b,isFetchingMoreMessages:d,sendMessage:B,editMessage:M,isSending:k.isPending,isEditing:K.isPending,onToggleReaction:J,onDeleteMessage:G,conversationReactions:S,formatMessages:a},s[80]=S,s[81]=K.isPending,s[82]=R,s[83]=O,s[84]=a,s[85]=b,s[86]=d,s[87]=g,s[88]=J,s[89]=p,s[90]=k.isPending,s[91]=B,s[92]=M,s[93]=G,s[94]=ee):ee=s[94],ee};function ot(e){if(!(!e||e.length<20))return e[e.length-1].created_at}function rt(e){const{messageId:i,content:s}=e;return ke(i,s)}function lt(e){return Qe(e)}function ct(e){return e}var ut=I();const ft=(e,i)=>{const s=(0,ut.c)(21),t=le();let n;s[0]===Symbol.for("react.memo_cache_sentinel")?(n={},s[0]=n):n=s[0];const[o,a]=(0,V.useState)(n),m=(0,V.useRef)(null);let c;s[1]===Symbol.for("react.memo_cache_sentinel")?(c={},s[1]=c):c=s[1];const u=(0,V.useRef)(c);let f;s[2]!==e||s[3]!==t?(f=async P=>{if(!(!e?.id||!P))try{await Ie(P),t.invalidateQueries({queryKey:["unread_messages_count",e.id]}),t.invalidateQueries({queryKey:["conversations",e.id]})}catch(w){console.error("Failed to mark as read:",w)}},s[2]=e,s[3]=t,s[4]=f):f=s[4];const r=f;let R;s[5]!==i||s[6]!==e||s[7]!==r||s[8]!==t?(R=()=>{if(!e?.id)return;const P=ae.channel(`messages_realtime:${i||"global"}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},h=>{const l=h.new;i&&l.conversation_id===i&&(t.invalidateQueries({queryKey:["messages",i]}),l.sender_id!==e.id&&r(i)),t.invalidateQueries({queryKey:["conversations",e.id]}),l.sender_id!==e.id&&t.invalidateQueries({queryKey:["unread_messages_count",e.id]}),a(y=>({...y,[l.conversation_id]:!1}))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"messages"},()=>{t.invalidateQueries({queryKey:["messages"]}),t.invalidateQueries({queryKey:["conversations",e.id]})}).on("postgres_changes",{event:"*",schema:"public",table:"message_reactions"},()=>{i&&t.invalidateQueries({queryKey:["reactions",i]})}).subscribe(),w=ae.channel("chat_typing_shared").on("broadcast",{event:"typing"},h=>{const{payload:l}=h,{conversationId:y,isTyping:S,userId:$}=l;$!==e.id&&(a(q=>({...q,[y]:S})),u.current[y]&&window.clearTimeout(u.current[y]),S&&(u.current[y]=window.setTimeout(()=>{a(q=>({...q,[y]:!1}))},5e3)))}).subscribe();return m.current=w,()=>{ae.removeChannel(P),ae.removeChannel(w),Object.values(u.current).forEach(window.clearTimeout)}},s[5]=i,s[6]=e,s[7]=r,s[8]=t,s[9]=R):R=s[9];const b=e?.id;let d;s[10]!==i||s[11]!==r||s[12]!==t||s[13]!==b?(d=[b,t,i,r],s[10]=i,s[11]=r,s[12]=t,s[13]=b,s[14]=d):d=s[14],(0,V.useEffect)(R,d);let g;s[15]!==e?(g=(P,w)=>{m.current&&e&&m.current.send({type:"broadcast",event:"typing",payload:{conversationId:P,isTyping:w,userId:e.id}})},s[15]=e,s[16]=g):g=s[16];const p=g;let _;return s[17]!==r||s[18]!==p||s[19]!==o?(_={typingStatus:o,sendTypingStatus:p,markAsRead:r},s[17]=r,s[18]=p,s[19]=o,s[20]=_):_=s[20],_};var mt=I();const dt=(e,i)=>{const s=(0,mt.c)(22),{conversations:t,unreadCount:n,isConvLoading:o,refetchConversations:a}=ze(e),{messages:m,isMsgLoading:c,refetchMessages:u,fetchNextMessages:f,hasMoreMessages:r,isFetchingMoreMessages:R,sendMessage:b,editMessage:d,isSending:g,isEditing:p,onToggleReaction:_,onDeleteMessage:P,conversationReactions:w,formatMessages:h}=at(e,i),{typingStatus:l,sendTypingStatus:y,markAsRead:S}=ft(e,i);let $;return s[0]!==w||s[1]!==t||s[2]!==d||s[3]!==f||s[4]!==h||s[5]!==r||s[6]!==o||s[7]!==p||s[8]!==R||s[9]!==c||s[10]!==g||s[11]!==S||s[12]!==m||s[13]!==P||s[14]!==_||s[15]!==a||s[16]!==u||s[17]!==b||s[18]!==y||s[19]!==l||s[20]!==n?($={conversations:t,unreadCount:n,isConvLoading:o,refetchConversations:a,refetchMessages:u,sendMessage:b,editMessage:d,sendTypingStatus:y,typingStatus:l,markAsRead:S,formatMessages:h,onToggleReaction:_,onDeleteMessage:P,conversationReactions:w,isSending:g,isEditing:p,messages:m,isMsgLoading:c,fetchNextMessages:f,hasMoreMessages:r,isFetchingMoreMessages:R},s[0]=w,s[1]=t,s[2]=d,s[3]=f,s[4]=h,s[5]=r,s[6]=o,s[7]=p,s[8]=R,s[9]=c,s[10]=g,s[11]=S,s[12]=m,s[13]=P,s[14]=_,s[15]=a,s[16]=u,s[17]=b,s[18]=y,s[19]=l,s[20]=n,s[21]=$):$=s[21],$};var gt=I();const cs=(e,i,s)=>{const t=(0,gt.c)(85),n=le(),{addToast:o}=fe();let a;t[0]!==i?(a=i||{comments:0,likes:0,mirrors:0,reposts:0},t[0]=i,t[1]=a):a=t[1];const[m,c]=(0,V.useState)(a),[u,f]=(0,V.useState)(i);i!==u&&(f(i),c(O=>({...O,...i})));const r=s?.id;let R;t[2]!==e||t[3]!==r?(R=["post",e,"liked",r],t[2]=e,t[3]=r,t[4]=R):R=t[4];let b,d;t[5]!==s||t[6]!==e?(b=()=>Ke(e,s.id),d=!!s&&ie(e)&&ie(s.id),t[5]=s,t[6]=e,t[7]=b,t[8]=d):(b=t[7],d=t[8]);let g;t[9]!==R||t[10]!==b||t[11]!==d?(g={queryKey:R,queryFn:b,enabled:d,staleTime:6e5},t[9]=R,t[10]=b,t[11]=d,t[12]=g):g=t[12];const{data:p}=ue(g),_=p===void 0?!1:p,P=s?.id;let w;t[13]!==e||t[14]!==P?(w=["post",e,"reposted",P],t[13]=e,t[14]=P,t[15]=w):w=t[15];let h,l;t[16]!==s||t[17]!==e?(l=()=>Ae(e,s.id),h=!!s&&ie(e)&&ie(s.id),t[16]=s,t[17]=e,t[18]=h,t[19]=l):(h=t[18],l=t[19]);let y;t[20]!==h||t[21]!==w||t[22]!==l?(y={queryKey:w,queryFn:l,enabled:h,staleTime:6e5},t[20]=h,t[21]=w,t[22]=l,t[23]=y):y=t[23];const{data:S}=ue(y),$=S===void 0?!1:S;let q;t[24]!==s||t[25]!==e?(q=()=>Pe(e,s.id),t[24]=s,t[25]=e,t[26]=q):q=t[26];let L;t[27]!==s||t[28]!==e||t[29]!==n?(L=async()=>{const O=s.id;await n.cancelQueries({queryKey:["post",e,"liked",O]});const B=n.getQueryData(["post",e,"liked",O]);return n.setQueryData(["post",e,"liked",O],!B),c(M=>({...M,likes:B?(M.likes||0)-1:(M.likes||0)+1})),{previousLiked:B}},t[27]=s,t[28]=e,t[29]=n,t[30]=L):L=t[30];let Q;t[31]!==o||t[32]!==s||t[33]!==e||t[34]!==n?(Q=(O,B,M)=>{M?.previousLiked!==void 0&&(n.setQueryData(["post",e,"liked",s.id],M.previousLiked),c(G=>({...G,likes:M.previousLiked?(G.likes||0)+1:(G.likes||0)-1}))),o("Failed to update like","error")},t[31]=o,t[32]=s,t[33]=e,t[34]=n,t[35]=Q):Q=t[35];let x;t[36]!==s?.id||t[37]!==e||t[38]!==n?(x=()=>{n.invalidateQueries({queryKey:["post",e,"liked",s?.id]})},t[36]=s?.id,t[37]=e,t[38]=n,t[39]=x):x=t[39];let k;t[40]!==q||t[41]!==L||t[42]!==Q||t[43]!==x?(k={mutationFn:q,onMutate:L,onError:Q,onSettled:x},t[40]=q,t[41]=L,t[42]=Q,t[43]=x,t[44]=k):k=t[44];const T=oe(k);let v;t[45]!==s||t[46]!==e?(v=()=>Ve(e,s.id),t[45]=s,t[46]=e,t[47]=v):v=t[47];let F;t[48]!==s||t[49]!==e||t[50]!==n?(F=async()=>{const O=s.id;await n.cancelQueries({queryKey:["post",e,"reposted",O]});const B=n.getQueryData(["post",e,"reposted",O]);return n.setQueryData(["post",e,"reposted",O],!B),c(M=>({...M,reposts:B?(M.reposts||0)-1:(M.reposts||0)+1,mirrors:B?(M.mirrors||0)-1:(M.mirrors||0)+1})),{previousReposted:B}},t[48]=s,t[49]=e,t[50]=n,t[51]=F):F=t[51];let A;t[52]!==o||t[53]!==s||t[54]!==e||t[55]!==n?(A=(O,B,M)=>{M?.previousReposted!==void 0&&(n.setQueryData(["post",e,"reposted",s.id],M.previousReposted),c(G=>({...G,reposts:M.previousReposted?(G.reposts||0)+1:(G.reposts||0)-1,mirrors:M.previousReposted?(G.mirrors||0)+1:(G.mirrors||0)-1}))),o("Failed to update repost","error")},t[52]=o,t[53]=s,t[54]=e,t[55]=n,t[56]=A):A=t[56];let K;t[57]!==s?.id||t[58]!==e||t[59]!==n?(K=()=>{n.invalidateQueries({queryKey:["post",e,"reposted",s?.id]})},t[57]=s?.id,t[58]=e,t[59]=n,t[60]=K):K=t[60];let j;t[61]!==o?(j=O=>{o(O?"Reposted!":"Removed repost")},t[61]=o,t[62]=j):j=t[62];let J;t[63]!==v||t[64]!==F||t[65]!==A||t[66]!==K||t[67]!==j?(J={mutationFn:v,onMutate:F,onError:A,onSettled:K,onSuccess:j},t[63]=v,t[64]=F,t[65]=A,t[66]=K,t[67]=j,t[68]=J):J=t[68];const Y=oe(J);let W;t[69]!==o||t[70]!==s||t[71]!==T||t[72]!==e?(W=async O=>{if(O&&O.stopPropagation(),!s)return o("Please login to like!","error");!ie(e)||!ie(s.id)||T.mutate()},t[69]=o,t[70]=s,t[71]=T,t[72]=e,t[73]=W):W=t[73];const z=W;let E;t[74]!==o||t[75]!==s||t[76]!==e||t[77]!==Y?(E=async O=>{if(O&&O.stopPropagation(),!s)return o("Please login to repost!","error");!ie(e)||!ie(s.id)||Y.mutate()},t[74]=o,t[75]=s,t[76]=e,t[77]=Y,t[78]=E):E=t[78];const C=E;let N;return t[79]!==z||t[80]!==C||t[81]!==_||t[82]!==$||t[83]!==m?(N={liked:_,reposted:$,localStats:m,setLocalStats:c,handleLike:z,handleRepost:C},t[79]=z,t[80]=C,t[81]=_,t[82]=$,t[83]=m,t[84]=N):N=t[84],N};var yt=I();const us=e=>{const i=(0,yt.c)(5);let s;i[0]!==e?(s=()=>ge(e),i[0]=e,i[1]=s):s=i[1];const[t,n]=(0,V.useState)(s);let o,a;return i[2]!==e?(o=()=>{if(!e)return;const m=setTimeout(()=>{n(ge(e))},0),c=setInterval(()=>{n(ge(e))},6e4);return()=>{clearTimeout(m),clearInterval(c)}},a=[e],i[2]=e,i[3]=o,i[4]=a):(o=i[3],a=i[4]),(0,V.useEffect)(o,a),t};var pt=I();const fs=()=>{const e=(0,pt.c)(30),[i,s]=(0,V.useState)(!1),[t,n]=(0,V.useState)(!1),[o,a]=(0,V.useState)(0),[m,c]=(0,V.useState)(null),[u,f]=(0,V.useState)(null),r=(0,V.useRef)(null),R=(0,V.useRef)(null);let b;e[0]===Symbol.for("react.memo_cache_sentinel")?(b=[],e[0]=b):b=e[0];const d=(0,V.useRef)(b);let g,p;e[1]!==u?(g=()=>()=>{R.current&&clearInterval(R.current),r.current&&r.current.state!=="inactive"&&(r.current.stop(),r.current.stream.getTracks().forEach(ht)),u&&URL.revokeObjectURL(u)},p=[u],e[1]=u,e[2]=g,e[3]=p):(g=e[2],p=e[3]),(0,V.useEffect)(g,p);let _;e[4]===Symbol.for("react.memo_cache_sentinel")?(_=()=>{R.current=window.setInterval(()=>{a(_t)},1e3)},e[4]=_):_=e[4];const P=_;let w;e[5]===Symbol.for("react.memo_cache_sentinel")?(w=()=>{R.current&&(clearInterval(R.current),R.current=null)},e[5]=w):w=e[5];const h=w;let l;e[6]===Symbol.for("react.memo_cache_sentinel")?(l=async()=>{try{const K=await navigator.mediaDevices.getUserMedia({audio:!0}),j=new MediaRecorder(K);r.current=j,d.current=[],j.ondataavailable=J=>{J.data.size>0&&d.current.push(J.data)},j.onstop=()=>{const J=new Blob(d.current,{type:"audio/webm;codecs=opus"}),Y=URL.createObjectURL(J);c(J),f(Y),K.getTracks().forEach(Pt)},j.start(),s(!0),n(!1),a(0),P()}catch(K){const j=K;throw console.error("Error accessing microphone:",j),j}},e[6]=l):l=e[6];const y=l;let S;e[7]!==i?(S=()=>{r.current&&i&&(r.current.stop(),s(!1),n(!1),h())},e[7]=i,e[8]=S):S=e[8];const $=S;let q;e[9]!==t||e[10]!==i?(q=()=>{r.current&&i&&!t&&(r.current.pause(),n(!0),h())},e[9]=t,e[10]=i,e[11]=q):q=e[11];const L=q;let Q;e[12]!==t||e[13]!==i?(Q=()=>{r.current&&i&&t&&(r.current.resume(),n(!1),P())},e[12]=t,e[13]=i,e[14]=Q):Q=e[14];const x=Q;let k;e[15]!==i?(k=()=>{r.current&&i&&(r.current.stop(),r.current.onstop=null,s(!1),n(!1),h(),a(0),r.current.stream&&r.current.stream.getTracks().forEach(wt))},e[15]=i,e[16]=k):k=e[16];const T=k;let v;e[17]!==u?(v=()=>{u&&URL.revokeObjectURL(u),c(null),f(null),a(0)},e[17]=u,e[18]=v):v=e[18];const F=v;let A;return e[19]!==m||e[20]!==u||e[21]!==T||e[22]!==F||e[23]!==t||e[24]!==i||e[25]!==L||e[26]!==o||e[27]!==x||e[28]!==$?(A={isRecording:i,isPaused:t,recordingTime:o,startRecording:y,stopRecording:$,pauseRecording:L,resumeRecording:x,cancelRecording:T,audioBlob:m,audioUrl:u,clearAudio:F},e[19]=m,e[20]=u,e[21]=T,e[22]=F,e[23]=t,e[24]=i,e[25]=L,e[26]=o,e[27]=x,e[28]=$,e[29]=A):A=e[29],A};function ht(e){return e.stop()}function _t(e){return e+1}function Pt(e){return e.stop()}function wt(e){return e.stop()}var Mt=I();const ms=(e,i,s)=>{const t=(0,Mt.c)(39),n=le(),{currentUser:o}=ne();let a,m;t[0]!==s||t[1]!==e?(a=["comments",e,s],m=L=>{const{pageParam:Q}=L;return Te(e,Q,10,s)},t[0]=s,t[1]=e,t[2]=a,t[3]=m):(a=t[2],m=t[3]);let c;t[4]!==i?(c=i?{pages:[i],pageParams:[null]}:void 0,t[4]=i,t[5]=c):c=t[5];const u=!!e;let f;t[6]!==a||t[7]!==m||t[8]!==c||t[9]!==u?(f={queryKey:a,queryFn:m,initialPageParam:null,getNextPageParam:bt,initialData:c,enabled:u},t[6]=a,t[7]=m,t[8]=c,t[9]=u,t[10]=f):f=t[10];const{data:r,fetchNextPage:R,hasNextPage:b,isFetchingNextPage:d,isLoading:g,refetch:p}=se(f);let _;t[11]!==r?.pages?(_=r?.pages.flatMap(St)||[],t[11]=r?.pages,t[12]=_):_=t[12];const P=_;let w;t[13]!==e?(w=L=>{const{userId:Q,content:x,media:k,replyToId:T}=L;return $e(e,Q,x,k,T)},t[13]=e,t[14]=w):w=t[14];let h;t[15]!==o||t[16]!==s||t[17]!==e||t[18]!==n?(h=async L=>{const Q=["comments",e,s];await n.cancelQueries({queryKey:Q});const x=n.getQueryData(Q);if(x&&o){const k={id:`temp-${Date.now()}`,post_id:e,user_id:o.id,content:L.content,media:L.media||null,created_at:new Date().toISOString(),parent_id:L.replyToId||s||null,stats:{likes:0,comments:0},user:o,timeAgo:"just now"};n.setQueryData(Q,T=>T&&{...T,pages:[[k,...T.pages[0]],...T.pages.slice(1)]})}return{previousComments:x}},t[15]=o,t[16]=s,t[17]=e,t[18]=n,t[19]=h):h=t[19];let l,y;t[20]!==s||t[21]!==e||t[22]!==n?(l=(L,Q,x)=>{const k=["comments",e,s];x?.previousComments&&n.setQueryData(k,x.previousComments)},y=()=>{n.invalidateQueries({queryKey:["comments",e]}),s&&n.invalidateQueries({queryKey:["comments",e,s]})},t[20]=s,t[21]=e,t[22]=n,t[23]=l,t[24]=y):(l=t[23],y=t[24]);let S;t[25]!==w||t[26]!==h||t[27]!==l||t[28]!==y?(S={mutationFn:w,onMutate:h,onError:l,onSuccess:y},t[25]=w,t[26]=h,t[27]=l,t[28]=y,t[29]=S):S=t[29];const $=oe(S);let q;return t[30]!==$.isPending||t[31]!==$.mutateAsync||t[32]!==P||t[33]!==R||t[34]!==b||t[35]!==d||t[36]!==g||t[37]!==p?(q={comments:P,fetchNextPage:R,hasNextPage:b,isFetchingNextPage:d,isLoading:g,refetch:p,addComment:$.mutateAsync,isSubmitting:$.isPending},t[30]=$.isPending,t[31]=$.mutateAsync,t[32]=P,t[33]=R,t[34]=b,t[35]=d,t[36]=g,t[37]=p,t[38]=q):q=t[38],q};function bt(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function St(e){return e}var $t=I();const ds=()=>{const e=(0,$t.c)(53),{handle:i}=me(),s=re(),{currentUser:t}=ne(),{addToast:n}=fe();let o,a;e[0]!==i?(o=["profile",i],a=()=>Ye(i),e[0]=i,e[1]=o,e[2]=a):(o=e[1],a=e[2]);const m=!!i;let c;e[3]!==o||e[4]!==a||e[5]!==m?(c={queryKey:o,queryFn:a,enabled:m,staleTime:3e5},e[3]=o,e[4]=a,e[5]=m,e[6]=c):c=e[6];const{data:u,isLoading:f}=ue(c),[r,R]=(0,V.useState)("feed"),b=u?.id;let d;e[7]!==b?(d=["posts","user",b],e[7]=b,e[8]=d):d=e[8];let g;e[9]!==u?(g=M=>{const{pageParam:G}=M;return Oe(u.id,G,10)},e[9]=u,e[10]=g):g=e[10];const p=!!u?.id;let _;e[11]!==d||e[12]!==g||e[13]!==p?(_={queryKey:d,queryFn:g,enabled:p,initialPageParam:null,getNextPageParam:Rt},e[11]=d,e[12]=g,e[13]=p,e[14]=_):_=e[14];const{data:P,fetchNextPage:w,hasNextPage:h,isFetchingNextPage:l,isLoading:y}=se(_);let S;e[15]!==P?.pages?(S=P?.pages.flatMap(qt)||[],e[15]=P?.pages,e[16]=S):S=e[16];const $=S,[q,L]=(0,V.useState)(!1),[Q,x]=(0,V.useState)("Followers"),{followList:k,fetchNextPage:T,hasNextPage:v,isFetchingNextPage:F,isLoading:A}=tt(u?.id,Q,q);let K;e[17]===Symbol.for("react.memo_cache_sentinel")?(K=M=>{x(M),L(!0)},e[17]=K):K=e[17];const j=K;let J;e:{if(r==="feed"){let M;e[18]!==$?(M=$.filter(Tt),e[18]=$,e[19]=M):M=e[19],J=M;break e}if(r==="media"){let M;e[20]!==$?(M=$.filter(Ft),e[20]=$,e[21]=M):M=e[21],J=M;break e}if(r==="collections"){let M;e[22]===Symbol.for("react.memo_cache_sentinel")?(M=[],e[22]=M):M=e[22],J=M;break e}J=$}const Y=J;let W;e[23]!==s?(W=M=>{s(`/p/${M}`)},e[23]=s,e[24]=W):W=e[24];const z=W;let E;e[25]!==i||e[26]!==s?(E=M=>{M!==i&&s(`/u/${M}`)},e[25]=i,e[26]=s,e[27]=E):E=e[27];const C=E;let N;e[28]!==w?(N=()=>{w()},e[28]=w,e[29]=N):N=e[29];const O=N;let B;return e[30]!==r||e[31]!==n||e[32]!==t||e[33]!==T||e[34]!==Y||e[35]!==k||e[36]!==Q||e[37]!==i||e[38]!==z||e[39]!==C||e[40]!==v||e[41]!==h||e[42]!==F||e[43]!==l||e[44]!==q||e[45]!==A||e[46]!==O||e[47]!==y||e[48]!==f||e[49]!==s||e[50]!==u||e[51]!==$?(B={handle:i,profile:u,loading:f,userPosts:$,setUserPosts:Lt,activeProfileTab:r,setActiveProfileTab:R,loadingPosts:y,isFetchingMorePosts:l,hasMorePosts:h,filteredPosts:Y,isFollowModalOpen:q,setIsFollowModalOpen:L,followModalType:Q,followListData:k,isListLoading:A,isFetchingMoreFollows:F,hasMoreFollows:v,openFollowModal:j,fetchNextFollows:T,handlePostClick:z,handleUserClick:C,loadUserPosts:O,currentUser:t,addToast:n,navigate:s},e[30]=r,e[31]=n,e[32]=t,e[33]=T,e[34]=Y,e[35]=k,e[36]=Q,e[37]=i,e[38]=z,e[39]=C,e[40]=v,e[41]=h,e[42]=F,e[43]=l,e[44]=q,e[45]=A,e[46]=O,e[47]=y,e[48]=f,e[49]=s,e[50]=u,e[51]=$,e[52]=B):B=e[52],B};function Rt(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function qt(e){return e}function Tt(e){return e.community_id===null&&e.parent_id===null}function Ft(e){return e.community_id===null&&e.parent_id===null&&(e.type==="video"||e.type==="image"||e.media&&e.media.length>0)}function Lt(){return console.warn("setUserPosts is deprecated")}var Qt=I();const gs=()=>{const e=(0,Qt.c)(75),{handle:i}=me(),s=re(),{currentUser:t}=ne(),{addToast:n}=fe(),o=le();let a,m;e[0]!==i?(a=["community",i],m=()=>ve(i),e[0]=i,e[1]=a,e[2]=m):(a=e[1],m=e[2]);const c=!!i;let u;e[3]!==a||e[4]!==m||e[5]!==c?(u={queryKey:a,queryFn:m,enabled:c,staleTime:6e5},e[3]=a,e[4]=m,e[5]=c,e[6]=u):u=e[6];const{data:f,isLoading:r,refetch:R}=ue(u),b=f?.id,d=t?.id;let g;e[7]!==b||e[8]!==d?(g=["community",b,"membership",d],e[7]=b,e[8]=d,e[9]=g):g=e[9];let p;e[10]!==f||e[11]!==t?(p=()=>be(f.id,t.id),e[10]=f,e[11]=t,e[12]=p):p=e[12];const _=!!f?.id&&!!t?.id;let P;e[13]!==g||e[14]!==p||e[15]!==_?(P={queryKey:g,queryFn:p,enabled:_,staleTime:3e5},e[13]=g,e[14]=p,e[15]=_,e[16]=P):P=e[16];const{data:w}=ue(P),h=!!w,l=w?.role||null,y=f?.id;let S;e[17]!==y?(S=["posts","community",y],e[17]=y,e[18]=S):S=e[18];let $;e[19]!==f?($=B=>{const{pageParam:M}=B;return Se(f.id,M,10)},e[19]=f,e[20]=$):$=e[20];const q=!!f?.id;let L;e[21]!==S||e[22]!==$||e[23]!==q?(L={queryKey:S,queryFn:$,enabled:q,initialPageParam:null,getNextPageParam:Dt},e[21]=S,e[22]=$,e[23]=q,e[24]=L):L=e[24];const{data:Q,fetchNextPage:x,hasNextPage:k,isFetchingNextPage:T,isLoading:v}=se(L);let F;e[25]!==Q?.pages?(F=Q?.pages.flatMap(kt)||[],e[25]=Q?.pages,e[26]=F):F=e[26];const A=F;let K;e[27]!==f||e[28]!==t?(K=()=>De(f.id,t.id),e[27]=f,e[28]=t,e[29]=K):K=e[29];let j;e[30]!==f||e[31]!==t||e[32]!==i||e[33]!==o?(j=async()=>{const B=f.id,M=t.id;await o.cancelQueries({queryKey:["community",B,"membership",M]}),await o.cancelQueries({queryKey:["community",i]});const G=o.getQueryData(["community",B,"membership",M]),ee=o.getQueryData(["community",i]);return o.setQueryData(["community",B,"membership",M],G?null:{role:"member"}),o.setQueryData(["community",i],D=>D&&{...D,membersCount:G?D.membersCount-1:D.membersCount+1}),{previousMembership:G,previousCommunity:ee}},e[30]=f,e[31]=t,e[32]=i,e[33]=o,e[34]=j):j=e[34];let J;e[35]!==n||e[36]!==f||e[37]!==t||e[38]!==i||e[39]!==o?(J=(B,M,G)=>{G?.previousMembership!==void 0&&o.setQueryData(["community",f.id,"membership",t.id],G.previousMembership),G?.previousCommunity&&o.setQueryData(["community",i],G.previousCommunity),n("Failed to update membership","error")},e[35]=n,e[36]=f,e[37]=t,e[38]=i,e[39]=o,e[40]=J):J=e[40];let Y;e[41]!==f?.id||e[42]!==t?.id||e[43]!==i||e[44]!==o?(Y=()=>{o.invalidateQueries({queryKey:["community",f?.id,"membership",t?.id]}),o.invalidateQueries({queryKey:["community",i]})},e[41]=f?.id,e[42]=t?.id,e[43]=i,e[44]=o,e[45]=Y):Y=e[45];let W;e[46]!==n||e[47]!==f?(W=B=>{f&&n(B?`Joined ${f.name}`:`Left ${f.name}`)},e[46]=n,e[47]=f,e[48]=W):W=e[48];let z;e[49]!==K||e[50]!==j||e[51]!==J||e[52]!==Y||e[53]!==W?(z={mutationFn:K,onMutate:j,onError:J,onSettled:Y,onSuccess:W},e[49]=K,e[50]=j,e[51]=J,e[52]=Y,e[53]=W,e[54]=z):z=e[54];const E=oe(z);let C;e[55]!==n||e[56]!==t||e[57]!==E?(C=async()=>{if(!t)return n("Please login to join communities","error");E.mutate()},e[55]=n,e[56]=t,e[57]=E,e[58]=C):C=e[58];const N=C;let O;return e[59]!==n||e[60]!==f||e[61]!==A||e[62]!==t||e[63]!==x||e[64]!==N||e[65]!==k||e[66]!==T||e[67]!==h||e[68]!==E.isPending||e[69]!==r||e[70]!==v||e[71]!==s||e[72]!==R||e[73]!==l?(O={community:f,loading:r,isMember:h,userRole:l,isJoining:E.isPending,communityPosts:A,loadingPosts:v,isFetchingMorePosts:T,hasMorePosts:k,handleJoinToggle:N,loadCommunityPosts:x,refetchCommunity:R,currentUser:t,addToast:n,navigate:s},e[59]=n,e[60]=f,e[61]=A,e[62]=t,e[63]=x,e[64]=N,e[65]=k,e[66]=T,e[67]=h,e[68]=E.isPending,e[69]=r,e[70]=v,e[71]=s,e[72]=R,e[73]=l,e[74]=O):O=e[74],O};function Dt(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function kt(e){return e}var Nt=I();const ys=()=>{const e=(0,Nt.c)(48),{currentUser:i}=ne(),s=re(),[t,n]=ye();let o;e[0]!==t?(o=t.get("q")||"",e[0]=t,e[1]=o):o=e[1];const a=o;let m;e[2]!==t||e[3]!==a?(m=t.get("tab")||(a?"posts":"communities"),e[2]=t,e[3]=a,e[4]=m):m=e[4];const c=m,[u,f]=(0,V.useState)(!1);let r;e[5]===Symbol.for("react.memo_cache_sentinel")?(r=["explore","communities"],e[5]=r):r=e[5];let R;e[6]===Symbol.for("react.memo_cache_sentinel")?(R={queryKey:r,queryFn:xt,initialPageParam:null,getNextPageParam:vt},e[6]=R):R=e[6];const{data:b,fetchNextPage:d,hasNextPage:g,isFetchingNextPage:p,isLoading:_}=se(R);let P;e[7]!==b?.pages?(P=b?.pages.flatMap(Kt)||[],e[7]=b?.pages,e[8]=P):P=e[8];const w=P;let h,l;e[9]!==a?(h=["explore","posts",a],l=z=>{const{pageParam:E}=z;return a?Ne(a,E,10,!0):Ge(E,10)},e[9]=a,e[10]=h,e[11]=l):(h=e[10],l=e[11]);let y;e[12]!==h||e[13]!==l?(y={queryKey:h,queryFn:l,initialPageParam:null,getNextPageParam:Et},e[12]=h,e[13]=l,e[14]=y):y=e[14];const{data:S,fetchNextPage:$,hasNextPage:q,isFetchingNextPage:L,isLoading:Q}=se(y);let x;e[15]!==S?.pages?(x=S?.pages.flatMap(At)||[],e[15]=S?.pages,e[16]=x):x=e[16];const k=x;let T=w;if(a){let z;if(e[17]!==T||e[18]!==a){let E;e[20]!==a?(E=C=>C.name?.toLowerCase().includes(a.toLowerCase())||C.handle?.toLowerCase().includes(a.toLowerCase()),e[20]=a,e[21]=E):E=e[21],z=T.filter(E),e[17]=T,e[18]=a,e[19]=z}else z=e[19];T=z}const v=T;let F;e[22]!==s?(F=z=>{s(`/c/${z}`)},e[22]=s,e[23]=F):F=e[23];const A=F;let K;e[24]!==n?(K=z=>{n(E=>(z?E.set("q",z):E.delete("q"),E),{replace:!0})},e[24]=n,e[25]=K):K=e[25];const j=K;let J;e[26]!==n?(J=z=>{n(E=>(E.set("tab",z),E),{replace:!0})},e[26]=n,e[27]=J):J=e[27];const Y=J;let W;return e[28]!==c||e[29]!==w||e[30]!==i||e[31]!==d||e[32]!==$||e[33]!==v||e[34]!==A||e[35]!==j||e[36]!==Y||e[37]!==g||e[38]!==q||e[39]!==_||e[40]!==u||e[41]!==p||e[42]!==L||e[43]!==Q||e[44]!==s||e[45]!==k||e[46]!==a?(W={currentUser:i,searchQuery:a,setSearchQuery:j,activeTab:c,setActiveTab:Y,isCreateModalOpen:u,setIsCreateModalOpen:f,communitiesData:w,isCommunitiesLoading:_,isFetchingMoreCommunities:p,hasMoreCommunities:g,postsData:k,isPostsLoading:Q,isFetchingMorePosts:L,hasMorePosts:q,filteredCommunities:v,handleCommunityClick:A,loadCommunities:d,loadPosts:$,navigate:s},e[28]=c,e[29]=w,e[30]=i,e[31]=d,e[32]=$,e[33]=v,e[34]=A,e[35]=j,e[36]=Y,e[37]=g,e[38]=q,e[39]=_,e[40]=u,e[41]=p,e[42]=L,e[43]=Q,e[44]=s,e[45]=k,e[46]=a,e[47]=W):W=e[47],W};function xt(e){const{pageParam:i}=e;return Ze(i,10)}function vt(e){if(!(!e||e.length<10))return e[e.length-1].createdAt}function Kt(e){return e}function Et(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp}function At(e){return e}var Ct=I();const ps=()=>{const e=(0,Ct.c)(21),{currentUser:i}=ne(),{posts:s,loading:t,hasMore:n,isFetchingNextPage:o,fetchNextPage:a,refreshPosts:m}=Be(),{addToast:c}=fe(),u=re();let f;e[0]===Symbol.for("react.memo_cache_sentinel")?(f=["stories"],e[0]=f):f=e[0];let r;e[1]===Symbol.for("react.memo_cache_sentinel")?(r={queryKey:f,queryFn:Ot,initialPageParam:null,getNextPageParam:Bt,refetchInterval:6e4},e[1]=r):r=e[1];const{data:R,isLoading:b}=se(r);let d;if(e[2]!==R?.pages){const l=R?.pages.flatMap(jt)||[],y=JSON.parse(localStorage.getItem("seenStories")||"[]");d=l.reduce(Jt,[]).map(S=>({...S,isSeen:y.includes(S.user.id)})),e[2]=R?.pages,e[3]=d}else d=e[3];const g=d;let p;e[4]!==u?(p=l=>{u(`/p/${l}`)},e[4]=u,e[5]=p):p=e[5];const _=p;let P;e[6]!==u?(P=l=>{u(`/u/${l}`)},e[6]=u,e[7]=P):P=e[7];const w=P;let h;return e[8]!==c||e[9]!==i||e[10]!==a||e[11]!==g||e[12]!==_||e[13]!==w||e[14]!==n||e[15]!==s||e[16]!==o||e[17]!==t||e[18]!==b||e[19]!==m?(h={currentUser:i,homePosts:s,groupedStories:g,isPostsLoading:t,isStoriesLoading:b,hasMore:n,isFetchingNextPage:o,fetchNextPage:a,refreshPosts:m,addToast:c,handlePostClick:_,handleUserClick:w},e[8]=c,e[9]=i,e[10]=a,e[11]=g,e[12]=_,e[13]=w,e[14]=n,e[15]=s,e[16]=o,e[17]=t,e[18]=b,e[19]=m,e[20]=h):h=e[20],h};function Ot(e){const{pageParam:i}=e;return we(i,10)}function Bt(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function jt(e){return e}function Jt(e,i){const s=e.find(t=>t.user.id===i.user_id);return s?s.stories.push(i):e.push({user:i.user,stories:[i],isSeen:!1}),e}var zt=I();const hs=()=>{const e=(0,zt.c)(62),{id:i}=me(),s=re(),{currentUser:t}=ne(),{onlineUsers:n}=Je(),o=le(),[a,m]=(0,V.useState)("");let c;e[0]===Symbol.for("react.memo_cache_sentinel")?(c=[],e[0]=c):c=e[0];const[u,f]=(0,V.useState)(c),{conversations:r,isConvLoading:R,refetchConversations:b,refetchMessages:d,sendMessage:g,editMessage:p,sendTypingStatus:_,typingStatus:P,markAsRead:w,formatMessages:h,onDeleteMessage:l,onToggleReaction:y,conversationReactions:S,messages:$,isMsgLoading:q,fetchNextMessages:L,hasMoreMessages:Q,isFetchingMoreMessages:x}=dt(t,i);let k;e:{if(!i||r.length===0){k=null;break e}let D;e[1]!==r||e[2]!==i?(D=r.find(X=>X.id===i)||null,e[1]=r,e[2]=i,e[3]=D):D=e[3],k=D}const T=k;let v,F;e[4]!==i||e[5]!==w?(v=()=>{i&&w(i)},F=[i,w],e[4]=i,e[5]=w,e[6]=v,e[7]=F):(v=e[6],F=e[7]),(0,V.useEffect)(v,F);let A;e[8]!==r||e[9]!==t?.id||e[10]!==a?(A=()=>{const D=setTimeout(async()=>{if(a.length>1){const X=await He(a),Z=r.map(Ht);f(X.filter(U=>U.id!==t?.id&&!Z.includes(U.id)))}else f([])},300);return()=>clearTimeout(D)},e[8]=r,e[9]=t?.id,e[10]=a,e[11]=A):A=e[11];const K=t?.id;let j;e[12]!==r||e[13]!==a||e[14]!==K?(j=[a,r,K],e[12]=r,e[13]=a,e[14]=K,e[15]=j):j=e[15],(0,V.useEffect)(A,j);let J;e[16]!==t||e[17]!==s||e[18]!==o?(J=async D=>{if(t)try{const X=await xe(t.id,D.id);o.invalidateQueries({queryKey:["conversations",t.id]}),m(""),s(`/m/${X}`)}catch(X){console.error("Failed to start conversation:",X)}},e[16]=t,e[17]=s,e[18]=o,e[19]=J):J=e[19];const Y=J;let W;e[20]!==s?(W=D=>{s(`/m/${D.id}`)},e[20]=s,e[21]=W):W=e[21];const z=W;let E;e[22]!==S||e[23]!==h||e[24]!==$?(E=h($,S),e[22]=S,e[23]=h,e[24]=$,e[25]=E):E=e[25];const C=E;let N;if(e[26]!==r||e[27]!==a){let D;e[29]!==a?(D=X=>X.user?.name?.toLowerCase().includes(a.toLowerCase())||X.user?.handle?.toLowerCase().includes(a.toLowerCase())||X.lastMessage?.toLowerCase().includes(a.toLowerCase()),e[29]=a,e[30]=D):D=e[30],N=r.filter(D),e[26]=r,e[27]=a,e[28]=N}else N=e[28];const O=N,B=T&&P[T.id];let M;e[31]!==n||e[32]!==T?(M=T&&T.user?.id&&n.has(T.user.id),e[31]=n,e[32]=T,e[33]=M):M=e[33];const G=M;let ee;return e[34]!==r||e[35]!==B||e[36]!==t||e[37]!==p||e[38]!==L||e[39]!==O||e[40]!==z||e[41]!==Y||e[42]!==Q||e[43]!==i||e[44]!==R||e[45]!==x||e[46]!==q||e[47]!==C||e[48]!==a||e[49]!==s||e[50]!==l||e[51]!==y||e[52]!==n||e[53]!==G||e[54]!==b||e[55]!==d||e[56]!==T||e[57]!==g||e[58]!==_||e[59]!==P||e[60]!==u?(ee={id:i,currentUser:t,onlineUsers:n,msgSearchQuery:a,setMsgSearchQuery:m,userSearchResults:u,conversations:r,filteredConversations:O,selectedConversation:T,localMessages:C,isConvLoading:R,isMsgLoading:q,currentIsTyping:B,otherUserIsOnline:G,handleStartConversation:Y,handleSelectConversation:z,refetchConversations:b,refetchMessages:d,sendMessage:g,editMessage:p,onDeleteMessage:l,sendTypingStatus:_,typingStatus:P,onToggleReaction:y,navigate:s,fetchNextMessages:L,hasMoreMessages:Q,isFetchingMoreMessages:x},e[34]=r,e[35]=B,e[36]=t,e[37]=p,e[38]=L,e[39]=O,e[40]=z,e[41]=Y,e[42]=Q,e[43]=i,e[44]=R,e[45]=x,e[46]=q,e[47]=C,e[48]=a,e[49]=s,e[50]=l,e[51]=y,e[52]=n,e[53]=G,e[54]=b,e[55]=d,e[56]=T,e[57]=g,e[58]=_,e[59]=P,e[60]=u,e[61]=ee):ee=e[61],ee};function Ht(e){return e.user?.id}var Vt=I();const _s=()=>{const e=(0,Vt.c)(48),{currentUser:i}=ne(),s=re(),t=le(),n=i?.id;let o;e[0]!==n?(o=["notifications",n],e[0]=n,e[1]=o):o=e[1];let a;e[2]!==i?(a=F=>{const{pageParam:A}=F;return We(i.id,A,10)},e[2]=i,e[3]=a):a=e[3];const m=!!i?.id;let c;e[4]!==o||e[5]!==a||e[6]!==m?(c={queryKey:o,queryFn:a,enabled:m,initialPageParam:null,getNextPageParam:Wt},e[4]=o,e[5]=a,e[6]=m,e[7]=c):c=e[7];const{data:u,fetchNextPage:f,hasNextPage:r,isFetchingNextPage:R,isLoading:b,refetch:d}=se(c);let g;e[8]!==u?.pages?(g=u?.pages.flatMap(Xt)||[],e[8]=u?.pages,e[9]=g):g=e[9];const p=g;let _;e[10]!==i||e[11]!==t?(_=()=>{if(!i?.id)return;const F=i.id,A=ae.channel(`user_notifications:${F}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${F}`},()=>{t.invalidateQueries({queryKey:["notifications",F]})}).subscribe();return()=>{ae.removeChannel(A)}},e[10]=i,e[11]=t,e[12]=_):_=e[12];const P=i?.id;let w;e[13]!==t||e[14]!==P?(w=[P,t],e[13]=t,e[14]=P,e[15]=w):w=e[15],(0,V.useEffect)(_,w);let h;e[16]!==i?(h=()=>i?Le(i.id):Promise.resolve(),e[16]=i,e[17]=h):h=e[17];let l,y,S;e[18]!==i?.id||e[19]!==t?(l=async()=>{const F=i?.id;await t.cancelQueries({queryKey:["notifications",F]});const A=t.getQueryData(["notifications",F]);return t.setQueryData(["notifications",F],Zt),{previousNotifications:A}},y=(F,A,K)=>{K?.previousNotifications&&t.setQueryData(["notifications",i?.id],K.previousNotifications)},S=()=>{t.invalidateQueries({queryKey:["notifications",i?.id]})},e[18]=i?.id,e[19]=t,e[20]=l,e[21]=y,e[22]=S):(l=e[20],y=e[21],S=e[22]);let $;e[23]!==l||e[24]!==y||e[25]!==S||e[26]!==h?($={mutationFn:h,onMutate:l,onError:y,onSettled:S},e[23]=l,e[24]=y,e[25]=S,e[26]=h,e[27]=$):$=e[27];const q=oe($);let L;e[28]!==s?(L=F=>{F.type==="follow"?s(`/u/${F.user}`):F.post_id&&s(`/p/${F.post_id}`)},e[28]=s,e[29]=L):L=e[29];const Q=L;let x;e[30]!==i?.id||e[31]!==q||e[32]!==p?(x=()=>{i?.id&&p.some(Ut)&&q.mutate()},e[30]=i?.id,e[31]=q,e[32]=p,e[33]=x):x=e[33];const k=i?.id;let T;e[34]!==q||e[35]!==p||e[36]!==k?(T=[k,p,q],e[34]=q,e[35]=p,e[36]=k,e[37]=T):T=e[37],(0,V.useEffect)(x,T);let v;return e[38]!==i||e[39]!==f||e[40]!==Q||e[41]!==r||e[42]!==R||e[43]!==b||e[44]!==s||e[45]!==p||e[46]!==d?(v={currentUser:i,notifications:p,isLoading:b,isFetchingMore:R,hasMore:r,loadNotifications:f,refreshNotifications:d,handleNotificationClick:Q,navigate:s},e[38]=i,e[39]=f,e[40]=Q,e[41]=r,e[42]=R,e[43]=b,e[44]=s,e[45]=p,e[46]=d,e[47]=v):v=e[47],v};function Wt(e){if(!(!e||e.length<10))return e[e.length-1].created_at}function Xt(e){return e}function Gt(e){return{...e,is_read:!0}}function Yt(e){return e.map(Gt)}function Zt(e){return e&&{...e,pages:e.pages.map(Yt)}}function Ut(e){return!e.is_read}var It=I();const Ps=()=>{const e=(0,It.c)(23),{id:i}=me(),s=re(),{currentUser:t}=ne(),{addToast:n}=fe(),o=le();let a,m;e[0]!==i?(a=["post",i],m=async()=>{if(!i||!ie(i))throw new Error("Invalid post ID");return qe(i)},e[0]=i,e[1]=a,e[2]=m):(a=e[1],m=e[2]);const c=!!i;let u;e[3]!==a||e[4]!==m||e[5]!==c?(u={queryKey:a,queryFn:m,enabled:c,retry:!1},e[3]=a,e[4]=m,e[5]=c,e[6]=u):u=e[6];const{data:f,isLoading:r,isError:R}=ue(u);let b;e[7]!==s?(b=h=>{s(`/u/${h}`)},e[7]=s,e[8]=b):b=e[8];const d=b;let g;e[9]!==s?(g=()=>{s(-1)},e[9]=s,e[10]=g):g=e[10];const p=g;let _;e[11]!==o?(_=(h,l,y)=>{o.setQueryData(["post",h],S=>S&&{...S,content:l,media:y})},e[11]=o,e[12]=_):_=e[12];const P=_;let w;return e[13]!==n||e[14]!==t||e[15]!==p||e[16]!==P||e[17]!==d||e[18]!==R||e[19]!==r||e[20]!==s||e[21]!==f?(w={post:f,isLoading:r,isError:R,currentUser:t,addToast:n,navigate:s,handleUserClick:d,handleDelete:p,handleUpdate:P},e[13]=n,e[14]=t,e[15]=p,e[16]=P,e[17]=d,e[18]=R,e[19]=r,e[20]=s,e[21]=f,e[22]=w):w=e[22],w};var es=I();const ws=()=>{const e=(0,es.c)(44),i=re(),{id:s}=me(),[t]=ye();let n;e[0]!==s||e[1]!==t?(n=s||t.get("id"),e[0]=s,e[1]=t,e[2]=n):n=e[2];const o=n,a=(0,V.useRef)(null);let m;e[3]===Symbol.for("react.memo_cache_sentinel")?(m=new Map,e[3]=m):m=e[3];const c=(0,V.useRef)(m),[u,f]=(0,V.useState)(null),[r,R]=(0,V.useState)(!0);let b;e[4]===Symbol.for("react.memo_cache_sentinel")?(b=["reels"],e[4]=b):b=e[4];let d;e[5]===Symbol.for("react.memo_cache_sentinel")?(d={queryKey:b,queryFn:ts,initialPageParam:null,getNextPageParam:ss},e[5]=d):d=e[5];const{data:g,fetchNextPage:p,hasNextPage:_,isFetchingNextPage:P,isLoading:w}=se(d);let h;e[6]!==g?.pages?(h=g?.pages.flatMap(is)||[],e[6]=g?.pages,e[7]=h):h=e[7];const l=h,[y,S]=(0,V.useState)(0);l.length>0&&l.length!==y&&!u&&(S(l.length),o&&l.find(C=>C.id===o)?f(o):f(l[0].id));let $,q;e[8]!==l.length||e[9]!==o?($=()=>{if(l.length>0&&o){const C=c.current.get(o);C&&C.scrollIntoView({behavior:"instant"})}},q=[l.length,o],e[8]=l.length,e[9]=o,e[10]=$,e[11]=q):($=e[10],q=e[11]),(0,V.useEffect)($,q);let L;e[12]===Symbol.for("react.memo_cache_sentinel")?(L=()=>{R(ns)},e[12]=L):L=e[12];const Q=L;let x;e[13]!==u||e[14]!==l?(x=()=>{if(l.length===0)return;const C=l.findIndex(N=>N.id===u);if(C<l.length-1){const N=l[C+1];c.current.get(N.id)?.scrollIntoView({behavior:"smooth"})}},e[13]=u,e[14]=l,e[15]=x):x=e[15];const k=x;let T;e[16]!==u||e[17]!==l?(T=()=>{if(l.length===0)return;const C=l.findIndex(N=>N.id===u);if(C>0){const N=l[C-1];c.current.get(N.id)?.scrollIntoView({behavior:"smooth"})}},e[16]=u,e[17]=l,e[18]=T):T=e[18];const v=T;let F,A;e[19]!==l.length?(F=()=>{if(l.length===0)return;const C={root:a.current,threshold:.6},N=B=>{B.forEach(M=>{if(M.isIntersecting){const G=M.target.getAttribute("data-id");G&&f(G)}})},O=new IntersectionObserver(N,C);return c.current.forEach(B=>O.observe(B)),()=>O.disconnect()},A=[l.length],e[19]=l.length,e[20]=F,e[21]=A):(F=e[20],A=e[21]),(0,V.useEffect)(F,A);let K,j;e[22]!==u||e[23]!==k||e[24]!==v?(K=()=>{const C=N=>{const O=N.target;if(!(O.tagName==="INPUT"||O.tagName==="TEXTAREA"||O.isContentEditable)&&!(N.ctrlKey||N.altKey||N.metaKey))e:switch(N.key){case"ArrowUp":N.preventDefault(),v();break e;case"ArrowDown":N.preventDefault(),k();break e;case"m":case"M":Q();break e;case" ":{N.preventDefault();const B=c.current.get(u||"");if(B){const M=B.querySelector(".reel-item");M&&M.click()}}}};return window.addEventListener("keydown",C),()=>window.removeEventListener("keydown",C)},j=[u,k,v,Q],e[22]=u,e[23]=k,e[24]=v,e[25]=K,e[26]=j):(K=e[25],j=e[26]),(0,V.useEffect)(K,j);let J;e[27]===Symbol.for("react.memo_cache_sentinel")?(J=(C,N)=>{N?c.current.set(C,N):c.current.delete(C)},e[27]=J):J=e[27];const Y=J;let W,z;e[28]!==p||e[29]!==_||e[30]!==P?(W=()=>{const C=()=>{if(!a.current||P||!_)return;const{scrollTop:O,scrollHeight:B,clientHeight:M}=a.current;O+M>=B-800&&p()},N=a.current;if(N)return N.addEventListener("scroll",C),()=>N.removeEventListener("scroll",C)},z=[P,_,p],e[28]=p,e[29]=_,e[30]=P,e[31]=W,e[32]=z):(W=e[31],z=e[32]),(0,V.useEffect)(W,z);let E;return e[33]!==u||e[34]!==p||e[35]!==_||e[36]!==P||e[37]!==w||e[38]!==r||e[39]!==i||e[40]!==l||e[41]!==k||e[42]!==v?(E={reels:l,loading:w,loadingMore:P,activeReelId:u,hasMore:_,isMuted:r,containerRef:a,setReelRef:Y,navigate:i,toggleMute:Q,scrollToNext:k,scrollToPrev:v,loadReels:p},e[33]=u,e[34]=p,e[35]=_,e[36]=P,e[37]=w,e[38]=r,e[39]=i,e[40]=l,e[41]=k,e[42]=v,e[43]=E):E=e[43],E};function ts(e){const{pageParam:i}=e;return Ce(i,10)}function ss(e){if(!(!e||e.length<10))return e[e.length-1].sort_timestamp||e[e.length-1].created_at}function is(e){return e}function ns(e){return!e}const Ms=()=>{const{currentUser:e,logout:i}=ne(),{darkMode:s,toggleDarkMode:t,fontSize:n,setFontSize:o,dataSaver:a,setDataSaver:m}=Ue(),{addToast:c}=fe(),[u,f]=(0,V.useState)(!1),[r,R]=(0,V.useState)({newPassword:"",confirmPassword:""}),[b,d]=(0,V.useState)(!1),g=async()=>{try{await i(),c("Logged out successfully")}catch(y){console.error("Logout error:",y),c("Failed to logout")}};return{currentUser:e,darkMode:s,toggleDarkMode:t,fontSize:n,setFontSize:o,dataSaver:a,setDataSaver:m,isChangingPassword:u,setIsChangingPassword:f,passwordData:r,setPasswordData:R,loading:b,handleLogout:g,handlePasswordChange:async y=>{if(y.preventDefault(),r.newPassword!==r.confirmPassword){c("Passwords do not match","error");return}if(r.newPassword.length<6){c("Password must be at least 6 characters","error");return}d(!0);try{const{error:S}=await ae.auth.updateUser({password:r.newPassword});if(S)throw S;c("Password updated successfully!"),f(!1),R({newPassword:"",confirmPassword:""})}catch(S){console.error("Password update error:",S),c(S.message||"Failed to update password","error")}finally{d(!1)}},handlePasswordReset:async()=>{if(e?.email){d(!0);try{const{error:y}=await ae.auth.resetPasswordForEmail(e.email,{redirectTo:`${window.location.origin}/settings?type=recovery`});if(y)throw y;c("Password reset email sent!")}catch(y){console.error("Reset password error:",y),c(y.message||"Failed to send reset email","error")}finally{d(!1)}}},handleClearCache:()=>{["seenStories","font-size","data-saver","theme"].forEach(y=>localStorage.removeItem(y)),c("Cache cleared! Reloading..."),setTimeout(()=>window.location.reload(),1500)},handleDownloadData:async()=>{if(e){d(!0);try{const y={user:{id:e.id,handle:e.handle,name:e.name,email:e.email},exportDate:new Date().toISOString(),note:"This is a mock export of your Sysm data."},S=new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),$=URL.createObjectURL(S),q=document.createElement("a");q.href=$,q.download=`sysm-data-${e.handle}.json`,q.click(),URL.revokeObjectURL($),c("Data export started!")}catch{c("Failed to export data","error")}finally{d(!1)}}},handleDeleteAccount:()=>{window.confirm("Are you absolutely sure? This will permanently delete your account and all associated data. This action is irreversible.")&&(c("Account deletion request submitted. Logging out..."),setTimeout(g,2e3))},handleReportBug:()=>{window.prompt("Please describe the bug you found:")&&c("Bug reported! Thank you for your feedback.")}}};export{hs as a,gs as c,fs as d,us as f,_s as i,ds as l,ws as n,ps as o,cs as p,Ps as r,ys as s,Ms as t,ms as u};
