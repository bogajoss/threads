import{o as C}from"./rolldown-runtime-CIzSbf4l.js";import{l as Q,v as O,w as P}from"./framework-i0QTTZ5z.js";import{a as q}from"./query-D9AYMyAs.js";import"./database-OCX2jLsI.js";import{At as E,cr as M,en as T,fr as $,or as B}from"./ui-libs-BsCs0W7b.js";import"./media-libs-CSO2-zwb.js";import{$t as d,Fn as w,Pn as K,Qt as x,Zt as m,dn as W,jn as X,ln as Z,mn as D,tn as H,vt as J}from"./index-BwNTmHZZ.js";var s=C(P(),1),e=C(Q(),1),V=()=>{const{currentUser:n}=W(),{addToast:c}=Z(),S=q(),h=O(),[i,U]=(0,s.useState)(""),[u,_]=(0,s.useState)(null),[o,A]=(0,s.useState)(""),[p,R]=(0,s.useState)(""),[f,v]=(0,s.useState)([]),[l,b]=(0,s.useState)([]),[g,j]=(0,s.useState)(!1),[N,k]=(0,s.useState)(!1),z=(0,s.useRef)(null),F=async t=>{if(R(t),t.length<2){v([]);return}k(!0);try{v((await X(t)).filter(a=>a.id!==n?.id))}catch(a){console.error("Search failed:",a)}finally{k(!1)}},y=t=>{l.find(a=>a.id===t.id)?b(a=>a.filter(r=>r.id!==t.id)):b(a=>[...a,t])},L=t=>{const a=t.target.files?.[0];a&&(_(a),A(r=>(r&&URL.revokeObjectURL(r),URL.createObjectURL(a))))};(0,s.useEffect)(()=>()=>{o&&URL.revokeObjectURL(o)},[]);const G=async()=>{if(!n||!i.trim()||l.length===0){c("Please provide a group name and select at least one member","error");return}j(!0);try{let t=null;u&&(t=(await K(u)).url);const a=l.map(I=>I.id),r=await D(n.id,i,a,t);S.invalidateQueries({queryKey:["conversations",n.id]}),c("Group created successfully!"),h(`/m/${r}`)}catch(t){console.error("Failed to create group:",t),c("Failed to create group","error")}finally{j(!1)}};return(0,e.jsxs)("div",{className:"min-h-screen bg-white pb-20 dark:bg-black md:rounded-xl",children:[(0,e.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-zinc-100 bg-white/90 px-4 py-3 backdrop-blur-md dark:border-zinc-800 dark:bg-black/90",children:[(0,e.jsxs)("div",{className:"flex items-center gap-4",children:[(0,e.jsx)("button",{onClick:()=>h(-1),className:"rounded-full p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,e.jsx)($,{size:20})}),(0,e.jsx)("h1",{className:"text-xl font-bold",children:"New Group"})]}),(0,e.jsx)(H,{onClick:G,disabled:g||!i.trim()||l.length===0,className:"rounded-full px-6 py-2 text-sm font-bold shadow-none",children:g?"Creating...":"Create"})]}),(0,e.jsxs)("div",{className:"mx-auto max-w-2xl px-4 py-6 space-y-6",children:[(0,e.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,e.jsxs)("div",{className:"relative group cursor-pointer",onClick:()=>z.current?.click(),children:[(0,e.jsxs)(m,{className:"h-24 w-24 border-2 border-dashed border-zinc-300 dark:border-zinc-700",children:[(0,e.jsx)(d,{src:o,className:"object-cover"}),(0,e.jsx)(x,{className:"bg-zinc-50 dark:bg-zinc-900",children:(0,e.jsx)(M,{className:"h-8 w-8 text-zinc-400 group-hover:text-violet-500"})})]}),(0,e.jsx)("input",{type:"file",ref:z,className:"hidden",onChange:L,accept:"image/*"})]}),(0,e.jsx)("div",{className:"w-full max-w-md",children:(0,e.jsx)(J,{value:i,onChange:t=>U(t.target.value),placeholder:"Group Name",className:"text-center font-bold text-lg h-12"})})]}),l.length>0&&(0,e.jsx)("div",{className:"flex flex-wrap gap-2",children:l.map(t=>(0,e.jsxs)("div",{className:"flex items-center gap-1 rounded-full bg-violet-100 px-3 py-1 text-sm font-bold text-violet-700 dark:bg-violet-900/30 dark:text-violet-300",children:[(0,e.jsxs)(m,{className:"h-4 w-4",children:[(0,e.jsx)(d,{src:t.avatar}),(0,e.jsx)(x,{children:t.name[0]})]}),(0,e.jsx)("span",{children:t.name}),(0,e.jsx)("button",{onClick:()=>y(t),className:"ml-1 hover:text-red-500",children:(0,e.jsx)(E,{size:14})})]},t.id))}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsx)("h3",{className:"font-bold text-zinc-900 dark:text-white",children:"Add Members"}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)(T,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400",size:18}),(0,e.jsx)("input",{type:"text",value:p,onChange:t=>F(t.target.value),placeholder:"Search users...",className:"w-full rounded-xl border border-zinc-200 bg-zinc-50 py-3 pl-10 pr-4 outline-none focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20 dark:border-zinc-800 dark:bg-zinc-900 dark:text-white"})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[N&&(0,e.jsx)("div",{className:"text-center py-4 text-zinc-500",children:"Searching..."}),!N&&p&&f.length===0&&(0,e.jsx)("div",{className:"text-center py-4 text-zinc-500",children:"No users found"}),f.map(t=>{const a=l.some(r=>r.id===t.id);return(0,e.jsxs)("div",{onClick:()=>y(t),className:w("flex items-center justify-between rounded-xl p-3 cursor-pointer transition-colors",a?"bg-zinc-100 dark:bg-zinc-800":"hover:bg-zinc-50 dark:hover:bg-zinc-900"),children:[(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsxs)(m,{children:[(0,e.jsx)(d,{src:t.avatar}),(0,e.jsx)(x,{children:t.name[0]})]}),(0,e.jsxs)("div",{className:"flex flex-col",children:[(0,e.jsx)("span",{className:"font-bold text-zinc-900 dark:text-white",children:t.name}),(0,e.jsxs)("span",{className:"text-sm text-zinc-500",children:["@",t.handle]})]})]}),(0,e.jsx)("div",{className:w("flex h-6 w-6 items-center justify-center rounded-full border-2 transition-all",a?"bg-violet-600 border-violet-600 text-white":"border-zinc-300 dark:border-zinc-600"),children:a&&(0,e.jsx)(B,{size:14,strokeWidth:3})})]},t.id)})]})]})]})]})},ne=V;export{ne as default};
