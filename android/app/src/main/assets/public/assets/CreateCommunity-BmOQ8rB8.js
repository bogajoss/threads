import{a as x}from"./rolldown-runtime-BaZ8gS7u.js";import{l as y,v as k,w as z}from"./framework-3lkjbTvb.js";import{a as N,n as C}from"./query-CZHA9T67.js";import"./database-COznt_u0.js";import{$n as w,mr as _,tr as P,ur as F}from"./ui-libs-BrvosAtl.js";import"./media-libs-C98UjHPF.js";import{Fn as S,Ln as q,Wt as A,an as T,bn as D,fn as E,in as H,rn as I,un as L,yn as M}from"./index-BSj_AAu4.js";var l=x(z(),1),e=x(y(),1),$=()=>{const{currentUser:d}=E(),{addToast:s}=L(),u=k(),b=N(),[r,i]=(0,l.useState)({name:"",handle:"",description:"",avatar:"",isPrivate:!1}),[v,m]=(0,l.useState)(!1),h=(0,l.useRef)(null),[t,n]=(0,l.useState)({loading:!1,available:null});(0,l.useEffect)(()=>{if(r.handle.length>=5){const a=setTimeout(async()=>{n({loading:!0,available:null});try{n({loading:!1,available:await M(r.handle)})}catch{n({loading:!1,available:null})}},500);return()=>clearTimeout(a)}else n({loading:!1,available:null})},[r.handle]);const c=C({mutationFn:a=>D(a),onSuccess:a=>{a&&(s(`Community "${a.name}" created!`),b.invalidateQueries({queryKey:["user-communities",d?.id]}),u(`/c/${a.handle}`))},onError:a=>{console.error(a),s(a.message||"Failed to create community","error")}}),p=a=>{const o=a.target.files?.[0];o&&f(o)},f=async a=>{m(!0);try{const o=await S(a);i(j=>({...j,avatar:o.url})),s("Icon uploaded!")}catch{s("Failed to upload icon","error")}finally{m(!1)}},g=a=>{if(a.preventDefault(),!r.name||!r.handle||!r.description){s("Please fill all required fields","error");return}if(t.available===!1){s("Handle is already taken","error");return}c.mutate({name:r.name,handle:r.handle,description:r.description,creator_id:d?.id,is_private:r.isPrivate,avatar_url:r.avatar})};return(0,e.jsxs)("div",{className:"min-h-screen bg-white pb-20 dark:bg-black md:rounded-xl",children:[(0,e.jsxs)("div",{className:"sticky top-0 z-10 flex items-center gap-4 border-b border-zinc-100 bg-white/90 px-4 py-3 backdrop-blur-md dark:border-zinc-800 dark:bg-black/90",children:[(0,e.jsx)("button",{onClick:()=>u(-1),className:"rounded-full p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800",children:(0,e.jsx)(_,{size:20})}),(0,e.jsx)("h1",{className:"text-xl font-bold",children:"Create Community"})]}),(0,e.jsx)("div",{className:"mx-auto max-w-2xl px-4 py-6",children:(0,e.jsxs)("form",{onSubmit:g,className:"space-y-6",children:[(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,e.jsxs)("div",{className:"relative group cursor-pointer",onClick:()=>h.current?.click(),children:[(0,e.jsxs)(I,{className:"h-24 w-24 border-2 border-dashed border-zinc-300 transition-all group-hover:border-violet-500 dark:border-zinc-700",children:[(0,e.jsx)(T,{src:r.avatar,className:"object-cover"}),(0,e.jsx)(H,{className:"bg-zinc-50 dark:bg-zinc-900",children:(0,e.jsx)(F,{className:"h-8 w-8 text-zinc-400 group-hover:text-violet-500"})})]}),(0,e.jsx)("input",{type:"file",accept:"image/*",className:"hidden",ref:h,onChange:p})]}),(0,e.jsx)("p",{className:"text-sm text-zinc-500",children:"Community Icon (Optional)"})]}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{className:"mb-1.5 block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Name"}),(0,e.jsx)("input",{type:"text",value:r.name,onChange:a=>i({...r,name:a.target.value}),placeholder:"e.g. Technology Enthusiasts",required:!0,className:"w-full rounded-xl border border-zinc-200 bg-zinc-50 px-4 py-3 outline-none transition-all focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20 dark:border-zinc-800 dark:bg-zinc-900 dark:text-white"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{className:"mb-1.5 block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Handle"}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-zinc-400 font-bold",children:"c/"}),(0,e.jsx)("input",{type:"text",value:r.handle,onChange:a=>i({...r,handle:a.target.value.toLowerCase().replace(/\s+/g,"")}),placeholder:"tech-enthusiasts",required:!0,className:q("w-full rounded-xl border border-zinc-200 bg-zinc-50 py-3 pl-9 pr-10 outline-none transition-all focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20 dark:border-zinc-800 dark:bg-zinc-900 dark:text-white",t.available===!0&&"border-green-500 focus:border-green-500 focus:ring-green-500/20",t.available===!1&&"border-red-500 focus:border-red-500 focus:ring-red-500/20")}),(0,e.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:t.loading?(0,e.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-zinc-300 border-t-zinc-600"}):t.available===!0?(0,e.jsx)(P,{className:"h-5 w-5 text-green-500"}):t.available===!1?(0,e.jsx)(w,{className:"h-5 w-5 text-red-500"}):null})]}),t.available===!1&&(0,e.jsx)("p",{className:"mt-1 text-sm text-red-500",children:"This handle is already taken"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{className:"mb-1.5 block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Description"}),(0,e.jsx)("textarea",{value:r.description,onChange:a=>i({...r,description:a.target.value}),placeholder:"What is this community about?",required:!0,rows:4,className:"w-full rounded-xl border border-zinc-200 bg-zinc-50 px-4 py-3 outline-none transition-all focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20 dark:border-zinc-800 dark:bg-zinc-900 dark:text-white resize-none"})]}),(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)("input",{type:"checkbox",id:"isPrivate",checked:r.isPrivate,onChange:a=>i({...r,isPrivate:a.target.checked}),className:"h-5 w-5 rounded border-zinc-300 text-violet-600 focus:ring-violet-500 bg-zinc-50 dark:bg-black dark:border-zinc-700"}),(0,e.jsxs)("label",{htmlFor:"isPrivate",className:"flex flex-col cursor-pointer select-none",children:[(0,e.jsx)("span",{className:"font-medium text-zinc-900 dark:text-white",children:"Private Community"}),(0,e.jsx)("span",{className:"text-sm text-zinc-500",children:"Only approved members can see posts"})]})]})]}),(0,e.jsx)("div",{className:"pt-4",children:(0,e.jsx)(A,{type:"submit",disabled:c.isPending||v||t.available===!1,className:"w-full py-6 text-lg font-bold shadow-lg shadow-violet-500/20",children:c.isPending?"Creating...":"Create Community"})})]})})]})},X=$;export{X as default};
